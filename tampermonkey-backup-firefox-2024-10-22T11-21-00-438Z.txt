{"created_by":"Tampermonkey","version":"1","scripts":[{"name":"Neopets - All Site Themes","options":{"check_for_updates":true,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_powerful_this":null,"sandbox":null,"noframes":null,"unwrap":null,"run_at":null,"tab_types":null,"override":{"use_includes":[],"orig_includes":["http://neopets.com/*","http://www.neopets.com/*"],"merge_includes":true,"use_matches":[],"orig_matches":[],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"orig_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null,"orig_run_in":[]},"user_modified":null,"run_in":null,"tags":[]},"storage":{"ts":1696775826894,"data":{}},"enabled":true,"position":1,"file_url":"http://userscripts-mirror.org/scripts/source/14357.user.js","uuid":"6419a4c6-d949-4880-80ba-052e1c0c8c9b","source":"Ly8gTmVvcGV0cyAtIEFsbCBTaXRlIFRoZW1lcw0KLy8gYnkgbnVuZ3J5c2Nwcm8gKG51bmdyeXNjcHJvQHlhaG9vLmNvbSkNCi8vDQovLyA9PVVzZXJTY3JpcHQ9PQ0KLy8gQG5hbWUgICAgICAgICAgTmVvcGV0cyAtIEFsbCBTaXRlIFRoZW1lcw0KLy8gQG5hbWVzcGFjZSAgICAgaHR0cHM6Ly91c2Vyc2NyaXB0cy1taXJyb3Iub3JnL3VzZXJzLzIyMzQ5DQovLyBAZGVzY3JpcHRpb24gICBWIDEuMDUgR2l2ZXMgeW91IHRoZSBhYmlsaXR5IHRvIGNoYW5nZSB0aGUgc2l0ZSB0aGVtZSB5b3UgdXNlIHRvIHZpZXcgTmVvcGV0cy5jb20NCi8vIEBpbmNsdWRlICAgICAgIGh0dHA6Ly9uZW9wZXRzLmNvbS8qDQovLyBAaW5jbHVkZSAgICAgICBodHRwOi8vd3d3Lm5lb3BldHMuY29tLyoNCi8vIEB2ZXJzaW9uICAgICAgIDEuMDUNCi8vIEB1cGRhdGVkICAgICAgIDIwMDkuMDQuMzANCi8vID09L1VzZXJTY3JpcHQ9PQ0KLy8NCi8vIFRoaXMgc2NyaXB0IGRvZXNuJ3QgdW5sb2NrIGFueSBvZiB0aGUgc2l0ZSB0aGVtZXMuICBJdCBvbmx5IGNoYW5nZXMgdGhlIHRoZW1lIHlvdSBzZWUuDQovLyBZb3UgY2FuIGNoYW5nZSB5b3VyIHRoZW1lIGJ5IGdvaW5nIHRvIHlvdXIgcHJlZmVyZW5jZXMgKGh0dHA6Ly93d3cubmVvcGV0cy5jb20vcHJlZmVyZW5jZXMucGh0bWwpIGFuZCBjaGFuZ2luZyBpdCB0aGVyZS4NCi8vIEFzIHNvb24gYXMgeW91IHBpY2sgYSB0aGVtZSwgaXQgd2lsbCBjaGFuZ2UgaW1tZWRpYXRlbHkgc28gZmVlbCBmcmVlIHRvIHN1cmYgTmVvcGV0cyB3aXRoIHlvdXIgbmV3IHRoZW1lLg0KLy8gVGhlcmUncyBubyBuZWVkIHRvIHByZXNzICdDaGFuZ2UgWW91ciBEZXRhaWxzJy4gIElmIHlvdSBwcmVzcyB0aGUgYnV0dG9uLCBlaXRoZXIgYnkgYWNjaWRlbnQgb3IgYmVjYXVzZSB5b3UncmUNCi8vIGNoYW5naW5nIG9uZSBvZiB0aGUgb3RoZXIgc2l0ZSBwcmVmZXJlbmNlcywgZG9uJ3Qgd29ycnkuICBOZW9wZXRzIHdpbGwgb25seSB0aGluayB0aGF0IHlvdSd2ZSBjaGFuZ2VkIHlvdXIgc2l0ZQ0KLy8gdGhlbWUgdG8gJ05lb3BldHMgQmFzaWMnLg0KLy8NCihmdW5jdGlvbigpew0KDQogIGZ1bmN0aW9uIGNoYW5nZXRoZW1lKCl7DQogICAgdmFyIG15dGhlbWUgPSBHTV9nZXRWYWx1ZSgnc2l0ZV90aGVtZScsICcwMDRfYmlyX2EyZTYwJyk7DQoNCiAgICBmb3IgKHZhciB4ID0gMCwgbGlua3NldDsgbGlua3NldCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdsaW5rJylbeF07IHgrKyl7DQogICAgICBpZiAobGlua3NldC5ocmVmLm1hdGNoKCd0aGVtZXMnKSl7DQogICAgICAgIHZhciBvbGR0aGVtZSA9IGxpbmtzZXQuaHJlZi5tYXRjaCgvXC90aGVtZXNcLyhcdyspXC5jc3MvKVsxXTsNCiAgICAgICAgbGlua3NldC5ocmVmID0gbGlua3NldC5ocmVmLnJlcGxhY2Uob2xkdGhlbWUsIG15dGhlbWUpOw0KICAgICAgICBmb3IgKHZhciB5ID0gMCwgaW1hZ2U7IGltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RlbXBsYXRlX25hdicpLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdpbWcnKVt5XTsgeSsrKXsNCiAgICAgICAgICBpZiAoaW1hZ2Uuc3JjLm1hdGNoKG9sZHRoZW1lKSl7DQogICAgICAgICAgICBpbWFnZS5zcmMgPSBpbWFnZS5zcmMucmVwbGFjZShvbGR0aGVtZSwgbXl0aGVtZSk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGZvciAodmFyIHkgPSAwLCBpbWFnZTsgaW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZm9vdGVyJykuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2ltZycpW3ldOyB5Kyspew0KICAgICAgICAgIGlmIChpbWFnZS5zcmMubWF0Y2gob2xkdGhlbWUpKXsNCiAgICAgICAgICAgIGltYWdlLnNyYyA9IGltYWdlLnNyYy5yZXBsYWNlKG9sZHRoZW1lLCBteXRoZW1lKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgYnJlYWs7DQogICAgICB9DQogICAgfQ0KICB9DQogIA0KICBjaGFuZ2V0aGVtZSgpOw0KDQogIGlmIChkb2N1bWVudC5sb2NhdGlvbi5ocmVmLm1hdGNoKCduZW9wZXRzLmNvbS9wcmVmZXJlbmNlcy5waHRtbCcpKXsNCiAgICB2YXIgY2hhbmdldGhpcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlOYW1lKCd1c2VyX3RoZW1lJylbMF07DQogICAgY2hhbmdldGhpcy5pbm5lckhUTUwgPSAnXA0KPG9wdGlvbiBpZD0iMDEwX2FjcF82ZmZjYiIgdmFsdWU9IjAiPkFsdGFkb3IgQ3VwPC9vcHRpb24+XA0KPG9wdGlvbiBpZD0iMDExX2FsY19jMWQxYyIgdmFsdWU9IjAiPkFsdGFkb3JpYW4gQ29uc3RlbGxhdGlvbnM8L29wdGlvbj5cDQo8b3B0aW9uIGlkPSIwMDhfY29tX2U1MjlhIiB2YWx1ZT0iMCI+Q3Vyc2Ugb2YgTWFyYXF1YTwvb3B0aW9uPlwNCjxvcHRpb24gaWQ9IjAxMl90Y2dfZDk3N2EiIHZhbHVlPSIwIj5DeW9kcmFrZXMgR2F6ZTwvb3B0aW9uPlwNCjxvcHRpb24gaWQ9IjAyM19keWRfYzQ3MGIiIHZhbHVlPSIwIj5EYWlseSBEYXJlPC9vcHRpb24+XA0KPG9wdGlvbiBpZD0iMDA0X2Jpcl9hMmU2MCIgdmFsdWU9IjAiPkhhcHB5IEJpcnRoZGF5PC9vcHRpb24+XA0KPG9wdGlvbiBpZD0iMDAzX2h3c185YmRlOSIgdmFsdWU9IjAiPkhhdW50ZWQgV29vZHM8L29wdGlvbj5cDQo8b3B0aW9uIGlkPSIwMDBfZGVmX2Y2NWIxIiB2YWx1ZT0iMCI+TmVvcGV0cyBCYXNpYzwvb3B0aW9uPlwNCjxvcHRpb24gaWQ9IjAxNl9ibHVfZTU2ZmMiIHZhbHVlPSIwIj5OZW9wZXRzIEJsdWU8L29wdGlvbj5cDQo8b3B0aW9uIGlkPSIwMTdfZ3JuX2YwYzFhIiB2YWx1ZT0iMCI+TmVvcGV0cyBHcmVlbjwvb3B0aW9uPlwNCjxvcHRpb24gaWQ9IjAxOF9wcnBsX2Y2NWIxIiB2YWx1ZT0iMCI+TmVvcGV0cyBQdXJwbGU8L29wdGlvbj5cDQo8b3B0aW9uIGlkPSIwMTVfcmVkXzA2MmJmIiB2YWx1ZT0iMCI+TmVvcGV0cyBSZWQ8L29wdGlvbj5cDQo8b3B0aW9uIGlkPSIwMTRfeWVsX2QxODdiIiB2YWx1ZT0iMCI+TmVvcGV0cyBZZWxsb3c8L29wdGlvbj5cDQo8b3B0aW9uIGlkPSIwMjBfcHBsXzNjMjJkIiB2YWx1ZT0iMCI+UGV0cGV0IFByb3RlY3Rpb24gTGVhZ3VlPC9vcHRpb24+XA0KPG9wdGlvbiBpZD0iMDIxX2NwYV81Y2UwMyIgdmFsdWU9IjAiPlB1enpsZSBBZHZlbnR1cmU8L29wdGlvbj5cDQo8b3B0aW9uIGlkPSIwMDlfcWFzXzkzNzA3IiB2YWx1ZT0iMCI+UWFzYWxhbjwvb3B0aW9uPlwNCjxvcHRpb24gaWQ9IjAyMl9scWNfZDJkMWEiIHZhbHVlPSIwIj5RdWl6YXJhXCdzIEN1cnNlPC9vcHRpb24+XA0KPG9wdGlvbiBpZD0iMDA3X3NmcF8yNzNhOCIgdmFsdWU9IjAiPlNwYWNlIEZhZXJpZSBQcmVtaXVtPC9vcHRpb24+XA0KPG9wdGlvbiBpZD0iMDEzX3Rvd180YjU0YiIgdmFsdWU9IjAiPlRhbGUgb2YgV29lPC9vcHRpb24+XA0KPG9wdGlvbiBpZD0iMDE5X3Nsb3RoMV83ZjkxNCIgdmFsdWU9IjAiPlRoZSBSZXR1cm4gb2YgRHIuIFNsb3RoPC9vcHRpb24+XA0KPG9wdGlvbiBpZD0iMDA2X3ZhbF9kODVhMCIgdmFsdWU9IjAiPlZhbGVudGluZXMgRGF5PC9vcHRpb24+XA0KPG9wdGlvbiBpZD0iMDA1X3dpbl81NzA2MSIgdmFsdWU9IjAiPldpbnRlciBIb2xpZGF5PC9vcHRpb24+JzsNCiAgICBjaGFuZ2V0aGlzLnBhcmVudE5vZGUucGFyZW50Tm9kZS5maXJzdENoaWxkLmZpcnN0Q2hpbGQubmV4dFNpYmxpbmcuaW5uZXJIVE1MID0gJ1RoZW1lIDxmb250IGNvbG9yPSJyZWQiPihBbGwgU2l0ZSBUaGVtZXMgLSBFbmFibGVkKTwvZm9udD4nOw0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKEdNX2dldFZhbHVlKCdzaXRlX3RoZW1lJywgJzAwNF9iaXJfYTJlNjAnKSkuc2VsZWN0ZWQgPSB0cnVlOw0KDQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeU5hbWUoJ3VzZXJfdGhlbWUnKVswXS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLGZ1bmN0aW9uKCl7DQogICAgICBuZXd0aGVtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlOYW1lKCd1c2VyX3RoZW1lJylbMF07DQogICAgICBHTV9zZXRWYWx1ZSgnc2l0ZV90aGVtZScsIG5ld3RoZW1lLm9wdGlvbnNbbmV3dGhlbWUuc2VsZWN0ZWRJbmRleF0uaWQpOw0KICAgICAgY2hhbmdldGhlbWUoKTsNCiAgICB9LCBmYWxzZSk7DQogIH0NCg0KfSkoKTs="},{"name":"Neopets : Dailies To-Do","options":{"check_for_updates":true,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_powerful_this":null,"sandbox":null,"noframes":null,"unwrap":null,"run_at":null,"tab_types":null,"override":{"use_includes":[],"orig_includes":["http://www.neopets.com/altador/council.phtml","http://www.neopets.com/altador/council.phtml?*","http://www.neopets.com/bank.phtml","http://www.neopets.com/desert/fruit/index.phtml","http://www.neopets.com/desert/shrine.phtml","http://www.neopets.com/faerieland/caverns/index.phtml","http://www.neopets.com/faerieland/tdmbgpop.phtml","http://www.neopets.com/faerieland/springs.phtml","http://www.neopets.com/island/tombola.phtml","http://www.neopets.com/jelly/jelly.phtml","http://www.neopets.com/medieval/pickyourown_index.phtml","http://www.neopets.com/medieval/pickyourown.phtml","http://www.neopets.com/moon/meteor.phtml","http://www.neopets.com/moon/meteor.phtml?getclose=1","http://www.neopets.com/petpetpark/daily.phtml","http://www.neopets.com/pirates/anchormanagement.phtml","http://www.neopets.com/pirates/buriedtreasure/index.phtml","http://www.neopets.com/pirates/forgottenshore.phtml","http://www.neopets.com/prehistoric/omelette.phtml","http://www.neopets.com/space/strangelever.phtml","http://www.neopets.com/water/fishing.phtml","http://www.neopets.com/winter/adventcalendar.phtml","http://www.neopets.com/worlds/deadlydice.phtml","http://www.neopets.com/worlds/geraptiku/tomb.phtml"],"merge_includes":true,"use_matches":[],"orig_matches":[],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"orig_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null,"orig_run_in":[]},"user_modified":null,"run_in":null,"tags":[]},"storage":{"ts":1696775832253,"data":{}},"enabled":true,"position":2,"file_url":"http://userscripts-mirror.org/scripts/source/32041.user.js","uuid":"c9cbe6cd-8c72-418f-8d47-5850138359b5","source":"Ly8gPT1Vc2VyU2NyaXB0PT0NCi8vIEBuYW1lICAgICAgICAgICBOZW9wZXRzIDogRGFpbGllcyBUby1Ebw0KLy8gQG5hbWVzcGFjZSAgICAgIGh0dHA6Ly9uZW9wZXRzLndlc2xleS5ldGkuYnINCi8vIEBkZXNjcmlwdGlvbiAgICBQbGF5cyB0aG9zZSBub3JtYWwgZGFpbGllcyB0aGF0IHlvdSBuZWVkIGNsaWNrIGEgYnV0dG9uDQovLyBAYXV0aG9yICAgICAgICAgdzM1bDN5DQovLyBAZW1haWwgICAgICAgICAgdzM1bDN5QGJyYXNuZXQub3JnDQovLyBAY29weXJpZ2h0ICAgICAgMjAxMissIHczNWwzeSAoaHR0cDovL2dtLndlc2xleS5ldGkuYnIpDQovLyBAbGljZW5zZSAgICAgICAgR05VIEdQTA0KLy8gQGhvbWVwYWdlICAgICAgIGh0dHA6Ly9nbS53ZXNsZXkuZXRpLmJyDQovLyBAdmVyc2lvbiAgICAgICAgNS4xLjENCi8vIEBsYW5ndWFnZSAgICAgICBlbg0KLy8gQGluY2x1ZGUgICAgICAgIGh0dHA6Ly93d3cubmVvcGV0cy5jb20vYWx0YWRvci9jb3VuY2lsLnBodG1sDQovLyBAaW5jbHVkZSAgICAgICAgaHR0cDovL3d3dy5uZW9wZXRzLmNvbS9hbHRhZG9yL2NvdW5jaWwucGh0bWw/Kg0KLy8gQGluY2x1ZGUgICAgICAgIGh0dHA6Ly93d3cubmVvcGV0cy5jb20vYmFuay5waHRtbA0KLy8gQGluY2x1ZGUgICAgICAgIGh0dHA6Ly93d3cubmVvcGV0cy5jb20vZGVzZXJ0L2ZydWl0L2luZGV4LnBodG1sDQovLyBAaW5jbHVkZSAgICAgICAgaHR0cDovL3d3dy5uZW9wZXRzLmNvbS9kZXNlcnQvc2hyaW5lLnBodG1sDQovLyBAaW5jbHVkZSAgICAgICAgaHR0cDovL3d3dy5uZW9wZXRzLmNvbS9mYWVyaWVsYW5kL2NhdmVybnMvaW5kZXgucGh0bWwNCi8vIEBpbmNsdWRlICAgICAgICBodHRwOi8vd3d3Lm5lb3BldHMuY29tL2ZhZXJpZWxhbmQvdGRtYmdwb3AucGh0bWwNCi8vIEBpbmNsdWRlICAgICAgICBodHRwOi8vd3d3Lm5lb3BldHMuY29tL2ZhZXJpZWxhbmQvc3ByaW5ncy5waHRtbA0KLy8gQGluY2x1ZGUgICAgICAgIGh0dHA6Ly93d3cubmVvcGV0cy5jb20vaXNsYW5kL3RvbWJvbGEucGh0bWwNCi8vIEBpbmNsdWRlICAgICAgICBodHRwOi8vd3d3Lm5lb3BldHMuY29tL2plbGx5L2plbGx5LnBodG1sDQovLyBAaW5jbHVkZSAgICAgICAgaHR0cDovL3d3dy5uZW9wZXRzLmNvbS9tZWRpZXZhbC9waWNreW91cm93bl9pbmRleC5waHRtbA0KLy8gQGluY2x1ZGUgICAgICAgIGh0dHA6Ly93d3cubmVvcGV0cy5jb20vbWVkaWV2YWwvcGlja3lvdXJvd24ucGh0bWwNCi8vIEBpbmNsdWRlICAgICAgICBodHRwOi8vd3d3Lm5lb3BldHMuY29tL21vb24vbWV0ZW9yLnBodG1sDQovLyBAaW5jbHVkZSAgICAgICAgaHR0cDovL3d3dy5uZW9wZXRzLmNvbS9tb29uL21ldGVvci5waHRtbD9nZXRjbG9zZT0xDQovLyBAaW5jbHVkZSAgICAgICAgaHR0cDovL3d3dy5uZW9wZXRzLmNvbS9wZXRwZXRwYXJrL2RhaWx5LnBodG1sDQovLyBAaW5jbHVkZSAgICAgICAgaHR0cDovL3d3dy5uZW9wZXRzLmNvbS9waXJhdGVzL2FuY2hvcm1hbmFnZW1lbnQucGh0bWwNCi8vIEBpbmNsdWRlICAgICAgICBodHRwOi8vd3d3Lm5lb3BldHMuY29tL3BpcmF0ZXMvYnVyaWVkdHJlYXN1cmUvaW5kZXgucGh0bWwNCi8vIEBpbmNsdWRlICAgICAgICBodHRwOi8vd3d3Lm5lb3BldHMuY29tL3BpcmF0ZXMvZm9yZ290dGVuc2hvcmUucGh0bWwNCi8vIEBpbmNsdWRlICAgICAgICBodHRwOi8vd3d3Lm5lb3BldHMuY29tL3ByZWhpc3RvcmljL29tZWxldHRlLnBodG1sDQovLyBAaW5jbHVkZSAgICAgICAgaHR0cDovL3d3dy5uZW9wZXRzLmNvbS9zcGFjZS9zdHJhbmdlbGV2ZXIucGh0bWwNCi8vIEBpbmNsdWRlICAgICAgICBodHRwOi8vd3d3Lm5lb3BldHMuY29tL3dhdGVyL2Zpc2hpbmcucGh0bWwNCi8vIEBpbmNsdWRlICAgICAgICBodHRwOi8vd3d3Lm5lb3BldHMuY29tL3dpbnRlci9hZHZlbnRjYWxlbmRhci5waHRtbA0KLy8gQGluY2x1ZGUgICAgICAgIGh0dHA6Ly93d3cubmVvcGV0cy5jb20vd29ybGRzL2RlYWRseWRpY2UucGh0bWwNCi8vIEBpbmNsdWRlICAgICAgICBodHRwOi8vd3d3Lm5lb3BldHMuY29tL3dvcmxkcy9nZXJhcHRpa3UvdG9tYi5waHRtbA0KLy8gQGdyYW50ICAgICAgICAgIEdNX2xvZw0KLy8gQGdyYW50ICAgICAgICAgIEdNX2FkZFN0eWxlDQovLyBAZ3JhbnQgICAgICAgICAgR01fZ2V0VmFsdWUNCi8vIEBncmFudCAgICAgICAgICBHTV9zZXRWYWx1ZQ0KLy8gQGdyYW50ICAgICAgICAgIEdNX2RlbGV0ZVZhbHVlDQovLyBAZ3JhbnQgICAgICAgICAgR01feG1saHR0cFJlcXVlc3QNCi8vIEBncmFudCAgICAgICAgICBHTV9nZXRSZXNvdXJjZVRleHQNCi8vIEBpY29uICAgICAgICAgICBodHRwOi8vZ20ud2VzbGV5LmV0aS5ici9pY29uLnBocD9kZXNjPTMyMDQxDQovLyBAcmVzb3VyY2UgICAgICAgaW5jbHVkZXMgaHR0cDovL3Bhc3RlYmluLmNvbS9kb3dubG9hZC5waHA/aT1lQXJBTlhkbQ0KLy8gQHJlc291cmNlICAgICAgIGkxOG4gaHR0cDovL3Bhc3RlYmluLmNvbS9kb3dubG9hZC5waHA/aT1VTHJWVHNTZw0KLy8gQHJlc291cmNlICAgICAgIG1ldGEgaHR0cHM6Ly91c2Vyc2NyaXB0cy1taXJyb3Iub3JnL3NjcmlwdHMvc291cmNlLzMyMDQxLm1ldGEuanMNCi8vIEByZXNvdXJjZSAgICAgICB1cGRhdGVyV2luZG93SHRtbCBodHRwOi8vcGFzdGViaW4uY29tL2Rvd25sb2FkLnBocD9pPTNncjl0UkFUDQovLyBAcmVzb3VyY2UgICAgICAgdXBkYXRlcldpbmRvd0NzcyBodHRwOi8vcGFzdGViaW4uY29tL2Rvd25sb2FkLnBocD9pPUMxcUF2QWVkDQovLyBAcmVzb3VyY2UgICAgICAgd2luQ29uZmlnQ3NzIGh0dHA6Ly9wYXN0ZWJpbi5jb20vZG93bmxvYWQucGhwP2k9TGRrNEo0YmkNCi8vIEByZXF1aXJlICAgICAgICBodHRwczovL3VzZXJzY3JpcHRzLW1pcnJvci5vcmcvc2NyaXB0cy9zb3VyY2UvNjM4MDgudXNlci5qcw0KLy8gQHJlcXVpcmUgICAgICAgIGh0dHBzOi8vdXNlcnNjcmlwdHMtbWlycm9yLm9yZy9zY3JpcHRzL3NvdXJjZS81NjQ4OS51c2VyLmpzDQovLyBAcmVxdWlyZSAgICAgICAgaHR0cHM6Ly91c2Vyc2NyaXB0cy1taXJyb3Iub3JnL3NjcmlwdHMvc291cmNlLzg1NjE4LnVzZXIuanMNCi8vIEByZXF1aXJlICAgICAgICBodHRwczovL3VzZXJzY3JpcHRzLW1pcnJvci5vcmcvc2NyaXB0cy9zb3VyY2UvODc5NDAudXNlci5qcw0KLy8gQHJlcXVpcmUgICAgICAgIGh0dHBzOi8vdXNlcnNjcmlwdHMtbWlycm9yLm9yZy9zY3JpcHRzL3NvdXJjZS84Nzk0Mi51c2VyLmpzDQovLyBAcmVxdWlyZSAgICAgICAgaHR0cHM6Ly91c2Vyc2NyaXB0cy1taXJyb3Iub3JnL3NjcmlwdHMvc291cmNlLzE2MzM3NC51c2VyLmpzDQovLyBAcmVxdWlyZSAgICAgICAgaHR0cDovL3Bhc3RlYmluLmNvbS9kb3dubG9hZC5waHA/aT1QNlZUQlJSSw0KLy8gQGhpc3RvcnkgICAgICAgIDUuMS4xIFVwZGF0ZWQgc29tZSBkYWlsaWVzDQovLyBAaGlzdG9yeSAgICAgICAgNS4xLjAgVXBkYXRlZCA8YSBocmVmPSJodHRwczovL3VzZXJzY3JpcHRzLW1pcnJvci5vcmcvc2NyaXB0cy9zaG93LzE2MzM3NCI+SW5jbHVkZXMgOiBXaW5Db25maWc8L2E+DQovLyBAaGlzdG9yeSAgICAgICAgNS4wLjAgQWRkZWQgPGEgaHJlZj0iaHR0cHM6Ly91c2Vyc2NyaXB0cy1taXJyb3Iub3JnL3NjcmlwdHMvc2hvdy8xNjMzNzQiPkluY2x1ZGVzIDogV2luQ29uZmlnPC9hPg0KLy8gQGhpc3RvcnkgICAgICAgIDQuMS4wIEFkZGVkIDxhIGhyZWY9Imh0dHA6Ly93d3cubmVvcGV0cy5jb20vbW9vbi9tZXRlb3IucGh0bWwiPk1ldGVvcnMgb2YgS3JlbHVkb3I8L2E+DQovLyBAaGlzdG9yeSAgICAgICAgNC4wLjAgQWRkZWQgPGEgaHJlZj0iaHR0cHM6Ly91c2Vyc2NyaXB0cy1taXJyb3Iub3JnL2d1aWRlcy83NzMiPkluY2x1ZGVzIENoZWNrZXI8L2E+DQovLyBAaGlzdG9yeSAgICAgICAgMy4wLjAuMCBVcGRhdGVkIEByZXF1aXJlIzg3OTQyDQovLyA9PS9Vc2VyU2NyaXB0PT0NCg0KLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQoNCiAgICBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQ0KICAgIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5DQogICAgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3INCiAgICAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLg0KDQogICAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsDQogICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YNCiAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlDQogICAgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4NCg0KICAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlDQogICAgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uDQoNCioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KDQooZnVuY3Rpb24gKCkgewkvLyBzY3JpcHQgc2NvcGUNCgl2YXIgZGFpbGllc0ZpZWxkID0gew0KCQkiL2JhbmsucGh0bWwiCQkJCQkJCTogWzAsIFtbIi4vL2Zvcm1baW5wdXRbQG5hbWUgPSAndHlwZScgYW5kIEB2YWx1ZSA9ICdpbnRlcmVzdCddXSJdXV0sDQoJCSIvamVsbHkvamVsbHkucGh0bWwiCQkJCQk6IFsxLCBbWyIuLy9mb3JtW2lucHV0W0BuYW1lID0gJ3R5cGUnIGFuZCBAdmFsdWUgPSAnZ2V0X2plbGx5J11dIl1dXSwNCgkJIi93YXRlci9maXNoaW5nLnBodG1sIgkJCQkJOiBbMiwgW1siLi8vZm9ybVtpbnB1dFtAbmFtZSA9ICdnb19maXNoJyBhbmQgQHZhbHVlID0gJzEnXV0iXV1dLA0KCQkiL2Rlc2VydC9zaHJpbmUucGh0bWwiCQkJCQk6IFszLCBbWyIuLy9mb3JtW2lucHV0W0BuYW1lID0gJ3R5cGUnIGFuZCBAdmFsdWUgPSAnYXBwcm9hY2gnXV0iXV1dLA0KCQkiL21vb24vbWV0ZW9yLnBodG1sIgkJCQkJOiBbNCwgW1siLi8vZm9ybVtAbmFtZSA9ICdtZXRlb3JzZWxlY3QnXS9zZWxlY3RbQG5hbWUgPSAncGlja3N0ZXAnXSIsIGZ1bmN0aW9uICh2KSB7DQoJCQl2LnNlbGVjdGVkSW5kZXggPSAxOw0KCQkJdi5mb3JtLnN1Ym1pdCgpOw0KCQl9XSwgWyIuLy9mb3JtW2lucHV0W0BuYW1lID0gJ2dldGNsb3NlJyBhbmQgQHZhbHVlID0gJzEnXV0iXV1dLA0KCQkiL2lzbGFuZC90b21ib2xhLnBodG1sIgkJCQkJOiBbNSwgW1siLi8vdGRbQGNsYXNzID0gJ2NvbnRlbnQnXS8vY2VudGVyL2Zvcm1bY29udGFpbnMoQGFjdGlvbiwgJ3RvbWJvbGEyLnBodG1sJyldIl1dXSwNCgkJIi9hbHRhZG9yL2NvdW5jaWwucGh0bWwiCQkJCTogWzYsIFtbIi4vL2FyZWFbY29udGFpbnMoQGhyZWYsICdjb3VuY2lsLnBodG1sP3ByaHY9JyldIiwgZnVuY3Rpb24gKHYpIHsNCgkJCXYuY2xpY2soKTsNCgkJfV0sIFsiLi8vZm9ybVtpbnB1dFtAbmFtZSA9ICdjb2xsZWN0JyBhbmQgQHZhbHVlID0gJzEnXV0iXV1dLA0KCQkiL3BldHBldHBhcmsvZGFpbHkucGh0bWwiCQkJCTogWzcsIFtbIi4vL2Zvcm1baW5wdXRbQG5hbWUgPSAnZ28nXSBhbmQgY29udGFpbnMoQGFjdGlvbiwgJy9wZXRwZXRwYXJrL2RhaWx5LnBodG1sJyldIl1dXSwNCgkJIi93b3JsZHMvZGVhZGx5ZGljZS5waHRtbCIJCQkJOiBbOCwgW1siLi8vZm9ybVtpbnB1dFtAbmFtZSA9ICdnbycgYW5kIEB2YWx1ZSA9ICcxJ11dIl1dXSwNCgkJIi9mYWVyaWVsYW5kL3NwcmluZ3MucGh0bWwiCQkJCTogWzksIFtbIi4vL2Zvcm1baW5wdXRbQG5hbWUgPSAndHlwZScgYW5kIEB2YWx1ZSA9ICdoZWFsJ11dIl1dXSwNCgkJIi9zcGFjZS9zdHJhbmdlbGV2ZXIucGh0bWwiCQkJCTogWzEwLCBbWyIuLy90ZFtAY2xhc3MgPSAnY29udGVudCddLy9mb3JtW2NvbnRhaW5zKEBhY3Rpb24sICdsZXZlcm9mZG9vbS5waHRtbCcpIGFuZCBpbnB1dFtAbmFtZSA9ICdfcmVmX2NrJ11dIl1dXSwNCgkJIi9kZXNlcnQvZnJ1aXQvaW5kZXgucGh0bWwiCQkJCTogWzExLCBbWyIuLy9mb3JtW2lucHV0W0BuYW1lID0gJ3NwaW4nIGFuZCBAdmFsdWUgPSAnMSddXSJdXV0sDQoJCSIvZmFlcmllbGFuZC90ZG1iZ3BvcC5waHRtbCIJCQk6IFsxMiwgW1siLi8vZm9ybVtpbnB1dFtAbmFtZSA9ICd0YWxrdG8nIGFuZCBAdmFsdWUgPSAnMSddXSJdXV0sDQoJCSIvcHJlaGlzdG9yaWMvb21lbGV0dGUucGh0bWwiCQkJOiBbMTMsIFtbIi4vL2Zvcm1baW5wdXRbQG5hbWUgPSAndHlwZScgYW5kIEB2YWx1ZSA9ICdnZXRfb21lbGV0dGUnXV0iXV1dLA0KCQkiL21lZGlldmFsL3BpY2t5b3Vyb3duLnBodG1sIgkJCTogWzE0LCBbWyIuLy9iL2NlbnRlci9mb3JtW2NvbnRhaW5zKEBhY3Rpb24sICdwcm9jZXNzX3BpY2t5b3Vyb3duLnBodG1sJykgYW5kIGlucHV0W0BuYW1lID0gJ3hfY29sbGVjdCcgYW5kIEB2YWx1ZSA9ICcxJ11dIl1dXSwNCgkJIi9tZWRpZXZhbC9waWNreW91cm93bl9pbmRleC5waHRtbCIJCTogWzE0LCBbWyIuLy9mb3JtW2NvbnRhaW5zKEBhY3Rpb24sICdwcm9jZXNzX3BpY2t5b3Vyb3duLnBodG1sJykgYW5kIGlucHV0W0BuYW1lID0gJ3hfc3RhcnQnIGFuZCBAdmFsdWUgPSAnMSddXSJdXV0sDQoJCSIvd29ybGRzL2dlcmFwdGlrdS90b21iLnBodG1sIgkJCTogWzE1LCBbWyIuLy9mb3JtW2lucHV0W0BuYW1lID0gJ29wZW5lZCcgYW5kIEB2YWx1ZSA9ICcxJ11dIl0sIFsiLi8vZm9ybVtjb250YWlucyhAYWN0aW9uLCAnL2dlcmFwdGlrdS9wcm9jZXNzX3RvbWIucGh0bWwnKSBhbmQgaW5wdXRbQHR5cGUgPSAnc3VibWl0J11dIl1dXSwNCgkJIi9mYWVyaWVsYW5kL2NhdmVybnMvaW5kZXgucGh0bWwiCQk6IFsxNiwgW1tmdW5jdGlvbiAoKSB7DQoJCQlyZXR1cm4gIi4vL2Zvcm0vaW5wdXRbQG5hbWUgPSAnZ28iICsgKE1hdGgucmFuZG9tKCkgPiAwLjg1ID8gIlJpZ2h0IiA6ICJMZWZ0IikgKyAiJ10iOw0KCQl9LCBmdW5jdGlvbiAodikgew0KCQkJdi5jbGljaygpOw0KCQl9XSwgWyIuLy9mb3JtW2lucHV0W0BuYW1lID0gJ3BsYXknIGFuZCBAdmFsdWUgPSAnMSddXSJdXV0sDQoJCSIvcGlyYXRlcy9idXJpZWR0cmVhc3VyZS9pbmRleC5waHRtbCIJOiBbMTcsIFtbIi4vL3RkW0BjbGFzcyA9ICdjb250ZW50J10vL2Zvcm1bY29udGFpbnMoQGFjdGlvbiwgJ2J1cmllZHRyZWFzdXJlLnBodG1sJykgYW5kIEBtZXRob2QgPSAnZ2V0J10iXV1dLA0KCQkiL3BpcmF0ZXMvYW5jaG9ybWFuYWdlbWVudC5waHRtbCIJCTogWzE4LCBbWyJpZCgnZm9ybS1maXJlLWNhbm5vbicpIl1dXSwNCgkJIi9waXJhdGVzL2ZvcmdvdHRlbnNob3JlLnBodG1sIgkJCTogWzE5LCBbWyIuLy9hW2NvbnRhaW5zKEBocmVmLCAnP2NvbmZpcm09MSZfcmVmX2NrPScpXSIsIGZ1bmN0aW9uIChhKSB7DQoJCQlhLmNsaWNrKCk7DQoJCX1dXV0sDQoJfTsNCg0KCWlmIChsb2NhdGlvbi5wYXRobmFtZSBpbiBkYWlsaWVzRmllbGQpIHsNCgkJR01fYWRkU3R5bGUoIi53aW5jb25maWcud2luQ29uZmlnX0RhaWxpZXNUb0RvU2V0dGluZ3MgLmZpZWxkLmZpZWxkTmFtZV9hY3RpdmF0ZSAuc3ViZmllbGQgPiBsYWJlbCB7d2lkdGg6NzUlfSIpOw0KDQoJCXZhciBncm91cHMgPSBbCS8vIERPTidUIGNoYW5nZSB0aGUgb3JkZXIgb2YgdGhlIGVsZW1lbnRzDQoJCQkvLyBkZWZhdWx0DQoJCQl1bmRlZmluZWQsCQkJLy8gMA0KDQoJCQkvLyB0ZWFtcw0KCQkJIkFsdGFkb3IiLA0KCQkJIkJyaWdodHZhbGUiLA0KCQkJIkRhcmlnYW4gQ2l0YWRlbCIsDQoJCQkiRmFlcmllbGFuZCIsDQoJCQkiSGF1bnRlZCBXb29kcyIsCS8vIDUNCgkJCSJLcmVsdWRvciIsDQoJCQkiS3Jhd2sgSXNsYW5kIiwNCgkJCSJTaGVua3V1IiwNCgkJCSJMb3N0IERlc2VydCIsDQoJCQkiTWFyYXF1YSIsCQkJLy8gMTANCgkJCSJNZXJpZGVsbCIsDQoJCQkiTXlzdGVyeSBJc2xhbmQiLA0KCQkJIlJvbyBJc2xhbmQiLA0KCQkJIlRlcnJvciBNb3VudGFpbiIsDQoJCQkiVHlyYW5uaWEiLAkJCS8vIDE1DQoJCQkiVmlydHVwZXRzIiwNCgkJCSJLaWtvIExha2UiLA0KCQkJIk1vbHRhcmEiLA0KDQoJCQkvLyBvdGhlcnMNCgkJCSJOZW9waWEgQ2VudHJhbCIsDQoJCQkiT3RoZXJzIiwNCgkJXSwNCgkJZGFpbGllcyA9IFsJLy8gRE9OJ1QgY2hhbmdlIHRoZSBvcmRlciBvZiB0aGUgZWxlbWVudHMNCgkJCVsyMCwgIkJhbmsiLCAiVGhlIE5hdGlvbmFsIE5lb3BpYW4gQmFuayAiXSwJLy8gMTkNCgkJCVsyMCwgIkdpYW50IEplbGx5Il0sDQoJCQlbMjAsICJVbmRlcndhdGVyIEZpc2hpbmciXSwJLy8gMTANCgkJCVs5LCAiQ29sdHphbidzIFNocmluZSJdLA0KCQkJWzIwLCAiTWV0ZW9ycyIsICJNZXRlb3JzIG9mIEtyZWx1ZG9yIl0sCS8vIDYNCgkJCVsxMiwgIlRvbWJvbGEiLCAiVGlraSBUYWNrIFRvbWJvbGEiXSwNCgkJCVsyMCwgIkNvdW5jaWwiLCAiQ291bmNpbCBDaGFtYmVyIl0sCS8vIDENCgkJCVsyMCwgIlRveUNoZXN0IiwgIldlbHRydWRlJ3MgVG95Q2hlc3QiXSwNCgkJCVsyMCwgIkRlYWRseSBEaWNlIiwgIkNvdW50IHZvbiBSb28ncyBEZWFkbHkgRGljZSJdLAkvLyAxMw0KCQkJWzQsICJIZWFsaW5nIFNwcmluZ3MiXSwNCgkJCVsyMCwgIkxldmVyIG9mIERvb20iXSwJLy8gMTYNCgkJCVs5LCAiRnJ1aXQgTWFjaGluZSIsICJUaGUgTmVvcGV0cyBGcnVpdCBNYWNoaW5lIl0sDQoJCQlbNCwgIkdydW5kbyBQbHVzaGllIiwgIlRoZSBEaXNjYXJkZWQgTWFnaWNhbCBCbHVlIEdydW5kbyBQbHVzaGllIG9mIFByb3NwZXJpdHkiXSwNCgkJCVsyMCwgIkdpYW50IE9tZWxldHRlIl0sIC8vIDE1DQoJCQlbMjAsICJQaWNrIFlvdXIgT3duIl0sCS8vIDExDQoJCQlbMTIsICJEZXNlcnRlZCBUb21iIl0sDQoJCQlbMjAsICJGYWVyaWUgQ2F2ZXJucyJdLAkvLyA0DQoJCQlbNywgIkJ1cmllZCBUcmVhc3VyZSJdLA0KCQkJWzcsICJBbmNob3IgTWFuYWdlbWVudCJdLA0KCQkJWzcsICJGb3Jnb3R0ZW4gU2hvcmUiXSwNCg0KCQkJWzAsICJBdmF0YXIiLCAiRGFpbGllcyB0aGF0IG1heSBnaXZlIHlvdSBhdmF0YXIuIiwgMHhCNTUwRF0sCQkJLy8gMTAxMTAxMDEwMTAxMDAwMDExMDENCgkJCVswLCAiTlAgKyIsICJEYWlsaWVzIHRoYXQgbWF5IGdpdmUgeW91IG5lb3BvaW50cy4iLCAweEY5OEU5XSwJCQkvLyAxMTExMTAwMTEwMDAxMTEwMTAwMQ0KCQkJWzAsICJOUCAtIiwgIkRhaWxpZXMgdGhhdCB5b3UgbmVlZCB0byBzcGVuZCBzb21lIG5lb3BvaW50cy4iLCAweDM0NTAwXSwJLy8gMDAxMTAxMDAwMTAxMDAwMDAwMDANCgkJCVswLCAiSXRlbXMiLCAiRGFpbGllcyB0aGF0IG1heSBnaXZlIHlvdSBpdGVtcy4iLCAweEVGQUZFXSwJCQkJLy8gMTExMDExMTExMDEwMTExMTExMTANCgkJCVswLCAiU3RhdHMiLCAiRGFpbGllcyB0aGF0IG1heSBnaXZlIHlvdSBzdGF0cy4iLCAweDAwMTBDXSwJCQkJLy8gMDAwMDAwMDAwMDAxMDAwMDExMDANCgkJCVswLCAiU2VsZWN0IEFsbCIsICJTZWxlY3QgYWxsIG9wdGlvbnMiLCAweEZGRkZGXSwJCQkJCQkvLyAxMTExMTExMTExMTExMTExMTExMQ0KCQldLA0KCQlnS2V5cyA9IFtdLA0KCQlvcHRpb25zID0gW107DQoJCWZvciAodmFyIGkgaW4gZGFpbGllcykgew0KCQkJdmFyIGQgPSBkYWlsaWVzW2ldLA0KCQkJa2V5ID0gZ0tleXMuaW5kZXhPZihkWzBdKTsNCgkJCQ0KCQkJaWYgKH5rZXkpIHsNCgkJCQlvcHRpb25zW2tleV0uZGFpbGllcy5wdXNoKFtpLCBkXSk7DQoJCQl9IGVsc2Ugew0KCQkJCWdLZXlzLnB1c2goZFswXSk7DQoJCQkJb3B0aW9ucy5wdXNoKHsNCgkJCQkJZ3JvdXAJOiBncm91cHNbZFswXV0sDQoJCQkJCWRhaWxpZXMJOiBbW2ksIGRdXSwNCgkJCQl9KTsNCgkJCX0NCgkJfQ0KCQlvcHRpb25zLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsNCgkJCXJldHVybiAoYS5ncm91cCA+IGIuZ3JvdXA/MTotMSk7DQoJCX0pOw0KDQoJCXZhciB3aW4gPSBuZXcgV2luQ29uZmlnKHsNCgkJCXRpdGxlCTogIkRhaWxpZXMgVG8tRG8gOiBTZXR0aW5ncyIsDQoJCQl0eXBlCTogV2luQ29uZmlnLldpbmRvd1R5cGUuQ1VTVE9NLA0KCQkJc2l6ZQk6IFsiNTUwcHgiLCAwXSwNCgkJCWRlZmF1bHQJOiB7DQoJCQkJZ3JvdXAJOiB7DQoJCQkJCWFjdGl2YXRlCTogMHgxQ0JBRkYsDQoJCQkJfQ0KCQkJfSwNCgkJCWZpZWxkcwk6IFt7DQoJCQkJbmFtZQkJOiAic2V0dGluZ3NIb3RLZXkiLA0KCQkJCWxhYmVsCQk6IF9fKCJTZXR0aW5ncyBIb3RLZXkiKSwNCgkJCQlrZXkJCQk6ICJob3RrZXkiLA0KCQkJCWNhbGxiYWNrCTogZnVuY3Rpb24oZXZlbnQsIHdpbikgew0KCQkJCQl3aW4ub3BlbigpOw0KCQkJCX0sDQoJCQl9LCB7DQoJCQkJbmFtZQk6ICJncm91cCIsDQoJCQkJdHlwZQk6IFdpbkNvbmZpZy5GaWVsZFR5cGUuR1JPVVAsDQoJCQkJbm9ncm91cAk6IHRydWUsDQoJCQkJbGFiZWwJOiBfXygiRGFpbGllcyIpLA0KCQkJCWZpZWxkcwk6IG9wdGlvbnMubWFwKGZ1bmN0aW9uICh2YWx1ZSkgew0KCQkJCQlpZiAodmFsdWUuZGFpbGllc1swXVsxXVswXSkgew0KCQkJCQkJdmFsdWUuZGFpbGllcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7DQoJCQkJCQkJcmV0dXJuIChhWzFdWzFdID4gYlsxXVsxXT8xOi0xKTsNCgkJCQkJCX0pOw0KCQkJCQl9DQoNCgkJCQkJcmV0dXJuIHsNCgkJCQkJCXR5cGUJCTogV2luQ29uZmlnLkZpZWxkVHlwZS5DSEVDSywNCgkJCQkJCWZvcm1hdAkJOiBXaW5Db25maWcuRmllbGRGb3JtYXQuTlVNQkVSLA0KCQkJCQkJbXVsdGlwbGUJOiB0cnVlLA0KCQkJCQkJdW5pcXVlCQk6IHRydWUsDQoJCQkJCQluYW1lCQk6ICJhY3RpdmF0ZSIsDQoJCQkJCQlsYWJlbAkJOiB2YWx1ZS5ncm91cCwNCgkJCQkJCWVtcHR5CQk6IDB4MDAwMDAwLA0KCQkJCQkJdmFsdWUJCTogdmFsdWUuZGFpbGllcy5tYXAoZnVuY3Rpb24gKHZhbHVlKSB7DQoJCQkJCQkJcmV0dXJuIHsNCgkJCQkJCQkJdmFsdWUJCTogdmFsdWVbMV1bM10gfHwgTWF0aC5wb3coMiwgdmFsdWVbMF0pLA0KCQkJCQkJCQlsYWJlbAkJOiB2YWx1ZVsxXVsxXSwNCgkJCQkJCQkJaGVscAkJOiB0cnVlLA0KCQkJCQkJCQlkZXNjcmlwdGlvbgk6IHZhbHVlWzFdWzJdIHx8IHZhbHVlWzFdWzFdLA0KCQkJCQkJCX07DQoJCQkJCQl9KSwNCgkJCQkJfTsNCgkJCQl9KSwNCgkJCX1dLA0KCQl9KSwNCgkJb3B0cyA9IHdpbi5nZXQoImdyb3VwIik7DQoNCgkJaWYgKG9wdHMuYWN0aXZhdGUgJiBNYXRoLnBvdygyLCBkYWlsaWVzRmllbGRbbG9jYXRpb24ucGF0aG5hbWVdWzBdKSkgew0KCQkJYTpmb3IgZWFjaCAodmFyIGJ0biBpbiBkYWlsaWVzRmllbGRbbG9jYXRpb24ucGF0aG5hbWVdWzFdKSB7DQoJCQkJdmFyIGYgPSB4cGF0aChidG5bMF0gaW5zdGFuY2VvZiBGdW5jdGlvbj9idG5bMF0oKTpidG5bMF0pWzBdOw0KCQkJCWlmIChmKSB7DQoJCQkJCWlmIChidG5bMV0gaW5zdGFuY2VvZiBGdW5jdGlvbikgew0KCQkJCQkJYnRuWzFdKGYpOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJZi5zdWJtaXQoKTsNCgkJCQkJfQ0KCQkJCQlicmVhayBhOw0KCQkJCX0NCgkJCX0NCgkJfQ0KCX0NCn0oKSk7","resources":[],"requires":[{"meta":{"name":"63808.user.js","url":"https://userscripts-mirror.org/scripts/source/63808.user.js","ts":1696775833381,"mimetype":"text/javascript"},"source":"Ly8gPT1Vc2VyU2NyaXB0PT0NCi8vIEBuYW1lICAgICAgICAgICBJbmNsdWRlcyA6IFhQYXRoDQovLyBAbmFtZXNwYWNlICAgICAgaHR0cDovL2dtLndlc2xleS5ldGkuYnIvaW5jbHVkZXMNCi8vIEBkZXNjcmlwdGlvbiAgICB4cGF0aCBGdW5jdGlvbg0KLy8gQGF1dGhvciAgICAgICAgIHczNWwzeQ0KLy8gQGVtYWlsICAgICAgICAgIHczNWwzeUBicmFzbmV0Lm9yZw0KLy8gQGNvcHlyaWdodCAgICAgIDIwMDkrLCB3MzVsM3kgKGh0dHA6Ly9nbS53ZXNsZXkuZXRpLmJyKQ0KLy8gQGxpY2Vuc2UgICAgICAgIEdOVSBHUEwNCi8vIEBob21lcGFnZSAgICAgICBodHRwOi8vZ20ud2VzbGV5LmV0aS5icg0KLy8gQHZlcnNpb24gICAgICAgIDEuMC4wLjUNCi8vIEBsYW5ndWFnZSAgICAgICBlbg0KLy8gQGluY2x1ZGUgICAgICAgIG5vd2hlcmUNCi8vID09L1VzZXJTY3JpcHQ9PQ0KDQovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCg0KCUF1dGhvciAncyBOT1RFDQoNCiAgICBPcmlnaW5hbCBodHRwOi8vbG93cmVhbC5uZXQvYmxvZy8yMDA3LzExLzE3LzENCg0KKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQoNCiAgICBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQ0KICAgIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5DQogICAgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3INCiAgICAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLg0KDQogICAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsDQogICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YNCiAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlDQogICAgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4NCg0KICAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlDQogICAgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uDQoNCioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KDQpYUGF0aCA9IFhwYXRoID0geHBhdGggPSBmdW5jdGlvbigpDQp7DQoJdmFyIGEgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpLAkvLyBhcmdzDQoJZSA9IGFbMF0sCS8vIGV4cHJlc3Npb24NCgljID0gYVsxXSwJLy8gY29udGV4dA0KCXQgPSBhWzJdOwkvLyB0eXBlDQoJDQoJaWYgKHR5cGVvZiBjID09ICJmdW5jdGlvbiIpDQoJew0KCQl0ID0gYzsNCgkJYyA9IG51bGw7DQoJfQ0KCWlmICghYykNCgljID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50fHxkb2N1bWVudDsNCgl2YXIgZCA9IGMub3duZXJEb2N1bWVudCB8fCBjOw0KCWUgPSBkLmNyZWF0ZUV4cHJlc3Npb24oZSwgZnVuY3Rpb24ocCkNCgl7DQogICAgICAgCXZhciBvID0gZC5jcmVhdGVOU1Jlc29sdmVyKGMpLmxvb2t1cE5hbWVzcGFjZVVSSShwKTsNCg0KCQlpZiAobykNCgkJcmV0dXJuIG87DQoJCWVsc2Ugc3dpdGNoIChjLmNvbnRlbnRUeXBlKQ0KCQl7DQoJCQljYXNlICJ0ZXh0L3hodG1sIjoNCgkJCWNhc2UgImFwcGxpY2F0aW9uL3hodG1sK3htbCI6DQoJCQkJcmV0dXJuICJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIjsNCgkJCWRlZmF1bHQ6DQoJCQkJcmV0dXJuICIiOw0KCQl9DQoJfSk7DQoNCglzd2l0Y2ggKHQpDQoJew0KCQljYXNlIFN0cmluZzoNCgkJCXJldHVybiBlLmV2YWx1YXRlKGMsIFhQYXRoUmVzdWx0LlNUUklOR19UWVBFLCBudWxsKS5zdHJpbmdWYWx1ZTsNCgkJY2FzZSBOdW1iZXI6DQoJCQlyZXR1cm4gZS5ldmFsdWF0ZShjLCBYUGF0aFJlc3VsdC5OVU1CRVJfVFlQRSwgbnVsbCkubnVtYmVyVmFsdWU7DQoJCWNhc2UgQm9vbGVhbjoNCgkJCXJldHVybiBlLmV2YWx1YXRlKGMsIFhQYXRoUmVzdWx0LkJPT0xFQU5fVFlQRSwgbnVsbCkuYm9vbGVhblZhbHVlOw0KCQljYXNlIEFycmF5Og0KCQkJdmFyIHIgPSBlLmV2YWx1YXRlKGMsIFhQYXRoUmVzdWx0Lk9SREVSRURfTk9ERV9TTkFQU0hPVF9UWVBFLCBudWxsKSwNCgkJCW8gPSBbXTsNCg0KCQkJZm9yICggdmFyIGFpID0gMCAsIGF0ID0gci5zbmFwc2hvdExlbmd0aCA7IGFpIDwgYXQgOyArK2FpICkNCgkJCQlvLnB1c2goci5zbmFwc2hvdEl0ZW0oYWkpKTsNCg0KCQkJcmV0dXJuIG87DQoJCWNhc2UgdW5kZWZpbmVkOg0KCQkJdmFyIHIgPSBlLmV2YWx1YXRlKGMsIFhQYXRoUmVzdWx0LkFOWV9UWVBFLCBudWxsKTsNCgkJCXN3aXRjaCAoci5yZXN1bHRUeXBlKQ0KCQkJew0KCQkJCWNhc2UgWFBhdGhSZXN1bHQuU1RSSU5HX1RZUEU6DQoJCQkJCXJldHVybiByLnN0cmluZ1ZhbHVlOw0KCQkJCWNhc2UgWFBhdGhSZXN1bHQuTlVNQkVSX1RZUEU6DQoJCQkJCXJldHVybiByLm51bWJlclZhbHVlOw0KCQkJCWNhc2UgWFBhdGhSZXN1bHQuQk9PTEVBTl9UWVBFOg0KCQkJCQlyZXR1cm4gci5ib29sZWFuVmFsdWU7DQoJCQkJY2FzZSBYUGF0aFJlc3VsdC5VTk9SREVSRURfTk9ERV9JVEVSQVRPUl9UWVBFOg0KCQkJCQl2YXIgbyA9IFtdLCBpOw0KCQkJCQl3aGlsZSAoaSA9IHIuaXRlcmF0ZU5leHQoKSkNCgkJCQkJCW8ucHVzaChpKTsNCg0KCQkJCQlyZXR1cm4gbzsNCgkJCX0NCgkJCXJldHVybiBudWxsOw0KCQlkZWZhdWx0Og0KCQkJdGhyb3coVHlwZUVycm9yKCJ4cGF0aDogc3BlY2lmaWVkIHR5cGUgaXMgbm90IHZhbGlkIHR5cGUuIikpOw0KCX0NCn07"},{"meta":{"name":"56489.user.js","url":"https://userscripts-mirror.org/scripts/source/56489.user.js","ts":1696775833362,"mimetype":"text/javascript"},"source":"Ly8gPT1Vc2VyU2NyaXB0PT0NCi8vIEBuYW1lICAgICAgICAgICBJbmNsdWRlcyA6IEh0dHBSZXF1ZXN0DQovLyBAbmFtZXNwYWNlICAgICAgaHR0cDovL2dtLndlc2xleS5ldGkuYnIvaW5jbHVkZXMNCi8vIEBkZXNjcmlwdGlvbiAgICBIdHRwUmVxdWVzdCBGdW5jdGlvbg0KLy8gQGF1dGhvciAgICAgICAgIHczNWwzeQ0KLy8gQGVtYWlsICAgICAgICAgIHczNWwzeUBicmFzbmV0Lm9yZw0KLy8gQGNvcHlyaWdodCAgICAgIDIwMTErLCB3MzVsM3kgKGh0dHA6Ly9nbS53ZXNsZXkuZXRpLmJyKQ0KLy8gQGxpY2Vuc2UgICAgICAgIEdOVSBHUEwNCi8vIEBob21lcGFnZSAgICAgICBodHRwOi8vZ20ud2VzbGV5LmV0aS5ici9pbmNsdWRlcw0KLy8gQHZlcnNpb24gICAgICAgIDIuMC41LjENCi8vIEBsYW5ndWFnZSAgICAgICBlbg0KLy8gQGluY2x1ZGUgICAgICAgIG5vd2hlcmUNCi8vIEBleGNsdWRlICAgICAgICAqDQovLyBAY29udHJpYnV0b3IgICAgc2l6emxlbWN0d2l6emxlIChodHRwczovL3VzZXJzY3JpcHRzLW1pcnJvci5vcmcvZ3VpZGVzLzkpDQovLyBAY29udHJpYnV0b3IgICAgU2VuaWx0YWkgKGh0dHBzOi8vdXNlcnNjcmlwdHMtbWlycm9yLm9yZy90b3BpY3MvNDc2ODc/cGFnZT0yI3Bvc3RzLTI1NzY3NykNCi8vIEBjb250cmlidXRvciAgICBhbWVib2lkZSAoaHR0cHM6Ly91c2Vyc2NyaXB0cy1taXJyb3Iub3JnL3RvcGljcy84ODAyMSNwb3N0cy0zODQxNTUpDQovLyA9PS9Vc2VyU2NyaXB0PT0NCg0KLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQoNCiAgICBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQ0KICAgIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5DQogICAgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3INCiAgICAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLg0KDQogICAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsDQogICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YNCiAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlDQogICAgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4NCg0KICAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlDQogICAgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uDQoNCioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KDQpIdHRwUmVxdWVzdCA9IGZ1bmN0aW9uICgpIHt9Ow0KSHR0cFJlcXVlc3Qub3BlbiA9IGZ1bmN0aW9uIChwYXJhbXMpIHsNCglyZXR1cm4gbmV3IChmdW5jdGlvbiAocGFyYW1zKSB7DQoJCWlmICghL15odHRwcz86XC9cLy8udGVzdChwYXJhbXMudXJsKSkgew0KCQkJcGFyYW1zLnVybCA9ICJodHRwOi8vIiArIHBhcmFtcy51cmw7DQoJCX0NCg0KCQl0aGlzLm9wdGlvbnMgPSB7DQoJCQkibWV0aG9kIgkJOiBwYXJhbXMubWV0aG9kLnRvVXBwZXJDYXNlKCkgfHwgIkdFVCIsDQoJCQkidXJsIgkJCTogcGFyYW1zLnVybCwNCgkJCSJoZWFkZXJzIgkJOiB7ICJVc2VyLUFnZW50IiA6IHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50IH0sDQoJCQkic3luY2hyb25vdXMiCTogISFwYXJhbXMuc3luY2hyb25vdXMsDQoJCQkib25sb2FkIgkJOiBmdW5jdGlvbiAoZSkgew0KCQkJCXZhciBvYmogPSBwYXJhbXMucGFyYW1ldGVycyB8fCB7fTsNCg0KCQkJCW9iai5yZXNwb25zZSA9IHsNCgkJCQkJInJhdyIJOiBlLA0KCQkJCQkidGV4dCIJOiBlLnJlc3BvbnNlVGV4dCwNCgkJCQkJInhtbCIJOiBlLnJlc3BvbnNlWE1MDQoJCQkJfTsNCg0KCQkJCWlmICgvXkNvbnRlbnQtVHlwZTogKD86dGV4dHxhcHBsaWNhdGlvbilcLyg/OngtKT9qc29uL20udGVzdChlLnJlc3BvbnNlSGVhZGVycykpIHsNCgkJCQkJdHJ5IHsNCgkJCQkJCW9iai5yZXNwb25zZS5qc29uID0gKHR5cGVvZiBKU09OICE9ICJ1bmRlZmluZWQiICYmIHR5cGVvZiBKU09OLnBhcnNlID09ICJmdW5jdGlvbiIgPyBKU09OLnBhcnNlKGUucmVzcG9uc2VUZXh0KSA6IGV2YWwoIigiICsgZS5yZXNwb25zZVRleHQgKyAiKSIpICk7DQoJCQkJCX0gY2F0Y2ggKGUpIHsNCgkJCQkJCW9iai5yZXNwb25zZS5qc29uID0ge307DQoJCQkJCX0NCgkJCQl9DQoNCgkJCQlpZiAoIW9iai5yZXNwb25zZS54bWwpIHsNCgkJCQkJaWYgKC9eQ29udGVudC1UeXBlOiB0ZXh0XC94bWwvbS50ZXN0KGUucmVzcG9uc2VIZWFkZXJzKSkgew0KCQkJCQkJb2JqLnJlc3BvbnNlLnhtbCA9IG5ldyBET01QYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcoZS5yZXNwb25zZVRleHQsICJ0ZXh0L3htbCIpOw0KCQkJCQl9IGVsc2UgaWYgKC9eQ29udGVudC1UeXBlOiB0ZXh0XC9odG1sL20udGVzdChlLnJlc3BvbnNlSGVhZGVycykpIHsNCgkJCQkJCS8qdmFyIGR0ID0gZG9jdW1lbnQuaW1wbGVtZW50YXRpb24uY3JlYXRlRG9jdW1lbnRUeXBlKCJodG1sIiwgIi0vL1czQy8vRFREIEhUTUwgNC4wMSBUcmFuc2l0aW9uYWwvL0VOIiwgImh0dHA6Ly93d3cudzMub3JnL1RSL2h0bWw0L2xvb3NlLmR0ZCIpOw0KCQkJCQkJdmFyIGRvYyA9IGRvY3VtZW50LmltcGxlbWVudGF0aW9uLmNyZWF0ZURvY3VtZW50KG51bGwsIG51bGwsIGR0KTsNCg0KCQkJCQkJLy8gSSBoYXZlIHRvIGZpbmQgYSB3b3JrYXJvdW5kIGJlY2F1c2UgdGhpcyB0ZWNobmlxdWUgbWFrZSB0aGUgaHRtbCgqKS9oZWFkL2JvZHkgdGFncyBkaXNhcHBlYXIuICANCgkJCQkJCXZhciBodG1sID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaHRtbCIpOw0KCQkJCQkJaHRtbC5pbm5lckhUTUwgPSBlLnJlc3BvbnNlVGV4dDsNCgkJCQkJCWRvYy5hcHBlbmRDaGlsZChodG1sKTsqLw0KCQkJCQkJdmFyIGRvYyA9IGRvY3VtZW50LmltcGxlbWVudGF0aW9uLmNyZWF0ZUhUTUxEb2N1bWVudCgiIik7DQoJCQkJCQlkb2MuZG9jdW1lbnRFbGVtZW50LmlubmVySFRNTCA9IGUucmVzcG9uc2VUZXh0Ow0KDQoJCQkJCQlvYmoucmVzcG9uc2UueG1sID0gZG9jOw0KCQkJCQl9DQoJCQkJfQ0KDQoJCQkJaWYgKHR5cGVvZiBwYXJhbXMub25zdWNjZXNzID09ICJmdW5jdGlvbiIpIHsNCgkJCQkJcGFyYW1zLm9uc3VjY2VzcyhvYmopOw0KCQkJCX0NCgkJCX0NCgkJfTsNCgkJDQoJCWlmICgiaGVhZGVycyIgaW4gcGFyYW1zKSB7DQoJCQlmb3IgKHZhciBoZWFkZXIgaW4gcGFyYW1zLmhlYWRlcnMpIHsNCgkJCQl0aGlzLm9wdGlvbnMuaGVhZGVyc1toZWFkZXJdID0gcGFyYW1zLmhlYWRlcnNbaGVhZGVyXTsNCgkJCX0NCgkJfQ0KDQoJCXRoaXMuc2VuZCA9IGZ1bmN0aW9uIChjb250ZW50KSB7DQoJCQlpZiAoY29udGVudCkgew0KCQkJCWlmIChjb250ZW50IGluc3RhbmNlb2YgdW5zYWZlV2luZG93LkhUTUxDb2xsZWN0aW9uIHx8IGNvbnRlbnQgaW5zdGFuY2VvZiBIVE1MQ29sbGVjdGlvbikgew0KCQkJCQljb250ZW50ID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmFwcGx5KGNvbnRlbnQpOw0KCQkJCX0NCgkJCQkNCgkJCQl2YXIgZGF0YSA9IHt9Ow0KCQkJCWlmIChjb250ZW50IGluc3RhbmNlb2YgQXJyYXkpIHsNCgkJCQkJZm9yIGVhY2ggKHZhciBlIGluIGNvbnRlbnQpIHsNCgkJCQkJCWlmICghL14oPzpyYWRpb3xjaGVja2JveCkkL2kudGVzdChlLnR5cGUpIHx8IGUuY2hlY2tlZCkgew0KCQkJCQkJCWlmIChlLmNoZWNrZWQgJiYgL15jaGVja2JveCQvaS50ZXN0KGUudHlwZSkpIHsNCgkJCQkJCQkJaWYgKGUubmFtZSBpbiBkYXRhKSB7DQoJCQkJCQkJCQlkYXRhW2UubmFtZV0ucHVzaChlLnZhbHVlKTsNCgkJCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQkJCWRhdGFbZS5uYW1lXSA9IFtlLnZhbHVlXTsNCgkJCQkJCQkJfQ0KCQkJCQkJCX0gZWxzZSB7DQoJCQkJCQkJCWRhdGFbZS5uYW1lXSA9IGUudmFsdWU7DQoJCQkJCQkJfQ0KCQkJCQkJfQ0KCQkJCQl9DQoNCgkJCQkJY29udGVudCA9IGRhdGE7DQoJCQkJfQ0KDQoJCQkJaWYgKHR5cGVvZiBjb250ZW50ID09ICJvYmplY3QiKSB7DQoJCQkJCXZhciB4ID0gIiI7DQoJCQkJCWZvciAodmFyIGtleSBpbiBjb250ZW50KSB7DQoJCQkJCQlpZiAoY29udGVudFtrZXldIGluc3RhbmNlb2YgQXJyYXkpIHsNCgkJCQkJCQl2YXIga2V5YXJyID0ga2V5LnJlcGxhY2UoL15ccyt8XHMrJC9nLCAiIik7DQoJCQkJCQkJaWYgKCEvXFtcdypcXSQvLnRlc3Qoa2V5KSkNCgkJCQkJCQlrZXlhcnIgKz0gIltdIjsNCg0KCQkJCQkJCWZvciBlYWNoICh2YXIgdiBpbiBjb250ZW50W2tleV0pIHsNCgkJCQkJCQkJeCArPSAiJiIgKyBlbmNvZGVVUklDb21wb25lbnQoa2V5YXJyKSArICI9IiArIGVuY29kZVVSSUNvbXBvbmVudCh2KTsNCgkJCQkJCQl9DQoJCQkJCQl9IGVsc2Ugew0KCQkJCQkJCXggKz0gIiYiICsgZW5jb2RlVVJJQ29tcG9uZW50KGtleSkgKyAiPSIgKyBlbmNvZGVVUklDb21wb25lbnQoY29udGVudFtrZXldKTsNCgkJCQkJCX0NCgkJCQkJfQ0KDQoJCQkJCWNvbnRlbnQgPSB4LnN1YnN0cigxKTsNCg0KCQkJCQlpZiAoIlBPU1QiID09IHRoaXMub3B0aW9ucy5tZXRob2QpIHsNCgkJCQkJCXRoaXMub3B0aW9ucy5oZWFkZXJzWyJDb250ZW50LVR5cGUiXSA9ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiOw0KCQkJCQkJdGhpcy5vcHRpb25zLmRhdGEgPSBjb250ZW50Ow0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJdGhpcy5vcHRpb25zLnVybCArPSAoL1w/Ly50ZXN0KHRoaXMub3B0aW9ucy51cmwpID8gIiYiIDogIj8iKSArIGNvbnRlbnQ7DQoJCQkJCX0NCgkJCQl9IGVsc2Ugew0KCQkJCQl0aGlzLm9wdGlvbnMuZGF0YSA9IGNvbnRlbnQ7DQoJCQkJfQ0KCQkJfQ0KDQoJCQl0aGlzLnJlc3VsdCA9IEdNX3htbGh0dHBSZXF1ZXN0KHRoaXMub3B0aW9ucyk7DQoNCgkJCXJldHVybiB0aGlzOw0KCQl9DQoJfSkocGFyYW1zKTsNCn07"},{"meta":{"name":"85618.user.js","url":"https://userscripts-mirror.org/scripts/source/85618.user.js","ts":1696775833794,"mimetype":"text/javascript"},"source":"Ly8gPT1Vc2VyU2NyaXB0PT0NCi8vIEBuYW1lICAgICAgICAgICBJbmNsdWRlcyA6IFRyYW5zbGF0ZQ0KLy8gQG5hbWVzcGFjZSAgICAgIGh0dHA6Ly9nbS53ZXNsZXkuZXRpLmJyL2luY2x1ZGVzDQovLyBAZGVzY3JpcHRpb24gICAgVHJhbnNsYXRlIEZ1bmN0aW9uDQovLyBAYXV0aG9yICAgICAgICAgdzM1bDN5DQovLyBAZW1haWwgICAgICAgICAgdzM1bDN5QGJyYXNuZXQub3JnDQovLyBAY29weXJpZ2h0ICAgICAgMjAxMyssIHczNWwzeSAoaHR0cDovL2dtLndlc2xleS5ldGkuYnIpDQovLyBAbGljZW5zZSAgICAgICAgR05VIEdQTA0KLy8gQGhvbWVwYWdlICAgICAgIGh0dHA6Ly9nbS53ZXNsZXkuZXRpLmJyDQovLyBAdmVyc2lvbiAgICAgICAgMy4xLjENCi8vIEBsYW5ndWFnZSAgICAgICBlbg0KLy8gQGluY2x1ZGUgICAgICAgIG5vd2hlcmUNCi8vIEBncmFudCAgICAgICAgICBHTV94bWxodHRwUmVxdWVzdA0KLy8gQHJlcXVpcmUgICAgICAgIGh0dHBzOi8vdXNlcnNjcmlwdHMtbWlycm9yLm9yZy9zY3JpcHRzL3NvdXJjZS81NjQ4OS51c2VyLmpzDQovLyA9PS9Vc2VyU2NyaXB0PT0NCg0KLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQoNCiAgICBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQ0KICAgIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5DQogICAgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3INCiAgICAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLg0KDQogICAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsDQogICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YNCiAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlDQogICAgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4NCg0KICAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlDQogICAgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uDQoNCioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KDQp2YXIgVHJhbnNsYXRlID0gew0KCXZlcnNpb24JCTogMSwNCglrZXkJCQk6ICIiLA0KCWV4ZWN1dGUJCTogZnVuY3Rpb24gKHRleHQsIGZyb20sIHRvLCBjYikgew0KCQl2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5hcHBseShhcmd1bWVudHMpOw0KDQoJCWlmICghVHJhbnNsYXRlLmtleSkgew0KCQkJLy8gR29vZ2xlIFRyYW5zbGF0ZSBBUEkgKGRlcHJlY2F0ZWQpDQoJCQl2YXIgdiA9IGZ1bmN0aW9uIChmcm9tLCB0ZXh0Mikgew0KCQkJCXN3aXRjaCAoVHJhbnNsYXRlLnZlcnNpb24pIHsNCgkJCQkJY2FzZSAyOgkvLyB2Mg0KCQkJCQkJdmFyIHRleHRfYXJyID0gW107DQoJCQkJCQlpZiAodGV4dDIgaW5zdGFuY2VvZiBBcnJheSkgew0KCQkJCQkJCWZvciAodmFyIGluZGV4IGluIHRleHQyKSB7DQoJCQkJCQkJCXRleHRfYXJyLnB1c2goew0KCQkJCQkJCQkJInRyYW5zbGF0ZWRUZXh0IiA6IChmcm9tID09IHRvID8gdGV4dFtpbmRleF0gOiB0ZXh0MltpbmRleF0pDQoJCQkJCQkJCX0pOw0KCQkJCQkJCX0NCgkJCQkJCX0gZWxzZSB7DQoJCQkJCQkJdGV4dF9hcnIucHVzaCh7DQoJCQkJCQkJCSJ0cmFuc2xhdGVkVGV4dCIgOiAoZnJvbSA9PSB0byA/IHRleHQgOiB0ZXh0MikNCgkJCQkJCQl9KTsNCgkJCQkJCX0NCg0KCQkJCQkJcmV0dXJuIHsNCgkJCQkJCQkiZGF0YSIgOiB7ICJ0cmFuc2xhdGlvbnMiIDogdGV4dF9hcnIgfQ0KCQkJCQkJfTsNCgkJCQkJY2FzZSAxOgkvLyB2MQ0KCQkJCQkJcmV0dXJuIHsNCgkJCQkJCQkidHJhbnNsYXRpb24iIDogKGZyb20gPT0gdG8gPyB0ZXh0IDogdGV4dDIpLA0KCQkJCQkJfTsNCgkJCQkJZGVmYXVsdDoNCgkJCQkJCWJyZWFrOw0KCQkJCX0NCgkJCX07DQoNCgkJCWlmIChmcm9tID09IHRvKSB7DQoJCQkJY2Iodihmcm9tLCB0ZXh0KSwgYXJncyk7DQoJCQl9IGVsc2Ugew0KCQkJCUh0dHBSZXF1ZXN0Lm9wZW4oew0KCQkJCQkibWV0aG9kIiA6ICJHRVQiLA0KCQkJCQkidXJsIiA6ICJodHRwOi8vdHJhbnNsYXRlLmdvb2dsZS5jb20uYnIvdHJhbnNsYXRlX2EvdCIsDQoJCQkJCSJvbnN1Y2Nlc3MiIDogZnVuY3Rpb24gKHhocikgew0KCQkJCQkJdmFyIHIgPSBbW1siIl1dLCxmcm9tXTsNCg0KCQkJCQkJdHJ5IHsNCgkJCQkJCQlyID0geGhyLnJlc3BvbnNlLmpzb24gfHwgSlNPTi5wYXJzZSh4aHIucmVzcG9uc2UudGV4dC5yZXBsYWNlKC8sKD89LCkvZywgJyxudWxsJykpOw0KCQkJCQkJfSBjYXRjaCAoZSkgew0KCQkJCQkJCXIgPSBldmFsKHhoci5yZXNwb25zZS50ZXh0KTsNCgkJCQkJCX0NCg0KCQkJCQkJY2IodihyWzJdLCByWzBdWzBdWzBdKSwgYXJncyk7DQoJCQkJCX0NCgkJCQl9KS5zZW5kKHsNCgkJCQkJImNsaWVudCIJOiAidCIsDQoJCQkJCSJzbCIJCTogZnJvbSwNCgkJCQkJInRsIgkJOiB0bywNCgkJCQkJImllIgkJOiAiVVRGLTgiLA0KCQkJCQkib2UiCQk6ICJVVEYtOCIsDQoJCQkJCSJxIgkJCTogdGV4dCwNCgkJCQl9KTsNCgkJCX0NCgkJfSBlbHNlIGlmICghZnJvbSkgew0KCQkJVHJhbnNsYXRlLnRvKHRleHQsIHRvLCBjYik7DQoJCX0gZWxzZSB7DQoJCQlIdHRwUmVxdWVzdC5vcGVuKHsNCgkJCQkibWV0aG9kIiA6ICJQT1NUIiwNCgkJCQkidXJsIiA6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9sYW5ndWFnZS90cmFuc2xhdGUvdjIiLA0KCQkJCSJoZWFkZXJzIiA6IHsNCgkJCQkJIlgtSFRUUC1NZXRob2QtT3ZlcnJpZGUiIDogIkdFVCINCgkJCQl9LA0KCQkJCSJvbnN1Y2Nlc3MiIDogZnVuY3Rpb24gKHhocikgew0KCQkJCQljYih4aHIucmVzcG9uc2UuanNvbiwgYXJncyk7DQoJCQkJfQ0KCQkJfSkuc2VuZCh7DQoJCQkJImtleSIgOiBUcmFuc2xhdGUua2V5LA0KCQkJCSJzb3VyY2UiIDogZnJvbSwNCgkJCQkidGFyZ2V0IiA6IHRvLA0KCQkJCSJxIiA6IHRleHQNCgkJCX0pOw0KCQl9DQoJfSwNCgl0bwkJCTogZnVuY3Rpb24odGV4dCwgdG8sIGNiKSB7DQoJCWlmICghVHJhbnNsYXRlLmtleSkgew0KCQkJLy8gR29vZ2xlIFRyYW5zbGF0ZSBBUEkgKGRlcHJlY2F0ZWQpDQoJCQlUcmFuc2xhdGUuZXhlY3V0ZSh0ZXh0LCAiLSIsIHRvLCBjYik7DQoJCX0gZWxzZSB7DQoJCQlIdHRwUmVxdWVzdC5vcGVuKHsNCgkJCQkibWV0aG9kIiA6ICJQT1NUIiwNCgkJCQkidXJsIiA6ICJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9sYW5ndWFnZS90cmFuc2xhdGUvdjIvZGV0ZWN0IiwNCgkJCQkiaGVhZGVycyIgOiB7DQoJCQkJCSJYLUhUVFAtTWV0aG9kLU92ZXJyaWRlIiA6ICJHRVQiDQoJCQkJfSwNCgkJCQkib25zdWNjZXNzIiA6IGZ1bmN0aW9uICh4aHIpIHsNCgkJCQkJaWYgKC9eMi8udGVzdCh4aHIucmVzcG9uc2UucmF3LnN0YXR1cykpIHsNCgkJCQkJCWRhdGEuZGV0ZWN0aW9ucy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7DQoJCQkJCQkJcmV0dXJuIGEuY29uZmlkZW5jZSAtIGIuY29uZmlkZW5jZTsNCgkJCQkJCX0pOw0KDQoJCQkJCQlUcmFuc2xhdGUuZXhlY3V0ZSh0ZXh0LCBkYXRhLmRldGVjdGlvbnNbMF0ubGFuZ3VhZ2UsIHRvLCBjYik7DQoJCQkJCX0NCgkJCQl9DQoJCQl9KS5zZW5kKHsNCgkJCQkia2V5IiA6IFRyYW5zbGF0ZS5rZXksDQoJCQkJInEiIDogdGV4dA0KCQkJfSk7DQoJCX0NCgl9LA0KfTs="},{"meta":{"name":"87940.user.js","url":"https://userscripts-mirror.org/scripts/source/87940.user.js","ts":1696775833360,"mimetype":"text/javascript"},"source":"Ly8gPT1Vc2VyU2NyaXB0PT0NCi8vIEBuYW1lICAgICAgICAgICBJbmNsdWRlcyA6IEkxOG4NCi8vIEBuYW1lc3BhY2UgICAgICBodHRwOi8vZ20ud2VzbGV5LmV0aS5ici9pbmNsdWRlcw0KLy8gQGRlc2NyaXB0aW9uICAgIEkxOG4gRnVuY3Rpb24NCi8vIEBhdXRob3IgICAgICAgICB3MzVsM3kNCi8vIEBlbWFpbCAgICAgICAgICB3MzVsM3lAYnJhc25ldC5vcmcNCi8vIEBjb3B5cmlnaHQgICAgICAyMDExKywgdzM1bDN5IChodHRwOi8vZ20ud2VzbGV5LmV0aS5icikNCi8vIEBsaWNlbnNlICAgICAgICBHTlUgR1BMDQovLyBAaG9tZXBhZ2UgICAgICAgaHR0cDovL2dtLndlc2xleS5ldGkuYnINCi8vIEB2ZXJzaW9uICAgICAgICAzLjIuMQ0KLy8gQGxhbmd1YWdlICAgICAgIGVuDQovLyBAaW5jbHVkZSAgICAgICAgbm93aGVyZQ0KLy8gQGV4Y2x1ZGUgICAgICAgICoNCi8vIEBpY29uICAgICAgICAgICBodHRwOi8vZ20ud2VzbGV5LmV0aS5ici9pY29uLnBocD9kZXNjPTg3OTQwDQovLyBAZ3JhbnQgICAgICAgICAgR01fZ2V0VmFsdWUNCi8vIEBncmFudCAgICAgICAgICBHTV9zZXRWYWx1ZQ0KLy8gQGdyYW50ICAgICAgICAgIEdNX2RlbGV0ZVZhbHVlDQovLyBAZ3JhbnQgICAgICAgICAgR01feG1saHR0cFJlcXVlc3QNCi8vIEBncmFudCAgICAgICAgICBHTV9nZXRSZXNvdXJjZVRleHQNCi8vIEByZXNvdXJjZSAgICAgICBpMThuIGh0dHA6Ly9wYXN0ZWJpbi5jb20vZG93bmxvYWQucGhwP2k9VUxyVlRzU2cNCi8vIEByZXNvdXJjZSAgICAgICBtZXRhIGh0dHBzOi8vdXNlcnNjcmlwdHMtbWlycm9yLm9yZy9zY3JpcHRzL3NvdXJjZS84Nzk0MC5tZXRhLmpzDQovLyBAcmVxdWlyZSAgICAgICAgaHR0cHM6Ly91c2Vyc2NyaXB0cy1taXJyb3Iub3JnL3NjcmlwdHMvc291cmNlLzU2NDg5LnVzZXIuanMNCi8vIEByZXF1aXJlICAgICAgICBodHRwczovL3VzZXJzY3JpcHRzLW1pcnJvci5vcmcvc2NyaXB0cy9zb3VyY2UvODU2MTgudXNlci5qcw0KLy8gPT0vVXNlclNjcmlwdD09DQoNCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KDQogICAgVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkNCiAgICBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQ0KICAgIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yDQogICAgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4NCg0KICAgIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLA0KICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mDQogICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQ0KICAgIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuDQoNCiAgICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQ0KICAgIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+Lg0KDQoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCg0KdmFyIEkxOG4gPSB7DQoJZ2V0IGxvY2FsZSgpIHsNCgkJcmV0dXJuIEdNX2dldFZhbHVlKCJsb2NhbGUiLCBuYXZpZ2F0b3IubGFuZ3VhZ2UpIHx8ICIiOw0KCX0sDQoJc2V0IGxvY2FsZSh2YWx1ZSkgew0KCQlHTV9zZXRWYWx1ZSgibG9jYWxlIiwgdmFsdWUpOw0KCX0sDQoJZ2V0CTogZnVuY3Rpb24gKGl0ZW1fc3RyLCBpdGVtLCBvYmosIGNhbGxiYWNrKSB7DQoJCXZhciBzZWN0aW9uID0gSTE4bi5sb2NhbGUudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9bXy1dKy9nLCAiLSIpLnNwbGl0KCIsIikubWFwKGZ1bmN0aW9uICgkMCkgew0KCQkJcmV0dXJuICh+JDAuaW5kZXhPZigiLSIpID8gJDAuc3Vic3RyaW5nKDAsICQwLmluZGV4T2YoIi0iKSkgOiAkMCk7DQoJCX0pLA0KCQlpMThuID0gSlNPTi5wYXJzZShHTV9nZXRWYWx1ZSgiaTE4biIpIHx8ICd7InZlcnNpb24iIDogLTEsICJsYW5ndWFnZXMiIDoge319JyksDQoJCXJlcyA9IHsNCgkJCSJ2ZXJzaW9uIgk6IDAsDQoJCQkibGFuZ3VhZ2VzIgk6IHt9LA0KCQl9Ow0KCQkNCgkJaWYgKCEoImxhbmd1YWdlcyIgaW4gaTE4bikpIHsNCgkJCUdNX2RlbGV0ZVZhbHVlKCJpMThuIik7DQoJCQlpMThuID0gew0KCQkJCSJ2ZXJzaW9uIiA6IC0xLA0KCQkJCSJsYW5ndWFnZXMiIDoge30NCgkJCX07DQoJCX0NCg0KCQlpZiAodHlwZW9mIGl0ZW0gPT0gImZ1bmN0aW9uIikgew0KCQkJY2FsbGJhY2sgPSBpdGVtOw0KCQkJaXRlbSA9IG51bGw7DQoJCQlvYmogPSBudWxsOw0KCQl9IGVsc2UgaWYgKHR5cGVvZiBvYmogPT0gImZ1bmN0aW9uIikgew0KCQkJY2FsbGJhY2sgPSBvYmo7DQoJCQlvYmogPSBudWxsOw0KCQl9DQoNCgkJaWYgKGl0ZW0gaW5zdGFuY2VvZiBBcnJheSkgew0KCQkJb2JqID0gaXRlbTsNCgkJCWl0ZW0gPSBudWxsOw0KCQl9DQoNCgkJdmFyIGNiMiA9IGZ1bmN0aW9uIChzdHIpIHsNCgkJCXJldHVybiAob2JqID8gc3RyLnJlcGxhY2UoL1x7KFxkKylcfS9nLCBmdW5jdGlvbiAoJDAsICQxKSB7DQoJCQkJcmV0dXJuICgkMSBpbiBvYmogPyBvYmpbJDFdIDogJDApOw0KCQkJfSkgOiBzdHIpOw0KCQl9LA0KCQljYiA9IGZ1bmN0aW9uIChzdHIpIHsNCgkJCWlmIChjYWxsYmFjaykgew0KCQkJCWNhbGxiYWNrKHN0ciwgb2JqKTsNCgkJCX0NCg0KCQkJcmV0dXJuIGNiMihzdHIpOw0KCQl9Ow0KDQoJCWlmICghaXRlbSkgew0KCQkJaXRlbSA9IGl0ZW1fc3RyLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvW15cdTAxMDAtXHVmZmZmXHc/LC4tXSsvZywgIiIpOw0KDQoJCQlpZiAoaXRlbV9zdHIubGVuZ3RoICYmICFpdGVtKSB7DQoJCQkJaXRlbSA9IGl0ZW1fc3RyOw0KCQkJfQ0KCQl9DQoNCgkJLy8gRm9yIGNvbXBhdGliaWxpdHkgd2l0aCB2Mi4wLjEuMA0KCQl0cnkgew0KCQkJcmVzID0gSlNPTi5wYXJzZShHTV9nZXRSZXNvdXJjZVRleHQoImkxOG4iKS5yZXBsYWNlKC9eXCh8XCkkL2csICIiKSB8fCAie30iKTsNCgkJCQ0KCQkJaWYgKCEoImxhbmd1YWdlcyIgaW4gcmVzKSkgew0KCQkJCXJlcy52ZXJzaW9uID0gMDsNCgkJCQlyZXMubGFuZ3VhZ2VzID0gcmVzOw0KCQkJfQ0KCQl9IGNhdGNoIChlKSB7IH0NCg0KCQlpZiAoaTE4bi52ZXJzaW9uIDwgcmVzLnZlcnNpb24pIHsNCgkJCWkxOG4udmVyc2lvbiA9IHJlcy52ZXJzaW9uOw0KCQkJaTE4bi5sYW5ndWFnZXMgPSB7fTsNCgkJCUdNX3NldFZhbHVlKCJpMThuIiwgSlNPTi5zdHJpbmdpZnkoaTE4bikpOw0KCQl9DQoNCgkJaWYgKHNlY3Rpb24ubGVuZ3RoKSB7DQoJCQlmb3IgZWFjaCAodmFyIGxhbmcgaW4gc2VjdGlvbikgew0KCQkJCWlmIChsYW5nIGluIHJlcy5sYW5ndWFnZXMgJiYgaXRlbSBpbiByZXMubGFuZ3VhZ2VzW2xhbmddKSB7DQoJCQkJCXJldHVybiBjYihyZXMubGFuZ3VhZ2VzW2xhbmddW2l0ZW1dKTsNCgkJCQl9IGVsc2UgaWYgKGxhbmcgaW4gaTE4bi5sYW5ndWFnZXMgJiYgaXRlbSBpbiBpMThuLmxhbmd1YWdlc1tsYW5nXSkgew0KCQkJCQlyZXR1cm4gY2IoaTE4bi5sYW5ndWFnZXNbbGFuZ11baXRlbV0pOw0KCQkJCX0NCgkJCX0NCg0KCQkJdmFyIGRlZiA9IHJlc1siZGVmYXVsdCJdIHx8ICJlbiIsDQoJCQltZXRhID0gdHlwZW9mIEdNX2luZm8gIT0gInVuZGVmaW5lZCIgJiYgR01faW5mby5zY3JpcHRNZXRhU3RyIHx8ICIiOw0KCQkJDQoJCQl0cnkgew0KCQkJCW1ldGEgPSBHTV9nZXRSZXNvdXJjZVRleHQoIm1ldGEiKTsNCgkJCX0gY2F0Y2ggKGUpIHsgfQ0KDQoJCQltZXRhICs9ICJcbi8vIEBsYW5ndWFnZSAiICsgZGVmOw0KCQkJDQoJCQl2YXIgbWV0YUxhbmcgPSAvXlwvXC8gQGxhbmd1YWdlXHMrKFx3KykvbS50ZXN0KG1ldGEpICYmIFJlZ0V4cC4kMSwNCgkJCXRyYW5zbGF0ZSA9IGZ1bmN0aW9uICh0ZXh0LCBmcm9tLCB0bywgaXRlbSkgew0KCQkJCVRyYW5zbGF0ZS5leGVjdXRlKHRleHQucmVwbGFjZSgvXG4vZywgIjxiciAvPiIpLCBmcm9tLCB0bywgZnVuY3Rpb24gKHJlc3VsdCkgew0KCQkJCQlpZiAocmVzdWx0LnRyYW5zbGF0aW9uKSB7DQoJCQkJCQl2YXIgZGF0YSA9IEpTT04ucGFyc2UoR01fZ2V0VmFsdWUoImkxOG4iKSB8fCAneyJ2ZXJzaW9uIjowLCJsYW5ndWFnZXMiOnt9fScpOw0KDQoJCQkJCQlpZiAoISh0byBpbiBkYXRhLmxhbmd1YWdlcykpIHsNCgkJCQkJCQlkYXRhLmxhbmd1YWdlc1t0b10gPSB7fTsNCgkJCQkJCX0NCg0KCQkJCQkJZGF0YS5sYW5ndWFnZXNbdG9dW2l0ZW1dID0gcmVzdWx0LnRyYW5zbGF0aW9uLnJlcGxhY2UoL1xzKjxiclxzKlwvPz5ccyovZywgIlxuIik7DQoJCQkJCQkNCgkJCQkJCUdNX3NldFZhbHVlKCJpMThuIiwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpOw0KCQkJCQkJDQoJCQkJCQlyZXR1cm4gY2IoZGF0YS5sYW5ndWFnZXNbdG9dW2l0ZW1dKTsNCgkJCQkJfQ0KCQkJCX0pOw0KCQkJfTsNCg0KCQkJZm9yICh2YXIga2V5IGluIHNlY3Rpb24pIHsNCgkJCQlpZiAoZGVmIGluIHJlcy5sYW5ndWFnZXMgJiYgaXRlbSBpbiByZXMubGFuZ3VhZ2VzW2RlZl0gJiYgcmVzLmxhbmd1YWdlc1tkZWZdW2l0ZW1dICE9IG51bGwpIHsNCgkJCQkJdHJhbnNsYXRlKHJlcy5sYW5ndWFnZXNbZGVmXVtpdGVtXSwgZGVmLCBzZWN0aW9uW2tleV0sIGl0ZW0pOw0KDQoJCQkJCXJldHVybiBjYjIocmVzLmxhbmd1YWdlc1tkZWZdW2l0ZW1dKTsNCgkJCQl9DQoNCgkJCQlmb3IgKHZhciBsYW5nIGluIHJlcy5sYW5ndWFnZXMpIHsNCgkJCQkJaWYgKGxhbmcgIT0gZGVmICYmIGl0ZW0gaW4gcmVzLmxhbmd1YWdlc1tsYW5nXSAmJiByZXMubGFuZ3VhZ2VzW2xhbmddW2l0ZW1dICE9IG51bGwpIHsNCgkJCQkJCXRyYW5zbGF0ZShyZXMubGFuZ3VhZ2VzW2xhbmddW2l0ZW1dLCBsYW5nLCBzZWN0aW9uW2tleV0sIGl0ZW0pOw0KDQoJCQkJCQlyZXR1cm4gY2IyKHJlcy5sYW5ndWFnZXNbbGFuZ11baXRlbV0pOw0KCQkJCQl9DQoJCQkJfQ0KDQoJCQkJaWYgKG1ldGFMYW5nICE9IHNlY3Rpb25ba2V5XSkgew0KCQkJCQl0cmFuc2xhdGUoaXRlbV9zdHIsIG1ldGFMYW5nLCBzZWN0aW9uW2tleV0sIGl0ZW0pOw0KDQoJCQkJCXJldHVybiBjYjIoaXRlbV9zdHIpOw0KCQkJCX0NCgkJCX0NCgkJfQ0KDQoJCXJldHVybiBjYihpdGVtX3N0cik7DQoJfSwNCn07DQoNCmZ1bmN0aW9uIF9fICgpIHsNCglyZXR1cm4gSTE4bi5nZXQuYXBwbHkoSTE4biwgQXJyYXkucHJvdG90eXBlLnNsaWNlLmFwcGx5KGFyZ3VtZW50cykpOw0KfQ=="},{"meta":{"name":"87942.user.js","url":"https://userscripts-mirror.org/scripts/source/87942.user.js","ts":1696775833636,"mimetype":"text/javascript"},"source":"Ly8gPT1Vc2VyU2NyaXB0PT0NCi8vIEBuYW1lICAgICAgICAgICBJbmNsdWRlcyA6IFVwZGF0ZXINCi8vIEBuYW1lc3BhY2UgICAgICBodHRwOi8vZ20ud2VzbGV5LmV0aS5ici9pbmNsdWRlcw0KLy8gQGRlc2NyaXB0aW9uICAgIFVwZGF0ZXIgRnVuY3Rpb24NCi8vIEBhdXRob3IgICAgICAgICB3MzVsM3kNCi8vIEBlbWFpbCAgICAgICAgICB3MzVsM3lAYnJhc25ldC5vcmcNCi8vIEBjb3B5cmlnaHQgICAgICAyMDEzKywgdzM1bDN5IChodHRwOi8vZ20ud2VzbGV5LmV0aS5icikNCi8vIEBsaWNlbnNlICAgICAgICBHTlUgR1BMDQovLyBAaG9tZXBhZ2UgICAgICAgaHR0cDovL2dtLndlc2xleS5ldGkuYnINCi8vIEB2ZXJzaW9uICAgICAgICAxLjIuMw0KLy8gQGxhbmd1YWdlICAgICAgIGVuDQovLyBAaW5jbHVkZSAgICAgICAgbm93aGVyZQ0KLy8gQGV4Y2x1ZGUgICAgICAgICoNCi8vIEBpY29uICAgICAgICAgICBodHRwOi8vZ20ud2VzbGV5LmV0aS5ici9pY29uLnBocD9kZXNjPTg3OTQyDQovLyBAZ3JhbnQgICAgICAgICAgR01fYWRkU3R5bGUNCi8vIEBncmFudCAgICAgICAgICBHTV9nZXRWYWx1ZQ0KLy8gQGdyYW50ICAgICAgICAgIEdNX3NldFZhbHVlDQovLyBAZ3JhbnQgICAgICAgICAgR01fZGVsZXRlVmFsdWUNCi8vIEBncmFudCAgICAgICAgICBHTV94bWxodHRwUmVxdWVzdA0KLy8gQGdyYW50ICAgICAgICAgIEdNX2dldFJlc291cmNlVGV4dA0KLy8gQHJlc291cmNlICAgICAgIG1ldGEgaHR0cHM6Ly91c2Vyc2NyaXB0cy1taXJyb3Iub3JnL3NjcmlwdHMvc291cmNlLzg3OTQyLm1ldGEuanMNCi8vIEByZXNvdXJjZSAgICAgICBpMThuIGh0dHA6Ly9wYXN0ZWJpbi5jb20vZG93bmxvYWQucGhwP2k9VUxyVlRzU2cNCi8vIEByZXNvdXJjZSAgICAgICB1cGRhdGVyV2luZG93SHRtbCBodHRwOi8vcGFzdGViaW4uY29tL2Rvd25sb2FkLnBocD9pPTNncjl0UkFUDQovLyBAcmVzb3VyY2UgICAgICAgdXBkYXRlcldpbmRvd0NzcyBodHRwOi8vcGFzdGViaW4uY29tL2Rvd25sb2FkLnBocD9pPUMxcUF2QWVkDQovLyBAcmVxdWlyZSAgICAgICAgaHR0cHM6Ly91c2Vyc2NyaXB0cy1taXJyb3Iub3JnL3NjcmlwdHMvc291cmNlLzYzODA4LnVzZXIuanMNCi8vIEByZXF1aXJlICAgICAgICBodHRwczovL3VzZXJzY3JpcHRzLW1pcnJvci5vcmcvc2NyaXB0cy9zb3VyY2UvNTY0ODkudXNlci5qcw0KLy8gQHJlcXVpcmUgICAgICAgIGh0dHBzOi8vdXNlcnNjcmlwdHMtbWlycm9yLm9yZy9zY3JpcHRzL3NvdXJjZS84NTYxOC51c2VyLmpzDQovLyBAcmVxdWlyZSAgICAgICAgaHR0cHM6Ly91c2Vyc2NyaXB0cy1taXJyb3Iub3JnL3NjcmlwdHMvc291cmNlLzg3OTQwLnVzZXIuanMNCi8vIEBoaXN0b3J5ICAgICAgICAxLjAuMy4wIFJlbW92ZWQgbXVsdGlsaW5lIHN0cmluZ3MgZHVlIHRvIHJlY2VudCBmaXJlZm94IHVwZGF0ZQ0KLy8gPT0vVXNlclNjcmlwdD09DQoNCi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KDQogICAgQXV0aG9yJ3MgTk9URQ0KDQogICAgVGhpcyBzY3JpcHQgd2FzIG1hZGUgZnJvbSBzY3JhdGNoLg0KDQogICAgQmFzZWQgb24gaHR0cHM6Ly91c2Vyc2NyaXB0cy1taXJyb3Iub3JnL3NjcmlwdHMvc2hvdy81MjI1MSAoYnkgQnV6enkpDQoNCioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKg0KDQogICAgVGhpcyBwcm9ncmFtIGlzIGZyZWUgc29mdHdhcmU6IHlvdSBjYW4gcmVkaXN0cmlidXRlIGl0IGFuZC9vciBtb2RpZnkNCiAgICBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieQ0KICAgIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb24sIGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yDQogICAgKGF0IHlvdXIgb3B0aW9uKSBhbnkgbGF0ZXIgdmVyc2lvbi4NCg0KICAgIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLA0KICAgIGJ1dCBXSVRIT1VUIEFOWSBXQVJSQU5UWTsgd2l0aG91dCBldmVuIHRoZSBpbXBsaWVkIHdhcnJhbnR5IG9mDQogICAgTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZQ0KICAgIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuDQoNCiAgICBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZQ0KICAgIGFsb25nIHdpdGggdGhpcyBwcm9ncmFtLiAgSWYgbm90LCBzZWUgPGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+Lg0KDQoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCg0KLy8gZm9yIGNvbXBhdGliaWxpdHkgb25seQ0KdmFyIFVwZGF0ZXIgPSB7fTsNCg0KKGZ1bmN0aW9uICgpIHsJLy8gc2NyaXB0IHNjb3BlDQoJdmFyIHBhcnNlSGVhZGVyID0gZnVuY3Rpb24gKHRleHQpIHsNCgkJdmFyIG91dHB1dCA9IHsicmVzb3VyY2VzIiA6IHt9LCAiaGlzdG9yaWVzIiA6IHt9fSwNCgkJcmUgPSAvXlwvXC8gQChbXHc6XSspXHMrKC4rKSQvZ20sDQoJCWl0ZW07DQoNCgkJd2hpbGUgKGl0ZW0gPSByZS5leGVjKHRleHQpKSB7DQoJCQl2YXIgayA9IGl0ZW1bMV0udG9Mb3dlckNhc2UoKTsNCg0KCQkJaWYgKCJyZXNvdXJjZSIgPT0gaykgew0KCQkJCWlmICgvXihbXHc6Ll0rKVxzKyguKykvLnRlc3QoaXRlbVsyXSkpIHsNCgkJCQkJb3V0cHV0LnJlc291cmNlc1tSZWdFeHAuJDFdID0gUmVnRXhwLiQyOw0KCQkJCX0NCgkJCX0gZWxzZSBpZiAoImhpc3RvcnkiID09IGspIHsNCgkJCQlpZiAoL14oW1x3Oi5dKylccysoLispLy50ZXN0KGl0ZW1bMl0pKSB7DQoJCQkJCWlmIChSZWdFeHAuJDEgaW4gb3V0cHV0Lmhpc3Rvcmllcykgew0KCQkJCQkJb3V0cHV0Lmhpc3Rvcmllc1tSZWdFeHAuJDFdLnB1c2goUmVnRXhwLiQyKTsNCgkJCQkJfSBlbHNlIHsNCgkJCQkJCW91dHB1dC5oaXN0b3JpZXNbUmVnRXhwLiQxXSA9IFtSZWdFeHAuJDJdOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfSBlbHNlIHsNCgkJCQlpZiAoflsiaW5jbHVkZSIsICJleGNsdWRlIl0uaW5kZXhPZihrKSkgew0KCQkJCQlrICs9ICJzIjsNCgkJCQl9IGVsc2UgaWYgKH5bIm1hdGNoIl0uaW5kZXhPZihrKSkgew0KCQkJCQlrICs9ICJlcyI7DQoJCQkJfQ0KDQoJCQkJaWYgKGsgaW4gb3V0cHV0KSB7DQoJCQkJCWlmICghKG91dHB1dFtrXSBpbnN0YW5jZW9mIEFycmF5KSkgew0KCQkJCQkJb3V0cHV0W2tdID0gW291dHB1dFtrXV07DQoJCQkJCX0NCg0KCQkJCQlvdXRwdXRba10ucHVzaChpdGVtWzJdKTsNCgkJCQl9IGVsc2Ugew0KCQkJCQlvdXRwdXRba10gPSBpdGVtWzJdOw0KCQkJCX0NCgkJCX0NCgkJfQ0KDQoJCXJldHVybiBvdXRwdXQ7DQoJfTsNCg0KCWlmIChHTV9nZXRWYWx1ZSgiY2Z1d19lbmFibGVkIiwgdHJ1ZSkpIHsNCgkJKGZ1bmN0aW9uIHJlY3Vyc2l2ZSAobmV3X2hlYWRlcikgew0KCQkJdmFyIGxhc3QgPSBEYXRlLnBhcnNlKEdNX2dldFZhbHVlKCJjZnV3X2xhc3RfY2hlY2siLCAiU2F0IE9jdCA5IDIwMTAgMjA6MTA6MjYgR01ULTAzMDAiKSksDQoJCQljdXJyID0gbmV3IERhdGUoKSwNCgkJCWludGVydmFsID0gODY0MDAwMDA7IC8vIDI0ICogNjAgKiA2MCAqIDEwMDAgPSAxIGRheQ0KCQkJDQoJCQlpZiAoY3VyciAtIGludGVydmFsID4gbGFzdCkgew0KCQkJCXZhciBvbGRfaGVhZGVyID0gbnVsbDsNCg0KCQkJCXRyeSB7DQoJCQkJCW9sZF9oZWFkZXIgPSBwYXJzZUhlYWRlcihHTV9nZXRSZXNvdXJjZVRleHQoIm1ldGEiKSk7DQoJCQkJfSBjYXRjaCAoZSkgew0KCQkJCQljb25zb2xlLndhcm4oJ1Jlc291cmNlIE1FVEEgaXMgcmVxdWlyZWQgZm9yIHRoZSBzY3JpcHQgIicgKyBHTV9pbmZvLnNjcmlwdC5uYW1lICsgJyIuXG5VcGRhdGUgY2hlY2tpbmcgd2FzIGlnbm9yZWQhJyk7DQoJCQkJfQ0KDQoJCQkJaWYgKG9sZF9oZWFkZXIpIHsNCgkJCQkJR01fc2V0VmFsdWUoImNmdXdfbGFzdF9jaGVjayIsIChsYXN0ID0gbmV3IERhdGUoY3VyciAtIGludGVydmFsICsgMzEwMDAwKSkudG9TdHJpbmcoKSk7DQoNCgkJCQkJZnVuY3Rpb24gbmV4dHN0ZXAobmV3X2hlYWRlcikgew0KCQkJCQkJdmFyIHBhcmVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpLA0KCQkJCQkJcGFyYW1zID0gew0KCQkJCQkJCSJpZCIgOiBvbGRfaGVhZGVyWyJ1c286c2NyaXB0Il0gfHwgIiIsDQoJCQkJCQkJIm5hbWUiIDogb2xkX2hlYWRlci5uYW1lIHx8ICIiLA0KCQkJCQkJCSJvbGRfdmVyc2lvbiIgOiBvbGRfaGVhZGVyLnZlcnNpb24gfHwgb2xkX2hlYWRlclsidXNvOnZlcnNpb24iXSB8fCBJMThuLmdldCgiY2Z1dy52ZXJzaW9uLnVua25vd24iKSwNCgkJCQkJCQkibmV3X3ZlcnNpb24iIDogbmV3X2hlYWRlci52ZXJzaW9uIHx8IG5ld19oZWFkZXJbInVzbzp2ZXJzaW9uIl0gfHwgSTE4bi5nZXQoImNmdXcudmVyc2lvbi51bmtub3duIiksDQoJCQkJCQkJImhpc3RvcnkiIDogIiIsDQoJCQkJCQkJImkxOG4udGl0bGUiIDogSTE4bi5nZXQoImNmdXcudGl0bGUiKSwgLy9OZXcgdmVyc2lvbiBhdmFpbGFibGUgZm9yIA0KCQkJCQkJCSJpMThuLmN2ZXJzaW9uIiA6IEkxOG4uZ2V0KCJjZnV3LmN2ZXJzaW9uLmxhYmVsIiksIC8vQ3VycmVudCB2ZXJzaW9uDQoJCQkJCQkJImkxOG4ubHZlcnNpb24iIDogSTE4bi5nZXQoImNmdXcubHZlcnNpb24ubGFiZWwiKSwgLy9MYXN0ZXN0IHZlcnNpb24NCgkJCQkJCQkiaTE4bi5pbnN0YWxsIiA6IEkxOG4uZ2V0KCJjZnV3Lmluc3RhbGwubGFiZWwiKSwgLy8gSW5zdGFsbA0KCQkJCQkJCSJpMThuLnZpc2l0IiA6IEkxOG4uZ2V0KCJjZnV3LnZpc2l0LmxhYmVsIiksIC8vIFZpc2l0DQoJCQkJCQkJImkxOG4uY2FuY2VsIiA6IEkxOG4uZ2V0KCJjZnV3LmNhbmNlbC5sYWJlbCIpLCAvLyBDYW5jZWwNCgkJCQkJCQkiaTE4bi5kaXNhYmxlIiA6IEkxOG4uZ2V0KCJjZnV3LmRpc2FibGUubGFiZWwiKSwgLy8gRG9uJ3QgYXNrIG1lIGFnYWluIGZvciB0aGlzIHNjcmlwdA0KCQkJCQkJfTsNCg0KCQkJCQkJZm9yICh2YXIga2V5IGluIG9sZF9oZWFkZXIuaGlzdG9yaWVzKSB7DQoJCQkJCQkJaWYgKGtleSBpbiBuZXdfaGVhZGVyLmhpc3Rvcmllcykgew0KCQkJCQkJCQlkZWxldGUgbmV3X2hlYWRlci5oaXN0b3JpZXNba2V5XTsNCgkJCQkJCQl9DQoJCQkJCQl9DQoNCgkJCQkJCWZvciAodmFyIGtleSBpbiBuZXdfaGVhZGVyLmhpc3Rvcmllcykgew0KCQkJCQkJCXBhcmFtcy5oaXN0b3J5ICs9ICI8c3Bhbj4iICsga2V5ICsgIjwvc3Bhbj48dWw+IjsNCg0KCQkJCQkJCWZvciBlYWNoICh2YXIgaXRlbSBpbiBuZXdfaGVhZGVyLmhpc3Rvcmllc1trZXldKSB7DQoJCQkJCQkJCXBhcmFtcy5oaXN0b3J5ICs9ICI8bGk+IiArIGl0ZW0gKyAiPC9saT4iOw0KCQkJCQkJCX0NCg0KCQkJCQkJCXBhcmFtcy5oaXN0b3J5ICs9ICI8L3VsPiI7DQoJCQkJCQl9DQoNCgkJCQkJCXBhcmVudC5pbm5lckhUTUwgPSBHTV9nZXRSZXNvdXJjZVRleHQoInVwZGF0ZXJXaW5kb3dIdG1sIikucmVwbGFjZSgveyhbXHcuXSspfS9nLCBmdW5jdGlvbiAoJDAsICQxKSB7DQoJCQkJCQkJcmV0dXJuICgkMSBpbiBwYXJhbXMgPyBwYXJhbXNbJDFdIDogJDApDQoJCQkJCQl9KTsNCgkJCQkJDQoJCQkJCQlkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHBhcmVudCk7DQoJCQkJCQ0KCQkJCQkJdmFyIGNsb3NlV2luID0gc2V0VGltZW91dChmdW5jdGlvbiAodykgew0KCQkJCQkJCWlmICh3KSB7DQoJCQkJCQkJCXcucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh3KTsNCgkJCQkJCQl9DQoJCQkJCQl9LCAxMjAwMDAsIHBhcmVudCksDQoJCQkJCQl3aW4gPSAiaWQoJ2NmdXdfIiArIG9sZF9oZWFkZXJbInVzbzpzY3JpcHQiXSArICInKSI7DQoNCgkJCQkJCWlmIChwYXJhbXMuaGlzdG9yeS5sZW5ndGgpIHsNCgkJCQkJCQl4cGF0aCh3aW4gKyAiLy9kaXZbQGNsYXNzPSdoaXN0b3J5J10iKVswXS5zdHlsZS52aXNpYmlsaXR5ID0gInZpc2libGUiOw0KCQkJCQkJfQ0KCQkJCQkNCgkJCQkJCWlmIChvbGRfaGVhZGVyLm5hbWUgKyBvbGRfaGVhZGVyLm5hbWVzcGFjZSAhPSBuZXdfaGVhZGVyLm5hbWUgKyBuZXdfaGVhZGVyLm5hbWVzcGFjZSkgew0KCQkJCQkJCXhwYXRoKHdpbiArICIvL2FbY29udGFpbnMoQGNsYXNzLCdpbnN0YWxsJyldIilbMF0uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbiAoZSkgew0KCQkJCQkJCQlJMThuLmdldCgiY2Z1dy51bmluc3RhbGwubXNnLmVycm9yIiwgYWxlcnQpOyAvLyBUaGUgc2NyaXB0IG5hbWUvbmFtZXNwYWNlIGhhcyBjaGFuZ2VkLlxuWW91IHdpbGwgbmVlZCB0byB1bmluc3RhbGwgdGhlIG9sZCB2ZXJzaW9uIG1hbnVhbGx5Lg0KCQkJCQkJCX0sIHRydWUpOw0KCQkJCQkJfQ0KDQoJCQkJCQlmb3IgZWFjaCAodmFyIGJ0biBpbiB4cGF0aCh3aW4gKyAiLy9hW2NvbnRhaW5zKEBjbGFzcywnY2xvc2UnKV0iKSkgew0KCQkJCQkJCWJ0bi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uIChlKSB7DQoJCQkJCQkJCXBhcmVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHBhcmVudCk7DQoJCQkJCQkJCWNsZWFyVGltZW91dChjbG9zZVdpbik7DQoJCQkJCQkJCUdNX3NldFZhbHVlKCJjZnV3X2xhc3RfY2hlY2siLCBuZXcgRGF0ZSgpLnRvU3RyaW5nKCkpOw0KCQkJCQkJCX0sIGZhbHNlKTsNCgkJCQkJCX0NCgkJCQkJDQoJCQkJCQl4cGF0aCh3aW4rIi8vdGRbQGNsYXNzPSdkaXNhYmxlJ10vaW5wdXQiKVswXS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uIChlKSB7DQoJCQkJCQkJR01fc2V0VmFsdWUoImNmdXdfZW5hYmxlZCIsICFlLnRhcmdldC5jaGVja2VkKTsNCgkJCQkJCX0sIGZhbHNlKTsNCg0KCQkJCQkJc2V0VGltZW91dChyZWN1cnNpdmUsIGxhc3QgLSBjdXJyICsgaW50ZXJ2YWwsIG5ld19oZWFkZXIpOw0KCQkJCQl9DQoNCgkJCQkJaWYgKG5ld19oZWFkZXIpIHsNCgkJCQkJCW5leHRzdGVwKG5ld19oZWFkZXIpOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJR01feG1saHR0cFJlcXVlc3Qoew0KCQkJCQkJCSJtZXRob2QiIDogImdldCIsDQoJCQkJCQkJInVybCIgOiBvbGRfaGVhZGVyLnJlc291cmNlcy5tZXRhLA0KCQkJCQkJCSJvbmVycm9yIiA6IGZ1bmN0aW9uICh4aHIpIHsNCgkJCQkJCQkJc2V0VGltZW91dChyZWN1cnNpdmUsIGxhc3QgLSBjdXJyICsgaW50ZXJ2YWwpOw0KCQkJCQkJCX0sDQoJCQkJCQkJIm9ubG9hZCIgOiBmdW5jdGlvbiAoeGhyKSB7DQoJCQkJCQkJCXZhciBuZXdfaGVhZGVyID0gcGFyc2VIZWFkZXIoeGhyLnJlc3BvbnNlVGV4dCksDQoJCQkJCQkJCWN1cnIgPSBuZXcgRGF0ZSgpOw0KDQoJCQkJCQkJCWlmICgvXjIvLnRlc3QoeGhyLnN0YXR1cykgJiYgIiIgKyBvbGRfaGVhZGVyWyJ1c286aGFzaCJdICE9ICIiICsgbmV3X2hlYWRlclsidXNvOmhhc2giXSkgew0KCQkJCQkJCQkJR01fYWRkU3R5bGUoR01fZ2V0UmVzb3VyY2VUZXh0KCJ1cGRhdGVyV2luZG93Q3NzIikpOw0KDQoJCQkJCQkJCQluZXh0c3RlcChuZXdfaGVhZGVyKTsNCgkJCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQkJCUdNX3NldFZhbHVlKCJjZnV3X2xhc3RfY2hlY2siLCBjdXJyLnRvU3RyaW5nKCkpOw0KDQoJCQkJCQkJCQlzZXRUaW1lb3V0KHJlY3Vyc2l2ZSwgaW50ZXJ2YWwpOw0KCQkJCQkJCQl9DQoJCQkJCQkJfQ0KCQkJCQkJfSk7DQoJCQkJCX0NCgkJCQl9DQoJCQl9IGVsc2Ugew0KCQkJCXNldFRpbWVvdXQocmVjdXJzaXZlLCBsYXN0IC0gY3VyciArIGludGVydmFsKTsNCgkJCX0NCgkJfSgpKTsNCgl9DQp9KCkpOw0K"},{"meta":{"name":"163374.user.js","url":"https://userscripts-mirror.org/scripts/source/163374.user.js","ts":1696775833371,"mimetype":"text/javascript"},"source":"Ly8gPT1Vc2VyU2NyaXB0PT0NCi8vIEBuYW1lICAgICAgICAgICBJbmNsdWRlcyA6IFdpbkNvbmZpZw0KLy8gQG5hbWVzcGFjZSAgICAgIGh0dHA6Ly9nbS53ZXNsZXkuZXRpLmJyDQovLyBAZGVzY3JpcHRpb24gICAgV2luQ29uZmlnIEZ1bmN0aW9uDQovLyBAYXV0aG9yICAgICAgICAgdzM1bDN5DQovLyBAZW1haWwgICAgICAgICAgdzM1bDN5QGJyYXNuZXQub3JnDQovLyBAY29weXJpZ2h0ICAgICAgMjAxMyssIHczNWwzeSAoaHR0cDovL2dtLndlc2xleS5ldGkuYnIvaW5jbHVkZXMpDQovLyBAbGljZW5zZSAgICAgICAgR05VIEdQTA0KLy8gQGhvbWVwYWdlICAgICAgIGh0dHA6Ly9nbS53ZXNsZXkuZXRpLmJyL2luY2x1ZGVzDQovLyBAdmVyc2lvbiAgICAgICAgMS43LjANCi8vIEBsYW5ndWFnZSAgICAgICBlbg0KLy8gQGluY2x1ZGUgICAgICAgIG5vd2hlcmUNCi8vIEBleGNsdWRlICAgICAgICAqDQovLyBAaWNvbiAgICAgICAgICAgaHR0cDovL2dtLndlc2xleS5ldGkuYnIvaWNvbi5waHA/ZGVzYz0xNjMzNzQNCi8vIEBncmFudCAgICAgICAgICBHTV9sb2cNCi8vIEBncmFudCAgICAgICAgICBHTV9hZGRTdHlsZQ0KLy8gQGdyYW50ICAgICAgICAgIEdNX2dldFZhbHVlDQovLyBAZ3JhbnQgICAgICAgICAgR01fc2V0VmFsdWUNCi8vIEBncmFudCAgICAgICAgICBHTV9kZWxldGVWYWx1ZQ0KLy8gQGdyYW50ICAgICAgICAgIEdNX2dldFJlc291cmNlVGV4dA0KLy8gQHJlc291cmNlICAgICAgIHdpbkNvbmZpZ0NzcyBodHRwOi8vcGFzdGViaW4uY29tL2Rvd25sb2FkLnBocD9pPUxkazRKNGJpDQovLyA9PS9Vc2VyU2NyaXB0PT0NCg0KLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqDQoNCiAgICBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeQ0KICAgIGl0IHVuZGVyIHRoZSB0ZXJtcyBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYXMgcHVibGlzaGVkIGJ5DQogICAgdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbiwgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3INCiAgICAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLg0KDQogICAgVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsDQogICAgYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2YNCiAgICBNRVJDSEFOVEFCSUxJVFkgb3IgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UuICBTZWUgdGhlDQogICAgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy4NCg0KICAgIFlvdSBzaG91bGQgaGF2ZSByZWNlaXZlZCBhIGNvcHkgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlDQogICAgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uICBJZiBub3QsIHNlZSA8aHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uDQoNCioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLw0KDQpHTV9hZGRTdHlsZShHTV9nZXRSZXNvdXJjZVRleHQoIndpbkNvbmZpZ0NzcyIpKTsNCg0KdmFyIFdpbkNvbmZpZyA9IGZ1bmN0aW9uIChwYXJhbXMpIHsNCgl0aGlzLm5hbWUgPSAoInRpdGxlIiBpbiBwYXJhbXMpICYmIHBhcmFtcy50aXRsZS5yZXBsYWNlKC9bXlx3XSsvZywgIiIpIHx8ICJkZWZhdWx0IjsNCgl0aGlzLnR5cGUgPSAoInR5cGUiIGluIHBhcmFtcykgJiYgcGFyYW1zLnR5cGUgfHwgV2luQ29uZmlnLldpbmRvd1R5cGUuQ1VTVE9NOw0KCXRoaXMuZGVzY3JpcHRpb24gPSAiIjsNCgl0aGlzLnBvc2l0aW9uID0gWy0xLCAtMV07DQoJdGhpcy5zaXplID0gWyIyODBweCIsIDBdOw0KCXRoaXMuZG9jdW1lbnQgPSBkb2N1bWVudC5ib2R5Ow0KCXRoaXMuc3RvcmUgPSBmYWxzZTsNCgl0aGlzLnBhcmVudCA9IG51bGw7DQoJdGhpcy5jaGlsZHJlbiA9IFtdOw0KDQoJdGhpcy5idXR0b25zID0gKGZ1bmN0aW9uICh0eXBlKSB7DQoJCXN3aXRjaCAodHlwZSkgew0KCQkJY2FzZSBXaW5Db25maWcuV2luZG93VHlwZS5QUk9NUFQ6DQoJCQkJcmV0dXJuIFdpbkNvbmZpZy5XaW5kb3dCdXR0b24uT0sgfCBXaW5Db25maWcuV2luZG93QnV0dG9uLkNBTkNFTDsNCgkJCWNhc2UgV2luQ29uZmlnLldpbmRvd1R5cGUuUVVFU1RJT046DQoJCQkJcmV0dXJuIFdpbkNvbmZpZy5XaW5kb3dCdXR0b24uWUVTIHwgV2luQ29uZmlnLldpbmRvd0J1dHRvbi5OTzsNCgkJCWNhc2UgV2luQ29uZmlnLldpbmRvd1R5cGUuV0FSTklORzoNCgkJCWNhc2UgV2luQ29uZmlnLldpbmRvd1R5cGUuRVJST1I6DQoJCQljYXNlIFdpbkNvbmZpZy5XaW5kb3dUeXBlLlNVQ0NFU1M6DQoJCQljYXNlIFdpbkNvbmZpZy5XaW5kb3dUeXBlLkVYUExBTkFUSU9OOg0KCQkJCXJldHVybiBXaW5Db25maWcuV2luZG93QnV0dG9uLk9LOw0KCQkJY2FzZSBXaW5Db25maWcuV2luZG93VHlwZS5DVVNUT006DQoJCQkJcmV0dXJuIFdpbkNvbmZpZy5XaW5kb3dCdXR0b24uU0FWRSB8IFdpbkNvbmZpZy5XaW5kb3dCdXR0b24uUkVTRVQgfCBXaW5Db25maWcuV2luZG93QnV0dG9uLkNBTkNFTDsNCgkJfQ0KCX0odGhpcy50eXBlKSk7DQoNCgl0aGlzLnRpdGxlID0gKGZ1bmN0aW9uICh0eXBlKSB7DQoJCXN3aXRjaCAodHlwZSkgew0KCQkJY2FzZSBXaW5Db25maWcuV2luZG93VHlwZS5QUk9NUFQ6DQoJCQkJcmV0dXJuICJQcm9tcHQgRGlhbG9nIjsNCgkJCWNhc2UgV2luQ29uZmlnLldpbmRvd1R5cGUuUVVFU1RJT046DQoJCQkJcmV0dXJuICJRdWVzdGlvbiBEaWFsb2ciOw0KCQkJY2FzZSBXaW5Db25maWcuV2luZG93VHlwZS5XQVJOSU5HOg0KCQkJCXJldHVybiAiV2FybmluZyBEaWFsb2ciOw0KCQkJY2FzZSBXaW5Db25maWcuV2luZG93VHlwZS5FUlJPUjoNCgkJCQlyZXR1cm4gIkVycm9yIERpYWxvZyI7DQoJCQljYXNlIFdpbkNvbmZpZy5XaW5kb3dUeXBlLkVYUExBTkFUSU9OOg0KCQkJCXJldHVybiAiRXhwbGFuYXRpb24gRGlhbG9nIjsNCgkJCWNhc2UgV2luQ29uZmlnLldpbmRvd1R5cGUuU1VDQ0VTUzoNCgkJCQlyZXR1cm4gIlN1Y2Nlc3MgRGlhbG9nIjsNCgkJCWNhc2UgV2luQ29uZmlnLldpbmRvd1R5cGUuQ1VTVE9NOg0KCQkJCXJldHVybiAiU2V0dGluZ3MiOw0KCQl9DQoJfSh0aGlzLnR5cGUpKTsNCgkNCglpZiAoV2luQ29uZmlnLldpbmRvd1R5cGUuUFJPTVBUID09IHRoaXMudHlwZSkgew0KCQl0aGlzLmZpZWxkcyA9IFt7DQoJCQlmb2N1c2VkCTogdHJ1ZSwNCgkJCW5hbWUJOiAidGV4dCIsDQoJCX1dOw0KCX0gZWxzZSBpZiAoV2luQ29uZmlnLldpbmRvd1R5cGUuQ1VTVE9NID09IHRoaXMudHlwZSkgew0KCQl0aGlzLnN0b3JlID0gdHJ1ZTsNCgl9DQoNCglmb3IgKHZhciBwIGluIHBhcmFtcykgew0KCQl0aGlzW3BdID0gcGFyYW1zW3BdOw0KCX0NCgkNCgl2YXIgX2Nsb3NlID0gZnVuY3Rpb24gKCkgew0KCQlpZiAoIXRoaXMuY2hpbGRyZW4ubGVuZ3RoKSB7DQoJCQlpZiAodGhpcy5wYXJlbnQpIHsNCgkJCQl0aGlzLnBhcmVudC5jaGlsZHJlbi5zcGxpY2UodGhpcy5wYXJlbnQuY2hpbGRyZW4uaW5kZXhPZih0aGlzKSwgMSk7DQoJCQl9DQoNCgkJCW1haW4ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChtYWluKTsNCgkJCW9wYXF1ZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG9wYXF1ZSk7DQoNCgkJCVdpbkNvbmZpZy5fX29wZW5lZFdpbmRvd3Muc3BsaWNlKFdpbkNvbmZpZy5fX29wZW5lZFdpbmRvd3MuaW5kZXhPZih0aGlzKSwgMSk7DQoJCX0NCgl9LmJpbmQodGhpcyksDQoJbWFpbiA9IHRoaXMuZm9ybSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImZvcm0iKSwNCglvcGFxdWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSwNCgloZWFkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksDQoJYm9keSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpLA0KCWZvb3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSwNCglhZGRFdmVudCA9IGZ1bmN0aW9uIChpbnB1dCwgZXZlbnQsIGZ1bmMsIF90aGlzLCBwYXJhbXMpIHsNCgkJaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgZnVuY3Rpb24gKGUpIHsNCgkJCWZ1bmMuYXBwbHkoX3RoaXMsIFtlXS5jb25jYXQocGFyYW1zKSk7DQoJCX0sIGZhbHNlKTsNCgl9LA0KCWZvY3VzZWRJbnB1dCwNCglidXR0b25zID0gW10sDQoJdm4gPSAidmVyc2lvbi0iICsgdGhpcy5uYW1lLA0KCWNvbmZpZyA9IHt9LA0KCV90aGlzID0gdGhpcywNCgl0bXBCdXR0b24gPSBbWyJPSyIsIDEsIHRydWVdLCBbIlllcyIsIDEsIHRydWVdLCBbIlNhdmUiLCAxLCB0cnVlXSwgWyJTdWJtaXQiLCAxLCB0cnVlXSwgWyJDYW5jZWwiLCAwXSwgWyJObyIsIDBdLCBbIlJlc2V0IiwgMl1dLA0KCWRyYWcgPSBbZmFsc2UsIDAsIDBdLA0KCXRiID0gZnVuY3Rpb24gKHQpIHsNCgkJcmV0dXJuIFtbImJ1dHRvbiIsIGZ1bmN0aW9uICgpIHsNCgkJCXRoaXMuY2xvc2UoKTsNCgkJfV0sWyJzdWJtaXQiLCBmdW5jdGlvbiAoKSB7DQoJCQl2YXIgX2NvbmZpZyA9IChmdW5jdGlvbiByZWN1cnNpdmUgKF90aGlzKSB7DQoJCQkJdmFyIGNmZyA9IHt9Ow0KDQoJCQkJZm9yICh2YXIgYWkgaW4gX3RoaXMuZmllbGRzKSB7DQoJCQkJCXZhciBmaWVsZCA9IF90aGlzLmZpZWxkc1thaV07DQoNCgkJCQkJZm9yICh2YXIgYmkgaW4gZmllbGQuZWxlbWVudHMpIHsNCgkJCQkJCXZhciBlbGVtID0gZmllbGQuZWxlbWVudHNbYmldOw0KDQoJCQkJCQlpZiAoV2luQ29uZmlnLkZpZWxkVHlwZS5HUk9VUCA9PSBmaWVsZC50eXBlKSB7DQoJCQkJCQkJdmFyIHggPSByZWN1cnNpdmUoZmllbGQpOw0KDQoJCQkJCQkJaWYgKCEoZmllbGQubmFtZSBpbiBjZmcpKSB7DQoJCQkJCQkJCWNmZ1tmaWVsZC5uYW1lXSA9IHt9Ow0KCQkJCQkJCX0NCg0KCQkJCQkJCWZvciAodmFyIGFpIGluIHgpIHsNCgkJCQkJCQkJY2ZnW2ZpZWxkLm5hbWVdW2FpXSA9IHhbYWldOw0KCQkJCQkJCX0NCgkJCQkJCX0gZWxzZSBpZiAoV2luQ29uZmlnLkZpZWxkVHlwZS5DSEVDSyA9PSBmaWVsZC50eXBlKSB7DQoJCQkJCQkJaWYgKGVsZW0uY2hlY2tlZCkgew0KCQkJCQkJCQlpZiAoZmllbGQubXVsdGlwbGUgJiYgZmllbGQudmFsdWUgaW5zdGFuY2VvZiBBcnJheSAmJiBmaWVsZC52YWx1ZS5sZW5ndGggPiAxKSB7DQoJCQkJCQkJCQlpZiAoV2luQ29uZmlnLkZpZWxkRm9ybWF0Lk5VTUJFUiAmIGZpZWxkLmZvcm1hdCkgew0KCQkJCQkJCQkJCWNmZ1tmaWVsZC5uYW1lXSB8PSBlbGVtLnZhbHVlOw0KCQkJCQkJCQkJfSBlbHNlIGlmIChXaW5Db25maWcuRmllbGRGb3JtYXQuQk9PTEVBTiAmIGZpZWxkLmZvcm1hdCkgew0KCQkJCQkJCQkJCWlmIChmaWVsZC5uYW1lIGluIGNmZykgew0KCQkJCQkJCQkJCQljZmdbZmllbGQubmFtZV0ucHVzaChlbGVtLnZhbHVlID09ICJ0cnVlIik7DQoJCQkJCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQkJCQkJY2ZnW2ZpZWxkLm5hbWVdID0gW2VsZW0udmFsdWUgPT0gInRydWUiXTsNCgkJCQkJCQkJCQl9DQoJCQkJCQkJCQl9IGVsc2UgaWYgKGZpZWxkLm5hbWUgaW4gY2ZnKSB7DQoJCQkJCQkJCQkJY2ZnW2ZpZWxkLm5hbWVdLnB1c2goZWxlbS52YWx1ZSk7DQoJCQkJCQkJCQl9IGVsc2Ugew0KCQkJCQkJCQkJCWNmZ1tmaWVsZC5uYW1lXSA9IFtlbGVtLnZhbHVlXTsNCgkJCQkJCQkJCX0NCgkJCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQkJCXZhciBvID0gZWxlbS52YWx1ZTsNCg0KCQkJCQkJCQkJaWYgKFdpbkNvbmZpZy5GaWVsZEZvcm1hdC5CT09MRUFOICYgZmllbGQuZm9ybWF0KSB7DQoJCQkJCQkJCQkJY2ZnW2ZpZWxkLm5hbWVdID0gKG8gPT0gInRydWUiIHx8ICFpc05hTihvKSAmJiAhIXBhcnNlSW50KG8sIDEwKSk7DQoJCQkJCQkJCQl9IGVsc2UgaWYgKFdpbkNvbmZpZy5GaWVsZEZvcm1hdC5OVU1CRVIgJiBmaWVsZC5mb3JtYXQpIHsNCgkJCQkJCQkJCQljZmdbZmllbGQubmFtZV0gPSBwYXJzZUludChvLCAxMCk7DQoJCQkJCQkJCQl9IGVsc2Ugew0KCQkJCQkJCQkJCWNmZ1tmaWVsZC5uYW1lXSA9IG87DQoJCQkJCQkJCQl9DQoJCQkJCQkJCX0NCgkJCQkJCQl9IGVsc2UgaWYgKCEoZmllbGQubmFtZSBpbiBjZmcpKSB7DQoJCQkJCQkJCWlmICgiZW1wdHkiIGluIGZpZWxkKSB7DQoJCQkJCQkJCQlpZiAoIWZpZWxkLm11bHRpcGxlIHx8IChXaW5Db25maWcuRmllbGRGb3JtYXQuTlVNQkVSICYgZmllbGQuZm9ybWF0KSB8fCAodHJ1ZSA9PT0gZmllbGQudmFsdWUpIHx8IChmaWVsZC52YWx1ZSBpbnN0YW5jZW9mIEFycmF5ICYmIDEgPT0gZmllbGQudmFsdWUubGVuZ3RoKSkgew0KCQkJCQkJCQkJCWNmZ1tmaWVsZC5uYW1lXSA9IGZpZWxkLmVtcHR5Ow0KCQkJCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQkJCQljZmdbZmllbGQubmFtZV0gPSBbZmllbGQuZW1wdHldOw0KCQkJCQkJCQkJfQ0KCQkJCQkJCQl9IGVsc2UgaWYgKFdpbkNvbmZpZy5GaWVsZEZvcm1hdC5OVU1CRVIgJiBmaWVsZC5mb3JtYXQpIHsNCgkJCQkJCQkJCWNmZ1tmaWVsZC5uYW1lXSA9IDA7DQoJCQkJCQkJCX0gZWxzZSBpZiAoZmllbGQubXVsdGlwbGUpIHsNCgkJCQkJCQkJCWNmZ1tmaWVsZC5uYW1lXSA9IFtdOw0KCQkJCQkJCQl9DQoJCQkJCQkJfQ0KCQkJCQkJfSBlbHNlIGlmIChXaW5Db25maWcuRmllbGRUeXBlLlNFTEVDVCA9PSBmaWVsZC50eXBlKSB7DQoJCQkJCQkJaWYgKH5lbGVtLnNlbGVjdGVkSW5kZXgpIHsNCgkJCQkJCQkJaWYgKGZpZWxkLm11bHRpcGxlKSB7DQoJCQkJCQkJCQlmb3IgKHZhciBjaSBpbiBmaWVsZC52YWx1ZSkgew0KCQkJCQkJCQkJCXZhciBlID0gZmllbGQudmFsdWVbY2ldLmVsZW1lbnRzWzBdOw0KDQoJCQkJCQkJCQkJaWYgKGUuc2VsZWN0ZWQpIHsNCgkJCQkJCQkJCQkJaWYgKGZpZWxkLnVuaXF1ZSAmJiAoV2luQ29uZmlnLkZpZWxkRm9ybWF0Lk5VTUJFUiAmIGZpZWxkLmZvcm1hdCkpIHsNCgkJCQkJCQkJCQkJCWNmZ1tmaWVsZC5uYW1lXSB8PSBlLnZhbHVlOw0KCQkJCQkJCQkJCQl9IGVsc2Ugew0KCQkJCQkJCQkJCQkJdmFyIG8gPSBlLnZhbHVlOw0KCQkJCQkJCQkJCQkJaWYgKFdpbkNvbmZpZy5GaWVsZEZvcm1hdC5CT09MRUFOICYgZmllbGQuZm9ybWF0KSB7DQoJCQkJCQkJCQkJCQkJbyA9IChvID09ICJ0cnVlIiB8fCAhaXNOYU4obykgJiYgISFwYXJzZUludChvLCAxMCkpDQoJCQkJCQkJCQkJCQl9IGVsc2UgaWYgKFdpbkNvbmZpZy5GaWVsZEZvcm1hdC5OVU1CRVIgJiBmaWVsZC5mb3JtYXQpIHsNCgkJCQkJCQkJCQkJCQlvID0gcGFyc2VJbnQobywgMTApOw0KCQkJCQkJCQkJCQkJfQ0KDQoJCQkJCQkJCQkJCQlpZiAoZmllbGQubmFtZSBpbiBjZmcpIHsNCgkJCQkJCQkJCQkJCQljZmdbZmllbGQubmFtZV0ucHVzaChvKTsNCgkJCQkJCQkJCQkJCX0gZWxzZSB7DQoJCQkJCQkJCQkJCQkJY2ZnW2ZpZWxkLm5hbWVdID0gW29dOw0KCQkJCQkJCQkJCQkJfQ0KCQkJCQkJCQkJCQl9DQoJCQkJCQkJCQkJfQ0KCQkJCQkJCQkJfQ0KCQkJCQkJCQl9IGVsc2Ugew0KCQkJCQkJCQkJdmFyIG8gPSBlbGVtLm9wdGlvbnNbZWxlbS5zZWxlY3RlZEluZGV4XS52YWx1ZTsNCg0KCQkJCQkJCQkJaWYgKFdpbkNvbmZpZy5GaWVsZEZvcm1hdC5CT09MRUFOICYgZmllbGQuZm9ybWF0KSB7DQoJCQkJCQkJCQkJY2ZnW2ZpZWxkLm5hbWVdID0gKG8gPT0gInRydWUiIHx8ICFpc05hTihvKSAmJiAhIXBhcnNlSW50KG8sIDEwKSk7DQoJCQkJCQkJCQl9IGVsc2UgaWYgKFdpbkNvbmZpZy5GaWVsZEZvcm1hdC5OVU1CRVIgJiBmaWVsZC5mb3JtYXQpIHsNCgkJCQkJCQkJCQljZmdbZmllbGQubmFtZV0gPSBwYXJzZUludChvLCAxMCk7DQoJCQkJCQkJCQl9IGVsc2Ugew0KCQkJCQkJCQkJCWNmZ1tmaWVsZC5uYW1lXSA9IG87DQoJCQkJCQkJCQl9DQoJCQkJCQkJCX0NCgkJCQkJCQl9IGVsc2UgaWYgKCEoZmllbGQubmFtZSBpbiBjZmcpKSB7DQoJCQkJCQkJCWlmICgiZW1wdHkiIGluIGZpZWxkKSB7DQoJCQkJCQkJCQljZmdbZmllbGQubmFtZV0gPSBmaWVsZC5lbXB0eTsNCgkJCQkJCQkJfSBlbHNlIGlmIChXaW5Db25maWcuRmllbGRGb3JtYXQuTlVNQkVSICYgZmllbGQuZm9ybWF0KSB7DQoJCQkJCQkJCQljZmdbZmllbGQubmFtZV0gPSAwOw0KCQkJCQkJCQl9IGVsc2UgaWYgKGZpZWxkLm11bHRpcGxlKSB7DQoJCQkJCQkJCQljZmdbZmllbGQubmFtZV0gPSBbXTsNCgkJCQkJCQkJfQ0KCQkJCQkJCX0NCgkJCQkJCX0gZWxzZSBpZiAoV2luQ29uZmlnLkZpZWxkVHlwZS5URVhUID09IGZpZWxkLnR5cGUgJiYgKFdpbkNvbmZpZy5GaWVsZEZvcm1hdC5BUlJBWSAmIGZpZWxkLmZvcm1hdCkpIHsNCgkJCQkJCQl2YXIgYXJyID0gZWxlbS52YWx1ZS5zcGxpdCgiXG4iKTsNCgkJCQkJCQlpZiAoV2luQ29uZmlnLkZpZWxkRm9ybWF0Lk5VTUJFUiAmIGZpZWxkLmZvcm1hdCkgew0KCQkJCQkJCQlhcnIgPSBhcnIubWFwKGZ1bmN0aW9uICh2KSB7DQoJCQkJCQkJCQlyZXR1cm4gcGFyc2VJbnQodiwgMTApOw0KCQkJCQkJCQl9KTsNCgkJCQkJCQl9IGVsc2UgaWYgKFdpbkNvbmZpZy5GaWVsZEZvcm1hdC5CT09MRUFOICYgZmllbGQuZm9ybWF0KSB7DQoJCQkJCQkJCWFyciA9IGFyci5tYXAoZnVuY3Rpb24gKHYpIHsNCgkJCQkJCQkJCXJldHVybiAodiA9PSAidHJ1ZSIgfHwgIWlzTmFOKHYpICYmICEhcGFyc2VJbnQodiwgMTApKTsNCgkJCQkJCQkJfSk7DQoJCQkJCQkJfQ0KCQkJCQkJCWNmZ1tmaWVsZC5uYW1lXSA9IGFycjsNCgkJCQkJCX0gZWxzZSBpZiAoV2luQ29uZmlnLkZpZWxkVHlwZS5URVhUID09IGZpZWxkLnR5cGUgfHwgV2luQ29uZmlnLkZpZWxkVHlwZS5ISURERU4gPT0gZmllbGQudHlwZSB8fCBXaW5Db25maWcuRmllbGRUeXBlLlBBU1NXT1JEID09IGZpZWxkLnR5cGUpIHsNCgkJCQkJCQl2YXIgeDsNCgkJCQkJCQlpZiAoV2luQ29uZmlnLkZpZWxkRm9ybWF0Lk5VTUJFUiAmIGZpZWxkLmZvcm1hdCkgew0KCQkJCQkJCQlpZiAoZWxlbS52YWx1ZSkgew0KCQkJCQkJCQkJeCA9IHBhcnNlSW50KGVsZW0udmFsdWUsIDEwKTsNCgkJCQkJCQkJfSBlbHNlIGlmICgiZW1wdHkiIGluIGZpZWxkKSB7DQoJCQkJCQkJCQl4ID0gZmllbGQuZW1wdHk7DQoJCQkJCQkJCX0NCgkJCQkJCQl9IGVsc2Ugew0KCQkJCQkJCQl4ID0gZWxlbS52YWx1ZTsNCgkJCQkJCQl9DQoNCgkJCQkJCQlpZiAoV2luQ29uZmlnLkZpZWxkRm9ybWF0LkFSUkFZICYgZmllbGQuZm9ybWF0KSB7DQoJCQkJCQkJCWlmIChmaWVsZC5uYW1lIGluIGNmZykgew0KCQkJCQkJCQkJY2ZnW2ZpZWxkLm5hbWVdLnB1c2goeCk7DQoJCQkJCQkJCX0gZWxzZSB7DQoJCQkJCQkJCQljZmdbZmllbGQubmFtZV0gPSBbeF07DQoJCQkJCQkJCX0NCgkJCQkJCQl9IGVsc2Ugew0KCQkJCQkJCQljZmdbZmllbGQubmFtZV0gPSB4Ow0KCQkJCQkJCX0NCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCX0NCg0KCQkJCWlmIChfdGhpcy5zdG9yZSkgew0KCQkJCQlHTV9zZXRWYWx1ZSh2biwgR01faW5mby5zY3JpcHQudmVyc2lvbik7DQoJCQkJfQ0KCQkJCQ0KCQkJCXJldHVybiBjZmc7DQoJCQl9KHRoaXMsIHt9KSk7DQoNCgkJCXZhciB0bXBDb25maWcgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGNvbmZpZykpLA0KCQkJeENsb3NlID0gdHJ1ZTsNCg0KCQkJaWYgKCJncm91cCIgaW4gdGhpcykgew0KCQkJCXRtcENvbmZpZ1t0aGlzLmdyb3VwXSA9IF9jb25maWc7DQoJCQl9IGVsc2Ugew0KCQkJCXRtcENvbmZpZyA9IF9jb25maWc7DQoJCQl9DQoNCgkJCWlmICgibG9hZCIgaW4gdGhpcykgew0KCQkJCXhDbG9zZSA9IChmYWxzZSAhPT0gdGhpcy5sb2FkKHRtcENvbmZpZykpOw0KCQkJfQ0KDQoJCQlpZiAoeENsb3NlKSB7DQoJCQkJaWYgKHRoaXMuc3RvcmUpIHsNCgkJCQkJR01fc2V0VmFsdWUoImNvbmZpZy0iICsgdGhpcy5uYW1lLCBKU09OLnN0cmluZ2lmeShjb25maWcgPSB0bXBDb25maWcpKTsNCgkJCQl9DQoNCgkJCQlfY2xvc2UoKTsNCgkJCX0NCgkJfV0sWyJyZXNldCIsIGZ1bmN0aW9uICgpIHsNCgkJfV1dW3RdOw0KCX07DQoJDQoJdGhpcy5nZXQgPSBmdW5jdGlvbiAodiwgZCkgew0KCQlpZiAoImdyb3VwIiBpbiB0aGlzKSB7DQoJCQlyZXR1cm4gKHRoaXMuZ3JvdXAgaW4gY29uZmlnICYmIHYgaW4gY29uZmlnW3RoaXMuZ3JvdXBdP2NvbmZpZ1t0aGlzLmdyb3VwXVt2XTpkKTsNCgkJfSBlbHNlIHsNCgkJCXJldHVybiAodiBpbiBjb25maWc/Y29uZmlnW3ZdOmQpOw0KCQl9DQoJfQ0KDQoJZm9yICh2YXIgYWkgaW4gdG1wQnV0dG9uKSB7DQoJCXZhciBidG4gPSB0bXBCdXR0b25bYWldLA0KCQlwMmFpID0gTWF0aC5wb3coMiwgYWkpOw0KDQoJCWlmICh0aGlzLmJ1dHRvbnMgJiBwMmFpKSB7DQoJCQl2YXIgYiA9IHRiKGJ0blsxXSksDQoJCQl0ID0gew0KCQkJCXR5cGUJOiBiWzBdLA0KCQkJCXZhbHVlCTogYnRuWzBdLA0KCQkJCWZvY3VzZWQJOiAhIShwYXJhbXMuZm9jdXM/cGFyYW1zLmZvY3VzID09IHAyYWk6YnRuWzJdKSwNCgkJCQlldmVudHMJOiB7DQoJCQkJCWNsaWNrCTogYlsxXSwNCgkJCQl9LA0KCQkJfTsNCg0KCQkJYnV0dG9ucy5wdXNoKHQpOw0KCQl9DQoJfQ0KCQ0KCW1haW4uc2V0QXR0cmlidXRlKCJjbGFzcyIsICJ3aW5jb25maWcgd2luQ29uZmlnXyIgKyB0aGlzLm5hbWUgKyAiICIgKyBbIiIsICJlcnJvciIsICJleHBsYW5hdGlvbiIsICJxdWVzdGlvbiIsICJwcm9tcHQiLCAid2FybmluZyIsICJzdWNjZXNzIl1bdGhpcy50eXBlXSk7DQoJaGVhZC5zZXRBdHRyaWJ1dGUoImNsYXNzIiwgImhlYWQiKTsNCglib2R5LnNldEF0dHJpYnV0ZSgiY2xhc3MiLCAiYm9keSIpOw0KCWZvb3Quc2V0QXR0cmlidXRlKCJjbGFzcyIsICJmb290Iik7DQoJb3BhcXVlLnNldEF0dHJpYnV0ZSgiY2xhc3MiLCAib3BhcXVlIik7DQoNCgltYWluLnN0eWxlLndpZHRoID0gdGhpcy5zaXplWzBdOw0KCW1haW4uc3R5bGUubWF4V2lkdGggPSB0aGlzLnNpemVbMF07DQoJaWYgKHRoaXMuc2l6ZVsxXSkgew0KCQltYWluLnN0eWxlLmhlaWdodCA9IHRoaXMuc2l6ZVsxXTsNCgkJbWFpbi5zdHlsZS5tYXhIZWlnaHQgPSB0aGlzLnNpemVbMV07DQoJfQ0KDQoJaWYgKHRoaXMudGl0bGUpIHsNCgkJdmFyIHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQoJCXRpdGxlLnNldEF0dHJpYnV0ZSgiY2xhc3MiLCAidGl0bGUiKTsNCgkJdGl0bGUudGV4dENvbnRlbnQgPSB0aGlzLnRpdGxlOw0KCQloZWFkLmFwcGVuZENoaWxkKHRpdGxlKTsNCgl9DQoJaWYgKHRoaXMuZGVzY3JpcHRpb24pIHsNCgkJdmFyIGRlc2MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsNCgkJZGVzYy5zZXRBdHRyaWJ1dGUoImNsYXNzIiwgImRlc2NyaXB0aW9uIik7DQoJCWRlc2MuaW5uZXJIVE1MID0gdGhpcy5kZXNjcmlwdGlvbjsNCgkJaGVhZC5hcHBlbmRDaGlsZChkZXNjKTsNCgl9DQoJDQoJZm9yICh2YXIgYWkgaW4gYnV0dG9ucykgew0KCQl2YXIgYnV0dG9uID0gYnV0dG9uc1thaV0sDQoJCWlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTsNCg0KCQlpbnB1dC5zZXRBdHRyaWJ1dGUoInR5cGUiLCBidXR0b24udHlwZSk7DQoJCWlucHV0LnNldEF0dHJpYnV0ZSgidmFsdWUiLCBidXR0b24udmFsdWUpOw0KCQlpZiAoYnV0dG9uLmZvY3VzZWQpIHsNCgkJCWlucHV0LnNldEF0dHJpYnV0ZSgiZGVmYXVsdCIsICJkZWZhdWx0Iik7DQoJCQlmb2N1c2VkSW5wdXQgPSBpbnB1dDsNCgkJfQ0KCQkNCgkJZm9yICh2YXIgYmkgaW4gYnV0dG9uLmV2ZW50cykgew0KCQkJYWRkRXZlbnQoaW5wdXQsIGJpLCBidXR0b24uZXZlbnRzW2JpXSwgX3RoaXMpOw0KCQl9DQoJCQ0KCQlmb290LmFwcGVuZENoaWxkKGlucHV0KTsNCgl9DQoNCgl0aGlzLm9wZW4gPSBmdW5jdGlvbiAoKSB7DQoJCVdpbkNvbmZpZy5fX29wZW5lZFdpbmRvd3MucHVzaCh0aGlzKTsNCg0KCQlpZiAodGhpcy5wYXJlbnQpIHsNCgkJCXRoaXMucGFyZW50LmNoaWxkcmVuLnB1c2godGhpcyk7DQoJCX0NCgkNCgkJdGhpcy5kb2N1bWVudC5hcHBlbmRDaGlsZChvcGFxdWUpOw0KCQl0aGlzLmRvY3VtZW50LmFwcGVuZENoaWxkKG1haW4pOw0KDQoJCShmdW5jdGlvbiByZWN1cnNpdmUgKF90aGlzLCBjZmcpIHsNCgkJCWZvciAodmFyIGFpIGluIF90aGlzLmZpZWxkcykgew0KCQkJCXZhciBmaWVsZCA9IF90aGlzLmZpZWxkc1thaV07DQoNCgkJCQlpZiAoZmllbGQubmFtZSBpbiBjZmcpIHsNCgkJCQkJdmFyIGMgPSBjZmdbZmllbGQubmFtZV07DQoNCgkJCQkJZm9yICh2YXIgYmkgaW4gZmllbGQuZWxlbWVudHMpIHsNCgkJCQkJCXZhciBlbGVtID0gZmllbGQuZWxlbWVudHNbYmldOw0KDQoJCQkJCQlpZiAoV2luQ29uZmlnLkZpZWxkVHlwZS5HUk9VUCA9PSBmaWVsZC50eXBlKSB7DQoJCQkJCQkJcmVjdXJzaXZlKGZpZWxkLCBjKTsNCgkJCQkJCX0gZWxzZSBpZiAoV2luQ29uZmlnLkZpZWxkVHlwZS5DSEVDSyA9PSBmaWVsZC50eXBlKSB7DQoJCQkJCQkJdmFyIHRtcCA9IGVsZW0uY2hlY2tlZDsNCgkJCQkJCQlpZiAoZmllbGQudW5pcXVlICYmIChXaW5Db25maWcuRmllbGRGb3JtYXQuTlVNQkVSICYgZmllbGQuZm9ybWF0KSkgew0KCQkJCQkJCQl0bXAgPSAhKGVsZW0udmFsdWUgJiB+KGMgJiBlbGVtLnZhbHVlKSk7DQoJCQkJCQkJfSBlbHNlIGlmIChjIGluc3RhbmNlb2YgQXJyYXkpIHsNCgkJCQkJCQkJdG1wID0gZmFsc2U7DQoNCgkJCQkJCQkJZm9yICh2YXIgY2kgaW4gYykgew0KCQkJCQkJCQkJaWYgKGNbY2ldID09IGVsZW0udmFsdWUpIHsNCgkJCQkJCQkJCQl0bXAgPSB0cnVlOw0KCQkJCQkJCQkJCWJyZWFrOw0KCQkJCQkJCQkJfQ0KCQkJCQkJCQl9DQoJCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQkJdG1wID0gKFN0cmluZyhjKSA9PSBlbGVtLnZhbHVlKTsNCgkJCQkJCQl9DQoNCgkJCQkJCQlpZiAoZWxlbS5jaGVja2VkICE9IHRtcCkgew0KCQkJCQkJCQllbGVtLmNsaWNrKCk7DQovLwkJCQkJCQkJZWxlbS5jaGVja2VkID0gdG1wOw0KCQkJCQkJCX0NCgkJCQkJCX0gZWxzZSBpZiAoV2luQ29uZmlnLkZpZWxkVHlwZS5TRUxFQ1QgPT0gZmllbGQudHlwZSkgew0KCQkJCQkJCWZvciAodmFyIGRpIGluIGZpZWxkLnZhbHVlKSB7DQoJCQkJCQkJCXZhciBlbGVtMiA9IGZpZWxkLnZhbHVlW2RpXS5lbGVtZW50c1swXSwNCgkJCQkJCQkJdG1wID0gZWxlbTIuc2VsZWN0ZWQ7DQoNCgkJCQkJCQkJaWYgKGZpZWxkLnVuaXF1ZSAmJiAoV2luQ29uZmlnLkZpZWxkRm9ybWF0Lk5VTUJFUiAmIGZpZWxkLmZvcm1hdCkpIHsNCgkJCQkJCQkJCXRtcCA9ICEoZWxlbTIudmFsdWUgJiB+KGMgJiBlbGVtMi52YWx1ZSkpOw0KCQkJCQkJCQl9IGVsc2UgaWYgKGMgaW5zdGFuY2VvZiBBcnJheSkgew0KCQkJCQkJCQkJdG1wID0gZmFsc2U7DQoNCgkJCQkJCQkJCWZvciAodmFyIGNpIGluIGMpIHsNCgkJCQkJCQkJCQlpZiAoY1tjaV0gPT0gZWxlbTIudmFsdWUpIHsNCgkJCQkJCQkJCQkJdG1wID0gdHJ1ZTsNCgkJCQkJCQkJCQkJYnJlYWs7DQoJCQkJCQkJCQkJfQ0KCQkJCQkJCQkJfQ0KCQkJCQkJCQl9IGVsc2Ugew0KCQkJCQkJCQkJdG1wID0gKGMgPT0gZWxlbTIudmFsdWUpOw0KCQkJCQkJCQl9DQoNCgkJCQkJCQkJaWYgKGVsZW0yLnNlbGVjdGVkICE9IHRtcCkgew0KCQkJCQkJCQkJZWxlbTIuc2VsZWN0ZWQgPSB0bXA7DQoNCi8vCQkJCQkJCQkJZWxlbTIuY2xpY2soKTsNCi8vCQkJCQkJCQkJdmFyIGV2T2JqID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoIk1vdXNlRXZlbnRzIik7DQovLwkJCQkJCQkJCWV2T2JqLmluaXRNb3VzZUV2ZW50KCJjbGljayIsIHRydWUsIHRydWUsIHdpbmRvdywgMCwgMCwgMCwgMCwgMCwgdHJ1ZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgMCwgbnVsbCk7DQovLwkJCQkJCQkJCWVsZW0yLmRpc3BhdGNoRXZlbnQoZXZPYmopOw0KCQkJCQkJCQl9DQoJCQkJCQkJfQ0KCQkJCQkJfSBlbHNlIGlmIChXaW5Db25maWcuRmllbGRUeXBlLlRFWFQgPT0gZmllbGQudHlwZSAmJiAoV2luQ29uZmlnLkZpZWxkRm9ybWF0LkFSUkFZICYgZmllbGQuZm9ybWF0KSkgew0KCQkJCQkJCWVsZW0udmFsdWUgPSBjLmpvaW4oIlxuIik7DQoJCQkJCQl9IGVsc2UgaWYgKFdpbkNvbmZpZy5GaWVsZFR5cGUuVEVYVCA9PSBmaWVsZC50eXBlIHx8IFdpbkNvbmZpZy5GaWVsZFR5cGUuSElEREVOID09IGZpZWxkLnR5cGUgfHwgV2luQ29uZmlnLkZpZWxkVHlwZS5QQVNTV09SRCA9PSBmaWVsZC50eXBlKSB7DQoJCQkJCQkJZWxlbS52YWx1ZSA9IGM7DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoJCX0odGhpcywgKHRoaXMuZ3JvdXAgaW4gY29uZmlnP2NvbmZpZ1t0aGlzLmdyb3VwXTpjb25maWcpKSk7DQoJDQoJCW1haW4uc3R5bGUubGVmdCA9ICh0aGlzLnBvc2l0aW9uWzBdID09IC0xID8gTWF0aC5mbG9vcigod2luZG93LmlubmVyV2lkdGggLyAyKSAtIChtYWluLm9mZnNldFdpZHRoIC8gMikpIDogdGhpcy5wb3NpdGlvblswXSkgKyAicHgiOw0KCQltYWluLnN0eWxlLnRvcCA9ICh0aGlzLnBvc2l0aW9uWzFdID09IC0xID8gTWF0aC5mbG9vcigod2luZG93LmlubmVySGVpZ2h0IC8gMikgLSAobWFpbi5vZmZzZXRIZWlnaHQgLyAyKSkgOiB0aGlzLnBvc2l0aW9uWzFdKSArICJweCI7DQoNCgkJaWYgKGZvY3VzZWRJbnB1dCkgew0KCQkJZm9jdXNlZElucHV0LnNlbGVjdCgpOw0KCQkJZm9jdXNlZElucHV0LmZvY3VzKCk7DQoJCX0NCgl9Ow0KDQoJdGhpcy5jbG9zZSA9IGZ1bmN0aW9uICgpIHsNCgkJaWYgKCJ1bmxvYWQiIGluIHRoaXMpIHsNCgkJCXRoaXMudW5sb2FkKCk7DQoJCX0NCg0KCQlfY2xvc2UoKTsNCgl9Ow0KDQoJbWFpbi5zZXRBdHRyaWJ1dGUoIm9uc3VibWl0IiwgInJldHVybiBmYWxzZSIpOw0KCQ0KCShmdW5jdGlvbiByZWN1cnNpdmUgKF9wYXJlbnQsIGJvZHkpIHsNCgkJZm9yICh2YXIgYWkgaW4gX3BhcmVudC5maWVsZHMpIHsNCgkJCXZhciBmbGQgPSBfcGFyZW50LmZpZWxkc1thaV0sDQoJCQlmaWVsZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpLA0KCQkJZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQoJCQlkZXNjMiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpLA0KCQkJdG1wID0gew0KCQkJCWNsYXNzCTogImRlZmF1bHQiLA0KCQkJCXR5cGUJOiBXaW5Db25maWcuRmllbGRUeXBlLlRFWFQsDQoJCQkJZm9ybWF0CTogV2luQ29uZmlnLkZpZWxkRm9ybWF0LlNUUklORywNCgkJCX07DQoJCQkNCgkJCWlmIChmbGQua2V5IGluIFdpbkNvbmZpZy5DdXN0b21GaWVsZCkgew0KCQkJCXZhciB4ID0gbmV3IFdpbkNvbmZpZy5DdXN0b21GaWVsZFtmbGQua2V5XShfdGhpcyk7DQoJCQkJZm9yICh2YXIgYmkgaW4gZmxkKSB7DQoJCQkJCXhbYmldID0gZmxkW2JpXTsNCgkJCQl9DQoJCQkJX3BhcmVudC5maWVsZHNbYWldID0gZmxkID0geDsNCgkJCX0NCg0KCQkJZm9yICh2YXIgYmkgaW4gdG1wKSB7DQoJCQkJaWYgKCEoYmkgaW4gZmxkKSkgew0KCQkJCQlmbGRbYmldID0gdG1wW2JpXTsNCgkJCQl9DQoJCQl9DQoJCQkNCgkJCWlmICh0eXBlb2YgX3BhcmVudC5kZWZhdWx0ID09ICJvYmplY3QiICYmIGZsZC5uYW1lIGluIF9wYXJlbnQuZGVmYXVsdCkgew0KCQkJCWZsZC5kZWZhdWx0ID0gX3BhcmVudC5kZWZhdWx0W2ZsZC5uYW1lXTsNCgkJCX0NCgkJCWZsZC5wYXJlbnQgPSBfcGFyZW50Ow0KCQkJDQoJCQlkZXNjMi5zZXRBdHRyaWJ1dGUoImNsYXNzIiwgImRlc2NyaXB0aW9uIik7DQoJCQlkZXNjMi5pbm5lckhUTUwgPSBmbGQuZGVzY3JpcHRpb247DQoJCQlkaXYuc2V0QXR0cmlidXRlKCJjbGFzcyIsICJmaWVsZENsYXNzXyIgKyBmbGQuY2xhc3MgKyAiIGZpZWxkTmFtZV8iICsgZmxkLm5hbWUgKyAiIGZpZWxkUGFyZW50XyIgKyBfcGFyZW50Lm5hbWUgKyAiIGZpZWxkVHlwZV8iICsgZmxkLnR5cGUgKyAiIGZpZWxkIik7DQoJCQkNCgkJCWlmICgoV2luQ29uZmlnLkZpZWxkVHlwZS5HUk9VUCA9PSBmbGQudHlwZSAmJiAoKCJsYWJlbCIgaW4gZmxkKSB8fCAhZmxkLm5vZ3JvdXApKSB8fCAoKCJ2YWx1ZSIgaW4gZmxkKSAmJiBmbGQudmFsdWUubGVuZ3RoID4gMSAmJiBXaW5Db25maWcuRmllbGRUeXBlLkNIRUNLID09IGZsZC50eXBlICYmICFmbGQubm9ncm91cCkpIHsNCgkJCQl2YXIgZmllbGRzZXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJmaWVsZHNldCIpOw0KCQkJCQ0KCQkJCWlmICgibGFiZWwiIGluIGZsZCAmJiBmbGQubGFiZWwpIHsNCgkJCQkJdmFyIGxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgibGVnZW5kIik7DQoJCQkJCWxhYmVsLmlubmVySFRNTCA9IGZsZC5sYWJlbDsNCgkJCQkJDQoJCQkJCWZpZWxkc2V0LmFwcGVuZENoaWxkKGxhYmVsKTsNCgkJCQl9DQoNCgkJCQlpZiAoImRlc2NyaXB0aW9uIiBpbiBmbGQpIHsNCgkJCQkJZmllbGRzZXQuYXBwZW5kQ2hpbGQoZGVzYzIpOw0KCQkJCX0NCg0KCQkJCWZpZWxkc2V0LmFwcGVuZENoaWxkKGZpZWxkKTsNCg0KCQkJCWRpdi5hcHBlbmRDaGlsZChmaWVsZHNldCk7DQoJCQl9IGVsc2Ugew0KCQkJCWlmICgibGFiZWwiIGluIGZsZCkgew0KCQkJCQl2YXIgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJsYWJlbCIpOw0KDQoJCQkJCWxhYmVsLmlubmVySFRNTCA9IGZsZC5sYWJlbDsNCg0KCQkJCQlkaXYuYXBwZW5kQ2hpbGQobGFiZWwpOw0KCQkJCX0NCg0KCQkJCWlmIChmbGQuaGVscCkgew0KCQkJCQl2YXIgaGVscCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpLA0KCQkJCQlpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbWciKTsNCgkJCQkJaGVscC5zZXRBdHRyaWJ1dGUoImNsYXNzIiwgImhlbHAiKTsNCgkJCQkJaW1nLnNldEF0dHJpYnV0ZSgic3JjIiwgImRhdGE6aW1hZ2UvZ2lmO2Jhc2U2NCxSMGxHT0RsaERnQU9BT1lBQUFBY2txdTkzakNDMVFCbXpON244MmlCd21DQ3djM1Y2akZodFNWWHJ3QkR0Z0NDNlZ6SS8zYXE0UjV0eSsveSthTE04RjJUMURPUjVBQStxRytiMHdCU3ZNM20ra2g1dzRtcDJ3QnoyOTd1L0VxRXpYbWYxMXVjM0NPTzVSZGJ1TExJNWgrWTlmLy8veko5MEFBcG5RQnQxQmRMcDgzcy8waHV1R0NuNXVmMi84M2M4V2lkM1NseXlHYUx5RDZDMEFCMTU2WEQ2QUJielhXTHhTOVVxZUhzK0VxUTEzT3k2Mmk2OXdDTSt2bjQrWlc0NGtDWjVnQkt0eXBkczg3ZzlXdVV4UUJxNUNsNzBBSkhyQUF5cCtQeCt3Rlp2MDV6dXRuajhuV1kwNGVuMW5tcDQwOTZ3SFdvNHRuMC93Wmh4ZVRxOUx2TjZHU3Q2MkdLeTBDTTJRQjc3Z0JJdndCNzRpcFlyT1h1K0syOTVzN1o3aU4welFCQ3F0Zmc3MlNFd3VuKy8yQ1cxbUNmM3F2SjZnQXptUUFna3dDQjdIT3Y1NnJPOEd1bDNpbDF5bm1QeGtxVTF2ejQrWnU1NEFCYnhuYWYxUC8vL3dBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQ0g1QkFFSEFIRUFMQUFBQUFBT0FBNEFBQWU5Z0hHQ1AySkNYRnhxWVN1Q2pFczJFQllhR2o4eEd4eU1UVTFPT0R3M04xUnBSWEJKY1Q4MllDRXBJbTF0SWhFT0doZGJZbWdNUVFRaUFsd2lTQW9kQVZOQ0tqbG1IaEp2TVNKdUNncFpQaU5PVlFzd01qc2lJRDA5UkZrSkx5Y3dWeGxQSWc4SzJTVGNMU3JoSlJWUlNsMDlFMlJRV0dGalVqSURSbE11UTExbHZnUXdzR0pERVFGV1BvZ1FZUUlBRFNnb0RzVEJRS0VJaXlGTWpwQXBBQVhJREVaS0xtaXBzY1VMbEFBbzFqQVN0R1dLRHdRSnNCaVFLQ2dRQURzPSIpOw0KCQkJCQlpbWcuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoZnVuY3Rpb24gKGZpZWxkKSB7DQoJCQkJCQlyZXR1cm4gZnVuY3Rpb24gKGUpIHsNCgkJCQkJCQl2YXIgdGV4dCA9IFtmaWVsZC5kZXNjcmlwdGlvbl07DQoJCQkJCQkJaWYgKCJkZWZhdWx0IiBpbiBmaWVsZCkgew0KCQkJCQkJCQl0ZXh0LnB1c2goIjxzdWI+PGI+RGVmYXVsdCB2YWx1ZTo8L2I+ICIgKyBmaWVsZC5kZWZhdWx0ICsgIjwvc3ViPiIpOw0KCQkJCQkJCX0NCg0KCQkJCQkJCVdpbkNvbmZpZy5pbml0KHsNCgkJCQkJCQkJdHlwZQkJOiBXaW5Db25maWcuV2luZG93VHlwZS5FWFBMQU5BVElPTiwNCgkJCQkJCQkJdGl0bGUJCTogKCJ0aXRsZSIgaW4gZmllbGQ/ZmllbGQudGl0bGU6ZmllbGQubGFiZWwpLA0KCQkJCQkJCQlkZXNjcmlwdGlvbgk6IHRleHQuam9pbigiPGJyIC8+PGJyIC8+IiksDQoJCQkJCQkJCXBhcmVudAk6IF90aGlzLA0KCQkJCQkJCX0pOw0KCQkJCQkJfTsNCgkJCQkJfShmbGQpKSwgZmFsc2UpOw0KDQoJCQkJCWhlbHAuYXBwZW5kQ2hpbGQoaW1nKTsNCgkJCQkJZGl2LmFwcGVuZENoaWxkKGhlbHApOw0KCQkJCX0gZWxzZSBpZiAoImRlc2NyaXB0aW9uIiBpbiBmbGQpIHsNCgkJCQkJZGl2LmFwcGVuZENoaWxkKGRlc2MyKTsNCgkJCQl9DQoNCgkJCQlkaXYuYXBwZW5kQ2hpbGQoZmllbGQpOw0KCQkJfQ0KDQoJCQlpZiAoV2luQ29uZmlnLkZpZWxkVHlwZS5HUk9VUCA9PSBmbGQudHlwZSkgew0KCQkJCWZsZC5lbGVtZW50cyA9IFtmaWVsZF07DQoNCgkJCQlyZWN1cnNpdmUoZmxkLCBmaWVsZCk7DQoJCQl9IGVsc2UgaWYgKGZsZC5tdWx0aXBsZSAmJiBXaW5Db25maWcuRmllbGRUeXBlLlRFWFQgPT0gZmxkLnR5cGUpIHsNCgkJCQl2YXIgZmYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZXh0YXJlYSIpOw0KCQkJCWZsZC5lbGVtZW50cyA9IFtmZl07DQoNCgkJCQlmZi5zZXRBdHRyaWJ1dGUoIm5hbWUiLCBmbGQubmFtZSk7DQoJCQkJaWYgKCJkZWZhdWx0IiBpbiBmbGQpIHsNCgkJCQkJZmYuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoKFdpbkNvbmZpZy5GaWVsZEZvcm1hdC5BUlJBWSAmIGZsZC5mb3JtYXQpICYmIGZsZC5kZWZhdWx0IGluc3RhbmNlb2YgQXJyYXk/ZmxkLmRlZmF1bHQuam9pbigiXG4iKTpmbGQuZGVmYXVsdCkpOw0KCQkJCX0NCg0KCQkJCWZpZWxkLmFwcGVuZENoaWxkKGZmKTsNCgkJCX0gZWxzZSBpZiAoV2luQ29uZmlnLkZpZWxkVHlwZS5TRUxFQ1QgPT0gZmxkLnR5cGUpIHsNCgkJCQl2YXIgZmYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzZWxlY3QiKTsNCgkJCQlmbGQuZWxlbWVudHMgPSBbZmZdOw0KCQkJCQ0KCQkJCWZmLnNldEF0dHJpYnV0ZSgibmFtZSIsIGZsZC5uYW1lKTsNCgkJCQkNCgkJCQlpZiAoISgiZXZlbnRzIiBpbiBmbGQpKSB7DQoJCQkJCWZsZC5ldmVudHMgPSB7fTsNCgkJCQl9DQoNCgkJCQlpZiAoZmxkLm11bHRpcGxlKSB7DQoJCQkJCWZmLnNldEF0dHJpYnV0ZSgibXVsdGlwbGUiLCAibXVsdGlwbGUiKTsNCg0KCQkJCQlpZiAoZmxkLnVuaXF1ZSAmJiAoV2luQ29uZmlnLkZpZWxkRm9ybWF0Lk5VTUJFUiAmIGZsZC5mb3JtYXQpKSB7DQoJCQkJCQlpZiAoIShmbGQudmFsdWUgJiB+KGZsZC5kZWZhdWx0ICYgZmxkLnZhbHVlKSkpIHsNCgkJCQkJCQlmZi5zZXRBdHRyaWJ1dGUoInNlbGVjdGVkIiwgInNlbGVjdGVkIik7DQoJCQkJCQl9DQoNCgkJCQkJCWZsZC5ldmVudHMuY2hhbmdlID0gZnVuY3Rpb24gKGUpIHsNCgkJCQkJCQlmb3IgKHZhciBiaSA9IGUudGFyZ2V0LnNlbGVjdGVkSW5kZXg7IGJpIDwgZS50YXJnZXQub3B0aW9ucy5sZW5ndGg7KytiaSkgew0KCQkJCQkJCQl2YXIgb3B0ID0gZS50YXJnZXQub3B0aW9uc1tiaV07DQoNCgkJCQkJCQkJaWYgKG9wdC5zZWxlY3RlZCkgew0KCQkJCQkJCQkJZm9yICh2YXIgYWkgaW4gdGhpcy52YWx1ZSkgew0KCQkJCQkJCQkJCXZhciBmID0gdGhpcy52YWx1ZVthaV07DQoNCgkJCQkJCQkJCQlpZiAob3B0LnZhbHVlICYgZi52YWx1ZSkgew0KCQkJCQkJCQkJCQlmLmVsZW1lbnRzWzBdLnNlbGVjdGVkID0gIShmLnZhbHVlICYgfihvcHQudmFsdWUgJiBmLnZhbHVlKSk7DQoJCQkJCQkJCQkJfQ0KCQkJCQkJCQkJfQ0KCQkJCQkJCQl9DQoJCQkJCQkJfQ0KCQkJCQkJfTsNCgkJCQkJfQ0KCQkJCX0NCg0KCQkJCWZvciAodmFyIGNpIGluIGZsZC5ldmVudHMpIHsNCgkJCQkJYWRkRXZlbnQoZmYsIGNpLCBmbGQuZXZlbnRzW2NpXSwgZmxkKTsNCgkJCQl9DQoJCQkJDQoJCQkJZm9yICh2YXIgYmkgaW4gZmxkLnZhbHVlKSB7DQoJCQkJCXZhciBpbnB1dCA9IGZsZC52YWx1ZVtiaV07DQoNCgkJCQkJaW5wdXQuZWxlbWVudHMgPSBbbmV3IE9wdGlvbihpbnB1dC5sYWJlbCwgaW5wdXQudmFsdWUpXTsNCgkJCQkJDQoJCQkJCWlmICgiZGVmYXVsdCIgaW4gZmxkKSB7DQoJCQkJCQlpZiAoZmxkLmRlZmF1bHQgaW5zdGFuY2VvZiBBcnJheSkgew0KCQkJCQkJCWZvciAodmFyIGNpIGluIGZsZC5kZWZhdWx0KSB7DQoJCQkJCQkJCWlmIChmbGQuZGVmYXVsdFtjaV0gPT0gaW5wdXQudmFsdWUpIHsNCgkJCQkJCQkJCWlucHV0LmVsZW1lbnRzWzBdLnNldEF0dHJpYnV0ZSgic2VsZWN0ZWQiLCAic2VsZWN0ZWQiKTsNCgkJCQkJCQkJfQ0KCQkJCQkJCX0NCgkJCQkJCX0gZWxzZSBpZiAoZmxkLmRlZmF1bHQgPT0gaW5wdXQudmFsdWUpIHsNCgkJCQkJCQlpbnB1dC5lbGVtZW50c1swXS5zZXRBdHRyaWJ1dGUoInNlbGVjdGVkIiwgInNlbGVjdGVkIik7DQoJCQkJCQl9DQoJCQkJCX0gZWxzZSBpZiAoZmxkLmVtcHR5ID09IGlucHV0LnZhbHVlKSB7DQoJCQkJCQlpbnB1dC5lbGVtZW50c1swXS5zZXRBdHRyaWJ1dGUoInNlbGVjdGVkIiwgInNlbGVjdGVkIik7DQoJCQkJCX0NCg0KCQkJCQlmZi5hZGQoaW5wdXQuZWxlbWVudHNbMF0pOw0KCQkJCX0NCgkJCQkNCgkJCQlmaWVsZC5hcHBlbmRDaGlsZChmZik7DQoJCQl9IGVsc2UgaWYgKFdpbkNvbmZpZy5GaWVsZFR5cGUuQ0hFQ0sgPT0gZmxkLnR5cGUpIHsNCgkJCQlmbGQuZWxlbWVudHMgPSBbXTsNCg0KCQkJCWlmICghKCJlbXB0eSIgaW4gZmxkKSkgew0KCQkJCQlmbGQuZW1wdHkgPSBmYWxzZTsNCgkJCQl9DQoNCgkJCQl2YXIgZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7DQoJCQkJZS5zZXRBdHRyaWJ1dGUoIm5hbWUiLCBmbGQubmFtZSk7DQoJCQkJZS5zZXRBdHRyaWJ1dGUoInZhbHVlIiwgZmxkLmVtcHR5KTsNCgkJCQllLnNldEF0dHJpYnV0ZSgidHlwZSIsICJoaWRkZW4iKTsNCgkJCQkNCgkJCQlmbGQuZWxlbWVudHMucHVzaChlKTsNCgkJCQkNCgkJCQlmaWVsZC5hcHBlbmRDaGlsZChlKTsNCgkJCQkNCgkJCQlpZiAoZmxkLnZhbHVlIGluc3RhbmNlb2YgQXJyYXkpIHsNCgkJCQkJZm9yICh2YXIgYmkgaW4gZmxkLnZhbHVlKSB7DQoJCQkJCQl2YXIgaW5wdXQgPSBmbGQudmFsdWVbYmldLA0KCQkJCQkJZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpLA0KCQkJCQkJbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJsYWJlbCIpLA0KCQkJCQkJZmYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOw0KCQkJCQkJDQoJCQkJCQlkLnNldEF0dHJpYnV0ZSgiY2xhc3MiLCAic3ViZmllbGQiKTsNCgkJCQkJCWxhYmVsLnRleHRDb250ZW50ID0gaW5wdXQubGFiZWw7DQoNCgkJCQkJCWlucHV0LmVsZW1lbnRzID0gW2ZmXTsNCgkJCQkJCWZmLnNldEF0dHJpYnV0ZSgibmFtZSIsIGZsZC5uYW1lKTsNCgkJCQkJCWZmLnNldEF0dHJpYnV0ZSgidmFsdWUiLCBpbnB1dC52YWx1ZSk7DQoJCQkJCQlmZi5zZXRBdHRyaWJ1dGUoInR5cGUiLCAoZmxkLm11bHRpcGxlPyJjaGVja2JveCI6InJhZGlvIikpOw0KCQkJCQkJDQoJCQkJCQlpZiAoZmxkLnVuaXF1ZSAmJiBmbGQubXVsdGlwbGUgJiYgKFdpbkNvbmZpZy5GaWVsZEZvcm1hdC5OVU1CRVIgJiBmbGQuZm9ybWF0KSkgew0KCQkJCQkJCWlmICghKGlucHV0LnZhbHVlICYgfihmbGQuZGVmYXVsdCAmIGlucHV0LnZhbHVlKSkpIHsNCgkJCQkJCQkJZmYuc2V0QXR0cmlidXRlKCJjaGVja2VkIiwgImNoZWNrZWQiKTsNCgkJCQkJCQkJaW5wdXQuZGVmYXVsdCA9IHRydWU7DQoJCQkJCQkJfSBlbHNlIGlmICghKCJkZWZhdWx0IiBpbiBpbnB1dCkpIHsNCgkJCQkJCQkJaW5wdXQuZGVmYXVsdCA9IGZhbHNlOw0KCQkJCQkJCX0NCg0KCQkJCQkJCWlmICghKCJldmVudHMiIGluIGlucHV0KSkgew0KCQkJCQkJCQlpbnB1dC5ldmVudHMgPSB7fTsNCgkJCQkJCQl9DQoNCgkJCQkJCQlpbnB1dC5ldmVudHMuY2hhbmdlID0gZnVuY3Rpb24gKGUsIGZpZWxkKSB7DQoJCQkJCQkJCWZvciBlYWNoICh2YXIgZiBpbiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJkaXYuZmllbGRQYXJlbnRfIiArIHRoaXMucGFyZW50Lm5hbWUgKyAiIGlucHV0W25hbWUgPSAnIiArIGUudGFyZ2V0Lm5hbWUgKyAiJ10iKSkgew0KCQkJCQkJCQkJaWYgKGYgIT0gZS50YXJnZXQpIHsNCgkJCQkJCQkJCQl2YXIgdmFsdWUgPSAoZmllbGQudmFsdWUgJiBmLnZhbHVlKTsNCg0KCQkJCQkJCQkJCWlmICghZS50YXJnZXQuY2hlY2tlZCAmJiB2YWx1ZSB8fCB2YWx1ZSA9PSBmLnZhbHVlKSB7DQoJCQkJCQkJCQkJCWYuY2hlY2tlZCA9IGUudGFyZ2V0LmNoZWNrZWQgJiYgIShmLnZhbHVlICYgfnZhbHVlKTsNCgkJCQkJCQkJCQl9DQoJCQkJCQkJCQl9DQoJCQkJCQkJCX0NCgkJCQkJCQl9Ow0KCQkJCQkJfSBlbHNlIGlmICgiZGVmYXVsdCIgaW4gZmxkKSB7DQoJCQkJCQkJaWYgKGZsZC5kZWZhdWx0IGluc3RhbmNlb2YgQXJyYXkpIHsNCgkJCQkJCQkJZm9yICh2YXIgY2kgaW4gZmxkLmRlZmF1bHQpIHsNCgkJCQkJCQkJCWlmIChmbGQuZGVmYXVsdFtjaV0gPT0gaW5wdXQudmFsdWUpIHsNCgkJCQkJCQkJCQlmZi5zZXRBdHRyaWJ1dGUoImNoZWNrZWQiLCAiY2hlY2tlZCIpOw0KCQkJCQkJCQkJfQ0KCQkJCQkJCQl9DQoJCQkJCQkJfSBlbHNlIGlmIChmbGQuZGVmYXVsdCA9PSBpbnB1dC52YWx1ZSkgew0KCQkJCQkJCQlpbnB1dC5kZWZhdWx0ID0gdHJ1ZTsNCgkJCQkJCQkJZmYuc2V0QXR0cmlidXRlKCJjaGVja2VkIiwgImNoZWNrZWQiKTsNCgkJCQkJCQl9IGVsc2Ugew0KCQkJCQkJCQlpbnB1dC5kZWZhdWx0ID0gZmFsc2U7DQoJCQkJCQkJfQ0KCQkJCQkJfSBlbHNlIGlmIChmbGQuZW1wdHkgPT0gaW5wdXQudmFsdWUpIHsNCgkJCQkJCQlmZi5zZXRBdHRyaWJ1dGUoImNoZWNrZWQiLCAiY2hlY2tlZCIpOw0KCQkJCQkJfQ0KDQoJCQkJCQlmb3IgKHZhciBjaSBpbiBpbnB1dC5ldmVudHMpIHsNCgkJCQkJCQlhZGRFdmVudChmZiwgY2ksIGlucHV0LmV2ZW50c1tjaV0sIGZsZCwgW2lucHV0XSk7DQoJCQkJCQl9DQoNCgkJCQkJCWZsZC5lbGVtZW50cy5wdXNoKGZmKTsNCg0KCQkJCQkJZC5hcHBlbmRDaGlsZChsYWJlbCk7DQoJCQkJCQlkLmFwcGVuZENoaWxkKGZmKTsNCgkJCQkJCQ0KCQkJCQkJaWYgKF9wYXJlbnQuZXZlbnRzKSB7DQoJCQkJCQkJZm9yICh2YXIgYmkgaW4gX3BhcmVudC5ldmVudHMpIHsNCgkJCQkJCQkJZmYuYWRkRXZlbnRMaXN0ZW5lcihiaSwgX3BhcmVudC5ldmVudHNbYmldLCBmYWxzZSk7DQoJCQkJCQkJfQ0KCQkJCQkJfQ0KDQoJCQkJCQlpZiAoaW5wdXQuaGVscCkgew0KCQkJCQkJCXZhciBoZWxwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksDQoJCQkJCQkJaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW1nIik7DQoJCQkJCQkJaGVscC5zZXRBdHRyaWJ1dGUoImNsYXNzIiwgImhlbHAiKTsNCgkJCQkJCQlpbWcuc2V0QXR0cmlidXRlKCJzcmMiLCAiZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoRGdBT0FPWUFBQUFja3F1OTNqQ0MxUUJtek43bjgyaUJ3bUNDd2MzVjZqRmh0U1ZYcndCRHRnQ0M2VnpJLzNhcTRSNXR5Ky95K2FMTThGMlQxRE9SNUFBK3FHK2Iwd0JTdk0zbStraDV3NG1wMndCejI5N3UvRXFFelhtZjExdWMzQ09PNVJkYnVMTEk1aCtZOWYvLy96SjkwQUFwblFCdDFCZExwODNzLzBodXVHQ241dWYyLzgzYzhXaWQzU2x5eUdhTHlENkMwQUIxNTZYRDZBQmJ6WFdMeFM5VXFlSHMrRXFRMTNPeTYyaTY5d0NNK3ZuNCtaVzQ0a0NaNWdCS3R5cGRzODdnOVd1VXhRQnE1Q2w3MEFKSHJBQXlwK1B4K3dGWnYwNXp1dG5qOG5XWTA0ZW4xbm1wNDA5NndIV280dG4wL3daaHhlVHE5THZONkdTdDYyR0t5MENNMlFCNzdnQkl2d0I3NGlwWXJPWHUrSzI5NXM3WjdpTjB6UUJDcXRmZzcyU0V3dW4rLzJDVzFtQ2YzcXZKNmdBem1RQWdrd0NCN0hPdjU2ck84R3VsM2lsMXlubVB4a3FVMXZ6NCtadTU0QUJieG5hZjFQLy8vd0FBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFDSDVCQUVIQUhFQUxBQUFBQUFPQUE0QUFBZTlnSEdDUDJKQ1hGeHFZU3VDakVzMkVCWWFHajh4R3h5TVRVMU9PRHczTjFScFJYQkpjVDgyWUNFcEltMXRJaEVPR2hkYlltZ01RUVFpQWx3aVNBb2RBVk5DS2psbUhoSnZNU0p1Q2dwWlBpTk9WUXN3TWpzaUlEMDlSRmtKTHljd1Z4bFBJZzhLMlNUY0xTcmhKUlZSU2wwOUUyUlFXR0ZqVWpJRFJsTXVRMTFsdmdRd3NHSkRFUUZXUG9nUVlRSUFEU2dvRHNUQlFLRUlpeUZNanBBcEFBWElERVpLTG1pcHNjVUxsQUFvMWpBU3RHV0tEd1FKc0JpUUtDZ1FBRHM9Iik7DQoJCQkJCQkJaW1nLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKGZ1bmN0aW9uIChmaWVsZCkgew0KCQkJCQkJCQlyZXR1cm4gZnVuY3Rpb24gKGUpIHsNCgkJCQkJCQkJCXZhciB0ZXh0ID0gW2ZpZWxkLmRlc2NyaXB0aW9uXTsNCgkJCQkJCQkJCWlmICgiZGVmYXVsdCIgaW4gZmllbGQpIHsNCgkJCQkJCQkJCQl0ZXh0LnB1c2goIjxzdWI+PGI+RGVmYXVsdCB2YWx1ZTo8L2I+ICIgKyBmaWVsZC5kZWZhdWx0ICsgIjwvc3ViPiIpOw0KCQkJCQkJCQkJfQ0KDQoJCQkJCQkJCQlXaW5Db25maWcuaW5pdCh7DQoJCQkJCQkJCQkJdHlwZQkJOiBXaW5Db25maWcuV2luZG93VHlwZS5FWFBMQU5BVElPTiwNCgkJCQkJCQkJCQl0aXRsZQkJOiAoInRpdGxlIiBpbiBmaWVsZD9maWVsZC50aXRsZTpmaWVsZC5sYWJlbCksDQoJCQkJCQkJCQkJZGVzY3JpcHRpb24JOiB0ZXh0LmpvaW4oIjxiciAvPjxiciAvPiIpLA0KCQkJCQkJCQkJfSk7DQoJCQkJCQkJCX07DQoJCQkJCQkJfShpbnB1dCkpLCBmYWxzZSk7DQoNCgkJCQkJCQloZWxwLmFwcGVuZENoaWxkKGltZyk7DQoJCQkJCQkJZC5hcHBlbmRDaGlsZChoZWxwKTsNCgkJCQkJCX0NCgkJCQkJCQ0KCQkJCQkJZmllbGQuYXBwZW5kQ2hpbGQoZCk7DQoJCQkJCX0NCgkJCQl9IGVsc2Ugew0KCQkJCQlpZiAoISgidmFsdWUiIGluIGZsZCkpIHsNCgkJCQkJCWZsZC52YWx1ZSA9IHRydWU7DQoJCQkJCX0NCgkJCQkJaWYgKCEoImV2ZW50cyIgaW4gZmxkKSkgew0KCQkJCQkJZmxkLmV2ZW50cyA9IHt9Ow0KCQkJCQl9DQoNCgkJCQkJdmFyIGZmID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTsNCgkJCQkJZmYuc2V0QXR0cmlidXRlKCJuYW1lIiwgZmxkLm5hbWUpOw0KCQkJCQlmZi5zZXRBdHRyaWJ1dGUoInZhbHVlIiwgZmxkLnZhbHVlKTsNCgkJCQkJZmYuc2V0QXR0cmlidXRlKCJ0eXBlIiwgKGZsZC5tdWx0aXBsZT8iY2hlY2tib3giOiJyYWRpbyIpKTsNCg0KCQkJCQlpZiAoImRlZmF1bHQiIGluIGZsZCkgew0KCQkJCQkJaWYgKGZsZC5kZWZhdWx0ID09IGZsZC52YWx1ZSkgew0KCQkJCQkJCWZmLnNldEF0dHJpYnV0ZSgiY2hlY2tlZCIsICJjaGVja2VkIik7DQoJCQkJCQl9DQoJCQkJCX0gZWxzZSBpZiAoZmxkLmVtcHR5ID09IGZsZC52YWx1ZSkgew0KCQkJCQkJZmYuc2V0QXR0cmlidXRlKCJjaGVja2VkIiwgImNoZWNrZWQiKTsNCgkJCQkJfQ0KDQoJCQkJCWZsZC5lbGVtZW50cy5wdXNoKGZmKTsNCg0KCQkJCQlmb3IgKHZhciBjaSBpbiBmbGQuZXZlbnRzKSB7DQoJCQkJCQlhZGRFdmVudChmZiwgY2ksIGZsZC5ldmVudHNbY2ldLCBmbGQpOw0KCQkJCQl9DQoNCgkJCQkJZmllbGQuYXBwZW5kQ2hpbGQoZmYpOw0KCQkJCX0NCgkJCX0gZWxzZSBpZiAoZmxkLm11bHRpcGxlKSB7DQoJCQkJCWlmIChXaW5Db25maWcuRmllbGRUeXBlLkZJTEUgPT0gZmxkLnR5cGUpIHsNCgkJCQkJCXZhciBmZiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7DQoJCQkJCQlmbGQuZWxlbWVudHMgPSBbZmZdOw0KCQkJCQkJZmYuc2V0QXR0cmlidXRlKCJuYW1lIiwgZmxkLm5hbWUpOw0KCQkJCQkJZmYuc2V0QXR0cmlidXRlKCJ0eXBlIiwgImZpbGUiKTsNCgkJCQkJCWZmLnNldEF0dHJpYnV0ZSgibXVsdGlwbGUiLCAibXVsdGlwbGUiKTsNCg0KCQkJCQkJZmllbGQuYXBwZW5kQ2hpbGQoZmYpOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJZmxkLmVsZW1lbnRzID0gW107DQoNCgkJCQkJCWZvciAodmFyIGJpIGluIGZsZC52YWx1ZSkgew0KCQkJCQkJCXZhciBpbnB1dCA9IGZsZC52YWx1ZVtiaV0sDQoJCQkJCQkJZmYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOw0KDQoJCQkJCQkJaW5wdXQuZWxlbWVudHMgPSBbZmZdOw0KCQkJCQkJCWZmLnNldEF0dHJpYnV0ZSgibmFtZSIsIGZsZC5uYW1lKTsNCgkJCQkJCQlmZi5zZXRBdHRyaWJ1dGUoInR5cGUiLCBbInRleHQiLCAiaGlkZGVuIiwgInBhc3N3b3JkIl1bZmxkLnR5cGVdIHx8ICJ0ZXh0Iik7DQoJCQkJCQkJDQoJCQkJCQkJZmxkLmVsZW1lbnRzLnB1c2goZmYpOw0KCQkJCQkJCWZpZWxkLmFwcGVuZENoaWxkKGZmKTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJfSBlbHNlIHsNCgkJCQl2YXIgZmYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOw0KCQkJCWZsZC5lbGVtZW50cyA9IFtmZl07DQoJCQkJZm9yICh2YXIgYmkgaW4gZmxkLmF0dHJzKSB7DQoJCQkJCWZmLnNldEF0dHJpYnV0ZShiaSwgZmxkLmF0dHJzW2JpXSk7DQoJCQkJfQ0KCQkJCWZmLnNldEF0dHJpYnV0ZSgibmFtZSIsIGZsZC5uYW1lKTsNCgkJCQlmZi5zZXRBdHRyaWJ1dGUoInR5cGUiLCBbInRleHQiLCAiaGlkZGVuIiwgInBhc3N3b3JkIiwgImZpbGUiXVtmbGQudHlwZV0gfHwgInRleHQiKTsNCgkJCQlpZiAoImRlZmF1bHQiIGluIGZsZCkgew0KCQkJCQlmZi5zZXRBdHRyaWJ1dGUoInZhbHVlIiwgZmxkLmRlZmF1bHQpOw0KCQkJCX0NCgkJCQlpZiAoZmxkLmZvY3VzZWQpIHsNCgkJCQkJZm9jdXNlZElucHV0ID0gZmY7DQoJCQkJfQ0KCQkJCWZpZWxkLmFwcGVuZENoaWxkKGZmKTsNCgkJCX0NCg0KCQkJYm9keS5hcHBlbmRDaGlsZChkaXYpOw0KCQl9DQoJfSh0aGlzLCBib2R5KSk7DQoNCgltYWluLmFwcGVuZENoaWxkKGhlYWQpOw0KCW1haW4uYXBwZW5kQ2hpbGQoYm9keSk7DQoJbWFpbi5hcHBlbmRDaGlsZChmb290KTsNCg0KCXRpdGxlLmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlZG93biIsIGZ1bmN0aW9uIChlKSB7DQoJCWRyYWcgPSBbdHJ1ZSwgbWFpbi5vZmZzZXRMZWZ0IC0gZS5wYWdlWCwgbWFpbi5vZmZzZXRUb3AgLSBlLnBhZ2VZLCB0aXRsZS5zdHlsZS5jdXJzb3JdOw0KCQl0aXRsZS5zdHlsZS5jdXJzb3IgPSAibW92ZSI7DQoNCgkJZS5wcmV2ZW50RGVmYXVsdCgpOw0KCX0sIGZhbHNlKTsNCglkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlbW92ZSIsIGZ1bmN0aW9uIChlKSB7DQoJCWlmIChkcmFnWzBdKSB7DQoJCQltYWluLnN0eWxlLmxlZnQgPSAoZS5wYWdlWCArIGRyYWdbMV0pICsgInB4IjsNCgkJCW1haW4uc3R5bGUudG9wID0gKGUucGFnZVkgKyBkcmFnWzJdKSArICJweCI7DQoJCX0NCgl9LCBmYWxzZSk7DQoJZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKCJtb3VzZXVwIiwgZnVuY3Rpb24gKGUpIHsNCgkJaWYgKGRyYWdbMF0pIHsNCgkJCXRpdGxlLnN0eWxlLmN1cnNvciA9IGRyYWdbM107DQoJCQlkcmFnWzBdID0gZmFsc2U7DQoJCX0NCgl9LCBmYWxzZSk7DQoNCglpZiAodGhpcy5zdG9yZSkgewkNCgkJdHJ5IHsNCgkJCWNvbmZpZyA9IEpTT04ucGFyc2UoR01fZ2V0VmFsdWUoImNvbmZpZy0iICsgdGhpcy5uYW1lKSk7DQoNCgkJCWlmICh0aGlzLmZvcmNlIHx8ICFwYXJhbXMua2VlcCAmJiBHTV9nZXRWYWx1ZSh2bikgIT0gR01faW5mby5zY3JpcHQudmVyc2lvbikgew0KCQkJCXRoaXMub3BlbigpOw0KCQkJfQ0KCQl9IGNhdGNoIChlKSB7DQoJCQlpZiAoIXRoaXMuZ3JvdXApIHsNCgkJCQl0aGlzLm9wZW4oKTsNCgkJCX0NCgkJfQ0KCX0gZWxzZSB7DQoJCXRoaXMub3BlbigpOw0KCX0NCn07DQoNCldpbkNvbmZpZy5fX29wZW5lZFdpbmRvd3MgPSBbXTsNCndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJrZXl1cCIsIGZ1bmN0aW9uIChlKSB7DQoJdmFyIG9XaW4gPSBXaW5Db25maWcuX19vcGVuZWRXaW5kb3dzOw0KCWlmICghZS5hbHRLZXkgJiYgIWUuY3RybEtleSAmJiAhZS5tZXRhS2V5ICYmIDI3ID09IGUua2V5Q29kZSAmJiBvV2luLmxlbmd0aCkgew0KCQlvV2luWyhlLnNoaWZ0S2V5PzA6b1dpbi5sZW5ndGggLSAxKV0uY2xvc2UoKTsNCgl9DQp9LCBmYWxzZSk7DQoNCldpbkNvbmZpZy5pbml0ID0gZnVuY3Rpb24gKHBhcmFtcykgew0KCWlmICgiY29uZGl0aW9uIiBpbiBwYXJhbXMpIHsNCgkJdmFyIGNmZyA9IEpTT04ucGFyc2UoR01fZ2V0VmFsdWUoImNvbmZpZy0iICsgcGFyYW1zLm5hbWUsICJ7fSIpKSwNCgkJYyA9IHBhcmFtcy5jb25kaXRpb24oY2ZnKTsNCgkJcGFyYW1zLnJlc3VsdCA9IGM7DQoJCWlmICgtMSA9PSBjKSB7DQoJCQlpZiAoISgidHlwZSIgaW4gcGFyYW1zKSkgew0KCQkJCXBhcmFtcy50eXBlID0gV2luQ29uZmlnLldpbmRvd1R5cGUuUVVFU1RJT047DQoJCQl9DQoNCgkJCXJldHVybiBuZXcgV2luQ29uZmlnKHBhcmFtcyk7DQoJCX0gZWxzZSBpZiAoYykgew0KCQkJaWYgKCJsb2FkIiBpbiBwYXJhbXMpIHsNCgkJCQlwYXJhbXMubG9hZChjZmcpOw0KCQkJfQ0KCQl9IGVsc2UgaWYgKCJ1bmxvYWQiIGluIHBhcmFtcykgew0KCQkJcGFyYW1zLnVubG9hZCgpOw0KCQl9DQoJCXJldHVybiBjOw0KCX0gZWxzZSB7DQoJCXJldHVybiBuZXcgV2luQ29uZmlnKHBhcmFtcyk7DQoJfQ0KfTsNCg0KV2luQ29uZmlnLldpbmRvd0J1dHRvbiA9IHsNCglPSwkJOiAweDAxLA0KCVlFUwkJOiAweDAyLA0KCVNBVkUJOiAweDA0LA0KCVNVQk1JVAk6IDB4MDgsDQoJQ0FOQ0VMCTogMHgxMCwNCglOTwkJOiAweDIwLA0KCVJFU0VUCTogMHg0MCwNCn07DQoNCldpbkNvbmZpZy5XaW5kb3dUeXBlID0gew0KCUNVU1RPTQkJOiAweDAsDQoJRVJST1IJCTogMHgxLA0KCUVYUExBTkFUSU9OCTogMHgyLA0KCVFVRVNUSU9OCTogMHgzLA0KCVBST01QVAkJOiAweDQsDQoJV0FSTklORwkJOiAweDUsDQoJU1VDQ0VTUwkJOiAweDYsDQp9Ow0KDQpXaW5Db25maWcuRmllbGRGb3JtYXQgPSB7DQoJU1RSSU5HCQk6IDB4MDEsDQoJQk9PTEVBTgkJOiAweDAyLA0KCU5VTUJFUgkJOiAweDA0LA0KCUFSUkFZCQk6IDB4MDgsDQp9Ow0KDQpXaW5Db25maWcuRmllbGRUeXBlID0gew0KCVRFWFQJCTogMHgwLA0KCUhJRERFTgkJOiAweDEsDQoJUEFTU1dPUkQJOiAweDIsDQoJRklMRQkJOiAweDMsDQoJQ0hFQ0sJCTogMHg0LA0KCVNFTEVDVAkJOiAweDUsDQoJR1JPVVAJCTogMHg2LA0KCUNVU1RPTQkJOiAweDcsDQp9Ow0KV2luQ29uZmlnLkN1c3RvbUZpZWxkID0ge307DQpXaW5Db25maWcuQ3VzdG9tRmllbGQuaG90a2V5ID0gZnVuY3Rpb24gKF93aW5kb3cpIHsNCgl2YXIgX2ZpZWxkID0gdGhpcywNCgl0bXAgPSB7DQoJCWxhYmVsCTogIkhvdGtleSIsDQoJCWNsYXNzCTogImhvdGtleSIsDQoJCXR5cGUJOiBXaW5Db25maWcuRmllbGRUeXBlLkdST1VQLA0KCQlmaWVsZHMJOiBbew0KCQkJbmFtZQk6ICJrZXlzIiwNCgkJCXR5cGUJOiBXaW5Db25maWcuRmllbGRUeXBlLkNIRUNLLA0KCQkJZm9ybWF0CTogV2luQ29uZmlnLkZpZWxkRm9ybWF0Lk5VTUJFUiwNCgkJCW11bHRpcGxlOiB0cnVlLA0KCQkJdW5pcXVlCTogdHJ1ZSwNCgkJCWRlZmF1bHQJOiAweDcsDQoJCQlub2dyb3VwCTogdHJ1ZSwNCgkJCXZhbHVlCTogW3sNCgkJCQl2YWx1ZQk6IDB4MSwNCgkJCQlsYWJlbAk6ICJBbHQiLA0KCQkJfSx7DQoJCQkJdmFsdWUJOiAweDIsDQoJCQkJbGFiZWwJOiAiQ3RybCIsDQoJCQl9LHsNCgkJCQl2YWx1ZQk6IDB4NCwNCgkJCQlsYWJlbAk6ICJTaGlmdCIsDQoJCQl9LHsNCgkJCQl2YWx1ZQk6IDB4OCwNCgkJCQlsYWJlbAk6ICJNZXRhIiwNCgkJCX1dDQoJCX0sew0KCQkJbmFtZQk6ICJrZXlDb2RlIiwNCgkJCXR5cGUJOiBXaW5Db25maWcuRmllbGRUeXBlLlNFTEVDVCwNCgkJCWZvcm1hdAk6IFdpbkNvbmZpZy5GaWVsZEZvcm1hdC5OVU1CRVIsDQoJCQlkZWZhdWx0IDogMHg1MywNCgkJCXZhbHVlCTogKGZ1bmN0aW9uICgpIHsNCgkJCQl2YXIgb3V0cHV0ID0gW10sDQoJCQkJb3B0cyA9ICJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWjAxMjM0NTY3ODkiOw0KDQoJCQkJZm9yICh2YXIgYWkgPSAwO2FpIDwgb3B0cy5sZW5ndGg7KythaSkgew0KCQkJCQlvdXRwdXQucHVzaCh7DQoJCQkJCQl2YWx1ZQk6IG9wdHMuY2hhckNvZGVBdChhaSksDQoJCQkJCQlsYWJlbAk6IG9wdHNbYWldLA0KCQkJCQl9KTsNCgkJCQl9DQoNCgkJCQlyZXR1cm4gb3V0cHV0Ow0KCQkJfSgpKSwNCgkJfV0sDQoJfTsNCg0KCWZvciAodmFyIGFpIGluIHRtcCkgew0KCQl0aGlzW2FpXSA9IHRtcFthaV07DQoJfQ0KDQoJd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImtleXVwIiwgZnVuY3Rpb24gKGUpIHsNCgkJdmFyIGNmZyA9IF93aW5kb3cuZ2V0KF9maWVsZC5uYW1lKTsNCg0KCQlpZiAoY2ZnICYmIGNmZy5rZXlDb2RlID09IGUua2V5Q29kZSkgew0KCQkJdmFyIGtleXMgPSBbImFsdCIsICJjdHJsIiwgInNoaWZ0IiwgIm1ldGEiXTsNCg0KCQkJZm9yICh2YXIgYWkgaW4ga2V5cykgew0KCQkJCWlmICghKGVba2V5c1thaV0gKyAiS2V5Il0gXiAhKGNmZy5rZXlzICYgTWF0aC5wb3coMiwgYWkpKSkpIHsNCgkJCQkJcmV0dXJuOw0KCQkJCX0NCgkJCX0NCg0KCQkJX2ZpZWxkLmNhbGxiYWNrKGUsIF93aW5kb3cpOw0KCQl9DQoJfSwgZmFsc2UpOw0KfTsNCg=="}]},{"name":"Neopets - Search Helper","options":{"check_for_updates":true,"user_modified":null,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_powerful_this":null,"sandbox":null,"noframes":null,"unwrap":null,"run_at":null,"tab_types":null,"override":{"use_includes":[],"orig_includes":[],"merge_includes":true,"use_matches":[],"orig_matches":["*://*.neopets.com/auctions.phtml*","*://*.neopets.com/closet.phtml*","*://*.neopets.com/dome/neopets.phtml*","*://*.neopets.com/faerieland/darkfaerie.phtml*","*://*.neopets.com/faerieland/employ/employment.phtml*","*://*.neopets.com/faerieland/hiddentower938.phtml","*://*.neopets.com/games/kadoatery/*","*://*.neopets.com/games/kadoatery/index.phtml","*://*.neopets.com/generalstore.phtml*","*://*.neopets.com/genie.phtml*","*://*.neopets.com/halloween/esophagor*.phtml*","*://*.neopets.com/halloween/witchtower*.phtml*","*://*.neopets.com/hospital.phtml","*://*.neopets.com/inventory.phtml*","*://*.neopets.com/island/*training.phtml?*type=status*","*://*.neopets.com/island/kitchen*.phtml*","*://*.neopets.com/island/tradingpost.phtml*","*://*.neopets.com/market.phtml*","*://*.neopets.com/market_your.phtml*","*://*.neopets.com/medieval/earthfaerie.phtml*","*://*.neopets.com/objects.phtml*","*://*.neopets.com/pirates/academy.phtml?type=status*","*://*.neopets.com/process_cash_object.phtml","*://*.neopets.com/quests.phtml","*://*.neopets.com/quickstock.phtml*","*://*.neopets.com/safetydeposit.phtml*","*://*.neopets.com/shops/wizard.phtml*","*://*.neopets.com/space/coincidence.phtml","*://*.neopets.com/winter/igloo2.phtml","*://*.neopets.com/winter/snowfaerie*.phtml*","*://*.neopets.com/questlog/"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"orig_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null,"orig_run_in":[]},"run_in":null,"tags":[]},"storage":{"ts":1697901671216,"data":{}},"enabled":true,"position":3,"file_url":"https://github.com/diceroll123/NeoSearchHelper/raw/master/searchhelper.user.js","uuid":"370b666b-94c6-4096-abb8-25130dcb03bd","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBOZW9wZXRzIC0gU2VhcmNoIEhlbHBlcgovLyBAdmVyc2lvbiAgICAgIDEuMC4yNwovLyBAbmFtZXNwYWNlICAgIG5lb3BldHMKLy8gQGRlc2NyaXB0aW9uICBBZGRzIGNvbnZlbmllbnQgc2VhcmNoIGljb25zIHRvIG1hbnkgcGxhY2VzCi8vIEBhdXRob3IgICAgICAgZGljZXJvbGwxMjMKLy8gQG1hdGNoICAgICAgICAqOi8vKi5uZW9wZXRzLmNvbS9hdWN0aW9ucy5waHRtbCoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5uZW9wZXRzLmNvbS9jbG9zZXQucGh0bWwqCi8vIEBtYXRjaCAgICAgICAgKjovLyoubmVvcGV0cy5jb20vZG9tZS9uZW9wZXRzLnBodG1sKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLm5lb3BldHMuY29tL2ZhZXJpZWxhbmQvZGFya2ZhZXJpZS5waHRtbCoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5uZW9wZXRzLmNvbS9mYWVyaWVsYW5kL2VtcGxveS9lbXBsb3ltZW50LnBodG1sKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLm5lb3BldHMuY29tL2ZhZXJpZWxhbmQvaGlkZGVudG93ZXI5MzgucGh0bWwKLy8gQG1hdGNoICAgICAgICAqOi8vKi5uZW9wZXRzLmNvbS9nYW1lcy9rYWRvYXRlcnkvKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLm5lb3BldHMuY29tL2dhbWVzL2thZG9hdGVyeS9pbmRleC5waHRtbAovLyBAbWF0Y2ggICAgICAgICo6Ly8qLm5lb3BldHMuY29tL2dlbmVyYWxzdG9yZS5waHRtbCoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5uZW9wZXRzLmNvbS9nZW5pZS5waHRtbCoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5uZW9wZXRzLmNvbS9oYWxsb3dlZW4vZXNvcGhhZ29yKi5waHRtbCoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5uZW9wZXRzLmNvbS9oYWxsb3dlZW4vd2l0Y2h0b3dlcioucGh0bWwqCi8vIEBtYXRjaCAgICAgICAgKjovLyoubmVvcGV0cy5jb20vaG9zcGl0YWwucGh0bWwKLy8gQG1hdGNoICAgICAgICAqOi8vKi5uZW9wZXRzLmNvbS9pbnZlbnRvcnkucGh0bWwqCi8vIEBtYXRjaCAgICAgICAgKjovLyoubmVvcGV0cy5jb20vaXNsYW5kLyp0cmFpbmluZy5waHRtbD8qdHlwZT1zdGF0dXMqCi8vIEBtYXRjaCAgICAgICAgKjovLyoubmVvcGV0cy5jb20vaXNsYW5kL2tpdGNoZW4qLnBodG1sKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLm5lb3BldHMuY29tL2lzbGFuZC90cmFkaW5ncG9zdC5waHRtbCoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5uZW9wZXRzLmNvbS9tYXJrZXQucGh0bWwqCi8vIEBtYXRjaCAgICAgICAgKjovLyoubmVvcGV0cy5jb20vbWFya2V0X3lvdXIucGh0bWwqCi8vIEBtYXRjaCAgICAgICAgKjovLyoubmVvcGV0cy5jb20vbWVkaWV2YWwvZWFydGhmYWVyaWUucGh0bWwqCi8vIEBtYXRjaCAgICAgICAgKjovLyoubmVvcGV0cy5jb20vb2JqZWN0cy5waHRtbCoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5uZW9wZXRzLmNvbS9waXJhdGVzL2FjYWRlbXkucGh0bWw/dHlwZT1zdGF0dXMqCi8vIEBtYXRjaCAgICAgICAgKjovLyoubmVvcGV0cy5jb20vcHJvY2Vzc19jYXNoX29iamVjdC5waHRtbAovLyBAbWF0Y2ggICAgICAgICo6Ly8qLm5lb3BldHMuY29tL3F1ZXN0cy5waHRtbAovLyBAbWF0Y2ggICAgICAgICo6Ly8qLm5lb3BldHMuY29tL3F1aWNrc3RvY2sucGh0bWwqCi8vIEBtYXRjaCAgICAgICAgKjovLyoubmVvcGV0cy5jb20vc2FmZXR5ZGVwb3NpdC5waHRtbCoKLy8gQG1hdGNoICAgICAgICAqOi8vKi5uZW9wZXRzLmNvbS9zaG9wcy93aXphcmQucGh0bWwqCi8vIEBtYXRjaCAgICAgICAgKjovLyoubmVvcGV0cy5jb20vc3BhY2UvY29pbmNpZGVuY2UucGh0bWwKLy8gQG1hdGNoICAgICAgICAqOi8vKi5uZW9wZXRzLmNvbS93aW50ZXIvaWdsb28yLnBodG1sCi8vIEBtYXRjaCAgICAgICAgKjovLyoubmVvcGV0cy5jb20vd2ludGVyL3Nub3dmYWVyaWUqLnBodG1sKgovLyBAbWF0Y2ggICAgICAgICo6Ly8qLm5lb3BldHMuY29tL3F1ZXN0bG9nLwovLyBAaWNvbiAgICAgICAgIGh0dHBzOi8vd3d3Lm5lb3BldHMuY29tL2Zhdmljb24uaWNvCi8vIEBncmFudCAgICAgICAgbm9uZQovLyA9PS9Vc2VyU2NyaXB0PT0KCmNvbnN0IGltZ1NpemUgPSAyMDsgLy8gZm9yIHRoZSBzZWFyY2ggaW1hZ2VzCgokKGA8c3R5bGUgdHlwZT0ndGV4dC9jc3MnPgouc2VhcmNoaW1nIHsgY3Vyc29yOiBwb2ludGVyOyBoZWlnaHQ6ICR7aW1nU2l6ZX1weCAhaW1wb3J0YW50OyB3aWR0aDogJHtpbWdTaXplfXB4ICFpbXBvcnRhbnQ7IGJvcmRlcjogbm9uZSAhaW1wb3J0YW50OyBib3JkZXItcmFkaXVzOiAwcHggIWltcG9ydGFudDt9Ci5zZWFyY2gtaGVscGVyIHsgbWFyZ2luLXRvcDogMDsgbWFyZ2luLWJvdHRvbTogMDsgfQo8L3N0eWxlPmApLmFwcGVuZFRvKCJoZWFkIik7CgpqUXVlcnkuZm4uZXhpc3RzID0gZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHRoaXMubGVuZ3RoID4gMDsKfTsKCi8vIGlmIHRoZSBhY3RpdmUgcGV0IGRyb3Bkb3duIGltYWdlIGlzIHRoZXJlLCB3ZSdyZSBpbiBiZXRhCmNvbnN0IGlzQmV0YSA9ICQoIltjbGFzc149J25hdi1wZXQtbWVudS1pY29uJ10iKS5leGlzdHMoKTsKCmNvbnN0IGxpbmttYXAgPSB7IC8vIGZvciB1cmxzIGFuZCBpbWFnZXMgZm9yIGVhY2ggc2VhcmNoIHR5cGUKICAgIC8vIGlmIHRoZSBpbWFnZSBpcyBub3QgZnJvbSBpbWFnZXMubmVvcGV0cy5jb20sIGJhc2U2NCBpdAogICAgc3N3OiB7CiAgICAgICAgImltZyI6ICJodHRwOi8vaW1hZ2VzLm5lb3BldHMuY29tL3ByZW1pdW0vc2hvcHdpemFyZC9zc3ctaWNvbi5zdmciCiAgICB9LAogICAgc3c6IHsKICAgICAgICAidXJsIjogImh0dHBzOi8vd3d3Lm5lb3BldHMuY29tL3Nob3BzL3dpemFyZC5waHRtbD9zdHJpbmc9JXMiLAogICAgICAgICJpbWciOiAiaHR0cDovL2ltYWdlcy5uZW9wZXRzLmNvbS90aGVtZXMvaDUvYmFzaWMvaW1hZ2VzL3Nob3B3aXphcmQtaWNvbi5wbmciCiAgICB9LAogICAgdHA6IHsKICAgICAgICAidXJsIjogImh0dHBzOi8vd3d3Lm5lb3BldHMuY29tL2lzbGFuZC90cmFkaW5ncG9zdC5waHRtbD90eXBlPWJyb3dzZSZjcml0ZXJpYT1pdGVtX2V4YWN0JnNlYXJjaF9zdHJpbmc9JXMiLAogICAgICAgICJpbWciOiAiaHR0cDovL2ltYWdlcy5uZW9wZXRzLmNvbS90aGVtZXMvaDUvYmFzaWMvaW1hZ2VzL3RyYWRpbmdwb3N0LWljb24ucG5nIgogICAgfSwKICAgIGF1OiB7CiAgICAgICAgInVybCI6ICJodHRwczovL3d3dy5uZW9wZXRzLmNvbS9nZW5pZS5waHRtbD90eXBlPXByb2Nlc3NfZ2VuaWUmY3JpdGVyaWE9ZXhhY3QmYXVjdGlvbmdlbmllPSVzIiwKICAgICAgICAiaW1nIjogImh0dHA6Ly9pbWFnZXMubmVvcGV0cy5jb20vdGhlbWVzL2g1L2Jhc2ljL2ltYWdlcy9hdWN0aW9uLWljb24ucG5nIgogICAgfSwKICAgIHNkYjogewogICAgICAgICJ1cmwiOiAiaHR0cHM6Ly93d3cubmVvcGV0cy5jb20vc2FmZXR5ZGVwb3NpdC5waHRtbD9vYmpfbmFtZT0lcyZjYXRlZ29yeT0wIiwKICAgICAgICAiaW1nIjogImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQ0FBQUFBZ0NBWUFBQUJ6ZW5yMEFBQUVDa2xFUVZSWWhlMVdTMDhqUnhEK3FqMlBIUThnYkxCNVNnYUJRS0RreW9rRFhQSWJPT2NYNVJKRlNpNDVSY292eUNFU0lvY29PYXdRU0hoeFFEd01FZy9qNENFejQvRk85MHpsd0l6WHNNYnJFTFRhdzM1U0gyWlVWZC9YVmRWZERYekdaM3lLSUtLUHh3VUFsbVZORkFxRk5jTXd2aXdVQ2hmWmJQWjhiMi92TFRQL1BUZzRlQ3VFOEU5T1RsZ3B4UURlQW1nQllBQjZFa2NDaUFERVNVenU0TkFTTzVIOGw4bml0b0NabVptdjE5ZlhmM0FjUjB4TlRjVURBd095MVdxQm1adEU5SStVMHQvWjJja3djMndZaGdPZ25nVElKaVIrSWlycUVNQUo2U3NBTmdBRGdBTGdFNUYvYzNQelo3bGMvbFlUUW1CNmVucEkzQU9HWVloc05tdGFsZ1VBSm9BY0VXRjJkaFpoR01KMVhlaTZEc013d055NTBmNFFCQUZNMDRSbFdST1ZTdVZIallpZzY3cWRHakJ6ZTZXSTR4aFNTalNiVFJRS0JUU2JUUlNMUmRpMjNaV2tHK0k0eHZYMU5VelRoRklLdnU4UEVWRldTMGoxcHh5RkVEZzZPc0xXMWhhSUNCc2JHMWhlWGthNVhFWVVSZEQxSjEwZndQTTg1UE41TEN3c1lIdDdHNDdqQ0FDa0pUc05lem03cm90YXJZWk1KZ09sRkVaSFI1SFA1M0Y0ZUFqYnRqOVlDcVVVVE5QRXlzb0toQkNwdlFZZ296RXpXcTJXU285ZUZFWHZCWkJTUGlCaFptUXlHUXdQRDJOd2NQQ0RBbEovSW1xWE41dk5HcE9UazVyR3pGQktSVVRVTm5nS2htSEFNSXdIUWg3M1N6Yzh0bUZtV0pZbEppY25OUTBBaU9qSlFqSXo1dWZuc2JxNkNpSkNzVmg4VnZkM2dXRG1qSlo4NUhzSnlPVnlLSlZLY0YwWFFvaVhJRzhMU0tNTjliTHNUSFVjeC8rYk9TbDFKZ2dDVStEKzV0TDZjU0tpcmszNlRCaFJGTDFLTTlBenI4bEpRUkFFTDBVT0FCa0FSa3I4NVBnVFFxQmFyV0p6Y3hQbGNybmRnR2xHL3N2cUlrQlBVOTl6L2pxT2cwYWpBZURkUFNHbGhPZDVpT080cjR0SUNJRW9pcUJwN1dvTEFGcGZBam9ES2FYUWFEUXdNVEdCcGFXbHZ0OE9qVVlEUjBkSEtKVktxUThCb0ZSQXo5YldOQTFEUTBQSTVYSm9OQm9ZR1JuQjNOeGMzM01BQUVxbEVxclZLdmIzOStHNmJqc1RHZ0FLdzlCTWQvTDRtREV6U3FVUzF0Yld3TXc0UFQyRmxCS1ZTcVZ2OGhSRWhIcTlEc2R4TUQ0K0hnTlFxUUFyYlpSdUFnWUdCbUJaRm9pSWRWMlBQYzlyRjExS1NWRVVwZDl4c3RMWGtjTDlvQXVUN3d3UjJTTWpJN2JuZWJkaEdOYlRFblR0SWlKQ0VBUzR1N3VyNnJyK2krLzdmNFJoNkNZRURBQzd1N3U0dUxnQUVYSHlYM1dzRU85ZVN3cjNUN01jZ0dGbWRxV1UrMTB2SUNLQ1VncDNkM2UxczdPem40NlBqNzgvUFQzOXkvTzg5M3FsbjJIVUMxMEZ1Szdidkx5OC9MVlNxWHh6Zkh6OCsrM3RyWHcyUXo4Q21KbkRNSVJTaW11MTJwdGFyZmJkNjlldmZ6NC9QNisveE4zZkN3U0FiTnYrYW14czdJdkZ4Y1hnNE9EZ3Q2dXJxemUrNzcvSXpPMGJ5WXY0bzNKK0V2Z1g0eUloWUJQL2RXVUFBQUFBU1VWT1JLNUNZSUk9IgogICAgfSwKICAgIGNsb3NldDogewogICAgICAgICJ1cmwiOiAiaHR0cHM6Ly93d3cubmVvcGV0cy5jb20vY2xvc2V0LnBodG1sP29ial9uYW1lPSVzIiwKICAgICAgICAiaW1nIjogImh0dHA6Ly9pbWFnZXMubmVvcGV0cy5jb20vaXRlbXMvZmZ1X2lsbHVzZW5fYXJtb2lyZS5naWYiCiAgICB9LAogICAgam5pOiB7CiAgICAgICAgInVybCI6ICJodHRwczovL2l0ZW1zLmplbGx5bmVvLm5ldC9zZWFyY2gvP25hbWU9JXMmbmFtZV90eXBlPTMiLAogICAgICAgICJpbWciOiAiZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFDQUFBQUFnQ0FZQUFBQnplbnIwQUFBSHNVbEVRVlJZaGUxWFdXeFUxeG4renJuYmJKNFp6K1padk52Z0JVTUtJUzNRTkJoU0NDSnFvMVpOcTFZcWlocUUxS29QN1dQVUI5VEhSbm5wUTZwS3JSUkZxQzlFZ3BTMGFvT1NJQ2d0bGd4NEFVTWNlNHozWld6UFBuZnVjczQ5ZlhBd2RzRUZxbFo1NlpIdTAvM1AvMzMvcC84LzV6dkEvOWNYdk1oL0xkRjZKZ0loeFArT1FDS1JrQm9iRzkyNVhFNU1UMDBaZnA4M3BiaGNIZEY0b3BselIzWnJXbkZtY21MQ3RPeTA1dlVsSlFJL0hENnh1cHFkclJyR1EvbmtweVVneXpJOTFOdDdLRDJSam9sQWVKOVIzL0ZDcGFHcmFiNnBRNFdzQXVXOGcvU3Rzam8yTUluMlhja3k0LzdHR3Zkb1lQREtyMGI3cnA1bGpzUCtZd1VvcFVnbDRpMkp0dTF2MzB2MkhIYU9uZEJvYXplRW9ZTXVURUlRQXBKc0JnbUd3UmRtWUZ3NkQwZFNJSVdpOE0yTlp2bDdiLzg0czdSNGRtTk82V2txMzdHajU0alZ1ZmUzUzBkZmY0RzgrQjFaM3Q0TnNyeUFaNitlUmR2UURkUU05S042cXc5bTB6YklEYzJRWWczUS8vUXVtQ2NBMGJyVDdaNGJxN0RsdVF1TTh3ZEZQUWs0SVVTcERZZFBydXc1OHE3K2s3ZjJ5Z2RlSWtUelFOaUE5OXFIMk9rSXpHZ2VPQzQvMmlzTzZNZm5JUmdnMWFYZzduNFc5c3c0elB3cWZMdjJkVXF5WEx0SjFjZUJVMG9WbjkvL1U2djMxYmZZaVRmaVVqd0ZjQWRnRnNCc2lQa0YzTDY3aUJWL0dKWXNRWllWME13Q0hNc0FLRUE4TlZEN0x6SytNSVVsZjEyOXkrdUxQakVCVFZXUmFtajhnZnpLeWRQYXFWL1dVSDhJNEFCeHVRSFZCVWd5cXJFNERGTkhiSG9TTVltalB1bUNIb2tEaWdvbmwwVjFiQXB0ZGNseFg2UXVXNEdTVUFPaDV6YzIzcFk5UUNsRno4NmVZOFpYanYvYWVlMFhVU2tRQXU2UE55RVFlZ2xFZGNHcHE4ZHllZ2plMVF5b1FqQmFHMFptMzh0UUJZUCt3VG1Zc3h3Qlk3WlVxV1I5ZXJua0RpaFVKYXVMRjB6VHRJQXR4cEFRZ2xBZ3NDTVRhMy9UL3U3UFVsSWdCRGdiQWh3SFRpRUg1RllndDNYRCtPSFBNVHc2RE00NWFDd0ZUOVZBK1lNUFlPVlVFTVdQUWo0Yk5oYytjNkd4RzNZNDFPbnllT0tGWXJHMEpZR0F2OFlmYm1rL25UbitvNTFhb2dGNDBMUVF0Z1dobHdFQzhMazBpTnNEVjMwemxPQWhPRUxBR2J1TnlybjM0REF2cUZNQzlRa2tXNUwzOUZYSk5kM1EzaUV2VC9abjgvblorL2tlSXFDcUt0cmEybDRkNjlqL1RkZHpoeCtBRTBBWVZWalhMMEhaOFdYSXJSMmdnVnFZZlI5RFV4UklkU2xJRGlCYU95Q2RlQTNDcklLb01od3FnWjQ1UFZRWENyN3ZaQ2VQNUc5ZCswM1ZNS3BiRXFoUEp1TkZmL3dVK2NaSmpXcmFtdlFFY0FvNUNMMEU1WmtEb0w0Z2hHVkRXVWpEdm40WitXdFg0UDNlU2FnZHo0QzRYSkRidDYvMWl3VHdUNGVSSHVqUDZmUFQ1eUhFQlM0Y3ZoRnYweFFRUXVDcnFUbWU2ZjdxSHEyOVp4MWMyQmJzZ2NzQUlhQ0JJSVJWaFgvZ0x6aXEzc0dMeHc1Zys3YTlPTGphaDVxTHZ3Y2Z1d1ZuZFFYQ1pvQU5rTVVaMFJTcEhlZWNnemtPLzlkN2FwTUNIcmZiVTNENXYrM3NPeTVUaVFBT0lHd1RvbFNBOHFXdmdRWkNFS1lONDhQM3NkZXppT2RlZWg3NW9odWZUZDJDR2tuaFlKT09QNS81SFlwdFhmRDJ2Z3diQk96U09XTnBkdnIyVnZmakpnWHFvdEdtYXN1dTNXcEw1M3IxOW5BZmVHWU90RFlNVUFMNzdnQ0tWMjZpZjhqQjBCMkdzMy9vdzNCZkdoY3VUSVBKOWVqb2JvTTNFb09JcGxBcUZ1SExMMDFDWUd3TC9NMEtWQXh6bDkyMks2cTYzWUFBaEdWQ1NyV0NodXZXQ1VtSlJxaHhId0p1QzFTeDhLM3Y3MGNrTlExQkpCemVIOGNJaXlBOVRiQlNLb0pQalNKaUZnWVdoVmphaXNDNkFvbDQzT3VMMXUwMmE4SUtBUUJ1dzc1NUJiUW1DS0tvYTBFQ1FHMFVyUGZyOE1jZDFQdDBkRzd6NDJCdkNsUFRSYnh6NWc3bVZ4bHlVR0hvT3VUc29taE54RmE3dXJxMlBQRFdGVWdrRWtxd3ZjdXowTEJ0cmZHWURWSWJBM0Y3SDV5QUFDZ2hVSnEyNHlhejRicDZCOTYvemVIbTlSbXN6SlZodDBXaGRIcGdSbG9CeGhCa2xlVmNadW1kL2hzM3pNY1NHQm01bmU4T3h3V3piVGhjQUtVOGxQWWVnR3krTGdpbHFBa0c0VFIzNGg4WlB6QTVCbEdmQWtJVjJFay9SdHcrc0pvd3dCbk0yWHZsZ1lHQmpQRUlKL1FRQVlDQTJsYVJMYy9EV0YyQ05Eb0liZC9SUjI2U1pBWCtVQmdWV1FLTHhqL2ZEV1M0QTJiYmEwSE1ncWRhS0JZNXM3WkUzMGpBdEN3c1RZemRWVE5UckZ6WktmdWF1aUNvdEdZMkh6RkRzcUxBSDRwQU9NNGF1Z0RLK1J5WWJhMDVWRU5IVkNFTHpPM1JxK2JXSERaTmdVekVvSGQ4YU1HSXRUU1VmWDVZTGg4MHR4dXFwb0ZLTWdqWjdPQUlJU0FTQmVjYzFWSUoxWEw1L2crZ3NBSzVsRTF6SVNwUHBBQUFWS3JWOUY2cGRQR2pUODYremw4NUJVT3Z3S3lVUVNVWnNxcEFWbFRJaWdMeWVWODREb2R0bXJCTkE0d3hZUDJZSS9CbTUwMG51M1E1WHlqOE8vek5mb0F4eGx1U2laRUV0WUxMTnVtMG8vVXlOQStFRU9BMmcyMGFNS3M2REwyeVJrN1h3U3dMamhBQUNFQXBRQ1dnWEVCRC94Ly9uaHU4OW1aRjEvVW5Kc0E1UnpxZHpta1VuelNWNXFkZEs3TlJxNnFIUkRtdmlHb1o0SHl0U29jRG5LMTl0Z1hrVjBBS3kxQXlVMEpORDdMb2piOE94Q1p1dnBFZUg3Lzd1RWZLbHJaY1ZWVkV3NkZJTUJMYm8xdjI3dWxzc1Q3YzNPNk5OalRGYmM2MSszR0tKRmthTTdLanc0TzV1TTgxRmZLNjczdzZNakpjclZabk5ycmZweWF3SGtBSUlBUUVBTGZMUmQyYTVuWWNUdS92cFpSeVNWYk1iRDdQT09jZzVPbWVabC80K2lkOXBIK3BlcXFnbEFBQUFBQkpSVTVFcmtKZ2dnPT0iCiAgICB9LAogICAgYmF0dGxlcGVkaWE6IHsKICAgICAgICAidXJsIjogImh0dHBzOi8vYmF0dGxlcGVkaWEuamVsbHluZW8ubmV0L2luZGV4LnBocD9zZWFyY2g9JXMiLAogICAgICAgICJpbWciOiAiZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFCQUFBQUFRQ0FZQUFBQWY4LzloQUFBQ2hrbEVRVlE0VDVYUlcwaVRBUlFIOFA4M1ZpN24yQ1V2bTBocm9XN2FGSzF0K25rQmUxQllLN0tIb0NZWlhwcGxQVVRrUTBXUVFnOUZJVVJpWkhSRHM4d0VLNlFOaWJGaFphZ1QzZHJtRmFkSmxxM21uTTU1K2NJdklxS21kWjRQdi9NLzV4QWhpZ081TE9hR1dJOTc1aGtHWG56QWZ4YkJTeTg0b2kzUTN2UDcvUXY5MW42VHcrNTQ3UFhPdE1QZU52WXZGb0ZZZFVUSnNhUERNVEV4SEtsVWl0blpXZWoxK2htNzA1bjAvc2xsMTNvSXNkcWdLTHlvTDlQcDhxYW5wOEZnTUNBUUNORFUxR1FuTmk0cURWY3JmR3NoTk1BbkMwNVVWbFhkWUxGWWNEcWRFSWxFOEhnOE1Kdk45Y2JhaXNQckFwRHRqaThwTFhXUUpFbFFGQVdYeXdVMm00M3g4WEVNajQ2VXZieDI4bFl3aEU1QVY0STZYYk5uYjRQMmtIYWIyKzNHNU9Ra25TSVFDTXpkcnFsT3dZaHBjTFV0VFk3azhEQkdvVzloNVpIUmdxNWZBSURvSEYzNDVraCtYVlpXZHI1RUlvSE5aZ09YeTRYRjB0Tm43bTVXa1A1dVRyR2FzSEZDSWJ6NUhLMUdDNVgvRy9BenpKYTg0enFwVEZvdGw4dERWOU9JeFdJME5qWTJjQjAxMTYrVUwzWFdHeEFZbXFCa3BqNk0vaFdnb2ZnY1dVU1V1RTZwVW1VeG1VekV4Y1dodCtWOGExSHEyMzE5STBDSGxkSjA5S010T1BBakRoR21QRmlWbUpoUUlSUUtReVNDdVRlbnhLZkpNN1Z3VFh5aFZKMVdUSzBKNUtTQTU1MUg2czRkMFEvWll0S3JrUTVFR2d4V2JzOGdjYmU5YTZXWW5oRHNQUmtKRUN1M0UzVkZhdVE2eG9DdElxREZCRVR3Z0tWbDROTlh1THFHS0VWUVFKT09jOFVhNHRJN094WS91a0Y5OXNEaG02T2Vac2lKeWlnK2tKa0VYTGhEblEwSzdFcEdHbXNUVWUzelUvZjlDMmdPWldIWjJJdHZKUnFpYzM4MlZLK3Q5Q0YxNngzeGp3MHpwZUR3K0NpZkQyRHFWUThlZkFmb0kvbGh0ZmFZN0FBQUFBQkpSVTVFcmtKZ2dnPT0iCiAgICB9LAogICAgZHRpOiB7CiAgICAgICAgImltZyI6ICJkYXRhOmltYWdlL2dpZjtiYXNlNjQsUjBsR09EbGhVQUJRQVBjQUFJdUJBOUNuQVAvdEFPZlRDSmVVaFZGQ0FNekx5cm1qTjZLQ0FKZVBjSXFGY3R5eEFIUmRBUC85Zit6czdMeTh2TjNGQUpaNEFMbVZBTExPNGwxS0FQL1lBTG1oQUdoZU9vYVJoSXQ1QUhWdFRhS1ZWN0s1eXYvc1AvSHg4bDFSSXFTams2S05BTExkOVhSbk03dTZ0c1hrOWYvVUFKYURPR3BXQVAvOUwvL2lBTWUyQUg5bUFNdWlBRnBQSXYvMFg3eTVyZmIyOXNXaUFLS1RBTENOQUlOcEFIdHRESFJoQUsrUEFKZDdBTEt5c21oVEFQL01BTEt5d2V2NC85ankvNHR2QU1Yci8vcjkvL1BDQVAvL0FQVHo4RTFBREh4MVdWRkVFSzZva0x2by85bloyZnY3KzJGalFJdURYOVB3LzdibS84N3UvNWU2d05IT3dLemI4TjNhMFBYNy8xaEhBSFJxUVBENi8wdzlBS0tiQUZSSUYrTDEvNjZMQUdoZE1OM3ovOTdlM255UGdGTk5JTHExb0tPY2dIeDFZT2U1QU1EcC8yNTVZSjZia2NydC8ram40TVdkQUhScEFQL3l2OFhCc0lOOVpXNW1TS1NqblBQaUFFeENFR2h1VU9QajQrZm41M2hnQU1iR3hxdXFwMXBZTUc1bVEyRlhMWU9aa0pDTWVjSEJ3YkxZNzRCMlVPYjIvM1dFY05UVTFKNmJuWkN2c0dGWE1HaGRBS1hRNE5DekFLdXF0VjFRQU1YQUFMeTh5WkYwQUpaL0FQL3lmMzkyQVAvMUFJcWtvTGUzdC8vbGYrZm1BSFZ0Vko3RjBQUFZBUFBaQVAvZlg1bVZoTGUzeGE2UkFKQ01oV1ZSQUtLT1AxUklHS09manYvcmovLy92N0xpKzR1RWFNV3RBS1NqcVphUEFQL1BBS3FJQUplM3UvL2xQOXpaUC8vaVg2L0N3TFd3bTZLSUQ2bUhBTWpIeEg5c0grbmhMOXpHYi8vckwvUGNmNmlsbS8vbGIyaGFILy95bi8vWUgvL3ZyLy8vci8vNFA5QzJEOUM5RDdteEFQUHlBUFBWRDY2bWhwYUNENEovY09mREgrZmNUNTJZZzlqVnk1ZXFyTWJHMGVmTVgxMU5EL25IQUxlMnI3SzF4VjFRSC8vN2I2NmVBSzZuQUxtaEg5L1BqNWVGUU9MbDYvL1BENjZlTDdtZUw3Q1lOdi9sVDR0MUgxMU5FRkZFRC8vNGo3ZlI1TExTNk9mWlAvUGNML1BNQUllQmFYQmNEUFBsUDdLLzBaYVFlTm5aNExTUUFQL1lQN21hQUxMRjJNQy91cGFDQUxtblgvUGZYMFk0QUxMbC8vLy8veUg1QkFBQUFBQUFMQUFBQUFCUUFGQUFBQWovQVA4SkhFaXdvTUdEQ0JNcVhNaXdvY09IRUNOS25FaXhvc1dMR0ROcTNNaXhvOGVQRTR1UWNZS2xuOG1USnI5Z3dlSWt5UlNRRzRzaytZS3lwczJUU0p6QUtRS1RZcEVFU0c0V1lDRWhnTkdqQVJBQTJZRXlBYytlRDVNRXJia2pRZ0FlUTVBaTVjSDFqQmVtL1pBa2VRbzFZWkZCTmhrRUdOSUdDSVdiSnlsWTVSb0E3Q0N5WlF0VytWQVR5SmtoRWQ2T3NTTkdpbUVwL3FqQWt0Wk1VNmwrQlJDNDR0R21RTDh2YlBJV2hEUFZaSUcxUVByVktiVEpuK25UcUUydms4ZEtqaEZIMjFUSXNJd0VqbWFCWkdwU0NQQUt4Umd4cVlNSEY4VGgwSVYraWpMUlVXU1NqT1pvTlZFZ1FIREZEaFhoMkZHbm10QkRWS2tDajRnQS96QlpwU3dNSXlpQjFJdWdoYy8xN1BCTmk4RFc2QUo0RTZHUmxJZHB3QVZrTGYwQXdVTU8vYVFSMzRHbWxRQktENXIwSTRFcitXWDIwUjNIRldBWkN6eUU5Z2VDQ0FiaEFTUTl5T0ZnQlN4YzlsRU1CSmlFUWo4VURPRkZQNFZ3ZU5vVFBuUUJSWEJRL01NRWlJbDgxZ2xUQ1hoa0FIb3I5bU5VUDNiSWVOcEFRcXdSbkVBZWdOS0lDd1c0QTRGSkwyMFVnd2I5WERGS2dFUHNNTVo3U2hZVVJXcENDT1JBRDRjWUFZUUtvZlR6QVVmNW1KUUhaSUQxZzVpU3Bobms1R2srRERSTmQvM0lJTUJiU1dqRXhCRXN2b1hBR1FYeWVWcWFCRmx4bzJtQkNoUkREejFjUUlFQWpNaXBVUmhjOUZOaUFVTUFVY2Npa21KcUVDR0FFdjlFVHcrczlIUFBvZjA0aDlFblhhNEl4QkNSNHBqRlAwTDhrRjJtQmYwSkJrRTdocmhESlJMMGd3VkdlUFJoS29BTHZNaHFjRDhRMUFWMnlCSWtoQkwrZEVzUU9HejJBNEV5SmtsWWtTSG8xY0FpRHp2d2daMFZCVDBoWExnRStlRFBzdUp5MElNTCt2QlNZcUlXZ1FEWm5iLzJzNkZ3QjZIQmJVSnI4UHVQT2oyWXNjTUwwUTVpa1FjSzlNUEFXMjFFdTJkcVFSemtiMnJtQ21RRnBmL2dhMUFKNmJMalRGZ1doY0ZvRFFDZWdVQS8yRVdCMEptb3RmelBFMUFNbTlBVEF2ZHpqQ2VXdVN1UkFYNzBFNGxKNFREUUJIWkdWM3FwYVVZSDRROGFCWVg3QXo0OUpCTENMd3owaytWRWdmaDM1dzZZVUpDa2NGMGtaT3hwYXhEL0pMWS95R2JoenhNRC9jRGRCVUM4RUpxdUUrbGdVb2tNdk5FUGNQc21KTVRYS1E4a3NUOUNDN1IzM3YvOElFakdERXp5Y3hrVk9XNjF5SkpUSHB6RkJJRnhXdVlDb1VicDMxQ2tHWVFJcERkd2VrVVBtSFIxNUpOanQ5QzRwdEgrRDJxWm92YUU0UDcwL2p0RmdaaDBCZXZGUTd6UXlpMEw0VHl4MkpGT3pQUVNPVENIU1c5RlhvRHJxQ25SRUJoQnlQelB5cWE1VDM5cXBLTkNma1JMY0JsQkM2eGpnSUdDbzd5SDNNOGZXWkNkY0VJRUJGU0VCbUVTV1lJZkdNQURiNWhrR0ZvVFRnRUhFZ1FsS00wZ0Ird0MwWUtUTmxJMG9HMXY0NThmZGdBQlhaakVIaEVZZzNDNjlnUGQrU05wQjFIZ2pNZ1ZuRlQwd0FnSG1BUlQvL1lqRVR3d2lnWXJlRXNBb2tXbTB3Qk1JTjhTbXI1dUtML0NwWWFIdzJsRVAzWVJDNU5VeEFGeDZFY05HQUFnTDBBS0VhOGpDQSt0c0RkL2JMQ044UkdFQWdxQUNXT1lpQ0pNMklOL0lHTXFIbEFnUnFtcDFJeGdkWnF1alRBK0U1QURFSUx4c3lCVkpBeCsrRVkxN3RRUEY4a1FOWjBUeUJUOW9ZUURmdkFmZnp2UUJJd2dnVk13eFRZVzZVY0hBSENGNjBrQVdMUkFEU0hVeUR5VTBSSkJHQ2hBT2FoaEVyeE1oQXN6eUVBL1ZzUUFhNkRnQzVzajIwQ2dkNXBEbW1hVzRPUFFCM0tRamdqMHd3a1llY2RKUm9HdGVtZ0JCRUZZQTh4Q2w1cXZuVVlKYWZvV2d2NVFnQUgwd2pJcHBJZ3BLTEFCNjVrcUFIbjRnQy8vc2YrNStBZ3RsUEJaUkIxQ2tBSmIzUEVpcXBDRU5waFNBQUFoNEJWWHdLYTRXaFdmSmxDQURnT3dEQXd5b2dZS1NLSlVYV0xSSzJqUUR3aitRNTBVRlU0YStzR0lTcFRvQWpISWlPTUs0QUl1blNRSFBMRG0yd0NhMHRQOG9SODVJSUlGK21FRUEyaUVBRHVZQlRNSXNFZklMSUFITE5CUE5IdUtHaWtFU0FBUXNJd3BOa0lDQ2h6QUJudFFBM284ODVjZElJRU1PcVNxUDZ6S0FCWFFnU2thaUtsRzlIQWNGK3hCQjJwQXlRNkdFS2JzcWRVU2RXQkJKOTdhand2Y2dTTkw2SWNYR0JBSEhlZ2daQ2ZaYTErYjBFUkpVY0VPL1lpQUFBanJBbHgwaEZUdDJNQVJIUHRZbEJUZ3FUK3JneVVvaW9neDlBTUhBdUFFVTF5UUQ0Ly9PT0FJamlpQUwwaXJBMENZMWdzOHFFcy8rSEN5QTFFQkVVMFFHU2NFc0lEWmtvQUpIeUVBQllCUWkwRHdWZzBnTlVrRWhzQURDVEJsREtUSkRoV2tzTklDVUVJQ0psQ0JCQ3pEQlJMQVJCWGRpSWNUbUdCZDBzNmhxU3hxQTFmYVVDS1Q4S0VKQUE0d0h6eXpoV1FRb1FJTDZPOEZuZ3NUYUpoakg5aGtnaUY0cTRNNGpOVWtETkF2WFJEQUFnYmN3QTBnZGdNQWtKRUpJcGg0QldBeFFoejBBRjJZWEFOTEE3a0RoZWRnTGRORzRLbGM0WUVKVE14akV6K2lGWTQ0aVFiMllJaXl6T01HQ0RDcEIvUXdZdzFrTnk0TVlFQUV0a0JsS2xQQ01pWXh3aEh1R29hOEFFSWNza0JkUWU3d0FBcmpOUTc0aFV1Vyt3QUl4K3BCLzY1bEFRUTZza0hFZ3VEQkFHWjI3QndJUUlBNEhPSFBnQVlFQWRSQVdnTTQ0RFllR0lFWEloRFBnakRoRGdZb2M1NG5yWU1IR0FMT21na0RBMDR4ampvdnhBR2dEalVlbGtEcVVpOEJEeDY0VFVIMDRJSXRqRURWWmNrSFBCZ2dVVmlEaEFrYkVJWW5wbVZya0JqZ0JDbmdCNjk3VFpFcFlBR1ZCRm5DRWJqZ0JoU1lsTmdSR1FRUmtJQVhKbHlpQUl3SWhaaWhQUkVzdUtFZm4ranlQOEp3Q2NjNUlSZU00M1pFc0FDQkdmUkJCNUhXd1RMSVFRRjBQRnZkVWVFR01oaXdnd3NRUUFFMktBWXBISW52aVRnaEJLc3d3UTF5QUl3UUFHQUUreXk0UTZyUWlpMnNBZ0JFZUVZc25CQnhpVThjRGs3NGdpTE84UTJwZWR3blV3Z3crY2xYbnBlQUFBQTciCiAgICB9Cn07CgovLyB1c2VyIGhhcyBwcmVtaXVtIHRvb2xiYXIKbGV0IHByZW1pdW0gPSBmYWxzZTsKaWYgKGlzQmV0YSkgewogICAgcHJlbWl1bSA9ICQoIltjbGFzc149J25hdnN1Yi1zc3ctaWNvbiddIikuZXhpc3RzKCk7Cn0gZWxzZSB7CiAgICBwcmVtaXVtID0gJCgiI3Nzd21lbnUgLmltZ21lbnUiKS5leGlzdHMoKTsKfQoKZnVuY3Rpb24gY29tYmluZXIoaXRlbSwgdXJsLCBpbWFnZSkgewogICAgdXJsID0gdXJsLnJlcGxhY2UoIiVzIiwgaXRlbSk7CiAgICByZXR1cm4gYDxhIHRhYmluZGV4PSctMScgdGFyZ2V0PSdfYmxhbmsnIGhyZWY9JyR7dXJsfSc+PGltZyBzcmM9JyR7aW1hZ2V9JyBjbGFzcz0nc2VhcmNoaW1nJz48L2E+YDsKfQoKZnVuY3Rpb24gc3N3bGluayhpdGVtKSB7CiAgICAvLyB0aGUgb25seSBkaWZmZXJlbnQgb25lIGJlY2F1c2UgaXQgZG9lc24ndCB1c2UgYSBVUkwKICAgIHJldHVybiBgPGltZyBpdGVtPScke2l0ZW19JyBjbGFzcz0nc3N3LWhlbHBlciBzZWFyY2hpbWcnIHNyYz0nJHtsaW5rbWFwLnNzdy5pbWd9Jz5gOwp9CgpmdW5jdGlvbiBpblVSTChzdWJzdHIpIHsKICAgIHJldHVybiBkb2N1bWVudC5VUkwuaW5jbHVkZXMoc3Vic3RyKTsKfQoKZnVuY3Rpb24gY2xlYW5JdGVtKGl0ZW0pIHsKICAgIHJldHVybiBpdGVtLnJlcGxhY2VBbGwoIiEiLCAiJTIxIikKICAgICAgICAgICAgICAgLnJlcGxhY2VBbGwoIiMiLCAiJTIzIikKICAgICAgICAgICAgICAgLnJlcGxhY2VBbGwoIiYiLCAiJTI2IikKICAgICAgICAgICAgICAgLnJlcGxhY2VBbGwoIigiLCAiJTI4IikKICAgICAgICAgICAgICAgLnJlcGxhY2VBbGwoIikiLCAiJTI5IikKICAgICAgICAgICAgICAgLnJlcGxhY2VBbGwoIioiLCAiJTJBIikKICAgICAgICAgICAgICAgLnJlcGxhY2VBbGwoIisiLCAiJTJCIikKICAgICAgICAgICAgICAgLnJlcGxhY2VBbGwoIiwiLCAiJTJDIikKICAgICAgICAgICAgICAgLnJlcGxhY2VBbGwoIi8iLCAiJTJGIikKICAgICAgICAgICAgICAgLnJlcGxhY2VBbGwoIjoiLCAiJTNBIikKICAgICAgICAgICAgICAgLnJlcGxhY2VBbGwoIj8iLCAiJTNGIikKICAgICAgICAgICAgICAgLnJlcGxhY2VBbGwoIiAiLCAiKyIpOwp9CgovLyBvdmVyYWxsIGxpbmtlciB0aGluZwpmdW5jdGlvbiBtYWtlbGlua3MoaXRlbSwgZXh0cmFzKSB7CiAgICAvLyBleHRyYXMgaXMgYW4gb2JqZWN0IHRoYXQgY2FuIG9ubHkgaGF2ZSBib29sZWFuIG9mICdjYXNoJyBhbmQgJ3dlYXJhYmxlJyAoZm9yIG5vdykgfCBhbmQgYSBzdHJpbmcvaW50IG51bWJlciAnaXRlbWlkJyAob25seSBuZWVkZWQgZm9yIHdlYXJhYmxlIGJlaW5nIHRydWUpCiAgICBsZXQgbGlua3MgPSAiIjsKCiAgICBpdGVtID0gJC50cmltKGl0ZW0pOwogICAgaWYgKHR5cGVvZiBleHRyYXMgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgZXh0cmFzID0ge2Nhc2g6IGZhbHNlLCB3ZWFyYWJsZTogZmFsc2UsIHRyYWRlYWJsZTogdHJ1ZX07CiAgICB9CgogICAgaWYgKHR5cGVvZiBleHRyYXMudHJhZGVhYmxlID09PSAidW5kZWZpbmVkIikgewogICAgICAgIGV4dHJhcy50cmFkZWFibGUgPSB0cnVlOwogICAgfQoKICAgIGNvbnN0IHNzd3VybCA9IHNzd2xpbmsoaXRlbSk7CiAgICBjb25zdCBuYW1lID0gY2xlYW5JdGVtKGl0ZW0pOwoKICAgIGlmIChleHRyYXMuY2FzaCA9PT0gZmFsc2UgJiYgZXh0cmFzLnRyYWRlYWJsZSA9PT0gdHJ1ZSkgewogICAgICAgIGlmIChpblVSTCgicXVlc3RzLnBodG1sIikgPT09IGZhbHNlKSB7IC8vIGRvZXNuJ3Qgc2hvdyBlaXRoZXIgU1cgaWYgeW91J3JlIG9uIGEgcXVlc3QKICAgICAgICAgICAgLy8gU1NXCiAgICAgICAgICAgIGlmIChwcmVtaXVtKSB7CiAgICAgICAgICAgICAgICBsaW5rcyArPSBzc3d1cmw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFJlZ3VsYXIgU1cKICAgICAgICAgICAgbGlua3MgKz0gY29tYmluZXIobmFtZSwgbGlua21hcC5zdy51cmwsIGxpbmttYXAuc3cuaW1nKTsKICAgICAgICB9CgogICAgICAgIC8vIFRQCiAgICAgICAgbGlua3MgKz0gY29tYmluZXIobmFtZSwgbGlua21hcC50cC51cmwsIGxpbmttYXAudHAuaW1nKTsKCiAgICAgICAgLy8gQXVjdGlvbnMKICAgICAgICBsaW5rcyArPSBjb21iaW5lcihuYW1lLCBsaW5rbWFwLmF1LnVybCwgbGlua21hcC5hdS5pbWcpOwogICAgfQoKICAgIC8vIFNEQgogICAgaWYgKGluVVJMKCJzYWZldHlkZXBvc2l0IikgPT09IGZhbHNlKSB7CiAgICAgICAgbGlua3MgKz0gY29tYmluZXIobmFtZSwgbGlua21hcC5zZGIudXJsLCBsaW5rbWFwLnNkYi5pbWcpOwogICAgfQoKICAgIC8vIENsb3NldAogICAgaWYgKGV4dHJhcy53ZWFyYWJsZSAmJiBpblVSTCgiY2xvc2V0LnBodG1sIikgPT09IGZhbHNlKSB7CiAgICAgICAgbGlua3MgKz0gY29tYmluZXIobmFtZSwgbGlua21hcC5jbG9zZXQudXJsLCBsaW5rbWFwLmNsb3NldC5pbWcpOwogICAgfQoKICAgIC8vIEpOIGl0ZW1zCiAgICBsaW5rcyArPSBjb21iaW5lcihuYW1lLCBsaW5rbWFwLmpuaS51cmwsIGxpbmttYXAuam5pLmltZyk7CgogICAgLy8gQmF0dGxlcGVkaWEKICAgIGlmIChpblVSTCgiZG9tZSIpKSB7CiAgICAgICAgbGlua3MgKz0gY29tYmluZXIobmFtZSwgbGlua21hcC5iYXR0bGVwZWRpYS51cmwsIGxpbmttYXAuYmF0dGxlcGVkaWEuaW1nKTsKICAgIH0KCiAgICAvLyBEVEkKICAgIGlmIChleHRyYXMud2VhcmFibGUpIHsKICAgICAgICBsZXQgbGluayA9ICJodHRwczovL2ltcHJlc3Mub3Blbm5lby5uZXQvaXRlbXM/cT0lcyI7CiAgICAgICAgaWYgKGV4dHJhcy5pdGVtaWQgIT09IC0xICYmIHR5cGVvZiBleHRyYXMuaXRlbWlkICE9ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgIGxpbmsgPSBgaHR0cHM6Ly9pbXByZXNzLm9wZW5uZW8ubmV0L2l0ZW1zLyR7ZXh0cmFzLml0ZW1pZH1gOwogICAgICAgIH0KICAgICAgICBsaW5rcyArPSBjb21iaW5lcihuYW1lLCBsaW5rLCBsaW5rbWFwLmR0aS5pbWcpOwogICAgfQoKICAgIC8vIENoYW5nZWQgcXVlc3RzIHRvIHVzZSBkaXYsIGJlY2F1c2UgcCBtYWtlcyB0aGUgdGV4dCBzcGlsbCBvdXQgb2YgUkUgYm94CiAgICBjb25zdCBlbGVtZW50ID0gaW5VUkwoInF1ZXN0cy5waHRtbCIpID8gImRpdiIgOiAicCI7CiAgICBjb25zdCBoZWxwZXIgPSAkKGA8JHtlbGVtZW50fSBjbGFzcz0nc2VhcmNoLWhlbHBlcic+JHtsaW5rc308LyR7ZWxlbWVudH0+YCk7CgogICAgLy8gVE9ETzogcmVtb3ZlIHdoZW4gVFAgaXMgY29udmVydGVkIChob3BlZnVsbHkpCiAgICAvLyBiZWNhdXNlIG9mIGhvdyB1Z2x5IHRoaXMgbWFrZXMgdGhlIFRQLCBsZXQncyBpbmxpbmUgaXQKICAgIGNvbnN0IG5lZWRJbmxpbmUgPSBpblVSTCgiL2lzbGFuZC90cmFkaW5ncG9zdC5waHRtbCIpIHx8IGluVVJMKCIvcXVpY2tzdG9jay5waHRtbCIpOwogICAgaWYgKG5lZWRJbmxpbmUpIHsKICAgICAgICBoZWxwZXIuY3NzKHsKICAgICAgICAgICAgImRpc3BsYXkiOiAiaW5saW5lLWJsb2NrIiwKICAgICAgICAgICAgIm1hcmdpbi1sZWZ0IjogIjRweCIKICAgICAgICB9KTsKICAgIH0KCiAgICByZXR1cm4gaGVscGVyOwp9CgpqUXVlcnkuZm4uanVzdHRleHQgPSBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gJCh0aGlzKS5jbG9uZSgpLmNoaWxkcmVuKCkucmVtb3ZlKCkuZW5kKCkudGV4dCgpOwp9OwoKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCi8vIEkgZG9uJ3QgcmVhbGx5IGFwcHJvdmUgb2YgZG9pbmcgdGhlIGNvZGUgdGhpcyB3YXksIGJ1dCBpbiBhbiBlZmZvcnQgdG8gc2F2ZSBhcyBmZXcgaGVhZGFjaGVzIGFzIHBvc3NpYmxlCi8vIGZvciB0aGUgY291bnRsZXNzIHBlb3BsZSB3aG8gbWF5IHVzZSB0aGlzLCBpdCdzIGVhc2llciB0byBqdXN0IHB1dCBiZXRhICYgbm9uLWJldGEgaW50byBvbmUgZmlsZS4KLy8gQXMgcGFnZXMgYXJlIGNvbnZlcnRlZCwgdGhleSB3aWxsIGJlIHJlbW92ZWQgZnJvbSB0aGUgbm9uLWJldGEgaGFsZiBvZiB0aGUgZm9sbG93aW5nIGlmLXN0YXRlbWVudCwgYXMgVE5UCi8vIG1lbnRpb25lZCBpbiB0aGVpciBlbmQtb2YtZmxhc2ggdXBkYXRlIHRoYXQgYmV0YSBwYWdlcyB3aWxsIGJlIHRoZSBkZWZhdWx0IHdoZW4gdGhvc2UgcGFnZXMgYXJlIGRvbmUuCi8vIFRoYXQgc2FpZCwgdGhlIHBvaW50IG9mIG5vIHJldHVybiBzdGFydHMgaGVyZS4gTWF5IFNsb3RoIGhhdmUgbWVyY3kgb24gdXMuCgppZiAoaXNCZXRhKSB7CiAgICAvKgogICAgIEFkZHMgdGhlIHNlYXJjaCBpY29ucyB1bmRlciB0aGluZ3MgaW46CiAgICAgTWFpbiBTaG9wcwogICAgIEludmVudG9yeQogICAgIEtpdGNoZW4gUXVlc3QKICAgICBTbm93IEZhZXJpZSBRdWVzdHMKICAgICBJbGx1c2VuL0podWRvcmEKICAgICovCgogICAgLy8gQ29tbW9uIGZ1bmN0aW9ucyBnbyBoZXJlCiAgICBmdW5jdGlvbiBoYXNTZWFyY2hIZWxwZXIoZWxlbWVudCkgewogICAgICAgIC8vIHRoaXMgd2lsbCBiZSB1c2VkIGluIGFqYXhTdWNjZXNzIGhhbmRsZXJzLCBhcyB0byBub3QgZmxvb2QgdGhlIHBhZ2UgYWZ0ZXIgaG90LXJlbG9hZHMKICAgICAgICByZXR1cm4gJChlbGVtZW50KS5wYXJlbnQoKS5maW5kKCIuc2VhcmNoLWhlbHBlciIpLmxlbmd0aCAhPT0gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBnZW5lcmljUXVlc3QoKSB7CiAgICAgICAgLy8gc28gZmFyLCB3ZSBrbm93IHRoaXMgd29ya3Mgb246CiAgICAgICAgLy8gS2l0Y2hlbiBRdWVzdHMKICAgICAgICAvLyBTbm93IEZhZXJpZSBRdWVzdHMKCiAgICAgICAgLy8gZHVlIHRvIGluY29uc2lzdGVuY2llcyBpbiB0aGUgYWpheCByZXF1ZXN0cywgd2Ugd2lsbCBhdHRlbXB0IHRvIGRvIHR3byBkaWZmZXJlbnQga2luZHMgb2Ygc2VhcmNoIGhlbHBlciBhZGRzCiAgICAgICAgJCgiLml0ZW0taW1nICsgLml0ZW0tbmFtZSIpLmZpbmQoImIiKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgZWxlbWVudCkgewogICAgICAgICAgICBpZiAoIWhhc1NlYXJjaEhlbHBlcihlbGVtZW50KSkgewogICAgICAgICAgICAgICAgJChlbGVtZW50KS5hZnRlcihtYWtlbGlua3MoJChlbGVtZW50KS50ZXh0KCkpKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICAkKCJpbWdbc3JjKj0nL2l0ZW1zLyddICsgYnIgKyBwID4gYiIpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBlbGVtZW50KSB7CiAgICAgICAgICAgIGlmICghaGFzU2VhcmNoSGVscGVyKGVsZW1lbnQpKSB7CiAgICAgICAgICAgICAgICAkKGVsZW1lbnQpLmFmdGVyKG1ha2VsaW5rcygkKGVsZW1lbnQpLnRleHQoKSkpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CgogICAgLy8gTWFpbiBTaG9wcwogICAgaWYgKGluVVJMKCJvYmplY3RzLnBodG1sIikgfHwgaW5VUkwoInR5cGU9c2hvcCIpKSB7CiAgICAgICAgJCgiLml0ZW0taW1nICsgLml0ZW0tbmFtZSIpLmVhY2goZnVuY3Rpb24gKGluZGV4LCBlbGVtZW50KSB7CiAgICAgICAgICAgICQoZWxlbWVudCkuYWZ0ZXIobWFrZWxpbmtzKCQoZWxlbWVudCkudGV4dCgpKSk7CiAgICAgICAgfSk7CiAgICB9CgogICAgLy8gSW52ZW50b3J5CiAgICBpZiAoaW5VUkwoImludmVudG9yeSIpKSB7CiAgICAgICAgLy8gdGhlIGludmVudG9yeSBzeXN0ZW0gaXMgbW9yZSBmbGV4aWJsZSB0aGFuIGl0IHVzZWQgdG8gYmUsIHNvIHdlIGhhdmUgdG8gZG8gdGhpcyBhIGxpdHRsZSBkaWZmZXJlbnRseQogICAgICAgICQoZG9jdW1lbnQpLmFqYXhTdWNjZXNzKAogICAgICAgICAgICBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAkKCIuaXRlbS1pbWcgKyAuaXRlbS1uYW1lIikuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICAgICAvLyB0aGlzIHdpbGwgYWRkIG1vcmUgYW5kIG1vcmUgaWYgeW91IGRvIHRoaW5ncyBsaWtlIFNTVyBzZWFyY2hpbmcsIHNvIGNoZWNrIGZpcnN0CiAgICAgICAgICAgICAgICAgICAgaWYgKCFoYXNTZWFyY2hIZWxwZXIoZWxlbWVudCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGV4dHJhcyA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2g6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnZEaXNwbGF5IikuZGF0YXNldC50eXBlID09PSAibmMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2VhcmFibGU6ICQoZWxlbWVudCkucGFyZW50KCkuZmluZCgiOmNvbnRhaW5zKCd3ZWFyYWJsZScpIikubGVuZ3RoID4gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYWRlYWJsZTogJChlbGVtZW50KS5wYXJlbnQoKS5maW5kKCI6Y29udGFpbnMoJyhubyB0cmFkZSknKSIpLmxlbmd0aCA9PT0gMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1pZDogLTEKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgJChlbGVtZW50KS5hZnRlcihtYWtlbGlua3MoJChlbGVtZW50KS50ZXh0KCksIGV4dHJhcykpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgKTsKICAgIH0KCiAgICAvLyBLaXRjaGVuIFF1ZXN0CiAgICBpZiAoaW5VUkwoImlzbGFuZC9raXRjaGVuIikpIHsKICAgICAgICBnZW5lcmljUXVlc3QoKTsKICAgICAgICAkKGRvY3VtZW50KS5hamF4U3VjY2VzcyhnZW5lcmljUXVlc3QpOwogICAgfQoKICAgIC8vIFNub3cgRmFlcmllCiAgICBpZiAoaW5VUkwoIndpbnRlci9zbm93ZmFlcmllIikpIHsKICAgICAgICBnZW5lcmljUXVlc3QoKTsKICAgICAgICAkKGRvY3VtZW50KS5hamF4U3VjY2VzcyhnZW5lcmljUXVlc3QpOwogICAgfQoKICAgIC8vIEVzb3BoYWdvcgogICAgaWYgKGluVVJMKCJoYWxsb3dlZW4vZXNvcGhhZ29yIikpIHsKICAgICAgICBnZW5lcmljUXVlc3QoKTsKICAgICAgICAkKGRvY3VtZW50KS5hamF4U3VjY2VzcyhnZW5lcmljUXVlc3QpOwogICAgfQoKICAgIC8vIEVkbmEKICAgIGlmIChpblVSTCgiaGFsbG93ZWVuL3dpdGNodG93ZXIiKSkgewogICAgICAgIGdlbmVyaWNRdWVzdCgpOwogICAgICAgICQoZG9jdW1lbnQpLmFqYXhTdWNjZXNzKGdlbmVyaWNRdWVzdCk7CiAgICB9CgogICAgLy8gSWxsdXNlbiAmIEpodWRvcmEKICAgIGlmICgkKCIuZmFlcmllLWltZyIpLmV4aXN0cygpKSB7CiAgICAgICAgbGV0IGl0ZW1uYW1lID0gJCgiOmNvbnRhaW5zKCdXaGVyZSBpcyBteScpID4gYiIpLnRleHQoKTsKICAgICAgICAkKCI6Y29udGFpbnMoJ1doZXJlIGlzIG15JykiKS5wYXJlbnQoKS5maW5kKCJpbWdbc3JjKj0nL2l0ZW1zLyddIikuYWZ0ZXIobWFrZWxpbmtzKGl0ZW1uYW1lKSk7CiAgICB9CgogICAgLy8gU2hvcCBXaXogQXV0by1FeGFjdAogICAgaWYgKGluVVJMKCJ3aXphcmQucGh0bWw/c3RyaW5nPSIpKSB7CiAgICAgICAgJCgiI2NyaXRlcmlhIikudmFsKCJleGFjdCIpOwogICAgfQoKICAgIC8vIEhvc3BpdGFsCiAgICBpZiAoaW5VUkwoIi9ob3NwaXRhbC5waHRtbCIpKSB7CiAgICAgICAgJCgiLm5oLWRpc2Vhc2UtY3VyZSA+IHNwYW4gPiBiIikuZWFjaChmdW5jdGlvbiAoaywgdikgewogICAgICAgICAgICAkKHYpLnBhcmVudCgpLmFmdGVyKG1ha2VsaW5rcygkKHYpLnRleHQoKSkpOwogICAgICAgIH0pOwogICAgfQoKICAgIC8vIFF1ZXN0IExvZyBEYWlseSBSZXdhcmRzCiAgICBpZiAoaW5VUkwoIi9xdWVzdGxvZyIpKSB7CiAgICAgICAgLy8gSSBrbm93IHRoaXMgZG9lc24ndCB3b3JrIHdoZW4gbmF2aWdhdGluZyB0aGUgcXVlc3QgbG9nIHRhYnMsCiAgICAgICAgLy8gYnV0IEkgcmVhbGx5IGRvbid0IHdhbnQgdG8gYm9nIGRvd24gdGhlIHVzZXJzY3JpcHQgd2l0aCAiZmV0Y2giIG1vbmtleXBhdGNoZXMgZXRjLgogICAgICAgICQoIi5xbC1yZXdhcmQtaXRlbSArIC5xbC1yZXdhcmQtbGFiZWwiKS5lYWNoKGZ1bmN0aW9uIChrLCB2KSB7CiAgICAgICAgICAgICQodikuYXBwZW5kKG1ha2VsaW5rcygkKHYpLnRleHQoKSkpOwogICAgICAgIH0pOwoKICAgICAgICAkKCIucWwtYm9udXMtcmV3YXJkID4gLnFsLWJvbnVzLWl0ZW0iKS5lYWNoKGZ1bmN0aW9uIChrLCB2KSB7CiAgICAgICAgICAkKHYpLmFmdGVyKG1ha2VsaW5rcygkKHYpLnRleHQoKSkpOwogICAgICAgIH0pOwogICAgfQoKICAgIGZ1bmN0aW9uIHNzd29wZW4oaXRlbSkgewogICAgICAgIC8vIG9wZW4gdGhpcyBpbiBzdWNoIGEgd2F5IHRoYXQgaWYgdGhlICJfXzIwMjAiIHdhcyBjaGFuZ2VkL3JlbW92ZWQgd2l0aG91dCB3YXJuaW5nLCB0aGlzIHdpbGwgc3RpbGwgd29yawogICAgICAgIC8vIFRPRE86IGhhcmRjb2RlIHRoZSBjbGFzcyBuYW1lIGJldHRlciBvbmNlIG91dCBvZiBiZXRhCiAgICAgICAgJCgiW2NsYXNzXj0nc3N3LWhlYWRlciddIikubGFzdCgpLnBhcmVudCgpLnNob3coKTsKCiAgICAgICAgLy8gaWYgcmVzdWx0cyBhcmUgY3VycmVudGx5IHVwLCBjbG9zZSB0aGVtCiAgICAgICAgJCgiI3Nzdy1idXR0b24tbmV3LXNlYXJjaCIpLmNsaWNrKCk7CgogICAgICAgICQoIiNzc3ctY3JpdGVyaWEiKS52YWwoImV4YWN0Iik7CiAgICAgICAgJCgiI3NlYXJjaHN0ciIpLnZhbChpdGVtKTsKICAgIH0KfSBlbHNlIHsKICAgIC8qCiAgICAgQWRkcyB0aGUgc2VhcmNoIGljb25zIHVuZGVyIHRoaW5ncyBpbjoKICAgICBJbnZlbnRvcnkKICAgICBTREIKICAgICBDbG9zZXQKICAgICBBdWN0aW9uIEJpZGRpbmcgUGFnZQogICAgIFlvdXIgU2hvcCBQcmljZSBQYWdlCiAgICAgQ29pbmNpZGVuY2UKICAgICBNSSBUcmFpbmluZyBTY2hvb2wKICAgICBLSSBUcmFpbmluZyBTY2hvb2wKICAgICBTbm93IEZhZXJpZQogICAgIEVzb3BoYWdvcgogICAgIEVkbmEgUXVlc3QKICAgICBLaXRjaGVuIFF1ZXN0CiAgICAgSWxsdXNlbi9KaHVkb3JhCiAgICAgRW1wbG95bWVudCBBZ2VuY3kKICAgICBGYWVyaWUgUXVlc3QgUGFnZQogICAgIFlvdXIgU2hvcCdzIFNhbGVzIEhpc3RvcnkKICAgICovCgogICAgLy8gTWFpbiBTaG9wcwogICAgaWYgKGRvY3VtZW50LlVSTC5pbmNsdWRlcygib2JqZWN0cy5waHRtbD8iKSAmJiBkb2N1bWVudC5VUkwuaW5jbHVkZXMoInR5cGU9c2hvcCIpKSB7CiAgICAgICAgJCgiaW1nW3NyYyo9Jy9pdGVtcy8nXSIpLnBhcmVudCgpLnBhcmVudCgpLmZpbmQoImIiKS5lYWNoKGZ1bmN0aW9uIChrLCB2KSB7CiAgICAgICAgICAgICQodikuYWZ0ZXIobWFrZWxpbmtzKCQodikudGV4dCgpKSk7CiAgICAgICAgfSk7CiAgICB9CgogICAgLy8gSWdsb28gR2FyYWdlCiAgICBpZiAoZG9jdW1lbnQuVVJMLmluY2x1ZGVzKCIvd2ludGVyL2lnbG9vMi5waHRtbCIpKSB7CiAgICAgICAgJCgiaW1nW3NyYyo9Jy9pdGVtcy8nXSIpLnBhcmVudCgpLnBhcmVudCgpLmZpbmQoImIiKS5lYWNoKGZ1bmN0aW9uIChrLCB2KSB7CiAgICAgICAgICAgICQodikuYWZ0ZXIobWFrZWxpbmtzKCQodikudGV4dCgpKSk7CiAgICAgICAgfSk7CiAgICB9CgogICAgLy8gVHJhZGluZyBQb3N0CiAgICBpZiAoZG9jdW1lbnQuVVJMLmluY2x1ZGVzKCIvaXNsYW5kL3RyYWRpbmdwb3N0LnBodG1sIikpIHsKICAgICAgICAkKCJpbWdbc3JjKj0nL2l0ZW1zLyddIikuZWFjaChmdW5jdGlvbiAoaywgdikgewogICAgICAgICAgICAkKHRoaXMubmV4dFNpYmxpbmcpLmFmdGVyKG1ha2VsaW5rcygkKHRoaXMpWzBdLm5leHRTaWJsaW5nLm5vZGVWYWx1ZSkpOwogICAgICAgIH0pOwogICAgfQoKICAgIC8vIFJlZGVlbWluZyBDYXNoCiAgICBpZiAoZG9jdW1lbnQuVVJMLmluY2x1ZGVzKCJwcm9jZXNzX2Nhc2hfb2JqZWN0IikpIHsKICAgICAgICBleHRyYXMgPSB7Y2FzaDogdHJ1ZSwgd2VhcmFibGU6IHRydWV9OwogICAgICAgICQoImltZ1tzcmMqPScvaXRlbXMvJ10iKS5wYXJlbnQoKS5maW5kKCJiIikuZWFjaChmdW5jdGlvbiAoaywgdikgewogICAgICAgICAgICAkKHYpLmJlZm9yZSgiPGJyPiIpLmFmdGVyKG1ha2VsaW5rcygkKHYpLnRleHQoKSwgZXh0cmFzKSk7CiAgICAgICAgfSk7CiAgICB9CgogICAgLy8gQXVjdGlvbnMKICAgIGlmIChkb2N1bWVudC5VUkwuaW5jbHVkZXMoImF1Y3Rpb25faWQiKSkgewogICAgICAgIG5hbWViID0gJCgiYjpjb250YWlucygnb3duZWQgYnknKSIpOwogICAgICAgIGxldCBmaXhuYW1lID0gbmFtZWIuaHRtbCgpOwogICAgICAgIGZpeG5hbWUgPSBmaXhuYW1lLnN1YnN0cigwLCBmaXhuYW1lLmluZGV4T2YoIiAob3duIikpOyAvLyByZW1vdmUgIm93bmVkIGJ5Li4uIgogICAgICAgIG5hbWViLnBhcmVudCgpLmZpbmQoImltZyIpLmFmdGVyKG1ha2VsaW5rcyhmaXhuYW1lKSk7CiAgICB9CiAgICBpZiAoZG9jdW1lbnQuVVJMLmluY2x1ZGVzKCJhdWN0aW9ucy5waHRtbCIpIHx8IGRvY3VtZW50LlVSTC5pbmNsdWRlcygiZ2VuaWUucGh0bWwiKSkgewogICAgICAgICQoImFbaHJlZio9Jz90eXBlPWJpZHMmYXVjdGlvbl9pZD0nXTpub3QoOmhhcygnaW1nJykpIikuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsZW1lbnQpIHsKICAgICAgICAgICAgY29uc3QgaXRlbW5hbWUgPSAkKGVsZW1lbnQpLnRleHQoKTsKICAgICAgICAgICAgJChlbGVtZW50KS5hZnRlcihtYWtlbGlua3MoaXRlbW5hbWUpKTsKICAgICAgICB9KQogICAgfQoKICAgIC8vIEludmVudG9yeQogICAgaWYgKGRvY3VtZW50LlVSTC5pbmNsdWRlcygiaW52ZW50b3J5IikpIHsKICAgICAgICAkKCJpbWdbc3JjKj0nL2l0ZW1zLyddIikuZWFjaChmdW5jdGlvbiAoaywgdikgewogICAgICAgICAgICBsZXQgJG5hbWV0ZCA9ICQodikucGFyZW50KCkucGFyZW50KCk7CgogICAgICAgICAgICBsZXQgZXh0cmFzID0ge2Nhc2g6ICQodikuaGFzQ2xhc3MoIm90aGVySXRlbSIpLCB3ZWFyYWJsZTogJG5hbWV0ZC5oYXNDbGFzcygid2VhcmFibGUiKSwgaXRlbWlkOiAtMX07CgogICAgICAgICAgICBpZiAoJG5hbWV0ZC5maW5kKCJociIpLmV4aXN0cygpKSB7CiAgICAgICAgICAgICAgICBleHRyYXMudHJhZGVhYmxlID0gISRuYW1ldGQuZmluZCgic3Bhbjpjb250YWlucygnKG5vIHRyYWRlKScpIikuZXhpc3RzKCk7CiAgICAgICAgICAgICAgICAkbmFtZXRkLmZpbmQoImhyIikuYmVmb3JlKG1ha2VsaW5rcygkbmFtZXRkLmp1c3R0ZXh0KCksIGV4dHJhcykpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJG5hbWV0ZC5hcHBlbmQobWFrZWxpbmtzKCRuYW1ldGQuanVzdHRleHQoKSwgZXh0cmFzKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KCiAgICAvLyBTREIgJiBDbG9zZXQKICAgIGxldCBpc1NEQiA9IGRvY3VtZW50LlVSTC5pbmNsdWRlcygic2FmZXR5ZGVwb3NpdCIpOwogICAgbGV0IGlzQ2xvc2V0ID0gZG9jdW1lbnQuVVJMLmluY2x1ZGVzKCJjbG9zZXQiKTsKICAgIGlmIChpc1NEQiB8fCBpc0Nsb3NldCkgewogICAgICAgICQoImltZ1tzcmMqPScvaXRlbXMvJ10iKS5lYWNoKGZ1bmN0aW9uIChrLCB2KSB7CiAgICAgICAgICAgIGxldCBpdGVtSW5wdXQgPSAkKHYpLnBhcmVudCgpLnBhcmVudCgpLmZpbmQoInRkIikuZXEoNSkuZmluZCgiaW5wdXQiKTsKICAgICAgICAgICAgbGV0IGlkID0gaXRlbUlucHV0LmF0dHIoImRhdGEtaXRlbV9pZCIpIHx8IGl0ZW1JbnB1dC5hdHRyKCJuYW1lIikubWF0Y2goL1xkKy9nKVswXTsKCiAgICAgICAgICAgIGxldCBpc1dlYXJhYmxlID0gaXNDbG9zZXQgfHwgJCh2KS5wYXJlbnQoKS5wYXJlbnQoKS5maW5kKCJ0ZCIpLmVxKDEpLnRleHQoKS5pbmNsdWRlcygiKHdlYXJhYmxlKSIpOwogICAgICAgICAgICBsZXQgaXNOZW9DYXNoID0gZmFsc2U7CiAgICAgICAgICAgIGlmKGlzU0RCKSB7CiAgICAgICAgICAgICAgICBsZXQgY2F0ZWdvcnkgPSAkKHYpLnBhcmVudCgpLnBhcmVudCgpLmZpbmQoInRkIikuZXEoMyk7CiAgICAgICAgICAgICAgICBpc05lb0Nhc2ggPSBjYXRlZ29yeS50ZXh0KCkudHJpbSgpID09PSAiTmVvY2FzaCI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNDbG9zZXQpIHsKICAgICAgICAgICAgICAgIC8vIHRoaXMgaXMgbm90IDEwMCUgYWNjdXJhdGUsIHNlZTogaHR0cHM6Ly9pdGVtcy5qZWxseW5lby5uZXQvaXRlbS1lcnJvci1saXN0L3Jhcml0aWVzLwogICAgICAgICAgICAgICAgaXNOZW9DYXNoID0gJCh2KS5wYXJlbnQoKS5uZXh0KCJ0ZCIpLnRleHQoKS5pbmNsdWRlcygiKEFydGlmYWN0IC0gNTAwKSIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxldCBleHRyYXMgPSB7Y2FzaDogaXNOZW9DYXNoLCB3ZWFyYWJsZTogaXNXZWFyYWJsZSwgaXRlbWlkOiBpZH07CiAgICAgICAgICAgIGxldCBuYW1ldGQgPSAkKHYpLnBhcmVudCgpLnBhcmVudCgpLmZpbmQoInRkIikuZXEoMSk7CiAgICAgICAgICAgIG5hbWV0ZC5maW5kKCJiIikuZXEoMCkuYWZ0ZXIobWFrZWxpbmtzKG5hbWV0ZC5maW5kKCJiIikuZXEoMCkuanVzdHRleHQoKSwgZXh0cmFzKSk7CiAgICAgICAgfSk7CiAgICB9CgogICAgLy8gWW91ciBTaG9wCiAgICBpZiAoZG9jdW1lbnQuVVJMLmluY2x1ZGVzKCJ0eXBlPXlvdXIiKSB8fCBkb2N1bWVudC5VUkwuaW5jbHVkZXMoIm1hcmtldF95b3VyIikgfHwgJCgiW25hbWU9c3ViYnluZXh0XSIpLmxlbmd0aCA9PT0gMikgeyAvLyBiZWNhdXNlIHByZXNzaW5nIHRoZSBQcmV2aW91cy9OZXh0IDMwIGlzIGEgUE9TVCBhbmQgaGFzIG5vdGhpbmcgb2YgdmFsdWUgaW4gdGhlIFVSTAogICAgICAgICQoImltZ1tzcmMqPScvaXRlbXMvJ10iKS5lYWNoKGZ1bmN0aW9uIChrLCB2KSB7CiAgICAgICAgICAgIGxldCBuYW1ldGQgPSAkKHYpLnBhcmVudCgpLnBhcmVudCgpLmZpbmQoInRkIikuZXEoMCk7CiAgICAgICAgICAgIGxldCBpdGVtbmFtZSA9IG5hbWV0ZC50ZXh0KCk7CiAgICAgICAgICAgIGl0ZW1uYW1lID0gaXRlbW5hbWUucmVwbGFjZShuYW1ldGQuZmluZCgiLm1lZFRleHQiKS50ZXh0KCksICIiKTsKCiAgICAgICAgICAgIG5hbWV0ZC5maW5kKCJiIikuZXEoMCkuYWZ0ZXIobWFrZWxpbmtzKGl0ZW1uYW1lKSk7CiAgICAgICAgfSk7CiAgICB9CgogICAgLy8gQ29pbmNpZGVuY2UKICAgIGlmIChkb2N1bWVudC5VUkwuaW5jbHVkZXMoInNwYWNlL2NvaW5jaWRlbmNlIikpIHsKICAgICAgICAkKCJpbWdbc3JjKj0nL2l0ZW1zLyddIikuZWFjaChmdW5jdGlvbiAoaywgdikgewogICAgICAgICAgICBuYW1ldGQgPSAkKHYpLnBhcmVudCgpOwogICAgICAgICAgICBuYW1ldGQuZmluZCgiYiIpLmVxKDApLmFmdGVyKG1ha2VsaW5rcyhuYW1ldGQuanVzdHRleHQoKSkpOwogICAgICAgIH0pOwogICAgfQoKICAgIC8vIE1JIFRyYWluaW5nCiAgICBpZiAoZG9jdW1lbnQuVVJMLmluY2x1ZGVzKCIvaXNsYW5kL3RyYWluaW5nLnBodG1sP3R5cGU9c3RhdHVzIikpIHsKICAgICAgICAkKCJpbWdbc3JjKj0nL2l0ZW1zLyddIikuZWFjaChmdW5jdGlvbiAoaywgdikgewogICAgICAgICAgICAkKHYpLmFmdGVyKG1ha2VsaW5rcygkKHYpLnByZXYoKS50ZXh0KCkpKTsKICAgICAgICB9KTsKICAgIH0KCiAgICAvLyBTZWNyZXQgVHJhaW5pbmcKICAgIGlmIChkb2N1bWVudC5VUkwuaW5jbHVkZXMoIi9pc2xhbmQvZmlnaHRfdHJhaW5pbmcucGh0bWw/dHlwZT1zdGF0dXMiKSkgewogICAgICAgICQoImltZ1tzcmMqPScvaXRlbXMvJ10iKS5lYWNoKGZ1bmN0aW9uIChrLCB2KSB7CiAgICAgICAgICAgICQodikuYWZ0ZXIobWFrZWxpbmtzKCQodikucHJldigpLnRleHQoKSkpOwogICAgICAgIH0pOwogICAgfQoKICAgIC8vIEtJIFRyYWluaW5nCiAgICBpZiAoZG9jdW1lbnQuVVJMLmluY2x1ZGVzKCIvcGlyYXRlcy9hY2FkZW15LnBodG1sP3R5cGU9c3RhdHVzIikpIHsKICAgICAgICAkKCJpbWdbc3JjKj0nL2l0ZW1zLyddIikuZWFjaChmdW5jdGlvbiAoaywgdikgewogICAgICAgICAgICBsZXQgbmFtZXRkID0gJCh2KS5wYXJlbnQoKTsKICAgICAgICAgICAgbGV0IGl0ZW1uYW1lID0gbmFtZXRkLnBhcmVudCgpLmZpbmQoInRkID4gYiIpLmVxKDApLnRleHQoKTsKICAgICAgICAgICAgbmFtZXRkLnBhcmVudCgpLmZpbmQoInRkID4gYiIpLmVxKDApLmFmdGVyKG1ha2VsaW5rcyhpdGVtbmFtZSkpOwogICAgICAgIH0pOwogICAgfQoKICAgIC8vIFNub3cgRmFlcmllCiAgICAvLyBlc3NlbnRpYWxseSBzYW1lIGFzIGtpdGNoZW4uIHdvbywgbGF6eSEKICAgIGlmIChkb2N1bWVudC5VUkwuaW5jbHVkZXMoIndpbnRlci9zbm93ZmFlcmllIikpIHsKICAgICAgICBhZGRociA9IChkb2N1bWVudC5VUkwuaW5jbHVkZXMoInNub3dmYWVyaWUyIikgPT09IGZhbHNlKTsKICAgICAgICAkKCJpbWdbc3JjKj0nL2l0ZW1zLyddIikucGFyZW50KCkuZmluZCgiYiIpLmVhY2goZnVuY3Rpb24gKGssIHYpIHsKICAgICAgICAgICAgJCh2KS5hZnRlcihtYWtlbGlua3MoJCh2KS50ZXh0KCkpKTsKICAgICAgICB9KTsKICAgIH0KCiAgICAvLyBFc29waGFnb3IKICAgIGlmIChkb2N1bWVudC5VUkwuaW5jbHVkZXMoImhhbGxvd2Vlbi9lc29waGFnb3IiKSkgewogICAgICAgICQoImltZ1tzcmMqPScvaXRlbXMvJ10iKS5lYWNoKGZ1bmN0aW9uIChrLCB2KSB7CiAgICAgICAgICAgIGxldCBpdGVtbmFtZSA9ICQodikucGFyZW50KCkuZmluZCgiYiIpOwogICAgICAgICAgICBpdGVtbmFtZS5hZnRlcihtYWtlbGlua3MoaXRlbW5hbWUudGV4dCgpKSk7CiAgICAgICAgfSk7CiAgICB9CgogICAgLy8gRWRuYQogICAgaWYgKGRvY3VtZW50LlVSTC5pbmNsdWRlcygiaGFsbG93ZWVuL3dpdGNodG93ZXIiKSkgewogICAgICAgICQoImltZ1tzcmMqPScvaXRlbXMvJ10iKS5lYWNoKGZ1bmN0aW9uIChrLCB2KSB7CiAgICAgICAgICAgIGxldCBpdGVtbmFtZSA9ICQodikucGFyZW50KCkuZmluZCgiYiIpOwogICAgICAgICAgICBpdGVtbmFtZS5hZnRlcihtYWtlbGlua3MoaXRlbW5hbWUudGV4dCgpKSk7CiAgICAgICAgfSk7CiAgICB9CgogICAgLy8gS2l0Y2hlbgogICAgaWYgKGRvY3VtZW50LlVSTC5pbmNsdWRlcygiaXNsYW5kL2tpdGNoZW4iKSkgewogICAgICAgICQoImltZ1tzcmMqPScvaXRlbXMvJ10iKS5wYXJlbnQoKS5maW5kKCJiIikuZWFjaChmdW5jdGlvbiAoaywgdikgewogICAgICAgICAgICAkKHYpLmFmdGVyKG1ha2VsaW5rcygkKHYpLnRleHQoKSkpOwogICAgICAgIH0pOwogICAgfQoKICAgIC8vIGlsbHVzZW4gJiBqaHVkb3JhCiAgICBpZiAoJCgiaW1nW3NyYyo9J2VmXzIuZ2lmJ10iKS5leGlzdHMoKSB8fCAkKCJpbWdbc3JjKj0nZGFya2ZhZXJpZXF1ZXN0Mi5naWYnXSIpLmV4aXN0cygpKSB7CiAgICAgICAgbGV0IGl0ZW1uYW1lID0gJCgiY2VudGVyOmNvbnRhaW5zKCdXaGVyZSBpcyBteScpID4gYiIpLnRleHQoKTsKICAgICAgICAkKCJjZW50ZXI6Y29udGFpbnMoJ1doZXJlIGlzIG15JykiKS5wYXJlbnQoKS5maW5kKCJpbWdbc3JjKj0nL2l0ZW1zLyddIikuYWZ0ZXIobWFrZWxpbmtzKGl0ZW1uYW1lKSk7CiAgICB9CgogICAgLy8gZW1wbG95bWVudCBhZ2VuY3kKICAgIGlmIChkb2N1bWVudC5VUkwuaW5jbHVkZXMoImVtcGxveW1lbnQiKSkgewogICAgICAgIGlmIChkb2N1bWVudC5VUkwuaW5jbHVkZXMoInR5cGU9am9icyIpKSB7CiAgICAgICAgICAgICQoImI6Y29udGFpbnMoJ0ZpbmQnKSIpLmVhY2goZnVuY3Rpb24gKGssIHYpIHsKICAgICAgICAgICAgICAgIGxldCBpdGVtbmFtZSA9ICQodikucGFyZW50KCkuY2xvbmUoKS5maW5kKCJiIikucmVtb3ZlKCkuZW5kKCkuaHRtbCgpLnNwbGl0KCI8YnI+IilbMF07CiAgICAgICAgICAgICAgICAkKCQodilbMF0ubmV4dFNpYmxpbmcpLmFmdGVyKG1ha2VsaW5rcyhpdGVtbmFtZSkpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgaWYgKGRvY3VtZW50LlVSTC5pbmNsdWRlcygiam9iX2lkIikpIHsKICAgICAgICAgICAgJCgiYjpjb250YWlucygnRmluZCcpIikuZXEoMCkuYWZ0ZXIobWFrZWxpbmtzKCQoImI6Y29udGFpbnMoJ0ZpbmQnKSIpLmVxKDApLmp1c3R0ZXh0KCkpKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gRmFlcmllIFF1ZXN0cwogICAgaWYgKGRvY3VtZW50LlVSTC5pbmNsdWRlcygicXVlc3RzLnBodG1sIikpIHsKICAgICAgICAkKCJpbWdbc3JjKj0nL2l0ZW1zLyddIikuZWFjaChmdW5jdGlvbiAoaywgdikgewogICAgICAgICAgICBsZXQgaXRlbW5hbWUgPSAkKHYpLnBhcmVudCgpLmZpbmQoImIiKTsKICAgICAgICAgICAgaXRlbW5hbWUuYWZ0ZXIobWFrZWxpbmtzKGl0ZW1uYW1lLnRleHQoKSkpOwogICAgICAgIH0pOwogICAgfQoKICAgIC8vIEthZG9hdGVyeQogICAgaWYgKGRvY3VtZW50LlVSTC5pbmNsdWRlcygiZ2FtZXMva2Fkb2F0ZXJ5IikpIHsKICAgICAgICAkKCJ0ZDpjb250YWlucygnWW91IHNob3VsZCBnaXZlIGl0Jyk6bm90KDpjb250YWlucygnVGhhbmtzLCcpKSIpLmVhY2goZnVuY3Rpb24gKGssIHYpIHsKICAgICAgICAgICAgbGV0IGl0ZW1uYW1lID0gJCh2KS5maW5kKCJzdHJvbmciKS5sYXN0KCk7CiAgICAgICAgICAgIGl0ZW1uYW1lLmFmdGVyKG1ha2VsaW5rcyhpdGVtbmFtZS50ZXh0KCkpKTsKICAgICAgICB9KTsKICAgIH0KCiAgICAvLyBHZW5lcmFsIFN0b3JlCiAgICBpZiAoZG9jdW1lbnQuVVJMLmluY2x1ZGVzKCJnZW5lcmFsc3RvcmUucGh0bWwiKSkgewogICAgICAgICQoInRkOmNvbnRhaW5zKCdDb3N0Jyk6bm90KDpoYXMoJ3RkJykpIikuZmluZCgic3Ryb25nIikuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsZW1lbnQpIHsKICAgICAgICAgICAgJChlbGVtZW50KS5hZnRlcihtYWtlbGlua3MoJChlbGVtZW50KS50ZXh0KCkpKTsKICAgICAgICB9KTsKICAgIH0KCiAgICAvLyBIaWRkZW4gVG93ZXIKICAgIGlmIChkb2N1bWVudC5VUkwuaW5jbHVkZXMoImhpZGRlbnRvd2VyOTM4LnBodG1sIikpIHsKICAgICAgICAkKCIuY29udGVudCB0YWJsZSIpLmZpbmQoImI6bm90KFtzdHlsZSo9J3JlZDsnXSkiKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgZWxlbWVudCkgewogICAgICAgICAgICAkKGVsZW1lbnQpLmFmdGVyKG1ha2VsaW5rcygkKGVsZW1lbnQpLnRleHQoKSkpOwogICAgICAgIH0pOwogICAgfQoKICAgIC8vIFlvdXIgU2hvcCdzIFNhbGVzIEhpc3RvcnkKICAgIGlmIChkb2N1bWVudC5VUkwuaW5jbHVkZXMoIm1hcmtldC5waHRtbD90eXBlPXNhbGVzIikpIHsKICAgICAgICAkKCdbdmFsdWU9IkNsZWFyIFNhbGVzIEhpc3RvcnkiXScpLnBhcmVudCgpLnBhcmVudCgpLnBhcmVudCgpLnBhcmVudCgpLmZpbmQoJ3RyJykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsZW1lbnQpIHsKICAgICAgICAgICAgLy8gbWFrZSBzdXJlIGl0J3Mgbm90IHRoZSBoZWFkZXIgb3IgZm9vdGVyIG9mIHRoaXMgdGFibGUKICAgICAgICAgICAgbGV0IGNlbGwgPSAkKGVsZW1lbnQpLmZpbmQoInRkIikuZXEoMSk7CiAgICAgICAgICAgIGlmIChjZWxsLmF0dHIoJ2JnY29sb3InKSA9PT0gIiNmZmZmY2MiKSB7CiAgICAgICAgICAgICAgICAkKGNlbGwpLmFwcGVuZChtYWtlbGlua3MoJChjZWxsKS50ZXh0KCkpKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQoKICAgIC8vIFF1aWNrc3RvY2sKICAgIGlmIChkb2N1bWVudC5VUkwuaW5jbHVkZXMoInF1aWNrc3RvY2sucGh0bWwiKSkgewogICAgICAgICQoJ2Zvcm1bbmFtZT0icXVpY2tzdG9jayJdIHRyJykuZWFjaChmdW5jdGlvbiAoaW5kZXgsIGVsZW1lbnQpIHsKICAgICAgICAgICAgaWYgKCQoZWxlbWVudCkuZmluZCgidGQiKS5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjZWxsID0gJChlbGVtZW50KS5maW5kKCJ0ZCIpLmVxKDApOwogICAgICAgICAgICAgICAgaWYgKCQoY2VsbCkudGV4dCgpICE9PSAiQ2hlY2sgQWxsIikgewogICAgICAgICAgICAgICAgICAgICQoY2VsbCkuYXBwZW5kKG1ha2VsaW5rcygkKGNlbGwpLnRleHQoKSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CgogICAgLy8gQmF0dGxlZG9tZQogICAgaWYgKGRvY3VtZW50LlVSTC5pbmNsdWRlcygiL2RvbWUvbmVvcGV0cyIpKSB7CiAgICAgICAgJCgiLmVxdWlwRnJhbWUiKS5lYWNoKGZ1bmN0aW9uIChpbmRleCwgZWxlbWVudCkgewogICAgICAgICAgICBjb25zdCBpdGVtbmFtZSA9ICQoZWxlbWVudCkudGV4dCgpLnRyaW0oKTsKICAgICAgICAgICAgaWYgKGl0ZW1uYW1lKSB7IC8vIGlnbm9yZSBpZiBlbXB0eSBzbG90CiAgICAgICAgICAgICAgICAkKG1ha2VsaW5rcyhpdGVtbmFtZSkpLmFwcGVuZFRvKCQoZWxlbWVudCkpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgJCgiLmVxdWlwVGFibGUiKS5jc3MoeyJvdmVyZmxvdy15IjogInNjcm9sbCJ9KTsKICAgIH0KCiAgICBmdW5jdGlvbiBzc3dsaW1pdGVkKGl0ZW0pIHsKICAgICAgICByZXR1cm4gKC9OZXJrbWlkKCR8LlgrJCkvLnRlc3QoaXRlbSkgfHwgaXRlbS5lbmRzV2l0aCgiUGFpbnQgQnJ1c2giKSB8fCBpdGVtLmVuZHNXaXRoKCJUcmFuc21vZ3JpZmljYXRpb24gUG90aW9uIikgfHwgaXRlbS5lbmRzV2l0aCgiTGFib3JhdG9yeSBNYXAiKSk7CiAgICB9CgogICAgZnVuY3Rpb24gc3N3b3BlbihpdGVtKSB7CiAgICAgICAgaWYgKCQoIi5zc3dkcm9wIikuaGFzQ2xhc3MoInBhbmVsX2hpZGRlbiIpKSB7CiAgICAgICAgICAgICQoIiNzc3dtZW51IC5pbWdtZW51IikuY2xpY2soKTsKICAgICAgICB9CgogICAgICAgIGlmICgkKCIjc3N3LXRhYnMtMSIpLmhhc0NsYXNzKCJ1aS10YWJzLWhpZGUiKSkgewogICAgICAgICAgICAkKCcjc3N3LXRhYnMnKS50YWJzKCdzZWxlY3QnLCAwKTsKICAgICAgICB9CgogICAgICAgICQoIiNwcmljZS1saW1pdGVkIikucHJvcCgiY2hlY2tlZCIsIHNzd2xpbWl0ZWQoaXRlbSkpOwoKICAgICAgICAkKCIjc3N3LWNyaXRlcmlhIikudmFsKCJleGFjdCIpOwoKICAgICAgICAkKCIjc2VhcmNoc3RyIikudmFsKGl0ZW0pOwogICAgfQp9CgokKCJib2R5Iikub24oImNsaWNrIiwgIi5zc3ctaGVscGVyIiwgZnVuY3Rpb24gKCkgewogICAgc3N3b3BlbigkKHRoaXMpLmF0dHIoIml0ZW0iKSk7Cn0pOwo="},{"name":"Neopets - NeoFoodClub+ <MettyNeo>","options":{"check_for_updates":false,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_powerful_this":null,"sandbox":null,"noframes":null,"unwrap":null,"run_at":null,"tab_types":null,"override":{"use_includes":[],"orig_includes":[],"merge_includes":true,"use_matches":[],"orig_matches":["*neofood.club/*","https://www.neopets.com/pirates/foodclub.phtml?type=bet*","https://www.neopets.com/pirates/process_foodclub.phtml?*&type=bet*","https://www.neopets.com/pirates/foodclub.phtml?type=current_bets*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"orig_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null,"orig_run_in":[]},"user_modified":null,"run_in":null,"tags":[]},"storage":{"ts":1727455827959,"data":{"round":"s8963","beturl":"saudeapuxedpuiecuueeefucea","betstatus":"o{\"1\": \"Bet placed!\",\"2\": \"Bet placed!\",\"3\": \"Bet placed!\",\"4\": \"Bet placed!\",\"5\": \"Bet placed!\",\"6\": \"Bet placed!\",\"7\": \"Bet placed!\",\"8\": \"Bet placed!\",\"9\": \"Bet placed!\",\"10\": \"Bet placed!\"}","tabinfo":"o{\"https://www.neopets.com/pirates/process_foodclub.phtml?winner3=15&matches[]=3&bet_amount=12036&total_odds=2&winnings=24072&type=bet\": \"1\",\"https://www.neopets.com/pirates/process_foodclub.phtml?winner1=2&winner3=15&matches[]=1&matches[]=3&bet_amount=12036&total_odds=4&winnings=48144&type=bet\": \"2\",\"https://www.neopets.com/pirates/process_foodclub.phtml?winner1=2&winner3=15&winner5=4&matches[]=1&matches[]=3&matches[]=5&bet_amount=12036&total_odds=8&winnings=96288&type=bet\": \"3\",\"https://www.neopets.com/pirates/process_foodclub.phtml?winner1=2&winner3=15&winner5=12&matches[]=1&matches[]=3&matches[]=5&bet_amount=12036&total_odds=12&winnings=144432&type=bet\": \"4\",\"https://www.neopets.com/pirates/process_foodclub.phtml?winner1=2&winner3=15&winner5=9&matches[]=1&matches[]=3&matches[]=5&bet_amount=12036&total_odds=28&winnings=337008&type=bet\": \"5\",\"https://www.neopets.com/pirates/process_foodclub.phtml?winner1=2&winner3=15&winner5=8&matches[]=1&matches[]=3&matches[]=5&bet_amount=12036&total_odds=32&winnings=385152&type=bet\": \"6\",\"https://www.neopets.com/pirates/process_foodclub.phtml?winner1=14&winner3=15&matches[]=1&matches[]=3&bet_amount=12036&total_odds=12&winnings=144432&type=bet\": \"7\",\"https://www.neopets.com/pirates/process_foodclub.phtml?winner1=14&winner3=15&winner5=4&matches[]=1&matches[]=3&matches[]=5&bet_amount=12036&total_odds=24&winnings=288864&type=bet\": \"8\",\"https://www.neopets.com/pirates/process_foodclub.phtml?winner1=18&winner3=15&matches[]=1&matches[]=3&bet_amount=12036&total_odds=14&winnings=168504&type=bet\": \"9\",\"https://www.neopets.com/pirates/process_foodclub.phtml?winner1=10&winner3=15&matches[]=1&matches[]=3&bet_amount=12036&total_odds=16&winnings=192576&type=bet\": \"10\"}","placedbets":"o[{\"1\": \"Dan\",\"2\": \"Gooblah\",\"3\": null,\"4\": null,\"5\": null},{\"1\": null,\"2\": \"Gooblah\",\"3\": null,\"4\": null,\"5\": \"Tailhook\"},{\"1\": null,\"2\": \"Gooblah\",\"3\": null,\"4\": null,\"5\": \"Blackbeard\"},{\"1\": null,\"2\": \"Gooblah\",\"3\": null,\"4\": null,\"5\": \"Ned\"},{\"1\": null,\"2\": \"Gooblah\",\"3\": null,\"4\": \"Orvinn\",\"5\": null},{\"1\": null,\"2\": \"Gooblah\",\"3\": null,\"4\": \"Sproggie\",\"5\": null},{\"1\": null,\"2\": \"Gooblah\",\"3\": null,\"4\": \"Stripey\",\"5\": null},{\"1\": null,\"2\": \"Gooblah\",\"3\": null,\"4\": null,\"5\": null},{\"1\": \"Franchisco\",\"2\": \"Gooblah\",\"3\": null,\"4\": null,\"5\": null},{\"1\": null,\"2\": \"Gooblah\",\"3\": null,\"4\": null,\"5\": \"Edmund\"}]","toprocess":"n10"}},"enabled":true,"position":4,"file_url":"https://github.com/Mettymagic/np-userscripts/raw/main/Neopets%20-%20NeoFoodClub%2B.user.js","uuid":"539ccfa9-cbd4-4d7a-b490-2fe5c5143ddb","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBOZW9wZXRzIC0gTmVvRm9vZENsdWIrIDxNZXR0eU5lbz4KLy8gQHZlcnNpb24gICAgICAxLjMKLy8gQGRlc2NyaXB0aW9uICBBZGRzIHNvbWUgaW1wcm92ZW1lbnRzIHRvIG5lb2Zvb2QuY2x1YiBpbmNsdWRpbmcgcmVtZW1iZXJpbmcgYmV0IHN0YXR1cywgdW5mb2N1c2luZyB0YWJzIGFuZCBhdXRvLWNsb3NpbmcgdGFicy4KLy8gQGF1dGhvciAgICAgICBNZXRhbWFnaWMKLy8gQG1hdGNoICAgICAgICAqbmVvZm9vZC5jbHViLyoKLy8gQG1hdGNoICAgICAgICBodHRwczovL3d3dy5uZW9wZXRzLmNvbS9waXJhdGVzL2Zvb2RjbHViLnBodG1sP3R5cGU9YmV0KgovLyBAbWF0Y2ggICAgICAgIGh0dHBzOi8vd3d3Lm5lb3BldHMuY29tL3BpcmF0ZXMvcHJvY2Vzc19mb29kY2x1Yi5waHRtbD8qJnR5cGU9YmV0KgovLyBAbWF0Y2ggICAgICAgIGh0dHBzOi8vd3d3Lm5lb3BldHMuY29tL3BpcmF0ZXMvZm9vZGNsdWIucGh0bWw/dHlwZT1jdXJyZW50X2JldHMqCi8vIEByZXF1aXJlICAgICAgaHR0cHM6Ly9hamF4Lmdvb2dsZWFwaXMuY29tL2FqYXgvbGlicy9qcXVlcnkvMi4xLjMvanF1ZXJ5Lm1pbi5qcwovLyBAaWNvbiAgICAgICAgIGh0dHBzOi8vaS5pbWd1ci5jb20vUm51cUxSbS5wbmcKLy8gQGdyYW50IEdNX3NldFZhbHVlCi8vIEBncmFudCBHTV9nZXRWYWx1ZQovLyBAZ3JhbnQgR01fZGVsZXRlVmFsdWUKLy8gQGdyYW50IEdNX2FkZFZhbHVlQ2hhbmdlTGlzdGVuZXIKLy8gQGdyYW50IHdpbmRvdy5mb2N1cwovLyBAZ3JhbnQgd2luZG93LmNsb3NlCi8vIEBkb3dubG9hZFVSTCAgaHR0cHM6Ly9naXRodWIuY29tL01ldHR5bWFnaWMvbnAtdXNlcnNjcmlwdHMvcmF3L21haW4vTmVvcGV0cyUyMC0lMjBOZW9Gb29kQ2x1YiUyQi51c2VyLmpzCi8vIEB1cGRhdGVVUkwgICAgaHR0cHM6Ly9naXRodWIuY29tL01ldHR5bWFnaWMvbnAtdXNlcnNjcmlwdHMvcmF3L21haW4vTmVvcGV0cyUyMC0lMjBOZW9Gb29kQ2x1YiUyQi51c2VyLmpzCi8vID09L1VzZXJTY3JpcHQ9PQoKLy8gVHJhbnMgcmlnaHRzIGFyZSBodW1hbiByaWdodHMgXl4KLy8gbWV0dHkgc2F5cyBoaQoKLy89PT09PT09PT09PT09PT0KLy8gc2NyaXB0IG9wdGlvbnMKLy89PT09PT09PT09PT09PT0KCmNvbnN0IEFVVE9DTE9TRVRBQlMgPSBmYWxzZSAvL2F1dG9tYXRpY2FsbHkgY2xvc2VzIGJldCB0YWJzCmNvbnN0IEZPUkNFQkdUQUIgPSB0cnVlIC8vZm9yY2VzIG5ldyB0YWJzIHRvIGJlIGluIHRoZSBiYWNrZ3JvdW5kCmNvbnN0IEFVVE9NQVhCRVQgPSB0cnVlIC8vYXV0b21hdGljYWxseSBmaWxscyBtYXggYmV0IHZhbHVlCmNvbnN0IEFVVE9DT0xMRUNUTUFYQkVUID0gdHJ1ZSAvL2dyYWJzIHRoZSBtYXggYmV0IGZyb20gdGhlIG5lbyBmb29kIGNsdWIgcGFnZSBmb3IgY29udmVuaWVuY2UKY29uc3QgQVVUT0NPTExFQ1RfVElNRU9VVCA9IDEyMCAvL2F1dG9jb2xsZWN0ZWQgZGF0YSB0aW1lcyBvdXQgYWZ0ZXIgdGhpcyBtYW55IG1pbnV0ZXMgKGRlZmF1bHQ6IDJocikKY29uc3QgQUREX05FT19MSU5LUyA9IHRydWUgLy9hZGRzIHNvbWUgcXVpY2sgbGlua3MgdG8gbmVvcGV0cyBmb29kIGNsdWIgcGFnZXMgZm9yIGNvbnZlbmllbmNlCgovLz09PT09PT09PT09PT09PT0KLy8gZm9vZCBjbHViIGRpY3RzCi8vPT09PT09PT09PT09PT09PQoKY29uc3QgQVJFTkFfTkFNRVMgPSB7CiAgICAxOiAiU2hpcHdyZWNrIiwKICAgIDI6ICJMYWdvb24iLAogICAgMzogIlRyZWFzdXJlIElzbGFuZCIsCiAgICA0OiAiSGlkZGVuIENvdmUiLAogICAgNTogIkhhcnBvb24gSGFycnkncyIKfQpjb25zdCBBUkVOQV9JRFMgPSBPYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmVudHJpZXMoQVJFTkFfTkFNRVMpLm1hcChhID0+IGEucmV2ZXJzZSgpKSkKCmNvbnN0IFBJUkFURV9OQU1FUyA9IHsKICAgIDE6ICJEYW4iLAogICAgMjogIlNwcm9nZ2llIiwKICAgIDM6ICJPcnZpbm4iLAogICAgNDogIkx1Y2t5IiwKICAgIDU6ICJFZG11bmQiLAogICAgNjogIlBlZyBMZWciLAogICAgNzogIkJvbm5pZSIsCiAgICA4OiAiUHVmZm8iLAogICAgOTogIlN0dWZmIiwKICAgIDEwOiAiU3F1aXJlIiwKICAgIDExOiAiQ3Jvc3NibGFkZXMiLAogICAgMTI6ICJTdHJpcGV5IiwKICAgIDEzOiAiTmVkIiwKICAgIDE0OiAiRmFpcmZheCIsCiAgICAxNTogIkdvb2JsYWgiLAogICAgMTY6ICJGcmFuY2hpc2NvIiwKICAgIDE3OiAiRmVkZXJpc21vIiwKICAgIDE4OiAiQmxhY2tiZWFyZCIsCiAgICAxOTogIkJ1Y2siLAogICAgMjA6ICJUYWlsaG9vayIsCn07CmNvbnN0IFBJUkFURV9JRFMgPSBPYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmVudHJpZXMoUElSQVRFX05BTUVTKS5tYXAoYSA9PiBhLnJldmVyc2UoKSkpCgovLz09PT09PT09PT09PT09PQovLyBtYWluIGZ1bmN0aW9ucwovLz09PT09PT09PT09PT09PQoKLy9hcHBsaWVzIGNoYW5nZXMgdG8gbmVvZm9vZC5jbHViCmlmKHdpbmRvdy5sb2NhdGlvbi5ocmVmLmluY2x1ZGVzKCJuZW9mb29kLmNsdWIiKSkgewogICAgYWRkQ1NTKCkKICAgIHdhaXRGb3JCZXRUYWJsZSgpCn0KLy9yZWNvcmRzIG1heCBiZXQgdmFsdWUgZnJvbSBuZW9wZXRzIGZvb2QgY2x1YiBwYWdlCmVsc2UgaWYod2luZG93LmxvY2F0aW9uLmhyZWYuaW5jbHVkZXMoIm5lb3BldHMuY29tL3BpcmF0ZXMvZm9vZGNsdWIucGh0bWw/dHlwZT1iZXQiKSAmJiBBVVRPQ09MTEVDVE1BWEJFVCkgewogICAgbGV0IG1heGJldCA9ICQoIiNjb250ZW50ID4gdGFibGUgPiB0Ym9keSA+IHRyID4gdGQuY29udGVudCA+IHA6bnRoLWNoaWxkKDcpID4gYiIpWzBdLmlubmVySFRNTAogICAgbGV0IGRhdGUgPSBuZXcgRGF0ZSgpLnRvTG9jYWxlU3RyaW5nKCJlbi1VUyIsIHt0aW1lWm9uZTogIlBTVCJ9KQogICAgR01fc2V0VmFsdWUoIm1heGJldCIsIHttYXhiZXQ6bWF4YmV0LCBkYXRlOmRhdGV9KQogICAgY29uc29sZS5sb2coIltORkMrXSBNYXggYmV0IHZhbHVlIHJlY29yZGVkLiIpCn0KCi8vcHJvY2Vzc2luZyBiZXQgcGFnZSAtIGlmIHRoZSBwYWdlIGxvYWRzIGF0IHRoaXMgdXJsIGl0J3MgYW4gZXJyb3IKZWxzZSBpZih3aW5kb3cubG9jYXRpb24uaHJlZi5pbmNsdWRlcygibmVvcGV0cy5jb20vcGlyYXRlcy9wcm9jZXNzX2Zvb2RjbHViLnBodG1sIikpIHsKICAgIGlmKCQoIi5lcnJvck1lc3NhZ2UiKS5sZW5ndGggPiAwKSB7CiAgICAgICAgbGV0IHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmCiAgICAgICAgbGV0IHRhYmluZm8gPSBHTV9nZXRWYWx1ZSgidGFiaW5mbyIsIHt9KQoKICAgICAgICAvL2lmIHVybCBpcyBtYXJrZWQsIHJldHVybiBlcnJvciBhbmQgY2xvc2UgdGFiCiAgICAgICAgaWYodXJsIGluIHRhYmluZm8pIHsKICAgICAgICAgICAgbGV0IGVycm9yID0gR01fZ2V0VmFsdWUoImJldHN0YXR1cyIsIHt9KQogICAgICAgICAgICBsZXQgYmV0bnVtID0gdGFiaW5mb1t1cmxdCiAgICAgICAgICAgIGlmKCQoIi5lcnJvck1lc3NhZ2UiKVswXS5pbm5lckhUTUwuaW5jbHVkZXMoInlvdSBjYW5ub3QgcGxhY2UgdGhlIHNhbWUgYmV0IG1vcmUgdGhhbiBvbmNlISIpKSB7CiAgICAgICAgICAgICAgICBlcnJvclt0YWJpbmZvW3VybF1dID0gIkFscmVhZHkgcGxhY2VkISIKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIGVycm9yW3RhYmluZm9bdXJsXV0gPSAiSW52YWxpZCBiZXQhIgogICAgICAgICAgICB9CiAgICAgICAgICAgIEdNX3NldFZhbHVlKCJiZXRzdGF0dXMiLCBlcnJvcikKICAgICAgICAgICAgY29uc29sZS5sb2coIltORkMrXSBCZXQgZXJyb3Igc3RhdHVzIHJldHVybmVkLiIpCiAgICAgICAgICAgIGlmKEFVVE9DTE9TRVRBQlMpIHdpbmRvdy5jbG9zZSgpCiAgICAgICAgfQogICAgfQp9CgovL3Jlc3VsdCBwYWdlIC0gcmVjb3JkIGJldHMKZWxzZSBpZih3aW5kb3cubG9jYXRpb24uaHJlZi5pbmNsdWRlcygibmVvcGV0cy5jb20vcGlyYXRlcy9mb29kY2x1Yi5waHRtbD90eXBlPWN1cnJlbnRfYmV0cyIpKSB7CiAgICBwYXJzZUN1cnJlbnRCZXRzKCkKICAgIGxldCB0b1Byb2Nlc3MgPSBHTV9nZXRWYWx1ZSgidG9wcm9jZXNzIiwgMCkKICAgIGlmKEFVVE9DTE9TRVRBQlMgJiYgdG9Qcm9jZXNzID4gMCkgewogICAgICAgIEdNX3NldFZhbHVlKCJ0b3Byb2Nlc3MiLCB0b1Byb2Nlc3MtMSkKICAgICAgICB3aW5kb3cuY2xvc2UoKQogICAgfQogICAgLy9hcHBlbmRzIGN1cnJlbnQgYmV0IGNvdW50IHRvIGN1cnJlbnQgYmV0cyBwYWdlIGZvciBjb252ZW5pZW5jZQogICAgbGV0IGJldENvdW50ID0gQXJyYXkuZnJvbSgkKCIjY29udGVudCA+IHRhYmxlID4gdGJvZHkgPiB0ciA+IHRkLmNvbnRlbnQgPiBjZW50ZXI6bnRoLWNoaWxkKDYpID4gY2VudGVyOm50aC1jaGlsZCgyKSA+IHRhYmxlIHRyW2JnY29sb3I9J3doaXRlJ10iKSkuZmlsdGVyKHIgPT4gci5jaGlsZHJlbi5sZW5ndGggPT0gNSkubGVuZ3RoCiAgICAkKCIjY29udGVudCA+IHRhYmxlID4gdGJvZHkgPiB0ciA+IHRkLmNvbnRlbnQgPiBjZW50ZXI6bnRoLWNoaWxkKDYpID4gY2VudGVyOm50aC1jaGlsZCgyKSA+IHRhYmxlID4gdGJvZHkgPiB0cjpudGgtY2hpbGQoMSkgPiB0ZCA+IGZvbnQiKVswXS5pbm5lckhUTUwgKz0gYCA8Yj4oJHtiZXRDb3VudH0pPC9iPmAKfQoKLy89PT09PT09PT09PT09PT09PT0KLy8gcHJvZ3JhbSBsYXVuY2hpbmcKLy89PT09PT09PT09PT09PT09PT0KCi8vd2FpdHMgZm9yIHRoZSByaWdodCBjb25kaXRpb25zIHRvIGFwcGx5IHRoZSBjaGFuZ2VzIG9mIHRoZSBzY3JpcHQgLSBha2Egd2hlbiB0byBzdGFydApmdW5jdGlvbiB3YWl0Rm9yQmV0VGFibGUoKSB7CiAgICAvL3RoZSB0YWJsZSB3ZSB3YW50IGFscmVhZHkgZXhpc3RzLCB3YWl0IGZvciBpdCB0byBmaW5pc2ggcG9wdWxhdGluZwogICAgbGV0IHRhYmxlID0gZ2V0QmV0VGFibGUoKQogICAgaWYodGFibGUpIHsKICAgICAgICBjb25zdCBzZXR0YWJsZW9icyA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKG11dGF0aW9ucyA9PiB7CiAgICAgICAgICAgIGlmKHRhYmxlLnJvd3NbMV0uY2hpbGRyZW4ubGVuZ3RoID09IDE0KSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiW05GQytdIEFwcGx5aW5nIHVzZXJzY3JpcHQgdG8gYmV0IHRhYmxlLi4uIikKICAgICAgICAgICAgICAgIGhhbmRsZU5lb0Zvb2RNb2RzKCkKICAgICAgICAgICAgICAgIHdhdGNoRm9yQmV0VGFibGUoKQogICAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICBzZXR0YWJsZW9icy5vYnNlcnZlKHRhYmxlLCB7c3ViVHJlZTogdHJ1ZSwgY2hpbGRMaXN0OiB0cnVlfSk7CiAgICB9CiAgICAvL3RoZSB0YWJsZSB3ZSB3YW50IGRvZXNuJ3QgZXhpc3QsIHdhaXQgZm9yIGl0IHRvIGV4aXN0CiAgICBlbHNlIHsKICAgICAgICBpZihBRERfTkVPX0xJTktTKSBhZGROZW9MaW5rcygkKCIuY3NzLTEwNzN1dHQiKVswXSkKICAgICAgICB3YXRjaEZvckJldFRhYmxlKCkKICAgIH0KfQoKLy93YXRjaGVzIGZvciB0aGUgYWRkaXRpb24vcmVtb3ZhbCBvZiB0aGUgbWFpbiBiZXQgdGFibGUgb24gdGhlIHBhZ2UgLSBha2Egd2hlbiB0byByZS1hcHBseSB0aGUgc2NyaXB0CmZ1bmN0aW9uIHdhdGNoRm9yQmV0VGFibGUoKSB7CiAgICBsZXQgcGFnZSA9ICQoIiNyb290ID4gZGl2IilbMF0KICAgIGNvbnN0IHBhZ2VvYnMgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihtdXRhdGlvbnMgPT4gewogICAgICAgIC8vaWYgdGFibGUgaXMgYWRkZWQsIGFwcGx5CiAgICAgICAgZm9yKGNvbnN0IG11dGF0aW9uIG9mIG11dGF0aW9ucykgewogICAgICAgICAgICBpZihtdXRhdGlvbi5hZGRlZE5vZGVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIC8vaWYgdGhlIGJldCB0YWJsZSBpcyBhZGRlZCwgcmUtYXBwbHkKICAgICAgICAgICAgICAgIGlmKG11dGF0aW9uLmFkZGVkTm9kZXNbMF0gPT0gZ2V0QmV0VGFibGUoKT8ucGFyZW50RWxlbWVudCkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJbTkZDK10gQXBwbHlpbmcgdXNlcnNjcmlwdCB0byBiZXQgdGFibGUuLi4iKQogICAgICAgICAgICAgICAgICAgIGhhbmRsZU5lb0Zvb2RNb2RzKCkKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy9vdGhlcndpc2UsIGNoZWNrIGlmIHdlIG5lZWQgdG8gYWRkIHRoZSBiZXQgbGlua3MKICAgICAgICAgICAgICAgIGVsc2UgaWYoJCgiI3F1aWNrbGluay1jb250IikubGVuZ3RoID09IDAgJiYgQUREX05FT19MSU5LUykgeyAvL2lmIGJldCBsaW5rcyBkb24ndCBleGlzdAogICAgICAgICAgICAgICAgICAgIGFkZE5lb0xpbmtzKCQoIi5jc3MtMTA3M3V0dCIpWzBdKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSkKICAgIHBhZ2VvYnMub2JzZXJ2ZShwYWdlLCB7c3ViVHJlZTogdHJ1ZSwgY2hpbGRMaXN0OiB0cnVlfSk7Cn0KCi8vcnVucyB0aGUgbWFpbiBmdW5jdGlvbmFsaXR5IG9mIHRoZSBzY3JpcHQKZnVuY3Rpb24gaGFuZGxlTmVvRm9vZE1vZHMoKSB7CiAgICB1cGRhdGVSb3VuZCgpIC8vdXBkYXRlcyBzdG9yZWQgcm91bmQgIywgd2hpY2ggcmVzZXRzIHNvbWUgdGhpbmdzCiAgICB1cGRhdGVTZXRTdGF0dXMoKSAvL3VwZGF0ZXMgc2V0IHN0YXR1cyBpZiBzaGl0IGNoYW5nZXMKICAgIGhhbmRsZUJldEJ1dHRvbnMoKSAvL3VwZGF0ZXMgcGxhY2UgYmV0IGJ1dHRvbnMKICAgIHVwZGF0ZU1heEJldCgpIC8vdXBkYXRlcyB0aGUgbWF4IGJldCB2YWx1ZSBpbiB0aGUgaGVhZGVyCiAgICBhcHBseU1heEJldFZhbHVlKCkgLy9wcmVzc2VzIHRoZSBzZXQgYWxsIG1heCBiZXQgYnV0dG9uCiAgICBpZihBRERfTkVPX0xJTktTKSBhZGROZW9MaW5rcygkKCIjcm9vdCA+IGRpdiA+IGRpdi5jc3MtMW0zOWx1bywgI3Jvb3QgPiBkaXYgPiBkaXYuY3NzLTE4eGRmeWUiKVswXSkgLy9hZGRzIHF1aWNrIGxpbmtzCn0KCmZ1bmN0aW9uIHVwZGF0ZVJvdW5kKCkgewogICAgbGV0IHJlc2V0TXNnID0gbnVsbAoKICAgIC8vaWYgbmV3IHJvdW5kCiAgICBsZXQgcHJldlJvdW5kID0gR01fZ2V0VmFsdWUoInJvdW5kIiwgbnVsbCkKICAgIGxldCBjdXJyUm91bmQgPSAkKCIjcm9vdCA+IGhlYWRlciA+IGRpdiA+IGRpdi5jc3MtMWcybTdxYSA+IGRpdiA+IGRpdi5jaGFrcmEtc3RhY2suY3NzLTExcjgydGwgPiBkaXYuY2hha3JhLWlucHV0X19ncm91cC5jc3MtNDMwMnY4ID4gZGl2LmNoYWtyYS1udW1iZXJpbnB1dC5jc3MtNXZ6MWYwIilbMF0uZ2V0QXR0cmlidXRlKCJ2YWx1ZSIpCiAgICBpZihjdXJyUm91bmQgIT0gcHJldlJvdW5kKSB7CiAgICAgICAgR01fc2V0VmFsdWUoInJvdW5kIiwgY3VyclJvdW5kKSAvL2FuZCB1cGRhdGUgdGhlIGN1cnJlbnQgcm91bmQKICAgICAgICByZXNldE1zZyA9ICJOZXcgcm91bmQgZGV0ZWN0ZWQsIGNsZWFyZWQgc3RvcmVkIGJldCBpbmZvLiIKICAgIH0KCiAgICAvL2lmIG5ldyBiZXQgdXJsCiAgICBsZXQgcHJldlVSTCA9IEdNX2dldFZhbHVlKCJiZXR1cmwiLCBudWxsKQogICAgbGV0IGN1cnJVUkwgPSB3aW5kb3cubG9jYXRpb24uaHJlZi5tYXRjaCgvLiomYj0oXHcqKS4qPy8pWzFdCiAgICBpZihwcmV2VVJMICE9IGN1cnJVUkwpIHsKICAgICAgICBHTV9zZXRWYWx1ZSgiYmV0dXJsIiwgY3VyclVSTCkgLy9hbmQgdXBkYXRlIHRoZSBjdXJyZW50IHJvdW5kCiAgICAgICAgcmVzZXRNc2cgPSAiTmV3IGJldCBVUkwgZGV0ZWN0ZWQsIGNsZWFyZWQgc3RvcmVkIGJldCBpbmZvLiIKICAgIH0KCiAgICAvL2lmIGVpdGhlciBjaGFuZ2VkLCByZXNldCBzdHVmZgogICAgaWYocmVzZXRNc2cgIT0gbnVsbCkgewogICAgICAgIEdNX2RlbGV0ZVZhbHVlKCJ0YWJpbmZvIikKICAgICAgICBHTV9kZWxldGVWYWx1ZSgiYmV0c3RhdHVzIikKICAgICAgICBHTV9kZWxldGVWYWx1ZSgicGxhY2VkYmV0cyIpCiAgICAgICAgR01fZGVsZXRlVmFsdWUoInRvcHJvY2VzcyIpCiAgICAgICAgY29uc29sZS5sb2coIltORkMrXSAiKyByZXNldE1zZykKICAgIH0KfQoKLy9yZWFkcyB0aGUgY3VycmVudCBiZXRzIHBhZ2UgdG8gY2hlY2sgd2hldGhlciBhIGJldCB3YXMgcGxhY2VkIG9yIG5vdApmdW5jdGlvbiBwYXJzZUN1cnJlbnRCZXRzKCkgewogICAgbGV0IGN1cnJlbnRiZXRzID0gQXJyYXkuZnJvbSgkKCIjY29udGVudCA+IHRhYmxlID4gdGJvZHkgPiB0ciA+IHRkLmNvbnRlbnQgPiBjZW50ZXI6bnRoLWNoaWxkKDYpID4gY2VudGVyOm50aC1jaGlsZCgyKSA+IHRhYmxlIHRyW2JnY29sb3I9J3doaXRlJ10iKSkuZmlsdGVyKHIgPT4gci5jaGlsZHJlbi5sZW5ndGggPT0gNSkKICAgIGxldCBuZXdCZXRzID0gY3VycmVudGJldHMubGVuZ3RoIC0gR01fZ2V0VmFsdWUoInBsYWNlZGJldHMiLCBbXSkubGVuZ3RoCiAgICAvL29ubHkgdXBkYXRlcyBzdG9yZWQgYmV0IGxpc3QgaWYgdGhlcmUgYXJlIG5ldyBiZXRzIGRldGVjdGVkICh0byBkZWFsIHdpdGggb3V0LW9mLW9yZGVyIGxvYWRpbmcpCiAgICBpZihuZXdCZXRzID4gMCkgewogICAgICAgIGxldCBiZXRMaXN0ID0gW10KICAgICAgICBsZXQgY2xvc2VUYWIgPSBmYWxzZQogICAgICAgIC8vcGFyc2UgZWFjaCByb3cKICAgICAgICBmb3IoY29uc3Qgcm93IG9mIGN1cnJlbnRiZXRzKSB7CiAgICAgICAgICAgIC8vZGljdCBvZiA1IGFyZW5hcyBhbmQgdGhlaXIgYmV0dGVycwogICAgICAgICAgICBsZXQgYmV0cyA9IHJvdy5jaGlsZHJlblsxXS5pbm5lckhUTUwKICAgICAgICAgICAgICAgIC5yZXBsYWNlQWxsKCciJywgIiIpLnJlcGxhY2VBbGwoIjxiPiIsICIiKS5yZXBsYWNlQWxsKCI8L2I+IiwgIiIpLnNwbGl0KCI8YnI+Iikuc2xpY2UoMCwgLTEpCiAgICAgICAgICAgIC8vcGFyc2VzIGJldCBpbmZvCiAgICAgICAgICAgIGxldCBiZXRtYXAgPSB7MTpudWxsLDI6bnVsbCwzOm51bGwsNDpudWxsLDU6bnVsbH0KICAgICAgICAgICAgZm9yKGNvbnN0IGJldCBvZiBiZXRzKSB7CiAgICAgICAgICAgICAgICBsZXQgcyA9IGJldC5zcGxpdCgiOiIpCiAgICAgICAgICAgICAgICAvL2dldCBhcmVuYSBudW1iZXIKICAgICAgICAgICAgICAgIGxldCBhcmVuYSA9IEFSRU5BX0lEU1tzWzBdXQogICAgICAgICAgICAgICAgLy9nZXQgcGlyYXRlcyBwYXJ0aWFsIG5hbWUKICAgICAgICAgICAgICAgIGZvcihjb25zdCBwaXJhdGVuYW1lIG9mIE9iamVjdC52YWx1ZXMoUElSQVRFX05BTUVTKSkgewogICAgICAgICAgICAgICAgICAgIGlmKHNbMV0uaW5jbHVkZXMocGlyYXRlbmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBpcmF0ZSA9IHBpcmF0ZW5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvL2FkZCB0byBiZXRtYXAKICAgICAgICAgICAgICAgIGJldG1hcFthcmVuYV0gPSBwaXJhdGUKICAgICAgICAgICAgfQogICAgICAgICAgICBiZXRMaXN0LnB1c2goYmV0bWFwKQogICAgICAgIH0KICAgICAgICAvL3VwZGF0ZSBnbG9iYWwgdmFsdWUKICAgICAgICBHTV9zZXRWYWx1ZSgicGxhY2VkYmV0cyIsIGJldExpc3QpCiAgICAgICAgY29uc29sZS5sb2coIltORkMrXSBDdXJyZW50IGJldHMgbGlzdCB1cGRhdGVkLiIpCiAgICAgICAgLy91cGRhdGVzICMgb2YgdGFicyB0byBjbG9zZQogICAgICAgIEdNX3NldFZhbHVlKCJ0b3Byb2Nlc3MiLCBHTV9nZXRWYWx1ZSgidG9wcm9jZXNzIiwgMCkgKyBuZXdCZXRzKQogICAgfQp9CgoKLy89PT09PT09PT09PT09PQovLyBhcHBseSBtYXggYmV0Ci8vPT09PT09PT09PT09PT0KCi8vdXBkYXRlcyBtYXggYmV0IHZhbHVlIGluIGhlYWRlciBmaWVsZApmdW5jdGlvbiB1cGRhdGVNYXhCZXQoKSB7CiAgICBpZihBVVRPQ09MTEVDVE1BWEJFVCkgewogICAgICAgIGxldCBtYXhiZXRkYXRhID0gR01fZ2V0VmFsdWUoIm1heGJldCIsIG51bGwpCiAgICAgICAgaWYobWF4YmV0ZGF0YSAhPSBudWxsKSB7CiAgICAgICAgICAgIGxldCBjdXJyRGF0ZSA9IG5ldyBEYXRlKCkKICAgICAgICAgICAgbGV0IGNvbGxlY3Rpb25EYXRlID0gbmV3IERhdGUobWF4YmV0ZGF0YS5kYXRlKQogICAgICAgICAgICBsZXQgbWluZGlmZiA9IChjdXJyRGF0ZS5nZXRUaW1lKCkgLSBjb2xsZWN0aW9uRGF0ZS5nZXRUaW1lKCkpLzEwMDAvNjAKCiAgICAgICAgICAgIGlmKG1pbmRpZmYgPCBBVVRPQ09MTEVDVF9USU1FT1VUKSB7CiAgICAgICAgICAgICAgICBsZXQgaW5wdXQgPSAkKCIjcm9vdCA+IGhlYWRlciA+IGRpdiA+IGRpdi5jc3MtMWcybTdxYSA+IGRpdiA+IGRpdi5jaGFrcmEtc3RhY2suY3NzLTExcjgydGwgPiBkaXYuY2hha3JhLXNrZWxldG9uPiBkaXYgPiBkaXYuY2hha3JhLW51bWJlcmlucHV0LmNzcy01dnoxZjAgPiBpbnB1dCIpWzBdCiAgICAgICAgICAgICAgICBpZihpbnB1dC52YWx1ZSA8IG1heGJldGRhdGEubWF4YmV0KSB7CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuZm9jdXMoKQogICAgICAgICAgICAgICAgICAgIGlucHV0LnZhbHVlID0gbWF4YmV0ZGF0YS5tYXhiZXQKICAgICAgICAgICAgICAgICAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoImFyaWEtdmFsdWVub3ciLCBtYXhiZXRkYXRhLm1heGJldCkKICAgICAgICAgICAgICAgICAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoImFyaWEtdmFsdWV0ZXh0IiwgbWF4YmV0ZGF0YS5tYXhiZXQpCiAgICAgICAgICAgICAgICAgICAgaW5wdXQucGFyZW50RWxlbWVudC52YWx1ZSA9IG1heGJldGRhdGEubWF4YmV0CiAgICAgICAgICAgICAgICAgICAgaW5wdXQuYmx1cigpCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIltORkMrXSBTdG9yZWQgbWF4IGJldCB2YWx1ZSBhcHBsaWVkLiIpCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvL290aGVyd2lzZSBkb2VzIG5vdGhpbmcuCiAgICAgICAgICAgICAgICBlbHNlIGNvbnNvbGUubG9nKCJbTkZDK10gTWF4IGJldCB2YWx1ZSBsZXNzIHRoYW4gY3VycmVudCB2YWx1ZSwgbm8gdXBkYXRlLiIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy90aW1lZCBvdXQKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiW05GQytdIE1heCBiZXQgdmFsdWUgdGltZWQgb3V0LCBkYXRhIGludmFsaWRhdGVkLiIpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgR01fZGVsZXRlVmFsdWUoIm1heGJldCIpCiAgICAgICAgfQogICAgfQp9CgovL3ByZXNzZXMgdGhlICdzZXQgYmV0IGFtb3VudHMgdG8gbWF4JyBidXR0b24KZnVuY3Rpb24gYXBwbHlNYXhCZXRWYWx1ZSgpIHsKICAgIGlmKEFVVE9NQVhCRVQpIHsKICAgICAgICBsZXQgYnV0dG9uID0gQXJyYXkuZnJvbSgkKCIjcm9vdCA+IGRpdiA+IGRpdiA+IGRpdiBidXR0b24iKSkuZmlsdGVyKGIgPT4gYi50ZXh0Q29udGVudCA9PSAiU2V0IGJldCBhbW91bnRzIHRvIG1heCIpWzBdCiAgICAgICAgaWYoYnV0dG9uKSB7CiAgICAgICAgICAgIGJ1dHRvbi5jbGljaygpCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJbTkZDK10gQmV0cyBhdXRvbWF0aWNhbGx5IHNldCB0byBtYXggdmFsdWUuIikKICAgICAgICB9CiAgICB9Cn0KCi8vbm90ZTogZGVzaWduZWQgd2l0aCBkYXJrIG1vZGUgaW4gbWluZCwgdG9vIGxhenkgdG8gbWFrZSBhIGxpZ2h0IG1vZGUgb25lIHRvby4KZnVuY3Rpb24gYWRkTmVvTGlua3MoY29udCkgewogICAgbGV0IGxpbmtDb250ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKICAgIGxpbmtDb250LmNsYXNzTGlzdC5hZGQoImNzcy1jcGp6eTkiKQogICAgbGlua0NvbnQuc3R5bGUubWFyZ2luUmlnaHQgPSAiMjBweCIKICAgIGxpbmtDb250LnN0eWxlLmNvbG9yID0gIndoaXRlIgogICAgbGlua0NvbnQuaWQgPSAicXVpY2tsaW5rLWNvbnQiCiAgICBsZXQgbGlua0NvbnQyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKICAgIGxpbmtDb250Mi5jbGFzc0xpc3QuYWRkKCJjaGFrcmEtc3RhY2siLCAiY3NzLW4yMWdoNSIpCgogICAgbGV0IGJ1dHRvbjEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKQogICAgYnV0dG9uMS50eXBlID0gImJ1dHRvbiIKICAgIGJ1dHRvbjEuY2xhc3NMaXN0LmFkZCgiY2hha3JhLWJ1dHRvbiIsICJjc3MtMTc4aG9tdCIsICJjc3MtMWE1ZXBmZiIpCiAgICBsZXQgYnV0dG9uMiA9IGJ1dHRvbjEuY2xvbmVOb2RlKCkKICAgIGJ1dHRvbjEuaW5uZXJIVE1MID0gIkN1cnJlbnQgQmV0cyIKICAgIGJ1dHRvbjEuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7IHdpbmRvdy5vcGVuKCdodHRwczovL3d3dy5uZW9wZXRzLmNvbS9waXJhdGVzL2Zvb2RjbHViLnBodG1sP3R5cGU9Y3VycmVudF9iZXRzJykgfSkKICAgIGJ1dHRvbjIuaW5uZXJIVE1MID0gIkNvbGxlY3QgV2lubmluZ3MiCiAgICBidXR0b24yLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4geyB3aW5kb3cub3BlbignaHR0cHM6Ly93d3cubmVvcGV0cy5jb20vcGlyYXRlcy9mb29kY2x1Yi5waHRtbD90eXBlPWNvbGxlY3QnKSB9KQoKICAgIGxpbmtDb250Mi5hcHBlbmRDaGlsZChidXR0b24xKQogICAgbGlua0NvbnQyLmFwcGVuZENoaWxkKGJ1dHRvbjIpCiAgICBsaW5rQ29udC5hcHBlbmRDaGlsZChsaW5rQ29udDIpCiAgICBjb250LmFwcGVuZENoaWxkKGxpbmtDb250KQoKfQoKCi8vPT09PT09PT09PT0KLy8gYmV0IGJ1dHRvbgovLz09PT09PT09PT09CgpmdW5jdGlvbiBoYW5kbGVCZXRCdXR0b25zKCkgewogICAgLy91cGRhdGVzIGJ1dHRvbiBzdGF0dXMKICAgIHVwZGF0ZUJ1dHRvblN0YXR1cygpCgogICAgLy91cGRhdGVzIGV4aXN0aW5nIHRhYmxlCiAgICBmb3IobGV0IHJvdyBvZiBBcnJheS5mcm9tKGdldEJldFRhYmxlKCkuY2hpbGRyZW5bMV0uZ2V0RWxlbWVudHNCeVRhZ05hbWUoInRyIikpKSB7CiAgICAgICAgbGV0IGJ1dHRvbiA9IHJvdy5jaGlsZHJlblsxM10uY2hpbGRyZW5bMF0KICAgICAgICBhZGRCdXR0b25PYnNlcnZlcihidXR0b24ucGFyZW50RWxlbWVudCkKICAgICAgICBpZighYnV0dG9uLmRpc2FibGVkKSBhZGRCdXR0b25MaXN0ZW5lcihidXR0b24pCiAgICB9CgogICAgLy9vYnNlcnZlcyB1cGRhdGVzIGluIHRhYmxlIHRvIGFwcGx5IHVwZGF0ZXMKICAgIGFkZFJvd09ic2VydmVyKCkKICAgIC8vbGlzdGVucyBmb3Igb3V0Y29tZXMgYWZ0ZXIgcGxhY2luZyBiZXRzCiAgICBhZGRSZXN1bHRzTGlzdGVuZXJzKCkKfQoKLy9saXN0ZW5zIGZvciBhZGRlZC9yZW1vdmVkIHJvd3MKZnVuY3Rpb24gYWRkUm93T2JzZXJ2ZXIoKSB7CiAgICBsZXQgdGJvZHkgPSBnZXRCZXRUYWJsZSgpLmNoaWxkcmVuWzFdCiAgICBjb25zdCB0Ym9keW9icyA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKG11dGF0aW9ucyA9PiB7CiAgICAgICAgZm9yKGNvbnN0IG11dGF0aW9uIG9mIG11dGF0aW9ucykgewogICAgICAgICAgICBpZihtdXRhdGlvbi5hZGRlZE5vZGVzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIGxldCBidXR0b24gPSBtdXRhdGlvbi5hZGRlZE5vZGVzWzBdLmNoaWxkcmVuWzEzXS5jaGlsZHJlblswXQogICAgICAgICAgICAgICAgYWRkQnV0dG9uT2JzZXJ2ZXIoYnV0dG9uLnBhcmVudEVsZW1lbnQpCiAgICAgICAgICAgICAgICBpZighYnV0dG9uLmRpc2FibGVkKSBhZGRCdXR0b25MaXN0ZW5lcihidXR0b24pCiAgICAgICAgICAgICAgICBhcHBseU1heEJldFZhbHVlKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pCiAgICB0Ym9keW9icy5vYnNlcnZlKHRib2R5LCB7Y2hpbGRMaXN0OiB0cnVlfSkKfQoKZnVuY3Rpb24gYWRkUmVzdWx0c0xpc3RlbmVycygpIHsKICAgIC8vdXBkYXRlcyBzdWNjZXNzZnVsIGJldCBzdGF0dXNlcyBiYXNlZCBvbiBjdXJyZW50IGJldCBwYWdlCiAgICBHTV9hZGRWYWx1ZUNoYW5nZUxpc3RlbmVyKCJwbGFjZWRiZXRzIiwgZnVuY3Rpb24oa2V5LCBvbGRWYWx1ZSwgbmV3VmFsdWUsIHJlbW90ZSkgewogICAgICAgIHVwZGF0ZVNldFN0YXR1cygpCiAgICB9KQoKICAgIC8vdXBkYXRlcyBiZXQgYnV0dG9ucyBiYXNlZCBvbiBiZXQgc3RhdHVzIHVwZGF0ZXMKICAgIEdNX2FkZFZhbHVlQ2hhbmdlTGlzdGVuZXIoImJldHN0YXR1cyIsIGZ1bmN0aW9uKGtleSwgb2xkVmFsdWUsIG5ld1ZhbHVlLCByZW1vdGUpIHsKICAgICAgICB1cGRhdGVCdXR0b25TdGF0dXMoKQogICAgfSkKfQoKLy91cGRhdGVzIHNldCBzdGF0dXNlcyB0byBtYXRjaCB0aGUgY3VycmVudCBiZXRzIHNjcmVlbgpmdW5jdGlvbiB1cGRhdGVTZXRTdGF0dXMoKSB7CiAgICBsZXQgcGxhY2VkQmV0cyA9IEdNX2dldFZhbHVlKCJwbGFjZWRiZXRzIiwgW10pCiAgICBsZXQgYmV0U3RhdHVzID0gR01fZ2V0VmFsdWUoImJldHN0YXR1cyIsIHt9KQogICAgZm9yKGNvbnN0IGJldCBvZiBwbGFjZWRCZXRzKSB7CiAgICAgICAgbGV0IHJvdyA9IGdldFJvd0Zyb21DdXJyZW50QmV0KGJldCkgLy9maW5kcyB0aGUgcm93IG9mIHRoZSBiZXQKICAgICAgICBsZXQgYmV0TnVtID0gcm93LmNoaWxkcmVuWzBdLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJwIilbMF0uaW5uZXJIVE1MIC8vZmluZHMgdGhlIG51bWJlciBmcm9tIHRoZSByb3cKCiAgICAgICAgYmV0U3RhdHVzW2JldE51bV0gPSAiQmV0IHBsYWNlZCEiCiAgICB9CiAgICBHTV9zZXRWYWx1ZSgiYmV0c3RhdHVzIiwgYmV0U3RhdHVzKQp9CgovL3VwZGF0ZXMgdGhlIGJ1dHRvbnMgdG8gbWF0Y2ggdGhlaXIgYmV0IHN0YXR1cwpmdW5jdGlvbiB1cGRhdGVCdXR0b25TdGF0dXMoKSB7CiAgICBsZXQgYmV0U3RhdHVzID0gR01fZ2V0VmFsdWUoImJldHN0YXR1cyIsIHt9KQogICAgZm9yKGNvbnN0IGJldE51bSBpbiBiZXRTdGF0dXMpIHsKICAgICAgICBsZXQgYnV0dG9uID0gZ2V0QmV0Um93KGJldE51bSkuY2hpbGRyZW5bMTNdLmNoaWxkcmVuWzBdCiAgICAgICAgbGV0IHN0YXR1c01zZyA9IGJldFN0YXR1c1tiZXROdW1dCiAgICAgICAgYnV0dG9uLmZpcnN0Q2hpbGQuZGF0YSA9IHN0YXR1c01zZwogICAgICAgIGJ1dHRvbi5kaXNhYmxlZCA9IHRydWUKICAgICAgICBpZihzdGF0dXNNc2cgPT0gIkFscmVhZHkgcGxhY2VkISIgfHwgc3RhdHVzTXNnID09ICJJbnZhbGlkIGJldCEiKSB7CiAgICAgICAgICAgIGJ1dHRvbi5jbGFzc0xpc3QuYWRkKCJjc3MtZWp4ZXkiKQogICAgICAgICAgICBidXR0b24uY2xhc3NMaXN0LnJlbW92ZSgiY3NzLTF0M2FmMnIiKQogICAgICAgICAgICBidXR0b24uY2xhc3NMaXN0LnJlbW92ZSgiY3NzLTFhNHZ4dGgiKQogICAgICAgIH0KICAgICAgICBpZihzdGF0dXNNc2cgPT0gIkJldCBwbGFjZWQhIikgewogICAgICAgICAgICBidXR0b24uY2xhc3NMaXN0LmFkZCgiY3NzLTFhNHZ4dGgiKQogICAgICAgIH0KICAgIH0KfQoKZnVuY3Rpb24gYWRkQnV0dG9uT2JzZXJ2ZXIoYnV0dG9uQ2VsbCkgewogICAgY29uc3Qgcm93b2JzID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIobXV0YXRpb25zID0+IHsKICAgICAgICBmb3IoY29uc3QgbXV0YXRpb24gb2YgbXV0YXRpb25zKSB7CiAgICAgICAgICAgIC8vYnV0dG9uIHVwZGF0ZXMgYnkgcmVtb3ZpbmcgYW5kIGNyZWF0aW5nIGEgbmV3IG9uZS4gYXBwbHkgdXBkYXRlcyB0byB0aGUgbmV3IGJ1dHRvbi4KICAgICAgICAgICAgaWYobXV0YXRpb24uYWRkZWROb2Rlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBsZXQgbmV3QnV0dG9uID0gbXV0YXRpb24uYWRkZWROb2Rlc1swXQogICAgICAgICAgICAgICAgaWYoIW5ld0J1dHRvbi5kaXNhYmxlZCkgewogICAgICAgICAgICAgICAgICAgIGFkZEJ1dHRvbkxpc3RlbmVyKG5ld0J1dHRvbikKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pCiAgICByb3dvYnMub2JzZXJ2ZShidXR0b25DZWxsLCB7Y2hpbGRMaXN0OiB0cnVlLCBzdWJ0cmVlOiB0cnVlfSkKfQoKZnVuY3Rpb24gYWRkQnV0dG9uTGlzdGVuZXIoYnV0dG9uKSB7CiAgICBsZXQgYmV0TnVtID0gYnV0dG9uLnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgicCIpWzBdLmlubmVySFRNTAogICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24oZXZlbnQpe29uQnV0dG9uQ2xpY2soZXZlbnQsIGJldE51bSwgYnV0dG9uKX0pCn0KCmZ1bmN0aW9uIG9uQnV0dG9uQ2xpY2soZXZlbnQsIGJldE51bSwgYnV0dG9uKSB7CiAgICAvL292ZXJyaWRlcyBiZWhhdmlvcgogICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCkKICAgIC8vdXBkYXRlcyBidXR0b24KICAgIGJ1dHRvbi5maXJzdENoaWxkLmRhdGEgPSAiUHJvY2Vzc2luZy4uLiIKICAgIGJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKCJjc3MtMWE0dnh0aCIpCiAgICBidXR0b24uY2xhc3NMaXN0LmFkZCgiY3NzLTF0M2FmMnIiKQogICAgYnV0dG9uLmRpc2FibGVkID0gdHJ1ZQogICAgLy9nZW5lcmF0ZXMgbGluayBhZ2Fpbi4uLiBtYW51YWxseS4uLiBhbmQgb3BlbnMgaXQgaW4gYmFja2dyb3VuZAogICAgbGV0IGxpbmsgPSBnZW5lcmF0ZV9iZXRfbGluayhiZXROdW0pCiAgICBvcGVuQmFja2dyb3VuZFRhYihsaW5rLCBiZXROdW0pCn0KCmZ1bmN0aW9uIGdlbmVyYXRlX2JldF9saW5rKGJldE51bSkgewogICAgbGV0IHVybFN0cmluZyA9CiAgICAgICAgImh0dHBzOi8vd3d3Lm5lb3BldHMuY29tL3BpcmF0ZXMvcHJvY2Vzc19mb29kY2x1Yi5waHRtbD8iOwogICAgbGV0IGJldERhdGEgPSBnZXRCZXREYXRhKGJldE51bSkKICAgIGxldCBiZXQgPSBiZXREYXRhLndpbm5lcnMKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNTsgaSsrKSB7CiAgICAgICAgaWYgKGJldFtpXSAhPSBudWxsKSB7CiAgICAgICAgICAgIHVybFN0cmluZyArPSBgd2lubmVyJHtpICsgMX09JHtiZXRbaV19JmA7CiAgICAgICAgfQogICAgfQogICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHsKICAgICAgICBpZiAoYmV0W2ldICE9IG51bGwpIHsKICAgICAgICAgICAgdXJsU3RyaW5nICs9IGBtYXRjaGVzW109JHtpICsgMX0mYDsKICAgICAgICB9CiAgICB9CiAgICB1cmxTdHJpbmcgKz0gYGJldF9hbW91bnQ9JHtiZXREYXRhLmJldF9hbW91bnR9JmA7CiAgICB1cmxTdHJpbmcgKz0gYHRvdGFsX29kZHM9JHtiZXREYXRhLnRvdGFsX29kZHN9JmA7CiAgICB1cmxTdHJpbmcgKz0gYHdpbm5pbmdzPSR7YmV0RGF0YS53aW5uaW5nc30mYDsKICAgIHVybFN0cmluZyArPSAidHlwZT1iZXQiOwogICAgcmV0dXJuIHVybFN0cmluZzsKfQoKZnVuY3Rpb24gb3BlbkJhY2tncm91bmRUYWIodXJsLCBiZXROdW0pIHsKICAgIC8vb3BlbnMgdGFiCiAgICBpZihGT1JDRUJHVEFCKSB7CiAgICAgICAgd2luZG93Lm9wZW4odXJsLCAiX2JsYW5rIikKICAgICAgICB3aW5kb3cuZm9jdXMoKQogICAgICAgIGNvbnNvbGUubG9nKCJbTkZDK10gRm9yY2VkIG5ldyB0YWIgdG8gYmFjay4iKQogICAgfQogICAgZWxzZSB3aW5kb3cub3Blbih1cmwpCgogICAgLy9yZWNvcmRzIGluZm8gYWJ0IHRoZSB0YWIgc28gdGhlIHByb2dyYW0ga25vd3MgaXQgd2FzIHByZXNzZWQgZnJvbSBoZXJlCiAgICBsZXQgdGFiaW5mbyA9IEdNX2dldFZhbHVlKCJ0YWJpbmZvIiwge30pCiAgICB0YWJpbmZvW3VybF0gPSBiZXROdW0KICAgIEdNX3NldFZhbHVlKCJ0YWJpbmZvIiwgdGFiaW5mbykKfQoKCi8vPT09PT09PT09PT09PT09PT0KLy8gaGVscGVyIGZ1bmN0aW9ucwovLz09PT09PT09PT09PT09PT09CgpmdW5jdGlvbiBnZXRCZXRUYWJsZSgpIHsKICAgIGxldCB0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLmNzcy0xbDR0Ym5zIHRhYmxlLmNoYWtyYS10YWJsZS5jc3MtdDFndmVoIikKICAgIGlmKHQubGVuZ3RoID4gMCkgewogICAgICAgIGxldCBsYXN0ID0gQXJyYXkuZnJvbSh0KS5zbGljZSgtMSlbMF0KICAgICAgICBpZihsYXN0LnF1ZXJ5U2VsZWN0b3IoInRoIikuaW5uZXJIVE1MID09ICJCZXQgIyIpIHJldHVybiBsYXN0CiAgICB9Cn0KCmZ1bmN0aW9uIGdldEJldERhdGEoYmV0TnVtKSB7CiAgICBsZXQgYmV0Um93ID0gZ2V0QmV0Um93KGJldE51bSkKCiAgICBsZXQgYmV0X2Ftb3VudCA9IGJldFJvdy5jaGlsZHJlblsxXS5jaGlsZHJlblswXS5nZXRBdHRyaWJ1dGUoInZhbHVlIikKICAgIGxldCB0b3RhbF9vZGRzID0gYmV0Um93LmNoaWxkcmVuWzJdLmlubmVySFRNTC5zcGxpdCgiOiIpWzBdCiAgICBsZXQgd2lubmluZ3MgPSBiZXRSb3cuY2hpbGRyZW5bM10uaW5uZXJIVE1MLnJlcGxhY2UoIiwiLCAiIikKICAgIGxldCB3aW5uZXJzID0gW10KICAgIGZvcihsZXQgaT04OyBpPDEzOyBpKyspIHsKICAgICAgICBsZXQgcGlyYXRlID0gYmV0Um93LmNoaWxkcmVuW2ldLmlubmVySFRNTCB8fCBudWxsCiAgICAgICAgaWYocGlyYXRlICE9IG51bGwpIHBpcmF0ZSA9IFBJUkFURV9JRFNbcGlyYXRlXQogICAgICAgIHdpbm5lcnMucHVzaChwaXJhdGUpCiAgICB9CgogICAgcmV0dXJuIHtiZXRfYW1vdW50OmJldF9hbW91bnQsIHRvdGFsX29kZHM6dG90YWxfb2Rkcywgd2lubmluZ3M6d2lubmluZ3MsIHdpbm5lcnM6d2lubmVyc30KfQoKCmZ1bmN0aW9uIGdldEJldFJvdyhiZXROdW0pIHsKICAgIGxldCB0YWJsZSA9IGdldEJldFRhYmxlKCkKICAgIGxldCB0Ym9keSA9IHRhYmxlLmNoaWxkcmVuWzFdCiAgICBsZXQgcm93cyA9IEFycmF5LmZyb20odGJvZHkuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInRyIikpCiAgICBsZXQgYmV0Um93ID0gcm93cy5maWx0ZXIocm93PT57CiAgICAgICAgbGV0IG51bSA9IHJvdy5jaGlsZHJlblswXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgicCIpWzBdLmlubmVySFRNTAogICAgICAgIHJldHVybiBudW0gPT0gYmV0TnVtCiAgICB9KVswXQogICAgcmV0dXJuIGJldFJvdwp9CgpmdW5jdGlvbiBnZXRSb3dGcm9tQ3VycmVudEJldChiZXQpIHsKICAgIGxldCByb3dzID0gQXJyYXkuZnJvbShnZXRCZXRUYWJsZSgpLmNoaWxkcmVuWzFdLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ0ciIpKQogICAgbGV0IGkgPSAwCiAgICBmb3IoY29uc3Qgcm93IG9mIHJvd3MpIHsKICAgICAgICBsZXQgbWF0Y2ggPSB0cnVlCiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IDU7IGkrKykgewogICAgICAgICAgICBpZigocm93LmNoaWxkcmVuWzgraV0uaW5uZXJIVE1MIHx8IG51bGwpICE9IGJldFtpKzFdKSB7CiAgICAgICAgICAgICAgICBtYXRjaCA9IGZhbHNlCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmKG1hdGNoKSByZXR1cm4gcm93CiAgICB9CiAgICByZXR1cm4gbnVsbAp9CgovLz09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gY3NzIGJlY2F1c2UgcmVhY3QgaXMgc3R1cGlkCi8vPT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKZnVuY3Rpb24gYWRkQ1NTKCkgewogICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzdHlsZSIpKS5pbm5lckhUTUwgPSBgCiAgICAvKiBncmVlbiBidXR0b24gKi8KICAgIC5jc3MtMWE0dnh0aFtkaXNhYmxlZF0sIC5jc3MtMWE0dnh0aFthcmlhLWRpc2FibGVkPSJ0cnVlIl0sIC5jc3MtMWE0dnh0aFtkYXRhLWRpc2FibGVkXSB7CiAgICAgICAgb3BhY2l0eTogMC40OwogICAgICAgIGJveC1zaGFkb3c6IHZhcigtLWNoYWtyYS1zaGFkb3dzLW5vbmUpOwogICAgICAgIGN1cnNvcjogYXV0bzsKICAgIH0KCiAgICAvKmdyZXkgYnV0dG9uKi8KICAgIC5jc3MtMXQzYWYyciB7CiAgICAgICAgZGlzcGxheTogaW5saW5lLWZsZXg7CiAgICAgICAgYXBwZWFyYW5jZTogbm9uZTsKICAgICAgICAtd2Via2l0LWJveC1hbGlnbjogY2VudGVyOwogICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgLXdlYmtpdC1ib3gtcGFjazogY2VudGVyOwogICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICAgIHVzZXItc2VsZWN0OiBub25lOwogICAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgICAgICB3aGl0ZS1zcGFjZTogbm93cmFwOwogICAgICAgIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7CiAgICAgICAgb3V0bGluZTogdHJhbnNwYXJlbnQgc29saWQgMnB4OwogICAgICAgIG91dGxpbmUtb2Zmc2V0OiAycHg7CiAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgbGluZS1oZWlnaHQ6IDEuMjsKICAgICAgICBib3JkZXItcmFkaXVzOiB2YXIoLS1jaGFrcmEtcmFkaWktbWQpOwogICAgICAgIGZvbnQtd2VpZ2h0OiB2YXIoLS1jaGFrcmEtZm9udFdlaWdodHMtc2VtaWJvbGQpOwogICAgICAgIHRyYW5zaXRpb24tcHJvcGVydHk6IHZhcigtLWNoYWtyYS10cmFuc2l0aW9uLXByb3BlcnR5LWNvbW1vbik7CiAgICAgICAgdHJhbnNpdGlvbi1kdXJhdGlvbjogdmFyKC0tY2hha3JhLXRyYW5zaXRpb24tZHVyYXRpb24tbm9ybWFsKTsKICAgICAgICBoZWlnaHQ6IHZhcigtLWNoYWtyYS1zaXplcy04KTsKICAgICAgICBtaW4td2lkdGg6IHZhcigtLWNoYWtyYS1zaXplcy04KTsKICAgICAgICBmb250LXNpemU6IHZhcigtLWNoYWtyYS1mb250U2l6ZXMtc20pOwogICAgICAgIHBhZGRpbmctaW5saW5lLXN0YXJ0OiB2YXIoLS1jaGFrcmEtc3BhY2UtMyk7CiAgICAgICAgcGFkZGluZy1pbmxpbmUtZW5kOiB2YXIoLS1jaGFrcmEtc3BhY2UtMyk7CiAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tY2hha3JhLWNvbG9ycy13aGl0ZUFscGhhLTIwMCk7CiAgICB9CiAgICAuY3NzLTF0M2FmMnI6ZGlzYWJsZWQsIC5jc3MtMXQzYWYycltkYXRhLWhvdmVyXSB7CiAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tY2hha3JhLWNvbG9ycy13aGl0ZUFscGhhLTMwMCk7CiAgICAgICAgY3Vyc29yOiBub3QtYWxsb3dlZDsKICAgIH0KICAgIC8qIHJlZCBidXR0b24qLwogICAgLmNzcy1lanhleVtkaXNhYmxlZF0sIC5jc3MtZWp4ZXlbYXJpYS1kaXNhYmxlZD0idHJ1ZSJdLCAuY3NzLWVqeGV5W2RhdGEtZGlzYWJsZWRdIHsKICAgIG9wYWNpdHk6IDAuNDsKICAgIGN1cnNvcjogbm90LWFsbG93ZWQ7CiAgICBib3gtc2hhZG93OiB2YXIoLS1jaGFrcmEtc2hhZG93cy1ub25lKTsKICAgIH0KICAgIC5jc3MtZWp4ZXkgewogICAgICAgIGRpc3BsYXk6IGlubGluZS1mbGV4OwogICAgICAgIGFwcGVhcmFuY2U6IG5vbmU7CiAgICAgICAgLXdlYmtpdC1ib3gtYWxpZ246IGNlbnRlcjsKICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgIC13ZWJraXQtYm94LXBhY2s6IGNlbnRlcjsKICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgICAgICB1c2VyLXNlbGVjdDogbm9uZTsKICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICAgICAgd2hpdGUtc3BhY2U6IG5vd3JhcDsKICAgICAgICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOwogICAgICAgIG91dGxpbmU6IHRyYW5zcGFyZW50IHNvbGlkIDJweDsKICAgICAgICBvdXRsaW5lLW9mZnNldDogMnB4OwogICAgICAgIHdpZHRoOiAxMDAlOwogICAgICAgIGxpbmUtaGVpZ2h0OiAxLjI7CiAgICAgICAgYm9yZGVyLXJhZGl1czogdmFyKC0tY2hha3JhLXJhZGlpLW1kKTsKICAgICAgICBmb250LXdlaWdodDogdmFyKC0tY2hha3JhLWZvbnRXZWlnaHRzLXNlbWlib2xkKTsKICAgICAgICB0cmFuc2l0aW9uLXByb3BlcnR5OiB2YXIoLS1jaGFrcmEtdHJhbnNpdGlvbi1wcm9wZXJ0eS1jb21tb24pOwogICAgICAgIHRyYW5zaXRpb24tZHVyYXRpb246IHZhcigtLWNoYWtyYS10cmFuc2l0aW9uLWR1cmF0aW9uLW5vcm1hbCk7CiAgICAgICAgaGVpZ2h0OiB2YXIoLS1jaGFrcmEtc2l6ZXMtOCk7CiAgICAgICAgbWluLXdpZHRoOiB2YXIoLS1jaGFrcmEtc2l6ZXMtOCk7CiAgICAgICAgZm9udC1zaXplOiB2YXIoLS1jaGFrcmEtZm9udFNpemVzLXNtKTsKICAgICAgICBwYWRkaW5nLWlubGluZS1zdGFydDogdmFyKC0tY2hha3JhLXNwYWNlLTMpOwogICAgICAgIHBhZGRpbmctaW5saW5lLWVuZDogdmFyKC0tY2hha3JhLXNwYWNlLTMpOwogICAgICAgIGJhY2tncm91bmQ6IHZhcigtLWNoYWtyYS1jb2xvcnMtcmVkLTIwMCk7CiAgICAgICAgY29sb3I6IHZhcigtLWNoYWtyYS1jb2xvcnMtZ3JheS04MDApOwogICAgfQogICAgYAp9","requires":[{"meta":{"name":"jquery.min.js","url":"https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js","ts":1698065191788,"mimetype":"text/javascript"},"source":"LyohIGpRdWVyeSB2Mi4xLjMgfCAoYykgMjAwNSwgMjAxNCBqUXVlcnkgRm91bmRhdGlvbiwgSW5jLiB8IGpxdWVyeS5vcmcvbGljZW5zZSAqLwohZnVuY3Rpb24oYSxiKXsib2JqZWN0Ij09dHlwZW9mIG1vZHVsZSYmIm9iamVjdCI9PXR5cGVvZiBtb2R1bGUuZXhwb3J0cz9tb2R1bGUuZXhwb3J0cz1hLmRvY3VtZW50P2IoYSwhMCk6ZnVuY3Rpb24oYSl7aWYoIWEuZG9jdW1lbnQpdGhyb3cgbmV3IEVycm9yKCJqUXVlcnkgcmVxdWlyZXMgYSB3aW5kb3cgd2l0aCBhIGRvY3VtZW50Iik7cmV0dXJuIGIoYSl9OmIoYSl9KCJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93P3dpbmRvdzp0aGlzLGZ1bmN0aW9uKGEsYil7dmFyIGM9W10sZD1jLnNsaWNlLGU9Yy5jb25jYXQsZj1jLnB1c2gsZz1jLmluZGV4T2YsaD17fSxpPWgudG9TdHJpbmcsaj1oLmhhc093blByb3BlcnR5LGs9e30sbD1hLmRvY3VtZW50LG09IjIuMS4zIixuPWZ1bmN0aW9uKGEsYil7cmV0dXJuIG5ldyBuLmZuLmluaXQoYSxiKX0sbz0vXltcc1x1RkVGRlx4QTBdK3xbXHNcdUZFRkZceEEwXSskL2cscD0vXi1tcy0vLHE9Ly0oW1xkYS16XSkvZ2kscj1mdW5jdGlvbihhLGIpe3JldHVybiBiLnRvVXBwZXJDYXNlKCl9O24uZm49bi5wcm90b3R5cGU9e2pxdWVyeTptLGNvbnN0cnVjdG9yOm4sc2VsZWN0b3I6IiIsbGVuZ3RoOjAsdG9BcnJheTpmdW5jdGlvbigpe3JldHVybiBkLmNhbGwodGhpcyl9LGdldDpmdW5jdGlvbihhKXtyZXR1cm4gbnVsbCE9YT8wPmE/dGhpc1thK3RoaXMubGVuZ3RoXTp0aGlzW2FdOmQuY2FsbCh0aGlzKX0scHVzaFN0YWNrOmZ1bmN0aW9uKGEpe3ZhciBiPW4ubWVyZ2UodGhpcy5jb25zdHJ1Y3RvcigpLGEpO3JldHVybiBiLnByZXZPYmplY3Q9dGhpcyxiLmNvbnRleHQ9dGhpcy5jb250ZXh0LGJ9LGVhY2g6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gbi5lYWNoKHRoaXMsYSxiKX0sbWFwOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnB1c2hTdGFjayhuLm1hcCh0aGlzLGZ1bmN0aW9uKGIsYyl7cmV0dXJuIGEuY2FsbChiLGMsYil9KSl9LHNsaWNlOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucHVzaFN0YWNrKGQuYXBwbHkodGhpcyxhcmd1bWVudHMpKX0sZmlyc3Q6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lcSgwKX0sbGFzdDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmVxKC0xKX0sZXE6ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5sZW5ndGgsYz0rYSsoMD5hP2I6MCk7cmV0dXJuIHRoaXMucHVzaFN0YWNrKGM+PTAmJmI+Yz9bdGhpc1tjXV06W10pfSxlbmQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5wcmV2T2JqZWN0fHx0aGlzLmNvbnN0cnVjdG9yKG51bGwpfSxwdXNoOmYsc29ydDpjLnNvcnQsc3BsaWNlOmMuc3BsaWNlfSxuLmV4dGVuZD1uLmZuLmV4dGVuZD1mdW5jdGlvbigpe3ZhciBhLGIsYyxkLGUsZixnPWFyZ3VtZW50c1swXXx8e30saD0xLGk9YXJndW1lbnRzLmxlbmd0aCxqPSExO2ZvcigiYm9vbGVhbiI9PXR5cGVvZiBnJiYoaj1nLGc9YXJndW1lbnRzW2hdfHx7fSxoKyspLCJvYmplY3QiPT10eXBlb2YgZ3x8bi5pc0Z1bmN0aW9uKGcpfHwoZz17fSksaD09PWkmJihnPXRoaXMsaC0tKTtpPmg7aCsrKWlmKG51bGwhPShhPWFyZ3VtZW50c1toXSkpZm9yKGIgaW4gYSljPWdbYl0sZD1hW2JdLGchPT1kJiYoaiYmZCYmKG4uaXNQbGFpbk9iamVjdChkKXx8KGU9bi5pc0FycmF5KGQpKSk/KGU/KGU9ITEsZj1jJiZuLmlzQXJyYXkoYyk/YzpbXSk6Zj1jJiZuLmlzUGxhaW5PYmplY3QoYyk/Yzp7fSxnW2JdPW4uZXh0ZW5kKGosZixkKSk6dm9pZCAwIT09ZCYmKGdbYl09ZCkpO3JldHVybiBnfSxuLmV4dGVuZCh7ZXhwYW5kbzoialF1ZXJ5IisobStNYXRoLnJhbmRvbSgpKS5yZXBsYWNlKC9cRC9nLCIiKSxpc1JlYWR5OiEwLGVycm9yOmZ1bmN0aW9uKGEpe3Rocm93IG5ldyBFcnJvcihhKX0sbm9vcDpmdW5jdGlvbigpe30saXNGdW5jdGlvbjpmdW5jdGlvbihhKXtyZXR1cm4iZnVuY3Rpb24iPT09bi50eXBlKGEpfSxpc0FycmF5OkFycmF5LmlzQXJyYXksaXNXaW5kb3c6ZnVuY3Rpb24oYSl7cmV0dXJuIG51bGwhPWEmJmE9PT1hLndpbmRvd30saXNOdW1lcmljOmZ1bmN0aW9uKGEpe3JldHVybiFuLmlzQXJyYXkoYSkmJmEtcGFyc2VGbG9hdChhKSsxPj0wfSxpc1BsYWluT2JqZWN0OmZ1bmN0aW9uKGEpe3JldHVybiJvYmplY3QiIT09bi50eXBlKGEpfHxhLm5vZGVUeXBlfHxuLmlzV2luZG93KGEpPyExOmEuY29uc3RydWN0b3ImJiFqLmNhbGwoYS5jb25zdHJ1Y3Rvci5wcm90b3R5cGUsImlzUHJvdG90eXBlT2YiKT8hMTohMH0saXNFbXB0eU9iamVjdDpmdW5jdGlvbihhKXt2YXIgYjtmb3IoYiBpbiBhKXJldHVybiExO3JldHVybiEwfSx0eXBlOmZ1bmN0aW9uKGEpe3JldHVybiBudWxsPT1hP2ErIiI6Im9iamVjdCI9PXR5cGVvZiBhfHwiZnVuY3Rpb24iPT10eXBlb2YgYT9oW2kuY2FsbChhKV18fCJvYmplY3QiOnR5cGVvZiBhfSxnbG9iYWxFdmFsOmZ1bmN0aW9uKGEpe3ZhciBiLGM9ZXZhbDthPW4udHJpbShhKSxhJiYoMT09PWEuaW5kZXhPZigidXNlIHN0cmljdCIpPyhiPWwuY3JlYXRlRWxlbWVudCgic2NyaXB0IiksYi50ZXh0PWEsbC5oZWFkLmFwcGVuZENoaWxkKGIpLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYikpOmMoYSkpfSxjYW1lbENhc2U6ZnVuY3Rpb24oYSl7cmV0dXJuIGEucmVwbGFjZShwLCJtcy0iKS5yZXBsYWNlKHEscil9LG5vZGVOYW1lOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGEubm9kZU5hbWUmJmEubm9kZU5hbWUudG9Mb3dlckNhc2UoKT09PWIudG9Mb3dlckNhc2UoKX0sZWFjaDpmdW5jdGlvbihhLGIsYyl7dmFyIGQsZT0wLGY9YS5sZW5ndGgsZz1zKGEpO2lmKGMpe2lmKGcpe2Zvcig7Zj5lO2UrKylpZihkPWIuYXBwbHkoYVtlXSxjKSxkPT09ITEpYnJlYWt9ZWxzZSBmb3IoZSBpbiBhKWlmKGQ9Yi5hcHBseShhW2VdLGMpLGQ9PT0hMSlicmVha31lbHNlIGlmKGcpe2Zvcig7Zj5lO2UrKylpZihkPWIuY2FsbChhW2VdLGUsYVtlXSksZD09PSExKWJyZWFrfWVsc2UgZm9yKGUgaW4gYSlpZihkPWIuY2FsbChhW2VdLGUsYVtlXSksZD09PSExKWJyZWFrO3JldHVybiBhfSx0cmltOmZ1bmN0aW9uKGEpe3JldHVybiBudWxsPT1hPyIiOihhKyIiKS5yZXBsYWNlKG8sIiIpfSxtYWtlQXJyYXk6ZnVuY3Rpb24oYSxiKXt2YXIgYz1ifHxbXTtyZXR1cm4gbnVsbCE9YSYmKHMoT2JqZWN0KGEpKT9uLm1lcmdlKGMsInN0cmluZyI9PXR5cGVvZiBhP1thXTphKTpmLmNhbGwoYyxhKSksY30saW5BcnJheTpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIG51bGw9PWI/LTE6Zy5jYWxsKGIsYSxjKX0sbWVyZ2U6ZnVuY3Rpb24oYSxiKXtmb3IodmFyIGM9K2IubGVuZ3RoLGQ9MCxlPWEubGVuZ3RoO2M+ZDtkKyspYVtlKytdPWJbZF07cmV0dXJuIGEubGVuZ3RoPWUsYX0sZ3JlcDpmdW5jdGlvbihhLGIsYyl7Zm9yKHZhciBkLGU9W10sZj0wLGc9YS5sZW5ndGgsaD0hYztnPmY7ZisrKWQ9IWIoYVtmXSxmKSxkIT09aCYmZS5wdXNoKGFbZl0pO3JldHVybiBlfSxtYXA6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkLGY9MCxnPWEubGVuZ3RoLGg9cyhhKSxpPVtdO2lmKGgpZm9yKDtnPmY7ZisrKWQ9YihhW2ZdLGYsYyksbnVsbCE9ZCYmaS5wdXNoKGQpO2Vsc2UgZm9yKGYgaW4gYSlkPWIoYVtmXSxmLGMpLG51bGwhPWQmJmkucHVzaChkKTtyZXR1cm4gZS5hcHBseShbXSxpKX0sZ3VpZDoxLHByb3h5OmZ1bmN0aW9uKGEsYil7dmFyIGMsZSxmO3JldHVybiJzdHJpbmciPT10eXBlb2YgYiYmKGM9YVtiXSxiPWEsYT1jKSxuLmlzRnVuY3Rpb24oYSk/KGU9ZC5jYWxsKGFyZ3VtZW50cywyKSxmPWZ1bmN0aW9uKCl7cmV0dXJuIGEuYXBwbHkoYnx8dGhpcyxlLmNvbmNhdChkLmNhbGwoYXJndW1lbnRzKSkpfSxmLmd1aWQ9YS5ndWlkPWEuZ3VpZHx8bi5ndWlkKyssZik6dm9pZCAwfSxub3c6RGF0ZS5ub3csc3VwcG9ydDprfSksbi5lYWNoKCJCb29sZWFuIE51bWJlciBTdHJpbmcgRnVuY3Rpb24gQXJyYXkgRGF0ZSBSZWdFeHAgT2JqZWN0IEVycm9yIi5zcGxpdCgiICIpLGZ1bmN0aW9uKGEsYil7aFsiW29iamVjdCAiK2IrIl0iXT1iLnRvTG93ZXJDYXNlKCl9KTtmdW5jdGlvbiBzKGEpe3ZhciBiPWEubGVuZ3RoLGM9bi50eXBlKGEpO3JldHVybiJmdW5jdGlvbiI9PT1jfHxuLmlzV2luZG93KGEpPyExOjE9PT1hLm5vZGVUeXBlJiZiPyEwOiJhcnJheSI9PT1jfHwwPT09Ynx8Im51bWJlciI9PXR5cGVvZiBiJiZiPjAmJmItMSBpbiBhfXZhciB0PWZ1bmN0aW9uKGEpe3ZhciBiLGMsZCxlLGYsZyxoLGksaixrLGwsbSxuLG8scCxxLHIscyx0LHU9InNpenpsZSIrMSpuZXcgRGF0ZSx2PWEuZG9jdW1lbnQsdz0wLHg9MCx5PWhiKCksej1oYigpLEE9aGIoKSxCPWZ1bmN0aW9uKGEsYil7cmV0dXJuIGE9PT1iJiYobD0hMCksMH0sQz0xPDwzMSxEPXt9Lmhhc093blByb3BlcnR5LEU9W10sRj1FLnBvcCxHPUUucHVzaCxIPUUucHVzaCxJPUUuc2xpY2UsSj1mdW5jdGlvbihhLGIpe2Zvcih2YXIgYz0wLGQ9YS5sZW5ndGg7ZD5jO2MrKylpZihhW2NdPT09YilyZXR1cm4gYztyZXR1cm4tMX0sSz0iY2hlY2tlZHxzZWxlY3RlZHxhc3luY3xhdXRvZm9jdXN8YXV0b3BsYXl8Y29udHJvbHN8ZGVmZXJ8ZGlzYWJsZWR8aGlkZGVufGlzbWFwfGxvb3B8bXVsdGlwbGV8b3BlbnxyZWFkb25seXxyZXF1aXJlZHxzY29wZWQiLEw9IltcXHgyMFxcdFxcclxcblxcZl0iLE09Iig/OlxcXFwufFtcXHctXXxbXlxceDAwLVxceGEwXSkrIixOPU0ucmVwbGFjZSgidyIsIncjIiksTz0iXFxbIitMKyIqKCIrTSsiKSg/OiIrTCsiKihbKl4kfCF+XT89KSIrTCsiKig/OicoKD86XFxcXC58W15cXFxcJ10pKiknfFwiKCg/OlxcXFwufFteXFxcXFwiXSkqKVwifCgiK04rIikpfCkiK0wrIipcXF0iLFA9IjooIitNKyIpKD86XFwoKCgnKCg/OlxcXFwufFteXFxcXCddKSopJ3xcIigoPzpcXFxcLnxbXlxcXFxcIl0pKilcIil8KCg/OlxcXFwufFteXFxcXCgpW1xcXV18IitPKyIpKil8LiopXFwpfCkiLFE9bmV3IFJlZ0V4cChMKyIrIiwiZyIpLFI9bmV3IFJlZ0V4cCgiXiIrTCsiK3woKD86XnxbXlxcXFxdKSg/OlxcXFwuKSopIitMKyIrJCIsImciKSxTPW5ldyBSZWdFeHAoIl4iK0wrIiosIitMKyIqIiksVD1uZXcgUmVnRXhwKCJeIitMKyIqKFs+K35dfCIrTCsiKSIrTCsiKiIpLFU9bmV3IFJlZ0V4cCgiPSIrTCsiKihbXlxcXSdcIl0qPykiK0wrIipcXF0iLCJnIiksVj1uZXcgUmVnRXhwKFApLFc9bmV3IFJlZ0V4cCgiXiIrTisiJCIpLFg9e0lEOm5ldyBSZWdFeHAoIl4jKCIrTSsiKSIpLENMQVNTOm5ldyBSZWdFeHAoIl5cXC4oIitNKyIpIiksVEFHOm5ldyBSZWdFeHAoIl4oIitNLnJlcGxhY2UoInciLCJ3KiIpKyIpIiksQVRUUjpuZXcgUmVnRXhwKCJeIitPKSxQU0VVRE86bmV3IFJlZ0V4cCgiXiIrUCksQ0hJTEQ6bmV3IFJlZ0V4cCgiXjoob25seXxmaXJzdHxsYXN0fG50aHxudGgtbGFzdCktKGNoaWxkfG9mLXR5cGUpKD86XFwoIitMKyIqKGV2ZW58b2RkfCgoWystXXwpKFxcZCopbnwpIitMKyIqKD86KFsrLV18KSIrTCsiKihcXGQrKXwpKSIrTCsiKlxcKXwpIiwiaSIpLGJvb2w6bmV3IFJlZ0V4cCgiXig/OiIrSysiKSQiLCJpIiksbmVlZHNDb250ZXh0Om5ldyBSZWdFeHAoIl4iK0wrIipbPit+XXw6KGV2ZW58b2RkfGVxfGd0fGx0fG50aHxmaXJzdHxsYXN0KSg/OlxcKCIrTCsiKigoPzotXFxkKT9cXGQqKSIrTCsiKlxcKXwpKD89W14tXXwkKSIsImkiKX0sWT0vXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYXxidXR0b24pJC9pLFo9L15oXGQkL2ksJD0vXltee10rXHtccypcW25hdGl2ZSBcdy8sXz0vXig/OiMoW1x3LV0rKXwoXHcrKXxcLihbXHctXSspKSQvLGFiPS9bK35dLyxiYj0vJ3xcXC9nLGNiPW5ldyBSZWdFeHAoIlxcXFwoW1xcZGEtZl17MSw2fSIrTCsiP3woIitMKyIpfC4pIiwiaWciKSxkYj1mdW5jdGlvbihhLGIsYyl7dmFyIGQ9IjB4IitiLTY1NTM2O3JldHVybiBkIT09ZHx8Yz9iOjA+ZD9TdHJpbmcuZnJvbUNoYXJDb2RlKGQrNjU1MzYpOlN0cmluZy5mcm9tQ2hhckNvZGUoZD4+MTB8NTUyOTYsMTAyMyZkfDU2MzIwKX0sZWI9ZnVuY3Rpb24oKXttKCl9O3RyeXtILmFwcGx5KEU9SS5jYWxsKHYuY2hpbGROb2Rlcyksdi5jaGlsZE5vZGVzKSxFW3YuY2hpbGROb2Rlcy5sZW5ndGhdLm5vZGVUeXBlfWNhdGNoKGZiKXtIPXthcHBseTpFLmxlbmd0aD9mdW5jdGlvbihhLGIpe0cuYXBwbHkoYSxJLmNhbGwoYikpfTpmdW5jdGlvbihhLGIpe3ZhciBjPWEubGVuZ3RoLGQ9MDt3aGlsZShhW2MrK109YltkKytdKTthLmxlbmd0aD1jLTF9fX1mdW5jdGlvbiBnYihhLGIsZCxlKXt2YXIgZixoLGosayxsLG8scixzLHcseDtpZigoYj9iLm93bmVyRG9jdW1lbnR8fGI6dikhPT1uJiZtKGIpLGI9Ynx8bixkPWR8fFtdLGs9Yi5ub2RlVHlwZSwic3RyaW5nIiE9dHlwZW9mIGF8fCFhfHwxIT09ayYmOSE9PWsmJjExIT09aylyZXR1cm4gZDtpZighZSYmcCl7aWYoMTEhPT1rJiYoZj1fLmV4ZWMoYSkpKWlmKGo9ZlsxXSl7aWYoOT09PWspe2lmKGg9Yi5nZXRFbGVtZW50QnlJZChqKSwhaHx8IWgucGFyZW50Tm9kZSlyZXR1cm4gZDtpZihoLmlkPT09ailyZXR1cm4gZC5wdXNoKGgpLGR9ZWxzZSBpZihiLm93bmVyRG9jdW1lbnQmJihoPWIub3duZXJEb2N1bWVudC5nZXRFbGVtZW50QnlJZChqKSkmJnQoYixoKSYmaC5pZD09PWopcmV0dXJuIGQucHVzaChoKSxkfWVsc2V7aWYoZlsyXSlyZXR1cm4gSC5hcHBseShkLGIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoYSkpLGQ7aWYoKGo9ZlszXSkmJmMuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSlyZXR1cm4gSC5hcHBseShkLGIuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShqKSksZH1pZihjLnFzYSYmKCFxfHwhcS50ZXN0KGEpKSl7aWYocz1yPXUsdz1iLHg9MSE9PWsmJmEsMT09PWsmJiJvYmplY3QiIT09Yi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpKXtvPWcoYSksKHI9Yi5nZXRBdHRyaWJ1dGUoImlkIikpP3M9ci5yZXBsYWNlKGJiLCJcXCQmIik6Yi5zZXRBdHRyaWJ1dGUoImlkIixzKSxzPSJbaWQ9JyIrcysiJ10gIixsPW8ubGVuZ3RoO3doaWxlKGwtLSlvW2xdPXMrcmIob1tsXSk7dz1hYi50ZXN0KGEpJiZwYihiLnBhcmVudE5vZGUpfHxiLHg9by5qb2luKCIsIil9aWYoeCl0cnl7cmV0dXJuIEguYXBwbHkoZCx3LnF1ZXJ5U2VsZWN0b3JBbGwoeCkpLGR9Y2F0Y2goeSl7fWZpbmFsbHl7cnx8Yi5yZW1vdmVBdHRyaWJ1dGUoImlkIil9fX1yZXR1cm4gaShhLnJlcGxhY2UoUiwiJDEiKSxiLGQsZSl9ZnVuY3Rpb24gaGIoKXt2YXIgYT1bXTtmdW5jdGlvbiBiKGMsZSl7cmV0dXJuIGEucHVzaChjKyIgIik+ZC5jYWNoZUxlbmd0aCYmZGVsZXRlIGJbYS5zaGlmdCgpXSxiW2MrIiAiXT1lfXJldHVybiBifWZ1bmN0aW9uIGliKGEpe3JldHVybiBhW3VdPSEwLGF9ZnVuY3Rpb24gamIoYSl7dmFyIGI9bi5jcmVhdGVFbGVtZW50KCJkaXYiKTt0cnl7cmV0dXJuISFhKGIpfWNhdGNoKGMpe3JldHVybiExfWZpbmFsbHl7Yi5wYXJlbnROb2RlJiZiLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYiksYj1udWxsfX1mdW5jdGlvbiBrYihhLGIpe3ZhciBjPWEuc3BsaXQoInwiKSxlPWEubGVuZ3RoO3doaWxlKGUtLSlkLmF0dHJIYW5kbGVbY1tlXV09Yn1mdW5jdGlvbiBsYihhLGIpe3ZhciBjPWImJmEsZD1jJiYxPT09YS5ub2RlVHlwZSYmMT09PWIubm9kZVR5cGUmJih+Yi5zb3VyY2VJbmRleHx8QyktKH5hLnNvdXJjZUluZGV4fHxDKTtpZihkKXJldHVybiBkO2lmKGMpd2hpbGUoYz1jLm5leHRTaWJsaW5nKWlmKGM9PT1iKXJldHVybi0xO3JldHVybiBhPzE6LTF9ZnVuY3Rpb24gbWIoYSl7cmV0dXJuIGZ1bmN0aW9uKGIpe3ZhciBjPWIubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtyZXR1cm4iaW5wdXQiPT09YyYmYi50eXBlPT09YX19ZnVuY3Rpb24gbmIoYSl7cmV0dXJuIGZ1bmN0aW9uKGIpe3ZhciBjPWIubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtyZXR1cm4oImlucHV0Ij09PWN8fCJidXR0b24iPT09YykmJmIudHlwZT09PWF9fWZ1bmN0aW9uIG9iKGEpe3JldHVybiBpYihmdW5jdGlvbihiKXtyZXR1cm4gYj0rYixpYihmdW5jdGlvbihjLGQpe3ZhciBlLGY9YShbXSxjLmxlbmd0aCxiKSxnPWYubGVuZ3RoO3doaWxlKGctLSljW2U9ZltnXV0mJihjW2VdPSEoZFtlXT1jW2VdKSl9KX0pfWZ1bmN0aW9uIHBiKGEpe3JldHVybiBhJiYidW5kZWZpbmVkIiE9dHlwZW9mIGEuZ2V0RWxlbWVudHNCeVRhZ05hbWUmJmF9Yz1nYi5zdXBwb3J0PXt9LGY9Z2IuaXNYTUw9ZnVuY3Rpb24oYSl7dmFyIGI9YSYmKGEub3duZXJEb2N1bWVudHx8YSkuZG9jdW1lbnRFbGVtZW50O3JldHVybiBiPyJIVE1MIiE9PWIubm9kZU5hbWU6ITF9LG09Z2Iuc2V0RG9jdW1lbnQ9ZnVuY3Rpb24oYSl7dmFyIGIsZSxnPWE/YS5vd25lckRvY3VtZW50fHxhOnY7cmV0dXJuIGchPT1uJiY5PT09Zy5ub2RlVHlwZSYmZy5kb2N1bWVudEVsZW1lbnQ/KG49ZyxvPWcuZG9jdW1lbnRFbGVtZW50LGU9Zy5kZWZhdWx0VmlldyxlJiZlIT09ZS50b3AmJihlLmFkZEV2ZW50TGlzdGVuZXI/ZS5hZGRFdmVudExpc3RlbmVyKCJ1bmxvYWQiLGViLCExKTplLmF0dGFjaEV2ZW50JiZlLmF0dGFjaEV2ZW50KCJvbnVubG9hZCIsZWIpKSxwPSFmKGcpLGMuYXR0cmlidXRlcz1qYihmdW5jdGlvbihhKXtyZXR1cm4gYS5jbGFzc05hbWU9ImkiLCFhLmdldEF0dHJpYnV0ZSgiY2xhc3NOYW1lIil9KSxjLmdldEVsZW1lbnRzQnlUYWdOYW1lPWpiKGZ1bmN0aW9uKGEpe3JldHVybiBhLmFwcGVuZENoaWxkKGcuY3JlYXRlQ29tbWVudCgiIikpLCFhLmdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIikubGVuZ3RofSksYy5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lPSQudGVzdChnLmdldEVsZW1lbnRzQnlDbGFzc05hbWUpLGMuZ2V0QnlJZD1qYihmdW5jdGlvbihhKXtyZXR1cm4gby5hcHBlbmRDaGlsZChhKS5pZD11LCFnLmdldEVsZW1lbnRzQnlOYW1lfHwhZy5nZXRFbGVtZW50c0J5TmFtZSh1KS5sZW5ndGh9KSxjLmdldEJ5SWQ/KGQuZmluZC5JRD1mdW5jdGlvbihhLGIpe2lmKCJ1bmRlZmluZWQiIT10eXBlb2YgYi5nZXRFbGVtZW50QnlJZCYmcCl7dmFyIGM9Yi5nZXRFbGVtZW50QnlJZChhKTtyZXR1cm4gYyYmYy5wYXJlbnROb2RlP1tjXTpbXX19LGQuZmlsdGVyLklEPWZ1bmN0aW9uKGEpe3ZhciBiPWEucmVwbGFjZShjYixkYik7cmV0dXJuIGZ1bmN0aW9uKGEpe3JldHVybiBhLmdldEF0dHJpYnV0ZSgiaWQiKT09PWJ9fSk6KGRlbGV0ZSBkLmZpbmQuSUQsZC5maWx0ZXIuSUQ9ZnVuY3Rpb24oYSl7dmFyIGI9YS5yZXBsYWNlKGNiLGRiKTtyZXR1cm4gZnVuY3Rpb24oYSl7dmFyIGM9InVuZGVmaW5lZCIhPXR5cGVvZiBhLmdldEF0dHJpYnV0ZU5vZGUmJmEuZ2V0QXR0cmlidXRlTm9kZSgiaWQiKTtyZXR1cm4gYyYmYy52YWx1ZT09PWJ9fSksZC5maW5kLlRBRz1jLmdldEVsZW1lbnRzQnlUYWdOYW1lP2Z1bmN0aW9uKGEsYil7cmV0dXJuInVuZGVmaW5lZCIhPXR5cGVvZiBiLmdldEVsZW1lbnRzQnlUYWdOYW1lP2IuZ2V0RWxlbWVudHNCeVRhZ05hbWUoYSk6Yy5xc2E/Yi5xdWVyeVNlbGVjdG9yQWxsKGEpOnZvaWQgMH06ZnVuY3Rpb24oYSxiKXt2YXIgYyxkPVtdLGU9MCxmPWIuZ2V0RWxlbWVudHNCeVRhZ05hbWUoYSk7aWYoIioiPT09YSl7d2hpbGUoYz1mW2UrK10pMT09PWMubm9kZVR5cGUmJmQucHVzaChjKTtyZXR1cm4gZH1yZXR1cm4gZn0sZC5maW5kLkNMQVNTPWMuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSYmZnVuY3Rpb24oYSxiKXtyZXR1cm4gcD9iLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoYSk6dm9pZCAwfSxyPVtdLHE9W10sKGMucXNhPSQudGVzdChnLnF1ZXJ5U2VsZWN0b3JBbGwpKSYmKGpiKGZ1bmN0aW9uKGEpe28uYXBwZW5kQ2hpbGQoYSkuaW5uZXJIVE1MPSI8YSBpZD0nIit1KyInPjwvYT48c2VsZWN0IGlkPSciK3UrIi1cZl0nIG1zYWxsb3djYXB0dXJlPScnPjxvcHRpb24gc2VsZWN0ZWQ9Jyc+PC9vcHRpb24+PC9zZWxlY3Q+IixhLnF1ZXJ5U2VsZWN0b3JBbGwoIlttc2FsbG93Y2FwdHVyZV49JyddIikubGVuZ3RoJiZxLnB1c2goIlsqXiRdPSIrTCsiKig/OicnfFwiXCIpIiksYS5xdWVyeVNlbGVjdG9yQWxsKCJbc2VsZWN0ZWRdIikubGVuZ3RofHxxLnB1c2goIlxcWyIrTCsiKig/OnZhbHVlfCIrSysiKSIpLGEucXVlcnlTZWxlY3RvckFsbCgiW2lkfj0iK3UrIi1dIikubGVuZ3RofHxxLnB1c2goIn49IiksYS5xdWVyeVNlbGVjdG9yQWxsKCI6Y2hlY2tlZCIpLmxlbmd0aHx8cS5wdXNoKCI6Y2hlY2tlZCIpLGEucXVlcnlTZWxlY3RvckFsbCgiYSMiK3UrIisqIikubGVuZ3RofHxxLnB1c2goIi4jLitbK35dIil9KSxqYihmdW5jdGlvbihhKXt2YXIgYj1nLmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7Yi5zZXRBdHRyaWJ1dGUoInR5cGUiLCJoaWRkZW4iKSxhLmFwcGVuZENoaWxkKGIpLnNldEF0dHJpYnV0ZSgibmFtZSIsIkQiKSxhLnF1ZXJ5U2VsZWN0b3JBbGwoIltuYW1lPWRdIikubGVuZ3RoJiZxLnB1c2goIm5hbWUiK0wrIipbKl4kfCF+XT89IiksYS5xdWVyeVNlbGVjdG9yQWxsKCI6ZW5hYmxlZCIpLmxlbmd0aHx8cS5wdXNoKCI6ZW5hYmxlZCIsIjpkaXNhYmxlZCIpLGEucXVlcnlTZWxlY3RvckFsbCgiKiw6eCIpLHEucHVzaCgiLC4qOiIpfSkpLChjLm1hdGNoZXNTZWxlY3Rvcj0kLnRlc3Qocz1vLm1hdGNoZXN8fG8ud2Via2l0TWF0Y2hlc1NlbGVjdG9yfHxvLm1vek1hdGNoZXNTZWxlY3Rvcnx8by5vTWF0Y2hlc1NlbGVjdG9yfHxvLm1zTWF0Y2hlc1NlbGVjdG9yKSkmJmpiKGZ1bmN0aW9uKGEpe2MuZGlzY29ubmVjdGVkTWF0Y2g9cy5jYWxsKGEsImRpdiIpLHMuY2FsbChhLCJbcyE9JyddOngiKSxyLnB1c2goIiE9IixQKX0pLHE9cS5sZW5ndGgmJm5ldyBSZWdFeHAocS5qb2luKCJ8IikpLHI9ci5sZW5ndGgmJm5ldyBSZWdFeHAoci5qb2luKCJ8IikpLGI9JC50ZXN0KG8uY29tcGFyZURvY3VtZW50UG9zaXRpb24pLHQ9Ynx8JC50ZXN0KG8uY29udGFpbnMpP2Z1bmN0aW9uKGEsYil7dmFyIGM9OT09PWEubm9kZVR5cGU/YS5kb2N1bWVudEVsZW1lbnQ6YSxkPWImJmIucGFyZW50Tm9kZTtyZXR1cm4gYT09PWR8fCEoIWR8fDEhPT1kLm5vZGVUeXBlfHwhKGMuY29udGFpbnM/Yy5jb250YWlucyhkKTphLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uJiYxNiZhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGQpKSl9OmZ1bmN0aW9uKGEsYil7aWYoYil3aGlsZShiPWIucGFyZW50Tm9kZSlpZihiPT09YSlyZXR1cm4hMDtyZXR1cm4hMX0sQj1iP2Z1bmN0aW9uKGEsYil7aWYoYT09PWIpcmV0dXJuIGw9ITAsMDt2YXIgZD0hYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbi0hYi5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbjtyZXR1cm4gZD9kOihkPShhLm93bmVyRG9jdW1lbnR8fGEpPT09KGIub3duZXJEb2N1bWVudHx8Yik/YS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihiKToxLDEmZHx8IWMuc29ydERldGFjaGVkJiZiLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGEpPT09ZD9hPT09Z3x8YS5vd25lckRvY3VtZW50PT09diYmdCh2LGEpPy0xOmI9PT1nfHxiLm93bmVyRG9jdW1lbnQ9PT12JiZ0KHYsYik/MTprP0ooayxhKS1KKGssYik6MDo0JmQ/LTE6MSl9OmZ1bmN0aW9uKGEsYil7aWYoYT09PWIpcmV0dXJuIGw9ITAsMDt2YXIgYyxkPTAsZT1hLnBhcmVudE5vZGUsZj1iLnBhcmVudE5vZGUsaD1bYV0saT1bYl07aWYoIWV8fCFmKXJldHVybiBhPT09Zz8tMTpiPT09Zz8xOmU/LTE6Zj8xOms/SihrLGEpLUooayxiKTowO2lmKGU9PT1mKXJldHVybiBsYihhLGIpO2M9YTt3aGlsZShjPWMucGFyZW50Tm9kZSloLnVuc2hpZnQoYyk7Yz1iO3doaWxlKGM9Yy5wYXJlbnROb2RlKWkudW5zaGlmdChjKTt3aGlsZShoW2RdPT09aVtkXSlkKys7cmV0dXJuIGQ/bGIoaFtkXSxpW2RdKTpoW2RdPT09dj8tMTppW2RdPT09dj8xOjB9LGcpOm59LGdiLm1hdGNoZXM9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gZ2IoYSxudWxsLG51bGwsYil9LGdiLm1hdGNoZXNTZWxlY3Rvcj1mdW5jdGlvbihhLGIpe2lmKChhLm93bmVyRG9jdW1lbnR8fGEpIT09biYmbShhKSxiPWIucmVwbGFjZShVLCI9JyQxJ10iKSwhKCFjLm1hdGNoZXNTZWxlY3Rvcnx8IXB8fHImJnIudGVzdChiKXx8cSYmcS50ZXN0KGIpKSl0cnl7dmFyIGQ9cy5jYWxsKGEsYik7aWYoZHx8Yy5kaXNjb25uZWN0ZWRNYXRjaHx8YS5kb2N1bWVudCYmMTEhPT1hLmRvY3VtZW50Lm5vZGVUeXBlKXJldHVybiBkfWNhdGNoKGUpe31yZXR1cm4gZ2IoYixuLG51bGwsW2FdKS5sZW5ndGg+MH0sZ2IuY29udGFpbnM9ZnVuY3Rpb24oYSxiKXtyZXR1cm4oYS5vd25lckRvY3VtZW50fHxhKSE9PW4mJm0oYSksdChhLGIpfSxnYi5hdHRyPWZ1bmN0aW9uKGEsYil7KGEub3duZXJEb2N1bWVudHx8YSkhPT1uJiZtKGEpO3ZhciBlPWQuYXR0ckhhbmRsZVtiLnRvTG93ZXJDYXNlKCldLGY9ZSYmRC5jYWxsKGQuYXR0ckhhbmRsZSxiLnRvTG93ZXJDYXNlKCkpP2UoYSxiLCFwKTp2b2lkIDA7cmV0dXJuIHZvaWQgMCE9PWY/ZjpjLmF0dHJpYnV0ZXN8fCFwP2EuZ2V0QXR0cmlidXRlKGIpOihmPWEuZ2V0QXR0cmlidXRlTm9kZShiKSkmJmYuc3BlY2lmaWVkP2YudmFsdWU6bnVsbH0sZ2IuZXJyb3I9ZnVuY3Rpb24oYSl7dGhyb3cgbmV3IEVycm9yKCJTeW50YXggZXJyb3IsIHVucmVjb2duaXplZCBleHByZXNzaW9uOiAiK2EpfSxnYi51bmlxdWVTb3J0PWZ1bmN0aW9uKGEpe3ZhciBiLGQ9W10sZT0wLGY9MDtpZihsPSFjLmRldGVjdER1cGxpY2F0ZXMsaz0hYy5zb3J0U3RhYmxlJiZhLnNsaWNlKDApLGEuc29ydChCKSxsKXt3aGlsZShiPWFbZisrXSliPT09YVtmXSYmKGU9ZC5wdXNoKGYpKTt3aGlsZShlLS0pYS5zcGxpY2UoZFtlXSwxKX1yZXR1cm4gaz1udWxsLGF9LGU9Z2IuZ2V0VGV4dD1mdW5jdGlvbihhKXt2YXIgYixjPSIiLGQ9MCxmPWEubm9kZVR5cGU7aWYoZil7aWYoMT09PWZ8fDk9PT1mfHwxMT09PWYpe2lmKCJzdHJpbmciPT10eXBlb2YgYS50ZXh0Q29udGVudClyZXR1cm4gYS50ZXh0Q29udGVudDtmb3IoYT1hLmZpcnN0Q2hpbGQ7YTthPWEubmV4dFNpYmxpbmcpYys9ZShhKX1lbHNlIGlmKDM9PT1mfHw0PT09ZilyZXR1cm4gYS5ub2RlVmFsdWV9ZWxzZSB3aGlsZShiPWFbZCsrXSljKz1lKGIpO3JldHVybiBjfSxkPWdiLnNlbGVjdG9ycz17Y2FjaGVMZW5ndGg6NTAsY3JlYXRlUHNldWRvOmliLG1hdGNoOlgsYXR0ckhhbmRsZTp7fSxmaW5kOnt9LHJlbGF0aXZlOnsiPiI6e2RpcjoicGFyZW50Tm9kZSIsZmlyc3Q6ITB9LCIgIjp7ZGlyOiJwYXJlbnROb2RlIn0sIisiOntkaXI6InByZXZpb3VzU2libGluZyIsZmlyc3Q6ITB9LCJ+Ijp7ZGlyOiJwcmV2aW91c1NpYmxpbmcifX0scHJlRmlsdGVyOntBVFRSOmZ1bmN0aW9uKGEpe3JldHVybiBhWzFdPWFbMV0ucmVwbGFjZShjYixkYiksYVszXT0oYVszXXx8YVs0XXx8YVs1XXx8IiIpLnJlcGxhY2UoY2IsZGIpLCJ+PSI9PT1hWzJdJiYoYVszXT0iICIrYVszXSsiICIpLGEuc2xpY2UoMCw0KX0sQ0hJTEQ6ZnVuY3Rpb24oYSl7cmV0dXJuIGFbMV09YVsxXS50b0xvd2VyQ2FzZSgpLCJudGgiPT09YVsxXS5zbGljZSgwLDMpPyhhWzNdfHxnYi5lcnJvcihhWzBdKSxhWzRdPSsoYVs0XT9hWzVdKyhhWzZdfHwxKToyKigiZXZlbiI9PT1hWzNdfHwib2RkIj09PWFbM10pKSxhWzVdPSsoYVs3XSthWzhdfHwib2RkIj09PWFbM10pKTphWzNdJiZnYi5lcnJvcihhWzBdKSxhfSxQU0VVRE86ZnVuY3Rpb24oYSl7dmFyIGIsYz0hYVs2XSYmYVsyXTtyZXR1cm4gWC5DSElMRC50ZXN0KGFbMF0pP251bGw6KGFbM10/YVsyXT1hWzRdfHxhWzVdfHwiIjpjJiZWLnRlc3QoYykmJihiPWcoYywhMCkpJiYoYj1jLmluZGV4T2YoIikiLGMubGVuZ3RoLWIpLWMubGVuZ3RoKSYmKGFbMF09YVswXS5zbGljZSgwLGIpLGFbMl09Yy5zbGljZSgwLGIpKSxhLnNsaWNlKDAsMykpfX0sZmlsdGVyOntUQUc6ZnVuY3Rpb24oYSl7dmFyIGI9YS5yZXBsYWNlKGNiLGRiKS50b0xvd2VyQ2FzZSgpO3JldHVybiIqIj09PWE/ZnVuY3Rpb24oKXtyZXR1cm4hMH06ZnVuY3Rpb24oYSl7cmV0dXJuIGEubm9kZU5hbWUmJmEubm9kZU5hbWUudG9Mb3dlckNhc2UoKT09PWJ9fSxDTEFTUzpmdW5jdGlvbihhKXt2YXIgYj15W2ErIiAiXTtyZXR1cm4gYnx8KGI9bmV3IFJlZ0V4cCgiKF58IitMKyIpIithKyIoIitMKyJ8JCkiKSkmJnkoYSxmdW5jdGlvbihhKXtyZXR1cm4gYi50ZXN0KCJzdHJpbmciPT10eXBlb2YgYS5jbGFzc05hbWUmJmEuY2xhc3NOYW1lfHwidW5kZWZpbmVkIiE9dHlwZW9mIGEuZ2V0QXR0cmlidXRlJiZhLmdldEF0dHJpYnV0ZSgiY2xhc3MiKXx8IiIpfSl9LEFUVFI6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBmdW5jdGlvbihkKXt2YXIgZT1nYi5hdHRyKGQsYSk7cmV0dXJuIG51bGw9PWU/IiE9Ij09PWI6Yj8oZSs9IiIsIj0iPT09Yj9lPT09YzoiIT0iPT09Yj9lIT09YzoiXj0iPT09Yj9jJiYwPT09ZS5pbmRleE9mKGMpOiIqPSI9PT1iP2MmJmUuaW5kZXhPZihjKT4tMToiJD0iPT09Yj9jJiZlLnNsaWNlKC1jLmxlbmd0aCk9PT1jOiJ+PSI9PT1iPygiICIrZS5yZXBsYWNlKFEsIiAiKSsiICIpLmluZGV4T2YoYyk+LTE6Inw9Ij09PWI/ZT09PWN8fGUuc2xpY2UoMCxjLmxlbmd0aCsxKT09PWMrIi0iOiExKTohMH19LENISUxEOmZ1bmN0aW9uKGEsYixjLGQsZSl7dmFyIGY9Im50aCIhPT1hLnNsaWNlKDAsMyksZz0ibGFzdCIhPT1hLnNsaWNlKC00KSxoPSJvZi10eXBlIj09PWI7cmV0dXJuIDE9PT1kJiYwPT09ZT9mdW5jdGlvbihhKXtyZXR1cm4hIWEucGFyZW50Tm9kZX06ZnVuY3Rpb24oYixjLGkpe3ZhciBqLGssbCxtLG4sbyxwPWYhPT1nPyJuZXh0U2libGluZyI6InByZXZpb3VzU2libGluZyIscT1iLnBhcmVudE5vZGUscj1oJiZiLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkscz0haSYmIWg7aWYocSl7aWYoZil7d2hpbGUocCl7bD1iO3doaWxlKGw9bFtwXSlpZihoP2wubm9kZU5hbWUudG9Mb3dlckNhc2UoKT09PXI6MT09PWwubm9kZVR5cGUpcmV0dXJuITE7bz1wPSJvbmx5Ij09PWEmJiFvJiYibmV4dFNpYmxpbmcifXJldHVybiEwfWlmKG89W2c/cS5maXJzdENoaWxkOnEubGFzdENoaWxkXSxnJiZzKXtrPXFbdV18fChxW3VdPXt9KSxqPWtbYV18fFtdLG49alswXT09PXcmJmpbMV0sbT1qWzBdPT09dyYmalsyXSxsPW4mJnEuY2hpbGROb2Rlc1tuXTt3aGlsZShsPSsrbiYmbCYmbFtwXXx8KG09bj0wKXx8by5wb3AoKSlpZigxPT09bC5ub2RlVHlwZSYmKyttJiZsPT09Yil7a1thXT1bdyxuLG1dO2JyZWFrfX1lbHNlIGlmKHMmJihqPShiW3VdfHwoYlt1XT17fSkpW2FdKSYmalswXT09PXcpbT1qWzFdO2Vsc2Ugd2hpbGUobD0rK24mJmwmJmxbcF18fChtPW49MCl8fG8ucG9wKCkpaWYoKGg/bC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09cjoxPT09bC5ub2RlVHlwZSkmJisrbSYmKHMmJigobFt1XXx8KGxbdV09e30pKVthXT1bdyxtXSksbD09PWIpKWJyZWFrO3JldHVybiBtLT1lLG09PT1kfHxtJWQ9PT0wJiZtL2Q+PTB9fX0sUFNFVURPOmZ1bmN0aW9uKGEsYil7dmFyIGMsZT1kLnBzZXVkb3NbYV18fGQuc2V0RmlsdGVyc1thLnRvTG93ZXJDYXNlKCldfHxnYi5lcnJvcigidW5zdXBwb3J0ZWQgcHNldWRvOiAiK2EpO3JldHVybiBlW3VdP2UoYik6ZS5sZW5ndGg+MT8oYz1bYSxhLCIiLGJdLGQuc2V0RmlsdGVycy5oYXNPd25Qcm9wZXJ0eShhLnRvTG93ZXJDYXNlKCkpP2liKGZ1bmN0aW9uKGEsYyl7dmFyIGQsZj1lKGEsYiksZz1mLmxlbmd0aDt3aGlsZShnLS0pZD1KKGEsZltnXSksYVtkXT0hKGNbZF09ZltnXSl9KTpmdW5jdGlvbihhKXtyZXR1cm4gZShhLDAsYyl9KTplfX0scHNldWRvczp7bm90OmliKGZ1bmN0aW9uKGEpe3ZhciBiPVtdLGM9W10sZD1oKGEucmVwbGFjZShSLCIkMSIpKTtyZXR1cm4gZFt1XT9pYihmdW5jdGlvbihhLGIsYyxlKXt2YXIgZixnPWQoYSxudWxsLGUsW10pLGg9YS5sZW5ndGg7d2hpbGUoaC0tKShmPWdbaF0pJiYoYVtoXT0hKGJbaF09ZikpfSk6ZnVuY3Rpb24oYSxlLGYpe3JldHVybiBiWzBdPWEsZChiLG51bGwsZixjKSxiWzBdPW51bGwsIWMucG9wKCl9fSksaGFzOmliKGZ1bmN0aW9uKGEpe3JldHVybiBmdW5jdGlvbihiKXtyZXR1cm4gZ2IoYSxiKS5sZW5ndGg+MH19KSxjb250YWluczppYihmdW5jdGlvbihhKXtyZXR1cm4gYT1hLnJlcGxhY2UoY2IsZGIpLGZ1bmN0aW9uKGIpe3JldHVybihiLnRleHRDb250ZW50fHxiLmlubmVyVGV4dHx8ZShiKSkuaW5kZXhPZihhKT4tMX19KSxsYW5nOmliKGZ1bmN0aW9uKGEpe3JldHVybiBXLnRlc3QoYXx8IiIpfHxnYi5lcnJvcigidW5zdXBwb3J0ZWQgbGFuZzogIithKSxhPWEucmVwbGFjZShjYixkYikudG9Mb3dlckNhc2UoKSxmdW5jdGlvbihiKXt2YXIgYztkbyBpZihjPXA/Yi5sYW5nOmIuZ2V0QXR0cmlidXRlKCJ4bWw6bGFuZyIpfHxiLmdldEF0dHJpYnV0ZSgibGFuZyIpKXJldHVybiBjPWMudG9Mb3dlckNhc2UoKSxjPT09YXx8MD09PWMuaW5kZXhPZihhKyItIik7d2hpbGUoKGI9Yi5wYXJlbnROb2RlKSYmMT09PWIubm9kZVR5cGUpO3JldHVybiExfX0pLHRhcmdldDpmdW5jdGlvbihiKXt2YXIgYz1hLmxvY2F0aW9uJiZhLmxvY2F0aW9uLmhhc2g7cmV0dXJuIGMmJmMuc2xpY2UoMSk9PT1iLmlkfSxyb290OmZ1bmN0aW9uKGEpe3JldHVybiBhPT09b30sZm9jdXM6ZnVuY3Rpb24oYSl7cmV0dXJuIGE9PT1uLmFjdGl2ZUVsZW1lbnQmJighbi5oYXNGb2N1c3x8bi5oYXNGb2N1cygpKSYmISEoYS50eXBlfHxhLmhyZWZ8fH5hLnRhYkluZGV4KX0sZW5hYmxlZDpmdW5jdGlvbihhKXtyZXR1cm4gYS5kaXNhYmxlZD09PSExfSxkaXNhYmxlZDpmdW5jdGlvbihhKXtyZXR1cm4gYS5kaXNhYmxlZD09PSEwfSxjaGVja2VkOmZ1bmN0aW9uKGEpe3ZhciBiPWEubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtyZXR1cm4iaW5wdXQiPT09YiYmISFhLmNoZWNrZWR8fCJvcHRpb24iPT09YiYmISFhLnNlbGVjdGVkfSxzZWxlY3RlZDpmdW5jdGlvbihhKXtyZXR1cm4gYS5wYXJlbnROb2RlJiZhLnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleCxhLnNlbGVjdGVkPT09ITB9LGVtcHR5OmZ1bmN0aW9uKGEpe2ZvcihhPWEuZmlyc3RDaGlsZDthO2E9YS5uZXh0U2libGluZylpZihhLm5vZGVUeXBlPDYpcmV0dXJuITE7cmV0dXJuITB9LHBhcmVudDpmdW5jdGlvbihhKXtyZXR1cm4hZC5wc2V1ZG9zLmVtcHR5KGEpfSxoZWFkZXI6ZnVuY3Rpb24oYSl7cmV0dXJuIFoudGVzdChhLm5vZGVOYW1lKX0saW5wdXQ6ZnVuY3Rpb24oYSl7cmV0dXJuIFkudGVzdChhLm5vZGVOYW1lKX0sYnV0dG9uOmZ1bmN0aW9uKGEpe3ZhciBiPWEubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtyZXR1cm4iaW5wdXQiPT09YiYmImJ1dHRvbiI9PT1hLnR5cGV8fCJidXR0b24iPT09Yn0sdGV4dDpmdW5jdGlvbihhKXt2YXIgYjtyZXR1cm4iaW5wdXQiPT09YS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpJiYidGV4dCI9PT1hLnR5cGUmJihudWxsPT0oYj1hLmdldEF0dHJpYnV0ZSgidHlwZSIpKXx8InRleHQiPT09Yi50b0xvd2VyQ2FzZSgpKX0sZmlyc3Q6b2IoZnVuY3Rpb24oKXtyZXR1cm5bMF19KSxsYXN0Om9iKGZ1bmN0aW9uKGEsYil7cmV0dXJuW2ItMV19KSxlcTpvYihmdW5jdGlvbihhLGIsYyl7cmV0dXJuWzA+Yz9jK2I6Y119KSxldmVuOm9iKGZ1bmN0aW9uKGEsYil7Zm9yKHZhciBjPTA7Yj5jO2MrPTIpYS5wdXNoKGMpO3JldHVybiBhfSksb2RkOm9iKGZ1bmN0aW9uKGEsYil7Zm9yKHZhciBjPTE7Yj5jO2MrPTIpYS5wdXNoKGMpO3JldHVybiBhfSksbHQ6b2IoZnVuY3Rpb24oYSxiLGMpe2Zvcih2YXIgZD0wPmM/YytiOmM7LS1kPj0wOylhLnB1c2goZCk7cmV0dXJuIGF9KSxndDpvYihmdW5jdGlvbihhLGIsYyl7Zm9yKHZhciBkPTA+Yz9jK2I6YzsrK2Q8YjspYS5wdXNoKGQpO3JldHVybiBhfSl9fSxkLnBzZXVkb3MubnRoPWQucHNldWRvcy5lcTtmb3IoYiBpbntyYWRpbzohMCxjaGVja2JveDohMCxmaWxlOiEwLHBhc3N3b3JkOiEwLGltYWdlOiEwfSlkLnBzZXVkb3NbYl09bWIoYik7Zm9yKGIgaW57c3VibWl0OiEwLHJlc2V0OiEwfSlkLnBzZXVkb3NbYl09bmIoYik7ZnVuY3Rpb24gcWIoKXt9cWIucHJvdG90eXBlPWQuZmlsdGVycz1kLnBzZXVkb3MsZC5zZXRGaWx0ZXJzPW5ldyBxYixnPWdiLnRva2VuaXplPWZ1bmN0aW9uKGEsYil7dmFyIGMsZSxmLGcsaCxpLGosaz16W2ErIiAiXTtpZihrKXJldHVybiBiPzA6ay5zbGljZSgwKTtoPWEsaT1bXSxqPWQucHJlRmlsdGVyO3doaWxlKGgpeyghY3x8KGU9Uy5leGVjKGgpKSkmJihlJiYoaD1oLnNsaWNlKGVbMF0ubGVuZ3RoKXx8aCksaS5wdXNoKGY9W10pKSxjPSExLChlPVQuZXhlYyhoKSkmJihjPWUuc2hpZnQoKSxmLnB1c2goe3ZhbHVlOmMsdHlwZTplWzBdLnJlcGxhY2UoUiwiICIpfSksaD1oLnNsaWNlKGMubGVuZ3RoKSk7Zm9yKGcgaW4gZC5maWx0ZXIpIShlPVhbZ10uZXhlYyhoKSl8fGpbZ10mJiEoZT1qW2ddKGUpKXx8KGM9ZS5zaGlmdCgpLGYucHVzaCh7dmFsdWU6Yyx0eXBlOmcsbWF0Y2hlczplfSksaD1oLnNsaWNlKGMubGVuZ3RoKSk7aWYoIWMpYnJlYWt9cmV0dXJuIGI/aC5sZW5ndGg6aD9nYi5lcnJvcihhKTp6KGEsaSkuc2xpY2UoMCl9O2Z1bmN0aW9uIHJiKGEpe2Zvcih2YXIgYj0wLGM9YS5sZW5ndGgsZD0iIjtjPmI7YisrKWQrPWFbYl0udmFsdWU7cmV0dXJuIGR9ZnVuY3Rpb24gc2IoYSxiLGMpe3ZhciBkPWIuZGlyLGU9YyYmInBhcmVudE5vZGUiPT09ZCxmPXgrKztyZXR1cm4gYi5maXJzdD9mdW5jdGlvbihiLGMsZil7d2hpbGUoYj1iW2RdKWlmKDE9PT1iLm5vZGVUeXBlfHxlKXJldHVybiBhKGIsYyxmKX06ZnVuY3Rpb24oYixjLGcpe3ZhciBoLGksaj1bdyxmXTtpZihnKXt3aGlsZShiPWJbZF0paWYoKDE9PT1iLm5vZGVUeXBlfHxlKSYmYShiLGMsZykpcmV0dXJuITB9ZWxzZSB3aGlsZShiPWJbZF0paWYoMT09PWIubm9kZVR5cGV8fGUpe2lmKGk9Ylt1XXx8KGJbdV09e30pLChoPWlbZF0pJiZoWzBdPT09dyYmaFsxXT09PWYpcmV0dXJuIGpbMl09aFsyXTtpZihpW2RdPWosalsyXT1hKGIsYyxnKSlyZXR1cm4hMH19fWZ1bmN0aW9uIHRiKGEpe3JldHVybiBhLmxlbmd0aD4xP2Z1bmN0aW9uKGIsYyxkKXt2YXIgZT1hLmxlbmd0aDt3aGlsZShlLS0paWYoIWFbZV0oYixjLGQpKXJldHVybiExO3JldHVybiEwfTphWzBdfWZ1bmN0aW9uIHViKGEsYixjKXtmb3IodmFyIGQ9MCxlPWIubGVuZ3RoO2U+ZDtkKyspZ2IoYSxiW2RdLGMpO3JldHVybiBjfWZ1bmN0aW9uIHZiKGEsYixjLGQsZSl7Zm9yKHZhciBmLGc9W10saD0wLGk9YS5sZW5ndGgsaj1udWxsIT1iO2k+aDtoKyspKGY9YVtoXSkmJighY3x8YyhmLGQsZSkpJiYoZy5wdXNoKGYpLGomJmIucHVzaChoKSk7cmV0dXJuIGd9ZnVuY3Rpb24gd2IoYSxiLGMsZCxlLGYpe3JldHVybiBkJiYhZFt1XSYmKGQ9d2IoZCkpLGUmJiFlW3VdJiYoZT13YihlLGYpKSxpYihmdW5jdGlvbihmLGcsaCxpKXt2YXIgaixrLGwsbT1bXSxuPVtdLG89Zy5sZW5ndGgscD1mfHx1YihifHwiKiIsaC5ub2RlVHlwZT9baF06aCxbXSkscT0hYXx8IWYmJmI/cDp2YihwLG0sYSxoLGkpLHI9Yz9lfHwoZj9hOm98fGQpP1tdOmc6cTtpZihjJiZjKHEscixoLGkpLGQpe2o9dmIocixuKSxkKGosW10saCxpKSxrPWoubGVuZ3RoO3doaWxlKGstLSkobD1qW2tdKSYmKHJbbltrXV09IShxW25ba11dPWwpKX1pZihmKXtpZihlfHxhKXtpZihlKXtqPVtdLGs9ci5sZW5ndGg7d2hpbGUoay0tKShsPXJba10pJiZqLnB1c2gocVtrXT1sKTtlKG51bGwscj1bXSxqLGkpfWs9ci5sZW5ndGg7d2hpbGUoay0tKShsPXJba10pJiYoaj1lP0ooZixsKTptW2tdKT4tMSYmKGZbal09IShnW2pdPWwpKX19ZWxzZSByPXZiKHI9PT1nP3Iuc3BsaWNlKG8sci5sZW5ndGgpOnIpLGU/ZShudWxsLGcscixpKTpILmFwcGx5KGcscil9KX1mdW5jdGlvbiB4YihhKXtmb3IodmFyIGIsYyxlLGY9YS5sZW5ndGgsZz1kLnJlbGF0aXZlW2FbMF0udHlwZV0saD1nfHxkLnJlbGF0aXZlWyIgIl0saT1nPzE6MCxrPXNiKGZ1bmN0aW9uKGEpe3JldHVybiBhPT09Yn0saCwhMCksbD1zYihmdW5jdGlvbihhKXtyZXR1cm4gSihiLGEpPi0xfSxoLCEwKSxtPVtmdW5jdGlvbihhLGMsZCl7dmFyIGU9IWcmJihkfHxjIT09ail8fCgoYj1jKS5ub2RlVHlwZT9rKGEsYyxkKTpsKGEsYyxkKSk7cmV0dXJuIGI9bnVsbCxlfV07Zj5pO2krKylpZihjPWQucmVsYXRpdmVbYVtpXS50eXBlXSltPVtzYih0YihtKSxjKV07ZWxzZXtpZihjPWQuZmlsdGVyW2FbaV0udHlwZV0uYXBwbHkobnVsbCxhW2ldLm1hdGNoZXMpLGNbdV0pe2ZvcihlPSsraTtmPmU7ZSsrKWlmKGQucmVsYXRpdmVbYVtlXS50eXBlXSlicmVhaztyZXR1cm4gd2IoaT4xJiZ0YihtKSxpPjEmJnJiKGEuc2xpY2UoMCxpLTEpLmNvbmNhdCh7dmFsdWU6IiAiPT09YVtpLTJdLnR5cGU/IioiOiIifSkpLnJlcGxhY2UoUiwiJDEiKSxjLGU+aSYmeGIoYS5zbGljZShpLGUpKSxmPmUmJnhiKGE9YS5zbGljZShlKSksZj5lJiZyYihhKSl9bS5wdXNoKGMpfXJldHVybiB0YihtKX1mdW5jdGlvbiB5YihhLGIpe3ZhciBjPWIubGVuZ3RoPjAsZT1hLmxlbmd0aD4wLGY9ZnVuY3Rpb24oZixnLGgsaSxrKXt2YXIgbCxtLG8scD0wLHE9IjAiLHI9ZiYmW10scz1bXSx0PWosdT1mfHxlJiZkLmZpbmQuVEFHKCIqIixrKSx2PXcrPW51bGw9PXQ/MTpNYXRoLnJhbmRvbSgpfHwuMSx4PXUubGVuZ3RoO2ZvcihrJiYoaj1nIT09biYmZyk7cSE9PXgmJm51bGwhPShsPXVbcV0pO3ErKyl7aWYoZSYmbCl7bT0wO3doaWxlKG89YVttKytdKWlmKG8obCxnLGgpKXtpLnB1c2gobCk7YnJlYWt9ayYmKHc9dil9YyYmKChsPSFvJiZsKSYmcC0tLGYmJnIucHVzaChsKSl9aWYocCs9cSxjJiZxIT09cCl7bT0wO3doaWxlKG89YlttKytdKW8ocixzLGcsaCk7aWYoZil7aWYocD4wKXdoaWxlKHEtLSlyW3FdfHxzW3FdfHwoc1txXT1GLmNhbGwoaSkpO3M9dmIocyl9SC5hcHBseShpLHMpLGsmJiFmJiZzLmxlbmd0aD4wJiZwK2IubGVuZ3RoPjEmJmdiLnVuaXF1ZVNvcnQoaSl9cmV0dXJuIGsmJih3PXYsaj10KSxyfTtyZXR1cm4gYz9pYihmKTpmfXJldHVybiBoPWdiLmNvbXBpbGU9ZnVuY3Rpb24oYSxiKXt2YXIgYyxkPVtdLGU9W10sZj1BW2ErIiAiXTtpZighZil7Ynx8KGI9ZyhhKSksYz1iLmxlbmd0aDt3aGlsZShjLS0pZj14YihiW2NdKSxmW3VdP2QucHVzaChmKTplLnB1c2goZik7Zj1BKGEseWIoZSxkKSksZi5zZWxlY3Rvcj1hfXJldHVybiBmfSxpPWdiLnNlbGVjdD1mdW5jdGlvbihhLGIsZSxmKXt2YXIgaSxqLGssbCxtLG49ImZ1bmN0aW9uIj09dHlwZW9mIGEmJmEsbz0hZiYmZyhhPW4uc2VsZWN0b3J8fGEpO2lmKGU9ZXx8W10sMT09PW8ubGVuZ3RoKXtpZihqPW9bMF09b1swXS5zbGljZSgwKSxqLmxlbmd0aD4yJiYiSUQiPT09KGs9alswXSkudHlwZSYmYy5nZXRCeUlkJiY5PT09Yi5ub2RlVHlwZSYmcCYmZC5yZWxhdGl2ZVtqWzFdLnR5cGVdKXtpZihiPShkLmZpbmQuSUQoay5tYXRjaGVzWzBdLnJlcGxhY2UoY2IsZGIpLGIpfHxbXSlbMF0sIWIpcmV0dXJuIGU7biYmKGI9Yi5wYXJlbnROb2RlKSxhPWEuc2xpY2Uoai5zaGlmdCgpLnZhbHVlLmxlbmd0aCl9aT1YLm5lZWRzQ29udGV4dC50ZXN0KGEpPzA6ai5sZW5ndGg7d2hpbGUoaS0tKXtpZihrPWpbaV0sZC5yZWxhdGl2ZVtsPWsudHlwZV0pYnJlYWs7aWYoKG09ZC5maW5kW2xdKSYmKGY9bShrLm1hdGNoZXNbMF0ucmVwbGFjZShjYixkYiksYWIudGVzdChqWzBdLnR5cGUpJiZwYihiLnBhcmVudE5vZGUpfHxiKSkpe2lmKGouc3BsaWNlKGksMSksYT1mLmxlbmd0aCYmcmIoaiksIWEpcmV0dXJuIEguYXBwbHkoZSxmKSxlO2JyZWFrfX19cmV0dXJuKG58fGgoYSxvKSkoZixiLCFwLGUsYWIudGVzdChhKSYmcGIoYi5wYXJlbnROb2RlKXx8YiksZX0sYy5zb3J0U3RhYmxlPXUuc3BsaXQoIiIpLnNvcnQoQikuam9pbigiIik9PT11LGMuZGV0ZWN0RHVwbGljYXRlcz0hIWwsbSgpLGMuc29ydERldGFjaGVkPWpiKGZ1bmN0aW9uKGEpe3JldHVybiAxJmEuY29tcGFyZURvY3VtZW50UG9zaXRpb24obi5jcmVhdGVFbGVtZW50KCJkaXYiKSl9KSxqYihmdW5jdGlvbihhKXtyZXR1cm4gYS5pbm5lckhUTUw9IjxhIGhyZWY9JyMnPjwvYT4iLCIjIj09PWEuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoImhyZWYiKX0pfHxrYigidHlwZXxocmVmfGhlaWdodHx3aWR0aCIsZnVuY3Rpb24oYSxiLGMpe3JldHVybiBjP3ZvaWQgMDphLmdldEF0dHJpYnV0ZShiLCJ0eXBlIj09PWIudG9Mb3dlckNhc2UoKT8xOjIpfSksYy5hdHRyaWJ1dGVzJiZqYihmdW5jdGlvbihhKXtyZXR1cm4gYS5pbm5lckhUTUw9IjxpbnB1dC8+IixhLmZpcnN0Q2hpbGQuc2V0QXR0cmlidXRlKCJ2YWx1ZSIsIiIpLCIiPT09YS5maXJzdENoaWxkLmdldEF0dHJpYnV0ZSgidmFsdWUiKX0pfHxrYigidmFsdWUiLGZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gY3x8ImlucHV0IiE9PWEubm9kZU5hbWUudG9Mb3dlckNhc2UoKT92b2lkIDA6YS5kZWZhdWx0VmFsdWV9KSxqYihmdW5jdGlvbihhKXtyZXR1cm4gbnVsbD09YS5nZXRBdHRyaWJ1dGUoImRpc2FibGVkIil9KXx8a2IoSyxmdW5jdGlvbihhLGIsYyl7dmFyIGQ7cmV0dXJuIGM/dm9pZCAwOmFbYl09PT0hMD9iLnRvTG93ZXJDYXNlKCk6KGQ9YS5nZXRBdHRyaWJ1dGVOb2RlKGIpKSYmZC5zcGVjaWZpZWQ/ZC52YWx1ZTpudWxsfSksZ2J9KGEpO24uZmluZD10LG4uZXhwcj10LnNlbGVjdG9ycyxuLmV4cHJbIjoiXT1uLmV4cHIucHNldWRvcyxuLnVuaXF1ZT10LnVuaXF1ZVNvcnQsbi50ZXh0PXQuZ2V0VGV4dCxuLmlzWE1MRG9jPXQuaXNYTUwsbi5jb250YWlucz10LmNvbnRhaW5zO3ZhciB1PW4uZXhwci5tYXRjaC5uZWVkc0NvbnRleHQsdj0vXjwoXHcrKVxzKlwvPz4oPzo8XC9cMT58KSQvLHc9L14uW146I1xbXC4sXSokLztmdW5jdGlvbiB4KGEsYixjKXtpZihuLmlzRnVuY3Rpb24oYikpcmV0dXJuIG4uZ3JlcChhLGZ1bmN0aW9uKGEsZCl7cmV0dXJuISFiLmNhbGwoYSxkLGEpIT09Y30pO2lmKGIubm9kZVR5cGUpcmV0dXJuIG4uZ3JlcChhLGZ1bmN0aW9uKGEpe3JldHVybiBhPT09YiE9PWN9KTtpZigic3RyaW5nIj09dHlwZW9mIGIpe2lmKHcudGVzdChiKSlyZXR1cm4gbi5maWx0ZXIoYixhLGMpO2I9bi5maWx0ZXIoYixhKX1yZXR1cm4gbi5ncmVwKGEsZnVuY3Rpb24oYSl7cmV0dXJuIGcuY2FsbChiLGEpPj0wIT09Y30pfW4uZmlsdGVyPWZ1bmN0aW9uKGEsYixjKXt2YXIgZD1iWzBdO3JldHVybiBjJiYoYT0iOm5vdCgiK2ErIikiKSwxPT09Yi5sZW5ndGgmJjE9PT1kLm5vZGVUeXBlP24uZmluZC5tYXRjaGVzU2VsZWN0b3IoZCxhKT9bZF06W106bi5maW5kLm1hdGNoZXMoYSxuLmdyZXAoYixmdW5jdGlvbihhKXtyZXR1cm4gMT09PWEubm9kZVR5cGV9KSl9LG4uZm4uZXh0ZW5kKHtmaW5kOmZ1bmN0aW9uKGEpe3ZhciBiLGM9dGhpcy5sZW5ndGgsZD1bXSxlPXRoaXM7aWYoInN0cmluZyIhPXR5cGVvZiBhKXJldHVybiB0aGlzLnB1c2hTdGFjayhuKGEpLmZpbHRlcihmdW5jdGlvbigpe2ZvcihiPTA7Yz5iO2IrKylpZihuLmNvbnRhaW5zKGVbYl0sdGhpcykpcmV0dXJuITB9KSk7Zm9yKGI9MDtjPmI7YisrKW4uZmluZChhLGVbYl0sZCk7cmV0dXJuIGQ9dGhpcy5wdXNoU3RhY2soYz4xP24udW5pcXVlKGQpOmQpLGQuc2VsZWN0b3I9dGhpcy5zZWxlY3Rvcj90aGlzLnNlbGVjdG9yKyIgIithOmEsZH0sZmlsdGVyOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnB1c2hTdGFjayh4KHRoaXMsYXx8W10sITEpKX0sbm90OmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnB1c2hTdGFjayh4KHRoaXMsYXx8W10sITApKX0saXM6ZnVuY3Rpb24oYSl7cmV0dXJuISF4KHRoaXMsInN0cmluZyI9PXR5cGVvZiBhJiZ1LnRlc3QoYSk/bihhKTphfHxbXSwhMSkubGVuZ3RofX0pO3ZhciB5LHo9L14oPzpccyooPFtcd1xXXSs+KVtePl0qfCMoW1x3LV0qKSkkLyxBPW4uZm4uaW5pdD1mdW5jdGlvbihhLGIpe3ZhciBjLGQ7aWYoIWEpcmV0dXJuIHRoaXM7aWYoInN0cmluZyI9PXR5cGVvZiBhKXtpZihjPSI8Ij09PWFbMF0mJiI+Ij09PWFbYS5sZW5ndGgtMV0mJmEubGVuZ3RoPj0zP1tudWxsLGEsbnVsbF06ei5leGVjKGEpLCFjfHwhY1sxXSYmYilyZXR1cm4hYnx8Yi5qcXVlcnk/KGJ8fHkpLmZpbmQoYSk6dGhpcy5jb25zdHJ1Y3RvcihiKS5maW5kKGEpO2lmKGNbMV0pe2lmKGI9YiBpbnN0YW5jZW9mIG4/YlswXTpiLG4ubWVyZ2UodGhpcyxuLnBhcnNlSFRNTChjWzFdLGImJmIubm9kZVR5cGU/Yi5vd25lckRvY3VtZW50fHxiOmwsITApKSx2LnRlc3QoY1sxXSkmJm4uaXNQbGFpbk9iamVjdChiKSlmb3IoYyBpbiBiKW4uaXNGdW5jdGlvbih0aGlzW2NdKT90aGlzW2NdKGJbY10pOnRoaXMuYXR0cihjLGJbY10pO3JldHVybiB0aGlzfXJldHVybiBkPWwuZ2V0RWxlbWVudEJ5SWQoY1syXSksZCYmZC5wYXJlbnROb2RlJiYodGhpcy5sZW5ndGg9MSx0aGlzWzBdPWQpLHRoaXMuY29udGV4dD1sLHRoaXMuc2VsZWN0b3I9YSx0aGlzfXJldHVybiBhLm5vZGVUeXBlPyh0aGlzLmNvbnRleHQ9dGhpc1swXT1hLHRoaXMubGVuZ3RoPTEsdGhpcyk6bi5pc0Z1bmN0aW9uKGEpPyJ1bmRlZmluZWQiIT10eXBlb2YgeS5yZWFkeT95LnJlYWR5KGEpOmEobik6KHZvaWQgMCE9PWEuc2VsZWN0b3ImJih0aGlzLnNlbGVjdG9yPWEuc2VsZWN0b3IsdGhpcy5jb250ZXh0PWEuY29udGV4dCksbi5tYWtlQXJyYXkoYSx0aGlzKSl9O0EucHJvdG90eXBlPW4uZm4seT1uKGwpO3ZhciBCPS9eKD86cGFyZW50c3xwcmV2KD86VW50aWx8QWxsKSkvLEM9e2NoaWxkcmVuOiEwLGNvbnRlbnRzOiEwLG5leHQ6ITAscHJldjohMH07bi5leHRlbmQoe2RpcjpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9W10sZT12b2lkIDAhPT1jO3doaWxlKChhPWFbYl0pJiY5IT09YS5ub2RlVHlwZSlpZigxPT09YS5ub2RlVHlwZSl7aWYoZSYmbihhKS5pcyhjKSlicmVhaztkLnB1c2goYSl9cmV0dXJuIGR9LHNpYmxpbmc6ZnVuY3Rpb24oYSxiKXtmb3IodmFyIGM9W107YTthPWEubmV4dFNpYmxpbmcpMT09PWEubm9kZVR5cGUmJmEhPT1iJiZjLnB1c2goYSk7cmV0dXJuIGN9fSksbi5mbi5leHRlbmQoe2hhczpmdW5jdGlvbihhKXt2YXIgYj1uKGEsdGhpcyksYz1iLmxlbmd0aDtyZXR1cm4gdGhpcy5maWx0ZXIoZnVuY3Rpb24oKXtmb3IodmFyIGE9MDtjPmE7YSsrKWlmKG4uY29udGFpbnModGhpcyxiW2FdKSlyZXR1cm4hMH0pfSxjbG9zZXN0OmZ1bmN0aW9uKGEsYil7Zm9yKHZhciBjLGQ9MCxlPXRoaXMubGVuZ3RoLGY9W10sZz11LnRlc3QoYSl8fCJzdHJpbmciIT10eXBlb2YgYT9uKGEsYnx8dGhpcy5jb250ZXh0KTowO2U+ZDtkKyspZm9yKGM9dGhpc1tkXTtjJiZjIT09YjtjPWMucGFyZW50Tm9kZSlpZihjLm5vZGVUeXBlPDExJiYoZz9nLmluZGV4KGMpPi0xOjE9PT1jLm5vZGVUeXBlJiZuLmZpbmQubWF0Y2hlc1NlbGVjdG9yKGMsYSkpKXtmLnB1c2goYyk7YnJlYWt9cmV0dXJuIHRoaXMucHVzaFN0YWNrKGYubGVuZ3RoPjE/bi51bmlxdWUoZik6Zil9LGluZGV4OmZ1bmN0aW9uKGEpe3JldHVybiBhPyJzdHJpbmciPT10eXBlb2YgYT9nLmNhbGwobihhKSx0aGlzWzBdKTpnLmNhbGwodGhpcyxhLmpxdWVyeT9hWzBdOmEpOnRoaXNbMF0mJnRoaXNbMF0ucGFyZW50Tm9kZT90aGlzLmZpcnN0KCkucHJldkFsbCgpLmxlbmd0aDotMX0sYWRkOmZ1bmN0aW9uKGEsYil7cmV0dXJuIHRoaXMucHVzaFN0YWNrKG4udW5pcXVlKG4ubWVyZ2UodGhpcy5nZXQoKSxuKGEsYikpKSl9LGFkZEJhY2s6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuYWRkKG51bGw9PWE/dGhpcy5wcmV2T2JqZWN0OnRoaXMucHJldk9iamVjdC5maWx0ZXIoYSkpfX0pO2Z1bmN0aW9uIEQoYSxiKXt3aGlsZSgoYT1hW2JdKSYmMSE9PWEubm9kZVR5cGUpO3JldHVybiBhfW4uZWFjaCh7cGFyZW50OmZ1bmN0aW9uKGEpe3ZhciBiPWEucGFyZW50Tm9kZTtyZXR1cm4gYiYmMTEhPT1iLm5vZGVUeXBlP2I6bnVsbH0scGFyZW50czpmdW5jdGlvbihhKXtyZXR1cm4gbi5kaXIoYSwicGFyZW50Tm9kZSIpfSxwYXJlbnRzVW50aWw6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBuLmRpcihhLCJwYXJlbnROb2RlIixjKX0sbmV4dDpmdW5jdGlvbihhKXtyZXR1cm4gRChhLCJuZXh0U2libGluZyIpfSxwcmV2OmZ1bmN0aW9uKGEpe3JldHVybiBEKGEsInByZXZpb3VzU2libGluZyIpfSxuZXh0QWxsOmZ1bmN0aW9uKGEpe3JldHVybiBuLmRpcihhLCJuZXh0U2libGluZyIpfSxwcmV2QWxsOmZ1bmN0aW9uKGEpe3JldHVybiBuLmRpcihhLCJwcmV2aW91c1NpYmxpbmciKX0sbmV4dFVudGlsOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gbi5kaXIoYSwibmV4dFNpYmxpbmciLGMpfSxwcmV2VW50aWw6ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBuLmRpcihhLCJwcmV2aW91c1NpYmxpbmciLGMpfSxzaWJsaW5nczpmdW5jdGlvbihhKXtyZXR1cm4gbi5zaWJsaW5nKChhLnBhcmVudE5vZGV8fHt9KS5maXJzdENoaWxkLGEpfSxjaGlsZHJlbjpmdW5jdGlvbihhKXtyZXR1cm4gbi5zaWJsaW5nKGEuZmlyc3RDaGlsZCl9LGNvbnRlbnRzOmZ1bmN0aW9uKGEpe3JldHVybiBhLmNvbnRlbnREb2N1bWVudHx8bi5tZXJnZShbXSxhLmNoaWxkTm9kZXMpfX0sZnVuY3Rpb24oYSxiKXtuLmZuW2FdPWZ1bmN0aW9uKGMsZCl7dmFyIGU9bi5tYXAodGhpcyxiLGMpO3JldHVybiJVbnRpbCIhPT1hLnNsaWNlKC01KSYmKGQ9YyksZCYmInN0cmluZyI9PXR5cGVvZiBkJiYoZT1uLmZpbHRlcihkLGUpKSx0aGlzLmxlbmd0aD4xJiYoQ1thXXx8bi51bmlxdWUoZSksQi50ZXN0KGEpJiZlLnJldmVyc2UoKSksdGhpcy5wdXNoU3RhY2soZSl9fSk7dmFyIEU9L1xTKy9nLEY9e307ZnVuY3Rpb24gRyhhKXt2YXIgYj1GW2FdPXt9O3JldHVybiBuLmVhY2goYS5tYXRjaChFKXx8W10sZnVuY3Rpb24oYSxjKXtiW2NdPSEwfSksYn1uLkNhbGxiYWNrcz1mdW5jdGlvbihhKXthPSJzdHJpbmciPT10eXBlb2YgYT9GW2FdfHxHKGEpOm4uZXh0ZW5kKHt9LGEpO3ZhciBiLGMsZCxlLGYsZyxoPVtdLGk9IWEub25jZSYmW10saj1mdW5jdGlvbihsKXtmb3IoYj1hLm1lbW9yeSYmbCxjPSEwLGc9ZXx8MCxlPTAsZj1oLmxlbmd0aCxkPSEwO2gmJmY+ZztnKyspaWYoaFtnXS5hcHBseShsWzBdLGxbMV0pPT09ITEmJmEuc3RvcE9uRmFsc2Upe2I9ITE7YnJlYWt9ZD0hMSxoJiYoaT9pLmxlbmd0aCYmaihpLnNoaWZ0KCkpOmI/aD1bXTprLmRpc2FibGUoKSl9LGs9e2FkZDpmdW5jdGlvbigpe2lmKGgpe3ZhciBjPWgubGVuZ3RoOyFmdW5jdGlvbiBnKGIpe24uZWFjaChiLGZ1bmN0aW9uKGIsYyl7dmFyIGQ9bi50eXBlKGMpOyJmdW5jdGlvbiI9PT1kP2EudW5pcXVlJiZrLmhhcyhjKXx8aC5wdXNoKGMpOmMmJmMubGVuZ3RoJiYic3RyaW5nIiE9PWQmJmcoYyl9KX0oYXJndW1lbnRzKSxkP2Y9aC5sZW5ndGg6YiYmKGU9YyxqKGIpKX1yZXR1cm4gdGhpc30scmVtb3ZlOmZ1bmN0aW9uKCl7cmV0dXJuIGgmJm4uZWFjaChhcmd1bWVudHMsZnVuY3Rpb24oYSxiKXt2YXIgYzt3aGlsZSgoYz1uLmluQXJyYXkoYixoLGMpKT4tMSloLnNwbGljZShjLDEpLGQmJihmPj1jJiZmLS0sZz49YyYmZy0tKX0pLHRoaXN9LGhhczpmdW5jdGlvbihhKXtyZXR1cm4gYT9uLmluQXJyYXkoYSxoKT4tMTohKCFofHwhaC5sZW5ndGgpfSxlbXB0eTpmdW5jdGlvbigpe3JldHVybiBoPVtdLGY9MCx0aGlzfSxkaXNhYmxlOmZ1bmN0aW9uKCl7cmV0dXJuIGg9aT1iPXZvaWQgMCx0aGlzfSxkaXNhYmxlZDpmdW5jdGlvbigpe3JldHVybiFofSxsb2NrOmZ1bmN0aW9uKCl7cmV0dXJuIGk9dm9pZCAwLGJ8fGsuZGlzYWJsZSgpLHRoaXN9LGxvY2tlZDpmdW5jdGlvbigpe3JldHVybiFpfSxmaXJlV2l0aDpmdW5jdGlvbihhLGIpe3JldHVybiFofHxjJiYhaXx8KGI9Ynx8W10sYj1bYSxiLnNsaWNlP2Iuc2xpY2UoKTpiXSxkP2kucHVzaChiKTpqKGIpKSx0aGlzfSxmaXJlOmZ1bmN0aW9uKCl7cmV0dXJuIGsuZmlyZVdpdGgodGhpcyxhcmd1bWVudHMpLHRoaXN9LGZpcmVkOmZ1bmN0aW9uKCl7cmV0dXJuISFjfX07cmV0dXJuIGt9LG4uZXh0ZW5kKHtEZWZlcnJlZDpmdW5jdGlvbihhKXt2YXIgYj1bWyJyZXNvbHZlIiwiZG9uZSIsbi5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IiksInJlc29sdmVkIl0sWyJyZWplY3QiLCJmYWlsIixuLkNhbGxiYWNrcygib25jZSBtZW1vcnkiKSwicmVqZWN0ZWQiXSxbIm5vdGlmeSIsInByb2dyZXNzIixuLkNhbGxiYWNrcygibWVtb3J5IildXSxjPSJwZW5kaW5nIixkPXtzdGF0ZTpmdW5jdGlvbigpe3JldHVybiBjfSxhbHdheXM6ZnVuY3Rpb24oKXtyZXR1cm4gZS5kb25lKGFyZ3VtZW50cykuZmFpbChhcmd1bWVudHMpLHRoaXN9LHRoZW46ZnVuY3Rpb24oKXt2YXIgYT1hcmd1bWVudHM7cmV0dXJuIG4uRGVmZXJyZWQoZnVuY3Rpb24oYyl7bi5lYWNoKGIsZnVuY3Rpb24oYixmKXt2YXIgZz1uLmlzRnVuY3Rpb24oYVtiXSkmJmFbYl07ZVtmWzFdXShmdW5jdGlvbigpe3ZhciBhPWcmJmcuYXBwbHkodGhpcyxhcmd1bWVudHMpO2EmJm4uaXNGdW5jdGlvbihhLnByb21pc2UpP2EucHJvbWlzZSgpLmRvbmUoYy5yZXNvbHZlKS5mYWlsKGMucmVqZWN0KS5wcm9ncmVzcyhjLm5vdGlmeSk6Y1tmWzBdKyJXaXRoIl0odGhpcz09PWQ/Yy5wcm9taXNlKCk6dGhpcyxnP1thXTphcmd1bWVudHMpfSl9KSxhPW51bGx9KS5wcm9taXNlKCl9LHByb21pc2U6ZnVuY3Rpb24oYSl7cmV0dXJuIG51bGwhPWE/bi5leHRlbmQoYSxkKTpkfX0sZT17fTtyZXR1cm4gZC5waXBlPWQudGhlbixuLmVhY2goYixmdW5jdGlvbihhLGYpe3ZhciBnPWZbMl0saD1mWzNdO2RbZlsxXV09Zy5hZGQsaCYmZy5hZGQoZnVuY3Rpb24oKXtjPWh9LGJbMV5hXVsyXS5kaXNhYmxlLGJbMl1bMl0ubG9jayksZVtmWzBdXT1mdW5jdGlvbigpe3JldHVybiBlW2ZbMF0rIldpdGgiXSh0aGlzPT09ZT9kOnRoaXMsYXJndW1lbnRzKSx0aGlzfSxlW2ZbMF0rIldpdGgiXT1nLmZpcmVXaXRofSksZC5wcm9taXNlKGUpLGEmJmEuY2FsbChlLGUpLGV9LHdoZW46ZnVuY3Rpb24oYSl7dmFyIGI9MCxjPWQuY2FsbChhcmd1bWVudHMpLGU9Yy5sZW5ndGgsZj0xIT09ZXx8YSYmbi5pc0Z1bmN0aW9uKGEucHJvbWlzZSk/ZTowLGc9MT09PWY/YTpuLkRlZmVycmVkKCksaD1mdW5jdGlvbihhLGIsYyl7cmV0dXJuIGZ1bmN0aW9uKGUpe2JbYV09dGhpcyxjW2FdPWFyZ3VtZW50cy5sZW5ndGg+MT9kLmNhbGwoYXJndW1lbnRzKTplLGM9PT1pP2cubm90aWZ5V2l0aChiLGMpOi0tZnx8Zy5yZXNvbHZlV2l0aChiLGMpfX0saSxqLGs7aWYoZT4xKWZvcihpPW5ldyBBcnJheShlKSxqPW5ldyBBcnJheShlKSxrPW5ldyBBcnJheShlKTtlPmI7YisrKWNbYl0mJm4uaXNGdW5jdGlvbihjW2JdLnByb21pc2UpP2NbYl0ucHJvbWlzZSgpLmRvbmUoaChiLGssYykpLmZhaWwoZy5yZWplY3QpLnByb2dyZXNzKGgoYixqLGkpKTotLWY7cmV0dXJuIGZ8fGcucmVzb2x2ZVdpdGgoayxjKSxnLnByb21pc2UoKX19KTt2YXIgSDtuLmZuLnJlYWR5PWZ1bmN0aW9uKGEpe3JldHVybiBuLnJlYWR5LnByb21pc2UoKS5kb25lKGEpLHRoaXN9LG4uZXh0ZW5kKHtpc1JlYWR5OiExLHJlYWR5V2FpdDoxLGhvbGRSZWFkeTpmdW5jdGlvbihhKXthP24ucmVhZHlXYWl0Kys6bi5yZWFkeSghMCl9LHJlYWR5OmZ1bmN0aW9uKGEpeyhhPT09ITA/LS1uLnJlYWR5V2FpdDpuLmlzUmVhZHkpfHwobi5pc1JlYWR5PSEwLGEhPT0hMCYmLS1uLnJlYWR5V2FpdD4wfHwoSC5yZXNvbHZlV2l0aChsLFtuXSksbi5mbi50cmlnZ2VySGFuZGxlciYmKG4obCkudHJpZ2dlckhhbmRsZXIoInJlYWR5IiksbihsKS5vZmYoInJlYWR5IikpKSl9fSk7ZnVuY3Rpb24gSSgpe2wucmVtb3ZlRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsSSwhMSksYS5yZW1vdmVFdmVudExpc3RlbmVyKCJsb2FkIixJLCExKSxuLnJlYWR5KCl9bi5yZWFkeS5wcm9taXNlPWZ1bmN0aW9uKGIpe3JldHVybiBIfHwoSD1uLkRlZmVycmVkKCksImNvbXBsZXRlIj09PWwucmVhZHlTdGF0ZT9zZXRUaW1lb3V0KG4ucmVhZHkpOihsLmFkZEV2ZW50TGlzdGVuZXIoIkRPTUNvbnRlbnRMb2FkZWQiLEksITEpLGEuYWRkRXZlbnRMaXN0ZW5lcigibG9hZCIsSSwhMSkpKSxILnByb21pc2UoYil9LG4ucmVhZHkucHJvbWlzZSgpO3ZhciBKPW4uYWNjZXNzPWZ1bmN0aW9uKGEsYixjLGQsZSxmLGcpe3ZhciBoPTAsaT1hLmxlbmd0aCxqPW51bGw9PWM7aWYoIm9iamVjdCI9PT1uLnR5cGUoYykpe2U9ITA7Zm9yKGggaW4gYyluLmFjY2VzcyhhLGIsaCxjW2hdLCEwLGYsZyl9ZWxzZSBpZih2b2lkIDAhPT1kJiYoZT0hMCxuLmlzRnVuY3Rpb24oZCl8fChnPSEwKSxqJiYoZz8oYi5jYWxsKGEsZCksYj1udWxsKTooaj1iLGI9ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBqLmNhbGwobihhKSxjKX0pKSxiKSlmb3IoO2k+aDtoKyspYihhW2hdLGMsZz9kOmQuY2FsbChhW2hdLGgsYihhW2hdLGMpKSk7cmV0dXJuIGU/YTpqP2IuY2FsbChhKTppP2IoYVswXSxjKTpmfTtuLmFjY2VwdERhdGE9ZnVuY3Rpb24oYSl7cmV0dXJuIDE9PT1hLm5vZGVUeXBlfHw5PT09YS5ub2RlVHlwZXx8ISthLm5vZGVUeXBlfTtmdW5jdGlvbiBLKCl7T2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMuY2FjaGU9e30sMCx7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJue319fSksdGhpcy5leHBhbmRvPW4uZXhwYW5kbytLLnVpZCsrfUsudWlkPTEsSy5hY2NlcHRzPW4uYWNjZXB0RGF0YSxLLnByb3RvdHlwZT17a2V5OmZ1bmN0aW9uKGEpe2lmKCFLLmFjY2VwdHMoYSkpcmV0dXJuIDA7dmFyIGI9e30sYz1hW3RoaXMuZXhwYW5kb107aWYoIWMpe2M9Sy51aWQrKzt0cnl7Ylt0aGlzLmV4cGFuZG9dPXt2YWx1ZTpjfSxPYmplY3QuZGVmaW5lUHJvcGVydGllcyhhLGIpfWNhdGNoKGQpe2JbdGhpcy5leHBhbmRvXT1jLG4uZXh0ZW5kKGEsYil9fXJldHVybiB0aGlzLmNhY2hlW2NdfHwodGhpcy5jYWNoZVtjXT17fSksY30sc2V0OmZ1bmN0aW9uKGEsYixjKXt2YXIgZCxlPXRoaXMua2V5KGEpLGY9dGhpcy5jYWNoZVtlXTtpZigic3RyaW5nIj09dHlwZW9mIGIpZltiXT1jO2Vsc2UgaWYobi5pc0VtcHR5T2JqZWN0KGYpKW4uZXh0ZW5kKHRoaXMuY2FjaGVbZV0sYik7ZWxzZSBmb3IoZCBpbiBiKWZbZF09YltkXTtyZXR1cm4gZn0sZ2V0OmZ1bmN0aW9uKGEsYil7dmFyIGM9dGhpcy5jYWNoZVt0aGlzLmtleShhKV07cmV0dXJuIHZvaWQgMD09PWI/YzpjW2JdfSxhY2Nlc3M6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkO3JldHVybiB2b2lkIDA9PT1ifHxiJiYic3RyaW5nIj09dHlwZW9mIGImJnZvaWQgMD09PWM/KGQ9dGhpcy5nZXQoYSxiKSx2b2lkIDAhPT1kP2Q6dGhpcy5nZXQoYSxuLmNhbWVsQ2FzZShiKSkpOih0aGlzLnNldChhLGIsYyksdm9pZCAwIT09Yz9jOmIpfSxyZW1vdmU6ZnVuY3Rpb24oYSxiKXt2YXIgYyxkLGUsZj10aGlzLmtleShhKSxnPXRoaXMuY2FjaGVbZl07aWYodm9pZCAwPT09Yil0aGlzLmNhY2hlW2ZdPXt9O2Vsc2V7bi5pc0FycmF5KGIpP2Q9Yi5jb25jYXQoYi5tYXAobi5jYW1lbENhc2UpKTooZT1uLmNhbWVsQ2FzZShiKSxiIGluIGc/ZD1bYixlXTooZD1lLGQ9ZCBpbiBnP1tkXTpkLm1hdGNoKEUpfHxbXSkpLGM9ZC5sZW5ndGg7d2hpbGUoYy0tKWRlbGV0ZSBnW2RbY11dfX0saGFzRGF0YTpmdW5jdGlvbihhKXtyZXR1cm4hbi5pc0VtcHR5T2JqZWN0KHRoaXMuY2FjaGVbYVt0aGlzLmV4cGFuZG9dXXx8e30pfSxkaXNjYXJkOmZ1bmN0aW9uKGEpe2FbdGhpcy5leHBhbmRvXSYmZGVsZXRlIHRoaXMuY2FjaGVbYVt0aGlzLmV4cGFuZG9dXX19O3ZhciBMPW5ldyBLLE09bmV3IEssTj0vXig/Olx7W1x3XFddKlx9fFxbW1x3XFddKlxdKSQvLE89LyhbQS1aXSkvZztmdW5jdGlvbiBQKGEsYixjKXt2YXIgZDtpZih2b2lkIDA9PT1jJiYxPT09YS5ub2RlVHlwZSlpZihkPSJkYXRhLSIrYi5yZXBsYWNlKE8sIi0kMSIpLnRvTG93ZXJDYXNlKCksYz1hLmdldEF0dHJpYnV0ZShkKSwic3RyaW5nIj09dHlwZW9mIGMpe3RyeXtjPSJ0cnVlIj09PWM/ITA6ImZhbHNlIj09PWM/ITE6Im51bGwiPT09Yz9udWxsOitjKyIiPT09Yz8rYzpOLnRlc3QoYyk/bi5wYXJzZUpTT04oYyk6Y31jYXRjaChlKXt9TS5zZXQoYSxiLGMpfWVsc2UgYz12b2lkIDA7cmV0dXJuIGN9bi5leHRlbmQoe2hhc0RhdGE6ZnVuY3Rpb24oYSl7cmV0dXJuIE0uaGFzRGF0YShhKXx8TC5oYXNEYXRhKGEpfSxkYXRhOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gTS5hY2Nlc3MoYSxiLGMpCn0scmVtb3ZlRGF0YTpmdW5jdGlvbihhLGIpe00ucmVtb3ZlKGEsYil9LF9kYXRhOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gTC5hY2Nlc3MoYSxiLGMpfSxfcmVtb3ZlRGF0YTpmdW5jdGlvbihhLGIpe0wucmVtb3ZlKGEsYil9fSksbi5mbi5leHRlbmQoe2RhdGE6ZnVuY3Rpb24oYSxiKXt2YXIgYyxkLGUsZj10aGlzWzBdLGc9ZiYmZi5hdHRyaWJ1dGVzO2lmKHZvaWQgMD09PWEpe2lmKHRoaXMubGVuZ3RoJiYoZT1NLmdldChmKSwxPT09Zi5ub2RlVHlwZSYmIUwuZ2V0KGYsImhhc0RhdGFBdHRycyIpKSl7Yz1nLmxlbmd0aDt3aGlsZShjLS0pZ1tjXSYmKGQ9Z1tjXS5uYW1lLDA9PT1kLmluZGV4T2YoImRhdGEtIikmJihkPW4uY2FtZWxDYXNlKGQuc2xpY2UoNSkpLFAoZixkLGVbZF0pKSk7TC5zZXQoZiwiaGFzRGF0YUF0dHJzIiwhMCl9cmV0dXJuIGV9cmV0dXJuIm9iamVjdCI9PXR5cGVvZiBhP3RoaXMuZWFjaChmdW5jdGlvbigpe00uc2V0KHRoaXMsYSl9KTpKKHRoaXMsZnVuY3Rpb24oYil7dmFyIGMsZD1uLmNhbWVsQ2FzZShhKTtpZihmJiZ2b2lkIDA9PT1iKXtpZihjPU0uZ2V0KGYsYSksdm9pZCAwIT09YylyZXR1cm4gYztpZihjPU0uZ2V0KGYsZCksdm9pZCAwIT09YylyZXR1cm4gYztpZihjPVAoZixkLHZvaWQgMCksdm9pZCAwIT09YylyZXR1cm4gY31lbHNlIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBjPU0uZ2V0KHRoaXMsZCk7TS5zZXQodGhpcyxkLGIpLC0xIT09YS5pbmRleE9mKCItIikmJnZvaWQgMCE9PWMmJk0uc2V0KHRoaXMsYSxiKX0pfSxudWxsLGIsYXJndW1lbnRzLmxlbmd0aD4xLG51bGwsITApfSxyZW1vdmVEYXRhOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtNLnJlbW92ZSh0aGlzLGEpfSl9fSksbi5leHRlbmQoe3F1ZXVlOmZ1bmN0aW9uKGEsYixjKXt2YXIgZDtyZXR1cm4gYT8oYj0oYnx8ImZ4IikrInF1ZXVlIixkPUwuZ2V0KGEsYiksYyYmKCFkfHxuLmlzQXJyYXkoYyk/ZD1MLmFjY2VzcyhhLGIsbi5tYWtlQXJyYXkoYykpOmQucHVzaChjKSksZHx8W10pOnZvaWQgMH0sZGVxdWV1ZTpmdW5jdGlvbihhLGIpe2I9Ynx8ImZ4Ijt2YXIgYz1uLnF1ZXVlKGEsYiksZD1jLmxlbmd0aCxlPWMuc2hpZnQoKSxmPW4uX3F1ZXVlSG9va3MoYSxiKSxnPWZ1bmN0aW9uKCl7bi5kZXF1ZXVlKGEsYil9OyJpbnByb2dyZXNzIj09PWUmJihlPWMuc2hpZnQoKSxkLS0pLGUmJigiZngiPT09YiYmYy51bnNoaWZ0KCJpbnByb2dyZXNzIiksZGVsZXRlIGYuc3RvcCxlLmNhbGwoYSxnLGYpKSwhZCYmZiYmZi5lbXB0eS5maXJlKCl9LF9xdWV1ZUhvb2tzOmZ1bmN0aW9uKGEsYil7dmFyIGM9YisicXVldWVIb29rcyI7cmV0dXJuIEwuZ2V0KGEsYyl8fEwuYWNjZXNzKGEsYyx7ZW1wdHk6bi5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IikuYWRkKGZ1bmN0aW9uKCl7TC5yZW1vdmUoYSxbYisicXVldWUiLGNdKX0pfSl9fSksbi5mbi5leHRlbmQoe3F1ZXVlOmZ1bmN0aW9uKGEsYil7dmFyIGM9MjtyZXR1cm4ic3RyaW5nIiE9dHlwZW9mIGEmJihiPWEsYT0iZngiLGMtLSksYXJndW1lbnRzLmxlbmd0aDxjP24ucXVldWUodGhpc1swXSxhKTp2b2lkIDA9PT1iP3RoaXM6dGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGM9bi5xdWV1ZSh0aGlzLGEsYik7bi5fcXVldWVIb29rcyh0aGlzLGEpLCJmeCI9PT1hJiYiaW5wcm9ncmVzcyIhPT1jWzBdJiZuLmRlcXVldWUodGhpcyxhKX0pfSxkZXF1ZXVlOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtuLmRlcXVldWUodGhpcyxhKX0pfSxjbGVhclF1ZXVlOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnF1ZXVlKGF8fCJmeCIsW10pfSxwcm9taXNlOmZ1bmN0aW9uKGEsYil7dmFyIGMsZD0xLGU9bi5EZWZlcnJlZCgpLGY9dGhpcyxnPXRoaXMubGVuZ3RoLGg9ZnVuY3Rpb24oKXstLWR8fGUucmVzb2x2ZVdpdGgoZixbZl0pfTsic3RyaW5nIiE9dHlwZW9mIGEmJihiPWEsYT12b2lkIDApLGE9YXx8ImZ4Ijt3aGlsZShnLS0pYz1MLmdldChmW2ddLGErInF1ZXVlSG9va3MiKSxjJiZjLmVtcHR5JiYoZCsrLGMuZW1wdHkuYWRkKGgpKTtyZXR1cm4gaCgpLGUucHJvbWlzZShiKX19KTt2YXIgUT0vWystXT8oPzpcZCpcLnwpXGQrKD86W2VFXVsrLV0/XGQrfCkvLnNvdXJjZSxSPVsiVG9wIiwiUmlnaHQiLCJCb3R0b20iLCJMZWZ0Il0sUz1mdW5jdGlvbihhLGIpe3JldHVybiBhPWJ8fGEsIm5vbmUiPT09bi5jc3MoYSwiZGlzcGxheSIpfHwhbi5jb250YWlucyhhLm93bmVyRG9jdW1lbnQsYSl9LFQ9L14oPzpjaGVja2JveHxyYWRpbykkL2k7IWZ1bmN0aW9uKCl7dmFyIGE9bC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksYj1hLmFwcGVuZENoaWxkKGwuY3JlYXRlRWxlbWVudCgiZGl2IikpLGM9bC5jcmVhdGVFbGVtZW50KCJpbnB1dCIpO2Muc2V0QXR0cmlidXRlKCJ0eXBlIiwicmFkaW8iKSxjLnNldEF0dHJpYnV0ZSgiY2hlY2tlZCIsImNoZWNrZWQiKSxjLnNldEF0dHJpYnV0ZSgibmFtZSIsInQiKSxiLmFwcGVuZENoaWxkKGMpLGsuY2hlY2tDbG9uZT1iLmNsb25lTm9kZSghMCkuY2xvbmVOb2RlKCEwKS5sYXN0Q2hpbGQuY2hlY2tlZCxiLmlubmVySFRNTD0iPHRleHRhcmVhPng8L3RleHRhcmVhPiIsay5ub0Nsb25lQ2hlY2tlZD0hIWIuY2xvbmVOb2RlKCEwKS5sYXN0Q2hpbGQuZGVmYXVsdFZhbHVlfSgpO3ZhciBVPSJ1bmRlZmluZWQiO2suZm9jdXNpbkJ1YmJsZXM9Im9uZm9jdXNpbiJpbiBhO3ZhciBWPS9ea2V5LyxXPS9eKD86bW91c2V8cG9pbnRlcnxjb250ZXh0bWVudSl8Y2xpY2svLFg9L14oPzpmb2N1c2luZm9jdXN8Zm9jdXNvdXRibHVyKSQvLFk9L14oW14uXSopKD86XC4oLispfCkkLztmdW5jdGlvbiBaKCl7cmV0dXJuITB9ZnVuY3Rpb24gJCgpe3JldHVybiExfWZ1bmN0aW9uIF8oKXt0cnl7cmV0dXJuIGwuYWN0aXZlRWxlbWVudH1jYXRjaChhKXt9fW4uZXZlbnQ9e2dsb2JhbDp7fSxhZGQ6ZnVuY3Rpb24oYSxiLGMsZCxlKXt2YXIgZixnLGgsaSxqLGssbCxtLG8scCxxLHI9TC5nZXQoYSk7aWYocil7Yy5oYW5kbGVyJiYoZj1jLGM9Zi5oYW5kbGVyLGU9Zi5zZWxlY3RvciksYy5ndWlkfHwoYy5ndWlkPW4uZ3VpZCsrKSwoaT1yLmV2ZW50cyl8fChpPXIuZXZlbnRzPXt9KSwoZz1yLmhhbmRsZSl8fChnPXIuaGFuZGxlPWZ1bmN0aW9uKGIpe3JldHVybiB0eXBlb2YgbiE9PVUmJm4uZXZlbnQudHJpZ2dlcmVkIT09Yi50eXBlP24uZXZlbnQuZGlzcGF0Y2guYXBwbHkoYSxhcmd1bWVudHMpOnZvaWQgMH0pLGI9KGJ8fCIiKS5tYXRjaChFKXx8WyIiXSxqPWIubGVuZ3RoO3doaWxlKGotLSloPVkuZXhlYyhiW2pdKXx8W10sbz1xPWhbMV0scD0oaFsyXXx8IiIpLnNwbGl0KCIuIikuc29ydCgpLG8mJihsPW4uZXZlbnQuc3BlY2lhbFtvXXx8e30sbz0oZT9sLmRlbGVnYXRlVHlwZTpsLmJpbmRUeXBlKXx8byxsPW4uZXZlbnQuc3BlY2lhbFtvXXx8e30saz1uLmV4dGVuZCh7dHlwZTpvLG9yaWdUeXBlOnEsZGF0YTpkLGhhbmRsZXI6YyxndWlkOmMuZ3VpZCxzZWxlY3RvcjplLG5lZWRzQ29udGV4dDplJiZuLmV4cHIubWF0Y2gubmVlZHNDb250ZXh0LnRlc3QoZSksbmFtZXNwYWNlOnAuam9pbigiLiIpfSxmKSwobT1pW29dKXx8KG09aVtvXT1bXSxtLmRlbGVnYXRlQ291bnQ9MCxsLnNldHVwJiZsLnNldHVwLmNhbGwoYSxkLHAsZykhPT0hMXx8YS5hZGRFdmVudExpc3RlbmVyJiZhLmFkZEV2ZW50TGlzdGVuZXIobyxnLCExKSksbC5hZGQmJihsLmFkZC5jYWxsKGEsayksay5oYW5kbGVyLmd1aWR8fChrLmhhbmRsZXIuZ3VpZD1jLmd1aWQpKSxlP20uc3BsaWNlKG0uZGVsZWdhdGVDb3VudCsrLDAsayk6bS5wdXNoKGspLG4uZXZlbnQuZ2xvYmFsW29dPSEwKX19LHJlbW92ZTpmdW5jdGlvbihhLGIsYyxkLGUpe3ZhciBmLGcsaCxpLGosayxsLG0sbyxwLHEscj1MLmhhc0RhdGEoYSkmJkwuZ2V0KGEpO2lmKHImJihpPXIuZXZlbnRzKSl7Yj0oYnx8IiIpLm1hdGNoKEUpfHxbIiJdLGo9Yi5sZW5ndGg7d2hpbGUoai0tKWlmKGg9WS5leGVjKGJbal0pfHxbXSxvPXE9aFsxXSxwPShoWzJdfHwiIikuc3BsaXQoIi4iKS5zb3J0KCksbyl7bD1uLmV2ZW50LnNwZWNpYWxbb118fHt9LG89KGQ/bC5kZWxlZ2F0ZVR5cGU6bC5iaW5kVHlwZSl8fG8sbT1pW29dfHxbXSxoPWhbMl0mJm5ldyBSZWdFeHAoIihefFxcLikiK3Auam9pbigiXFwuKD86LipcXC58KSIpKyIoXFwufCQpIiksZz1mPW0ubGVuZ3RoO3doaWxlKGYtLSlrPW1bZl0sIWUmJnEhPT1rLm9yaWdUeXBlfHxjJiZjLmd1aWQhPT1rLmd1aWR8fGgmJiFoLnRlc3Qoay5uYW1lc3BhY2UpfHxkJiZkIT09ay5zZWxlY3RvciYmKCIqKiIhPT1kfHwhay5zZWxlY3Rvcil8fChtLnNwbGljZShmLDEpLGsuc2VsZWN0b3ImJm0uZGVsZWdhdGVDb3VudC0tLGwucmVtb3ZlJiZsLnJlbW92ZS5jYWxsKGEsaykpO2cmJiFtLmxlbmd0aCYmKGwudGVhcmRvd24mJmwudGVhcmRvd24uY2FsbChhLHAsci5oYW5kbGUpIT09ITF8fG4ucmVtb3ZlRXZlbnQoYSxvLHIuaGFuZGxlKSxkZWxldGUgaVtvXSl9ZWxzZSBmb3IobyBpbiBpKW4uZXZlbnQucmVtb3ZlKGEsbytiW2pdLGMsZCwhMCk7bi5pc0VtcHR5T2JqZWN0KGkpJiYoZGVsZXRlIHIuaGFuZGxlLEwucmVtb3ZlKGEsImV2ZW50cyIpKX19LHRyaWdnZXI6ZnVuY3Rpb24oYixjLGQsZSl7dmFyIGYsZyxoLGksayxtLG8scD1bZHx8bF0scT1qLmNhbGwoYiwidHlwZSIpP2IudHlwZTpiLHI9ai5jYWxsKGIsIm5hbWVzcGFjZSIpP2IubmFtZXNwYWNlLnNwbGl0KCIuIik6W107aWYoZz1oPWQ9ZHx8bCwzIT09ZC5ub2RlVHlwZSYmOCE9PWQubm9kZVR5cGUmJiFYLnRlc3QocStuLmV2ZW50LnRyaWdnZXJlZCkmJihxLmluZGV4T2YoIi4iKT49MCYmKHI9cS5zcGxpdCgiLiIpLHE9ci5zaGlmdCgpLHIuc29ydCgpKSxrPXEuaW5kZXhPZigiOiIpPDAmJiJvbiIrcSxiPWJbbi5leHBhbmRvXT9iOm5ldyBuLkV2ZW50KHEsIm9iamVjdCI9PXR5cGVvZiBiJiZiKSxiLmlzVHJpZ2dlcj1lPzI6MyxiLm5hbWVzcGFjZT1yLmpvaW4oIi4iKSxiLm5hbWVzcGFjZV9yZT1iLm5hbWVzcGFjZT9uZXcgUmVnRXhwKCIoXnxcXC4pIityLmpvaW4oIlxcLig/Oi4qXFwufCkiKSsiKFxcLnwkKSIpOm51bGwsYi5yZXN1bHQ9dm9pZCAwLGIudGFyZ2V0fHwoYi50YXJnZXQ9ZCksYz1udWxsPT1jP1tiXTpuLm1ha2VBcnJheShjLFtiXSksbz1uLmV2ZW50LnNwZWNpYWxbcV18fHt9LGV8fCFvLnRyaWdnZXJ8fG8udHJpZ2dlci5hcHBseShkLGMpIT09ITEpKXtpZighZSYmIW8ubm9CdWJibGUmJiFuLmlzV2luZG93KGQpKXtmb3IoaT1vLmRlbGVnYXRlVHlwZXx8cSxYLnRlc3QoaStxKXx8KGc9Zy5wYXJlbnROb2RlKTtnO2c9Zy5wYXJlbnROb2RlKXAucHVzaChnKSxoPWc7aD09PShkLm93bmVyRG9jdW1lbnR8fGwpJiZwLnB1c2goaC5kZWZhdWx0Vmlld3x8aC5wYXJlbnRXaW5kb3d8fGEpfWY9MDt3aGlsZSgoZz1wW2YrK10pJiYhYi5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpKWIudHlwZT1mPjE/aTpvLmJpbmRUeXBlfHxxLG09KEwuZ2V0KGcsImV2ZW50cyIpfHx7fSlbYi50eXBlXSYmTC5nZXQoZywiaGFuZGxlIiksbSYmbS5hcHBseShnLGMpLG09ayYmZ1trXSxtJiZtLmFwcGx5JiZuLmFjY2VwdERhdGEoZykmJihiLnJlc3VsdD1tLmFwcGx5KGcsYyksYi5yZXN1bHQ9PT0hMSYmYi5wcmV2ZW50RGVmYXVsdCgpKTtyZXR1cm4gYi50eXBlPXEsZXx8Yi5pc0RlZmF1bHRQcmV2ZW50ZWQoKXx8by5fZGVmYXVsdCYmby5fZGVmYXVsdC5hcHBseShwLnBvcCgpLGMpIT09ITF8fCFuLmFjY2VwdERhdGEoZCl8fGsmJm4uaXNGdW5jdGlvbihkW3FdKSYmIW4uaXNXaW5kb3coZCkmJihoPWRba10saCYmKGRba109bnVsbCksbi5ldmVudC50cmlnZ2VyZWQ9cSxkW3FdKCksbi5ldmVudC50cmlnZ2VyZWQ9dm9pZCAwLGgmJihkW2tdPWgpKSxiLnJlc3VsdH19LGRpc3BhdGNoOmZ1bmN0aW9uKGEpe2E9bi5ldmVudC5maXgoYSk7dmFyIGIsYyxlLGYsZyxoPVtdLGk9ZC5jYWxsKGFyZ3VtZW50cyksaj0oTC5nZXQodGhpcywiZXZlbnRzIil8fHt9KVthLnR5cGVdfHxbXSxrPW4uZXZlbnQuc3BlY2lhbFthLnR5cGVdfHx7fTtpZihpWzBdPWEsYS5kZWxlZ2F0ZVRhcmdldD10aGlzLCFrLnByZURpc3BhdGNofHxrLnByZURpc3BhdGNoLmNhbGwodGhpcyxhKSE9PSExKXtoPW4uZXZlbnQuaGFuZGxlcnMuY2FsbCh0aGlzLGEsaiksYj0wO3doaWxlKChmPWhbYisrXSkmJiFhLmlzUHJvcGFnYXRpb25TdG9wcGVkKCkpe2EuY3VycmVudFRhcmdldD1mLmVsZW0sYz0wO3doaWxlKChnPWYuaGFuZGxlcnNbYysrXSkmJiFhLmlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkKCkpKCFhLm5hbWVzcGFjZV9yZXx8YS5uYW1lc3BhY2VfcmUudGVzdChnLm5hbWVzcGFjZSkpJiYoYS5oYW5kbGVPYmo9ZyxhLmRhdGE9Zy5kYXRhLGU9KChuLmV2ZW50LnNwZWNpYWxbZy5vcmlnVHlwZV18fHt9KS5oYW5kbGV8fGcuaGFuZGxlcikuYXBwbHkoZi5lbGVtLGkpLHZvaWQgMCE9PWUmJihhLnJlc3VsdD1lKT09PSExJiYoYS5wcmV2ZW50RGVmYXVsdCgpLGEuc3RvcFByb3BhZ2F0aW9uKCkpKX1yZXR1cm4gay5wb3N0RGlzcGF0Y2gmJmsucG9zdERpc3BhdGNoLmNhbGwodGhpcyxhKSxhLnJlc3VsdH19LGhhbmRsZXJzOmZ1bmN0aW9uKGEsYil7dmFyIGMsZCxlLGYsZz1bXSxoPWIuZGVsZWdhdGVDb3VudCxpPWEudGFyZ2V0O2lmKGgmJmkubm9kZVR5cGUmJighYS5idXR0b258fCJjbGljayIhPT1hLnR5cGUpKWZvcig7aSE9PXRoaXM7aT1pLnBhcmVudE5vZGV8fHRoaXMpaWYoaS5kaXNhYmxlZCE9PSEwfHwiY2xpY2siIT09YS50eXBlKXtmb3IoZD1bXSxjPTA7aD5jO2MrKylmPWJbY10sZT1mLnNlbGVjdG9yKyIgIix2b2lkIDA9PT1kW2VdJiYoZFtlXT1mLm5lZWRzQ29udGV4dD9uKGUsdGhpcykuaW5kZXgoaSk+PTA6bi5maW5kKGUsdGhpcyxudWxsLFtpXSkubGVuZ3RoKSxkW2VdJiZkLnB1c2goZik7ZC5sZW5ndGgmJmcucHVzaCh7ZWxlbTppLGhhbmRsZXJzOmR9KX1yZXR1cm4gaDxiLmxlbmd0aCYmZy5wdXNoKHtlbGVtOnRoaXMsaGFuZGxlcnM6Yi5zbGljZShoKX0pLGd9LHByb3BzOiJhbHRLZXkgYnViYmxlcyBjYW5jZWxhYmxlIGN0cmxLZXkgY3VycmVudFRhcmdldCBldmVudFBoYXNlIG1ldGFLZXkgcmVsYXRlZFRhcmdldCBzaGlmdEtleSB0YXJnZXQgdGltZVN0YW1wIHZpZXcgd2hpY2giLnNwbGl0KCIgIiksZml4SG9va3M6e30sa2V5SG9va3M6e3Byb3BzOiJjaGFyIGNoYXJDb2RlIGtleSBrZXlDb2RlIi5zcGxpdCgiICIpLGZpbHRlcjpmdW5jdGlvbihhLGIpe3JldHVybiBudWxsPT1hLndoaWNoJiYoYS53aGljaD1udWxsIT1iLmNoYXJDb2RlP2IuY2hhckNvZGU6Yi5rZXlDb2RlKSxhfX0sbW91c2VIb29rczp7cHJvcHM6ImJ1dHRvbiBidXR0b25zIGNsaWVudFggY2xpZW50WSBvZmZzZXRYIG9mZnNldFkgcGFnZVggcGFnZVkgc2NyZWVuWCBzY3JlZW5ZIHRvRWxlbWVudCIuc3BsaXQoIiAiKSxmaWx0ZXI6ZnVuY3Rpb24oYSxiKXt2YXIgYyxkLGUsZj1iLmJ1dHRvbjtyZXR1cm4gbnVsbD09YS5wYWdlWCYmbnVsbCE9Yi5jbGllbnRYJiYoYz1hLnRhcmdldC5vd25lckRvY3VtZW50fHxsLGQ9Yy5kb2N1bWVudEVsZW1lbnQsZT1jLmJvZHksYS5wYWdlWD1iLmNsaWVudFgrKGQmJmQuc2Nyb2xsTGVmdHx8ZSYmZS5zY3JvbGxMZWZ0fHwwKS0oZCYmZC5jbGllbnRMZWZ0fHxlJiZlLmNsaWVudExlZnR8fDApLGEucGFnZVk9Yi5jbGllbnRZKyhkJiZkLnNjcm9sbFRvcHx8ZSYmZS5zY3JvbGxUb3B8fDApLShkJiZkLmNsaWVudFRvcHx8ZSYmZS5jbGllbnRUb3B8fDApKSxhLndoaWNofHx2b2lkIDA9PT1mfHwoYS53aGljaD0xJmY/MToyJmY/Mzo0JmY/MjowKSxhfX0sZml4OmZ1bmN0aW9uKGEpe2lmKGFbbi5leHBhbmRvXSlyZXR1cm4gYTt2YXIgYixjLGQsZT1hLnR5cGUsZj1hLGc9dGhpcy5maXhIb29rc1tlXTtnfHwodGhpcy5maXhIb29rc1tlXT1nPVcudGVzdChlKT90aGlzLm1vdXNlSG9va3M6Vi50ZXN0KGUpP3RoaXMua2V5SG9va3M6e30pLGQ9Zy5wcm9wcz90aGlzLnByb3BzLmNvbmNhdChnLnByb3BzKTp0aGlzLnByb3BzLGE9bmV3IG4uRXZlbnQoZiksYj1kLmxlbmd0aDt3aGlsZShiLS0pYz1kW2JdLGFbY109ZltjXTtyZXR1cm4gYS50YXJnZXR8fChhLnRhcmdldD1sKSwzPT09YS50YXJnZXQubm9kZVR5cGUmJihhLnRhcmdldD1hLnRhcmdldC5wYXJlbnROb2RlKSxnLmZpbHRlcj9nLmZpbHRlcihhLGYpOmF9LHNwZWNpYWw6e2xvYWQ6e25vQnViYmxlOiEwfSxmb2N1czp7dHJpZ2dlcjpmdW5jdGlvbigpe3JldHVybiB0aGlzIT09XygpJiZ0aGlzLmZvY3VzPyh0aGlzLmZvY3VzKCksITEpOnZvaWQgMH0sZGVsZWdhdGVUeXBlOiJmb2N1c2luIn0sYmx1cjp7dHJpZ2dlcjpmdW5jdGlvbigpe3JldHVybiB0aGlzPT09XygpJiZ0aGlzLmJsdXI/KHRoaXMuYmx1cigpLCExKTp2b2lkIDB9LGRlbGVnYXRlVHlwZToiZm9jdXNvdXQifSxjbGljazp7dHJpZ2dlcjpmdW5jdGlvbigpe3JldHVybiJjaGVja2JveCI9PT10aGlzLnR5cGUmJnRoaXMuY2xpY2smJm4ubm9kZU5hbWUodGhpcywiaW5wdXQiKT8odGhpcy5jbGljaygpLCExKTp2b2lkIDB9LF9kZWZhdWx0OmZ1bmN0aW9uKGEpe3JldHVybiBuLm5vZGVOYW1lKGEudGFyZ2V0LCJhIil9fSxiZWZvcmV1bmxvYWQ6e3Bvc3REaXNwYXRjaDpmdW5jdGlvbihhKXt2b2lkIDAhPT1hLnJlc3VsdCYmYS5vcmlnaW5hbEV2ZW50JiYoYS5vcmlnaW5hbEV2ZW50LnJldHVyblZhbHVlPWEucmVzdWx0KX19fSxzaW11bGF0ZTpmdW5jdGlvbihhLGIsYyxkKXt2YXIgZT1uLmV4dGVuZChuZXcgbi5FdmVudCxjLHt0eXBlOmEsaXNTaW11bGF0ZWQ6ITAsb3JpZ2luYWxFdmVudDp7fX0pO2Q/bi5ldmVudC50cmlnZ2VyKGUsbnVsbCxiKTpuLmV2ZW50LmRpc3BhdGNoLmNhbGwoYixlKSxlLmlzRGVmYXVsdFByZXZlbnRlZCgpJiZjLnByZXZlbnREZWZhdWx0KCl9fSxuLnJlbW92ZUV2ZW50PWZ1bmN0aW9uKGEsYixjKXthLnJlbW92ZUV2ZW50TGlzdGVuZXImJmEucmVtb3ZlRXZlbnRMaXN0ZW5lcihiLGMsITEpfSxuLkV2ZW50PWZ1bmN0aW9uKGEsYil7cmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBuLkV2ZW50PyhhJiZhLnR5cGU/KHRoaXMub3JpZ2luYWxFdmVudD1hLHRoaXMudHlwZT1hLnR5cGUsdGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQ9YS5kZWZhdWx0UHJldmVudGVkfHx2b2lkIDA9PT1hLmRlZmF1bHRQcmV2ZW50ZWQmJmEucmV0dXJuVmFsdWU9PT0hMT9aOiQpOnRoaXMudHlwZT1hLGImJm4uZXh0ZW5kKHRoaXMsYiksdGhpcy50aW1lU3RhbXA9YSYmYS50aW1lU3RhbXB8fG4ubm93KCksdm9pZCh0aGlzW24uZXhwYW5kb109ITApKTpuZXcgbi5FdmVudChhLGIpfSxuLkV2ZW50LnByb3RvdHlwZT17aXNEZWZhdWx0UHJldmVudGVkOiQsaXNQcm9wYWdhdGlvblN0b3BwZWQ6JCxpc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZDokLHByZXZlbnREZWZhdWx0OmZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5vcmlnaW5hbEV2ZW50O3RoaXMuaXNEZWZhdWx0UHJldmVudGVkPVosYSYmYS5wcmV2ZW50RGVmYXVsdCYmYS5wcmV2ZW50RGVmYXVsdCgpfSxzdG9wUHJvcGFnYXRpb246ZnVuY3Rpb24oKXt2YXIgYT10aGlzLm9yaWdpbmFsRXZlbnQ7dGhpcy5pc1Byb3BhZ2F0aW9uU3RvcHBlZD1aLGEmJmEuc3RvcFByb3BhZ2F0aW9uJiZhLnN0b3BQcm9wYWdhdGlvbigpfSxzdG9wSW1tZWRpYXRlUHJvcGFnYXRpb246ZnVuY3Rpb24oKXt2YXIgYT10aGlzLm9yaWdpbmFsRXZlbnQ7dGhpcy5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZD1aLGEmJmEuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uJiZhLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpLHRoaXMuc3RvcFByb3BhZ2F0aW9uKCl9fSxuLmVhY2goe21vdXNlZW50ZXI6Im1vdXNlb3ZlciIsbW91c2VsZWF2ZToibW91c2VvdXQiLHBvaW50ZXJlbnRlcjoicG9pbnRlcm92ZXIiLHBvaW50ZXJsZWF2ZToicG9pbnRlcm91dCJ9LGZ1bmN0aW9uKGEsYil7bi5ldmVudC5zcGVjaWFsW2FdPXtkZWxlZ2F0ZVR5cGU6YixiaW5kVHlwZTpiLGhhbmRsZTpmdW5jdGlvbihhKXt2YXIgYyxkPXRoaXMsZT1hLnJlbGF0ZWRUYXJnZXQsZj1hLmhhbmRsZU9iajtyZXR1cm4oIWV8fGUhPT1kJiYhbi5jb250YWlucyhkLGUpKSYmKGEudHlwZT1mLm9yaWdUeXBlLGM9Zi5oYW5kbGVyLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxhLnR5cGU9YiksY319fSksay5mb2N1c2luQnViYmxlc3x8bi5lYWNoKHtmb2N1czoiZm9jdXNpbiIsYmx1cjoiZm9jdXNvdXQifSxmdW5jdGlvbihhLGIpe3ZhciBjPWZ1bmN0aW9uKGEpe24uZXZlbnQuc2ltdWxhdGUoYixhLnRhcmdldCxuLmV2ZW50LmZpeChhKSwhMCl9O24uZXZlbnQuc3BlY2lhbFtiXT17c2V0dXA6ZnVuY3Rpb24oKXt2YXIgZD10aGlzLm93bmVyRG9jdW1lbnR8fHRoaXMsZT1MLmFjY2VzcyhkLGIpO2V8fGQuYWRkRXZlbnRMaXN0ZW5lcihhLGMsITApLEwuYWNjZXNzKGQsYiwoZXx8MCkrMSl9LHRlYXJkb3duOmZ1bmN0aW9uKCl7dmFyIGQ9dGhpcy5vd25lckRvY3VtZW50fHx0aGlzLGU9TC5hY2Nlc3MoZCxiKS0xO2U/TC5hY2Nlc3MoZCxiLGUpOihkLnJlbW92ZUV2ZW50TGlzdGVuZXIoYSxjLCEwKSxMLnJlbW92ZShkLGIpKX19fSksbi5mbi5leHRlbmQoe29uOmZ1bmN0aW9uKGEsYixjLGQsZSl7dmFyIGYsZztpZigib2JqZWN0Ij09dHlwZW9mIGEpeyJzdHJpbmciIT10eXBlb2YgYiYmKGM9Y3x8YixiPXZvaWQgMCk7Zm9yKGcgaW4gYSl0aGlzLm9uKGcsYixjLGFbZ10sZSk7cmV0dXJuIHRoaXN9aWYobnVsbD09YyYmbnVsbD09ZD8oZD1iLGM9Yj12b2lkIDApOm51bGw9PWQmJigic3RyaW5nIj09dHlwZW9mIGI/KGQ9YyxjPXZvaWQgMCk6KGQ9YyxjPWIsYj12b2lkIDApKSxkPT09ITEpZD0kO2Vsc2UgaWYoIWQpcmV0dXJuIHRoaXM7cmV0dXJuIDE9PT1lJiYoZj1kLGQ9ZnVuY3Rpb24oYSl7cmV0dXJuIG4oKS5vZmYoYSksZi5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LGQuZ3VpZD1mLmd1aWR8fChmLmd1aWQ9bi5ndWlkKyspKSx0aGlzLmVhY2goZnVuY3Rpb24oKXtuLmV2ZW50LmFkZCh0aGlzLGEsZCxjLGIpfSl9LG9uZTpmdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gdGhpcy5vbihhLGIsYyxkLDEpfSxvZmY6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkLGU7aWYoYSYmYS5wcmV2ZW50RGVmYXVsdCYmYS5oYW5kbGVPYmopcmV0dXJuIGQ9YS5oYW5kbGVPYmosbihhLmRlbGVnYXRlVGFyZ2V0KS5vZmYoZC5uYW1lc3BhY2U/ZC5vcmlnVHlwZSsiLiIrZC5uYW1lc3BhY2U6ZC5vcmlnVHlwZSxkLnNlbGVjdG9yLGQuaGFuZGxlciksdGhpcztpZigib2JqZWN0Ij09dHlwZW9mIGEpe2ZvcihlIGluIGEpdGhpcy5vZmYoZSxiLGFbZV0pO3JldHVybiB0aGlzfXJldHVybihiPT09ITF8fCJmdW5jdGlvbiI9PXR5cGVvZiBiKSYmKGM9YixiPXZvaWQgMCksYz09PSExJiYoYz0kKSx0aGlzLmVhY2goZnVuY3Rpb24oKXtuLmV2ZW50LnJlbW92ZSh0aGlzLGEsYyxiKX0pfSx0cmlnZ2VyOmZ1bmN0aW9uKGEsYil7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe24uZXZlbnQudHJpZ2dlcihhLGIsdGhpcyl9KX0sdHJpZ2dlckhhbmRsZXI6ZnVuY3Rpb24oYSxiKXt2YXIgYz10aGlzWzBdO3JldHVybiBjP24uZXZlbnQudHJpZ2dlcihhLGIsYywhMCk6dm9pZCAwfX0pO3ZhciBhYj0vPCg/IWFyZWF8YnJ8Y29sfGVtYmVkfGhyfGltZ3xpbnB1dHxsaW5rfG1ldGF8cGFyYW0pKChbXHc6XSspW14+XSopXC8+L2dpLGJiPS88KFtcdzpdKykvLGNiPS88fCYjP1x3KzsvLGRiPS88KD86c2NyaXB0fHN0eWxlfGxpbmspL2ksZWI9L2NoZWNrZWRccyooPzpbXj1dfD1ccyouY2hlY2tlZC4pL2ksZmI9L14kfFwvKD86amF2YXxlY21hKXNjcmlwdC9pLGdiPS9edHJ1ZVwvKC4qKS8saGI9L15ccyo8ISg/OlxbQ0RBVEFcW3wtLSl8KD86XF1cXXwtLSk+XHMqJC9nLGliPXtvcHRpb246WzEsIjxzZWxlY3QgbXVsdGlwbGU9J211bHRpcGxlJz4iLCI8L3NlbGVjdD4iXSx0aGVhZDpbMSwiPHRhYmxlPiIsIjwvdGFibGU+Il0sY29sOlsyLCI8dGFibGU+PGNvbGdyb3VwPiIsIjwvY29sZ3JvdXA+PC90YWJsZT4iXSx0cjpbMiwiPHRhYmxlPjx0Ym9keT4iLCI8L3Rib2R5PjwvdGFibGU+Il0sdGQ6WzMsIjx0YWJsZT48dGJvZHk+PHRyPiIsIjwvdHI+PC90Ym9keT48L3RhYmxlPiJdLF9kZWZhdWx0OlswLCIiLCIiXX07aWIub3B0Z3JvdXA9aWIub3B0aW9uLGliLnRib2R5PWliLnRmb290PWliLmNvbGdyb3VwPWliLmNhcHRpb249aWIudGhlYWQsaWIudGg9aWIudGQ7ZnVuY3Rpb24gamIoYSxiKXtyZXR1cm4gbi5ub2RlTmFtZShhLCJ0YWJsZSIpJiZuLm5vZGVOYW1lKDExIT09Yi5ub2RlVHlwZT9iOmIuZmlyc3RDaGlsZCwidHIiKT9hLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ0Ym9keSIpWzBdfHxhLmFwcGVuZENoaWxkKGEub3duZXJEb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0Ym9keSIpKTphfWZ1bmN0aW9uIGtiKGEpe3JldHVybiBhLnR5cGU9KG51bGwhPT1hLmdldEF0dHJpYnV0ZSgidHlwZSIpKSsiLyIrYS50eXBlLGF9ZnVuY3Rpb24gbGIoYSl7dmFyIGI9Z2IuZXhlYyhhLnR5cGUpO3JldHVybiBiP2EudHlwZT1iWzFdOmEucmVtb3ZlQXR0cmlidXRlKCJ0eXBlIiksYX1mdW5jdGlvbiBtYihhLGIpe2Zvcih2YXIgYz0wLGQ9YS5sZW5ndGg7ZD5jO2MrKylMLnNldChhW2NdLCJnbG9iYWxFdmFsIiwhYnx8TC5nZXQoYltjXSwiZ2xvYmFsRXZhbCIpKX1mdW5jdGlvbiBuYihhLGIpe3ZhciBjLGQsZSxmLGcsaCxpLGo7aWYoMT09PWIubm9kZVR5cGUpe2lmKEwuaGFzRGF0YShhKSYmKGY9TC5hY2Nlc3MoYSksZz1MLnNldChiLGYpLGo9Zi5ldmVudHMpKXtkZWxldGUgZy5oYW5kbGUsZy5ldmVudHM9e307Zm9yKGUgaW4gailmb3IoYz0wLGQ9altlXS5sZW5ndGg7ZD5jO2MrKyluLmV2ZW50LmFkZChiLGUsaltlXVtjXSl9TS5oYXNEYXRhKGEpJiYoaD1NLmFjY2VzcyhhKSxpPW4uZXh0ZW5kKHt9LGgpLE0uc2V0KGIsaSkpfX1mdW5jdGlvbiBvYihhLGIpe3ZhciBjPWEuZ2V0RWxlbWVudHNCeVRhZ05hbWU/YS5nZXRFbGVtZW50c0J5VGFnTmFtZShifHwiKiIpOmEucXVlcnlTZWxlY3RvckFsbD9hLnF1ZXJ5U2VsZWN0b3JBbGwoYnx8IioiKTpbXTtyZXR1cm4gdm9pZCAwPT09Ynx8YiYmbi5ub2RlTmFtZShhLGIpP24ubWVyZ2UoW2FdLGMpOmN9ZnVuY3Rpb24gcGIoYSxiKXt2YXIgYz1iLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7ImlucHV0Ij09PWMmJlQudGVzdChhLnR5cGUpP2IuY2hlY2tlZD1hLmNoZWNrZWQ6KCJpbnB1dCI9PT1jfHwidGV4dGFyZWEiPT09YykmJihiLmRlZmF1bHRWYWx1ZT1hLmRlZmF1bHRWYWx1ZSl9bi5leHRlbmQoe2Nsb25lOmZ1bmN0aW9uKGEsYixjKXt2YXIgZCxlLGYsZyxoPWEuY2xvbmVOb2RlKCEwKSxpPW4uY29udGFpbnMoYS5vd25lckRvY3VtZW50LGEpO2lmKCEoay5ub0Nsb25lQ2hlY2tlZHx8MSE9PWEubm9kZVR5cGUmJjExIT09YS5ub2RlVHlwZXx8bi5pc1hNTERvYyhhKSkpZm9yKGc9b2IoaCksZj1vYihhKSxkPTAsZT1mLmxlbmd0aDtlPmQ7ZCsrKXBiKGZbZF0sZ1tkXSk7aWYoYilpZihjKWZvcihmPWZ8fG9iKGEpLGc9Z3x8b2IoaCksZD0wLGU9Zi5sZW5ndGg7ZT5kO2QrKyluYihmW2RdLGdbZF0pO2Vsc2UgbmIoYSxoKTtyZXR1cm4gZz1vYihoLCJzY3JpcHQiKSxnLmxlbmd0aD4wJiZtYihnLCFpJiZvYihhLCJzY3JpcHQiKSksaH0sYnVpbGRGcmFnbWVudDpmdW5jdGlvbihhLGIsYyxkKXtmb3IodmFyIGUsZixnLGgsaSxqLGs9Yi5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksbD1bXSxtPTAsbz1hLmxlbmd0aDtvPm07bSsrKWlmKGU9YVttXSxlfHwwPT09ZSlpZigib2JqZWN0Ij09PW4udHlwZShlKSluLm1lcmdlKGwsZS5ub2RlVHlwZT9bZV06ZSk7ZWxzZSBpZihjYi50ZXN0KGUpKXtmPWZ8fGsuYXBwZW5kQ2hpbGQoYi5jcmVhdGVFbGVtZW50KCJkaXYiKSksZz0oYmIuZXhlYyhlKXx8WyIiLCIiXSlbMV0udG9Mb3dlckNhc2UoKSxoPWliW2ddfHxpYi5fZGVmYXVsdCxmLmlubmVySFRNTD1oWzFdK2UucmVwbGFjZShhYiwiPCQxPjwvJDI+IikraFsyXSxqPWhbMF07d2hpbGUoai0tKWY9Zi5sYXN0Q2hpbGQ7bi5tZXJnZShsLGYuY2hpbGROb2RlcyksZj1rLmZpcnN0Q2hpbGQsZi50ZXh0Q29udGVudD0iIn1lbHNlIGwucHVzaChiLmNyZWF0ZVRleHROb2RlKGUpKTtrLnRleHRDb250ZW50PSIiLG09MDt3aGlsZShlPWxbbSsrXSlpZigoIWR8fC0xPT09bi5pbkFycmF5KGUsZCkpJiYoaT1uLmNvbnRhaW5zKGUub3duZXJEb2N1bWVudCxlKSxmPW9iKGsuYXBwZW5kQ2hpbGQoZSksInNjcmlwdCIpLGkmJm1iKGYpLGMpKXtqPTA7d2hpbGUoZT1mW2orK10pZmIudGVzdChlLnR5cGV8fCIiKSYmYy5wdXNoKGUpfXJldHVybiBrfSxjbGVhbkRhdGE6ZnVuY3Rpb24oYSl7Zm9yKHZhciBiLGMsZCxlLGY9bi5ldmVudC5zcGVjaWFsLGc9MDt2b2lkIDAhPT0oYz1hW2ddKTtnKyspe2lmKG4uYWNjZXB0RGF0YShjKSYmKGU9Y1tMLmV4cGFuZG9dLGUmJihiPUwuY2FjaGVbZV0pKSl7aWYoYi5ldmVudHMpZm9yKGQgaW4gYi5ldmVudHMpZltkXT9uLmV2ZW50LnJlbW92ZShjLGQpOm4ucmVtb3ZlRXZlbnQoYyxkLGIuaGFuZGxlKTtMLmNhY2hlW2VdJiZkZWxldGUgTC5jYWNoZVtlXX1kZWxldGUgTS5jYWNoZVtjW00uZXhwYW5kb11dfX19KSxuLmZuLmV4dGVuZCh7dGV4dDpmdW5jdGlvbihhKXtyZXR1cm4gSih0aGlzLGZ1bmN0aW9uKGEpe3JldHVybiB2b2lkIDA9PT1hP24udGV4dCh0aGlzKTp0aGlzLmVtcHR5KCkuZWFjaChmdW5jdGlvbigpeygxPT09dGhpcy5ub2RlVHlwZXx8MTE9PT10aGlzLm5vZGVUeXBlfHw5PT09dGhpcy5ub2RlVHlwZSkmJih0aGlzLnRleHRDb250ZW50PWEpfSl9LG51bGwsYSxhcmd1bWVudHMubGVuZ3RoKX0sYXBwZW5kOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZG9tTWFuaXAoYXJndW1lbnRzLGZ1bmN0aW9uKGEpe2lmKDE9PT10aGlzLm5vZGVUeXBlfHwxMT09PXRoaXMubm9kZVR5cGV8fDk9PT10aGlzLm5vZGVUeXBlKXt2YXIgYj1qYih0aGlzLGEpO2IuYXBwZW5kQ2hpbGQoYSl9fSl9LHByZXBlbmQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsZnVuY3Rpb24oYSl7aWYoMT09PXRoaXMubm9kZVR5cGV8fDExPT09dGhpcy5ub2RlVHlwZXx8OT09PXRoaXMubm9kZVR5cGUpe3ZhciBiPWpiKHRoaXMsYSk7Yi5pbnNlcnRCZWZvcmUoYSxiLmZpcnN0Q2hpbGQpfX0pfSxiZWZvcmU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsZnVuY3Rpb24oYSl7dGhpcy5wYXJlbnROb2RlJiZ0aGlzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGEsdGhpcyl9KX0sYWZ0ZXI6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsZnVuY3Rpb24oYSl7dGhpcy5wYXJlbnROb2RlJiZ0aGlzLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGEsdGhpcy5uZXh0U2libGluZyl9KX0scmVtb3ZlOmZ1bmN0aW9uKGEsYil7Zm9yKHZhciBjLGQ9YT9uLmZpbHRlcihhLHRoaXMpOnRoaXMsZT0wO251bGwhPShjPWRbZV0pO2UrKylifHwxIT09Yy5ub2RlVHlwZXx8bi5jbGVhbkRhdGEob2IoYykpLGMucGFyZW50Tm9kZSYmKGImJm4uY29udGFpbnMoYy5vd25lckRvY3VtZW50LGMpJiZtYihvYihjLCJzY3JpcHQiKSksYy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGMpKTtyZXR1cm4gdGhpc30sZW1wdHk6ZnVuY3Rpb24oKXtmb3IodmFyIGEsYj0wO251bGwhPShhPXRoaXNbYl0pO2IrKykxPT09YS5ub2RlVHlwZSYmKG4uY2xlYW5EYXRhKG9iKGEsITEpKSxhLnRleHRDb250ZW50PSIiKTtyZXR1cm4gdGhpc30sY2xvbmU6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gYT1udWxsPT1hPyExOmEsYj1udWxsPT1iP2E6Yix0aGlzLm1hcChmdW5jdGlvbigpe3JldHVybiBuLmNsb25lKHRoaXMsYSxiKX0pfSxodG1sOmZ1bmN0aW9uKGEpe3JldHVybiBKKHRoaXMsZnVuY3Rpb24oYSl7dmFyIGI9dGhpc1swXXx8e30sYz0wLGQ9dGhpcy5sZW5ndGg7aWYodm9pZCAwPT09YSYmMT09PWIubm9kZVR5cGUpcmV0dXJuIGIuaW5uZXJIVE1MO2lmKCJzdHJpbmciPT10eXBlb2YgYSYmIWRiLnRlc3QoYSkmJiFpYlsoYmIuZXhlYyhhKXx8WyIiLCIiXSlbMV0udG9Mb3dlckNhc2UoKV0pe2E9YS5yZXBsYWNlKGFiLCI8JDE+PC8kMj4iKTt0cnl7Zm9yKDtkPmM7YysrKWI9dGhpc1tjXXx8e30sMT09PWIubm9kZVR5cGUmJihuLmNsZWFuRGF0YShvYihiLCExKSksYi5pbm5lckhUTUw9YSk7Yj0wfWNhdGNoKGUpe319YiYmdGhpcy5lbXB0eSgpLmFwcGVuZChhKX0sbnVsbCxhLGFyZ3VtZW50cy5sZW5ndGgpfSxyZXBsYWNlV2l0aDpmdW5jdGlvbigpe3ZhciBhPWFyZ3VtZW50c1swXTtyZXR1cm4gdGhpcy5kb21NYW5pcChhcmd1bWVudHMsZnVuY3Rpb24oYil7YT10aGlzLnBhcmVudE5vZGUsbi5jbGVhbkRhdGEob2IodGhpcykpLGEmJmEucmVwbGFjZUNoaWxkKGIsdGhpcyl9KSxhJiYoYS5sZW5ndGh8fGEubm9kZVR5cGUpP3RoaXM6dGhpcy5yZW1vdmUoKX0sZGV0YWNoOmZ1bmN0aW9uKGEpe3JldHVybiB0aGlzLnJlbW92ZShhLCEwKX0sZG9tTWFuaXA6ZnVuY3Rpb24oYSxiKXthPWUuYXBwbHkoW10sYSk7dmFyIGMsZCxmLGcsaCxpLGo9MCxsPXRoaXMubGVuZ3RoLG09dGhpcyxvPWwtMSxwPWFbMF0scT1uLmlzRnVuY3Rpb24ocCk7aWYocXx8bD4xJiYic3RyaW5nIj09dHlwZW9mIHAmJiFrLmNoZWNrQ2xvbmUmJmViLnRlc3QocCkpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihjKXt2YXIgZD1tLmVxKGMpO3EmJihhWzBdPXAuY2FsbCh0aGlzLGMsZC5odG1sKCkpKSxkLmRvbU1hbmlwKGEsYil9KTtpZihsJiYoYz1uLmJ1aWxkRnJhZ21lbnQoYSx0aGlzWzBdLm93bmVyRG9jdW1lbnQsITEsdGhpcyksZD1jLmZpcnN0Q2hpbGQsMT09PWMuY2hpbGROb2Rlcy5sZW5ndGgmJihjPWQpLGQpKXtmb3IoZj1uLm1hcChvYihjLCJzY3JpcHQiKSxrYiksZz1mLmxlbmd0aDtsPmo7aisrKWg9YyxqIT09byYmKGg9bi5jbG9uZShoLCEwLCEwKSxnJiZuLm1lcmdlKGYsb2IoaCwic2NyaXB0IikpKSxiLmNhbGwodGhpc1tqXSxoLGopO2lmKGcpZm9yKGk9ZltmLmxlbmd0aC0xXS5vd25lckRvY3VtZW50LG4ubWFwKGYsbGIpLGo9MDtnPmo7aisrKWg9ZltqXSxmYi50ZXN0KGgudHlwZXx8IiIpJiYhTC5hY2Nlc3MoaCwiZ2xvYmFsRXZhbCIpJiZuLmNvbnRhaW5zKGksaCkmJihoLnNyYz9uLl9ldmFsVXJsJiZuLl9ldmFsVXJsKGguc3JjKTpuLmdsb2JhbEV2YWwoaC50ZXh0Q29udGVudC5yZXBsYWNlKGhiLCIiKSkpfXJldHVybiB0aGlzfX0pLG4uZWFjaCh7YXBwZW5kVG86ImFwcGVuZCIscHJlcGVuZFRvOiJwcmVwZW5kIixpbnNlcnRCZWZvcmU6ImJlZm9yZSIsaW5zZXJ0QWZ0ZXI6ImFmdGVyIixyZXBsYWNlQWxsOiJyZXBsYWNlV2l0aCJ9LGZ1bmN0aW9uKGEsYil7bi5mblthXT1mdW5jdGlvbihhKXtmb3IodmFyIGMsZD1bXSxlPW4oYSksZz1lLmxlbmd0aC0xLGg9MDtnPj1oO2grKyljPWg9PT1nP3RoaXM6dGhpcy5jbG9uZSghMCksbihlW2hdKVtiXShjKSxmLmFwcGx5KGQsYy5nZXQoKSk7cmV0dXJuIHRoaXMucHVzaFN0YWNrKGQpfX0pO3ZhciBxYixyYj17fTtmdW5jdGlvbiBzYihiLGMpe3ZhciBkLGU9bihjLmNyZWF0ZUVsZW1lbnQoYikpLmFwcGVuZFRvKGMuYm9keSksZj1hLmdldERlZmF1bHRDb21wdXRlZFN0eWxlJiYoZD1hLmdldERlZmF1bHRDb21wdXRlZFN0eWxlKGVbMF0pKT9kLmRpc3BsYXk6bi5jc3MoZVswXSwiZGlzcGxheSIpO3JldHVybiBlLmRldGFjaCgpLGZ9ZnVuY3Rpb24gdGIoYSl7dmFyIGI9bCxjPXJiW2FdO3JldHVybiBjfHwoYz1zYihhLGIpLCJub25lIiE9PWMmJmN8fChxYj0ocWJ8fG4oIjxpZnJhbWUgZnJhbWVib3JkZXI9JzAnIHdpZHRoPScwJyBoZWlnaHQ9JzAnLz4iKSkuYXBwZW5kVG8oYi5kb2N1bWVudEVsZW1lbnQpLGI9cWJbMF0uY29udGVudERvY3VtZW50LGIud3JpdGUoKSxiLmNsb3NlKCksYz1zYihhLGIpLHFiLmRldGFjaCgpKSxyYlthXT1jKSxjfXZhciB1Yj0vXm1hcmdpbi8sdmI9bmV3IFJlZ0V4cCgiXigiK1ErIikoPyFweClbYS16JV0rJCIsImkiKSx3Yj1mdW5jdGlvbihiKXtyZXR1cm4gYi5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3Lm9wZW5lcj9iLm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXcuZ2V0Q29tcHV0ZWRTdHlsZShiLG51bGwpOmEuZ2V0Q29tcHV0ZWRTdHlsZShiLG51bGwpfTtmdW5jdGlvbiB4YihhLGIsYyl7dmFyIGQsZSxmLGcsaD1hLnN0eWxlO3JldHVybiBjPWN8fHdiKGEpLGMmJihnPWMuZ2V0UHJvcGVydHlWYWx1ZShiKXx8Y1tiXSksYyYmKCIiIT09Z3x8bi5jb250YWlucyhhLm93bmVyRG9jdW1lbnQsYSl8fChnPW4uc3R5bGUoYSxiKSksdmIudGVzdChnKSYmdWIudGVzdChiKSYmKGQ9aC53aWR0aCxlPWgubWluV2lkdGgsZj1oLm1heFdpZHRoLGgubWluV2lkdGg9aC5tYXhXaWR0aD1oLndpZHRoPWcsZz1jLndpZHRoLGgud2lkdGg9ZCxoLm1pbldpZHRoPWUsaC5tYXhXaWR0aD1mKSksdm9pZCAwIT09Zz9nKyIiOmd9ZnVuY3Rpb24geWIoYSxiKXtyZXR1cm57Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGEoKT92b2lkIGRlbGV0ZSB0aGlzLmdldDoodGhpcy5nZXQ9YikuYXBwbHkodGhpcyxhcmd1bWVudHMpfX19IWZ1bmN0aW9uKCl7dmFyIGIsYyxkPWwuZG9jdW1lbnRFbGVtZW50LGU9bC5jcmVhdGVFbGVtZW50KCJkaXYiKSxmPWwuY3JlYXRlRWxlbWVudCgiZGl2Iik7aWYoZi5zdHlsZSl7Zi5zdHlsZS5iYWNrZ3JvdW5kQ2xpcD0iY29udGVudC1ib3giLGYuY2xvbmVOb2RlKCEwKS5zdHlsZS5iYWNrZ3JvdW5kQ2xpcD0iIixrLmNsZWFyQ2xvbmVTdHlsZT0iY29udGVudC1ib3giPT09Zi5zdHlsZS5iYWNrZ3JvdW5kQ2xpcCxlLnN0eWxlLmNzc1RleHQ9ImJvcmRlcjowO3dpZHRoOjA7aGVpZ2h0OjA7dG9wOjA7bGVmdDotOTk5OXB4O21hcmdpbi10b3A6MXB4O3Bvc2l0aW9uOmFic29sdXRlIixlLmFwcGVuZENoaWxkKGYpO2Z1bmN0aW9uIGcoKXtmLnN0eWxlLmNzc1RleHQ9Ii13ZWJraXQtYm94LXNpemluZzpib3JkZXItYm94Oy1tb3otYm94LXNpemluZzpib3JkZXItYm94O2JveC1zaXppbmc6Ym9yZGVyLWJveDtkaXNwbGF5OmJsb2NrO21hcmdpbi10b3A6MSU7dG9wOjElO2JvcmRlcjoxcHg7cGFkZGluZzoxcHg7d2lkdGg6NHB4O3Bvc2l0aW9uOmFic29sdXRlIixmLmlubmVySFRNTD0iIixkLmFwcGVuZENoaWxkKGUpO3ZhciBnPWEuZ2V0Q29tcHV0ZWRTdHlsZShmLG51bGwpO2I9IjElIiE9PWcudG9wLGM9IjRweCI9PT1nLndpZHRoLGQucmVtb3ZlQ2hpbGQoZSl9YS5nZXRDb21wdXRlZFN0eWxlJiZuLmV4dGVuZChrLHtwaXhlbFBvc2l0aW9uOmZ1bmN0aW9uKCl7cmV0dXJuIGcoKSxifSxib3hTaXppbmdSZWxpYWJsZTpmdW5jdGlvbigpe3JldHVybiBudWxsPT1jJiZnKCksY30scmVsaWFibGVNYXJnaW5SaWdodDpmdW5jdGlvbigpe3ZhciBiLGM9Zi5hcHBlbmRDaGlsZChsLmNyZWF0ZUVsZW1lbnQoImRpdiIpKTtyZXR1cm4gYy5zdHlsZS5jc3NUZXh0PWYuc3R5bGUuY3NzVGV4dD0iLXdlYmtpdC1ib3gtc2l6aW5nOmNvbnRlbnQtYm94Oy1tb3otYm94LXNpemluZzpjb250ZW50LWJveDtib3gtc2l6aW5nOmNvbnRlbnQtYm94O2Rpc3BsYXk6YmxvY2s7bWFyZ2luOjA7Ym9yZGVyOjA7cGFkZGluZzowIixjLnN0eWxlLm1hcmdpblJpZ2h0PWMuc3R5bGUud2lkdGg9IjAiLGYuc3R5bGUud2lkdGg9IjFweCIsZC5hcHBlbmRDaGlsZChlKSxiPSFwYXJzZUZsb2F0KGEuZ2V0Q29tcHV0ZWRTdHlsZShjLG51bGwpLm1hcmdpblJpZ2h0KSxkLnJlbW92ZUNoaWxkKGUpLGYucmVtb3ZlQ2hpbGQoYyksYn19KX19KCksbi5zd2FwPWZ1bmN0aW9uKGEsYixjLGQpe3ZhciBlLGYsZz17fTtmb3IoZiBpbiBiKWdbZl09YS5zdHlsZVtmXSxhLnN0eWxlW2ZdPWJbZl07ZT1jLmFwcGx5KGEsZHx8W10pO2ZvcihmIGluIGIpYS5zdHlsZVtmXT1nW2ZdO3JldHVybiBlfTt2YXIgemI9L14obm9uZXx0YWJsZSg/IS1jW2VhXSkuKykvLEFiPW5ldyBSZWdFeHAoIl4oIitRKyIpKC4qKSQiLCJpIiksQmI9bmV3IFJlZ0V4cCgiXihbKy1dKT0oIitRKyIpIiwiaSIpLENiPXtwb3NpdGlvbjoiYWJzb2x1dGUiLHZpc2liaWxpdHk6ImhpZGRlbiIsZGlzcGxheToiYmxvY2sifSxEYj17bGV0dGVyU3BhY2luZzoiMCIsZm9udFdlaWdodDoiNDAwIn0sRWI9WyJXZWJraXQiLCJPIiwiTW96IiwibXMiXTtmdW5jdGlvbiBGYihhLGIpe2lmKGIgaW4gYSlyZXR1cm4gYjt2YXIgYz1iWzBdLnRvVXBwZXJDYXNlKCkrYi5zbGljZSgxKSxkPWIsZT1FYi5sZW5ndGg7d2hpbGUoZS0tKWlmKGI9RWJbZV0rYyxiIGluIGEpcmV0dXJuIGI7cmV0dXJuIGR9ZnVuY3Rpb24gR2IoYSxiLGMpe3ZhciBkPUFiLmV4ZWMoYik7cmV0dXJuIGQ/TWF0aC5tYXgoMCxkWzFdLShjfHwwKSkrKGRbMl18fCJweCIpOmJ9ZnVuY3Rpb24gSGIoYSxiLGMsZCxlKXtmb3IodmFyIGY9Yz09PShkPyJib3JkZXIiOiJjb250ZW50Iik/NDoid2lkdGgiPT09Yj8xOjAsZz0wOzQ+ZjtmKz0yKSJtYXJnaW4iPT09YyYmKGcrPW4uY3NzKGEsYytSW2ZdLCEwLGUpKSxkPygiY29udGVudCI9PT1jJiYoZy09bi5jc3MoYSwicGFkZGluZyIrUltmXSwhMCxlKSksIm1hcmdpbiIhPT1jJiYoZy09bi5jc3MoYSwiYm9yZGVyIitSW2ZdKyJXaWR0aCIsITAsZSkpKTooZys9bi5jc3MoYSwicGFkZGluZyIrUltmXSwhMCxlKSwicGFkZGluZyIhPT1jJiYoZys9bi5jc3MoYSwiYm9yZGVyIitSW2ZdKyJXaWR0aCIsITAsZSkpKTtyZXR1cm4gZ31mdW5jdGlvbiBJYihhLGIsYyl7dmFyIGQ9ITAsZT0id2lkdGgiPT09Yj9hLm9mZnNldFdpZHRoOmEub2Zmc2V0SGVpZ2h0LGY9d2IoYSksZz0iYm9yZGVyLWJveCI9PT1uLmNzcyhhLCJib3hTaXppbmciLCExLGYpO2lmKDA+PWV8fG51bGw9PWUpe2lmKGU9eGIoYSxiLGYpLCgwPmV8fG51bGw9PWUpJiYoZT1hLnN0eWxlW2JdKSx2Yi50ZXN0KGUpKXJldHVybiBlO2Q9ZyYmKGsuYm94U2l6aW5nUmVsaWFibGUoKXx8ZT09PWEuc3R5bGVbYl0pLGU9cGFyc2VGbG9hdChlKXx8MH1yZXR1cm4gZStIYihhLGIsY3x8KGc/ImJvcmRlciI6ImNvbnRlbnQiKSxkLGYpKyJweCJ9ZnVuY3Rpb24gSmIoYSxiKXtmb3IodmFyIGMsZCxlLGY9W10sZz0wLGg9YS5sZW5ndGg7aD5nO2crKylkPWFbZ10sZC5zdHlsZSYmKGZbZ109TC5nZXQoZCwib2xkZGlzcGxheSIpLGM9ZC5zdHlsZS5kaXNwbGF5LGI/KGZbZ118fCJub25lIiE9PWN8fChkLnN0eWxlLmRpc3BsYXk9IiIpLCIiPT09ZC5zdHlsZS5kaXNwbGF5JiZTKGQpJiYoZltnXT1MLmFjY2VzcyhkLCJvbGRkaXNwbGF5Iix0YihkLm5vZGVOYW1lKSkpKTooZT1TKGQpLCJub25lIj09PWMmJmV8fEwuc2V0KGQsIm9sZGRpc3BsYXkiLGU/YzpuLmNzcyhkLCJkaXNwbGF5IikpKSk7Zm9yKGc9MDtoPmc7ZysrKWQ9YVtnXSxkLnN0eWxlJiYoYiYmIm5vbmUiIT09ZC5zdHlsZS5kaXNwbGF5JiYiIiE9PWQuc3R5bGUuZGlzcGxheXx8KGQuc3R5bGUuZGlzcGxheT1iP2ZbZ118fCIiOiJub25lIikpO3JldHVybiBhfW4uZXh0ZW5kKHtjc3NIb29rczp7b3BhY2l0eTp7Z2V0OmZ1bmN0aW9uKGEsYil7aWYoYil7dmFyIGM9eGIoYSwib3BhY2l0eSIpO3JldHVybiIiPT09Yz8iMSI6Y319fX0sY3NzTnVtYmVyOntjb2x1bW5Db3VudDohMCxmaWxsT3BhY2l0eTohMCxmbGV4R3JvdzohMCxmbGV4U2hyaW5rOiEwLGZvbnRXZWlnaHQ6ITAsbGluZUhlaWdodDohMCxvcGFjaXR5OiEwLG9yZGVyOiEwLG9ycGhhbnM6ITAsd2lkb3dzOiEwLHpJbmRleDohMCx6b29tOiEwfSxjc3NQcm9wczp7ImZsb2F0IjoiY3NzRmxvYXQifSxzdHlsZTpmdW5jdGlvbihhLGIsYyxkKXtpZihhJiYzIT09YS5ub2RlVHlwZSYmOCE9PWEubm9kZVR5cGUmJmEuc3R5bGUpe3ZhciBlLGYsZyxoPW4uY2FtZWxDYXNlKGIpLGk9YS5zdHlsZTtyZXR1cm4gYj1uLmNzc1Byb3BzW2hdfHwobi5jc3NQcm9wc1toXT1GYihpLGgpKSxnPW4uY3NzSG9va3NbYl18fG4uY3NzSG9va3NbaF0sdm9pZCAwPT09Yz9nJiYiZ2V0ImluIGcmJnZvaWQgMCE9PShlPWcuZ2V0KGEsITEsZCkpP2U6aVtiXTooZj10eXBlb2YgYywic3RyaW5nIj09PWYmJihlPUJiLmV4ZWMoYykpJiYoYz0oZVsxXSsxKSplWzJdK3BhcnNlRmxvYXQobi5jc3MoYSxiKSksZj0ibnVtYmVyIiksbnVsbCE9YyYmYz09PWMmJigibnVtYmVyIiE9PWZ8fG4uY3NzTnVtYmVyW2hdfHwoYys9InB4Iiksay5jbGVhckNsb25lU3R5bGV8fCIiIT09Y3x8MCE9PWIuaW5kZXhPZigiYmFja2dyb3VuZCIpfHwoaVtiXT0iaW5oZXJpdCIpLGcmJiJzZXQiaW4gZyYmdm9pZCAwPT09KGM9Zy5zZXQoYSxjLGQpKXx8KGlbYl09YykpLHZvaWQgMCl9fSxjc3M6ZnVuY3Rpb24oYSxiLGMsZCl7dmFyIGUsZixnLGg9bi5jYW1lbENhc2UoYik7cmV0dXJuIGI9bi5jc3NQcm9wc1toXXx8KG4uY3NzUHJvcHNbaF09RmIoYS5zdHlsZSxoKSksZz1uLmNzc0hvb2tzW2JdfHxuLmNzc0hvb2tzW2hdLGcmJiJnZXQiaW4gZyYmKGU9Zy5nZXQoYSwhMCxjKSksdm9pZCAwPT09ZSYmKGU9eGIoYSxiLGQpKSwibm9ybWFsIj09PWUmJmIgaW4gRGImJihlPURiW2JdKSwiIj09PWN8fGM/KGY9cGFyc2VGbG9hdChlKSxjPT09ITB8fG4uaXNOdW1lcmljKGYpP2Z8fDA6ZSk6ZX19KSxuLmVhY2goWyJoZWlnaHQiLCJ3aWR0aCJdLGZ1bmN0aW9uKGEsYil7bi5jc3NIb29rc1tiXT17Z2V0OmZ1bmN0aW9uKGEsYyxkKXtyZXR1cm4gYz96Yi50ZXN0KG4uY3NzKGEsImRpc3BsYXkiKSkmJjA9PT1hLm9mZnNldFdpZHRoP24uc3dhcChhLENiLGZ1bmN0aW9uKCl7cmV0dXJuIEliKGEsYixkKX0pOkliKGEsYixkKTp2b2lkIDB9LHNldDpmdW5jdGlvbihhLGMsZCl7dmFyIGU9ZCYmd2IoYSk7cmV0dXJuIEdiKGEsYyxkP0hiKGEsYixkLCJib3JkZXItYm94Ij09PW4uY3NzKGEsImJveFNpemluZyIsITEsZSksZSk6MCl9fX0pLG4uY3NzSG9va3MubWFyZ2luUmlnaHQ9eWIoay5yZWxpYWJsZU1hcmdpblJpZ2h0LGZ1bmN0aW9uKGEsYil7cmV0dXJuIGI/bi5zd2FwKGEse2Rpc3BsYXk6ImlubGluZS1ibG9jayJ9LHhiLFthLCJtYXJnaW5SaWdodCJdKTp2b2lkIDB9KSxuLmVhY2goe21hcmdpbjoiIixwYWRkaW5nOiIiLGJvcmRlcjoiV2lkdGgifSxmdW5jdGlvbihhLGIpe24uY3NzSG9va3NbYStiXT17ZXhwYW5kOmZ1bmN0aW9uKGMpe2Zvcih2YXIgZD0wLGU9e30sZj0ic3RyaW5nIj09dHlwZW9mIGM/Yy5zcGxpdCgiICIpOltjXTs0PmQ7ZCsrKWVbYStSW2RdK2JdPWZbZF18fGZbZC0yXXx8ZlswXTtyZXR1cm4gZX19LHViLnRlc3QoYSl8fChuLmNzc0hvb2tzW2ErYl0uc2V0PUdiKX0pLG4uZm4uZXh0ZW5kKHtjc3M6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gSih0aGlzLGZ1bmN0aW9uKGEsYixjKXt2YXIgZCxlLGY9e30sZz0wO2lmKG4uaXNBcnJheShiKSl7Zm9yKGQ9d2IoYSksZT1iLmxlbmd0aDtlPmc7ZysrKWZbYltnXV09bi5jc3MoYSxiW2ddLCExLGQpO3JldHVybiBmfXJldHVybiB2b2lkIDAhPT1jP24uc3R5bGUoYSxiLGMpOm4uY3NzKGEsYil9LGEsYixhcmd1bWVudHMubGVuZ3RoPjEpfSxzaG93OmZ1bmN0aW9uKCl7cmV0dXJuIEpiKHRoaXMsITApfSxoaWRlOmZ1bmN0aW9uKCl7cmV0dXJuIEpiKHRoaXMpfSx0b2dnbGU6ZnVuY3Rpb24oYSl7cmV0dXJuImJvb2xlYW4iPT10eXBlb2YgYT9hP3RoaXMuc2hvdygpOnRoaXMuaGlkZSgpOnRoaXMuZWFjaChmdW5jdGlvbigpe1ModGhpcyk/bih0aGlzKS5zaG93KCk6bih0aGlzKS5oaWRlKCl9KX19KTtmdW5jdGlvbiBLYihhLGIsYyxkLGUpe3JldHVybiBuZXcgS2IucHJvdG90eXBlLmluaXQoYSxiLGMsZCxlKX1uLlR3ZWVuPUtiLEtiLnByb3RvdHlwZT17Y29uc3RydWN0b3I6S2IsaW5pdDpmdW5jdGlvbihhLGIsYyxkLGUsZil7dGhpcy5lbGVtPWEsdGhpcy5wcm9wPWMsdGhpcy5lYXNpbmc9ZXx8InN3aW5nIix0aGlzLm9wdGlvbnM9Yix0aGlzLnN0YXJ0PXRoaXMubm93PXRoaXMuY3VyKCksdGhpcy5lbmQ9ZCx0aGlzLnVuaXQ9Znx8KG4uY3NzTnVtYmVyW2NdPyIiOiJweCIpfSxjdXI6ZnVuY3Rpb24oKXt2YXIgYT1LYi5wcm9wSG9va3NbdGhpcy5wcm9wXTtyZXR1cm4gYSYmYS5nZXQ/YS5nZXQodGhpcyk6S2IucHJvcEhvb2tzLl9kZWZhdWx0LmdldCh0aGlzKX0scnVuOmZ1bmN0aW9uKGEpe3ZhciBiLGM9S2IucHJvcEhvb2tzW3RoaXMucHJvcF07cmV0dXJuIHRoaXMucG9zPWI9dGhpcy5vcHRpb25zLmR1cmF0aW9uP24uZWFzaW5nW3RoaXMuZWFzaW5nXShhLHRoaXMub3B0aW9ucy5kdXJhdGlvbiphLDAsMSx0aGlzLm9wdGlvbnMuZHVyYXRpb24pOmEsdGhpcy5ub3c9KHRoaXMuZW5kLXRoaXMuc3RhcnQpKmIrdGhpcy5zdGFydCx0aGlzLm9wdGlvbnMuc3RlcCYmdGhpcy5vcHRpb25zLnN0ZXAuY2FsbCh0aGlzLmVsZW0sdGhpcy5ub3csdGhpcyksYyYmYy5zZXQ/Yy5zZXQodGhpcyk6S2IucHJvcEhvb2tzLl9kZWZhdWx0LnNldCh0aGlzKSx0aGlzfX0sS2IucHJvdG90eXBlLmluaXQucHJvdG90eXBlPUtiLnByb3RvdHlwZSxLYi5wcm9wSG9va3M9e19kZWZhdWx0OntnZXQ6ZnVuY3Rpb24oYSl7dmFyIGI7cmV0dXJuIG51bGw9PWEuZWxlbVthLnByb3BdfHxhLmVsZW0uc3R5bGUmJm51bGwhPWEuZWxlbS5zdHlsZVthLnByb3BdPyhiPW4uY3NzKGEuZWxlbSxhLnByb3AsIiIpLGImJiJhdXRvIiE9PWI/YjowKTphLmVsZW1bYS5wcm9wXX0sc2V0OmZ1bmN0aW9uKGEpe24uZnguc3RlcFthLnByb3BdP24uZnguc3RlcFthLnByb3BdKGEpOmEuZWxlbS5zdHlsZSYmKG51bGwhPWEuZWxlbS5zdHlsZVtuLmNzc1Byb3BzW2EucHJvcF1dfHxuLmNzc0hvb2tzW2EucHJvcF0pP24uc3R5bGUoYS5lbGVtLGEucHJvcCxhLm5vdythLnVuaXQpOmEuZWxlbVthLnByb3BdPWEubm93fX19LEtiLnByb3BIb29rcy5zY3JvbGxUb3A9S2IucHJvcEhvb2tzLnNjcm9sbExlZnQ9e3NldDpmdW5jdGlvbihhKXthLmVsZW0ubm9kZVR5cGUmJmEuZWxlbS5wYXJlbnROb2RlJiYoYS5lbGVtW2EucHJvcF09YS5ub3cpfX0sbi5lYXNpbmc9e2xpbmVhcjpmdW5jdGlvbihhKXtyZXR1cm4gYX0sc3dpbmc6ZnVuY3Rpb24oYSl7cmV0dXJuLjUtTWF0aC5jb3MoYSpNYXRoLlBJKS8yfX0sbi5meD1LYi5wcm90b3R5cGUuaW5pdCxuLmZ4LnN0ZXA9e307dmFyIExiLE1iLE5iPS9eKD86dG9nZ2xlfHNob3d8aGlkZSkkLyxPYj1uZXcgUmVnRXhwKCJeKD86KFsrLV0pPXwpKCIrUSsiKShbYS16JV0qKSQiLCJpIiksUGI9L3F1ZXVlSG9va3MkLyxRYj1bVmJdLFJiPXsiKiI6W2Z1bmN0aW9uKGEsYil7dmFyIGM9dGhpcy5jcmVhdGVUd2VlbihhLGIpLGQ9Yy5jdXIoKSxlPU9iLmV4ZWMoYiksZj1lJiZlWzNdfHwobi5jc3NOdW1iZXJbYV0/IiI6InB4IiksZz0obi5jc3NOdW1iZXJbYV18fCJweCIhPT1mJiYrZCkmJk9iLmV4ZWMobi5jc3MoYy5lbGVtLGEpKSxoPTEsaT0yMDtpZihnJiZnWzNdIT09Zil7Zj1mfHxnWzNdLGU9ZXx8W10sZz0rZHx8MTtkbyBoPWh8fCIuNSIsZy89aCxuLnN0eWxlKGMuZWxlbSxhLGcrZik7d2hpbGUoaCE9PShoPWMuY3VyKCkvZCkmJjEhPT1oJiYtLWkpfXJldHVybiBlJiYoZz1jLnN0YXJ0PStnfHwrZHx8MCxjLnVuaXQ9ZixjLmVuZD1lWzFdP2crKGVbMV0rMSkqZVsyXTorZVsyXSksY31dfTtmdW5jdGlvbiBTYigpe3JldHVybiBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7TGI9dm9pZCAwfSksTGI9bi5ub3coKX1mdW5jdGlvbiBUYihhLGIpe3ZhciBjLGQ9MCxlPXtoZWlnaHQ6YX07Zm9yKGI9Yj8xOjA7ND5kO2QrPTItYiljPVJbZF0sZVsibWFyZ2luIitjXT1lWyJwYWRkaW5nIitjXT1hO3JldHVybiBiJiYoZS5vcGFjaXR5PWUud2lkdGg9YSksZX1mdW5jdGlvbiBVYihhLGIsYyl7Zm9yKHZhciBkLGU9KFJiW2JdfHxbXSkuY29uY2F0KFJiWyIqIl0pLGY9MCxnPWUubGVuZ3RoO2c+ZjtmKyspaWYoZD1lW2ZdLmNhbGwoYyxiLGEpKXJldHVybiBkfWZ1bmN0aW9uIFZiKGEsYixjKXt2YXIgZCxlLGYsZyxoLGksaixrLGw9dGhpcyxtPXt9LG89YS5zdHlsZSxwPWEubm9kZVR5cGUmJlMoYSkscT1MLmdldChhLCJmeHNob3ciKTtjLnF1ZXVlfHwoaD1uLl9xdWV1ZUhvb2tzKGEsImZ4IiksbnVsbD09aC51bnF1ZXVlZCYmKGgudW5xdWV1ZWQ9MCxpPWguZW1wdHkuZmlyZSxoLmVtcHR5LmZpcmU9ZnVuY3Rpb24oKXtoLnVucXVldWVkfHxpKCl9KSxoLnVucXVldWVkKyssbC5hbHdheXMoZnVuY3Rpb24oKXtsLmFsd2F5cyhmdW5jdGlvbigpe2gudW5xdWV1ZWQtLSxuLnF1ZXVlKGEsImZ4IikubGVuZ3RofHxoLmVtcHR5LmZpcmUoKX0pfSkpLDE9PT1hLm5vZGVUeXBlJiYoImhlaWdodCJpbiBifHwid2lkdGgiaW4gYikmJihjLm92ZXJmbG93PVtvLm92ZXJmbG93LG8ub3ZlcmZsb3dYLG8ub3ZlcmZsb3dZXSxqPW4uY3NzKGEsImRpc3BsYXkiKSxrPSJub25lIj09PWo/TC5nZXQoYSwib2xkZGlzcGxheSIpfHx0YihhLm5vZGVOYW1lKTpqLCJpbmxpbmUiPT09ayYmIm5vbmUiPT09bi5jc3MoYSwiZmxvYXQiKSYmKG8uZGlzcGxheT0iaW5saW5lLWJsb2NrIikpLGMub3ZlcmZsb3cmJihvLm92ZXJmbG93PSJoaWRkZW4iLGwuYWx3YXlzKGZ1bmN0aW9uKCl7by5vdmVyZmxvdz1jLm92ZXJmbG93WzBdLG8ub3ZlcmZsb3dYPWMub3ZlcmZsb3dbMV0sby5vdmVyZmxvd1k9Yy5vdmVyZmxvd1syXX0pKTtmb3IoZCBpbiBiKWlmKGU9YltkXSxOYi5leGVjKGUpKXtpZihkZWxldGUgYltkXSxmPWZ8fCJ0b2dnbGUiPT09ZSxlPT09KHA/ImhpZGUiOiJzaG93Iikpe2lmKCJzaG93IiE9PWV8fCFxfHx2b2lkIDA9PT1xW2RdKWNvbnRpbnVlO3A9ITB9bVtkXT1xJiZxW2RdfHxuLnN0eWxlKGEsZCl9ZWxzZSBqPXZvaWQgMDtpZihuLmlzRW1wdHlPYmplY3QobSkpImlubGluZSI9PT0oIm5vbmUiPT09aj90YihhLm5vZGVOYW1lKTpqKSYmKG8uZGlzcGxheT1qKTtlbHNle3E/ImhpZGRlbiJpbiBxJiYocD1xLmhpZGRlbik6cT1MLmFjY2VzcyhhLCJmeHNob3ciLHt9KSxmJiYocS5oaWRkZW49IXApLHA/bihhKS5zaG93KCk6bC5kb25lKGZ1bmN0aW9uKCl7bihhKS5oaWRlKCl9KSxsLmRvbmUoZnVuY3Rpb24oKXt2YXIgYjtMLnJlbW92ZShhLCJmeHNob3ciKTtmb3IoYiBpbiBtKW4uc3R5bGUoYSxiLG1bYl0pfSk7Zm9yKGQgaW4gbSlnPVViKHA/cVtkXTowLGQsbCksZCBpbiBxfHwocVtkXT1nLnN0YXJ0LHAmJihnLmVuZD1nLnN0YXJ0LGcuc3RhcnQ9IndpZHRoIj09PWR8fCJoZWlnaHQiPT09ZD8xOjApKX19ZnVuY3Rpb24gV2IoYSxiKXt2YXIgYyxkLGUsZixnO2ZvcihjIGluIGEpaWYoZD1uLmNhbWVsQ2FzZShjKSxlPWJbZF0sZj1hW2NdLG4uaXNBcnJheShmKSYmKGU9ZlsxXSxmPWFbY109ZlswXSksYyE9PWQmJihhW2RdPWYsZGVsZXRlIGFbY10pLGc9bi5jc3NIb29rc1tkXSxnJiYiZXhwYW5kImluIGcpe2Y9Zy5leHBhbmQoZiksZGVsZXRlIGFbZF07Zm9yKGMgaW4gZiljIGluIGF8fChhW2NdPWZbY10sYltjXT1lKX1lbHNlIGJbZF09ZX1mdW5jdGlvbiBYYihhLGIsYyl7dmFyIGQsZSxmPTAsZz1RYi5sZW5ndGgsaD1uLkRlZmVycmVkKCkuYWx3YXlzKGZ1bmN0aW9uKCl7ZGVsZXRlIGkuZWxlbX0pLGk9ZnVuY3Rpb24oKXtpZihlKXJldHVybiExO2Zvcih2YXIgYj1MYnx8U2IoKSxjPU1hdGgubWF4KDAsai5zdGFydFRpbWUrai5kdXJhdGlvbi1iKSxkPWMvai5kdXJhdGlvbnx8MCxmPTEtZCxnPTAsaT1qLnR3ZWVucy5sZW5ndGg7aT5nO2crKylqLnR3ZWVuc1tnXS5ydW4oZik7cmV0dXJuIGgubm90aWZ5V2l0aChhLFtqLGYsY10pLDE+ZiYmaT9jOihoLnJlc29sdmVXaXRoKGEsW2pdKSwhMSl9LGo9aC5wcm9taXNlKHtlbGVtOmEscHJvcHM6bi5leHRlbmQoe30sYiksb3B0czpuLmV4dGVuZCghMCx7c3BlY2lhbEVhc2luZzp7fX0sYyksb3JpZ2luYWxQcm9wZXJ0aWVzOmIsb3JpZ2luYWxPcHRpb25zOmMsc3RhcnRUaW1lOkxifHxTYigpLGR1cmF0aW9uOmMuZHVyYXRpb24sdHdlZW5zOltdLGNyZWF0ZVR3ZWVuOmZ1bmN0aW9uKGIsYyl7dmFyIGQ9bi5Ud2VlbihhLGoub3B0cyxiLGMsai5vcHRzLnNwZWNpYWxFYXNpbmdbYl18fGoub3B0cy5lYXNpbmcpO3JldHVybiBqLnR3ZWVucy5wdXNoKGQpLGR9LHN0b3A6ZnVuY3Rpb24oYil7dmFyIGM9MCxkPWI/ai50d2VlbnMubGVuZ3RoOjA7aWYoZSlyZXR1cm4gdGhpcztmb3IoZT0hMDtkPmM7YysrKWoudHdlZW5zW2NdLnJ1bigxKTtyZXR1cm4gYj9oLnJlc29sdmVXaXRoKGEsW2osYl0pOmgucmVqZWN0V2l0aChhLFtqLGJdKSx0aGlzfX0pLGs9ai5wcm9wcztmb3IoV2IoayxqLm9wdHMuc3BlY2lhbEVhc2luZyk7Zz5mO2YrKylpZihkPVFiW2ZdLmNhbGwoaixhLGssai5vcHRzKSlyZXR1cm4gZDtyZXR1cm4gbi5tYXAoayxVYixqKSxuLmlzRnVuY3Rpb24oai5vcHRzLnN0YXJ0KSYmai5vcHRzLnN0YXJ0LmNhbGwoYSxqKSxuLmZ4LnRpbWVyKG4uZXh0ZW5kKGkse2VsZW06YSxhbmltOmoscXVldWU6ai5vcHRzLnF1ZXVlfSkpLGoucHJvZ3Jlc3Moai5vcHRzLnByb2dyZXNzKS5kb25lKGoub3B0cy5kb25lLGoub3B0cy5jb21wbGV0ZSkuZmFpbChqLm9wdHMuZmFpbCkuYWx3YXlzKGoub3B0cy5hbHdheXMpfW4uQW5pbWF0aW9uPW4uZXh0ZW5kKFhiLHt0d2VlbmVyOmZ1bmN0aW9uKGEsYil7bi5pc0Z1bmN0aW9uKGEpPyhiPWEsYT1bIioiXSk6YT1hLnNwbGl0KCIgIik7Zm9yKHZhciBjLGQ9MCxlPWEubGVuZ3RoO2U+ZDtkKyspYz1hW2RdLFJiW2NdPVJiW2NdfHxbXSxSYltjXS51bnNoaWZ0KGIpfSxwcmVmaWx0ZXI6ZnVuY3Rpb24oYSxiKXtiP1FiLnVuc2hpZnQoYSk6UWIucHVzaChhKX19KSxuLnNwZWVkPWZ1bmN0aW9uKGEsYixjKXt2YXIgZD1hJiYib2JqZWN0Ij09dHlwZW9mIGE/bi5leHRlbmQoe30sYSk6e2NvbXBsZXRlOmN8fCFjJiZifHxuLmlzRnVuY3Rpb24oYSkmJmEsZHVyYXRpb246YSxlYXNpbmc6YyYmYnx8YiYmIW4uaXNGdW5jdGlvbihiKSYmYn07cmV0dXJuIGQuZHVyYXRpb249bi5meC5vZmY/MDoibnVtYmVyIj09dHlwZW9mIGQuZHVyYXRpb24/ZC5kdXJhdGlvbjpkLmR1cmF0aW9uIGluIG4uZnguc3BlZWRzP24uZnguc3BlZWRzW2QuZHVyYXRpb25dOm4uZnguc3BlZWRzLl9kZWZhdWx0LChudWxsPT1kLnF1ZXVlfHxkLnF1ZXVlPT09ITApJiYoZC5xdWV1ZT0iZngiKSxkLm9sZD1kLmNvbXBsZXRlLGQuY29tcGxldGU9ZnVuY3Rpb24oKXtuLmlzRnVuY3Rpb24oZC5vbGQpJiZkLm9sZC5jYWxsKHRoaXMpLGQucXVldWUmJm4uZGVxdWV1ZSh0aGlzLGQucXVldWUpfSxkfSxuLmZuLmV4dGVuZCh7ZmFkZVRvOmZ1bmN0aW9uKGEsYixjLGQpe3JldHVybiB0aGlzLmZpbHRlcihTKS5jc3MoIm9wYWNpdHkiLDApLnNob3coKS5lbmQoKS5hbmltYXRlKHtvcGFjaXR5OmJ9LGEsYyxkKX0sYW5pbWF0ZTpmdW5jdGlvbihhLGIsYyxkKXt2YXIgZT1uLmlzRW1wdHlPYmplY3QoYSksZj1uLnNwZWVkKGIsYyxkKSxnPWZ1bmN0aW9uKCl7dmFyIGI9WGIodGhpcyxuLmV4dGVuZCh7fSxhKSxmKTsoZXx8TC5nZXQodGhpcywiZmluaXNoIikpJiZiLnN0b3AoITApfTtyZXR1cm4gZy5maW5pc2g9ZyxlfHxmLnF1ZXVlPT09ITE/dGhpcy5lYWNoKGcpOnRoaXMucXVldWUoZi5xdWV1ZSxnKX0sc3RvcDpmdW5jdGlvbihhLGIsYyl7dmFyIGQ9ZnVuY3Rpb24oYSl7dmFyIGI9YS5zdG9wO2RlbGV0ZSBhLnN0b3AsYihjKX07cmV0dXJuInN0cmluZyIhPXR5cGVvZiBhJiYoYz1iLGI9YSxhPXZvaWQgMCksYiYmYSE9PSExJiZ0aGlzLnF1ZXVlKGF8fCJmeCIsW10pLHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBiPSEwLGU9bnVsbCE9YSYmYSsicXVldWVIb29rcyIsZj1uLnRpbWVycyxnPUwuZ2V0KHRoaXMpO2lmKGUpZ1tlXSYmZ1tlXS5zdG9wJiZkKGdbZV0pO2Vsc2UgZm9yKGUgaW4gZylnW2VdJiZnW2VdLnN0b3AmJlBiLnRlc3QoZSkmJmQoZ1tlXSk7Zm9yKGU9Zi5sZW5ndGg7ZS0tOylmW2VdLmVsZW0hPT10aGlzfHxudWxsIT1hJiZmW2VdLnF1ZXVlIT09YXx8KGZbZV0uYW5pbS5zdG9wKGMpLGI9ITEsZi5zcGxpY2UoZSwxKSk7KGJ8fCFjKSYmbi5kZXF1ZXVlKHRoaXMsYSl9KX0sZmluaXNoOmZ1bmN0aW9uKGEpe3JldHVybiBhIT09ITEmJihhPWF8fCJmeCIpLHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBiLGM9TC5nZXQodGhpcyksZD1jW2ErInF1ZXVlIl0sZT1jW2ErInF1ZXVlSG9va3MiXSxmPW4udGltZXJzLGc9ZD9kLmxlbmd0aDowO2ZvcihjLmZpbmlzaD0hMCxuLnF1ZXVlKHRoaXMsYSxbXSksZSYmZS5zdG9wJiZlLnN0b3AuY2FsbCh0aGlzLCEwKSxiPWYubGVuZ3RoO2ItLTspZltiXS5lbGVtPT09dGhpcyYmZltiXS5xdWV1ZT09PWEmJihmW2JdLmFuaW0uc3RvcCghMCksZi5zcGxpY2UoYiwxKSk7Zm9yKGI9MDtnPmI7YisrKWRbYl0mJmRbYl0uZmluaXNoJiZkW2JdLmZpbmlzaC5jYWxsKHRoaXMpO2RlbGV0ZSBjLmZpbmlzaH0pfX0pLG4uZWFjaChbInRvZ2dsZSIsInNob3ciLCJoaWRlIl0sZnVuY3Rpb24oYSxiKXt2YXIgYz1uLmZuW2JdO24uZm5bYl09ZnVuY3Rpb24oYSxkLGUpe3JldHVybiBudWxsPT1hfHwiYm9vbGVhbiI9PXR5cGVvZiBhP2MuYXBwbHkodGhpcyxhcmd1bWVudHMpOnRoaXMuYW5pbWF0ZShUYihiLCEwKSxhLGQsZSl9fSksbi5lYWNoKHtzbGlkZURvd246VGIoInNob3ciKSxzbGlkZVVwOlRiKCJoaWRlIiksc2xpZGVUb2dnbGU6VGIoInRvZ2dsZSIpLGZhZGVJbjp7b3BhY2l0eToic2hvdyJ9LGZhZGVPdXQ6e29wYWNpdHk6ImhpZGUifSxmYWRlVG9nZ2xlOntvcGFjaXR5OiJ0b2dnbGUifX0sZnVuY3Rpb24oYSxiKXtuLmZuW2FdPWZ1bmN0aW9uKGEsYyxkKXtyZXR1cm4gdGhpcy5hbmltYXRlKGIsYSxjLGQpfX0pLG4udGltZXJzPVtdLG4uZngudGljaz1mdW5jdGlvbigpe3ZhciBhLGI9MCxjPW4udGltZXJzO2ZvcihMYj1uLm5vdygpO2I8Yy5sZW5ndGg7YisrKWE9Y1tiXSxhKCl8fGNbYl0hPT1hfHxjLnNwbGljZShiLS0sMSk7Yy5sZW5ndGh8fG4uZnguc3RvcCgpLExiPXZvaWQgMH0sbi5meC50aW1lcj1mdW5jdGlvbihhKXtuLnRpbWVycy5wdXNoKGEpLGEoKT9uLmZ4LnN0YXJ0KCk6bi50aW1lcnMucG9wKCl9LG4uZnguaW50ZXJ2YWw9MTMsbi5meC5zdGFydD1mdW5jdGlvbigpe01ifHwoTWI9c2V0SW50ZXJ2YWwobi5meC50aWNrLG4uZnguaW50ZXJ2YWwpKX0sbi5meC5zdG9wPWZ1bmN0aW9uKCl7Y2xlYXJJbnRlcnZhbChNYiksTWI9bnVsbH0sbi5meC5zcGVlZHM9e3Nsb3c6NjAwLGZhc3Q6MjAwLF9kZWZhdWx0OjQwMH0sbi5mbi5kZWxheT1mdW5jdGlvbihhLGIpe3JldHVybiBhPW4uZng/bi5meC5zcGVlZHNbYV18fGE6YSxiPWJ8fCJmeCIsdGhpcy5xdWV1ZShiLGZ1bmN0aW9uKGIsYyl7dmFyIGQ9c2V0VGltZW91dChiLGEpO2Muc3RvcD1mdW5jdGlvbigpe2NsZWFyVGltZW91dChkKX19KX0sZnVuY3Rpb24oKXt2YXIgYT1sLmNyZWF0ZUVsZW1lbnQoImlucHV0IiksYj1sLmNyZWF0ZUVsZW1lbnQoInNlbGVjdCIpLGM9Yi5hcHBlbmRDaGlsZChsLmNyZWF0ZUVsZW1lbnQoIm9wdGlvbiIpKTthLnR5cGU9ImNoZWNrYm94IixrLmNoZWNrT249IiIhPT1hLnZhbHVlLGsub3B0U2VsZWN0ZWQ9Yy5zZWxlY3RlZCxiLmRpc2FibGVkPSEwLGsub3B0RGlzYWJsZWQ9IWMuZGlzYWJsZWQsYT1sLmNyZWF0ZUVsZW1lbnQoImlucHV0IiksYS52YWx1ZT0idCIsYS50eXBlPSJyYWRpbyIsay5yYWRpb1ZhbHVlPSJ0Ij09PWEudmFsdWV9KCk7dmFyIFliLFpiLCRiPW4uZXhwci5hdHRySGFuZGxlO24uZm4uZXh0ZW5kKHthdHRyOmZ1bmN0aW9uKGEsYil7cmV0dXJuIEoodGhpcyxuLmF0dHIsYSxiLGFyZ3VtZW50cy5sZW5ndGg+MSl9LHJlbW92ZUF0dHI6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe24ucmVtb3ZlQXR0cih0aGlzLGEpfSl9fSksbi5leHRlbmQoe2F0dHI6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkLGUsZj1hLm5vZGVUeXBlO2lmKGEmJjMhPT1mJiY4IT09ZiYmMiE9PWYpcmV0dXJuIHR5cGVvZiBhLmdldEF0dHJpYnV0ZT09PVU/bi5wcm9wKGEsYixjKTooMT09PWYmJm4uaXNYTUxEb2MoYSl8fChiPWIudG9Mb3dlckNhc2UoKSxkPW4uYXR0ckhvb2tzW2JdfHwobi5leHByLm1hdGNoLmJvb2wudGVzdChiKT9aYjpZYikpLHZvaWQgMD09PWM/ZCYmImdldCJpbiBkJiZudWxsIT09KGU9ZC5nZXQoYSxiKSk/ZTooZT1uLmZpbmQuYXR0cihhLGIpLG51bGw9PWU/dm9pZCAwOmUpOm51bGwhPT1jP2QmJiJzZXQiaW4gZCYmdm9pZCAwIT09KGU9ZC5zZXQoYSxjLGIpKT9lOihhLnNldEF0dHJpYnV0ZShiLGMrIiIpLGMpOnZvaWQgbi5yZW1vdmVBdHRyKGEsYikpCn0scmVtb3ZlQXR0cjpmdW5jdGlvbihhLGIpe3ZhciBjLGQsZT0wLGY9YiYmYi5tYXRjaChFKTtpZihmJiYxPT09YS5ub2RlVHlwZSl3aGlsZShjPWZbZSsrXSlkPW4ucHJvcEZpeFtjXXx8YyxuLmV4cHIubWF0Y2guYm9vbC50ZXN0KGMpJiYoYVtkXT0hMSksYS5yZW1vdmVBdHRyaWJ1dGUoYyl9LGF0dHJIb29rczp7dHlwZTp7c2V0OmZ1bmN0aW9uKGEsYil7aWYoIWsucmFkaW9WYWx1ZSYmInJhZGlvIj09PWImJm4ubm9kZU5hbWUoYSwiaW5wdXQiKSl7dmFyIGM9YS52YWx1ZTtyZXR1cm4gYS5zZXRBdHRyaWJ1dGUoInR5cGUiLGIpLGMmJihhLnZhbHVlPWMpLGJ9fX19fSksWmI9e3NldDpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIGI9PT0hMT9uLnJlbW92ZUF0dHIoYSxjKTphLnNldEF0dHJpYnV0ZShjLGMpLGN9fSxuLmVhY2gobi5leHByLm1hdGNoLmJvb2wuc291cmNlLm1hdGNoKC9cdysvZyksZnVuY3Rpb24oYSxiKXt2YXIgYz0kYltiXXx8bi5maW5kLmF0dHI7JGJbYl09ZnVuY3Rpb24oYSxiLGQpe3ZhciBlLGY7cmV0dXJuIGR8fChmPSRiW2JdLCRiW2JdPWUsZT1udWxsIT1jKGEsYixkKT9iLnRvTG93ZXJDYXNlKCk6bnVsbCwkYltiXT1mKSxlfX0pO3ZhciBfYj0vXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYXxidXR0b24pJC9pO24uZm4uZXh0ZW5kKHtwcm9wOmZ1bmN0aW9uKGEsYil7cmV0dXJuIEoodGhpcyxuLnByb3AsYSxiLGFyZ3VtZW50cy5sZW5ndGg+MSl9LHJlbW92ZVByb3A6ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2RlbGV0ZSB0aGlzW24ucHJvcEZpeFthXXx8YV19KX19KSxuLmV4dGVuZCh7cHJvcEZpeDp7ImZvciI6Imh0bWxGb3IiLCJjbGFzcyI6ImNsYXNzTmFtZSJ9LHByb3A6ZnVuY3Rpb24oYSxiLGMpe3ZhciBkLGUsZixnPWEubm9kZVR5cGU7aWYoYSYmMyE9PWcmJjghPT1nJiYyIT09ZylyZXR1cm4gZj0xIT09Z3x8IW4uaXNYTUxEb2MoYSksZiYmKGI9bi5wcm9wRml4W2JdfHxiLGU9bi5wcm9wSG9va3NbYl0pLHZvaWQgMCE9PWM/ZSYmInNldCJpbiBlJiZ2b2lkIDAhPT0oZD1lLnNldChhLGMsYikpP2Q6YVtiXT1jOmUmJiJnZXQiaW4gZSYmbnVsbCE9PShkPWUuZ2V0KGEsYikpP2Q6YVtiXX0scHJvcEhvb2tzOnt0YWJJbmRleDp7Z2V0OmZ1bmN0aW9uKGEpe3JldHVybiBhLmhhc0F0dHJpYnV0ZSgidGFiaW5kZXgiKXx8X2IudGVzdChhLm5vZGVOYW1lKXx8YS5ocmVmP2EudGFiSW5kZXg6LTF9fX19KSxrLm9wdFNlbGVjdGVkfHwobi5wcm9wSG9va3Muc2VsZWN0ZWQ9e2dldDpmdW5jdGlvbihhKXt2YXIgYj1hLnBhcmVudE5vZGU7cmV0dXJuIGImJmIucGFyZW50Tm9kZSYmYi5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXgsbnVsbH19KSxuLmVhY2goWyJ0YWJJbmRleCIsInJlYWRPbmx5IiwibWF4TGVuZ3RoIiwiY2VsbFNwYWNpbmciLCJjZWxsUGFkZGluZyIsInJvd1NwYW4iLCJjb2xTcGFuIiwidXNlTWFwIiwiZnJhbWVCb3JkZXIiLCJjb250ZW50RWRpdGFibGUiXSxmdW5jdGlvbigpe24ucHJvcEZpeFt0aGlzLnRvTG93ZXJDYXNlKCldPXRoaXN9KTt2YXIgYWM9L1tcdFxyXG5cZl0vZztuLmZuLmV4dGVuZCh7YWRkQ2xhc3M6ZnVuY3Rpb24oYSl7dmFyIGIsYyxkLGUsZixnLGg9InN0cmluZyI9PXR5cGVvZiBhJiZhLGk9MCxqPXRoaXMubGVuZ3RoO2lmKG4uaXNGdW5jdGlvbihhKSlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKGIpe24odGhpcykuYWRkQ2xhc3MoYS5jYWxsKHRoaXMsYix0aGlzLmNsYXNzTmFtZSkpfSk7aWYoaClmb3IoYj0oYXx8IiIpLm1hdGNoKEUpfHxbXTtqPmk7aSsrKWlmKGM9dGhpc1tpXSxkPTE9PT1jLm5vZGVUeXBlJiYoYy5jbGFzc05hbWU/KCIgIitjLmNsYXNzTmFtZSsiICIpLnJlcGxhY2UoYWMsIiAiKToiICIpKXtmPTA7d2hpbGUoZT1iW2YrK10pZC5pbmRleE9mKCIgIitlKyIgIik8MCYmKGQrPWUrIiAiKTtnPW4udHJpbShkKSxjLmNsYXNzTmFtZSE9PWcmJihjLmNsYXNzTmFtZT1nKX1yZXR1cm4gdGhpc30scmVtb3ZlQ2xhc3M6ZnVuY3Rpb24oYSl7dmFyIGIsYyxkLGUsZixnLGg9MD09PWFyZ3VtZW50cy5sZW5ndGh8fCJzdHJpbmciPT10eXBlb2YgYSYmYSxpPTAsaj10aGlzLmxlbmd0aDtpZihuLmlzRnVuY3Rpb24oYSkpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihiKXtuKHRoaXMpLnJlbW92ZUNsYXNzKGEuY2FsbCh0aGlzLGIsdGhpcy5jbGFzc05hbWUpKX0pO2lmKGgpZm9yKGI9KGF8fCIiKS5tYXRjaChFKXx8W107aj5pO2krKylpZihjPXRoaXNbaV0sZD0xPT09Yy5ub2RlVHlwZSYmKGMuY2xhc3NOYW1lPygiICIrYy5jbGFzc05hbWUrIiAiKS5yZXBsYWNlKGFjLCIgIik6IiIpKXtmPTA7d2hpbGUoZT1iW2YrK10pd2hpbGUoZC5pbmRleE9mKCIgIitlKyIgIik+PTApZD1kLnJlcGxhY2UoIiAiK2UrIiAiLCIgIik7Zz1hP24udHJpbShkKToiIixjLmNsYXNzTmFtZSE9PWcmJihjLmNsYXNzTmFtZT1nKX1yZXR1cm4gdGhpc30sdG9nZ2xlQ2xhc3M6ZnVuY3Rpb24oYSxiKXt2YXIgYz10eXBlb2YgYTtyZXR1cm4iYm9vbGVhbiI9PXR5cGVvZiBiJiYic3RyaW5nIj09PWM/Yj90aGlzLmFkZENsYXNzKGEpOnRoaXMucmVtb3ZlQ2xhc3MoYSk6dGhpcy5lYWNoKG4uaXNGdW5jdGlvbihhKT9mdW5jdGlvbihjKXtuKHRoaXMpLnRvZ2dsZUNsYXNzKGEuY2FsbCh0aGlzLGMsdGhpcy5jbGFzc05hbWUsYiksYil9OmZ1bmN0aW9uKCl7aWYoInN0cmluZyI9PT1jKXt2YXIgYixkPTAsZT1uKHRoaXMpLGY9YS5tYXRjaChFKXx8W107d2hpbGUoYj1mW2QrK10pZS5oYXNDbGFzcyhiKT9lLnJlbW92ZUNsYXNzKGIpOmUuYWRkQ2xhc3MoYil9ZWxzZShjPT09VXx8ImJvb2xlYW4iPT09YykmJih0aGlzLmNsYXNzTmFtZSYmTC5zZXQodGhpcywiX19jbGFzc05hbWVfXyIsdGhpcy5jbGFzc05hbWUpLHRoaXMuY2xhc3NOYW1lPXRoaXMuY2xhc3NOYW1lfHxhPT09ITE/IiI6TC5nZXQodGhpcywiX19jbGFzc05hbWVfXyIpfHwiIil9KX0saGFzQ2xhc3M6ZnVuY3Rpb24oYSl7Zm9yKHZhciBiPSIgIithKyIgIixjPTAsZD10aGlzLmxlbmd0aDtkPmM7YysrKWlmKDE9PT10aGlzW2NdLm5vZGVUeXBlJiYoIiAiK3RoaXNbY10uY2xhc3NOYW1lKyIgIikucmVwbGFjZShhYywiICIpLmluZGV4T2YoYik+PTApcmV0dXJuITA7cmV0dXJuITF9fSk7dmFyIGJjPS9cci9nO24uZm4uZXh0ZW5kKHt2YWw6ZnVuY3Rpb24oYSl7dmFyIGIsYyxkLGU9dGhpc1swXTt7aWYoYXJndW1lbnRzLmxlbmd0aClyZXR1cm4gZD1uLmlzRnVuY3Rpb24oYSksdGhpcy5lYWNoKGZ1bmN0aW9uKGMpe3ZhciBlOzE9PT10aGlzLm5vZGVUeXBlJiYoZT1kP2EuY2FsbCh0aGlzLGMsbih0aGlzKS52YWwoKSk6YSxudWxsPT1lP2U9IiI6Im51bWJlciI9PXR5cGVvZiBlP2UrPSIiOm4uaXNBcnJheShlKSYmKGU9bi5tYXAoZSxmdW5jdGlvbihhKXtyZXR1cm4gbnVsbD09YT8iIjphKyIifSkpLGI9bi52YWxIb29rc1t0aGlzLnR5cGVdfHxuLnZhbEhvb2tzW3RoaXMubm9kZU5hbWUudG9Mb3dlckNhc2UoKV0sYiYmInNldCJpbiBiJiZ2b2lkIDAhPT1iLnNldCh0aGlzLGUsInZhbHVlIil8fCh0aGlzLnZhbHVlPWUpKX0pO2lmKGUpcmV0dXJuIGI9bi52YWxIb29rc1tlLnR5cGVdfHxuLnZhbEhvb2tzW2Uubm9kZU5hbWUudG9Mb3dlckNhc2UoKV0sYiYmImdldCJpbiBiJiZ2b2lkIDAhPT0oYz1iLmdldChlLCJ2YWx1ZSIpKT9jOihjPWUudmFsdWUsInN0cmluZyI9PXR5cGVvZiBjP2MucmVwbGFjZShiYywiIik6bnVsbD09Yz8iIjpjKX19fSksbi5leHRlbmQoe3ZhbEhvb2tzOntvcHRpb246e2dldDpmdW5jdGlvbihhKXt2YXIgYj1uLmZpbmQuYXR0cihhLCJ2YWx1ZSIpO3JldHVybiBudWxsIT1iP2I6bi50cmltKG4udGV4dChhKSl9fSxzZWxlY3Q6e2dldDpmdW5jdGlvbihhKXtmb3IodmFyIGIsYyxkPWEub3B0aW9ucyxlPWEuc2VsZWN0ZWRJbmRleCxmPSJzZWxlY3Qtb25lIj09PWEudHlwZXx8MD5lLGc9Zj9udWxsOltdLGg9Zj9lKzE6ZC5sZW5ndGgsaT0wPmU/aDpmP2U6MDtoPmk7aSsrKWlmKGM9ZFtpXSwhKCFjLnNlbGVjdGVkJiZpIT09ZXx8KGsub3B0RGlzYWJsZWQ/Yy5kaXNhYmxlZDpudWxsIT09Yy5nZXRBdHRyaWJ1dGUoImRpc2FibGVkIikpfHxjLnBhcmVudE5vZGUuZGlzYWJsZWQmJm4ubm9kZU5hbWUoYy5wYXJlbnROb2RlLCJvcHRncm91cCIpKSl7aWYoYj1uKGMpLnZhbCgpLGYpcmV0dXJuIGI7Zy5wdXNoKGIpfXJldHVybiBnfSxzZXQ6ZnVuY3Rpb24oYSxiKXt2YXIgYyxkLGU9YS5vcHRpb25zLGY9bi5tYWtlQXJyYXkoYiksZz1lLmxlbmd0aDt3aGlsZShnLS0pZD1lW2ddLChkLnNlbGVjdGVkPW4uaW5BcnJheShkLnZhbHVlLGYpPj0wKSYmKGM9ITApO3JldHVybiBjfHwoYS5zZWxlY3RlZEluZGV4PS0xKSxmfX19fSksbi5lYWNoKFsicmFkaW8iLCJjaGVja2JveCJdLGZ1bmN0aW9uKCl7bi52YWxIb29rc1t0aGlzXT17c2V0OmZ1bmN0aW9uKGEsYil7cmV0dXJuIG4uaXNBcnJheShiKT9hLmNoZWNrZWQ9bi5pbkFycmF5KG4oYSkudmFsKCksYik+PTA6dm9pZCAwfX0say5jaGVja09ufHwobi52YWxIb29rc1t0aGlzXS5nZXQ9ZnVuY3Rpb24oYSl7cmV0dXJuIG51bGw9PT1hLmdldEF0dHJpYnV0ZSgidmFsdWUiKT8ib24iOmEudmFsdWV9KX0pLG4uZWFjaCgiYmx1ciBmb2N1cyBmb2N1c2luIGZvY3Vzb3V0IGxvYWQgcmVzaXplIHNjcm9sbCB1bmxvYWQgY2xpY2sgZGJsY2xpY2sgbW91c2Vkb3duIG1vdXNldXAgbW91c2Vtb3ZlIG1vdXNlb3ZlciBtb3VzZW91dCBtb3VzZWVudGVyIG1vdXNlbGVhdmUgY2hhbmdlIHNlbGVjdCBzdWJtaXQga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBlcnJvciBjb250ZXh0bWVudSIuc3BsaXQoIiAiKSxmdW5jdGlvbihhLGIpe24uZm5bYl09ZnVuY3Rpb24oYSxjKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD4wP3RoaXMub24oYixudWxsLGEsYyk6dGhpcy50cmlnZ2VyKGIpfX0pLG4uZm4uZXh0ZW5kKHtob3ZlcjpmdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLm1vdXNlZW50ZXIoYSkubW91c2VsZWF2ZShifHxhKX0sYmluZDpmdW5jdGlvbihhLGIsYyl7cmV0dXJuIHRoaXMub24oYSxudWxsLGIsYyl9LHVuYmluZDpmdW5jdGlvbihhLGIpe3JldHVybiB0aGlzLm9mZihhLG51bGwsYil9LGRlbGVnYXRlOmZ1bmN0aW9uKGEsYixjLGQpe3JldHVybiB0aGlzLm9uKGIsYSxjLGQpfSx1bmRlbGVnYXRlOmZ1bmN0aW9uKGEsYixjKXtyZXR1cm4gMT09PWFyZ3VtZW50cy5sZW5ndGg/dGhpcy5vZmYoYSwiKioiKTp0aGlzLm9mZihiLGF8fCIqKiIsYyl9fSk7dmFyIGNjPW4ubm93KCksZGM9L1w/LztuLnBhcnNlSlNPTj1mdW5jdGlvbihhKXtyZXR1cm4gSlNPTi5wYXJzZShhKyIiKX0sbi5wYXJzZVhNTD1mdW5jdGlvbihhKXt2YXIgYixjO2lmKCFhfHwic3RyaW5nIiE9dHlwZW9mIGEpcmV0dXJuIG51bGw7dHJ5e2M9bmV3IERPTVBhcnNlcixiPWMucGFyc2VGcm9tU3RyaW5nKGEsInRleHQveG1sIil9Y2F0Y2goZCl7Yj12b2lkIDB9cmV0dXJuKCFifHxiLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJwYXJzZXJlcnJvciIpLmxlbmd0aCkmJm4uZXJyb3IoIkludmFsaWQgWE1MOiAiK2EpLGJ9O3ZhciBlYz0vIy4qJC8sZmM9LyhbPyZdKV89W14mXSovLGdjPS9eKC4qPyk6WyBcdF0qKFteXHJcbl0qKSQvZ20saGM9L14oPzphYm91dHxhcHB8YXBwLXN0b3JhZ2V8ListZXh0ZW5zaW9ufGZpbGV8cmVzfHdpZGdldCk6JC8saWM9L14oPzpHRVR8SEVBRCkkLyxqYz0vXlwvXC8vLGtjPS9eKFtcdy4rLV0rOikoPzpcL1wvKD86W15cLz8jXSpAfCkoW15cLz8jOl0qKSg/OjooXGQrKXwpfCkvLGxjPXt9LG1jPXt9LG5jPSIqLyIuY29uY2F0KCIqIiksb2M9YS5sb2NhdGlvbi5ocmVmLHBjPWtjLmV4ZWMob2MudG9Mb3dlckNhc2UoKSl8fFtdO2Z1bmN0aW9uIHFjKGEpe3JldHVybiBmdW5jdGlvbihiLGMpeyJzdHJpbmciIT10eXBlb2YgYiYmKGM9YixiPSIqIik7dmFyIGQsZT0wLGY9Yi50b0xvd2VyQ2FzZSgpLm1hdGNoKEUpfHxbXTtpZihuLmlzRnVuY3Rpb24oYykpd2hpbGUoZD1mW2UrK10pIisiPT09ZFswXT8oZD1kLnNsaWNlKDEpfHwiKiIsKGFbZF09YVtkXXx8W10pLnVuc2hpZnQoYykpOihhW2RdPWFbZF18fFtdKS5wdXNoKGMpfX1mdW5jdGlvbiByYyhhLGIsYyxkKXt2YXIgZT17fSxmPWE9PT1tYztmdW5jdGlvbiBnKGgpe3ZhciBpO3JldHVybiBlW2hdPSEwLG4uZWFjaChhW2hdfHxbXSxmdW5jdGlvbihhLGgpe3ZhciBqPWgoYixjLGQpO3JldHVybiJzdHJpbmciIT10eXBlb2Yganx8Znx8ZVtqXT9mPyEoaT1qKTp2b2lkIDA6KGIuZGF0YVR5cGVzLnVuc2hpZnQoaiksZyhqKSwhMSl9KSxpfXJldHVybiBnKGIuZGF0YVR5cGVzWzBdKXx8IWVbIioiXSYmZygiKiIpfWZ1bmN0aW9uIHNjKGEsYil7dmFyIGMsZCxlPW4uYWpheFNldHRpbmdzLmZsYXRPcHRpb25zfHx7fTtmb3IoYyBpbiBiKXZvaWQgMCE9PWJbY10mJigoZVtjXT9hOmR8fChkPXt9KSlbY109YltjXSk7cmV0dXJuIGQmJm4uZXh0ZW5kKCEwLGEsZCksYX1mdW5jdGlvbiB0YyhhLGIsYyl7dmFyIGQsZSxmLGcsaD1hLmNvbnRlbnRzLGk9YS5kYXRhVHlwZXM7d2hpbGUoIioiPT09aVswXSlpLnNoaWZ0KCksdm9pZCAwPT09ZCYmKGQ9YS5taW1lVHlwZXx8Yi5nZXRSZXNwb25zZUhlYWRlcigiQ29udGVudC1UeXBlIikpO2lmKGQpZm9yKGUgaW4gaClpZihoW2VdJiZoW2VdLnRlc3QoZCkpe2kudW5zaGlmdChlKTticmVha31pZihpWzBdaW4gYylmPWlbMF07ZWxzZXtmb3IoZSBpbiBjKXtpZighaVswXXx8YS5jb252ZXJ0ZXJzW2UrIiAiK2lbMF1dKXtmPWU7YnJlYWt9Z3x8KGc9ZSl9Zj1mfHxnfXJldHVybiBmPyhmIT09aVswXSYmaS51bnNoaWZ0KGYpLGNbZl0pOnZvaWQgMH1mdW5jdGlvbiB1YyhhLGIsYyxkKXt2YXIgZSxmLGcsaCxpLGo9e30saz1hLmRhdGFUeXBlcy5zbGljZSgpO2lmKGtbMV0pZm9yKGcgaW4gYS5jb252ZXJ0ZXJzKWpbZy50b0xvd2VyQ2FzZSgpXT1hLmNvbnZlcnRlcnNbZ107Zj1rLnNoaWZ0KCk7d2hpbGUoZilpZihhLnJlc3BvbnNlRmllbGRzW2ZdJiYoY1thLnJlc3BvbnNlRmllbGRzW2ZdXT1iKSwhaSYmZCYmYS5kYXRhRmlsdGVyJiYoYj1hLmRhdGFGaWx0ZXIoYixhLmRhdGFUeXBlKSksaT1mLGY9ay5zaGlmdCgpKWlmKCIqIj09PWYpZj1pO2Vsc2UgaWYoIioiIT09aSYmaSE9PWYpe2lmKGc9altpKyIgIitmXXx8alsiKiAiK2ZdLCFnKWZvcihlIGluIGopaWYoaD1lLnNwbGl0KCIgIiksaFsxXT09PWYmJihnPWpbaSsiICIraFswXV18fGpbIiogIitoWzBdXSkpe2c9PT0hMD9nPWpbZV06altlXSE9PSEwJiYoZj1oWzBdLGsudW5zaGlmdChoWzFdKSk7YnJlYWt9aWYoZyE9PSEwKWlmKGcmJmFbInRocm93cyJdKWI9ZyhiKTtlbHNlIHRyeXtiPWcoYil9Y2F0Y2gobCl7cmV0dXJue3N0YXRlOiJwYXJzZXJlcnJvciIsZXJyb3I6Zz9sOiJObyBjb252ZXJzaW9uIGZyb20gIitpKyIgdG8gIitmfX19cmV0dXJue3N0YXRlOiJzdWNjZXNzIixkYXRhOmJ9fW4uZXh0ZW5kKHthY3RpdmU6MCxsYXN0TW9kaWZpZWQ6e30sZXRhZzp7fSxhamF4U2V0dGluZ3M6e3VybDpvYyx0eXBlOiJHRVQiLGlzTG9jYWw6aGMudGVzdChwY1sxXSksZ2xvYmFsOiEwLHByb2Nlc3NEYXRhOiEwLGFzeW5jOiEwLGNvbnRlbnRUeXBlOiJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQ7IGNoYXJzZXQ9VVRGLTgiLGFjY2VwdHM6eyIqIjpuYyx0ZXh0OiJ0ZXh0L3BsYWluIixodG1sOiJ0ZXh0L2h0bWwiLHhtbDoiYXBwbGljYXRpb24veG1sLCB0ZXh0L3htbCIsanNvbjoiYXBwbGljYXRpb24vanNvbiwgdGV4dC9qYXZhc2NyaXB0In0sY29udGVudHM6e3htbDoveG1sLyxodG1sOi9odG1sLyxqc29uOi9qc29uL30scmVzcG9uc2VGaWVsZHM6e3htbDoicmVzcG9uc2VYTUwiLHRleHQ6InJlc3BvbnNlVGV4dCIsanNvbjoicmVzcG9uc2VKU09OIn0sY29udmVydGVyczp7IiogdGV4dCI6U3RyaW5nLCJ0ZXh0IGh0bWwiOiEwLCJ0ZXh0IGpzb24iOm4ucGFyc2VKU09OLCJ0ZXh0IHhtbCI6bi5wYXJzZVhNTH0sZmxhdE9wdGlvbnM6e3VybDohMCxjb250ZXh0OiEwfX0sYWpheFNldHVwOmZ1bmN0aW9uKGEsYil7cmV0dXJuIGI/c2Moc2MoYSxuLmFqYXhTZXR0aW5ncyksYik6c2Mobi5hamF4U2V0dGluZ3MsYSl9LGFqYXhQcmVmaWx0ZXI6cWMobGMpLGFqYXhUcmFuc3BvcnQ6cWMobWMpLGFqYXg6ZnVuY3Rpb24oYSxiKXsib2JqZWN0Ij09dHlwZW9mIGEmJihiPWEsYT12b2lkIDApLGI9Ynx8e307dmFyIGMsZCxlLGYsZyxoLGksaixrPW4uYWpheFNldHVwKHt9LGIpLGw9ay5jb250ZXh0fHxrLG09ay5jb250ZXh0JiYobC5ub2RlVHlwZXx8bC5qcXVlcnkpP24obCk6bi5ldmVudCxvPW4uRGVmZXJyZWQoKSxwPW4uQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLHE9ay5zdGF0dXNDb2RlfHx7fSxyPXt9LHM9e30sdD0wLHU9ImNhbmNlbGVkIix2PXtyZWFkeVN0YXRlOjAsZ2V0UmVzcG9uc2VIZWFkZXI6ZnVuY3Rpb24oYSl7dmFyIGI7aWYoMj09PXQpe2lmKCFmKXtmPXt9O3doaWxlKGI9Z2MuZXhlYyhlKSlmW2JbMV0udG9Mb3dlckNhc2UoKV09YlsyXX1iPWZbYS50b0xvd2VyQ2FzZSgpXX1yZXR1cm4gbnVsbD09Yj9udWxsOmJ9LGdldEFsbFJlc3BvbnNlSGVhZGVyczpmdW5jdGlvbigpe3JldHVybiAyPT09dD9lOm51bGx9LHNldFJlcXVlc3RIZWFkZXI6ZnVuY3Rpb24oYSxiKXt2YXIgYz1hLnRvTG93ZXJDYXNlKCk7cmV0dXJuIHR8fChhPXNbY109c1tjXXx8YSxyW2FdPWIpLHRoaXN9LG92ZXJyaWRlTWltZVR5cGU6ZnVuY3Rpb24oYSl7cmV0dXJuIHR8fChrLm1pbWVUeXBlPWEpLHRoaXN9LHN0YXR1c0NvZGU6ZnVuY3Rpb24oYSl7dmFyIGI7aWYoYSlpZigyPnQpZm9yKGIgaW4gYSlxW2JdPVtxW2JdLGFbYl1dO2Vsc2Ugdi5hbHdheXMoYVt2LnN0YXR1c10pO3JldHVybiB0aGlzfSxhYm9ydDpmdW5jdGlvbihhKXt2YXIgYj1hfHx1O3JldHVybiBjJiZjLmFib3J0KGIpLHgoMCxiKSx0aGlzfX07aWYoby5wcm9taXNlKHYpLmNvbXBsZXRlPXAuYWRkLHYuc3VjY2Vzcz12LmRvbmUsdi5lcnJvcj12LmZhaWwsay51cmw9KChhfHxrLnVybHx8b2MpKyIiKS5yZXBsYWNlKGVjLCIiKS5yZXBsYWNlKGpjLHBjWzFdKyIvLyIpLGsudHlwZT1iLm1ldGhvZHx8Yi50eXBlfHxrLm1ldGhvZHx8ay50eXBlLGsuZGF0YVR5cGVzPW4udHJpbShrLmRhdGFUeXBlfHwiKiIpLnRvTG93ZXJDYXNlKCkubWF0Y2goRSl8fFsiIl0sbnVsbD09ay5jcm9zc0RvbWFpbiYmKGg9a2MuZXhlYyhrLnVybC50b0xvd2VyQ2FzZSgpKSxrLmNyb3NzRG9tYWluPSEoIWh8fGhbMV09PT1wY1sxXSYmaFsyXT09PXBjWzJdJiYoaFszXXx8KCJodHRwOiI9PT1oWzFdPyI4MCI6IjQ0MyIpKT09PShwY1szXXx8KCJodHRwOiI9PT1wY1sxXT8iODAiOiI0NDMiKSkpKSxrLmRhdGEmJmsucHJvY2Vzc0RhdGEmJiJzdHJpbmciIT10eXBlb2Ygay5kYXRhJiYoay5kYXRhPW4ucGFyYW0oay5kYXRhLGsudHJhZGl0aW9uYWwpKSxyYyhsYyxrLGIsdiksMj09PXQpcmV0dXJuIHY7aT1uLmV2ZW50JiZrLmdsb2JhbCxpJiYwPT09bi5hY3RpdmUrKyYmbi5ldmVudC50cmlnZ2VyKCJhamF4U3RhcnQiKSxrLnR5cGU9ay50eXBlLnRvVXBwZXJDYXNlKCksay5oYXNDb250ZW50PSFpYy50ZXN0KGsudHlwZSksZD1rLnVybCxrLmhhc0NvbnRlbnR8fChrLmRhdGEmJihkPWsudXJsKz0oZGMudGVzdChkKT8iJiI6Ij8iKStrLmRhdGEsZGVsZXRlIGsuZGF0YSksay5jYWNoZT09PSExJiYoay51cmw9ZmMudGVzdChkKT9kLnJlcGxhY2UoZmMsIiQxXz0iK2NjKyspOmQrKGRjLnRlc3QoZCk/IiYiOiI/IikrIl89IitjYysrKSksay5pZk1vZGlmaWVkJiYobi5sYXN0TW9kaWZpZWRbZF0mJnYuc2V0UmVxdWVzdEhlYWRlcigiSWYtTW9kaWZpZWQtU2luY2UiLG4ubGFzdE1vZGlmaWVkW2RdKSxuLmV0YWdbZF0mJnYuc2V0UmVxdWVzdEhlYWRlcigiSWYtTm9uZS1NYXRjaCIsbi5ldGFnW2RdKSksKGsuZGF0YSYmay5oYXNDb250ZW50JiZrLmNvbnRlbnRUeXBlIT09ITF8fGIuY29udGVudFR5cGUpJiZ2LnNldFJlcXVlc3RIZWFkZXIoIkNvbnRlbnQtVHlwZSIsay5jb250ZW50VHlwZSksdi5zZXRSZXF1ZXN0SGVhZGVyKCJBY2NlcHQiLGsuZGF0YVR5cGVzWzBdJiZrLmFjY2VwdHNbay5kYXRhVHlwZXNbMF1dP2suYWNjZXB0c1trLmRhdGFUeXBlc1swXV0rKCIqIiE9PWsuZGF0YVR5cGVzWzBdPyIsICIrbmMrIjsgcT0wLjAxIjoiIik6ay5hY2NlcHRzWyIqIl0pO2ZvcihqIGluIGsuaGVhZGVycyl2LnNldFJlcXVlc3RIZWFkZXIoaixrLmhlYWRlcnNbal0pO2lmKGsuYmVmb3JlU2VuZCYmKGsuYmVmb3JlU2VuZC5jYWxsKGwsdixrKT09PSExfHwyPT09dCkpcmV0dXJuIHYuYWJvcnQoKTt1PSJhYm9ydCI7Zm9yKGogaW57c3VjY2VzczoxLGVycm9yOjEsY29tcGxldGU6MX0pdltqXShrW2pdKTtpZihjPXJjKG1jLGssYix2KSl7di5yZWFkeVN0YXRlPTEsaSYmbS50cmlnZ2VyKCJhamF4U2VuZCIsW3Ysa10pLGsuYXN5bmMmJmsudGltZW91dD4wJiYoZz1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7di5hYm9ydCgidGltZW91dCIpfSxrLnRpbWVvdXQpKTt0cnl7dD0xLGMuc2VuZChyLHgpfWNhdGNoKHcpe2lmKCEoMj50KSl0aHJvdyB3O3goLTEsdyl9fWVsc2UgeCgtMSwiTm8gVHJhbnNwb3J0Iik7ZnVuY3Rpb24geChhLGIsZixoKXt2YXIgaixyLHMsdSx3LHg9YjsyIT09dCYmKHQ9MixnJiZjbGVhclRpbWVvdXQoZyksYz12b2lkIDAsZT1ofHwiIix2LnJlYWR5U3RhdGU9YT4wPzQ6MCxqPWE+PTIwMCYmMzAwPmF8fDMwND09PWEsZiYmKHU9dGMoayx2LGYpKSx1PXVjKGssdSx2LGopLGo/KGsuaWZNb2RpZmllZCYmKHc9di5nZXRSZXNwb25zZUhlYWRlcigiTGFzdC1Nb2RpZmllZCIpLHcmJihuLmxhc3RNb2RpZmllZFtkXT13KSx3PXYuZ2V0UmVzcG9uc2VIZWFkZXIoImV0YWciKSx3JiYobi5ldGFnW2RdPXcpKSwyMDQ9PT1hfHwiSEVBRCI9PT1rLnR5cGU/eD0ibm9jb250ZW50IjozMDQ9PT1hP3g9Im5vdG1vZGlmaWVkIjooeD11LnN0YXRlLHI9dS5kYXRhLHM9dS5lcnJvcixqPSFzKSk6KHM9eCwoYXx8IXgpJiYoeD0iZXJyb3IiLDA+YSYmKGE9MCkpKSx2LnN0YXR1cz1hLHYuc3RhdHVzVGV4dD0oYnx8eCkrIiIsaj9vLnJlc29sdmVXaXRoKGwsW3IseCx2XSk6by5yZWplY3RXaXRoKGwsW3YseCxzXSksdi5zdGF0dXNDb2RlKHEpLHE9dm9pZCAwLGkmJm0udHJpZ2dlcihqPyJhamF4U3VjY2VzcyI6ImFqYXhFcnJvciIsW3YsayxqP3I6c10pLHAuZmlyZVdpdGgobCxbdix4XSksaSYmKG0udHJpZ2dlcigiYWpheENvbXBsZXRlIixbdixrXSksLS1uLmFjdGl2ZXx8bi5ldmVudC50cmlnZ2VyKCJhamF4U3RvcCIpKSl9cmV0dXJuIHZ9LGdldEpTT046ZnVuY3Rpb24oYSxiLGMpe3JldHVybiBuLmdldChhLGIsYywianNvbiIpfSxnZXRTY3JpcHQ6ZnVuY3Rpb24oYSxiKXtyZXR1cm4gbi5nZXQoYSx2b2lkIDAsYiwic2NyaXB0Iil9fSksbi5lYWNoKFsiZ2V0IiwicG9zdCJdLGZ1bmN0aW9uKGEsYil7bltiXT1mdW5jdGlvbihhLGMsZCxlKXtyZXR1cm4gbi5pc0Z1bmN0aW9uKGMpJiYoZT1lfHxkLGQ9YyxjPXZvaWQgMCksbi5hamF4KHt1cmw6YSx0eXBlOmIsZGF0YVR5cGU6ZSxkYXRhOmMsc3VjY2VzczpkfSl9fSksbi5fZXZhbFVybD1mdW5jdGlvbihhKXtyZXR1cm4gbi5hamF4KHt1cmw6YSx0eXBlOiJHRVQiLGRhdGFUeXBlOiJzY3JpcHQiLGFzeW5jOiExLGdsb2JhbDohMSwidGhyb3dzIjohMH0pfSxuLmZuLmV4dGVuZCh7d3JhcEFsbDpmdW5jdGlvbihhKXt2YXIgYjtyZXR1cm4gbi5pc0Z1bmN0aW9uKGEpP3RoaXMuZWFjaChmdW5jdGlvbihiKXtuKHRoaXMpLndyYXBBbGwoYS5jYWxsKHRoaXMsYikpfSk6KHRoaXNbMF0mJihiPW4oYSx0aGlzWzBdLm93bmVyRG9jdW1lbnQpLmVxKDApLmNsb25lKCEwKSx0aGlzWzBdLnBhcmVudE5vZGUmJmIuaW5zZXJ0QmVmb3JlKHRoaXNbMF0pLGIubWFwKGZ1bmN0aW9uKCl7dmFyIGE9dGhpczt3aGlsZShhLmZpcnN0RWxlbWVudENoaWxkKWE9YS5maXJzdEVsZW1lbnRDaGlsZDtyZXR1cm4gYX0pLmFwcGVuZCh0aGlzKSksdGhpcyl9LHdyYXBJbm5lcjpmdW5jdGlvbihhKXtyZXR1cm4gdGhpcy5lYWNoKG4uaXNGdW5jdGlvbihhKT9mdW5jdGlvbihiKXtuKHRoaXMpLndyYXBJbm5lcihhLmNhbGwodGhpcyxiKSl9OmZ1bmN0aW9uKCl7dmFyIGI9bih0aGlzKSxjPWIuY29udGVudHMoKTtjLmxlbmd0aD9jLndyYXBBbGwoYSk6Yi5hcHBlbmQoYSl9KX0sd3JhcDpmdW5jdGlvbihhKXt2YXIgYj1uLmlzRnVuY3Rpb24oYSk7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihjKXtuKHRoaXMpLndyYXBBbGwoYj9hLmNhbGwodGhpcyxjKTphKX0pfSx1bndyYXA6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5wYXJlbnQoKS5lYWNoKGZ1bmN0aW9uKCl7bi5ub2RlTmFtZSh0aGlzLCJib2R5Iil8fG4odGhpcykucmVwbGFjZVdpdGgodGhpcy5jaGlsZE5vZGVzKX0pLmVuZCgpfX0pLG4uZXhwci5maWx0ZXJzLmhpZGRlbj1mdW5jdGlvbihhKXtyZXR1cm4gYS5vZmZzZXRXaWR0aDw9MCYmYS5vZmZzZXRIZWlnaHQ8PTB9LG4uZXhwci5maWx0ZXJzLnZpc2libGU9ZnVuY3Rpb24oYSl7cmV0dXJuIW4uZXhwci5maWx0ZXJzLmhpZGRlbihhKX07dmFyIHZjPS8lMjAvZyx3Yz0vXFtcXSQvLHhjPS9ccj9cbi9nLHljPS9eKD86c3VibWl0fGJ1dHRvbnxpbWFnZXxyZXNldHxmaWxlKSQvaSx6Yz0vXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYXxrZXlnZW4pL2k7ZnVuY3Rpb24gQWMoYSxiLGMsZCl7dmFyIGU7aWYobi5pc0FycmF5KGIpKW4uZWFjaChiLGZ1bmN0aW9uKGIsZSl7Y3x8d2MudGVzdChhKT9kKGEsZSk6QWMoYSsiWyIrKCJvYmplY3QiPT10eXBlb2YgZT9iOiIiKSsiXSIsZSxjLGQpfSk7ZWxzZSBpZihjfHwib2JqZWN0IiE9PW4udHlwZShiKSlkKGEsYik7ZWxzZSBmb3IoZSBpbiBiKUFjKGErIlsiK2UrIl0iLGJbZV0sYyxkKX1uLnBhcmFtPWZ1bmN0aW9uKGEsYil7dmFyIGMsZD1bXSxlPWZ1bmN0aW9uKGEsYil7Yj1uLmlzRnVuY3Rpb24oYik/YigpOm51bGw9PWI/IiI6YixkW2QubGVuZ3RoXT1lbmNvZGVVUklDb21wb25lbnQoYSkrIj0iK2VuY29kZVVSSUNvbXBvbmVudChiKX07aWYodm9pZCAwPT09YiYmKGI9bi5hamF4U2V0dGluZ3MmJm4uYWpheFNldHRpbmdzLnRyYWRpdGlvbmFsKSxuLmlzQXJyYXkoYSl8fGEuanF1ZXJ5JiYhbi5pc1BsYWluT2JqZWN0KGEpKW4uZWFjaChhLGZ1bmN0aW9uKCl7ZSh0aGlzLm5hbWUsdGhpcy52YWx1ZSl9KTtlbHNlIGZvcihjIGluIGEpQWMoYyxhW2NdLGIsZSk7cmV0dXJuIGQuam9pbigiJiIpLnJlcGxhY2UodmMsIisiKX0sbi5mbi5leHRlbmQoe3NlcmlhbGl6ZTpmdW5jdGlvbigpe3JldHVybiBuLnBhcmFtKHRoaXMuc2VyaWFsaXplQXJyYXkoKSl9LHNlcmlhbGl6ZUFycmF5OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKCl7dmFyIGE9bi5wcm9wKHRoaXMsImVsZW1lbnRzIik7cmV0dXJuIGE/bi5tYWtlQXJyYXkoYSk6dGhpc30pLmZpbHRlcihmdW5jdGlvbigpe3ZhciBhPXRoaXMudHlwZTtyZXR1cm4gdGhpcy5uYW1lJiYhbih0aGlzKS5pcygiOmRpc2FibGVkIikmJnpjLnRlc3QodGhpcy5ub2RlTmFtZSkmJiF5Yy50ZXN0KGEpJiYodGhpcy5jaGVja2VkfHwhVC50ZXN0KGEpKX0pLm1hcChmdW5jdGlvbihhLGIpe3ZhciBjPW4odGhpcykudmFsKCk7cmV0dXJuIG51bGw9PWM/bnVsbDpuLmlzQXJyYXkoYyk/bi5tYXAoYyxmdW5jdGlvbihhKXtyZXR1cm57bmFtZTpiLm5hbWUsdmFsdWU6YS5yZXBsYWNlKHhjLCJcclxuIil9fSk6e25hbWU6Yi5uYW1lLHZhbHVlOmMucmVwbGFjZSh4YywiXHJcbiIpfX0pLmdldCgpfX0pLG4uYWpheFNldHRpbmdzLnhocj1mdW5jdGlvbigpe3RyeXtyZXR1cm4gbmV3IFhNTEh0dHBSZXF1ZXN0fWNhdGNoKGEpe319O3ZhciBCYz0wLENjPXt9LERjPXswOjIwMCwxMjIzOjIwNH0sRWM9bi5hamF4U2V0dGluZ3MueGhyKCk7YS5hdHRhY2hFdmVudCYmYS5hdHRhY2hFdmVudCgib251bmxvYWQiLGZ1bmN0aW9uKCl7Zm9yKHZhciBhIGluIENjKUNjW2FdKCl9KSxrLmNvcnM9ISFFYyYmIndpdGhDcmVkZW50aWFscyJpbiBFYyxrLmFqYXg9RWM9ISFFYyxuLmFqYXhUcmFuc3BvcnQoZnVuY3Rpb24oYSl7dmFyIGI7cmV0dXJuIGsuY29yc3x8RWMmJiFhLmNyb3NzRG9tYWluP3tzZW5kOmZ1bmN0aW9uKGMsZCl7dmFyIGUsZj1hLnhocigpLGc9KytCYztpZihmLm9wZW4oYS50eXBlLGEudXJsLGEuYXN5bmMsYS51c2VybmFtZSxhLnBhc3N3b3JkKSxhLnhockZpZWxkcylmb3IoZSBpbiBhLnhockZpZWxkcylmW2VdPWEueGhyRmllbGRzW2VdO2EubWltZVR5cGUmJmYub3ZlcnJpZGVNaW1lVHlwZSYmZi5vdmVycmlkZU1pbWVUeXBlKGEubWltZVR5cGUpLGEuY3Jvc3NEb21haW58fGNbIlgtUmVxdWVzdGVkLVdpdGgiXXx8KGNbIlgtUmVxdWVzdGVkLVdpdGgiXT0iWE1MSHR0cFJlcXVlc3QiKTtmb3IoZSBpbiBjKWYuc2V0UmVxdWVzdEhlYWRlcihlLGNbZV0pO2I9ZnVuY3Rpb24oYSl7cmV0dXJuIGZ1bmN0aW9uKCl7YiYmKGRlbGV0ZSBDY1tnXSxiPWYub25sb2FkPWYub25lcnJvcj1udWxsLCJhYm9ydCI9PT1hP2YuYWJvcnQoKToiZXJyb3IiPT09YT9kKGYuc3RhdHVzLGYuc3RhdHVzVGV4dCk6ZChEY1tmLnN0YXR1c118fGYuc3RhdHVzLGYuc3RhdHVzVGV4dCwic3RyaW5nIj09dHlwZW9mIGYucmVzcG9uc2VUZXh0P3t0ZXh0OmYucmVzcG9uc2VUZXh0fTp2b2lkIDAsZi5nZXRBbGxSZXNwb25zZUhlYWRlcnMoKSkpfX0sZi5vbmxvYWQ9YigpLGYub25lcnJvcj1iKCJlcnJvciIpLGI9Q2NbZ109YigiYWJvcnQiKTt0cnl7Zi5zZW5kKGEuaGFzQ29udGVudCYmYS5kYXRhfHxudWxsKX1jYXRjaChoKXtpZihiKXRocm93IGh9fSxhYm9ydDpmdW5jdGlvbigpe2ImJmIoKX19OnZvaWQgMH0pLG4uYWpheFNldHVwKHthY2NlcHRzOntzY3JpcHQ6InRleHQvamF2YXNjcmlwdCwgYXBwbGljYXRpb24vamF2YXNjcmlwdCwgYXBwbGljYXRpb24vZWNtYXNjcmlwdCwgYXBwbGljYXRpb24veC1lY21hc2NyaXB0In0sY29udGVudHM6e3NjcmlwdDovKD86amF2YXxlY21hKXNjcmlwdC99LGNvbnZlcnRlcnM6eyJ0ZXh0IHNjcmlwdCI6ZnVuY3Rpb24oYSl7cmV0dXJuIG4uZ2xvYmFsRXZhbChhKSxhfX19KSxuLmFqYXhQcmVmaWx0ZXIoInNjcmlwdCIsZnVuY3Rpb24oYSl7dm9pZCAwPT09YS5jYWNoZSYmKGEuY2FjaGU9ITEpLGEuY3Jvc3NEb21haW4mJihhLnR5cGU9IkdFVCIpfSksbi5hamF4VHJhbnNwb3J0KCJzY3JpcHQiLGZ1bmN0aW9uKGEpe2lmKGEuY3Jvc3NEb21haW4pe3ZhciBiLGM7cmV0dXJue3NlbmQ6ZnVuY3Rpb24oZCxlKXtiPW4oIjxzY3JpcHQ+IikucHJvcCh7YXN5bmM6ITAsY2hhcnNldDphLnNjcmlwdENoYXJzZXQsc3JjOmEudXJsfSkub24oImxvYWQgZXJyb3IiLGM9ZnVuY3Rpb24oYSl7Yi5yZW1vdmUoKSxjPW51bGwsYSYmZSgiZXJyb3IiPT09YS50eXBlPzQwNDoyMDAsYS50eXBlKX0pLGwuaGVhZC5hcHBlbmRDaGlsZChiWzBdKX0sYWJvcnQ6ZnVuY3Rpb24oKXtjJiZjKCl9fX19KTt2YXIgRmM9W10sR2M9Lyg9KVw/KD89JnwkKXxcP1w/LztuLmFqYXhTZXR1cCh7anNvbnA6ImNhbGxiYWNrIixqc29ucENhbGxiYWNrOmZ1bmN0aW9uKCl7dmFyIGE9RmMucG9wKCl8fG4uZXhwYW5kbysiXyIrY2MrKztyZXR1cm4gdGhpc1thXT0hMCxhfX0pLG4uYWpheFByZWZpbHRlcigianNvbiBqc29ucCIsZnVuY3Rpb24oYixjLGQpe3ZhciBlLGYsZyxoPWIuanNvbnAhPT0hMSYmKEdjLnRlc3QoYi51cmwpPyJ1cmwiOiJzdHJpbmciPT10eXBlb2YgYi5kYXRhJiYhKGIuY29udGVudFR5cGV8fCIiKS5pbmRleE9mKCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiKSYmR2MudGVzdChiLmRhdGEpJiYiZGF0YSIpO3JldHVybiBofHwianNvbnAiPT09Yi5kYXRhVHlwZXNbMF0/KGU9Yi5qc29ucENhbGxiYWNrPW4uaXNGdW5jdGlvbihiLmpzb25wQ2FsbGJhY2spP2IuanNvbnBDYWxsYmFjaygpOmIuanNvbnBDYWxsYmFjayxoP2JbaF09YltoXS5yZXBsYWNlKEdjLCIkMSIrZSk6Yi5qc29ucCE9PSExJiYoYi51cmwrPShkYy50ZXN0KGIudXJsKT8iJiI6Ij8iKStiLmpzb25wKyI9IitlKSxiLmNvbnZlcnRlcnNbInNjcmlwdCBqc29uIl09ZnVuY3Rpb24oKXtyZXR1cm4gZ3x8bi5lcnJvcihlKyIgd2FzIG5vdCBjYWxsZWQiKSxnWzBdfSxiLmRhdGFUeXBlc1swXT0ianNvbiIsZj1hW2VdLGFbZV09ZnVuY3Rpb24oKXtnPWFyZ3VtZW50c30sZC5hbHdheXMoZnVuY3Rpb24oKXthW2VdPWYsYltlXSYmKGIuanNvbnBDYWxsYmFjaz1jLmpzb25wQ2FsbGJhY2ssRmMucHVzaChlKSksZyYmbi5pc0Z1bmN0aW9uKGYpJiZmKGdbMF0pLGc9Zj12b2lkIDB9KSwic2NyaXB0Iik6dm9pZCAwfSksbi5wYXJzZUhUTUw9ZnVuY3Rpb24oYSxiLGMpe2lmKCFhfHwic3RyaW5nIiE9dHlwZW9mIGEpcmV0dXJuIG51bGw7ImJvb2xlYW4iPT10eXBlb2YgYiYmKGM9YixiPSExKSxiPWJ8fGw7dmFyIGQ9di5leGVjKGEpLGU9IWMmJltdO3JldHVybiBkP1tiLmNyZWF0ZUVsZW1lbnQoZFsxXSldOihkPW4uYnVpbGRGcmFnbWVudChbYV0sYixlKSxlJiZlLmxlbmd0aCYmbihlKS5yZW1vdmUoKSxuLm1lcmdlKFtdLGQuY2hpbGROb2RlcykpfTt2YXIgSGM9bi5mbi5sb2FkO24uZm4ubG9hZD1mdW5jdGlvbihhLGIsYyl7aWYoInN0cmluZyIhPXR5cGVvZiBhJiZIYylyZXR1cm4gSGMuYXBwbHkodGhpcyxhcmd1bWVudHMpO3ZhciBkLGUsZixnPXRoaXMsaD1hLmluZGV4T2YoIiAiKTtyZXR1cm4gaD49MCYmKGQ9bi50cmltKGEuc2xpY2UoaCkpLGE9YS5zbGljZSgwLGgpKSxuLmlzRnVuY3Rpb24oYik/KGM9YixiPXZvaWQgMCk6YiYmIm9iamVjdCI9PXR5cGVvZiBiJiYoZT0iUE9TVCIpLGcubGVuZ3RoPjAmJm4uYWpheCh7dXJsOmEsdHlwZTplLGRhdGFUeXBlOiJodG1sIixkYXRhOmJ9KS5kb25lKGZ1bmN0aW9uKGEpe2Y9YXJndW1lbnRzLGcuaHRtbChkP24oIjxkaXY+IikuYXBwZW5kKG4ucGFyc2VIVE1MKGEpKS5maW5kKGQpOmEpfSkuY29tcGxldGUoYyYmZnVuY3Rpb24oYSxiKXtnLmVhY2goYyxmfHxbYS5yZXNwb25zZVRleHQsYixhXSl9KSx0aGlzfSxuLmVhY2goWyJhamF4U3RhcnQiLCJhamF4U3RvcCIsImFqYXhDb21wbGV0ZSIsImFqYXhFcnJvciIsImFqYXhTdWNjZXNzIiwiYWpheFNlbmQiXSxmdW5jdGlvbihhLGIpe24uZm5bYl09ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMub24oYixhKX19KSxuLmV4cHIuZmlsdGVycy5hbmltYXRlZD1mdW5jdGlvbihhKXtyZXR1cm4gbi5ncmVwKG4udGltZXJzLGZ1bmN0aW9uKGIpe3JldHVybiBhPT09Yi5lbGVtfSkubGVuZ3RofTt2YXIgSWM9YS5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7ZnVuY3Rpb24gSmMoYSl7cmV0dXJuIG4uaXNXaW5kb3coYSk/YTo5PT09YS5ub2RlVHlwZSYmYS5kZWZhdWx0Vmlld31uLm9mZnNldD17c2V0T2Zmc2V0OmZ1bmN0aW9uKGEsYixjKXt2YXIgZCxlLGYsZyxoLGksaixrPW4uY3NzKGEsInBvc2l0aW9uIiksbD1uKGEpLG09e307InN0YXRpYyI9PT1rJiYoYS5zdHlsZS5wb3NpdGlvbj0icmVsYXRpdmUiKSxoPWwub2Zmc2V0KCksZj1uLmNzcyhhLCJ0b3AiKSxpPW4uY3NzKGEsImxlZnQiKSxqPSgiYWJzb2x1dGUiPT09a3x8ImZpeGVkIj09PWspJiYoZitpKS5pbmRleE9mKCJhdXRvIik+LTEsaj8oZD1sLnBvc2l0aW9uKCksZz1kLnRvcCxlPWQubGVmdCk6KGc9cGFyc2VGbG9hdChmKXx8MCxlPXBhcnNlRmxvYXQoaSl8fDApLG4uaXNGdW5jdGlvbihiKSYmKGI9Yi5jYWxsKGEsYyxoKSksbnVsbCE9Yi50b3AmJihtLnRvcD1iLnRvcC1oLnRvcCtnKSxudWxsIT1iLmxlZnQmJihtLmxlZnQ9Yi5sZWZ0LWgubGVmdCtlKSwidXNpbmciaW4gYj9iLnVzaW5nLmNhbGwoYSxtKTpsLmNzcyhtKX19LG4uZm4uZXh0ZW5kKHtvZmZzZXQ6ZnVuY3Rpb24oYSl7aWYoYXJndW1lbnRzLmxlbmd0aClyZXR1cm4gdm9pZCAwPT09YT90aGlzOnRoaXMuZWFjaChmdW5jdGlvbihiKXtuLm9mZnNldC5zZXRPZmZzZXQodGhpcyxhLGIpfSk7dmFyIGIsYyxkPXRoaXNbMF0sZT17dG9wOjAsbGVmdDowfSxmPWQmJmQub3duZXJEb2N1bWVudDtpZihmKXJldHVybiBiPWYuZG9jdW1lbnRFbGVtZW50LG4uY29udGFpbnMoYixkKT8odHlwZW9mIGQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0IT09VSYmKGU9ZC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSksYz1KYyhmKSx7dG9wOmUudG9wK2MucGFnZVlPZmZzZXQtYi5jbGllbnRUb3AsbGVmdDplLmxlZnQrYy5wYWdlWE9mZnNldC1iLmNsaWVudExlZnR9KTplfSxwb3NpdGlvbjpmdW5jdGlvbigpe2lmKHRoaXNbMF0pe3ZhciBhLGIsYz10aGlzWzBdLGQ9e3RvcDowLGxlZnQ6MH07cmV0dXJuImZpeGVkIj09PW4uY3NzKGMsInBvc2l0aW9uIik/Yj1jLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOihhPXRoaXMub2Zmc2V0UGFyZW50KCksYj10aGlzLm9mZnNldCgpLG4ubm9kZU5hbWUoYVswXSwiaHRtbCIpfHwoZD1hLm9mZnNldCgpKSxkLnRvcCs9bi5jc3MoYVswXSwiYm9yZGVyVG9wV2lkdGgiLCEwKSxkLmxlZnQrPW4uY3NzKGFbMF0sImJvcmRlckxlZnRXaWR0aCIsITApKSx7dG9wOmIudG9wLWQudG9wLW4uY3NzKGMsIm1hcmdpblRvcCIsITApLGxlZnQ6Yi5sZWZ0LWQubGVmdC1uLmNzcyhjLCJtYXJnaW5MZWZ0IiwhMCl9fX0sb2Zmc2V0UGFyZW50OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5vZmZzZXRQYXJlbnR8fEljO3doaWxlKGEmJiFuLm5vZGVOYW1lKGEsImh0bWwiKSYmInN0YXRpYyI9PT1uLmNzcyhhLCJwb3NpdGlvbiIpKWE9YS5vZmZzZXRQYXJlbnQ7cmV0dXJuIGF8fEljfSl9fSksbi5lYWNoKHtzY3JvbGxMZWZ0OiJwYWdlWE9mZnNldCIsc2Nyb2xsVG9wOiJwYWdlWU9mZnNldCJ9LGZ1bmN0aW9uKGIsYyl7dmFyIGQ9InBhZ2VZT2Zmc2V0Ij09PWM7bi5mbltiXT1mdW5jdGlvbihlKXtyZXR1cm4gSih0aGlzLGZ1bmN0aW9uKGIsZSxmKXt2YXIgZz1KYyhiKTtyZXR1cm4gdm9pZCAwPT09Zj9nP2dbY106YltlXTp2b2lkKGc/Zy5zY3JvbGxUbyhkP2EucGFnZVhPZmZzZXQ6ZixkP2Y6YS5wYWdlWU9mZnNldCk6YltlXT1mKX0sYixlLGFyZ3VtZW50cy5sZW5ndGgsbnVsbCl9fSksbi5lYWNoKFsidG9wIiwibGVmdCJdLGZ1bmN0aW9uKGEsYil7bi5jc3NIb29rc1tiXT15YihrLnBpeGVsUG9zaXRpb24sZnVuY3Rpb24oYSxjKXtyZXR1cm4gYz8oYz14YihhLGIpLHZiLnRlc3QoYyk/bihhKS5wb3NpdGlvbigpW2JdKyJweCI6Yyk6dm9pZCAwfSl9KSxuLmVhY2goe0hlaWdodDoiaGVpZ2h0IixXaWR0aDoid2lkdGgifSxmdW5jdGlvbihhLGIpe24uZWFjaCh7cGFkZGluZzoiaW5uZXIiK2EsY29udGVudDpiLCIiOiJvdXRlciIrYX0sZnVuY3Rpb24oYyxkKXtuLmZuW2RdPWZ1bmN0aW9uKGQsZSl7dmFyIGY9YXJndW1lbnRzLmxlbmd0aCYmKGN8fCJib29sZWFuIiE9dHlwZW9mIGQpLGc9Y3x8KGQ9PT0hMHx8ZT09PSEwPyJtYXJnaW4iOiJib3JkZXIiKTtyZXR1cm4gSih0aGlzLGZ1bmN0aW9uKGIsYyxkKXt2YXIgZTtyZXR1cm4gbi5pc1dpbmRvdyhiKT9iLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudFsiY2xpZW50IithXTo5PT09Yi5ub2RlVHlwZT8oZT1iLmRvY3VtZW50RWxlbWVudCxNYXRoLm1heChiLmJvZHlbInNjcm9sbCIrYV0sZVsic2Nyb2xsIithXSxiLmJvZHlbIm9mZnNldCIrYV0sZVsib2Zmc2V0IithXSxlWyJjbGllbnQiK2FdKSk6dm9pZCAwPT09ZD9uLmNzcyhiLGMsZyk6bi5zdHlsZShiLGMsZCxnKX0sYixmP2Q6dm9pZCAwLGYsbnVsbCl9fSl9KSxuLmZuLnNpemU9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5sZW5ndGh9LG4uZm4uYW5kU2VsZj1uLmZuLmFkZEJhY2ssImZ1bmN0aW9uIj09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZCYmZGVmaW5lKCJqcXVlcnkiLFtdLGZ1bmN0aW9uKCl7cmV0dXJuIG59KTt2YXIgS2M9YS5qUXVlcnksTGM9YS4kO3JldHVybiBuLm5vQ29uZmxpY3Q9ZnVuY3Rpb24oYil7cmV0dXJuIGEuJD09PW4mJihhLiQ9TGMpLGImJmEualF1ZXJ5PT09biYmKGEualF1ZXJ5PUtjKSxufSx0eXBlb2YgYj09PVUmJihhLmpRdWVyeT1hLiQ9biksbn0pOwo="}]},{"name":"Neopets Add Important Links","options":{"check_for_updates":true,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_powerful_this":null,"sandbox":null,"noframes":null,"unwrap":null,"run_at":null,"tab_types":null,"override":{"use_includes":[],"orig_includes":[],"merge_includes":true,"use_matches":[],"orig_matches":["http://www.neopets.com/*","http://neopets.com/*","https://www.neopets.com/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"orig_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null,"orig_run_in":[]},"user_modified":null,"run_in":null,"tags":[]},"storage":{"ts":1698065339226,"data":{}},"enabled":true,"position":5,"uuid":"2b996769-47f6-4820-8d50-e073c2161e9a","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBOZW9wZXRzIEFkZCBJbXBvcnRhbnQgTGlua3MKLy8gQHZlcnNpb24gICAgICAxLjMKLy8gQGRlc2NyaXB0aW9uICBBZGRzIHNvbWUgbWlzc2luZyBsaW5rcyB0byB0aGUgc2lkZWJhcgovLyBAYXV0aG9yICAgICAgIEhhcnZleQovLyBAbWF0Y2ggICAgICAgIGh0dHA6Ly93d3cubmVvcGV0cy5jb20vKgovLyBAbWF0Y2ggICAgICAgIGh0dHA6Ly9uZW9wZXRzLmNvbS8qCi8vIEBtYXRjaCAgICAgICAgaHR0cHM6Ly93d3cubmVvcGV0cy5jb20vKgovLyBAZ3JhbnQgICAgICAgIG5vbmUKLy8gPT0vVXNlclNjcmlwdD09Cgp2YXIgJCA9IHdpbmRvdy5qUXVlcnk7CgovL3JldHVybnMgdHJ1ZSBpZiB3aGl0ZQovL3JldHVybnMgZmFsc2UgaWYgYmxhY2sKZnVuY3Rpb24gZ2V0TGlua0h0bWwobGluayxpY29uLHRleHQpCnsKICAgIHZhciBsaW5rYWRkID0iPGEgaHJlZj1cIiIgK2xpbmsgKyAiXCI+PGxpIGNsYXNzPVwibmF2LWxpbmstbGVhdmUtYmV0YV9fMjAyMFwiIGRhdGEtdXJsPVwiLyIgKyBsaW5rICsgIlwiPjxkaXYgY2xhc3M9XCIiICsgaWNvbiArIlwiPjwvZGl2PiIgKyB0ZXh0ICsiPC9saT48L2E+IjsKICAgIHJldHVybiBsaW5rYWRkOwp9CgpmdW5jdGlvbiBhZGRMaW5rcygpCnsKICAgIHZhciBhZGRlZExpbmtzID0gIiI7CiAgICB2YXIgcXVpY2tyZWYgPSBnZXRMaW5rSHRtbCgicXVpY2tyZWYucGh0bWwiLCAibmF2LXBldGNlbnRyYWwtaWNvbl9fMjAyMCIsICJRdWlja3JlZiIpOwogICAgdmFyIHF1aWNrc3RvY2sgPSBnZXRMaW5rSHRtbCgicXVpY2tzdG9jay5waHRtbCIsICJuYXYtdXNlcmxvb2t1cC1pY29uX18yMDIwIiwgIlF1aWNrc3RvY2siKTsKICAgIHZhciBjdXN0b20gPSBnZXRMaW5rSHRtbCgiY3VzdG9taXNlLnBodG1sIiwgIm5hdi11c2VybG9va3VwLWljb25fXzIwMjAiLCAiQ3VzdG9taXphdGlvbiIpOwogICAgdmFyIHNkYiA9IGdldExpbmtIdG1sKCJzYWZldHlkZXBvc2l0LnBodG1sIiwgIm5hdi1pbnZlbnRvcnktaWNvbl9fMjAyMCIsICJTYWZldHkgRGVwb3NpdCBCb3giKTsKICAgIGFkZGVkTGlua3MgPSBhZGRlZExpbmtzICsgcXVpY2tyZWY7IC8vUXVpY2tyZWYgbGluawogICAgYWRkZWRMaW5rcyA9IGFkZGVkTGlua3MgKyBxdWlja3N0b2NrOyAvL1F1aWNrc3RvY2sgbGluawogICAgYWRkZWRMaW5rcyA9IGFkZGVkTGlua3MgKyBjdXN0b207IC8vQ3VzdG9taXphdGlvbiBsaW5rCiAgICBhZGRlZExpbmtzID0gYWRkZWRMaW5rcyArIHNkYjsgLy9TYWZldHkgZGVwb3NpdCBib3ggbGluawoKICAgIHZhciBhZGRJbnZMaW5rID0gIjxhIGhyZWY9XCJodHRwczovL3d3dy5uZW9wZXRzLmNvbS9pbnZlbnRvcnkucGh0bWxcIj48ZGl2IGNsYXNzPVwibmF2c3ViLW5wLW1ldGVyX18yMDIwXCIgc3R5bGU9XCJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7bWFyZ2luLXJpZ2h0OjVweDsgbWFyZ2luLWJvdHRvbTogMHB4O3RleHQtYWxpZ246Y2VudGVyO1wiPjxkaXYgY2xhc3M9XCJuYXZzdWItbnAtaWNvbl9fMjAyMFwiIHN0eWxlPVwiYmFja2dyb3VuZDpub25lIWltcG9ydGFudDtcIj48aW1nIHNyYz1cImh0dHBzOi8vaW1hZ2VzLm5lb3BldHMuY29tL3RoZW1lcy9oNS9oYXVudGVkd29vZHMvaW1hZ2VzL2ludmVudG9yeS1pY29uLnN2Z1wiIHdpZHRoPVwiMjVcIj48L2Rpdj48c3BhbiBjbGFzcz1cIm5wLXRleHRfXzIwMjBcIj5JbnZlbnRvcnk8L3NwYW4+PC9kaXY+PC9hPiIKCiAgICB2YXIgY2xvY2sgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJuYXYtcHJvZmlsZS1kcm9wZG93bi1jbG9ja19fMjAyMCIpWzBdOwoKICAgIGlmIChjbG9jayAhPSBudWxsKQogICAgewogICAgICAgIHZhciBmaXJzdFNldCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJuYXZwcm9maWxlZHJvcGRvd25fXzIwMjAiKTsKICAgICAgICB2YXIgbmV3RWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd1bCcpOwogICAgICAgIG5ld0VsLmlubmVySFRNTCA9IGFkZGVkTGlua3M7CiAgICAgICAgY2xvY2sucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobmV3RWwsIGNsb2NrLm5leHRTaWJsaW5nLm5leHRTaWJsaW5nKTsKCiAgICAgICAgdmFyIGJhbmtMaW5rID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgibmF2c3ViLXJpZ2h0X18yMDIwIilbMF07CgoKICAgICAgICB2YXIgaW52RWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICAgICAgaW52RWwuaW5uZXJIVE1MID0gYWRkSW52TGluazsKCiAgICAgICAgYmFua0xpbmsuaW5zZXJ0QmVmb3JlKGludkVsLCBiYW5rTGluay5jaGlsZHJlblswXSk7CiAgICB9Cn0KCgogICAgYWRkTGlua3MoKTs="},{"name":"Neopets - Active Pet Switch & Fishing Vortex Plus","options":{"check_for_updates":true,"user_modified":null,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_powerful_this":null,"sandbox":null,"noframes":null,"unwrap":null,"run_at":null,"tab_types":null,"override":{"use_includes":[],"orig_includes":[],"merge_includes":true,"use_matches":[],"orig_matches":["*://*.neopets.com/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"orig_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null,"orig_run_in":[]},"run_in":null,"tags":[]},"storage":{"ts":1729359390850,"data":{"petlist":"o{\"Aitelier\": {\"name\": \"Aitelier\",\"species\": \"Eyrie\",\"color\": \"Purple\",\"img\": {\"noBG\": \"ttps://pets.neopets.com/cp/wgk8cqo6/1/9.png\",\"withBG\": \"//pets.neopets.com/cp/fczs6r5f/1/4.png\"},\"gender\": \"Male\",\"hp\": \"96/86\",\"level\": \"3\",\"hunger\": \"satiated\",\"mood\": \"extremely happy\",\"p2\": {\"name\": \"Dog\",\"species\": \"Mazzew\",\"img\": \"https://images.neopets.com/items/petpet_mazzew.gif\",\"p3\": null}},\"Cascayde\": {\"name\": \"Cascayde\",\"species\": \"Peophin\",\"color\": \"Oil Paint\",\"img\": {\"noBG\": \"ttps://pets.neopets.com/cp/fntrlxvl/1/9.png\",\"withBG\": \"//pets.neopets.com/cp/g9hg4jrf/1/4.png\"},\"gender\": \"Female\",\"hp\": \"12/12\",\"level\": \"1\",\"hunger\": \"bloated\",\"mood\": \"delighted!\",\"p2\": {\"name\": \"no name\",\"species\": \"Cloud Snowbunny\",\"img\": \"https://images.neopets.com/items/snowbunny_cloud.gif\",\"p3\": null}},\"Conversation\": {\"name\": \"Conversation\",\"species\": \"Vandagyre\",\"color\": \"Toy\",\"img\": {\"noBG\": \"ttps://pets.neopets.com/cp/f33jxj9f/1/9.png\",\"withBG\": \"//pets.neopets.com/cp/dr68cqlg/1/4.png\"},\"gender\": \"Female\",\"hp\": \"31/61\",\"level\": \"14\",\"hunger\": \"bloated\",\"mood\": \"delighted!\",\"p2\": {\"name\": \"Goober\",\"species\": \"Magma Screal\",\"img\": \"https://images.neopets.com/items/screal_magma.gif\",\"p3\": null}},\"Michirui\": {\"name\": \"Michirui\",\"species\": \"Xweetok\",\"color\": \"Faerie\",\"img\": {\"noBG\": \"ttps://pets.neopets.com/cp/c2sgr5gc/1/9.png\",\"withBG\": \"//pets.neopets.com/cp/ldwqmx5x/1/4.png\"},\"gender\": \"Female\",\"hp\": \"32/87\",\"level\": \"3\",\"hunger\": \"bloated\",\"mood\": \"delighted!\",\"p2\": {\"name\": \"Hydrangea\",\"species\": \"Blue Carmariller\",\"img\": \"https://images.neopets.com/items/carmariller_blue.gif\",\"p3\": null}},\"Oblacek\": {\"name\": \"Oblacek\",\"species\": \"Acara\",\"color\": \"Mutant\",\"img\": {\"noBG\": \"ttps://pets.neopets.com/cp/kj7k8j6q/2/9.png\",\"withBG\": \"//pets.neopets.com/cp/4sjvsdxo/2/4.png\"},\"gender\": \"Female\",\"hp\": \"319/309\",\"level\": \"261\",\"hunger\": \"satiated\",\"mood\": \"depressed\",\"p2\": {\"name\": \"Cuddles\",\"species\": \"Plushie Angelpuss\",\"img\": \"https://images.neopets.com/items/angelpuss_plushie.gif\",\"p3\": null}},\"Sneezings\": {\"name\": \"Sneezings\",\"species\": \"Pteri\",\"color\": \"Pink\",\"img\": {\"noBG\": \"ttps://pets.neopets.com/cp/ll5wkwol/1/9.png\",\"withBG\": \"//pets.neopets.com/cp/4j6h2cg8/1/4.png\"},\"gender\": \"Female\",\"hp\": \"19/24\",\"level\": \"3\",\"hunger\": \"bloated\",\"mood\": \"delighted!\",\"p2\": {\"name\": \"Fool\",\"species\": \"Huggy\",\"img\": \"https://images.neopets.com/items/pets_huggy.gif\",\"p3\": null}},\"YE5\": {\"name\": \"YE5\",\"species\": \"Aisha\",\"color\": \"Alien\",\"img\": {\"noBG\": \"ttps://pets.neopets.com/cp/w5zb4rd8/1/9.png\",\"withBG\": \"//pets.neopets.com/cp/nmdqmb54/1/4.png\"},\"gender\": \"Male\",\"hp\": \"19/20\",\"level\": \"1\",\"hunger\": \"bloated\",\"mood\": \"extremely happy\",\"p2\": {\"name\": \"Javascript\",\"species\": \"Robot Bython\",\"img\": \"https://images.neopets.com/items/bython_robot.gif\",\"p3\": null}}}","lastupdate":"n1729359390850","un":"scutepie3000","fishinglist":"o{\"Oblacek\": {\"lvl\": \"46\",\"xp\": 0,\"lasttime\": 1698155253288},\"Michirui\": {\"lvl\": \"3\",\"xp\": 0,\"lasttime\": 1698155260657}}"}},"enabled":true,"position":6,"file_url":"https://github.com/Mettymagic/np-userscripts/raw/main/Neopets%20-%20Active%20Pet%20Switch.user.js","uuid":"20c5a97b-eb0f-44f1-b054-f797299310d8","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBOZW9wZXRzIC0gQWN0aXZlIFBldCBTd2l0Y2ggJiBGaXNoaW5nIFZvcnRleCBQbHVzCi8vIEB2ZXJzaW9uICAgICAgMi44LjEKLy8gQGRlc2NyaXB0aW9uICBBUFMgYWRkcyBhIGJ1dHRvbiB0aGF0IGxldHMgeW91IGVhc2lseSBzd2l0Y2ggeW91ciBhY3RpdmUgcGV0LiBJbiB0aGUgY2xhc3NpYyB0aGVtZSwgdGhpcyB3aWxsIGFwcGVhciB1bmRlcm5lYXRoIHlvdXIgcGV0J3MgaW1hZ2UgaW4gdGhlIHNpZGViYXIuIEluIGJldGEsIGl0IHdpbGwgYXBwZWFyIG5leHQgdG8gdGhlIGljb25zIHRoYXQgZmxvYXQgYXQgdGhlIHRvcCBvZiBldmVyeSBwYWdlIChCb29rbWFya3MsIEZhdm9yaXRlcywgU2hvcCBXaXphcmQpLiBGVlAgYWRkcyBhZGRpdGlvbmFsIGluZm8gdG8gdGhlIGZpc2hpbmcgdm9ydGV4LgovLyBAYXV0aG9yICAgICAgIE1ldGFtYWdpYywgd2l0aCBtb2RpZmljYXRpb25zIGJ5IGNoYW5ha2luCi8vIEBtYXRjaCAgICAgICAgKjovLyoubmVvcGV0cy5jb20vKgovLyBAaWNvbiAgICAgICAgIGh0dHBzOi8vaS5pbWd1ci5jb20vUm51cUxSbS5wbmcKLy8gQGdyYW50ICAgICAgICBHTV9nZXRWYWx1ZQovLyBAZ3JhbnQgICAgICAgIEdNX3NldFZhbHVlCi8vIEBncmFudCAgICAgICAgR01fZGVsZXRlVmFsdWUKLy8gQGdyYW50ICAgICAgICBHTV9hZGRWYWx1ZUNoYW5nZUxpc3RlbmVyCi8vIEBncmFudCAgICAgICAgd2luZG93LmZvY3VzCi8vIEBncmFudCAgICAgICAgd2luZG93LmNsb3NlCi8vIEBkb3dubG9hZFVSTCAgaHR0cHM6Ly9naXRodWIuY29tL01ldHR5bWFnaWMvbnAtdXNlcnNjcmlwdHMvcmF3L21haW4vTmVvcGV0cyUyMC0lMjBBY3RpdmUlMjBQZXQlMjBTd2l0Y2gudXNlci5qcwovLyBAdXBkYXRlVVJMICAgIGh0dHBzOi8vZ2l0aHViLmNvbS9NZXR0eW1hZ2ljL25wLXVzZXJzY3JpcHRzL3Jhdy9tYWluL05lb3BldHMlMjAtJTIwQWN0aXZlJTIwUGV0JTIwU3dpdGNoLnVzZXIuanMKLy8gPT0vVXNlclNjcmlwdD09CgovLyBZb3UgYXJlIGZyZWUgdG8gbW9kaWZ5IHRoaXMgc2NyaXB0IGZvciBwZXJzb25hbCB1c2UgYnV0IG1vZGlmaWVkIHNjcmlwdHMgbXVzdCBub3QgYmUgc2hhcmVkIHB1YmxpY2x5IHdpdGhvdXQgcGVybWlzc2lvbi4KLy8gRmVlbCBmcmVlIHRvIGNvbnRhY3QgbWUgYXQgQG1ldHR5bWFnaWMgb24gZGlzY29yZCBmb3IgYW55IHF1ZXN0aW9ucyBvciBpbnF1aXJpZXMuIF5eCgovLyBUcmFucyByaWdodHMgYXJlIGh1bWFuIHJpZ2h0cyBeXgovLyBtZXR0eSBzYXlzIGhpCgovLz09PT09PT09PT09Ci8vIEFQUyBjb25maWcKLy89PT09PT09PT09PQovL2NvbGxlY3RlZCBwYWdlIGRhdGEgdGltZXMgb3V0IGFmdGVyIHRoaXMgbWFueSBob3Vycy4gZGVmYXVsdDogLTEgKGFrYSBuZXZlcikKY29uc3QgSE9NRV9EQVRBX1RJTUVPVVQgPSAtMQoKLy89PT09PT09PT09PQovLyBGVlAgY29uZmlnCi8vPT09PT09PT09PT0KLy9jaGFuZ2VzIHRoZSBkaXNwbGF5IG1vZGUKLy8gLTEgPSBkaXNhYmxlIGRpc3BsYXkgZW50aXJlbHkuIHN0aWxsIHRyYWNrcyBlbmFibGVkIGluZm8uCi8vIDAgPSBkaXNwbGF5IHRhYmxlIG9uIGZpc2hpbmcgcGFnZSB3L28gZmlzaGluZyBpbmZvCi8vIDEgPSBkaXNwbGF5IHRhYmxlIG9uIGZpc2hpbmcgcGFnZSwgcGx1cyBmaXNoaW5nIGluZm8gKGRlZmF1bHQpCi8vIDIgPSBkaXNwbGF5IGZpc2hpbmcgaW5mbyBvbiBhbGwgcGFnZXMnIHBldCB0YWJsZQpjb25zdCBGSVNISU5HX0RJU1BMQVlfTU9ERSA9IDEKLy90cmFja3MgYW5kIGRpc3BsYXlzIHBldCBmaXNoaW5nIGxldmVscwpjb25zdCBGSVNISU5HX0xFVkVMX1RSQUNLID0gdHJ1ZQovL3RyYWNrcyB0aW1lIHNpbmNlIGxhc3QgZmlzaGluZyByZXdhcmQKY29uc3QgRklTSElOR19USU1FX1RSQUNLID0gdHJ1ZQoKLy90cmFja3MgZmlzaGluZyB4cCBnYWluZWQgYW5kIGRpc3BsYXlzIGxldmVsIHVwIGNoYW5jZSBiYXNlZCBvbiAvdS9uZW9fdHJ1dGhzJyBwb3N0Ci8vaHR0cHM6Ly9vbGQucmVkZGl0LmNvbS9yL25lb3BldHMvY29tbWVudHMveHF5bGt0L3llX29sZGVfZmlzaGluZ192b3J0ZXgvCmNvbnN0IEZJU0hJTkdfWFBfVFJBQ0sgPSB0cnVlCgovL2ZvciBteSBtb20gd2hvIGtlZXBzIGFjY2lkZW50YWxseSBjbGlja2luZyBpdCB0aGVuIGdldHRpbmcgY29uZnVzZWQKY29uc3QgUkVNT1ZFX0NBU1RfQlVUVE9OID0gdHJ1ZQoKLy89PT09PT09PT09PT09PQovLyBtYWluIGZ1bmN0aW9uCi8vPT09PT09PT09PT09PT0KCmNvbnN0IHVybCA9IGRvY3VtZW50LmxvY2F0aW9uLmhyZWYKLy9jaGVjayBmb3IgdGhlIHRvcCBsZWZ0IHBldCBpY29uIHRvIGtub3cgd2UncmUgaW4gYmV0YQpsZXQgaXNCZXRhID0gZmFsc2UKaWYgKCQoIltjbGFzc149J25hdi1wZXQtbWVudS1pY29uJ10iKS5sZW5ndGgpIGlzQmV0YSA9IHRydWUKCmxldCB0aW1lb3V0SWQgPSBudWxsCgppZiAodXJsLmluY2x1ZGVzKCJuZW9wZXRzLmNvbS9ob21lIikpIHsKICAgIGdldFBldERhdGEoZG9jdW1lbnQpIC8vYWx3YXlzIHVwZGF0ZSB0aGUgZGF0YSB3aGlsZSB3ZSdyZSBoZXJlCiAgICAvL2Nsb3NlIGlmIGZsYWdnZWQgdG8KICAgIGxldCB0aW1lb3V0ID0gR01fZ2V0VmFsdWUoInN0YWNrcGF0aC10aW1lb3V0IikKICAgIGlmICh0aW1lb3V0KSB7CiAgICAgICAgR01fZGVsZXRlVmFsdWUoInN0YWNrcGF0aC10aW1lb3V0IikKICAgICAgICAvLyB3b24ndCBjbG9zZSB0YWIgYWZ0ZXIgMTUgc2Vjb25kIHRpbWVvdXQKICAgICAgICBpZiAobmV3IERhdGUoKS52YWx1ZU9mKCkgLSB0aW1lb3V0IDwgMTAwMCAqIDE1KSB7CiAgICAgICAgICAgIHdpbmRvdy5jbG9zZSgpCiAgICAgICAgfQogICAgfQp9CgppZiAodXJsLmluY2x1ZGVzKCJ3YXRlci9maXNoaW5nLnBodG1sIikpIHsKICAgIGhhbmRsZUZpc2hpbmdWb3J0ZXgoKQp9CgpjcmVhdGVNZW51QnV0dG9uKCkgLy9hZGRzIHRoZSBidXR0b24gdG8gb3BlbiB0aGUgbWVudQpsaXN0ZW5Gb3JQZXRVcGRhdGVzKCkgLy9hZGRzIGEgbGlzdGVuZXIgZm9yIHVwZGF0ZXMgdG8gdGhlIHNjcmlwdCdzIHN0b3JlZCBwZXQgbGlzdCwgd2hpY2ggdGhlbiB1cGRhdGVzIHRoZSBtZW51CgovLz09PT09PT09PQovLyBvdmVyaGVhZAovLz09PT09PT09PQpmdW5jdGlvbiBjbGVhclBldExpc3QoKSB7CiAgICBHTV9zZXRWYWx1ZSgicGV0bGlzdCIsIHt9KQp9CgpmdW5jdGlvbiB1cGRhdGVQZXRMaXN0KCkgewogICAgY2xlYXJQZXRMaXN0KCkKICAgICQuZ2V0KCJodHRwczovL3d3dy5uZW9wZXRzLmNvbS9ob21lLyIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgICAgbGV0IGRvYyA9IG5ldyBET01QYXJzZXIoKS5wYXJzZUZyb21TdHJpbmcoZGF0YSwgInRleHQvaHRtbCIpCiAgICAgICAgLy9zb21ldGltZXMgc3RhY2twYXRoIGJsb2NrcyB0aGUgcGFnZSwgaW4gd2hpY2ggY2FzZSBvcGVuIGEgbmV3dGFiIGFuZCBjbG9zZSBpdCBhZnRlcgogICAgICAgIGlmIChkb2MudGl0bGUgIT09ICJXZWxjb21lIHRvIE5lb3BldHMhIikgewogICAgICAgICAgICBjb25zb2xlLmxvZygiW0FQU10gSG9tZSBwYWdlIHJlcXVlc3QgYmxvY2tlZCBieSBzdGFja3BhdGgsIG9wZW5pbmcgdGFiIG1hbnVhbGx5LiIpCiAgICAgICAgICAgIEdNX3NldFZhbHVlKCJzdGFja3BhdGgtdGltZW91dCIsIG5ldyBEYXRlKCkudmFsdWVPZigpKQogICAgICAgICAgICB3aW5kb3cub3BlbigiaHR0cHM6Ly93d3cubmVvcGV0cy5jb20vaG9tZS8iKQogICAgICAgICAgICB3aW5kb3cuZm9jdXMoKQogICAgICAgIH0KICAgICAgICBnZXRQZXREYXRhKGRvYykKICAgICAgICBjb25zb2xlLmxvZygiW0FQU10gRGF0YSBzdWNjZXNzZnVsbHkgcmV0cmlldmVkLiIpCiAgICB9KQp9CgpmdW5jdGlvbiB0aW1lb3V0Rm9yVXBkYXRlRXhjZWVkZWQoKSB7CiAgICByZXR1cm4gbmV3IERhdGUoKS52YWx1ZU9mKCkgLSBHTV9nZXRWYWx1ZSgibGFzdHVwZGF0ZSIsIDApID4gMTAwMCAqIDYwICogNjAgKiBIT01FX0RBVEFfVElNRU9VVCAmJiBIT01FX0RBVEFfVElNRU9VVCA+IDAKfQoKZnVuY3Rpb24gdXNlcm5hbWVIYXNDaGFuZ2VkKCkgewogICAgcmV0dXJuIGdldFVzZXJuYW1lKCkgIT09IEdNX2dldFZhbHVlKCJ1biIpCn0KCmZ1bmN0aW9uIHBldExpc3RFeGlzdHMoKSB7CiAgICByZXR1cm4gR01fZ2V0VmFsdWUoInBldGxpc3QiLCBmYWxzZSkKfQoKZnVuY3Rpb24gc2hvdWxkVXBkYXRlKCkgewogICAgLy9yZXZhbGlkYXRlcyBkYXRhIGlmIGl0IHRpbWVzIG91dCBvciBpZiB1c2VybmFtZSBjaGFuZ2VzCiAgICBpZiAodGltZW91dEZvclVwZGF0ZUV4Y2VlZGVkKCkpIHsKICAgICAgICBjb25zb2xlLmxvZygiW0FQU10gVXBkYXRpbmcgZGF0YSBmb3IgbmV3IGRheS4iKQogICAgICAgIHJldHVybiB0cnVlCiAgICB9CgogICAgaWYgKHVzZXJuYW1lSGFzQ2hhbmdlZCgpKSB7CiAgICAgICAgY29uc29sZS5sb2coIltBUFNdIFVwZGF0aW5nIGRhdGEgZm9yIG5ldyB1c2VyLiIpCiAgICAgICAgcmV0dXJuIHRydWUKICAgIH0KCiAgICBpZiAoIXBldExpc3RFeGlzdHMoKSkgewogICAgICAgIGNvbnNvbGUubG9nKCJbQVBTXSBHZXR0aW5nIHVzZXIgcGV0IGRhdGEgZm9yIGZpcnN0IHRpbWUuIikKICAgICAgICByZXR1cm4gdHJ1ZQogICAgfQoKICAgIHJldHVybiBmYWxzZQp9CgpmdW5jdGlvbiBnZXRQZXREYXRhKGRvYykgewogICAgR01fc2V0VmFsdWUoInBldGxpc3QiLCBnZXRQZXRzKGRvYykpCiAgICBHTV9zZXRWYWx1ZSgibGFzdHVwZGF0ZSIsIG5ldyBEYXRlKCkudmFsdWVPZigpKQogICAgR01fc2V0VmFsdWUoInVuIiwgZ2V0VXNlcm5hbWUoKSkKCiAgICBjb25zb2xlLmxvZygiW0FQU10gUGV0IGRhdGEgdXBkYXRlZC4iKQp9CgpmdW5jdGlvbiBlbXB0eUpzb24obmV3VmFsdWUpIHsKICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShuZXdWYWx1ZSkgPT09IEpTT04uc3RyaW5naWZ5KHt9KTsKfQoKZnVuY3Rpb24gc2V0UmVmcmVzaEJ1dHRvblZpc2libGUodmlzaWJsZSkgewogICAgQXJyYXkuZnJvbSgkKCIuYWN0aXZldGFibGUgPiBhIikpLmZvckVhY2gobGluayA9PiB7CiAgICAgICAgaWYgKHZpc2libGUpIHsKICAgICAgICAgICAgbGluay5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbGluay5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIgogICAgICAgIH0KICAgIH0pCn0KCmZ1bmN0aW9uIGxpc3RlbkZvclBldFVwZGF0ZXMoKSB7CiAgICBHTV9hZGRWYWx1ZUNoYW5nZUxpc3RlbmVyKCJwZXRsaXN0IiwgZnVuY3Rpb24gKGtleSwgb2xkVmFsdWUsIG5ld1ZhbHVlLCBfKSB7CiAgICAgICAgLy9pZiBwZXQgbGlzdCBpcyBub3cgZW1wdHksIGFkZHMgbG9hZGluZyBtc2cKICAgICAgICBpZiAoZW1wdHlKc29uKG5ld1ZhbHVlKSkgewogICAgICAgICAgICBjb25zb2xlLmxvZygiW0FQU10gQ2xlYXJlZCBwZXQgdGFibGVzLiIpCiAgICAgICAgICAgIGFkZExvYWREaXZzKCkKICAgICAgICAgICAgc2V0UmVmcmVzaEJ1dHRvblZpc2libGUoZmFsc2UpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIH0KCiAgICAgICAgY29uc29sZS5sb2coIltBUFNdIFVwZGF0ZWQgcGV0IHRhYmxlcy4iKQogICAgICAgIGNvbnNvbGUubG9nKG5ld1ZhbHVlKQogICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0SWQpCiAgICAgICAgdGltZW91dElkID0gbnVsbAogICAgICAgIHBvcHVsYXRlVGFibGVzKCkKICAgICAgICBzZXRSZWZyZXNoQnV0dG9uVmlzaWJsZSh0cnVlKQogICAgfSkKfQoKLy89PT09PT09PT09PT09PT09PQovLyBlbGVtZW50IGNyZWF0aW9uCi8vPT09PT09PT09PT09PT09PT0KCmZ1bmN0aW9uIGNyZWF0ZU1lbnVCdXR0b24oKSB7CiAgICBsZXQgcGFyZW50RWxlbWVudCA9IGdldEJ1dHRvbkxvY2F0aW9uKCkKCiAgICBpZiAocGFyZW50RWxlbWVudCkgewogICAgICAgIGxldCBjaGFuZ2VBY3RpdmVQZXRTaG9ydGN1dAoKICAgICAgICBpZiAoaXNCZXRhKSB7CiAgICAgICAgICAgIGNoYW5nZUFjdGl2ZVBldFNob3J0Y3V0ID0gY3JlYXRlU2hvcnRjdXRJY29uKCIjIiwgImh0dHBzOi8vaW1hZ2VzLm5lb3BldHMuY29tL3RoZW1lcy9oNS9jb25zdGVsbGF0aW9ucy9pbWFnZXMvbXlwZXRzLWljb24uc3ZnIikKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjaGFuZ2VBY3RpdmVQZXRTaG9ydGN1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKQogICAgICAgICAgICBjaGFuZ2VBY3RpdmVQZXRTaG9ydGN1dC5ocmVmID0gIiMiCiAgICAgICAgICAgIGNoYW5nZUFjdGl2ZVBldFNob3J0Y3V0LmlubmVySFRNTCA9ICJDaGFuZ2UgQWN0aXZlIFBldCIKICAgICAgICB9CgogICAgICAgIGFkZENTUygpCgogICAgICAgIGNoYW5nZUFjdGl2ZVBldFNob3J0Y3V0LmNsYXNzTGlzdC5hZGQoIm9wZW5tZW51YnV0dG9uIikKICAgICAgICBjaGFuZ2VBY3RpdmVQZXRTaG9ydGN1dC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgICAgICAgICAgb3Blbk1lbnUoKQogICAgICAgIH0pCgogICAgICAgIHBhcmVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoY2hhbmdlQWN0aXZlUGV0U2hvcnRjdXQpOwogICAgICAgIGNyZWF0ZU1lbnUoKQogICAgfQp9CgpmdW5jdGlvbiBjcmVhdGVNZW51KCkgewogICAgbGV0IG1lbnUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQogICAgbWVudS5pZCA9ICJzZWxlY3QtYWN0aXZlLXBldC1tZW51IgogICAgbWVudS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiIC8vc3RhcnRzIG5vdCB2aXNpYmxlCgogICAgbWVudS5hcHBlbmRDaGlsZChnZXRUYWJsZUhlYWRlcihgPGI+U2VsZWN0IGFuIEFjdGl2ZSBQZXQ6PC9iPjxicj48c21hbGw+PHNtYWxsPjxzbWFsbD4oQ2xpY2sgYW55d2hlcmUgZWxzZSB0byBleGl0KTwvc21hbGw+PC9zbWFsbD48L3NtYWxsPmApKQoKICAgIGxldCB0YWJsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRhYmxlIikKICAgIHRhYmxlLmNsYXNzTGlzdC5hZGQoImFjdGl2ZXRhYmxlIikKICAgIG1lbnUuYXBwZW5kQ2hpbGQodGFibGUpCiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG1lbnUpCgogICAgLy8gcmV2YWxpZGF0ZXMgaWYgaXQgbmVlZHMgdG8KICAgIGlmIChzaG91bGRVcGRhdGUoKSkgewogICAgICAgIHVwZGF0ZVBldExpc3QoKQogICAgICAgIHJldHVybgogICAgfQoKICAgIHBvcHVsYXRlVGFibGVzKCkKfQoKZnVuY3Rpb24gcG9wdWxhdGVUYWJsZXMoKSB7CiAgICBsZXQgcGV0TGlzdCA9IE9iamVjdC52YWx1ZXMoR01fZ2V0VmFsdWUoInBldGxpc3QiLCB7fSkpCiAgICBpZiAocGV0TGlzdC5sZW5ndGggPCAxKSB7CiAgICAgICAgYWRkTG9hZERpdnMoKQogICAgICAgIHVwZGF0ZVBldExpc3QoKQogICAgICAgIHJldHVybgogICAgfQoKICAgIEFycmF5LmZyb20oJCgiLmFjdGl2ZXRhYmxlIikpLmZvckVhY2godGFibGUgPT4gewogICAgICAgIHRhYmxlLmlubmVySFRNTCA9ICIiCgogICAgICAgIGxldCBhY3RpdmVQZXQgPSBnZXRBY3RpdmVQZXQoKQoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDQ7IGkrKykgeyAvLzQgcm93cwogICAgICAgICAgICBsZXQgcm93ID0gdGFibGUuaW5zZXJ0Um93KCkKICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCA1OyBqKyspIHsgLy81IHBlciByb3cKICAgICAgICAgICAgICAgIGxldCBpbmRleCA9IGkgKiA1ICsgagogICAgICAgICAgICAgICAgaWYgKGluZGV4IDwgcGV0TGlzdC5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICBsZXQgaW1nID0gcGV0TGlzdFtpbmRleF0uaW1nLndpdGhCRyAvLzMwMHgzMDAKICAgICAgICAgICAgICAgICAgICBsZXQgbmFtZSA9IHBldExpc3RbaW5kZXhdLm5hbWUKCiAgICAgICAgICAgICAgICAgICAgbGV0IGNlbGwgPSByb3cuaW5zZXJ0Q2VsbCgpCiAgICAgICAgICAgICAgICAgICAgY2VsbC5zZXRBdHRyaWJ1dGUoIm5hbWUiLCBuYW1lKQogICAgICAgICAgICAgICAgICAgIC8vbmFtZSA9ICJ0ZXN0IgogICAgICAgICAgICAgICAgICAgIGxldCBkMSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpLCBkMiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCiAgICAgICAgICAgICAgICAgICAgZDEuaW5uZXJIVE1MID0gYDxpbWcgc3JjPSR7aW1nfSB3aWR0aD0iMTUwIiBoZWlnaHQ9IjE1MCIgYWx0PSR7bmFtZX0+YAogICAgICAgICAgICAgICAgICAgIGQxLnN0eWxlLndpZHRoID0gIjE1MHB4ICFpbXBvcnRhbnQiOwogICAgICAgICAgICAgICAgICAgIGQxLnN0eWxlLmhlaWdodCA9ICIxNTBweCAhaW1wb3J0YW50IjsKICAgICAgICAgICAgICAgICAgICBkMi5pbm5lckhUTUwgPSBuYW1lCiAgICAgICAgICAgICAgICAgICAgY2VsbC5hcHBlbmRDaGlsZChkMSkKICAgICAgICAgICAgICAgICAgICBjZWxsLmFwcGVuZENoaWxkKGQyKQoKICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aXZlUGV0ID09PSBuYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGwuc2V0QXR0cmlidXRlKCJhY3RpdmUiLCAiIikKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKGV2ZW50KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZUFjdGl2ZVBldChuYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgY2VsbC5zdHlsZS5jdXJzb3IgPSAicG9pbnRlciIKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmICh1cmwuaW5jbHVkZXMoIndhdGVyL2Zpc2hpbmcucGh0bWwiKSB8fCBGSVNISU5HX0RJU1BMQVlfTU9ERSA9PT0gMikgewogICAgICAgICAgICAgICAgICAgICAgICBhZGRGaXNoaW5nUGV0RGlzcGxheShjZWxsLCBuYW1lKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgbGV0IHJlZnJlc2ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIikKICAgICAgICByZWZyZXNoLmlubmVySFRNTCA9ICIocmVmcmVzaCBwZXQgbGlzdCkiCiAgICAgICAgcmVmcmVzaC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIChldmVudCkgPT4gewogICAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKQogICAgICAgICAgICB1cGRhdGVQZXRMaXN0KCkgLy91cGRhdGVzIHBldCBsaXN0CiAgICAgICAgfSkKICAgICAgICB0YWJsZS5hcHBlbmRDaGlsZChyZWZyZXNoKQogICAgICAgIGNvbnNvbGUubG9nKGBbQVBTXSBUYWJsZSBwb3B1bGF0ZWQgd2l0aCAke3BldExpc3QubGVuZ3RofSBwZXRzLmApCiAgICB9KQp9CgpmdW5jdGlvbiBhZGRMb2FkRGl2cygpIHsKICAgIGxldCBsb2FkTXNnID0gJzxkaXYgY2xhc3M9ImRvdC1zcGluIj48L2Rpdj48ZGl2IHN0eWxlPSJtYXJnaW4tdG9wOiAzMHB4Ij5GZXRjaGluZyBwZXQgZGF0YS4uLjwvZGl2PicKICAgIEFycmF5LmZyb20oJCgiLmFjdGl2ZXRhYmxlIikpLmZvckVhY2godGFibGUgPT4gdGFibGUuaW5uZXJIVE1MID0gbG9hZE1zZykKCiAgICAvLyBpZiBpdCBoYXNuJ3QgZ3JhYmJlZCByZXN1bHRzIGFmdGVyIDUgc2Vjb25kcywgZGlzcGxheSBhIG1lc3NhZ2UKICAgIHRpbWVvdXRJZCA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIEFycmF5LmZyb20oJCgiLmFjdGl2ZXRhYmxlIikpLmZvckVhY2godGFibGUgPT4gewogICAgICAgICAgICBpZiAodGFibGUuaW5uZXJIVE1MID09PSBsb2FkTXNnKSB7CiAgICAgICAgICAgICAgICB0YWJsZS5pbm5lckhUTUwgKz0gJzxkaXY+PGEgaHJlZj0iL2hvbWUiIHRhcmdldD0iX2JsYW5rIj48c21hbGw+KGNsaWNrIGhlcmUgaWYgaXRzIHRha2luZyB0b28gbG9uZyk8L3NtYWxsPjwvYT48L2Rpdj4nCiAgICAgICAgICAgIH0KICAgICAgICB9KQogICAgfSwgMzAwMCkKfQoKZnVuY3Rpb24gZ2V0VGFibGVIZWFkZXIoaW5uZXJIVE1MKSB7CiAgICBsZXQgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKICAgIGhlYWRlci5jbGFzc0xpc3QuYWRkKCJhY3RpdmV0YWJsZWhlYWRlciIpCiAgICBoZWFkZXIuaW5uZXJIVE1MID0gaW5uZXJIVE1MCiAgICByZXR1cm4gaGVhZGVyCn0KCmZ1bmN0aW9uIGFkZEZpc2hpbmdUYWJsZShoZWFkZXIpIHsKICAgIGxldCBtZW51ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKICAgIG1lbnUuY2xhc3NMaXN0LmFkZCgidmVydGljYWwiKQogICAgJCgiI2NvbnRhaW5lcl9fMjAyMCIpWzBdLmFwcGVuZENoaWxkKG1lbnUpCgogICAgbWVudS5hcHBlbmRDaGlsZChnZXRUYWJsZUhlYWRlcihoZWFkZXIpKQoKICAgIGxldCB0YWJsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRhYmxlIikKICAgIHRhYmxlLmNsYXNzTGlzdC5hZGQoImFjdGl2ZXRhYmxlIikKICAgIHRhYmxlLnN0eWxlLm1hcmdpbiA9ICJhdXRvIgogICAgbWVudS5hcHBlbmRDaGlsZCh0YWJsZSkKfQoKCi8vPT09PT09PT09PT09PT09PT09PT09Ci8vZWxlbWVudCBmdW5jdGlvbmFsaXR5Ci8vPT09PT09PT09PT09PT09PT09PT09CgpmdW5jdGlvbiBvcGVuTWVudSgpIHsKICAgICQoIiNzZWxlY3QtYWN0aXZlLXBldC1tZW51IikuY3NzKCJkaXNwbGF5IiwgImZsZXgiKSAvL21ha2VzIG1lbnUgdmlzaWJsZQogICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGV4aXRDbGljaywgZmFsc2UpCiAgICB9LCA1MCkgLy9hZGRzIHRoZSBleGl0IGNsaWNrIGEgc2hvcnQgZGVsYXkgYWZ0ZXIgbWVudSBpcyBjcmVhdGVkCn0KCmZ1bmN0aW9uIGV4aXRDbGljayhldmVudCkgewogICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCkKICAgIGlmICghKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5hY3RpdmV0YWJsZWhlYWRlciIpLmNvbnRhaW5zKGV2ZW50LnRhcmdldCkgfHwgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLmFjdGl2ZXRhYmxlIikuY29udGFpbnMoZXZlbnQudGFyZ2V0KSkpIHsKICAgICAgICAkKCIjc2VsZWN0LWFjdGl2ZS1wZXQtbWVudSIpWzBdLnN0eWxlLmRpc3BsYXkgPSAibm9uZSIKICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZXhpdENsaWNrLCBmYWxzZSkKICAgIH0KfQoKZnVuY3Rpb24gY2hhbmdlQWN0aXZlUGV0KG5hbWUpIHsKICAgIGxldCBpbWcgPSBHTV9nZXRWYWx1ZSgicGV0bGlzdCIsIHt9KVtuYW1lXS5pbWcud2l0aEJHCgogICAgQXJyYXkuZnJvbSgkKCIuYWN0aXZldGFibGUiKSkuZm9yRWFjaCh0YWJsZSA9PiB7CiAgICAgICAgdGFibGUuaW5uZXJIVE1MID0gIiIKICAgICAgICBsZXQgZDEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSwgZDIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSwgZDMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKQogICAgICAgIGQxLmlubmVySFRNTCA9IGA8aW1nIHNyYz0ke2ltZ30gd2lkdGg9IjE1MCIgaGVpZ2h0PSIxNTAiIGFsdD0ke25hbWV9PmAKICAgICAgICBkMS5zdHlsZS5vcGFjaXR5ID0gIjAuOCIKICAgICAgICBkMS5zdHlsZS53aWR0aCA9ICIxNTBweCAhaW1wb3J0YW50IgogICAgICAgIGQxLnN0eWxlLmhlaWdodCA9ICIxNTBweCAhaW1wb3J0YW50IgogICAgICAgIGQxLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siCiAgICAgICAgZDEuc3R5bGUucG9zaXRpb24gPSAicmVsYXRpdmUiCiAgICAgICAgZDMuY2xhc3NMaXN0LmFkZCgiZG90LXNwaW4iKQogICAgICAgIGQzLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siCiAgICAgICAgZDMuc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiCiAgICAgICAgZDMuc3R5bGUudG9wID0gIjUwJSIKICAgICAgICBkMy5zdHlsZS5sZWZ0ID0gIjUwJSIKICAgICAgICBkMy5zdHlsZS50cmFuc2Zvcm0gPSAidHJhbnNsYXRlKC01MCUsIC01MCUpIgogICAgICAgIGQxLmFwcGVuZENoaWxkKGQzKQogICAgICAgIGQyLmlkID0gInNldC1hY3RpdmUtbXNnIgogICAgICAgIGQyLmlubmVySFRNTCA9IGBTZXR0aW5nICR7bmFtZX0gYXMgYWN0aXZlIHBldC4uLmAKICAgICAgICB0YWJsZS5hcHBlbmRDaGlsZChkMSkKICAgICAgICB0YWJsZS5hcHBlbmRDaGlsZChkMikKICAgIH0pCgogICAgJC5nZXQoIi9wcm9jZXNzX2NoYW5nZXBldC5waHRtbD9uZXdfYWN0aXZlX3BldD0iICsgbmFtZSwgZnVuY3Rpb24gKCkgewogICAgICAgIGNvbnNvbGUubG9nKGBbQVBTXSBBY3RpdmUgcGV0IGNoYW5nZWQgdG8gJHtuYW1lfS5gKQogICAgICAgIEFycmF5LmZyb20oJCgiLmFjdGl2ZXRhYmxlIikpLmZvckVhY2godGFibGUgPT4gewogICAgICAgICAgICB0YWJsZS5xdWVyeVNlbGVjdG9yKCIuZG90LXNwaW4iKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiCiAgICAgICAgICAgIHRhYmxlLnF1ZXJ5U2VsZWN0b3IoIiNzZXQtYWN0aXZlLW1zZyIpLmlubmVySFRNTCA9IGAke25hbWV9IGlzIG5vdyB5b3VyIGFjdGl2ZSBwZXQhYAogICAgICAgIH0pCgogICAgICAgIGlmICh1cmwuaW5jbHVkZXMoIndhdGVyL2Zpc2hpbmcucGh0bWwiKSkgewogICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVwbGFjZSgiZmlzaGluZy5waHRtbCIpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpCiAgICAgICAgfQogICAgfSkKfQoKCi8vPT09PT09PT09PT09PT09PT09Ci8vIGZ2cCBmdW5jdGlvbmFsaXR5Ci8vPT09PT09PT09PT09PT09PT09CmZ1bmN0aW9uIGlzRmlzaGluZ1Jlc3VsdFBhZ2UoKSB7CiAgICByZXR1cm4gQXJyYXkuZnJvbSgkKCIjY29udGFpbmVyX18yMDIwID4gcCIpKS5zb21lKChwKSA9PiB7CiAgICAgICAgcmV0dXJuIHAuaW5uZXJIVE1MID09PSAiWW91IHJlZWwgaW4geW91ciBsaW5lIGFuZCBnZXQuLi4iCiAgICB9KQp9CgpmdW5jdGlvbiBpc0Zpc2hpbmdIb21lUGFnZSgpIHsKICAgIHJldHVybiAkKCIjcGFnZURlc2MiKS5sZW5ndGggPiAwCn0KCmZ1bmN0aW9uIGhhbmRsZUZpc2hpbmdWb3J0ZXgoKSB7CgogICAgaWYgKGlzRmlzaGluZ1Jlc3VsdFBhZ2UoKSkgewogICAgICAgIGlmIChGSVNISU5HX0RJU1BMQVlfTU9ERSA+PSAwKSB7CiAgICAgICAgICAgIGFkZEZpc2hpbmdUYWJsZShgPGI+RmlzaCBXaXRoOjwvYj5gKQogICAgICAgIH0KCiAgICAgICAgaWYgKFJFTU9WRV9DQVNUX0JVVFRPTikgewogICAgICAgICAgICByZW1vdmVDYXN0QnV0dG9uKCkKICAgICAgICB9CgogICAgICAgIGlmIChGSVNISU5HX1RJTUVfVFJBQ0sgfHwgRklTSElOR19MRVZFTF9UUkFDSykgewogICAgICAgICAgICBoYW5kbGVGaXNoaW5nUmVzdWx0KCkKICAgICAgICB9CiAgICAgICAgcmV0dXJuCiAgICB9CgogICAgaWYgKGlzRmlzaGluZ0hvbWVQYWdlKCkpIHsKICAgICAgICBpZiAoRklTSElOR19ESVNQTEFZX01PREUgPj0gMCkgewogICAgICAgICAgICBhZGRGaXNoaW5nVGFibGUoYDxiPkNoYW5nZSBBY3RpdmUgUGV0OjwvYj5gKQogICAgICAgIH0KCiAgICAgICAgaWYgKEZJU0hJTkdfTEVWRUxfVFJBQ0spIHsKICAgICAgICAgICAgaW5pdGlhbGl6ZVBldExldmVsKCkKICAgICAgICB9CgogICAgICAgICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgJCgnaW5wdXRbdmFsdWU9IlJlZWwgSW4gWW91ciBMaW5lIl0nKS5jbGljaygpCiAgICAgICAgfSkKICAgIH0KfQoKZnVuY3Rpb24gaW5pdGlhbGl6ZVBldExldmVsKCkgewogICAgbGV0IGxpc3QgPSBHTV9nZXRWYWx1ZSgiZmlzaGluZ2xpc3QiLCB7fSkKICAgIGxldCBuYW1lID0gZ2V0QWN0aXZlUGV0KCkKICAgIGlmICghaXNOYU4obGlzdFtuYW1lXT8ubHZsKSkgewogICAgICAgIGxldCBsdmwgPSAkKCIjY29udGFpbmVyX18yMDIwID4gcDpsYXN0LW9mLXR5cGUgPiBiIilbMF0uaW5uZXJIVE1MCgogICAgICAgIGxpc3RbbmFtZV0gPSB7CiAgICAgICAgICAgIGx2bDogbHZsLAogICAgICAgICAgICB4cDogbGlzdFtuYW1lXT8ueHAsCiAgICAgICAgICAgIGxhc3R0aW1lOiBsaXN0W25hbWVdPy5sYXN0dGltZSB8fCBudWxsCiAgICAgICAgfQoKICAgICAgICBpZiAobGlzdFtuYW1lXS54cCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGxpc3RbbmFtZV0ueHAgPSBudWxsCiAgICAgICAgfQoKICAgICAgICBHTV9zZXRWYWx1ZSgiZmlzaGluZ2xpc3QiLCBsaXN0KQogICAgICAgIGNvbnNvbGUubG9nKGBbRlZQXSBSZWNvcmRlZCAke25hbWV9J3MgZmlzaGluZyBsZXZlbC4gKCR7bHZsfSlgKQogICAgfQp9CgpmdW5jdGlvbiByZW1vdmVDYXN0QnV0dG9uKCkgewogICAgJCgnI2NvbnRhaW5lcl9fMjAyMCA+IGFbaHJlZj0iL3dhdGVyL2Zpc2hpbmcucGh0bWwiXScpLmNzcygiZGlzcGxheSIsICJub25lIikKICAgICQoIiNjb250YWluZXJfXzIwMjAgPiBicjpsYXN0LW9mLXR5cGUiKS5jc3MoImRpc3BsYXkiLCAibm9uZSIpCiAgICBjb25zb2xlLmxvZygiW0ZWUF0gUmVtb3ZlZCBjYXN0IGFnYWluIGJ1dHRvbi4iKQp9CgpmdW5jdGlvbiBsZXZlbFVwKGRhdGEsIGx2bFVwTWVzc2FnZSkgewogICAgZGF0YS5sdmwgPSBsdmxVcE1lc3NhZ2VbMF0ucXVlcnlTZWxlY3RvcigiYiIpLmlubmVySFRNTAogICAgaWYgKEZJU0hJTkdfWFBfVFJBQ0spIHsKICAgICAgICBkYXRhLnhwID0gMAogICAgfQp9CgpmdW5jdGlvbiBoYW5kbGVGaXNoaW5nUmVzdWx0KCkgewogICAgLy9pZiB0aGVyZXMgYSByZXdhcmQsIGRvIHN0dWZmCiAgICBpZiAoJCgiI2NvbnRhaW5lcl9fMjAyMCA+IGRpdi5pdGVtLXNpbmdsZV9fMjAyMCIpLmxlbmd0aCkgewogICAgICAgIGxldCBsaXN0ID0gR01fZ2V0VmFsdWUoImZpc2hpbmdsaXN0Iiwge30pCiAgICAgICAgbGV0IG5hbWUgPSBnZXRBY3RpdmVQZXQoKQogICAgICAgIGxldCBkYXRhID0gbGlzdFtuYW1lXSB8fCB7CiAgICAgICAgICAgIGx2bDogbnVsbCwKICAgICAgICAgICAgeHA6IG51bGwsCiAgICAgICAgICAgIGxhc3R0aW1lOiBudWxsCiAgICAgICAgfQoKICAgICAgICBpZiAoRklTSElOR19USU1FX1RSQUNLKSB7CiAgICAgICAgICAgIGRhdGEubGFzdHRpbWUgPSBuZXcgRGF0ZSgpLnZhbHVlT2YoKQogICAgICAgIH0KCiAgICAgICAgaWYgKEZJU0hJTkdfTEVWRUxfVFJBQ0spIHsKICAgICAgICAgICAgbGV0IGx2bFVwTWVzc2FnZSA9IEFycmF5LmZyb20oJCgiI2NvbnRhaW5lcl9fMjAyMCA+IHAiKSkuZmlsdGVyKChwKSA9PiB7CiAgICAgICAgICAgICAgICByZXR1cm4gcC5pbm5lckhUTUwuaW5jbHVkZXMoIllvdXIgcGV0J3MgZmlzaGluZyBza2lsbCBpbmNyZWFzZXMgdG8iKQogICAgICAgICAgICB9KQoKICAgICAgICAgICAgaWYgKGx2bFVwTWVzc2FnZS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGxldmVsVXAoZGF0YSwgbHZsVXBNZXNzYWdlKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChGSVNISU5HX1hQX1RSQUNLICYmIGRhdGEueHAgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgZGF0YS54cCArPSAxMDAKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgbGlzdFtuYW1lXSA9IGRhdGEKICAgICAgICBjb25zb2xlLmxvZyhgW0ZWUF0gRmlzaGluZyByZXN1bHRzIGZvciAke25hbWV9IHJlY29yZGVkLmApCiAgICAgICAgR01fc2V0VmFsdWUoImZpc2hpbmdsaXN0IiwgbGlzdCkKICAgIH0KfQoKZnVuY3Rpb24gYWRkTGV2ZWxEaXNwbGF5KGRhdGEsIGNlbGwpIHsKICAgIGxldCBsZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikKICAgIGxkaXYuY2xhc3NMaXN0LmFkZCgibGV2ZWxkaXNwbGF5IiwgImZpc2hpbmdkaXNwbGF5IikKICAgIGxkaXYuaW5uZXJIVE1MID0gYEx2LiR7ZGF0YS5sdmwgfHwgIig/KSJ9YAogICAgbGV0IGxob3ZlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCiAgICBsaG92ZXIuY2xhc3NMaXN0LmFkZCgiZmlzaGluZ2Rpc3BsYXkiKQogICAgbGV0IGNoYW5jZSA9IGdldExldmVsVXBDaGFuY2UoZGF0YS54cCwgZGF0YS5sdmwpCiAgICBpZiAoY2hhbmNlID09IG51bGwpIGxob3Zlci5pbm5lckhUTUwgPSAiKD8pJSBjaGFuY2UgdG8gbHYgdXAiCiAgICBlbHNlIGxob3Zlci5pbm5lckhUTUwgPSBgJHtnZXRMZXZlbFVwQ2hhbmNlKGRhdGEueHAsIGRhdGEubHZsKX0lIGNoYW5jZSB0byBsdiB1cGAKICAgIGlmIChkYXRhLnhwID09IG51bGwpIGxob3Zlci5pbm5lckhUTUwgKz0gYDxicj5FeHA6ICg/KWAKICAgIGVsc2UgbGhvdmVyLmlubmVySFRNTCArPSBgPGJyPkV4cDogJHtkYXRhLnhwfWAKICAgIGxkaXYuYXBwZW5kQ2hpbGQobGhvdmVyKQogICAgY2VsbC5hcHBlbmRDaGlsZChsZGl2KQp9CgpmdW5jdGlvbiBhZGRUaW1lRGlzcGxheShkYXRhLCBjZWxsKSB7CiAgICBsZXQgdGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpCiAgICB0ZGl2LmNsYXNzTGlzdC5hZGQoInRpbWVkaXNwbGF5IiwgImZpc2hpbmdkaXNwbGF5IiwgImNpcmN1bGFyLXByb2dyZXNzIikKICAgIC8vZGVhbHMgd2l0aCBkaXNwbGF5IHcvbyBhIHJlY29yZGVkIHRpbWUKICAgIGlmIChkYXRhLmxhc3R0aW1lID09IG51bGwpIHsKICAgICAgICB0ZGl2LmlubmVySFRNTCA9IGAKICAgICAgICAgIDxkaXYgY2xhc3M9ImlubmVyLWNpcmNsZSBmaXNoaW5nZGlzcGxheSI+PC9kaXY+CiAgICAgICAgICA8cCBjbGFzcz0icGVyY2VudGFnZSBmaXNoaW5nZGlzcGxheSI+KD8paHI8L3A+CiAgICAgICAgYAogICAgICAgIHRkaXYuc3R5bGUuYmFja2dyb3VuZCA9IGAjYzRjNGM0YAogICAgfSBlbHNlIHsKICAgICAgICBsZXQgdCA9IGdldFRpbWVTaW5jZUZpc2hlZChkYXRhLmxhc3R0aW1lKQogICAgICAgIHRkaXYuaW5uZXJIVE1MID0gYAogICAgICAgICAgPGRpdiBjbGFzcz0iaW5uZXItY2lyY2xlIGZpc2hpbmdkaXNwbGF5Ij48L2Rpdj4KICAgICAgICAgIDxwIGNsYXNzPSJwZXJjZW50YWdlIGZpc2hpbmdkaXNwbGF5Ij4ke3QudG9GaXhlZCgxKX1ocjwvcD4KICAgICAgICBgCiAgICAgICAgdGRpdi5zdHlsZS5iYWNrZ3JvdW5kID0gYGNvbmljLWdyYWRpZW50KCR7Z2V0Q2lyY2xlQ29sb3IodCAvIDI2LjApfSAke3QgLyAyNi4wICogMzYwfWRlZywgI2M0YzRjNCAwZGVnKWAKICAgIH0KICAgIGNlbGwuYXBwZW5kQ2hpbGQodGRpdikKfQoKZnVuY3Rpb24gYWRkRmlzaGluZ1BldERpc3BsYXkoY2VsbCwgbmFtZSkgewogICAgbGV0IGRhdGEgPSBHTV9nZXRWYWx1ZSgiZmlzaGluZ2xpc3QiLCB7fSlbbmFtZV0gfHwgewogICAgICAgIGx2bDogbnVsbCwKICAgICAgICB4cDogbnVsbCwKICAgICAgICBsYXN0dGltZTogbnVsbAogICAgfQoKICAgIGFkZExldmVsRGlzcGxheShkYXRhLCBjZWxsKTsKICAgIGFkZFRpbWVEaXNwbGF5KGRhdGEsIGNlbGwpOwp9CgpmdW5jdGlvbiBnZXRDaXJjbGVDb2xvcihwKSB7CiAgICBpZiAocCA8IDAuMikgewogICAgICAgIHJldHVybiAiI2U4N2U3MiIKICAgIH0KCiAgICBpZiAocCA8IDAuNCkgewogICAgICAgIHJldHVybiAiI2U4Yjk3MiIKICAgIH0KCiAgICBpZiAocCA8IDAuNikgewogICAgICAgIHJldHVybiAiI2ViZWQ3NyIKICAgIH0KCiAgICBpZiAocCA8IDAuOCkgewogICAgICAgIHJldHVybiAiI2MwZWQ3NyIKICAgIH0KCiAgICBpZiAocCA8IDEuMCkgewogICAgICAgIHJldHVybiAiIzc3ZWQ3ZCIKICAgIH0KCiAgICByZXR1cm4gIiM4OGYyZGQiCn0KCmZ1bmN0aW9uIGdldFRpbWVTaW5jZUZpc2hlZCh0ZmlzaCkgewogICAgaWYgKHRmaXNoID09IG51bGwpIHsKICAgICAgICByZXR1cm4gbnVsbAogICAgfQoKICAgIGxldCB0ID0gbmV3IERhdGUoKS52YWx1ZU9mKCkgLSB0ZmlzaAogICAgcmV0dXJuIE1hdGgubWluKE1hdGguZmxvb3IoKHQgLyAoMTAwMC4wICogNjAuMCAqIDYwLjApKSAqIDEwKSAvIDEwLjAsIDI2LjApIC8vIyBvZiBocnMgdy8gMSBkZWNpbWFsIHBsYWNlLCByb3VuZGVkIGRvd24KfQoKZnVuY3Rpb24gZ2V0TGV2ZWxVcENoYW5jZShleHAsIGx2bCkgewogICAgLy9pZiB3ZSBkb250IGhhdmUgdGhlIGRhdGEgZm9yIGVpdGhlciwgb3VyIGNoYW5jZSBpcyB1bmtub3duCiAgICBpZiAoZXhwID09IG51bGwgfHwgbHZsID09IG51bGwpIHsKICAgICAgICByZXR1cm4gbnVsbAogICAgfQoKICAgIC8vaWYgKDEtMTAwKSA8PSBwLCB3ZSB3aW4uIChlZyBpZiBwID0gNSwgd2UgaGF2ZSBhIDUlIGNoYW5jZSkKICAgIGxldCBwID0gTWF0aC5mbG9vcigoKGV4cCArIDEwMCkgLSBsdmwgLSAyMCkgLyAxLjgpCiAgICByZXR1cm4gTWF0aC5tYXgocCwgMC4wKS50b0ZpeGVkKDEpIC8vY2FuJ3QgaGF2ZSBuZWdhdGl2ZSBwZXJjZW50YWdlLCByb3VuZHMgdG8gMSBkZWNpbWFsCn0KCgovLz09PT09PT09Ci8vIGdldHRlcnMKLy89PT09PT09PQpmdW5jdGlvbiBwZXRzU29ydGVkQWxwaGFiZXRpY2FsbHkocGV0SW5mbykgewogICAgcmV0dXJuIE9iamVjdC5rZXlzKHBldEluZm8pLnNvcnQoKS5yZWR1Y2UoKG9iaiwga2V5KSA9PiB7CiAgICAgICAgb2JqW2tleV0gPSBwZXRJbmZvW2tleV0KICAgICAgICByZXR1cm4gb2JqCiAgICB9LCB7fSk7Cn0KCmZ1bmN0aW9uIGdldFVzZXJuYW1lKCkgewogICAgaWYgKGlzQmV0YSkgewogICAgICAgIHJldHVybiAkKCIjbmF2cHJvZmlsZWRyb3Bkb3duX18yMDIwID4gZGl2Om50aC1jaGlsZCgzKSBhLnRleHQtbXV0ZWQiKVswXS5pbm5lckhUTUwKICAgIH0KCiAgICByZXR1cm4gJCgiI2hlYWRlciA+IHRhYmxlID4gdGJvZHkgPiB0cjpudGgtY2hpbGQoMSkgPiB0ZC51c2VyLm1lZFRleHQgYVtocmVmXSIpWzBdLmlubmVySFRNTAp9CgpmdW5jdGlvbiBnZXRQZXRzKGRvYykgewogICAgbGV0IGVsZW1lbnRzID0gQXJyYXkuZnJvbShkb2MucXVlcnlTZWxlY3RvckFsbCgiLmhwLWNhcm91c2VsLXBldCIpKQogICAgbGV0IHBldE5hbWVzID0gZWxlbWVudHMubWFwKGUgPT4gZS5nZXRBdHRyaWJ1dGUoImRhdGEtbmFtZSIpKQogICAgcGV0TmFtZXMgPSBwZXROYW1lcy5maWx0ZXIoKG4sIGluZGV4KSA9PiBwZXROYW1lcy5pbmRleE9mKG4pID09PSBpbmRleCkKCiAgICBsZXQgcGV0SW5mbyA9IHt9CgogICAgcGV0TmFtZXMuZm9yRWFjaChuYW1lID0+IHsKICAgICAgICBsZXQgZSA9IGVsZW1lbnRzLmZpbmQoZSA9PiBlLmdldEF0dHJpYnV0ZSgiZGF0YS1uYW1lIikgPT09IG5hbWUpCiAgICAgICAgbGV0IGltZyA9IHtub0JHOiBlLnN0eWxlLmJhY2tncm91bmRJbWFnZS5yZXBsYWNlKCciJywgIiIpLnNsaWNlKDUsIC0yKSwgd2l0aEJHOiBlLmdldEF0dHJpYnV0ZSgiZGF0YS1wZXRpbWFnZSIpfQogICAgICAgIGxldCBzcGVjaWVzID0gZS5nZXRBdHRyaWJ1dGUoImRhdGEtc3BlY2llcyIpCiAgICAgICAgbGV0IGNvbG9yID0gZS5nZXRBdHRyaWJ1dGUoImRhdGEtY29sb3IiKQogICAgICAgIGxldCBnZW5kZXIgPSBlLmdldEF0dHJpYnV0ZSgiZGF0YS1nZW5kZXIiKQogICAgICAgIGxldCBocCA9IGAke2UuZ2V0QXR0cmlidXRlKCJkYXRhLWhlYWx0aCIpfS8ke2UuZ2V0QXR0cmlidXRlKCJkYXRhLW1heGhlYWx0aCIpfWAKICAgICAgICBsZXQgbGV2ZWwgPSBlLmdldEF0dHJpYnV0ZSgiZGF0YS1sZXZlbCIpCiAgICAgICAgbGV0IGh1bmdlciA9IGUuZ2V0QXR0cmlidXRlKCJkYXRhLWh1bmdlciIpCiAgICAgICAgbGV0IG1vb2QgPSBlLmdldEF0dHJpYnV0ZSgiZGF0YS1tb29kIikKICAgICAgICBsZXQgcDIgPSBnZXRQZXRwZXQoZSkKICAgICAgICBwZXRJbmZvW25hbWVdID0gewogICAgICAgICAgICBuYW1lOiBuYW1lLAogICAgICAgICAgICBzcGVjaWVzOiBzcGVjaWVzLAogICAgICAgICAgICBjb2xvcjogY29sb3IsCiAgICAgICAgICAgIGltZzogaW1nLAogICAgICAgICAgICBnZW5kZXI6IGdlbmRlciwKICAgICAgICAgICAgaHA6IGhwLAogICAgICAgICAgICBsZXZlbDogbGV2ZWwsCiAgICAgICAgICAgIGh1bmdlcjogaHVuZ2VyLAogICAgICAgICAgICBtb29kOiBtb29kLAogICAgICAgICAgICBwMjogcDIKICAgICAgICB9CiAgICB9KQoKICAgIGlmIChwZXRJbmZvID09PSB7fSkgcmV0dXJuIG51bGwKICAgIHJldHVybiBwZXRzU29ydGVkQWxwaGFiZXRpY2FsbHkocGV0SW5mbykKfQoKZnVuY3Rpb24gZ2V0UGV0cGV0KGUpIHsKICAgIGxldCBwZXRwZXQgPSBudWxsCiAgICBpZiAoZS5oYXNBdHRyaWJ1dGUoImRhdGEtcGV0cGV0IikpIHsKICAgICAgICBsZXQgcCA9IGUuZ2V0QXR0cmlidXRlKCJkYXRhLXBldHBldCIpLnNwbGl0KCIgIikgLy9ubywgbmFtZSwgdGhlLCBmaXIKICAgICAgICBsZXQgbmFtZSA9IHAuc2xpY2UoMCwgcC5sYXN0SW5kZXhPZigidGhlIikpLmpvaW4oIiAiKQogICAgICAgIGxldCBzcGVjaWVzID0gcC5zbGljZShwLmxhc3RJbmRleE9mKCJ0aGUiKSArIDEsIHAubGVuZ3RoKS5qb2luKCIgIikKICAgICAgICBsZXQgaW1nID0gZS5nZXRBdHRyaWJ1dGUoImRhdGEtcGV0cGV0aW1nIikKICAgICAgICBsZXQgcDMgPSBudWxsCiAgICAgICAgaWYgKGUuaGFzQXR0cmlidXRlKCJkYXRhLXAzIikpIHAzID0ge25hbWU6IGUuZ2V0QXR0cmlidXRlKCJkYXRhLXAzIiksIGltZzogZS5nZXRBdHRyaWJ1dGUoImRhdGEtcDNpbWciKX0KICAgICAgICBwZXRwZXQgPSB7bmFtZTogbmFtZSwgc3BlY2llczogc3BlY2llcywgaW1nOiBpbWcsIHAzOiBwM30KICAgIH0KICAgIHJldHVybiBwZXRwZXQKfQoKZnVuY3Rpb24gZ2V0QWN0aXZlUGV0KCkgewogICAgaWYgKGlzQmV0YSkgewogICAgICAgIHJldHVybiAkKCIjbmF2cHJvZmlsZWRyb3Bkb3duX18yMDIwID4gZGl2Om50aC1jaGlsZCg0KSA+IGEiKVswXS5pbm5lckhUTUwKICAgIH0KCiAgICByZXR1cm4gJCgiI2NvbnRlbnQgPiB0YWJsZSA+IHRib2R5ID4gdHIgPiB0ZC5zaWRlYmFyID4gZGl2Om50aC1jaGlsZCgxKSA+IHRhYmxlID4gdGJvZHkgPiB0cjpudGgtY2hpbGQoMSkgPiB0ZCA+IGEgPiBiIilbMF0uaW5uZXJIVE1MCn0KCgpmdW5jdGlvbiBnZXRCdXR0b25Mb2NhdGlvbigpIHsKICAgIGlmIChpc0JldGEpIHZhciBlID0gJCgiLm5hdnN1Yi1sZWZ0X18yMDIwIikKICAgIGVsc2UgZSA9ICQoIi5hY3RpdmVQZXQiKQogICAgaWYgKGUubGVuZ3RoKSByZXR1cm4gZVswXQogICAgZWxzZSByZXR1cm4gbnVsbAp9CgoKLy89PT09PT09PQovLyBjc3MKLy89PT09PT09PQoKZnVuY3Rpb24gYWRkQ1NTKCkgewogICAgdmFyIHRoZW1lCiAgICB2YXIgYnV0dG9uCiAgICB2YXIgdGV4dAoKICAgIGlmIChpc0JldGEpIHsKICAgICAgICB0aGVtZSA9ICQoIi5uYXYtcHJvZmlsZS1kcm9wZG93bl9fMjAyMCIpLmNzcygiYmFja2dyb3VuZC1jb2xvciIpCiAgICAgICAgYnV0dG9uID0gJCgiLm5hdi1wcm9maWxlLWRyb3Bkb3duLXRleHQiKS5jc3MoImNvbG9yIikKICAgICAgICB0ZXh0ID0gJCgiLm5hdi1wcm9maWxlLWRyb3Bkb3duLXRleHQgYS50ZXh0LW11dGVkIikuY3NzKCJjb2xvciIpCgogICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3R5bGUiKSkuaW5uZXJIVE1MID0gYAogICAgICAgIC5vcGVubWVudWJ1dHRvbiB7CiAgICAgICAgICAgIGhlaWdodDogMjVweDsKICAgICAgICAgICAgd2lkdGg6IDMwcHg7CgogICAgICAgIH0KICAgICAgICBgCiAgICB9IGVsc2UgewogICAgICAgIHRoZW1lID0gJCgiI2NvbnRlbnQgPiB0YWJsZSA+IHRib2R5ID4gdHIgPiB0ZC5zaWRlYmFyID4gZGl2Om50aC1jaGlsZCgxKSA+IHRhYmxlID4gdGJvZHkgPiB0cjpudGgtY2hpbGQoMSkgPiB0ZCIpLmNzcygiYmFja2dyb3VuZC1jb2xvciIpCiAgICAgICAgYnV0dG9uID0gImdyYXkiOwogICAgICAgIHRleHQgPSAiYmxhY2siOwoKICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInN0eWxlIikpLmlubmVySFRNTCA9IGAKICAgICAgICAub3Blbm1lbnVidXR0b24gewogICAgICAgICAgICBtYXJnaW4tdG9wOiAzcHg7CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkIGJsYWNrOwogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRDNEM0QzOwogICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogOHB0OwogICAgICAgICAgICBwYWRkaW5nOiAxcHggMHB4IDFweDsKICAgICAgICAgICAgd2lkdGg6IDE0OHB4OwogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7CiAgICAgICAgICAgIGRpc3BsYXk6IGJsb2NrOwogICAgICAgICAgICBmb250LXdlaWdodDogbm9ybWFsOwogICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAgICAgfQogICAgICAgIC5vcGVubWVudWJ1dHRvbjpob3ZlciB7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNDMEMwQzA7CiAgICAgICAgfQogICAgICAgIC5vcGVubWVudWJ1dHRvbjphY3RpdmUgewogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjODA4MDgwOwogICAgICAgIH0KICAgICAgICBgCiAgICB9CgogICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzdHlsZSIpKS5pbm5lckhUTUwgPSBgCiAgICAgICAgLnNob3J0Y3V0IHsKICAgICAgICAgICAgbWFyZ2luLWxlZnQ6IDhweDsKICAgICAgICB9CiAgICAgICAgLnZlcnRpY2FsIHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgICAgICAgbWFyZ2luOiBhdXRvOwogICAgICAgICAgICB3aWR0aDogZml0LWNvbnRlbnQ7CiAgICAgICAgfQogICAgICAgICNzZWxlY3QtYWN0aXZlLXBldC1tZW51IHsKICAgICAgICAgICAgcG9zaXRpb246IGZpeGVkOwogICAgICAgICAgICB6LWluZGV4OiAxMDAwMDA7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICM4YThhOGE7CiAgICAgICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgICAgICAgIGxlZnQ6IDUwJTsKICAgICAgICAgICAgdG9wOiA1MCU7CiAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpOwogICAgICAgIH0KICAgICAgICAjc2VsZWN0LWFjdGl2ZS1wZXQtbWVudTo6YmVmb3JlIHsKICAgICAgICAgICAgd2lkdGg6IDEwMHZ3OwogICAgICAgICAgICBoZWlnaHQ6IDEwMHZoOwogICAgICAgICAgICBvcGFjaXR5OiAwLjc7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6IGJsYWNrOwogICAgICAgICAgICB6LWluZGV4OiAtMTsKICAgICAgICAgICAgY29udGVudDogIiI7CiAgICAgICAgICAgIHBvc2l0aW9uOiBmaXhlZDsKICAgICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSk7CiAgICAgICAgICAgIGxlZnQ6IDUwJTsKICAgICAgICAgICAgdG9wOiA1MCU7CiAgICAgICAgfQogICAgICAgIC5hY3RpdmV0YWJsZWhlYWRlciB7CiAgICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgICAgICAgICAgZm9udC1zaXplOiAxNnB0OwogICAgICAgICAgICBjdXJzb3I6IGRlZmF1bHQ7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICR7dGhlbWV9OwogICAgICAgICAgICBjb2xvcjogJHt0ZXh0fTsKICAgICAgICAgICAgcGFkZGluZy10b3A6IDhweDsKICAgICAgICAgICAgcGFkZGluZy1ib3R0b206IDhweDsKICAgICAgICAgICAgLXdlYmtpdC11c2VyLXNlbGVjdDogbm9uZTsKICAgICAgICAgICAgLW1zLXVzZXItc2VsZWN0OiBub25lOwogICAgICAgICAgICB1c2VyLXNlbGVjdDogbm9uZTsKICAgICAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgICAgICAgICBkaXNwbGF5OiBibG9jazsKICAgICAgICAgICAgbWluLXdpZHRoOiAzMDBweDsKICAgICAgICB9CiAgICAgICAgLmFjdGl2ZXRhYmxlID4gYSB7CiAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7CiAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgICAgICAgbGVmdDogNTAlOwogICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTUwJSk7CiAgICAgICAgICAgIHRvcDogMCU7CiAgICAgICAgICAgIHBhZGRpbmc6IDRweDsKICAgICAgICAgICAgY29sb3I6IGJsdWU7CiAgICAgICAgICAgIHRleHQtZGVjb3JhdGlvbjogdW5kZXJsaW5lOwogICAgICAgICAgICBmb250LXNpemU6IDhwdDsKICAgICAgICB9CiAgICAgICAgLmFjdGl2ZXRhYmxlIHsKICAgICAgICAgICAgcGFkZGluZzogMjBweCAyMHB4OwogICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNGRkZGRkY7CiAgICAgICAgICAgIGJvcmRlci1zcGFjaW5nOiA1cHg7CiAgICAgICAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsKICAgICAgICB9CiAgICAgICAgLmFjdGl2ZXRhYmxlIHRkIHsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2U2ZTZlNjsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogOHB4OwogICAgICAgICAgICBwYWRkaW5nLXRvcDogMTBweDsKICAgICAgICAgICAgcGFkZGluZy1ib3R0b206IDVweDsKICAgICAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgICAgIH0KICAgICAgICAuYWN0aXZldGFibGUgdGQgaW1nIHsKICAgICAgICAgICAgbWFyZ2luOiAwOwogICAgICAgICAgICBwYWRkaW5nOiAwOwogICAgICAgICAgICB3aWR0aDogMTUwcHggIWltcG9ydGFudDsKICAgICAgICAgICAgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgICAgICAgICAgIC13ZWJraXQtdXNlci1zZWxlY3Q6IG5vbmU7CiAgICAgICAgICAgIC1tcy11c2VyLXNlbGVjdDogbm9uZTsKICAgICAgICAgICAgdXNlci1zZWxlY3Q6IG5vbmU7CiAgICAgICAgfQoKICAgICAgICAuYWN0aXZldGFibGUgdGQ6aG92ZXIgewogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjYzllM2IzOwogICAgICAgIH0KICAgICAgICAuYWN0aXZldGFibGUgdGQ6YWN0aXZlIHsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2EyY2Y3YzsKICAgICAgICB9CiAgICAgICAgLmFjdGl2ZXRhYmxlIHRkOmhvdmVyIGltZyB7CiAgICAgICAgICAgIG9wYWNpdHk6IDAuODU7CiAgICAgICAgfQoKICAgICAgICAuYWN0aXZldGFibGUgdGRbYWN0aXZlXSB7CiAgICAgICAgICAgIGN1cnNvcjogbm90LWFsbG93ZWQ7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICM4ZjhmOGY7CiAgICAgICAgICAgIGNvbG9yOiAjNGE0YTRhOwogICAgICAgIH0KICAgICAgICAuYWN0aXZldGFibGUgdGRbYWN0aXZlXTo6YWZ0ZXIgewogICAgICAgICAgICBvcGFjaXR5OiAwLjY7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTZwdDsKICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgICAgICAgICB3aWR0aDogMTAwJTsKICAgICAgICAgICAgaGVpZ2h0OiAxMDAlOwogICAgICAgICAgICB0b3A6IDA7CiAgICAgICAgICAgIGxlZnQ6IDA7CiAgICAgICAgICAgIGN1cnNvcjogbm90LWFsbG93ZWQ7CiAgICAgICAgICAgIGNvbG9yOiBibGFjazsKICAgICAgICAgICAgY29udGVudDogIihhbHJlYWR5IGFjdGl2ZSkiOwogICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICB0cmFuc2Zvcm06IHJvdGF0ZSgyNWRlZykKICAgICAgICB9CiAgICAgICAgLmFjdGl2ZXRhYmxlIHRkW2FjdGl2ZV0gaW1nIHsKICAgICAgICAgICAgb3BhY2l0eTogMC4zOwogICAgICAgIH0KCiAgICAgICAgLmxldmVsZGlzcGxheSB7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgICAgICAgICAgd2lkdGg6IDQwcHg7CiAgICAgICAgICAgIGhlaWdodDogNDBweDsKICAgICAgICAgICAgYm9yZGVyOiAzcHggc29saWQgI2M0YzRjNDsKICAgICAgICAgICAgZm9udC1zaXplOiA4cHQ7CiAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6IHJnYmEoMjU1LDI1NSwyNTUsMC45NSk7CiAgICAgICAgICAgIHJpZ2h0OiA1NXB4OwogICAgICAgICAgICB0b3A6IDExOHB4OwogICAgICAgICAgICB0cmFuc2l0aW9uOiAwLjVzOwogICAgICAgICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgICAgIH0KICAgICAgICAubGV2ZWxkaXNwbGF5OmhvdmVyIHsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2Q5ZDlkOTsKICAgICAgICB9CiAgICAgICAgLmxldmVsZGlzcGxheSA+IGRpdiB7CiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICB0cmFuc2l0aW9uOiAwLjJzOwogICAgICAgICAgICB2aXNpYmlsaXR5OiBoaWRkZW47CiAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgICAgICAgd2lkdGg6IDEyMHB4OwogICAgICAgICAgICBoZWlnaHQ6IDQwcHg7CiAgICAgICAgICAgIG9wYWNpdHk6IDA7CiAgICAgICAgICAgIHRvcDogLTRweDsKICAgICAgICAgICAgbGVmdDogLTRweDsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgICAgICAgICAgei1pbmRleDogMTAwMDAwOwogICAgICAgIH0KICAgICAgICAubGV2ZWxkaXNwbGF5OmhvdmVyID4gZGl2IHsKICAgICAgICAgICAgdHJhbnNpdGlvbi1kZWxheTowLjVzOwogICAgICAgICAgICBvcGFjaXR5OiAxOwogICAgICAgICAgICB2aXNpYmlsaXR5OiB2aXNpYmxlOwogICAgICAgIH0KICAgICAgICAudGltZWRpc3BsYXkgewogICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgICAgICAgIHRvcDogMTE4cHg7CiAgICAgICAgICAgIHJpZ2h0OiAxM3B4OwogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgICAgICAgICAgd2lkdGg6IDMycHg7CiAgICAgICAgICAgIGhlaWdodDogMzJweDsKICAgICAgICAgICAgb3BhY2l0eTogMC45NTsKICAgICAgICB9CiAgICBgCgogICAgLy9yYWRpYWwgcHJvZ3Jlc3MgYmFyIHRha2VuIGZyb20gaHR0cHM6Ly9kZXYudG8vc2h1YmhhbXRpd2FyaTkwOS9jaXJjdWxhci1wcm9ncmVzcy1iYXItY3NzLTFiaTkKICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3R5bGUiKSkuaW5uZXJIVE1MID0gYAogICAgICAgIDpyb290IHsKICAgICAgICAgIC0tcHJvZ3Jlc3MtYmFyLXdpZHRoOiA0MHB4OwogICAgICAgICAgLS1wcm9ncmVzcy1iYXItaGVpZ2h0OiA0MHB4OwogICAgICAgIH0KICAgICAgICAuY2lyY3VsYXItcHJvZ3Jlc3MgewogICAgICAgICAgICB3aWR0aDogdmFyKC0tcHJvZ3Jlc3MtYmFyLXdpZHRoKTsKICAgICAgICAgICAgaGVpZ2h0OiB2YXIoLS1wcm9ncmVzcy1iYXItaGVpZ2h0KTsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICB9CiAgICAgICAgLmlubmVyLWNpcmNsZSB7CiAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgICAgICAgd2lkdGg6IDM0cHg7CiAgICAgICAgICAgIGhlaWdodDogMzRweDsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDI1NSwyNTUsMjU1LDAuOTUpOwogICAgICAgIH0KCiAgICAgICAgLnBlcmNlbnRhZ2UgewogICAgICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogOHB0ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgIGNvbG9yOiBibGFjazsKICAgICAgICB9CiAgICBgCgogICAgLy9kb3Qgc3BpbiBhbmltYXRpb24gdGFrZW4gZnJvbSBodHRwczovL2NvZGVwZW4uaW8vbnpiaW4vcGVuL0dHclhicAogICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzdHlsZSIpKS5pbm5lckhUTUwgPSBgCiAgICAuZG90LXNwaW46OmJlZm9yZSB7CiAgICAgICAgcG9zaXRpb246IGFic29sdXRlOwogICAgICAgIHdpZHRoOiA2MHB4OwogICAgICAgIGhlaWdodDogNjBweDsKICAgICAgICBsZWZ0OiA1MCU7CiAgICAgICAgdG9wOiA1MCU7CiAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7CiAgICAgICAgb3BhY2l0eTogMC41OwogICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpIHRyYW5zbGF0ZVooLTFweCk7CiAgICAgICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgICAgIGNvbnRlbnQ6ICIiOwogICAgICAgIGRpc3BsYXk6IGJsb2NrOwogICAgICAgIHotaW5kZXg6IC0xOwoKICAgIH0KICAgIC5kb3Qtc3BpbiB7CiAgICAgICAgdHJhbnNmb3JtLXN0eWxlOiBwcmVzZXJ2ZS0zZDsKICAgICAgICBtYXJnaW46IGF1dG87CiAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgICAgIHdpZHRoOiAxMHB4ICFpbXBvcnRhbnQ7CiAgICAgICAgaGVpZ2h0OiAxMHB4ICFpbXBvcnRhbnQ7CiAgICAgICAgYm9yZGVyLXJhZGl1czogNXB4OwogICAgICAgIGJhY2tncm91bmQtY29sb3I6IHRyYW5zcGFyZW50OwogICAgICAgIGNvbG9yOiB0cmFuc3BhcmVudDsKICAgICAgICBib3gtc2hhZG93OiAwIC0xOHB4IDAgMCAjOTg4MGZmLCAxMi43Mjc5MjZweCAtMTIuNzI3OTI2cHggMCAwICM5ODgwZmYsIDE4cHggMCAwIDAgIzk4ODBmZiwgMTIuNzI3OTI2cHggMTIuNzI3OTI2cHggMCAwIHJnYmEoMTUyLCAxMjgsIDI1NSwgMCksIDAgMThweCAwIDAgcmdiYSgxNTIsIDEyOCwgMjU1LCAwKSwgLTEyLjcyNzkyNnB4IDEyLjcyNzkyNnB4IDAgMCByZ2JhKDE1MiwgMTI4LCAyNTUsIDApLCAtMThweCAwIDAgMCByZ2JhKDE1MiwgMTI4LCAyNTUsIDApLCAtMTIuNzI3OTI2cHggLTEyLjcyNzkyNnB4IDAgMCByZ2JhKDE1MiwgMTI4LCAyNTUsIDApOwogICAgICAgIGFuaW1hdGlvbjogZG90LXNwaW4gMS41cyBpbmZpbml0ZSBsaW5lYXI7CiAgICB9CgogICAgQGtleWZyYW1lcyBkb3Qtc3BpbiB7CiAgICAgICAgMCUsIDEwMCUgewogICAgICAgICAgICBib3gtc2hhZG93OiAwIC0xOHB4IDAgMCAjOTg4MGZmLCAxMi43Mjc5MjZweCAtMTIuNzI3OTI2cHggMCAwICM5ODgwZmYsIDE4cHggMCAwIDAgIzk4ODBmZiwgMTIuNzI3OTI2cHggMTIuNzI3OTI2cHggMCAtNXB4IHJnYmEoMTUyLCAxMjgsIDI1NSwgMCksIDAgMThweCAwIC01cHggcmdiYSgxNTIsIDEyOCwgMjU1LCAwKSwgLTEyLjcyNzkyNnB4IDEyLjcyNzkyNnB4IDAgLTVweCByZ2JhKDE1MiwgMTI4LCAyNTUsIDApLCAtMThweCAwIDAgLTVweCByZ2JhKDE1MiwgMTI4LCAyNTUsIDApLCAtMTIuNzI3OTI2cHggLTEyLjcyNzkyNnB4IDAgLTVweCByZ2JhKDE1MiwgMTI4LCAyNTUsIDApOwogICAgICAgIH0KICAgICAgICAxMi41JSB7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgLTE4cHggMCAtNXB4IHJnYmEoMTUyLCAxMjgsIDI1NSwgMCksIDEyLjcyNzkyNnB4IC0xMi43Mjc5MjZweCAwIDAgIzk4ODBmZiwgMThweCAwIDAgMCAjOTg4MGZmLCAxMi43Mjc5MjZweCAxMi43Mjc5MjZweCAwIDAgIzk4ODBmZiwgMCAxOHB4IDAgLTVweCByZ2JhKDE1MiwgMTI4LCAyNTUsIDApLCAtMTIuNzI3OTI2cHggMTIuNzI3OTI2cHggMCAtNXB4IHJnYmEoMTUyLCAxMjgsIDI1NSwgMCksIC0xOHB4IDAgMCAtNXB4IHJnYmEoMTUyLCAxMjgsIDI1NSwgMCksIC0xMi43Mjc5MjZweCAtMTIuNzI3OTI2cHggMCAtNXB4IHJnYmEoMTUyLCAxMjgsIDI1NSwgMCk7CiAgICAgICAgfQogICAgICAgIDI1JSB7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgLTE4cHggMCAtNXB4IHJnYmEoMTUyLCAxMjgsIDI1NSwgMCksIDEyLjcyNzkyNnB4IC0xMi43Mjc5MjZweCAwIC01cHggcmdiYSgxNTIsIDEyOCwgMjU1LCAwKSwgMThweCAwIDAgMCAjOTg4MGZmLCAxMi43Mjc5MjZweCAxMi43Mjc5MjZweCAwIDAgIzk4ODBmZiwgMCAxOHB4IDAgMCAjOTg4MGZmLCAtMTIuNzI3OTI2cHggMTIuNzI3OTI2cHggMCAtNXB4IHJnYmEoMTUyLCAxMjgsIDI1NSwgMCksIC0xOHB4IDAgMCAtNXB4IHJnYmEoMTUyLCAxMjgsIDI1NSwgMCksIC0xMi43Mjc5MjZweCAtMTIuNzI3OTI2cHggMCAtNXB4IHJnYmEoMTUyLCAxMjgsIDI1NSwgMCk7CiAgICAgICAgfQogICAgICAgIDM3LjUlIHsKICAgICAgICAgICAgYm94LXNoYWRvdzogMCAtMThweCAwIC01cHggcmdiYSgxNTIsIDEyOCwgMjU1LCAwKSwgMTIuNzI3OTI2cHggLTEyLjcyNzkyNnB4IDAgLTVweCByZ2JhKDE1MiwgMTI4LCAyNTUsIDApLCAxOHB4IDAgMCAtNXB4IHJnYmEoMTUyLCAxMjgsIDI1NSwgMCksIDEyLjcyNzkyNnB4IDEyLjcyNzkyNnB4IDAgMCAjOTg4MGZmLCAwIDE4cHggMCAwICM5ODgwZmYsIC0xMi43Mjc5MjZweCAxMi43Mjc5MjZweCAwIDAgIzk4ODBmZiwgLTE4cHggMCAwIC01cHggcmdiYSgxNTIsIDEyOCwgMjU1LCAwKSwgLTEyLjcyNzkyNnB4IC0xMi43Mjc5MjZweCAwIC01cHggcmdiYSgxNTIsIDEyOCwgMjU1LCAwKTsKICAgICAgICB9CiAgICAgICAgNTAlIHsKICAgICAgICAgICAgYm94LXNoYWRvdzogMCAtMThweCAwIC01cHggcmdiYSgxNTIsIDEyOCwgMjU1LCAwKSwgMTIuNzI3OTI2cHggLTEyLjcyNzkyNnB4IDAgLTVweCByZ2JhKDE1MiwgMTI4LCAyNTUsIDApLCAxOHB4IDAgMCAtNXB4IHJnYmEoMTUyLCAxMjgsIDI1NSwgMCksIDEyLjcyNzkyNnB4IDEyLjcyNzkyNnB4IDAgLTVweCByZ2JhKDE1MiwgMTI4LCAyNTUsIDApLCAwIDE4cHggMCAwICM5ODgwZmYsIC0xMi43Mjc5MjZweCAxMi43Mjc5MjZweCAwIDAgIzk4ODBmZiwgLTE4cHggMCAwIDAgIzk4ODBmZiwgLTEyLjcyNzkyNnB4IC0xMi43Mjc5MjZweCAwIC01cHggcmdiYSgxNTIsIDEyOCwgMjU1LCAwKTsKICAgICAgICB9CiAgICAgICAgNjIuNSUgewogICAgICAgICAgICBib3gtc2hhZG93OiAwIC0xOHB4IDAgLTVweCByZ2JhKDE1MiwgMTI4LCAyNTUsIDApLCAxMi43Mjc5MjZweCAtMTIuNzI3OTI2cHggMCAtNXB4IHJnYmEoMTUyLCAxMjgsIDI1NSwgMCksIDE4cHggMCAwIC01cHggcmdiYSgxNTIsIDEyOCwgMjU1LCAwKSwgMTIuNzI3OTI2cHggMTIuNzI3OTI2cHggMCAtNXB4IHJnYmEoMTUyLCAxMjgsIDI1NSwgMCksIDAgMThweCAwIC01cHggcmdiYSgxNTIsIDEyOCwgMjU1LCAwKSwgLTEyLjcyNzkyNnB4IDEyLjcyNzkyNnB4IDAgMCAjOTg4MGZmLCAtMThweCAwIDAgMCAjOTg4MGZmLCAtMTIuNzI3OTI2cHggLTEyLjcyNzkyNnB4IDAgMCAjOTg4MGZmOwogICAgICAgIH0KICAgICAgICA3NSUgewogICAgICAgICAgICBib3gtc2hhZG93OiAwIC0xOHB4IDAgMCAjOTg4MGZmLCAxMi43Mjc5MjZweCAtMTIuNzI3OTI2cHggMCAtNXB4IHJnYmEoMTUyLCAxMjgsIDI1NSwgMCksIDE4cHggMCAwIC01cHggcmdiYSgxNTIsIDEyOCwgMjU1LCAwKSwgMTIuNzI3OTI2cHggMTIuNzI3OTI2cHggMCAtNXB4IHJnYmEoMTUyLCAxMjgsIDI1NSwgMCksIDAgMThweCAwIC01cHggcmdiYSgxNTIsIDEyOCwgMjU1LCAwKSwgLTEyLjcyNzkyNnB4IDEyLjcyNzkyNnB4IDAgLTVweCByZ2JhKDE1MiwgMTI4LCAyNTUsIDApLCAtMThweCAwIDAgMCAjOTg4MGZmLCAtMTIuNzI3OTI2cHggLTEyLjcyNzkyNnB4IDAgMCAjOTg4MGZmOwogICAgICAgIH0KICAgICAgICA4Ny41JSB7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgLTE4cHggMCAwICM5ODgwZmYsIDEyLjcyNzkyNnB4IC0xMi43Mjc5MjZweCAwIDAgIzk4ODBmZiwgMThweCAwIDAgLTVweCByZ2JhKDE1MiwgMTI4LCAyNTUsIDApLCAxMi43Mjc5MjZweCAxMi43Mjc5MjZweCAwIC01cHggcmdiYSgxNTIsIDEyOCwgMjU1LCAwKSwgMCAxOHB4IDAgLTVweCByZ2JhKDE1MiwgMTI4LCAyNTUsIDApLCAtMTIuNzI3OTI2cHggMTIuNzI3OTI2cHggMCAtNXB4IHJnYmEoMTUyLCAxMjgsIDI1NSwgMCksIC0xOHB4IDAgMCAtNXB4IHJnYmEoMTUyLCAxMjgsIDI1NSwgMCksIC0xMi43Mjc5MjZweCAtMTIuNzI3OTI2cHggMCAwICM5ODgwZmY7CiAgICAgICAgfQogICAgfQogICAgYAp9CgpmdW5jdGlvbiBjcmVhdGVTaG9ydGN1dEljb24obGluaywgaWNvblVybCwgY3NzQ2xhc3NlcykgewogICAgdmFyIGh0bWxGb3JJY29uID0gIjxkaXYgc3R5bGU9XCJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XCI+PGltZyBzdHlsZT1cImhlaWdodDogMzBweDsgd2lkdGg6IDMwcHg7XCIgY2xhc3M9XCIiICsgY3NzQ2xhc3NlcyArICJcIiBzcmM9XCIiICsgaWNvblVybCArICJcIi8+PC9kaXY+IgoKICAgIHZhciBhZGRlZEljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJykKICAgIGFkZGVkSWNvbi5ocmVmID0gbGluawogICAgYWRkZWRJY29uLmlubmVySFRNTCA9IGh0bWxGb3JJY29uCgogICAgcmV0dXJuIGFkZGVkSWNvbgp9"},{"name":"Neopets Stock Highlighter","options":{"check_for_updates":true,"user_modified":null,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_powerful_this":null,"sandbox":null,"noframes":null,"unwrap":null,"run_at":null,"tab_types":null,"override":{"use_includes":[],"orig_includes":[],"merge_includes":true,"use_matches":[],"orig_matches":["https://www.neopets.com/stockmarket.phtml?type=portfolio","http://www.neopets.com/stockmarket.phtml?type=portfolio"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"orig_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null,"orig_run_in":[]},"run_in":null,"tags":[]},"storage":{"ts":1698065416056,"data":{}},"enabled":true,"position":7,"file_url":"https://github.com/Meerca/Neopets-Userscripts/raw/main/stock-highlighter.user.js","uuid":"93cd3643-d2d0-4fb8-807a-9d05d4491d1a","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBOZW9wZXRzIFN0b2NrIEhpZ2hsaWdodGVyCi8vIEBhdXRob3IgICAgICAgSGlkZGVuaXN0Ci8vIEBuYW1lc3BhY2UgICAgaHR0cHM6Ly9oaWRkZW5pc3QuY29tCi8vIEB2ZXJzaW9uICAgICAgMjAyNC0wNy0yMC1wYXRjaDEKLy8gQGRlc2NyaXB0aW9uICBIaWdobGlnaHRzIE5lb3BldHMgc3RvY2tzIHdoaWNoIGFyZSBoaWdoIGVub3VnaCB0byBzZWxsLiBBbHNvIHNvcnRzIHRoZSBsaXN0IG9mIHN0b2NrcywgYW5kIG1ha2VzIHRoZSBVSSBhIGxpdHRsZSBuaWNlci4gTm93IHdpdGggY29uZmlndXJhYmxlIHNldHRpbmdzIQovLyBAbWF0Y2ggICAgICAgIGh0dHBzOi8vd3d3Lm5lb3BldHMuY29tL3N0b2NrbWFya2V0LnBodG1sP3R5cGU9cG9ydGZvbGlvCi8vIEBtYXRjaCAgICAgICAgaHR0cDovL3d3dy5uZW9wZXRzLmNvbS9zdG9ja21hcmtldC5waHRtbD90eXBlPXBvcnRmb2xpbwovLyBAZ3JhbnQgICAgICAgIEdNX2dldFZhbHVlCi8vIEBncmFudCAgICAgICAgR01fc2V0VmFsdWUKLy8gQHVwZGF0ZVVSTCAgICBodHRwczovL2dpdGh1Yi5jb20vTWVlcmNhL05lb3BldHMtVXNlcnNjcmlwdHMvcmF3L21haW4vc3RvY2staGlnaGxpZ2h0ZXIudXNlci5qcwovLyBAZG93bmxvYWRVUkwgIGh0dHBzOi8vZ2l0aHViLmNvbS9NZWVyY2EvTmVvcGV0cy1Vc2Vyc2NyaXB0cy9yYXcvbWFpbi9zdG9jay1oaWdobGlnaHRlci51c2VyLmpzCi8vIEBzdXBwb3J0VVJMICAgaHR0cHM6Ly9naXRodWIuY29tL01lZXJjYS9OZW9wZXRzLVVzZXJzY3JpcHRzL2lzc3VlcwovLyA9PS9Vc2VyU2NyaXB0PT0KCihmdW5jdGlvbigpIHsKICAgICd1c2Ugc3RyaWN0JzsKCiAgICAvLyBTZXR0aW5ncwogICAgdmFyIHNldHRpbmdzID0gewogICAgICAgIGhpZ2hsaWdodFJvd3M6IEdNX2dldFZhbHVlKCdoaWdobGlnaHRSb3dzJywgdHJ1ZSksCiAgICAgICAgc29ydFJvd3M6IEdNX2dldFZhbHVlKCdzb3J0Um93cycsIHRydWUpLAogICAgICAgIG1vdmVTZWxsQnV0dG9uOiBHTV9nZXRWYWx1ZSgnbW92ZVNlbGxCdXR0b24nLCB0cnVlKSwKICAgICAgICBzdHlsZVR3ZWFrczogR01fZ2V0VmFsdWUoJ3N0eWxlVHdlYWtzJywgdHJ1ZSksCgogICAgICAgIGhpZ2hsaWdodHM6IHsKICAgICAgICAgICAgc2VsbGFibGU6IHsKICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogR01fZ2V0VmFsdWUoJ2hpZ2hsaWdodHMuc2VsbGFibGUuYmFja2dyb3VuZENvbG9yJykgfHwgJyNhZmEnLAogICAgICAgICAgICAgICAgY29sb3I6IEdNX2dldFZhbHVlKCdoaWdobGlnaHRzLnNlbGxhYmxlLmNvbG9yJykgfHwgJycsCiAgICAgICAgICAgICAgICBwZXJjZW50YWdlOiBHTV9nZXRWYWx1ZSgnaGlnaGxpZ2h0cy5zZWxsYWJsZS5wZXJjZW50YWdlJykgfHwgNDAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGdyb3dpbmc6IHsKICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogR01fZ2V0VmFsdWUoJ2hpZ2hsaWdodHMuZ3Jvd2luZy5iYWNrZ3JvdW5kQ29sb3InKSB8fCAnI2ZmYScsCiAgICAgICAgICAgICAgICBjb2xvcjogR01fZ2V0VmFsdWUoJ2hpZ2hsaWdodHMuZ3Jvd2luZy5jb2xvcicpIHx8ICcnLAogICAgICAgICAgICAgICAgcGVyY2VudGFnZTogR01fZ2V0VmFsdWUoJ2hpZ2hsaWdodHMuZ3Jvd2luZy5wZXJjZW50YWdlJykgfHwgMjAwCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGJhbmtydXB0OiB7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IEdNX2dldFZhbHVlKCdoaWdobGlnaHRzLmJhbmtydXB0LmJhY2tncm91bmRDb2xvcicpIHx8ICcjMzMzJywKICAgICAgICAgICAgICAgIGNvbG9yOiBHTV9nZXRWYWx1ZSgnaGlnaGxpZ2h0cy5iYW5rcnVwdC5jb2xvcicpIHx8ICcjY2NjJywKICAgICAgICAgICAgICAgIHBlcmNlbnRhZ2U6IC0xMDAKICAgICAgICAgICAgfSwKICAgICAgICAgICAgbG9zczogewogICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBHTV9nZXRWYWx1ZSgnaGlnaGxpZ2h0cy5sb3NzLmJhY2tncm91bmRDb2xvcicpIHx8ICcjZmNjJywKICAgICAgICAgICAgICAgIGNvbG9yOiBHTV9nZXRWYWx1ZSgnaGlnaGxpZ2h0cy5sb3NzLmNvbG9yJykgfHwgJycKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZGVmYXVsdDogewogICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBHTV9nZXRWYWx1ZSgnaGlnaGxpZ2h0cy5kZWZhdWx0LmJhY2tncm91bmRDb2xvcicpIHx8ICd3aGl0ZScsCiAgICAgICAgICAgICAgICBjb2xvcjogR01fZ2V0VmFsdWUoJ2hpZ2hsaWdodHMuZGVmYXVsdC5jb2xvcicpIHx8ICdibGFjaycKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIGhlYWRlclJvd3M6IDIsCiAgICAgICAgcm93R3JvdXBTaXplOiAyLAoKICAgICAgICAvLyBEZWZpbmVzIGNvbmZpZ3VyYWJsZSBzZXR0aW5ncwogICAgICAgIGZvcm06IHsKICAgICAgICAgICAgYm9vbGVhbjogewogICAgICAgICAgICAgICAgaGlnaGxpZ2h0Um93czogJ0hpZ2hsaWdodCBSb3dzJywKICAgICAgICAgICAgICAgIHNvcnRSb3dzOiAnU29ydCBSb3dzJywKICAgICAgICAgICAgICAgIG1vdmVTZWxsQnV0dG9uOiAnTW92ZSBTZWxsIEJ1dHRvbiB0byBUb3AnLAogICAgICAgICAgICAgICAgc3R5bGVUd2Vha3M6ICdDbGVhbiBVcCBUYWJsZSBTdHlsZXMnLAogICAgICAgICAgICB9LAogICAgICAgICAgICBoaWdobGlnaHQ6IHsKICAgICAgICAgICAgICAgIHNlbGxhYmxlOiAnU2VsbCBwb2ludCcsCiAgICAgICAgICAgICAgICBncm93aW5nOiAnR3Jvd2luZyBzdG9ja3MnLAoKICAgICAgICAgICAgICAgIGJhbmtydXB0OiB7CiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdCYW5rcnVwdCBzdG9ja3MgKC0xMDAlKScsCiAgICAgICAgICAgICAgICAgICAgcGVyY2VudGFnZTogZmFsc2UKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBsb3NzOiB7CiAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICdQcm9maXQgbG9zcyAoPCAwJSknLAogICAgICAgICAgICAgICAgICAgIHBlcmNlbnRhZ2U6IGZhbHNlCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGVmYXVsdDogewogICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnRGVmYXVsdCBjb2xvcnMnLAogICAgICAgICAgICAgICAgICAgIHBlcmNlbnRhZ2U6IGZhbHNlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgfQogICAgfTsKCiAgICBmdW5jdGlvbiBtYWluKCkgewogICAgICAgIGFkZFNldHRpbmdzRm9ybSgpOwogICAgICAgIG1vZGlmeVRhYmxlKCk7CiAgICB9CgogICAgZnVuY3Rpb24gYWRkU2V0dGluZ3NGb3JtKCkgewogICAgICAgIGNvbnN0IGNvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjY29udGVudCB0ZC5jb250ZW50Iik7CgogICAgICAgIHZhciBzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgcy5zZXRBdHRyaWJ1dGUoJ2lkJywgJ3N0b2NrSGlnaGxpZ2h0X1NldHRpbmdzJyk7CgogICAgICAgIGNvbnRlbnQuYXBwZW5kQ2hpbGQocyk7CgogICAgICAgIHZhciB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIHRpdGxlLmlubmVySFRNTCA9ICdTdG9jayBIaWdobGlnaHRlciBTZXR0aW5ncyc7CiAgICAgICAgdGl0bGUuc3R5bGUuZm9udFdlaWdodCA9ICdib2xkJzsKICAgICAgICB0aXRsZS5zdHlsZS5mb250U2l6ZSA9ICIxMTAlIjsKCiAgICAgICAgcy5hcHBlbmRDaGlsZCh0aXRsZSk7CgogICAgICAgIHZhciB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZW0nKTsKICAgICAgICB0LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCdSZWZyZXNoIHRoZSBwYWdlIHRvIHNlZSBzZXR0aW5ncyBjaGFuZ2VzLicpKTsKICAgICAgICBzLmFwcGVuZENoaWxkKHQpOwoKICAgICAgICBmb3IgKHZhciBrZXkgaW4gc2V0dGluZ3MuZm9ybS5ib29sZWFuKSB7CiAgICAgICAgICAgIHZhciBib29sID0gY3JlYXRlU2V0dGluZ0NoZWNrYm94KGtleSwgc2V0dGluZ3MuZm9ybS5ib29sZWFuW2tleV0pOwogICAgICAgICAgICB2YXIgd3JhcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgICAgICB3cmFwLnN0eWxlLnBhZGRpbmcgPSAnMTBweCc7CiAgICAgICAgICAgIHdyYXAuYXBwZW5kQ2hpbGQoYm9vbCk7CiAgICAgICAgICAgIHMuYXBwZW5kQ2hpbGQod3JhcCk7CiAgICAgICAgfQoKICAgICAgICBzLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2hyJykpOwoKICAgICAgICBmb3IgKHZhciBja2V5IGluIHNldHRpbmdzLmZvcm0uaGlnaGxpZ2h0KSB7CiAgICAgICAgICAgIHZhciBzZXQgPSBjcmVhdGVDb2xvclNldHRpbmcoY2tleSwgc2V0dGluZ3MuZm9ybS5oaWdobGlnaHRbY2tleV0pOwogICAgICAgICAgICBhZGRTZXR0aW5nKHMsIHNldCk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGFkZFNldHRpbmcoZm9ybSwgaXRlbSkgewogICAgICAgIHZhciB3cmFwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgd3JhcC5zdHlsZS5tYXJnaW4gPSAnMTVweCAwJzsKICAgICAgICB3cmFwLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lLWJsb2NrJzsKICAgICAgICB3cmFwLnN0eWxlLm1heFdpZHRoID0gJzI1JSc7CiAgICAgICAgd3JhcC5zdHlsZS52ZXJ0aWNhbEFsaWduID0gJ3RvcCc7CiAgICAgICAgd3JhcC5zdHlsZS5wYWRkaW5nID0gJzEwcHgnOwogICAgICAgIHdyYXAuYXBwZW5kQ2hpbGQoaXRlbSk7CiAgICAgICAgZm9ybS5hcHBlbmRDaGlsZCh3cmFwKTsKICAgICAgICByZXR1cm4gd3JhcDsKICAgIH0KCiAgICAvLyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vYS82Mzk0MTY4LzEyMzIxMjMKICAgIC8vIEFsbG93cyBkb3QgYWNjZXNzIHRvIGdldCBuZXN0ZWQgb2JqZWN0IHBhcmFtZXRlcnMKICAgIGZ1bmN0aW9uIGluZGV4KG9iaiwgaXMsIHZhbHVlKSB7CiAgICAgICAgaWYgKHR5cGVvZiBpcyA9PSAnc3RyaW5nJykgewogICAgICAgICAgICByZXR1cm4gaW5kZXgob2JqLCBpcy5zcGxpdCgnLicpLCB2YWx1ZSk7CiAgICAgICAgfSBlbHNlIGlmIChpcy5sZW5ndGggPT0gMSAmJiB0eXBlb2YgdmFsdWUgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgIG9ialtpc1swXV0gPSB2YWx1ZQogICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgfSBlbHNlIGlmIChpcy5sZW5ndGggPT0gMCB8fCB0eXBlb2YgaXMgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgIHJldHVybiBvYmo7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGluZGV4KG9ialtpc1swXV0sIGlzLnNsaWNlKDEpLCB2YWx1ZSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGdldFNldHRpbmcoa2V5KSB7CiAgICAgICAgcmV0dXJuIGluZGV4KHNldHRpbmdzLCBrZXkpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNldFNldHRpbmcoa2V5LCB2YWx1ZSkgewogICAgICAgIEdNX3NldFZhbHVlKGtleSwgdmFsdWUpOwogICAgICAgIHJldHVybiBpbmRleChzZXR0aW5ncywga2V5LCB2YWx1ZSk7CiAgICB9CgogICAgZnVuY3Rpb24gY3JlYXRlQ29sb3JTZXR0aW5nKGdyb3VwLCB2YWwpIHsKICAgICAgICBpZiAodHlwZW9mIHZhbCA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgdmFsID0gewogICAgICAgICAgICAgICAgbGFiZWw6IHZhbCwKICAgICAgICAgICAgICAgIHBlcmNlbnRhZ2U6IHRydWUKICAgICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICB2YXIgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICB0aXRsZS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh2YWwubGFiZWwpKTsKICAgICAgICB0aXRsZS5zdHlsZS5mb250V2VpZ2h0ID0gJ2JvbGQnOwoKICAgICAgICBkaXYuYXBwZW5kQ2hpbGQodGl0bGUpOwoKICAgICAgICBpZiAodmFsLnBlcmNlbnRhZ2UpIHsKICAgICAgICAgICAgdmFyIHBlcmNlbnRhZ2UgPSBjcmVhdGVDb2xvcklucHV0KGdyb3VwLCAncGVyY2VudGFnZScsICdQZXJjZW50JywgJ251bWJlcicpOwogICAgICAgICAgICBkaXYuYXBwZW5kQ2hpbGQocGVyY2VudGFnZSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgY29sb3IgPSBjcmVhdGVDb2xvcklucHV0KGdyb3VwLCAnY29sb3InLCAnVGV4dCBDb2xvcicpOwogICAgICAgIHZhciBiZyA9IGNyZWF0ZUNvbG9ySW5wdXQoZ3JvdXAsICdiYWNrZ3JvdW5kQ29sb3InLCAnSGlnaGxpZ2h0IENvbG9yJyk7CiAgICAgICAgZGl2LmFwcGVuZENoaWxkKGNvbG9yKTsKICAgICAgICBkaXYuYXBwZW5kQ2hpbGQoYmcpOwoKICAgICAgICByZXR1cm4gZGl2OwogICAgfQoKICAgIGZ1bmN0aW9uIGNyZWF0ZUNvbG9ySW5wdXQoZ3JvdXAsIGtleSwgbGFiZWwsIHR5cGUpIHsKICAgICAgICB2YXIgY29sb3JMYmwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpOwogICAgICAgIHZhciBjb2xvciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7CiAgICAgICAgY29sb3Iuc2V0QXR0cmlidXRlKCd0eXBlJywgdHlwZSB8fCAndGV4dCcpOwogICAgICAgIHZhciBjb2xvcktleSA9IGNvbG9yLnNldHRpbmdzS2V5ID0gJ2hpZ2hsaWdodHMuJyArIGdyb3VwICsgJy4nICsga2V5OwogICAgICAgIHZhciBjb2xvclNldCA9IGdldFNldHRpbmcoY29sb3JLZXkpOwoKICAgICAgICBpZiAoY29sb3JTZXQpIHsKICAgICAgICAgICAgY29sb3IudmFsdWUgPSBjb2xvclNldDsKICAgICAgICB9CgogICAgICAgIGNvbG9yTGJsLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGxhYmVsKSk7CiAgICAgICAgY29sb3JMYmwuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnInKSk7CiAgICAgICAgY29sb3JMYmwuYXBwZW5kQ2hpbGQoY29sb3IpOwogICAgICAgIGNvbG9yTGJsLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOwoKICAgICAgICB2YXIgdXBkYXRlID0gZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgdmFyIGNvbG9yID0gZXZlbnQudGFyZ2V0OwogICAgICAgICAgICBzZXRTZXR0aW5nKGNvbG9yLnNldHRpbmdzS2V5LCBjb2xvci52YWx1ZSk7CiAgICAgICAgfTsKCiAgICAgICAgY29sb3IuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgdXBkYXRlKTsKICAgICAgICBjb2xvci5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIHVwZGF0ZSk7CgogICAgICAgIHJldHVybiBjb2xvckxibDsKICAgIH0KCiAgICBmdW5jdGlvbiBjcmVhdGVTZXR0aW5nQ2hlY2tib3goc2V0dGluZywgdGV4dCkgewogICAgICAgIHZhciBsYmwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpOwoKICAgICAgICB2YXIgY2IgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpOwogICAgICAgIGNiLnNldEF0dHJpYnV0ZSgndHlwZScsICdjaGVja2JveCcpOwoKICAgICAgICBpZiAoZ2V0U2V0dGluZyhzZXR0aW5nKSkgewogICAgICAgICAgICBjYi5jaGVja2VkID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGxibC5hcHBlbmRDaGlsZChjYik7CiAgICAgICAgbGJsLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRleHQpKTsKICAgICAgICBjYi5zZXR0aW5nc0tleSA9IHNldHRpbmc7CgogICAgICAgIGNiLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgICAgIHZhciBjYiA9IGV2ZW50LnRhcmdldDsKICAgICAgICAgICAgc2V0U2V0dGluZyhjYi5zZXR0aW5nc0tleSwgISFjYi5jaGVja2VkKTsKICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIGxibDsKICAgIH0KCiAgICBmdW5jdGlvbiBtb2RpZnlUYWJsZSgpIHsKICAgICAgICBjb25zdCBzdG9ja3NUYWJsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNwb3N0Rm9ybSB0YWJsZSIpOwogICAgICAgIGNvbnN0IHN0b2Nrc1Jvd3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIjcG9zdEZvcm0gPiB0YWJsZSA+IHRib2R5ID4gdHIiKTsKCiAgICAgICAgaWYgKHNldHRpbmdzLnNvcnRSb3dzKSB7CiAgICAgICAgICAgIHNvcnRSb3dzKHN0b2Nrc1Jvd3MpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHNldHRpbmdzLm1vdmVTZWxsQnV0dG9uKSB7CiAgICAgICAgICAgIG1vdmVTZWxsQnV0dG9uKHN0b2Nrc1RhYmxlKTsKICAgICAgICB9CgogICAgICAgIGlmIChzZXR0aW5ncy5zdHlsZVR3ZWFrcykgewogICAgICAgICAgICBjbGVhbnVwVGFibGVTdHlsZXMoc3RvY2tzVGFibGUpOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBzZXRSb3dDb2xvcnMocm93LCBjKSB7CiAgICAgICAgcm93LnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGMuYmFja2dyb3VuZENvbG9yIHx8IHNldHRpbmdzLmhpZ2hsaWdodHMuZGVmYXVsdC5iYWNrZ3JvdW5kQ29sb3I7CiAgICAgICAgcm93LnN0eWxlLmNvbG9yID0gYy5jb2xvciB8fCBzZXR0aW5ncy5oaWdobGlnaHRzLmRlZmF1bHQuY29sb3I7CiAgICB9CgogICAgZnVuY3Rpb24gaGlnaGxpZ2h0KHJvdywgcGVyY2VudCkgewogICAgICAgIHZhciBobCA9IHNldHRpbmdzLmhpZ2hsaWdodHM7CgogICAgICAgIGlmIChwZXJjZW50ID49IGhsLnNlbGxhYmxlLnBlcmNlbnRhZ2UpIHsKICAgICAgICAgICAgc2V0Um93Q29sb3JzKHJvdywgaGwuc2VsbGFibGUpOwogICAgICAgIH0gZWxzZSBpZiAocGVyY2VudCA+PSBobC5ncm93aW5nLnBlcmNlbnRhZ2UpIHsKICAgICAgICAgICAgc2V0Um93Q29sb3JzKHJvdywgaGwuZ3Jvd2luZyk7CiAgICAgICAgfSBlbHNlIGlmIChwZXJjZW50ID09IGhsLmJhbmtydXB0LnBlcmNlbnRhZ2UpIHsKICAgICAgICAgICAgc2V0Um93Q29sb3JzKHJvdywgaGwuYmFua3J1cHQpOwogICAgICAgIH0gZWxzZSBpZiAocGVyY2VudCA8IDApIHsKICAgICAgICAgICAgc2V0Um93Q29sb3JzKHJvdywgaGwubG9zcyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc2V0Um93Q29sb3JzKHJvdywgaGwuZGVmYXVsdCk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGhhc05lb3BldHNQcmVtaXVtKCkgewogICAgICAgIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjc3N3bWVudSIpICE9PSBudWxsOwogICAgfQoKICAgIGZ1bmN0aW9uIHBhcnNlUm93cyhyb3dzLCBza2lwLCBncm91cFNpemUpIHsKICAgICAgICB2YXIgcm93R3JvdXBzID0ge307CiAgICAgICAgdmFyIHBlcmNlbnRhZ2VzID0gW107CgogICAgICAgIC8vIFN0YXJ0aW5nIGF0IHJvdyAzIChmaXJzdCB0d28gcm93cyBhcmUgaGVhZGVyIHJvd3MpLCBhbmQgc2tpcHBpbmcgZXZlcnkgb3RoZXIgcm93ICh0aGUgZmlyc3Qgcm93IGhvbGRzIHRoZSBkYXRhLCB0aGUgcm93IGFmdGVyIGl0IGhhcyB0aGUgZm9ybSB0byBzZWxsIHRoYXQgc3RvY2spCiAgICAgICAgZm9yICh2YXIgaSA9IHNraXA7IGkgPCByb3dzLmxlbmd0aCAtIGdyb3VwU2l6ZTsgaSArPSBncm91cFNpemUpIHsKICAgICAgICAgICAgdmFyIHJvdyA9IHJvd3NbaV07CiAgICAgICAgICAgIHZhciBjZWxscyA9IHJvdy5jZWxsczsKCiAgICAgICAgICAgIGlmIChjZWxscy5sZW5ndGggPCA5KSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGNlbGwgPSBjZWxsc1s4XTsKICAgICAgICAgICAgdmFyIHZhbCA9IHBhcnNlSW50KGNlbGwudGV4dENvbnRlbnQpOwoKICAgICAgICAgICAgaWYgKHNldHRpbmdzLmhpZ2hsaWdodFJvd3MpIHsKICAgICAgICAgICAgICAgIGhpZ2hsaWdodChyb3dzW2ldLCB2YWwpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIXJvd0dyb3Vwc1t2YWxdKSB7CiAgICAgICAgICAgICAgICByb3dHcm91cHNbdmFsXSA9IFtdOwogICAgICAgICAgICAgICAgcGVyY2VudGFnZXMucHVzaCh2YWwpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBNb3ZlIGdyb3VwZWQgcm93cyB0b2dldGhlcgogICAgICAgICAgICB2YXIgZ3JvdXAgPSBbXTsKICAgICAgICAgICAgZm9yICggdmFyIGogPSAwOyBqIDwgZ3JvdXBTaXplOyArK2ogKSB7CiAgICAgICAgICAgICAgICBncm91cC5wdXNoKHJvd3NbaStqXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcm93R3JvdXBzW3ZhbF0ucHVzaChncm91cCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBncm91cHM6IHJvd0dyb3VwcywKICAgICAgICAgICAgcGVyY2VudGFnZXM6IHBlcmNlbnRhZ2VzCiAgICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiBnZXRQaW5FbnRyeVRhYmxlKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGluX2ZpZWxkIik/LnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUKICAgICAgICAgICAgKTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGdldHRpbmcgUElOIHRhYmxlLCB5b3UgbWlnaHQgbm90IGhhdmUgYSBQSU4gY29uZmlndXJlZCBvbiB5b3VyIGFjY291bnQiLCBlKTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQHBhcmFtIHtIVE1MVGFibGVFbGVtZW50fSBzdG9ja3NUYWJsZQogICAgICovCiAgICBmdW5jdGlvbiBtb3ZlU2VsbEJ1dHRvbihzdG9ja3NUYWJsZSkgewogICAgICAgIC8vIFB1dCB0aGUgc2VsbCBhbmQgcGluIGZpZWxkcyBhdCB0aGUgdG9wIG9mIHRoZSB0YWJsZQogICAgICAgIGNvbnN0IHNlbGxJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzaG93X3NlbGwiKTsKICAgICAgICBjb25zdCBwaW5UYWJsZSA9IGdldFBpbkVudHJ5VGFibGUoKTsKCiAgICAgICAgaWYgKHBpblRhYmxlKSB7CiAgICAgICAgICAgIHN0b2Nrc1RhYmxlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKHBpblRhYmxlLCBzdG9ja3NUYWJsZSk7CiAgICAgICAgICAgIHBpblRhYmxlLnN0eWxlLm1hcmdpbkJvdHRvbSA9ICIxNnB4IjsKICAgICAgICAgICAgcGluVGFibGUuc3R5bGUubWFyZ2luVG9wID0gIjE2cHgiOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN0b2Nrc1RhYmxlLnN0eWxlLm1hcmdpblRvcCA9ICIzMnB4IjsKICAgICAgICB9CiAgICAgICAgc3RvY2tzVGFibGUucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoc2VsbElucHV0LCBzdG9ja3NUYWJsZSk7CgogICAgICAgIHNlbGxJbnB1dC5zdHlsZS5tYXJnaW5Ub3AgPSAiMTZweCI7CiAgICAgICAgc2VsbElucHV0LnN0eWxlLm1hcmdpbkJvdHRvbSA9ICIxNnB4IjsKICAgIH0KCiAgICAvKioKICAgICAqIEBwYXJhbSB7SFRNTFRhYmxlRWxlbWVudH0gc3RvY2tzVGFibGUKICAgICAqLwogICAgZnVuY3Rpb24gc29ydFJvd3Moc3RvY2tzUm93cykgewogICAgICAgIGNvbnN0IHsgcGVyY2VudGFnZXMsIGdyb3VwcyB9ID0gcGFyc2VSb3dzKAogICAgICAgICAgICBzdG9ja3NSb3dzLAogICAgICAgICAgICBzZXR0aW5ncy5oZWFkZXJSb3dzLAogICAgICAgICAgICBzZXR0aW5ncy5yb3dHcm91cFNpemUKICAgICAgICApOwogICAgICAgIC8vIFNvcnQgbnVtYmVycyBkZXNjZW5kaW5nCiAgICAgICAgY29uc3Qgc29ydGVkUGVyY2VudGFnZXMgPSBwZXJjZW50YWdlcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgICAgIHJldHVybiBhIC0gYjsKICAgICAgICB9KTsKCiAgICAgICAgLy8gR28gdGhyb3VnaCB0aGUgcGVyY2VudGFnZXMgaW4gZGVzY2VuZGluZyBvcmRlciBhbmQgc29ydCB0aGUgcm93cwogICAgICAgIGZvciAodmFyIGkgaW4gc29ydGVkUGVyY2VudGFnZXMpIHsKICAgICAgICAgICAgY29uc3QgcGVyY2VudGFnZSA9IHNvcnRlZFBlcmNlbnRhZ2VzW2ldOwogICAgICAgICAgICBjb25zdCBnID0gZ3JvdXBzW3BlcmNlbnRhZ2VdOwoKICAgICAgICAgICAgZm9yIChjb25zdCBqIGluIGcpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGdyb3VwID0gZ1tqXTsKCiAgICAgICAgICAgICAgICBmb3IgKHZhciBrID0gZ3JvdXAubGVuZ3RoIC0gMTsgayA+PSAwOyAtLWspIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCByb3cgPSBncm91cFtrXTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwYXJlbnQgPSByb3cucGFyZW50Tm9kZTsKICAgICAgICAgICAgICAgICAgICBwYXJlbnQucmVtb3ZlQ2hpbGQocm93KTsKICAgICAgICAgICAgICAgICAgICBwYXJlbnQucmVwbGFjZUNoaWxkKHJvdywgcGFyZW50Lmluc2VydFJvdygyKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBAcGFyYW0ge0hUTUxUYWJsZUVsZW1lbnR9IHN0b2Nrc1RhYmxlCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNsZWFudXBUYWJsZVN0eWxlcyhzdG9ja3NUYWJsZSkgewogICAgICAgIGNvbnN0IHN0b2Nrc1Jvd3MgPSBzdG9ja3NUYWJsZS5xdWVyeVNlbGVjdG9yQWxsKCJ0Ym9keSB0ciIpOwogICAgICAgIGlmICghaGFzTmVvcGV0c1ByZW1pdW0oKSkgewogICAgICAgICAgICBjb25zdCBjb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI2NvbnRlbnQgdGQuY29udGVudCIpOwogICAgICAgICAgICBjb250ZW50LnF1ZXJ5U2VsZWN0b3IoImRpdiIpLnJlbW92ZSgpOwogICAgICAgICAgICBjb250ZW50LnF1ZXJ5U2VsZWN0b3IoImRpdiIpLnN0eWxlLndpZHRoID0gIjEwMCUiOwogICAgICAgIH0KICAgICAgICBzdG9ja3NUYWJsZS5zZXRBdHRyaWJ1dGUoImJvcmRlciIsICIwIik7CiAgICAgICAgc3RvY2tzVGFibGUuc3R5bGUud2lkdGggPSAiMTAwJSI7CiAgICAgICAgZm9yIChjb25zdCByIGluIHN0b2Nrc1Jvd3MpIHsKICAgICAgICAgICAgZm9yIChjb25zdCBjIGluIHN0b2Nrc1Jvd3Nbcl0uY2VsbHMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNlbGwgPSBzdG9ja3NSb3dzW3JdLmNlbGxzW2NdOwoKICAgICAgICAgICAgICAgIGlmIChjZWxsICYmIGNlbGwuc3R5bGUpIHsKICAgICAgICAgICAgICAgICAgICBjZWxsLnN0eWxlLmJvcmRlckJvdHRvbSA9ICIxcHggc29saWQgcmdiYSgyMCwyMCwyMCwwLjIpIjsKICAgICAgICAgICAgICAgICAgICBjZWxsLnN0eWxlLnBhZGRpbmcgPSAiN3B4IDAiOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIG1haW4oKTsKfSkoKTsK"},{"name":"Neopets: Show Best Bargain Stocks","options":{"check_for_updates":true,"user_modified":null,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_powerful_this":null,"sandbox":null,"noframes":null,"unwrap":null,"run_at":null,"tab_types":null,"override":{"use_includes":[],"orig_includes":[],"merge_includes":true,"use_matches":[],"orig_matches":["http*://www.neopets.com/stockmarket.phtml*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"orig_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null,"orig_run_in":[]},"run_in":null,"tags":[]},"storage":{"ts":1698065420324,"data":{}},"enabled":true,"position":8,"file_url":"https://github.com/Meerca/Neopets-Userscripts/raw/main/bargain-stocks.user.js","uuid":"469f637c-68ff-4443-97af-cc409f7e6f2d","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBOZW9wZXRzOiBTaG93IEJlc3QgQmFyZ2FpbiBTdG9ja3MKLy8gQGF1dGhvciAgICAgICBIaWRkZW5pc3QKLy8gQG5hbWVzcGFjZSAgICBodHRwczovL2hpZGRlbmlzdC5jb20KLy8gQHZlcnNpb24gICAgICAyMDI0LTA3LTI5Ci8vIEBkZXNjcmlwdGlvbiAgU2hvd3MgYSBsaXN0IG9mIHRoZSBiZXN0IHByaWNlZCBzdG9ja3Mgb24gYW55IG9mIHRoZSBzdG9jayBtYXJrZXQgcGFnZXMKLy8gQG1hdGNoICAgICAgICBodHRwKjovL3d3dy5uZW9wZXRzLmNvbS9zdG9ja21hcmtldC5waHRtbCoKLy8gQGdyYW50ICAgICAgICBub25lCi8vIEB1cGRhdGVVUkwgICAgaHR0cHM6Ly9naXRodWIuY29tL01lZXJjYS9OZW9wZXRzLVVzZXJzY3JpcHRzL3Jhdy9tYWluL2JhcmdhaW4tc3RvY2tzLnVzZXIuanMKLy8gQGRvd25sb2FkVVJMICBodHRwczovL2dpdGh1Yi5jb20vTWVlcmNhL05lb3BldHMtVXNlcnNjcmlwdHMvcmF3L21haW4vYmFyZ2Fpbi1zdG9ja3MudXNlci5qcwovLyBAc3VwcG9ydFVSTCAgIGh0dHBzOi8vZ2l0aHViLmNvbS9NZWVyY2EvTmVvcGV0cy1Vc2Vyc2NyaXB0cy9pc3N1ZXMKLy8gPT0vVXNlclNjcmlwdD09CgooZnVuY3Rpb24oKSB7CiAgICAndXNlIHN0cmljdCc7CgogICAgZnVuY3Rpb24gbWFpbigpIHsKICAgICAgICBjdXN0b21FbGVtZW50cy5kZWZpbmUoImJhcmdhaW4tc3RvY2tzLWxpc3QiLCBCYXJnYWluU3RvY2tzTGlzdEVsZW1lbnQpOwogICAgICAgIGNvbnN0IGxpc3QgPSBuZXcgQmFyZ2FpblN0b2Nrc0xpc3RFbGVtZW50KCk7CiAgICAgICAgY29uc3Qgc2libGluZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoInRkLmNvbnRlbnQgPiBkaXY6bm90KFtzdHlsZX49ZmxvYXRdKSA+IGNlbnRlciwgdGQuY29udGVudCA+IGNlbnRlciIpOwoKICAgICAgICBpZiAoIXNpYmxpbmcpIHsKICAgICAgICAgICAgY29uc29sZS53YXJuKCJVbmFibGUgdG8gZmluZCBzb21ld2hlcmUgdG8gcHV0IHRoZSBiYXJnYWluIHN0b2NrcyBsaXN0LiIpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHNpYmxpbmcuYWZ0ZXIobGlzdCk7CiAgICB9CgogICAgY2xhc3MgQmFyZ2FpblN0b2Nrc0xpc3RFbGVtZW50IGV4dGVuZHMgSFRNTEVsZW1lbnQgewogICAgICAgIGNvbnN0cnVjdG9yKCkgewogICAgICAgICAgICBzdXBlcigpOwogICAgICAgIH0KCiAgICAgICAgY29ubmVjdGVkQ2FsbGJhY2soKSB7CiAgICAgICAgICAgIGNvbnN0IHNoYWRvdyA9IHRoaXMuYXR0YWNoU2hhZG93KHsgbW9kZTogImNsb3NlZCIgfSk7CgogICAgICAgICAgICB0aGlzLm1lc3NhZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJwIik7CiAgICAgICAgICAgIHRoaXMubGlzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInVsIik7CgogICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICAgICAgY29uc3QgaGVhZGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaDIiKTsKICAgICAgICAgICAgaGVhZGVyLnRleHRDb250ZW50ID0gIkJhcmdhaW4gU3RvY2tzIEhlbHBlciI7CgogICAgICAgICAgICBjb250YWluZXIuYXBwZW5kKAogICAgICAgICAgICAgICAgaGVhZGVyLAogICAgICAgICAgICAgICAgdGhpcy5taW5QcmljZUNvbmZpZywKICAgICAgICAgICAgICAgIHRoaXMubWVzc2FnZSwKICAgICAgICAgICAgICAgIHRoaXMubGlzdAogICAgICAgICAgICApOwoKICAgICAgICAgICAgc2hhZG93LmFwcGVuZCgKICAgICAgICAgICAgICAgIHRoaXMuc3R5bGVzaGVldCwKICAgICAgICAgICAgICAgIGNvbnRhaW5lciwKICAgICAgICAgICAgKTsKICAgICAgICAgICAgdGhpcy5fdXBkYXRlVUkoKTsKICAgICAgICB9CgogICAgICAgIGdldCBtaW5QcmljZSgpIHsKICAgICAgICAgICAgY29uc3QgaGFzQ2hlYXBlckJ5VGhlRG96ZW4gPQogICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5wZXJrQmFyIikgIT0gbnVsbDsKICAgICAgICAgICAgY29uc3QgZGVmYXVsdE1pblByaWNlID0gaGFzQ2hlYXBlckJ5VGhlRG96ZW4gPyAxMCA6IDE1OwoKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dldE51bWVyaWNBdHRyaWJ1dGVWYWx1ZSgibWluUHJpY2UiKSB8fCBkZWZhdWx0TWluUHJpY2U7CiAgICAgICAgfQoKICAgICAgICBnZXQgbWF4UHJpY2UoKSB7CiAgICAgICAgICAgIGNvbnN0IGRlZmF1bHRNYXhQcmljZSA9IHRoaXMubWluUHJpY2UgKyA1OwogICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0TnVtZXJpY0F0dHJpYnV0ZVZhbHVlKCJtYXhQcmljZSIpIHx8IGRlZmF1bHRNYXhQcmljZTsKICAgICAgICB9CgogICAgICAgIGdldCBzdG9ja3NMaXN0KCkgewogICAgICAgICAgICBpZiAoIXRoaXMuX3N0b2Nrc0xpc3QpIHsKICAgICAgICAgICAgICAgIHRoaXMuX3N0b2Nrc0xpc3QgPSBwYXJzZVN0b2NrVGlja2VyKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3N0b2Nrc0xpc3Q7CiAgICAgICAgfQoKICAgICAgICBfdXBkYXRlVUkoKSB7CiAgICAgICAgICAgIGNvbnN0IHN0b2NrcyA9IGZpbmRDaGVhcGVzdFB1cmNoYXNlYWJsZVN0b2Nrcyh0aGlzLnN0b2Nrc0xpc3QsIHRoaXMubWluUHJpY2UsIHRoaXMubWF4UHJpY2UpOwogICAgICAgICAgICB0aGlzLl9zZXRDb250ZW50KHN0b2Nrcyk7CiAgICAgICAgfQoKICAgICAgICBnZXQgc3R5bGVzaGVldCgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX3N0eWxlc2hlZXQpIHJldHVybiB0aGlzLl9zdHlsZXNoZWV0OwoKICAgICAgICAgICAgdGhpcy5fc3R5bGVzaGVldCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInN0eWxlIik7CiAgICAgICAgICAgIHRoaXMuX3N0eWxlc2hlZXQudGV4dENvbnRlbnQgPSBgCiAgICAgICAgICAgICAgICBkaXYgewogICAgICAgICAgICAgICAgICAgIGJvcmRlcjogMnB4IHNvbGlkICNlZWU7CiAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogMjRweDsKICAgICAgICAgICAgICAgICAgICBtYXJnaW4tdG9wOiAxNnB4OwogICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IGdyaWQ7CiAgICAgICAgICAgICAgICAgICAgZ2FwOiAxNnB4OwogICAgICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgICAgICAgICAgICAgICAgICBncmlkLXRlbXBsYXRlOgogICAgICAgICAgICAgICAgICAgICAgImhlYWRlciBoZWFkZXIgYnV0dG9uIiBhdXRvCiAgICAgICAgICAgICAgICAgICAgICAibWVzc2FnZSBtZXNzYWdlIG1lc3NhZ2UiIGF1dG8KICAgICAgICAgICAgICAgICAgICAgICJsaXN0IGxpc3QgbGlzdCIgYXV0bzsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBoMiB7CiAgICAgICAgICAgICAgICAgICAgZm9udC1zaXplOiAxNnB4OwogICAgICAgICAgICAgICAgICAgIG1hcmdpbjogMDsKICAgICAgICAgICAgICAgICAgICBncmlkLWFyZWE6IGhlYWRlcjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBwIHsKICAgICAgICAgICAgICAgICAgICBtYXJnaW46IDA7CiAgICAgICAgICAgICAgICAgICAgZ3JpZC1hcmVhOiBtZXNzYWdlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHVsIHsKICAgICAgICAgICAgICAgICAgICBsaXN0LXN0eWxlOiBub25lOwogICAgICAgICAgICAgICAgICAgIG1hcmdpbjogMDsKICAgICAgICAgICAgICAgICAgICBwYWRkaW5nOiAwOwogICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IGdyaWQ7CiAgICAgICAgICAgICAgICAgICAgZ2FwOiA4cHg7CiAgICAgICAgICAgICAgICAgICAgZ3JpZC1hcmVhOiBsaXN0OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGEgewogICAgICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMTRweDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBidXR0b24gewogICAgICAgICAgICAgICAgICAgIGdyaWQtYXJlYTogYnV0dG9uOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBgOwogICAgICAgICAgICByZXR1cm4gdGhpcy5fc3R5bGVzaGVldDsKICAgICAgICB9CgogICAgICAgIGdldCBtaW5QcmljZUNvbmZpZygpIHsKICAgICAgICAgICAgaWYgKHRoaXMuX21pblByaWNlQ29uZmlnRWxlbWVudCkgIHJldHVybiB0aGlzLl9taW5QcmljZUNvbmZpZ0VsZW1lbnQ7CgogICAgICAgICAgICBjb25zdCBlbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7CiAgICAgICAgICAgIGVsZW0udGV4dENvbnRlbnQgPSAiU2V0IG1pbiBwcmljZSI7CiAgICAgICAgICAgIGVsZW0uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLl9oYW5kbGVNaW5QcmljZUNvbmZpZygpOwogICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlVUkoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMuX21pblByaWNlQ29uZmlnRWxlbWVudCA9IGVsZW07CgogICAgICAgICAgICByZXR1cm4gdGhpcy5fbWluUHJpY2VDb25maWdFbGVtZW50OwogICAgICAgIH0KCiAgICAgICAgX2hhbmRsZU1pblByaWNlQ29uZmlnKCkgewogICAgICAgICAgICBjb25zdCBwcm9tcHRNZXNzYWdlID0gIlNldCBhIG1pbmltdW0gcHVyY2hhc2UgcHJpY2UiCiAgICAgICAgICAgIGxldCBuZXdNaW4KICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgbmV3TWluID0gcHJvbXB0KG5ld01pbiA/IGBQbGVhc2Ugc3BlY2lmeSBhIG51bWVyaWMgdmFsdWUuXG4ke3Byb21wdE1lc3NhZ2V9YCA6IHByb21wdE1lc3NhZ2UsIHRoaXMubWluUHJpY2UpCiAgICAgICAgICAgICAgICBpZiAoIW5ld01pbikgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSB3aGlsZSAoaXNOYU4ocGFyc2VJbnQobmV3TWluKSkpOwogICAgICAgICAgICB0aGlzLnNldEF0dHJpYnV0ZSgibWluUHJpY2UiLCBuZXdNaW4pCiAgICAgICAgfQoKICAgICAgICBfZ2V0TnVtZXJpY0F0dHJpYnV0ZVZhbHVlKGF0dHJpYnV0ZU5hbWUpIHsKICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBwYXJzZUludCh0aGlzLmdldEF0dHJpYnV0ZShhdHRyaWJ1dGVOYW1lKSk7CgogICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAibnVtYmVyIiB8fCBpc05hTih2YWx1ZSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgfQoKICAgICAgICBfc2V0Q29udGVudChzdG9ja3MpIHsKICAgICAgICAgICAgdGhpcy5saXN0LnRleHRDb250ZW50ID0gJyc7CgogICAgICAgICAgICBpZiAoc3RvY2tzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgdGhpcy5tZXNzYWdlLnRleHRDb250ZW50ID0gYE5vIHN0b2NrcyBhcmUgY3VycmVudGx5IGF2YWlsYWJsZSBiZXR3ZWVuICR7dGhpcy5taW5QcmljZX0gYW5kICR7dGhpcy5tYXhQcmljZX0gTlAuIDooYDsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5tZXNzYWdlLnRleHRDb250ZW50ID0gYFRoZSBmb2xsb3dpbmcgJHtzdG9ja3MubGVuZ3RofSAke3BsdXJhbGl6ZShzdG9ja3MubGVuZ3RoLCAic3RvY2siKX0gYXJlIGF2YWlsYWJsZSB0byBwdXJjaGFzZSBhdCBvciBuZWFyICR7dGhpcy5taW5QcmljZX0gTlAuYAogICAgICAgICAgICAgKyAiIENsaWNrIHRoZSBzdG9jayB0aWNrZXIgdG8gZ28gdG8gdGhlIHB1cmNoYXNlIHBhZ2UuIjsKCiAgICAgICAgICAgIHRoaXMubGlzdC5hcHBlbmQoLi4uc3RvY2tzLm1hcCgoeyB0aWNrZXIsIHByaWNlIH0pID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJsaSIpOwogICAgICAgICAgICAgICAgY29uc3QgdXJsID0gYGh0dHA6Ly93d3cubmVvcGV0cy5jb20vc3RvY2ttYXJrZXQucGh0bWw/dHlwZT1idXkmdGlja2VyPSR7dGlja2VyfWA7CiAgICAgICAgICAgICAgICBjb25zdCBhbmNob3IgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgICAgICAgICAgICBhbmNob3IuaHJlZiA9IHVybDsKICAgICAgICAgICAgICAgIGFuY2hvci50ZXh0Q29udGVudCA9IHRpY2tlcjsKICAgICAgICAgICAgICAgIGl0ZW0uYXBwZW5kKGFuY2hvcik7CiAgICAgICAgICAgICAgICBpZiAocHJpY2UgIT09IHRoaXMubWluUHJpY2UpIHsKICAgICAgICAgICAgICAgICAgICBpdGVtLmFwcGVuZChgICgke3ByaWNlfSBOUClgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBpdGVtOwogICAgICAgICAgICB9KSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHBsdXJhbGl6ZShudW0sIHNpbmd1bGFyLCBwbHVyYWwgPSBgJHtzaW5ndWxhcn1zYCkgewogICAgICAgIGlmIChudW0gPT0gMSkgewogICAgICAgICAgICByZXR1cm4gc2luZ3VsYXI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIHBsdXJhbDsKICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcGFyc2VTdG9ja1RpY2tlcigpIHsKICAgICAgICBjb25zdCBzdG9ja3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCdtYXJxdWVlIGEnKTsKICAgICAgICBjb25zdCByZWdleCA9IC9eKFtBLVpdKykgKFxkKykvOwoKICAgICAgICByZXR1cm4gWy4uLnN0b2Nrc10ucmVkdWNlKChtYXAsIHN0b2NrKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IFtfLCB0aWNrZXIsIHByaWNlU3RyaW5nXSA9IHJlZ2V4LmV4ZWMoc3RvY2sudGV4dENvbnRlbnQpOwogICAgICAgICAgICBpZiAodGlja2VyIGluIG1hcCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG1hcDsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgLi4ubWFwLAogICAgICAgICAgICAgICAgW3RpY2tlcl06IHBhcnNlSW50KHByaWNlU3RyaW5nKSwKICAgICAgICAgICAgfTsKICAgICAgICB9LCB7fSkKICAgIH0KCiAgICBmdW5jdGlvbiBmaW5kQ2hlYXBlc3RQdXJjaGFzZWFibGVTdG9ja3Moc3RvY2tzTWFwLCBtaW5QcmljZSA9IDE1LCBtYXhQcmljZSA9IG1pblByaWNlICsgNSkgewogICAgICAgIGxldCBjaGVhcGVzdCA9IFtdOwogICAgICAgIGxldCBjdXJyZW50TWluID0gbWF4UHJpY2U7CgogICAgICAgIE9iamVjdC5lbnRyaWVzKHN0b2Nrc01hcCkuZm9yRWFjaCgoW3RpY2tlciwgcHJpY2VdKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHN0b2NrID0geyB0aWNrZXIsIHByaWNlIH07CiAgICAgICAgICAgIGlmIChzdG9jay5wcmljZSA8IG1pblByaWNlIHx8IHN0b2NrLnByaWNlID4gbWF4UHJpY2UpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHN0b2NrLnByaWNlIDwgY3VycmVudE1pbikgewogICAgICAgICAgICAgICAgY3VycmVudE1pbiA9IHN0b2NrLnByaWNlOwogICAgICAgICAgICAgICAgY2hlYXBlc3QgPSBbXTsKICAgICAgICAgICAgICAgIGNoZWFwZXN0LnB1c2goc3RvY2spOwogICAgICAgICAgICB9IGVsc2UgaWYgKHN0b2NrLnByaWNlID09PSBjdXJyZW50TWluKSB7CiAgICAgICAgICAgICAgICBjaGVhcGVzdC5wdXNoKHN0b2NrKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gY2hlYXBlc3Q7CiAgICB9CgogICAgbWFpbigpOwp9KSgpOwo="},{"name":"Neopets: Display Stock Price","options":{"check_for_updates":true,"user_modified":null,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_powerful_this":null,"sandbox":null,"noframes":null,"unwrap":null,"run_at":null,"tab_types":null,"override":{"use_includes":[],"orig_includes":[],"merge_includes":true,"use_matches":[],"orig_matches":["http*://www.neopets.com/stockmarket.phtml?type=buy*","http*://www.neopets.com/stockmarket.phtml?ticker=*&type=buy*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"orig_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null,"orig_run_in":[]},"run_in":null,"tags":[]},"storage":{"ts":1698065426348,"data":{}},"enabled":true,"position":9,"file_url":"https://github.com/Meerca/Neopets-Userscripts/raw/main/stock-price.user.js","uuid":"f34b0fb9-07ed-4665-b226-14de189b730f","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBOZW9wZXRzOiBEaXNwbGF5IFN0b2NrIFByaWNlCi8vIEBhdXRob3IgICAgICAgSGlkZGVuaXN0Ci8vIEBuYW1lc3BhY2UgICAgaHR0cHM6Ly9oaWRkZW5pc3QuY29tCi8vIEB2ZXJzaW9uICAgICAgMjAyNC0wNy0yOQovLyBAZGVzY3JpcHRpb24gIERpc3BsYXlzIHRoZSBwcmljZSBvZiBOZW9wZXRzIHN0b2NrcyBvbiB0aGUgcHVyY2hhc2UgcGFnZSwgYW5kIHByZS1maWxsIHRoZSBudW1iZXIgb2Ygc2hhcmVzIHRvIG1heC4KLy8gQG1hdGNoICAgICAgICBodHRwKjovL3d3dy5uZW9wZXRzLmNvbS9zdG9ja21hcmtldC5waHRtbD90eXBlPWJ1eSoKLy8gQG1hdGNoICAgICAgICBodHRwKjovL3d3dy5uZW9wZXRzLmNvbS9zdG9ja21hcmtldC5waHRtbD90aWNrZXI9KiZ0eXBlPWJ1eSoKLy8gQGdyYW50ICAgICAgICBub25lCi8vIEB1cGRhdGVVUkwgICAgaHR0cHM6Ly9naXRodWIuY29tL01lZXJjYS9OZW9wZXRzLVVzZXJzY3JpcHRzL3Jhdy9tYWluL3N0b2NrLXByaWNlLnVzZXIuanMKLy8gQGRvd25sb2FkVVJMICBodHRwczovL2dpdGh1Yi5jb20vTWVlcmNhL05lb3BldHMtVXNlcnNjcmlwdHMvcmF3L21haW4vc3RvY2stcHJpY2UudXNlci5qcwovLyBAc3VwcG9ydFVSTCAgaHR0cHM6Ly9naXRodWIuY29tL01lZXJjYS9OZW9wZXRzLVVzZXJzY3JpcHRzL2lzc3VlcwovLyA9PS9Vc2VyU2NyaXB0PT0KCihmdW5jdGlvbigpIHsKICAoInVzZSBzdHJpY3QiKTsKCiAgY29uc3QgbnVtYmVyT2ZTaGFyZXMgPSAxMDAwOwogIGNvbnN0IG1pbkJ1eVByaWNlID0gZ2V0TWluUHVyY2hhc2VQcmljZSgpOwoKICBjb25zdCB1cGRhdGVkRXZlcnlNaW51dGVzID0gMzA7IC8vIGhvdyBvZnRlbiBOZW9wZXRzIHN0b2NrIHByaWNlcyB1cGRhdGUKICBjb25zdCBsb2FkVGltZSA9IG5ldyBEYXRlKCk7CiAgY29uc3QgcmVmcmVzaEludGVydmFsID0gMTAwMCAqIDYwICogNTsgLy8gNSBtaW51dGVzCiAgbGV0IHJlZnJlc2hUaW1lb3V0ID0gZmFsc2U7CgogIGNvbnN0IHB1cmNoYXNlRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoCiAgICAnZm9ybVthY3Rpb249InByb2Nlc3Nfc3RvY2ttYXJrZXQucGh0bWwiXScKICApOwogIGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwoKICBmdW5jdGlvbiBpbml0KCkgewogICAgcHVyY2hhc2VGb3JtLnRpY2tlcl9zeW1ib2wucGFyZW50RWxlbWVudC5hcHBlbmRDaGlsZChkaXYpOwogICAgcHVyY2hhc2VGb3JtLmFtb3VudF9zaGFyZXMudmFsdWUgPSBudW1iZXJPZlNoYXJlczsKCiAgICBkaXYuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gIndoaXRlIjsKICAgIGRpdi5zdHlsZS5wYWRkaW5nID0gIjVweCI7CiAgICBkaXYuc3R5bGUuYm9yZGVyUmFkaXVzID0gIjVweCI7CiAgICBkaXYuc3R5bGUudGV4dEFsaWduID0gImNlbnRlciI7CgogICAgZGlzcGxheVRpY2tlckluZm8oKTsKICAgIHB1cmNoYXNlRm9ybS50aWNrZXJfc3ltYm9sLmFkZEV2ZW50TGlzdGVuZXIoImNoYW5nZSIsIGRpc3BsYXlUaWNrZXJJbmZvKTsKICAgIC8vIHdoZW4gcmUtZW50ZXJpbmcgdGFiLCBzaW5jZSB0aGUgcGFnZSBpcyBtb3N0IGxpa2VseSB0byBiZSBzdGFsZSB0aGVuCiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJ2aXNpYmlsaXR5Y2hhbmdlIiwgZGlzcGxheVRpY2tlckluZm8pOwogIH0KCiAgZnVuY3Rpb24gZ2V0VGlja2VyRW50cnkodGlja2VyKSB7CiAgICBsZXQgaXRlbSA9IGRvY3VtZW50LmV2YWx1YXRlKAogICAgICBgLy9tYXJxdWVlLy9iW3N0YXJ0cy13aXRoKC4sICIke3RpY2tlcn0gIildYCwKICAgICAgZG9jdW1lbnQsCiAgICAgIG51bGwsCiAgICAgIFhQYXRoUmVzdWx0LkZJUlNUX09SREVSRURfTk9ERV9UWVBFLAogICAgICBudWxsCiAgICApLnNpbmdsZU5vZGVWYWx1ZTsKCiAgICBpZiAoIWl0ZW0pIHsKICAgICAgY29uc29sZS5sb2coIk5vdGhpbmcgZm91bmQiKTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgbGV0IG0gPSBpdGVtLnRleHRDb250ZW50Lm1hdGNoKAogICAgICAvKD88dGlja2VyPlx3KykgKD88cHJpY2U+XGQrKSAoPzxjaGFuZ2U+WytcLV1cZCspLwogICAgKTsKICAgIHJldHVybiBtLmdyb3VwczsKICB9CgogIGZ1bmN0aW9uIGdldFRpbWVEaWZmTWludXRlcygpIHsKICAgIGNvbnN0IHRpbWVOb3cgPSBuZXcgRGF0ZSgpOwogICAgY29uc3QgZGlmZk1zID0gdGltZU5vdy5nZXRUaW1lKCkgLSBsb2FkVGltZS5nZXRUaW1lKCk7CiAgICByZXR1cm4gTWF0aC5mbG9vcihkaWZmTXMgLyAxMDAwIC8gNjApOwogIH0KCiAgZnVuY3Rpb24gY2hlY2tTdGFsZW5lc3MoKSB7CiAgICBjb25zdCBtaW51dGVzU3RhbGUgPSBnZXRUaW1lRGlmZk1pbnV0ZXMoKTsKICAgIGlmIChtaW51dGVzU3RhbGUgPj0gdXBkYXRlZEV2ZXJ5TWludXRlcykgewogICAgICBkaXYuc3R5bGUuY29sb3IgPSAicmVkIjsKICAgICAgZGl2LnN0eWxlLmN1cnNvciA9ICJwb2ludGVyIjsKICAgICAgZGl2LmlubmVySFRNTCA9IGA8c3Ryb25nPuKdlyBSZWZyZXNoIHRoZSBwYWdlIOKdlzwvc3Ryb25nPjxicj48c21hbGw+PGVtPiR7bWludXRlc1N0YWxlfSBtaW51dGVzIHNpbmNlIHByaWNlcyB1cGRhdGVkPC9lbT48c21hbGw+YDsKICAgICAgZGl2LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24gKCkgewogICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpOwogICAgICB9KTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgZnVuY3Rpb24gZ2V0TWluUHVyY2hhc2VQcmljZShkZWZhdWx0VmFsdWUgPSAxNSkgewogICAgY29uc3QgcmVnZXggPSAvKFxkKykgTlAgcGVyIHNoYXJlLzsKICAgIGNvbnN0IG1lc3NhZ2UgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIi5jb250ZW50IGIiKSkuZmluZCgKICAgICAgKGIpID0+IHJlZ2V4LnRlc3QoYi50ZXh0Q29udGVudCkKICAgICk7CgogICAgaWYgKCFtZXNzYWdlKSB7CiAgICAgIHJldHVybiBkZWZhdWx0VmFsdWU7CiAgICB9CgogICAgY29uc3QgbWF0Y2hlcyA9IG1lc3NhZ2UudGV4dENvbnRlbnQubWF0Y2gocmVnZXgpOwogICAgaWYgKCFtYXRjaGVzKSB7CiAgICAgIHJldHVybiBkZWZhdWx0VmFsdWU7CiAgICB9CgogICAgY29uc3QgbWluUHJpY2UgPSBwYXJzZUludChtYXRjaGVzWzFdKTsKCiAgICBpZiAoaXNOYU4obWluUHJpY2UpIHx8IG1pblByaWNlIDwgMSkgewogICAgICByZXR1cm4gZGVmYXVsdFZhbHVlOwogICAgfQoKICAgIHJldHVybiBtaW5QcmljZTsKICB9CgogIGZ1bmN0aW9uIGRpc3BsYXlUaWNrZXJJbmZvKCkgewogICAgaWYgKHJlZnJlc2hUaW1lb3V0KSB7CiAgICAgIGNsZWFyVGltZW91dChyZWZyZXNoVGltZW91dCk7CiAgICB9CgogICAgaWYgKGNoZWNrU3RhbGVuZXNzKCkpIHsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IHRpY2tlciA9IHB1cmNoYXNlRm9ybS50aWNrZXJfc3ltYm9sLnZhbHVlOwogICAgY29uc3QgdGlja2VyRW50cnkgPSBnZXRUaWNrZXJFbnRyeSh0aWNrZXIpOwogICAgY29uc3Qgc2luY2VNaW51dGVzID0gZ2V0VGltZURpZmZNaW51dGVzKCk7CiAgICBjb25zdCB0aW1lU2luY2UgPQogICAgICBzaW5jZU1pbnV0ZXMgPT0gMAogICAgICAgID8gImp1c3Qgbm93IgogICAgICAgIDogYCR7c2luY2VNaW51dGVzfSBtaW51dGUke3NpbmNlTWludXRlcyA9PSAxID8gIiIgOiAicyJ9IGFnb2A7CgogICAgaWYgKCF0aWNrZXIpIHsKICAgICAgZGl2LmlubmVySFRNTCA9ICIiOwogICAgICBkaXYuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgcmV0dXJuOwogICAgfSBlbHNlIHsKICAgICAgZGl2LnN0eWxlLmRpc3BsYXkgPSAiIjsKICAgIH0KCiAgICBkaXYudGl0bGUgPSAiIjsKCiAgICBpZiAoIXRpY2tlckVudHJ5KSB7CiAgICAgIGRpdi5pbm5lckhUTUwgPSBgPHNtYWxsPuKaoO+4jzxlbT5DYW4ndCBmaW5kICR7dGlja2VyfTwvZW0+PC9zbWFsbD5gOwogICAgICBkaXYuc3R5bGUuY29sb3IgPSAicmVkIjsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIGxldCBlbW9qaSA9ICIiOwogICAgaWYgKHRpY2tlckVudHJ5LnByaWNlIDwgbWluQnV5UHJpY2UpIHsKICAgICAgZGl2LnN0eWxlLmNvbG9yID0gInJlZCI7CiAgICAgIGVtb2ppID0gIuKblCI7CiAgICAgIGRpdi50aXRsZSA9CiAgICAgICAgIlRoaXMgc3RvY2sgaXMgbGVzcyB0aGFuIHRoZSBtaW5pbXVtIHB1cmNoYXNlIHByaWNlIC0geW91IGNhbid0IGJ1eSBpdCI7CiAgICB9IGVsc2UgaWYgKHRpY2tlckVudHJ5LnByaWNlID4gbWluQnV5UHJpY2UpIHsKICAgICAgZGl2LnN0eWxlLmNvbG9yID0gIm9yYW5nZSI7CiAgICAgIGVtb2ppID0gIuKaoO+4jyI7CiAgICAgIGRpdi50aXRsZSA9ICJUaGlzIHN0b2NrIGNvc3RzIG1vcmUgdGhhbiB0aGUgbWluaW11bSBwdXJjaGFzZSBwcmljZSI7CiAgICB9IGVsc2UgewogICAgICBkaXYuc3R5bGUuY29sb3IgPSAiZ3JlZW4iOwogICAgICBlbW9qaSA9ICLinYfvuI8iOwogICAgICBkaXYudGl0bGUgPSAiTmljZSEgVGhpcyBzdG9jayBpcyB0aGUgc2FtZSBhcyB0aGUgbWluaW11bSBwdXJjaGFzZSBwcmljZS4iOwogICAgfQoKICAgIGRpdi5pbm5lckhUTUwgPSBgPHN0cm9uZz4ke2Vtb2ppfSBDb3N0OiAke3RpY2tlckVudHJ5LnByaWNlfSBOUDwvc3Ryb25nPiAke2Vtb2ppfTxicj48c21hbGw+PGVtPmZvciAke3RpY2tlcn0gJHt0aW1lU2luY2V9PC9lbT48L3NtYWxsPmA7CgogICAgcmVmcmVzaFRpbWVvdXQgPSBzZXRUaW1lb3V0KGRpc3BsYXlUaWNrZXJJbmZvLCByZWZyZXNoSW50ZXJ2YWwpOwoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgaW5pdCgpOwp9KSgpOwo="},{"name":"Text Highlighter - Dynamic","options":{"check_for_updates":false,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_powerful_this":null,"sandbox":null,"noframes":null,"unwrap":null,"run_at":null,"tab_types":null,"override":{"use_includes":["https://www.neopets.com/*","https://items.jellyneo.net/*"],"orig_includes":["https://greasyfork.org/*"],"merge_includes":true,"use_matches":[],"orig_matches":[],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"orig_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null,"orig_run_in":[]},"user_modified":null,"run_in":null,"tags":[]},"storage":{"ts":1698411997530,"data":{}},"enabled":false,"position":10,"file_url":"https://greasyfork.org/scripts/3719-text-highlighter-dynamic/code/Text%20Highlighter%20-%20Dynamic.user.js","uuid":"a5ad4717-54fb-4e06-bdd6-1ef38aedc676","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICAgVGV4dCBIaWdobGlnaHRlciAtIER5bmFtaWMKLy8gQG5hbWVzcGFjZSAgICAgZXJvc21hbgovLyBAYXV0aG9yICAgICAgICBlcm9zbWFuIGFuZCBKZWZmZXJzb24gImpzY2hlcjIwMDAiIFNjaGVyCi8vIEB2ZXJzaW9uICAgICAgIDEuN21vCi8vIEBkZXNjcmlwdGlvbiAgIEhpZ2hsaWdodHMgVXNlci1kZWZpbmVkIFRleHQKLy8gQGluY2x1ZGUgICAgICAgaHR0cHM6Ly9ncmVhc3lmb3JrLm9yZy8qCi8vIEBncmFudCAgICAgICAgIEdNX3JlZ2lzdGVyTWVudUNvbW1hbmQKLy8gQGdyYW50ICAgICAgICAgR01fc2V0VmFsdWUKLy8gQGdyYW50ICAgICAgICAgR01fZ2V0VmFsdWUKLy8gPT0vVXNlclNjcmlwdD09CgovKiAtLS0tLS0tLS0gTm90ZSAtLS0tLS0tLS0KICBUaGlzIHNjcmlwdCBoaWdobGlnaHRzIFVzZXItZGVmaW5lZCBjYXNlLWluc2Vuc2l0aXZlIFRleHQgb24gYSBwYWdlLgoKICBUTyBJTkNMVURFIFNJVEVTIChvbmx5IEdyZWFzeSBGb3JrIGlzIGluaXRpYWxseSBpbmNsdWRlZCk6CgogIEdvIHRvIEFkZC1vbnMgLSBVc2VyIFNjcmlwdHMgKCdDdHJsKyBTaGlmdCArIGEnIG9uIEZpcmVmb3gpCiAgQ2xpY2sgb24gdGhlIFNjcmlwdCdzIE9wdGlvbgogIFVuZGVyIFVzZXIgU2V0dGluZ3MgVGFiLCBBZGQgSW5jbHVkZWQvRXhjbHVkZWQgUGFnZXMgdGhhdCB5b3Ugd2FudCB0aGUgc2NyaXB0IHRvIHJ1biBvbgogIENsaWNrIE9LCgogIFNldHRpbmcgS2V5d29yZHMgJiBIaWdobGlnaHQgU3R5bGU6CiAgQ2xpY2sgb24gZHJvcC1kb3duIHRyaWFuZ2xlIG5leHQgdG8gdGhlIEdyZWFzZU1vbmtleSBJY29uCiAgVXNlciBTY3JpcHRzIENvbW1hbmRzLi4uCgogICAgICBTZXQgS2V5d29yZHMKICAgICAgSW5wdXQga2V5d29yZHMgc2VwYXJhdGVkIGJ5IGNvbW1hCiAgICAgIEV4YW1wbGU6IHdvcmQgMSx3b3JkIDIsd29yZCAzCgogICAgICBTZXQgSGlnaGxpZ2h0IFN0eWxlCiAgICAgIElucHV0IHRoZSBIaWdobGlnaHQgU3R5bGUgKHVzZSBwcm9wZXIgQ1NTKQogICAgICBFeGFtcGxlOiBjb2xvcjogI2YwMDsgZm9udC13ZWlnaHQ6IGJvbGQ7IGJhY2tncm91bmQtY29sb3I6ICNmZmU0YjU7CgogIE5vdGU6IElmIHlvdSBmaW5kIHRoYXQgYW5vdGhlciBzY3JpcHQgY2xhc2hlcyB3aXRoIHRoaXMgc2NyaXB0LCBzZXQgVGV4dCBIaWdobGlnaHRlciB0byBFeGVjdXRlIGZpcnN0LgogIEdvIHRvIEFkZC1vbnMgLSBVc2VyIFNjcmlwdHMgKCdDdHJsKyBTaGlmdCArIGEnIG9uIEZpcmVmb3gpCiAgUmlnaHQgQ2xpY2sgb24gdGhlIFNjcmlwdAogIE9uIHRoZSBjb250ZXh0IG1lbnUgY2xpY2s6IEV4ZWN1dGUgZmlyc3QKCiAgT24gQWRkLW9ucyAtIFVzZXIgU2NyaXB0cywgeW91IGNhbiBhbHNvIENsaWNrIG9uIHRoZSBFeGVjdXRpb24gT3JkZXIgKHRvcCBSaWdodCkgYW5kCiAgY2hhbmdlIHRoZSBleGVjdXRpb24gb3JkZXIgc28gdGhhdCBUZXh0IEhpZ2hsaWdodGVyIHJ1bnMgYmVmb3JlIHRob3NlIHNjcmlwdHMgdGhhdCBjbGFzaGVzIHdpdGggaXQuCgoKICAtLS0tLS0tLS0gSGlzdG9yeSAtLS0tLS0tLS0KICAxLjdtbyBBZGRlZCBNdXRhdGlvbk9ic2VydmVyIChKZWZmZXJzb24gImpzY2hlcjIwMDAiIFNjaGVyKQogIDEuNyBDaGFuZ2VkIHNjcmlwdCBmcm9tIG1hdGNoaW5nIHdob2xlIHdvcmRzIHRvIGRvIHBhcnRpYWwgd29yZCBtYXRjaCAKICAgICAgc2ltaWxhciB0byBicm93c2VyJ3MgRklORCArIGVzY2FwZWQgUmVnRXggUXVhbnRpZmllcnMgaW4ga2V5d29yZHMKICAxLjYgQ29kZSBJbXByb3ZlbWVudCwgdXNpbmcgdGVzdCgpCiAgMS41IENvZGUgSW1wcm92ZW1lbnQKICAxLjQgQ29kZSBJbXByb3ZlbWVudCArIEFkZGVkIHN1cHBvcnQgZm9yIG5vbi1FbmdsaXNoIFdvcmRzCiAgMS4zIENvZGUgSW1wcm92ZW1lbnQsIDEweCBzcGVlZCBpbmNyZWFzZQogIDEuMiBBZGRlZCBVc2VyIFNjcmlwdCBDb21tYW5kcywgc2NyaXB0IGNhbiBub3cgYmUgYXV0by11cGRhdGVkIHdpdGhvdXQgbG9zaW5nIFVzZXIgRGF0YQogIDEuMSBUb3RhbCBDb2RlIHJld3JpdGUsIFhwYXRoIHBhdHRlcm4KICAxLjAgSW5pdGlhbCByZWxlYXNlCgoqLwoKCihmdW5jdGlvbigpIHsgLy8gYW5vbnltb3VzIGZ1bmN0aW9uIHdyYXBwZXIsIHVzZWQgZm9yIGVycm9yIGNoZWNraW5nICYgbGltaXRpbmcgc2NvcGUKICAndXNlIHN0cmljdCc7CiAgCiAgaWYgKHdpbmRvdy5zZWxmICE9PSB3aW5kb3cudG9wKSB7IHJldHVybjsgfSAvLyBlbmQgZXhlY3V0aW9uIGlmIGluIGEgZnJhbWUKICAKICAvLyBzZXR0aW5nIFVzZXIgUHJlZmVyZW5jZXMKICBmdW5jdGlvbiBzZXRVc2VyUHJlZih2YXJOYW1lLCBkZWZhdWx0VmFsLCBtZW51VGV4dCwgcHJvbXRUZXh0LCBzZXApewogICAgR01fcmVnaXN0ZXJNZW51Q29tbWFuZChtZW51VGV4dCwgZnVuY3Rpb24oKSB7CiAgICAgIHZhciB2YWwgPSBwcm9tcHQocHJvbXRUZXh0LCBHTV9nZXRWYWx1ZSh2YXJOYW1lLCBkZWZhdWx0VmFsKSk7CiAgICAgIGlmICh2YWwgPT09IG51bGwpICB7IHJldHVybjsgfSAgLy8gZW5kIGV4ZWN1dGlvbiBpZiBjbGlja2VkIENBTkNFTAogICAgICAvLyBwcmVwYXJlIHN0cmluZyBvZiB2YXJpYWJsZXMgc2VwYXJhdGVkIGJ5IHRoZSBzZXBhcmF0b3IKICAgICAgaWYgKHNlcCAmJiB2YWwpewogICAgICAgIHZhciBwYXQxID0gbmV3IFJlZ0V4cCgnXFxzKicgKyBzZXAgKyAnK1xccyonLCAnZycpOyAvLyB0cmltIHNwYWNlL3MgYXJvdW5kIHNlcGFyYXRvciAmIHRyaW0gcmVwZWF0ZWQgc2VwYXJhdG9yCiAgICAgICAgdmFyIHBhdDIgPSBuZXcgUmVnRXhwKCcoPzpeJyArIHNlcCArICcrfCcgKyBzZXAgKyAnKyQpJywgJ2cnKTsgLy8gdHJpbSBzdGFydGluZyAmIHRyYWlsaW5nIHNlcGFyYXRvcgogICAgICAgIHZhbCA9IHZhbC5yZXBsYWNlKHBhdDEsIHNlcCkucmVwbGFjZShwYXQyLCAnJyk7CiAgICAgIH0KICAgICAgdmFsID0gdmFsLnJlcGxhY2UoL1xzezIsfS9nLCAnICcpLnRyaW0oKTsgICAgLy8gcmVtb3ZlIG11bHRpcGxlIHNwYWNlcyBhbmQgdHJpbQogICAgICBHTV9zZXRWYWx1ZSh2YXJOYW1lLCB2YWwpOwogICAgICAvLyBBcHBseSBjaGFuZ2VzIChpbW1lZGlhdGVseSBpZiB0aGVyZSBhcmUgbm8gZXhpc3RpbmcgaGlnaGxpZ2h0cywgb3IgdXBvbiByZWxvYWQgdG8gY2xlYXIgdGhlIG9sZCBvbmVzKQogICAgICBpZighZG9jdW1lbnQuYm9keS5xdWVyeVNlbGVjdG9yKCIuVEhtbyIpKSBUSG1vX2RvSGlnaGxpZ2h0KGRvY3VtZW50LmJvZHkpOwogICAgICBlbHNlIGxvY2F0aW9uLnJlbG9hZCgpOwogICAgfSk7CiAgfQogIAogIC8vIHByZXBhcmUgVXNlclByZWZzCiAgc2V0VXNlclByZWYoCiAgJ2tleXdvcmRzJywKICAnVGV4dCcsCiAgJ1NldCBLZXl3b3JkcycsCiAgJ1NldCBrZXl3b3JkcyBzZXBhcmF0ZWQgYnkgY29tbWFcdFx0XHRcdFx0XHRcdFxyXG5cclxuRXhhbXBsZTpcclxud29yZCAxLHdvcmQgMix3b3JkIDMnLAogICcsJwogICAgIC8vICdrZXl3b3JkcycsCiAgLy8nTWV0ZW9yaXRlIENyYWZ0IEJvb2ssVGhlIE1hZ2ljIEJlaGluZCB0aGUgUHJhbmssSGFsZiBNb29uIFBvcC1VcCBCb29rLERpYXJ5IG9mIGEgQmFieSBTcGFjZSBGdW5ndXMsU2VjcmV0cyBvZiB0aGUgVW5pdmVyc2UsTmVwaHJpdGVzIE5vdGVzLEtyZWx1ZGFuIEFyY2hpdGVjdHVyZSxJdCBDYW1lIEZyb20gdGhlIE1pbmUsS3JlbHVkYW4gQ29va2llIENvb2tib29rLFRoZSBTcGFjZSBBY2UsVGhlIEJpZyBCb29rIG9mIEludGVybWVkaWF0ZSBFdmlsIFBsb3RzLFN0dWNrIGluIFNwYWNlLEFuY2llbnQgR3J1bmRvIExpdGVyYXR1cmUgJiBTb2NpZXR5LFNwYWNlIEZhc2hpb25zLERlZXAgSW5zaWRlIHRoZSBLcmVsdWRhbiBNaW5lcyxTcGFjZSBTdGF0aW9uIFNjaGVtYXRpY3MsR3VpZGUgdG8gdGhlIE5lb2NvbGEgTWFjaGluZSxJdCBDYW1lIEZyb20gS3JlbHVkb3IsQWxpZW4gQWlzaGEgSW52YXNpb24sS3JlbHVkb3IgTWluaW5nIENvcnJpZG9yIE1hcHMsSG93IHRvIEVhcm4gTlAgdGhlIEVhc3kgV2F5LEFkdmFuY2VkIEtyZWx1ZGFuIFBoeXNpY3MsQmVhbSBNZSBBYm9hcmQsR3VpZGUgdG8gU3RhcmdhemluZyBhbmQgQ29uc3RlbGxhdGlvbnMsSG93IFB1cnBsZXMgR290IFRoZWlyIFNwb3RzLEhvdyB0byBDYW1vdWZsYWdlIGFzIEtlbHAgQm9vayxIb3cgdG8gRXhwbG9yZSBFdmVyeSBOb29rIGFuZCBDcmFubnkgb2YgTWFyYXF1YSBCb29rLEludGVycGxhbmV0YXJ5IENvbW11bmljYXRpb25zLEtub3cgWW91ciBSb2JvdCBQZXRwZXQsS3JlbHVkYW4gRW5naW5lZXJpbmcsS3JlbHVkb3IgVmVyc3VzIE5lb3BpYSxTY2VuaWMgS3JlbHVkYW4gVmlld3MsVGhlIEdyZWVuIEdydW5kbyBJbnZhc2lvbixXYWxlaW4gQ2FyZSAxMDEnCiAgKTsKICAKICBzZXRVc2VyUHJlZigKICAnaGlnaGxpZ2h0U3R5bGUnLAogICdjb2xvcjogI2YwMDsgYmFja2dyb3VuZC1jb2xvcjogI2ZmZWJjZDsnLAogICdTZXQgS2V5d29yZHMnLAogICdTZXQga2V5d29yZHMgc2VwYXJhdGVkIGJ5IGNvbW1hXHRcdFx0XHRcdFx0XHRcclxuXHJcbkV4YW1wbGU6XHJcbndvcmQgMSx3b3JkIDIsd29yZCAzJywKICAnLCcKICApOwogIAogIC8vIEFkZCBNdXRhdGlvbk9ic2VydmVyIHRvIGNhdGNoIGNvbnRlbnQgYWRkZWQgZHluYW1pY2FsbHkKICB2YXIgVEhtb19NdXRPYiA9ICh3aW5kb3cuTXV0YXRpb25PYnNlcnZlcikgPyB3aW5kb3cuTXV0YXRpb25PYnNlcnZlciA6IHdpbmRvdy5XZWJLaXRNdXRhdGlvbk9ic2VydmVyOwogIGlmIChUSG1vX011dE9iKXsKICAgIHZhciBUSG1vX2NoZ01vbiA9IG5ldyBUSG1vX011dE9iKGZ1bmN0aW9uKG11dGF0aW9uU2V0KXsKICAgICAgbXV0YXRpb25TZXQuZm9yRWFjaChmdW5jdGlvbihtdXRhdGlvbil7CiAgICAgICAgZm9yICh2YXIgaT0wOyBpPG11dGF0aW9uLmFkZGVkTm9kZXMubGVuZ3RoOyBpKyspewogICAgICAgICAgaWYgKG11dGF0aW9uLmFkZGVkTm9kZXNbaV0ubm9kZVR5cGUgPT0gMSl7CiAgICAgICAgICAgIFRIbW9fZG9IaWdobGlnaHQobXV0YXRpb24uYWRkZWROb2Rlc1tpXSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwogICAgLy8gYXR0YWNoIGNoZ01vbiB0byBkb2N1bWVudC5ib2R5CiAgICB2YXIgb3B0cyA9IHtjaGlsZExpc3Q6IHRydWUsIHN1YnRyZWU6IHRydWV9OwogICAgVEhtb19jaGdNb24ub2JzZXJ2ZShkb2N1bWVudC5ib2R5LCBvcHRzKTsKICB9CiAgLy8gTWFpbiB3b3JraG9yc2Ugcm91dGluZQogIGZ1bmN0aW9uIFRIbW9fZG9IaWdobGlnaHQoZWwpewogICAgdmFyIGtleXdvcmRzID0gR01fZ2V0VmFsdWUoJ2tleXdvcmRzJyk7CiAgICBpZigha2V5d29yZHMpICB7IHJldHVybjsgfSAgLy8gZW5kIGV4ZWN1dGlvbiBpZiBub3QgZm91bmQKICAgIHZhciBoaWdobGlnaHRTdHlsZSA9IEdNX2dldFZhbHVlKCdoaWdobGlnaHRTdHlsZScpOwogICAgaWYgKCFoaWdobGlnaHRTdHlsZSkgaGlnaGxpZ2h0U3R5bGUgPSAiY29sb3I6IzAwZjsgZm9udC13ZWlnaHQ6Ym9sZDsgYmFja2dyb3VuZC1jb2xvcjogIzBmMDsiCiAgICAKICAgIHZhciByUXVhbnRpZmllcnMgPSAvWy1cL1xcXiQqKz8uKCl8W1xde31dL2c7CiAgICBrZXl3b3JkcyA9IGtleXdvcmRzLnJlcGxhY2UoclF1YW50aWZpZXJzLCAnXFwkJicpLnNwbGl0KCcsJykuam9pbignfCcpOwogICAgICBjb25zb2xlLmxvZyhrZXl3b3JkcykKICAgIHZhciBwYXQgPSBuZXcgUmVnRXhwKCcoJyArIGtleXdvcmRzICsgJyknLCAnZ2knKTsKICAgICAgY29uc29sZS5sb2cocGF0KQogICAgdmFyIHNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICAvLyBnZXR0aW5nIGFsbCB0ZXh0IG5vZGVzIHdpdGggYSBmZXcgZXhjZXB0aW9ucwogICAgdmFyIHNuYXBFbGVtZW50cyA9IGRvY3VtZW50LmV2YWx1YXRlKAogICAgICAgICcuLy90ZXh0KClbbm9ybWFsaXplLXNwYWNlKCkgIT0gIiIgJyArCiAgICAgICAgJ2FuZCBub3QoYW5jZXN0b3I6OnN0eWxlKSAnICsKICAgICAgICAnYW5kIG5vdChhbmNlc3Rvcjo6c2NyaXB0KSAnICsKICAgICAgICAnYW5kIG5vdChhbmNlc3Rvcjo6dGV4dGFyZWEpICcgKwogICAgICAgICdhbmQgbm90KGFuY2VzdG9yOjpjb2RlKSAnICsKICAgICAgICAnYW5kIG5vdChhbmNlc3Rvcjo6cHJlKV0nLAogICAgICAgIGVsLCBudWxsLCBYUGF0aFJlc3VsdC5VTk9SREVSRURfTk9ERV9TTkFQU0hPVF9UWVBFLCBudWxsKTsKICAgIAogICAgaWYgKCFzbmFwRWxlbWVudHMuc25hcHNob3RJdGVtKDApKSB7IHJldHVybjsgfSAgLy8gZW5kIGV4ZWN1dGlvbiBpZiBub3QgZm91bmQKICAgIAogICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHNuYXBFbGVtZW50cy5zbmFwc2hvdExlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgIHZhciBub2RlID0gc25hcEVsZW1lbnRzLnNuYXBzaG90SXRlbShpKTsKICAgICAgLy8gY2hlY2sgaWYgaXQgY29udGFpbnMgdGhlIGtleXdvcmRzCiAgICAgIGlmIChwYXQudGVzdChub2RlLm5vZGVWYWx1ZSkpIHsKICAgICAgICAvLyBjaGVjayB0aGF0IGl0IGlzbid0IGFscmVhZHkgaGlnaGxpZ2h0ZWQKICAgICAgICBpZiAobm9kZS5jbGFzc05hbWUgIT0gIlRIbW8iICYmIG5vZGUucGFyZW50Tm9kZS5jbGFzc05hbWUgIT0gIlRIbW8iKXsKICAgICAgICAgIC8vIGNyZWF0ZSBhbiBlbGVtZW50LCByZXBsYWNlIHRoZSB0ZXh0IG5vZGUgd2l0aCBhbiBlbGVtZW50CiAgICAgICAgICB2YXIgc3AgPSBzcGFuLmNsb25lTm9kZSh0cnVlKTsKICAgICAgICAgIHNwLmlubmVySFRNTCA9IG5vZGUubm9kZVZhbHVlLnJlcGxhY2UocGF0LCAnPHNwYW4gc3R5bGU9IicgKyBoaWdobGlnaHRTdHlsZSArICciIGNsYXNzPSJUSG1vIj4kMTwvc3Bhbj4nKTsKICAgICAgICAgIG5vZGUucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQoc3AsIG5vZGUpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KICAvLyBmaXJzdCBydW4KICBUSG1vX2RvSGlnaGxpZ2h0KGRvY3VtZW50LmJvZHkpOwp9KSgpOyAvLyBlbmQgb2YgYW5vbnltb3VzIGZ1bmN0aW9uCg=="},{"name":"Local YouTube Downloader","options":{"check_for_updates":true,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_powerful_this":null,"sandbox":null,"noframes":null,"unwrap":null,"run_at":null,"tab_types":null,"override":{"use_includes":[],"orig_includes":[],"merge_includes":true,"use_matches":[],"orig_matches":["https://*.youtube.com/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"orig_connects":["googlevideo.com"],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-end","orig_noframes":null,"orig_run_in":[]},"user_modified":null,"run_in":null,"tags":[]},"storage":{"ts":1698412282815,"data":{}},"enabled":true,"position":11,"file_url":"https://greasyfork.org/scripts/369400-local-youtube-downloader/code/Local%20YouTube%20Downloader.user.js","uuid":"2b8a139d-ebd9-41c9-9899-3a4729d8b3a7","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBMb2NhbCBZb3VUdWJlIERvd25sb2FkZXIKLy8gQG5hbWU6emgtVFcgICDmnKzlnLAgWW91VHViZSDkuIvovInlmagKLy8gQG5hbWU6emgtSEsgICDmnKzlnLAgWW91VHViZSDkuIvovInlmagKLy8gQG5hbWU6emgtQ04gICDmnKzlnLAgWW91VHViZSDkuIvovb3lmagKLy8gQG5hbWU6amEgICAgICDjg63jg7zjgqvjg6sgWW91VHViZSDjg4Djgqbjg7Pjg63jg7zjg4Djg7wKLy8gQG5hbWU6a3IgICAgICDroZzsu6wgWW91VHViZSDri6TsmrTroZzrjZQKLy8gQG5hbWVzcGFjZSAgICBodHRwczovL2Jsb2cubWFwbGUzMTQyLm5ldC8KLy8gQHZlcnNpb24gICAgICAwLjkuNTUKLy8gQGRlc2NyaXB0aW9uICAgICAgICBEb3dubG9hZCBZb3VUdWJlIHZpZGVvcyB3aXRob3V0IGV4dGVybmFsIHNlcnZpY2UuCi8vIEBkZXNjcmlwdGlvbjp6aC1UVyAg5LiN6ZyA6YCP6YGO56ys5LiJ5pa55pyN5YuZ5Y2z5Y+v5LiL6LyJIFlvdVR1YmUg5b2x54mH44CCCi8vIEBkZXNjcmlwdGlvbjp6aC1ISyAg5LiN6ZyA6YCP6YGO56ys5LiJ5pa55pyN5YuZ5Y2z5Y+v5LiL6LyJIFlvdVR1YmUg5b2x54mH44CCCi8vIEBkZXNjcmlwdGlvbjp6aC1DTiAg5LiN6ZyA6KaB6YCP6L+H56ys5LiJ5pa555qE5pyN5Yqh5bCx6IO95LiL6L29IFlvdVR1YmUg6KeG6aKR44CCCi8vIEBkZXNjcmlwdGlvbjpqYSAgICAg5aSW6YOo44K144O844OT44K544Gq44GX44GnIFlvdVR1YmUg5YuV55S744KS44OA44Km44Oz44Ot44O844OJCi8vIEBkZXNjcmlwdGlvbjprciAgICAg7Jm467aAIOyEnOu5hOyKpOyXhuydtCBZb3VUdWJlIOuPmeyYgeyDgeydhCDri6TsmrTroZzrk5wKLy8gQGRlc2NyaXB0aW9uOmZyICAgICBPYnRlbmV6IHVuIGxpZW4gYnJ1dCBZb3VUdWJlIHNhbnMgc2VydmljZSBleHRlcm5lLgovLyBAZGVzY3JpcHRpb246Y3MgICAgIFN0YWh1anRlIFlvdVR1YmUgdmlkZWEgYmV6IGV4dGVybsOtY2ggc2x1xb5lYi4KLy8gQGF1dGhvciAgICAgICBtYXBsZTMxNDIKLy8gQG1hdGNoICAgICAgICBodHRwczovLyoueW91dHViZS5jb20vKgovLyBAcmVxdWlyZSAgICAgIGh0dHBzOi8vdW5wa2cuY29tL3Z1ZUAyLjYuMTAvZGlzdC92dWUuanMKLy8gQHJlcXVpcmUgICAgICBodHRwczovL3VucGtnLmNvbS94ZmV0Y2gtanNAMC4zLjQveGZldGNoLm1pbi5qcwovLyBAcmVxdWlyZSAgICAgIGh0dHBzOi8vdW5wa2cuY29tL0BmZm1wZWcvZmZtcGVnQDAuNi4xL2Rpc3QvZmZtcGVnLm1pbi5qcwovLyBAcmVxdWlyZSAgICAgIGh0dHBzOi8vYnVuZGxlLnJ1bi9wLXF1ZXVlQDYuMy4wCi8vIEBncmFudCAgICAgICAgR01feG1saHR0cFJlcXVlc3QKLy8gQGdyYW50ICAgICAgICBHTV9pbmZvCi8vIEBncmFudCAgICAgICAgR01fc2V0VmFsdWUKLy8gQGdyYW50ICAgICAgICBHTV9nZXRWYWx1ZQovLyBAZ3JhbnQgICAgICAgIHVuc2FmZVdpbmRvdwovLyBAcnVuLWF0ICAgICAgIGRvY3VtZW50LWVuZAovLyBAY29ubmVjdCAgICAgIGdvb2dsZXZpZGVvLmNvbQovLyBAY29tcGF0aWJsZSAgIGZpcmVmb3ggPj01MgovLyBAY29tcGF0aWJsZSAgIGNocm9tZSA+PTU1Ci8vIEBsaWNlbnNlICAgICAgTUlUCi8vID09L1VzZXJTY3JpcHQ9PQoKOyhmdW5jdGlvbiAoKSB7CgkndXNlIHN0cmljdCcKCWlmICgKCQl3aW5kb3cudG9wID09PSB3aW5kb3cuc2VsZiAmJgoJCUdNX2luZm8uc2NyaXB0SGFuZGxlciA9PT0gJ1RhbXBlcm1vbmtleScgJiYKCQlHTV9pbmZvLnZlcnNpb24gPT09ICc0LjE4LjAnICYmCgkJR01fZ2V0VmFsdWUoJ3RhbXBlcm1vbmtleV9icmVha3Nfc2hvdWxkX2FsZXJ0JywgdHJ1ZSkKCSkgewoJCWFsZXJ0KAoJCQlgVGFtcGVybW9ua2V5IHJlY2VudGx5IHJlbGVhc2UgYSBicmVha2luZyBjaGFuZ2UgLyBidWcgaW4gdmVyc2lvbiA0LjE4LjAgdGhhdCBicmVha3MgdGhpcyBzY3JpcHQsIHdoaWNoIGlzIGZpeGVkIGluIG5ld2VyIHZlcnNpb24gb2YgVGFtcGVybW9ua2V5IHJpZ2h0IG5vdy4gWW91IHNob3VsZCB1cGRhdGUgaXQgb3Igc3dpdGNoIHRvIFZpb2xlbnRtb25rZXkgaW5zdGVhZC5gCgkJKQoJCUdNX3NldFZhbHVlKCd0YW1wZXJtb25rZXlfYnJlYWtzX3Nob3VsZF9hbGVydCcsIGZhbHNlKQoJfQoJY29uc3QgREVCVUcgPSB0cnVlCgljb25zdCBjcmVhdGVMb2dnZXIgPSAoY29uc29sZSwgdGFnKSA9PgoJCU9iamVjdC5rZXlzKGNvbnNvbGUpCgkJCS5tYXAoayA9PiBbaywgKC4uLmFyZ3MpID0+IChERUJVRyA/IGNvbnNvbGVba10odGFnICsgJzogJyArIGFyZ3NbMF0sIC4uLmFyZ3Muc2xpY2UoMSkpIDogdm9pZCAwKV0pCgkJCS5yZWR1Y2UoKGFjYywgW2ssIGZuXSkgPT4gKChhY2Nba10gPSBmbiksIGFjYyksIHt9KQoJY29uc3QgbG9nZ2VyID0gY3JlYXRlTG9nZ2VyKGNvbnNvbGUsICdZVERMJykKCWNvbnN0IHNsZWVwID0gbXMgPT4gbmV3IFByb21pc2UocmVzID0+IHNldFRpbWVvdXQocmVzLCBtcykpCgoJY29uc3QgTEFOR19GQUxMQkFDSyA9ICdlbicKCWNvbnN0IExPQ0FMRSA9IHsKCQllbjogewoJCQl0b2dnbGVsaW5rczogJ1Nob3cvSGlkZSBMaW5rcycsCgkJCXN0cmVhbTogJ1N0cmVhbScsCgkJCWFkYXB0aXZlOiAnQWRhcHRpdmUgKE5vIFNvdW5kKScsCgkJCXZpZGVvaWQ6ICdWaWRlbyBJRDogJywKCQkJaW5icm93c2VyX2FkYXB0aXZlX21lcmdlcjogJ09ubGluZSBBZGFwdGl2ZSBWaWRlbyAmIEF1ZGlvIE1lcmdlciAoRkZtcGVnKScsCgkJCWRsbXA0OiAnRG93bmxvYWQgaGlnaC1yZXNvbHV0aW9uIG1wNCBpbiBvbmUgY2xpY2snLAoJCQlnZXRfdmlkZW9fZmFpbGVkOiAnRmFpbGVkIHRvIGdldCB2aWRlbyBpbmZvbWF0aW9uIGZvciB1bmtub3duIHJlYXNvbiwgcmVmcmVzaCB0aGUgcGFnZSBtYXkgd29yay4nLAoJCQlsaXZlX3N0cmVhbV9kaXNhYmxlZF9tZXNzYWdlOiAnTG9jYWwgWW91VHViZSBEb3dubG9hZGVyIGlzIG5vdCBhdmFpbGFibGUgZm9yIGxpdmUgc3RyZWFtJwoJCX0sCgkJJ3poLXR3JzogewoJCQl0b2dnbGVsaW5rczogJ+mhr+ekuiAvIOmaseiXj+mAo+e1kCcsCgkJCXN0cmVhbTogJ+S4sua1gSBTdHJlYW0nLAoJCQlhZGFwdGl2ZTogJ+iHqumBqeaHiSBBZGFwdGl2ZSAo5rKS5pyJ6IGy6Z+zKScsCgkJCXZpZGVvaWQ6ICflvbHniYcgSUQ6ICcsCgkJCWluYnJvd3Nlcl9hZGFwdGl2ZV9tZXJnZXI6ICfnt5rkuIroh6rpganmh4nlvbHniYflj4rpn7PoqIrlkIjmiJDlt6XlhbcgKEZGbXBlZyknLAoJCQlkbG1wNDogJ+S4gOmNteS4i+i8iemrmOeVq+izqiBtcDQnLAoJCQlnZXRfdmlkZW9fZmFpbGVkOiAn54Sh5rOV5Y+W5b6X5b2x54mH6LOH6KiK77yM6YeN5paw5pW055CG6aCB6Z2i5Y+v6IO95pyD5pyJ5pWI5p6c44CCJywKCQkJbGl2ZV9zdHJlYW1fZGlzYWJsZWRfbWVzc2FnZTogJ+WboOeCuuaYr+ebtOaSreeahOe3o+aVhe+8jOacrOWcsCBZb3VUdWJlIOS4i+i8ieWZqOeahOWKn+iDveaYr+WBnOeUqOeahOOAgicKCQl9LAoJCSd6aC1oayc6IHsKCQkJdG9nZ2xlbGlua3M6ICfpoa/npLrvvI/pmrHol4/pgKPntZAnLAoJCQlzdHJlYW06ICfkuLLmtYEgU3RyZWFtJywKCQkJYWRhcHRpdmU6ICfoh6rli5Xpganmh4kgQWRhcHRpdmUgKOaykuacieiBsumfsyknLAoJCQl2aWRlb2lkOiAn5b2x54mHIElEOiAnLAoJCQlpbmJyb3dzZXJfYWRhcHRpdmVfbWVyZ2VyOiAn57ay5LiK6Ieq5YuV6YGp5oeJ5b2x54mH5Y+K6Z+z6KiK5ZCI5oiQ5bel5YW3IChGRm1wZWcpJywKCQkJZGxtcDQ6ICfkuIDigIljbGlja+KAieS4i+i8iemrmOeVq+izqiBtcDQnLAoJCQlnZXRfdmlkZW9fZmFpbGVkOiAn54Sh5rOV5Y+W5b6X5b2x54mH6LOH6KiK77yM6YeN5paw5pW055CG6aCB6Z2i5Y+v6IO95pyD5pyJ5pWI5p6c44CCJywKCQkJbGl2ZV9zdHJlYW1fZGlzYWJsZWRfbWVzc2FnZTogJ+acrOWcsCBZb3VUdWJlIOS4i+i8ieWZqOeEoeazleeUqOaWvOebtOaSreOAgicKCQl9LAoJCXpoOiB7CgkJCXRvZ2dsZWxpbmtzOiAn5pi+56S677yP6ZqQ6JeP6ZO+5o6lJywKCQkJc3RyZWFtOiAn5Liy5rWBIFN0cmVhbScsCgkJCWFkYXB0aXZlOiAn6Ieq6YCC5bqUIEFkYXB0aXZlICjmsqHmnInlo7Dpn7MpJywKCQkJdmlkZW9pZDogJ+inhumikSBJRDogJywKCQkJaW5icm93c2VyX2FkYXB0aXZlX21lcmdlcjogJ+e6v+S4iuiHqumAguW6lOinhumikeWPiumfs+mikeWQiOaIkOW3peWFtyAoRkZtcGVnKScsCgkJCWRsbXA0OiAn5LiA6ZSu5LiL6L296auY55S76LSoIG1wNCcsCgkJCWdldF92aWRlb19mYWlsZWQ6ICfml6Dms5Xlj5blvpflvbHniYfotYTorq/vvIzph43mlrDmlbTnkIbpobXpnaLlj6/og73kvJrmnInmlYjmnpzjgIInLAoJCQlsaXZlX3N0cmVhbV9kaXNhYmxlZF9tZXNzYWdlOiAn5Zug5Li65piv55u05pKt77yM5pys5ZywIFlvdVR1YmUg5LiL6L295Zmo55qE5Yqf6IO95bey6KKr56aB55So44CCJwoJCX0sCgkJamE6IHsKCQkJdG9nZ2xlbGlua3M6ICfjg6rjg7Pjgq/ooajnpLrjg7vpnZ7ooajnpLonLAoJCQlzdHJlYW06ICfjgrnjg4jjg6rjg7zjg5/jg7PjgrAnLAoJCQlhZGFwdGl2ZTogJ+OCouODgOODl+ODhuOCo+ODlu+8iOmfs+eEoeOBl++8iScsCgkJCXZpZGVvaWQ6ICfjg5Pjg4fjgqogSUQ6ICcsCgkJCWluYnJvd3Nlcl9hZGFwdGl2ZV9tZXJnZXI6ICfjg5Pjg4fjgqrjgajjgqrjg7zjg4fjgqPjgqrjgpLlkIjkvbXjgZnjgovjgqrjg7Pjg6njgqTjg7Pjg4Tjg7zjg6sgKEZGbXBlZyknLAoJCQlkbG1wNDogJ+ODr+ODs+OCr+ODquODg+OCr+OBp+mrmOino+WDj+W6puOBriBtcDQg44KS44OA44Km44Oz44Ot44O844OJJywKCQkJbGl2ZV9zdHJlYW1fZGlzYWJsZWRfbWVzc2FnZTogJ+ODqeOCpOODlumFjeS/oeOBruOBn+OCgeOAgeODreODvOOCq+ODqyBZb3VUdWJlIOODgOOCpuODs+ODreODvOODgOODvOOBr+eEoeWKueOBq+OBquOBo+OBpuOBhOOBvuOBmeOAgicKCQl9LAoJCWtyOiB7CgkJCXRvZ2dsZWxpbmtzOiAn66eB7YGsIOuztOydtOq4sCDCtyDsiKjquLDquLAnLAoJCQlzdHJlYW06ICfsiqTtirjrpqzrsI0nLAoJCQlhZGFwdGl2ZTogJ+yggeydkSAo7Ja064yR7Yuw67iMKScsCgkJCXZpZGVvaWQ6ICfruYTrlJTsmKQgSUQ6ICcsCgkJCWluYnJvd3Nlcl9hZGFwdGl2ZV9tZXJnZXI6ICfruYTrlJTsmKTsmYAg7Jik65SU7Jik66W8IO2Vqeuzke2VmOuKlCDsmKjrnbzsnbgg64+E6rWsIChGRm1wZWcpJywKCQkJZGxtcDQ6ICftlZwg67KI7J2YIO2BtOumreycvOuhnCDqs6DtlbTsg4Hrj4QgbXA0IOuLpOyatOuhnOuTnCcKCQl9LAoJCWVzOiB7CgkJCXRvZ2dsZWxpbmtzOiAnTW9zdHJhci9PY3VsdGFyIExpbmtzJywKCQkJc3RyZWFtOiAnU3RyZWFtJywKCQkJYWRhcHRpdmU6ICdBZGFwdGFibGUnLAoJCQl2aWRlb2lkOiAnSWQgZGVsIFZpZGVvOiAnLAoJCQlpbmJyb3dzZXJfYWRhcHRpdmVfbWVyZ2VyOiAnQWNvcGxhciBBdWRpbyBhIFZpZGVvIChGRm1wZWcpJwoJCX0sCgkJaGU6IHsKCQkJdG9nZ2xlbGlua3M6ICfXlNem15Iv15TXodeq16gg16fXmdep15XXqNeZ150nLAoJCQlzdHJlYW06ICfXodeY16jXmdedJywKCQkJYWRhcHRpdmU6ICfXkNeT16TXmNeZ15HXmScsCgkJCXZpZGVvaWQ6ICfXnteW15TXlCDXodeo15jXldefOiAnCgkJfSwKCQlmcjogewoJCQl0b2dnbGVsaW5rczogJ0FmZmljaGVyL01hc3F1ZXIgbGVzIGxpZW5zJywKCQkJc3RyZWFtOiAnU3RyZWFtJywKCQkJYWRhcHRpdmU6ICdBZGFwdGF0aXZlJywKCQkJdmlkZW9pZDogJ0lEIHZpZMOpbzogJywKCQkJaW5icm93c2VyX2FkYXB0aXZlX21lcmdlcjogJ0Z1c2lvbm5lciB2aWTDqW9zIGV0IGF1ZGlvcyBhZGFwdGF0aWZzIGRhbnMgbGUgbmF2aWdhdGV1ciAoRkZtcGVnKScsCgkJCWRsbXA0OiAnVMOpbMOpY2hhcmdleiBsYSBwbHVzIGhhdXRlIHLDqXNvbHV0aW9uIG1wNCBlbiB1biBjbGljJwoJCX0sCgkJcGw6IHsKCQkJdG9nZ2xlbGlua3M6ICdQb2thxbwvVWtyeWogTGlua2knLAoJCQlzdHJlYW06ICdTdHJlYW0nLAoJCQlhZGFwdGl2ZTogJ0FkYXB0eXduZScsCgkJCXZpZGVvaWQ6ICdJRCBmaWxtdTogJywKCQkJaW5icm93c2VyX2FkYXB0aXZlX21lcmdlcjogJ1BvxYLEhWN6IGF1ZGlvIGkgd2lkZW8gYWRhcHR5d25lIHcgcHJ6ZWdsxIVkYXJjZSAoRkZtcGVnKScsCgkJCWRsbXA0OiAnUG9iaWVyeiAubXA0IHcgbmFqd3nFvHN6ZWogamFrb8WbY2knCgkJfSwKCQloaTogewoJCQl0b2dnbGVsaW5rczogJ+CksuCkv+CkguCklSDgpJ/gpYngpJfgpLIg4KSV4KSw4KWH4KSCJywKCQkJc3RyZWFtOiAn4KS44KWN4KSf4KWN4KSw4KWA4KSu4KS/4KSC4KSXIChTdHJlYW0pJywKCQkJYWRhcHRpdmU6ICfgpIXgpKjgpYHgpJXgpYLgpLLgpYAgKEFkYXB0aXZlKScsCgkJCXZpZGVvaWQ6ICfgpLXgpYDgpKHgpL/gpK/gpYsg4KSG4KSI4KSh4KWAOiB7e2lkfX0nCgkJfSwKCQlydTogewoJCQl0b2dnbGVsaW5rczogJ9Cf0L7QutCw0LfQsNGC0YwvQ9C60YDRi9GC0Ywg0YHRgdGL0LvQutC4JywKCQkJc3RyZWFtOiAn0J/QvtGC0L7QuicsCgkJCWFkYXB0aXZlOiAn0JDQtNCw0L/RgtC40LLQvdGL0LknLAoJCQl2aWRlb2lkOiAn0JjQtNC10L3RgtC40YTQuNC60LDRgtC+0YAg0LLQuNC00LXQvjogJywKCQkJaW5icm93c2VyX2FkYXB0aXZlX21lcmdlcjogJ9CQ0LTQsNC/0YLQuNCy0L3QvtC1INGB0LvQuNGP0L3QuNC1INCy0LjQtNC10L4g0Lgg0LDRg9C00LjQviDQvtC90LvQsNC50L0gKEZGbXBlZyknLAoJCQlkbG1wNDogJ9Ch0LrQsNGH0LDRgtGMIG1wNCDQsiDQstGL0YHQvtC60L7QvCDRgNCw0LfRgNC10YjQtdC90LjQuCDQsiDQvtC00LjQvSDQutC70LjQuicsCgkJCWdldF92aWRlb19mYWlsZWQ6CgkJCQkn0J3QtSDRg9C00LDQu9C+0YHRjCDQv9C+0LvRg9GH0LjRgtGMINC40L3RhNC+0YDQvNCw0YbQuNGOINC+INCy0LjQtNC10L4g0L/QviDQvdC10LjQt9Cy0LXRgdGC0L3QvtC5INC/0YDQuNGH0LjQvdC1LCDQv9C+0L/RgNC+0LHRg9C50YLQtSDQvtCx0L3QvtCy0LjRgtGMINGB0YLRgNCw0L3QuNGG0YMuJywKCQkJbGl2ZV9zdHJlYW1fZGlzYWJsZWRfbWVzc2FnZTogJ9Cb0L7QutCw0LvRjNC90YvQuSDQt9Cw0LPRgNGD0LfRh9C40LogWW91VHViZSDQvdC10LTQvtGB0YLRg9C/0LXQvSDQtNC70Y8g0L/RgNGP0LzQvtC5INGC0YDQsNC90YHQu9GP0YbQuNC4JwoJCX0sCgkJdWE6IHsKCQkJdG9nZ2xlbGlua3M6ICfQn9C+0LrQsNC30LDRgtC4L9Cf0YDQuNGF0L7QstCw0YLQuCDQv9C+0YHQuNC70LDQvdC90Y8nLAoJCQlzdHJlYW06ICfQn9C+0YLRltC6JywKCQkJYWRhcHRpdmU6ICfQkNC00LDQv9GC0LjQstC90LjQuScsCgkJCXZpZGVvaWQ6ICfQhtC00LXQvdGC0LjRhNGW0LrQsNGC0L7RgCDQstGW0LTQtdC+OiAnLAoJCQlpbmJyb3dzZXJfYWRhcHRpdmVfbWVyZ2VyOiAn0JDQtNCw0L/RgtC40LLQvdC1INC30LvQuNGC0YLRjyDQstGW0LTQtdC+INGWINCw0YPQtNGW0L4g0L7QvdC70LDQudC9IChGRm1wZWcpJywKCQkJZGxtcDQ6ICfQl9Cw0LLQsNC90YLQsNC20LjRgtC4IG1wNCDRgyDQstC40YHQvtC60ZbQuSDRgNC+0LfQtNGW0LvRjNC90ZbQuSDQt9C00LDRgtC90L7RgdGC0ZYg0LIg0L7QtNC40L0g0LrQu9GW0LonLAoJCQlnZXRfdmlkZW9fZmFpbGVkOgoJCQkJJ9Cd0LUg0LLQtNCw0LvQvtGB0Y8g0L7RgtGA0LjQvNCw0YLQuCDRltC90YTQvtGA0LzQsNGG0ZbRjiDQv9GA0L4g0LLRltC00LXQviDQtyDQvdC10LLRltC00L7QvNC+0Zcg0L/RgNC40YfQuNC90LgsINGB0L/RgNC+0LHRg9C50YLQtSDQvtC90L7QstC40YLQuCDRgdGC0L7RgNGW0L3QutGDLicsCgkJCWxpdmVfc3RyZWFtX2Rpc2FibGVkX21lc3NhZ2U6ICfQm9C+0LrQsNC70YzQvdC40Lkg0LfQsNCy0LDQvdGC0LDQttGD0LLQsNGHIFlvdVR1YmUg0L3QtdC00L7RgdGC0YPQv9C90LjQuSDQtNC70Y8g0L/RgNGP0LzQvtGXINGC0YDQsNC90YHQu9GP0YbRltGXJwoJCX0sCgkJY3M6IHsKCQkJdG9nZ2xlbGlua3M6ICdab2JyYXppdC9Ta3LDvXQgb2RrYXp5JywKCQkJc3RyZWFtOiAnU3RyZWFtJywKCQkJYWRhcHRpdmU6ICdBZGFwdGl2bsOtJywKCQkJdmlkZW9pZDogJ0lEIHZpZGVhOiAnLAoJCQlpbmJyb3dzZXJfYWRhcHRpdmVfbWVyZ2VyOiAnT25saW5lIG7DoXN0cm9qIHBybyBzbG91xI1lbsOtIHZpZGVhIGEgYXVkaWEgKEZGbXBlZyknLAoJCQlkbG1wNDogJ1N0w6Fobm91dCB2aWRlbyBtcDQgamVkbsOtbSBrbGlrbnV0w61tIHZlIHZ5c29rw6ltIHJvemxpxaFlbsOtJywKCQkJZ2V0X3ZpZGVvX2ZhaWxlZDogJ05lcG9kYcWZaWxvIHNlIG5haHLDoXQgaW5mb3JtYWNlIG8gdmlkZXUuIFprdXN0ZSBvYm5vdml0IHN0csOhbmt1IChGNSkuJywKCQkJbGl2ZV9zdHJlYW1fZGlzYWJsZWRfbWVzc2FnZTogJ0xvY2FsIFlvdVR1YmUgRG93bmxvYWRlciBuZW7DrSBkb3N0dXBuw70gcHJvIMW+aXbDqSB2eXPDrWzDoW7DrScKCQl9Cgl9Cglmb3IgKGNvbnN0IFtsYW5nLCBkYXRhXSBvZiBPYmplY3QuZW50cmllcyhMT0NBTEUpKSB7CgkJaWYgKGxhbmcgPT09IExBTkdfRkFMTEJBQ0spIGNvbnRpbnVlCgkJZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXMoTE9DQUxFW0xBTkdfRkFMTEJBQ0tdKSkgewoJCQlpZiAoIShrZXkgaW4gZGF0YSkpIHsKCQkJCWRhdGFba2V5XSA9IExPQ0FMRVtMQU5HX0ZBTExCQUNLXVtrZXldCgkJCX0KCQl9Cgl9Cgljb25zdCBmaW5kTGFuZyA9IGwgPT4gewoJCWwgPSBsLnJlcGxhY2UoJy1IYW50JywgJycpIC8vIHNwZWNpYWwgY2FzZSBmb3IgemgtSGFudC1UVwoJCS8vIGxhbmd1YWdlIHJlc29sdXRpb24gbG9naWM6IHpoLXR3IC0tKGlmIG5vdCBleGlzdHMpLS0+IHpoIC0tKGlmIG5vdCBleGlzdHMpLS0+IExBTkdfRkFMTEJBQ0soZW4pCgkJbCA9IGwudG9Mb3dlckNhc2UoKS5yZXBsYWNlKCdfJywgJy0nKQoJCWlmIChsIGluIExPQ0FMRSkgcmV0dXJuIGwKCQllbHNlIGlmIChsLmxlbmd0aCA+IDIpIHJldHVybiBmaW5kTGFuZyhsLnNwbGl0KCctJylbMF0pCgkJZWxzZSByZXR1cm4gTEFOR19GQUxMQkFDSwoJfQoJY29uc3QgZ2V0TGFuZ0NvZGUgPSAoKSA9PiB7CgkJY29uc3QgaHRtbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2h0bWwnKQoJCWlmIChodG1sKSB7CgkJCXJldHVybiBodG1sLmxhbmcKCQl9IGVsc2UgewoJCQlyZXR1cm4gbmF2aWdhdG9yLmxhbmd1YWdlCgkJfQoJfQoJY29uc3QgJCA9IChzLCB4ID0gZG9jdW1lbnQpID0+IHgucXVlcnlTZWxlY3RvcihzKQoJY29uc3QgJGVsID0gKHRhZywgb3B0cykgPT4gewoJCWNvbnN0IGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpCgkJT2JqZWN0LmFzc2lnbihlbCwgb3B0cykKCQlyZXR1cm4gZWwKCX0KCWNvbnN0IGVzY2FwZVJlZ0V4cCA9IHMgPT4gcy5yZXBsYWNlKC9bLiorP14ke30oKXxbXF1cXF0vZywgJ1xcJCYnKQoJY29uc3QgcGFyc2VEZWNzaWcgPSBkYXRhID0+IHsKCQl0cnkgewoJCQlpZiAoZGF0YS5zdGFydHNXaXRoKCd2YXIgc2NyaXB0JykpIHsKCQkJCS8vIHRoZXkgaW5qZWN0IHRoZSBzY3JpcHQgdmlhIHNjcmlwdCB0YWcKCQkJCWNvbnN0IG9iaiA9IHt9CgkJCQljb25zdCBkb2N1bWVudCA9IHsKCQkJCQljcmVhdGVFbGVtZW50OiAoKSA9PiBvYmosCgkJCQkJaGVhZDogeyBhcHBlbmRDaGlsZDogKCkgPT4ge30gfQoJCQkJfQoJCQkJZXZhbChkYXRhKQoJCQkJZGF0YSA9IG9iai5pbm5lckhUTUwKCQkJfQoJCQljb25zdCBmbm5hbWVyZXN1bHQgPSAvPShbYS16QS1aMC05XCRfXSs/KVwoZGVjb2RlVVJJQ29tcG9uZW50Ly5leGVjKGRhdGEpCgkJCWNvbnN0IGZubmFtZSA9IGZubmFtZXJlc3VsdFsxXQoJCQljb25zdCBfYXJnbmFtZWZuYm9keXJlc3VsdCA9IG5ldyBSZWdFeHAoZXNjYXBlUmVnRXhwKGZubmFtZSkgKyAnPWZ1bmN0aW9uXFwoKC4rPylcXCl7KCguKyk9XFwyLis/KX0nKS5leGVjKAoJCQkJZGF0YQoJCQkpCgkJCWNvbnN0IFtfLCBhcmduYW1lLCBmbmJvZHldID0gX2FyZ25hbWVmbmJvZHlyZXN1bHQKCQkJY29uc3QgaGVscGVybmFtZXJlc3VsdCA9IC87KFthLXpBLVowLTkkX10rPylcLi4rP1woLy5leGVjKGZuYm9keSkKCQkJY29uc3QgaGVscGVybmFtZSA9IGhlbHBlcm5hbWVyZXN1bHRbMV0KCQkJY29uc3QgaGVscGVycmVzdWx0ID0gbmV3IFJlZ0V4cCgndmFyICcgKyBlc2NhcGVSZWdFeHAoaGVscGVybmFtZSkgKyAnPXtbXFxzXFxTXSs/fTsnKS5leGVjKGRhdGEpCgkJCWNvbnN0IGhlbHBlciA9IGhlbHBlcnJlc3VsdFswXQoJCQlsb2dnZXIubG9nKGBwYXJzZWRlY3NpZyByZXN1bHQ6ICVzPT57JXNcbiVzfWAsIGFyZ25hbWUsIGhlbHBlciwgZm5ib2R5KQoJCQlyZXR1cm4gbmV3IEZ1bmN0aW9uKFthcmduYW1lXSwgaGVscGVyICsgJ1xuJyArIGZuYm9keSkKCQl9IGNhdGNoIChlKSB7CgkJCWxvZ2dlci5lcnJvcigncGFyc2VkZWNzaWcgZXJyb3I6ICVvJywgZSkKCQkJbG9nZ2VyLmluZm8oJ3NjcmlwdCBjb250ZW50OiAlcycsIGRhdGEpCgkJCWxvZ2dlci5pbmZvKAoJCQkJJ0lmIHlvdSBlbmNvdW50ZXIgdGhpcyBlcnJvciwgcGxlYXNlIGNvcHkgdGhlIGZ1bGwgInNjcmlwdCBjb250ZW50IiB0byBodHRwczovL3Bhc3RlYmluLmNvbS8gZm9yIG1lLicKCQkJKQoJCX0KCX0KCWNvbnN0IHBhcnNlUXVlcnkgPSBzID0+IFsuLi5uZXcgVVJMU2VhcmNoUGFyYW1zKHMpLmVudHJpZXMoKV0ucmVkdWNlKChhY2MsIFtrLCB2XSkgPT4gKChhY2Nba10gPSB2KSwgYWNjKSwge30pCgljb25zdCBwYXJzZVJlc3BvbnNlID0gKGlkLCBwbGF5ZXJSZXNwb25zZSwgZGVjc2lnKSA9PiB7CgkJbG9nZ2VyLmxvZyhgdmlkZW8gJXMgcGxheWVyUmVzcG9uc2U6ICVvYCwgaWQsIHBsYXllclJlc3BvbnNlKQoJCWxldCBzdHJlYW0gPSBbXQoJCWlmIChwbGF5ZXJSZXNwb25zZS5zdHJlYW1pbmdEYXRhLmZvcm1hdHMpIHsKCQkJc3RyZWFtID0gcGxheWVyUmVzcG9uc2Uuc3RyZWFtaW5nRGF0YS5mb3JtYXRzLm1hcCh4ID0+CgkJCQlPYmplY3QuYXNzaWduKHt9LCB4LCBwYXJzZVF1ZXJ5KHguY2lwaGVyIHx8IHguc2lnbmF0dXJlQ2lwaGVyKSkKCQkJKQoJCQlsb2dnZXIubG9nKGB2aWRlbyAlcyBzdHJlYW06ICVvYCwgaWQsIHN0cmVhbSkKCQkJZm9yIChjb25zdCBvYmogb2Ygc3RyZWFtKSB7CgkJCQlpZiAob2JqLnMpIHsKCQkJCQlvYmoucyA9IGRlY3NpZyhvYmoucykKCQkJCQlvYmoudXJsICs9IGAmJHtvYmouc3B9PSR7ZW5jb2RlVVJJQ29tcG9uZW50KG9iai5zKX1gCgkJCQl9CgkJCX0KCQl9CgoJCWxldCBhZGFwdGl2ZSA9IFtdCgkJaWYgKHBsYXllclJlc3BvbnNlLnN0cmVhbWluZ0RhdGEuYWRhcHRpdmVGb3JtYXRzKSB7CgkJCWFkYXB0aXZlID0gcGxheWVyUmVzcG9uc2Uuc3RyZWFtaW5nRGF0YS5hZGFwdGl2ZUZvcm1hdHMubWFwKHggPT4KCQkJCU9iamVjdC5hc3NpZ24oe30sIHgsIHBhcnNlUXVlcnkoeC5jaXBoZXIgfHwgeC5zaWduYXR1cmVDaXBoZXIpKQoJCQkpCgkJCWxvZ2dlci5sb2coYHZpZGVvICVzIGFkYXB0aXZlOiAlb2AsIGlkLCBhZGFwdGl2ZSkKCQkJZm9yIChjb25zdCBvYmogb2YgYWRhcHRpdmUpIHsKCQkJCWlmIChvYmoucykgewoJCQkJCW9iai5zID0gZGVjc2lnKG9iai5zKQoJCQkJCW9iai51cmwgKz0gYCYke29iai5zcH09JHtlbmNvZGVVUklDb21wb25lbnQob2JqLnMpfWAKCQkJCX0KCQkJfQoJCX0KCQlsb2dnZXIubG9nKGB2aWRlbyAlcyByZXN1bHQ6ICVvYCwgaWQsIHsgc3RyZWFtLCBhZGFwdGl2ZSB9KQoJCXJldHVybiB7IHN0cmVhbSwgYWRhcHRpdmUsIGRldGFpbHM6IHBsYXllclJlc3BvbnNlLnZpZGVvRGV0YWlscywgcGxheWVyUmVzcG9uc2UgfQoJfQoKCS8vIHZpZGVvIGRvd25sb2FkZXIKCWNvbnN0IHhockRvd25sb2FkVWludDhBcnJheSA9IGFzeW5jICh7IHVybCwgY29udGVudExlbmd0aCB9LCBwcm9ncmVzc0NiKSA9PiB7CgkJaWYgKHR5cGVvZiBjb250ZW50TGVuZ3RoID09PSAnc3RyaW5nJykgY29udGVudExlbmd0aCA9IHBhcnNlSW50KGNvbnRlbnRMZW5ndGgpCgkJcHJvZ3Jlc3NDYih7CgkJCWxvYWRlZDogMCwKCQkJdG90YWw6IGNvbnRlbnRMZW5ndGgsCgkJCXNwZWVkOiAwCgkJfSkKCQljb25zdCBjaHVua1NpemUgPSA2NTUzNgoJCWNvbnN0IGdldEJ1ZmZlciA9IChzdGFydCwgZW5kKSA9PgoJCQlmZXRjaCh1cmwgKyBgJnJhbmdlPSR7c3RhcnR9LSR7ZW5kID8gZW5kIC0gMSA6ICcnfWApLnRoZW4ociA9PiByLmFycmF5QnVmZmVyKCkpCgkJY29uc3QgZGF0YSA9IG5ldyBVaW50OEFycmF5KGNvbnRlbnRMZW5ndGgpCgkJbGV0IGRvd25sb2FkZWQgPSAwCgkJY29uc3QgcXVldWUgPSBuZXcgcFF1ZXVlLmRlZmF1bHQoeyBjb25jdXJyZW5jeTogNiB9KQoJCWNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCkKCQljb25zdCBwcyA9IFtdCgkJZm9yIChsZXQgc3RhcnQgPSAwOyBzdGFydCA8IGNvbnRlbnRMZW5ndGg7IHN0YXJ0ICs9IGNodW5rU2l6ZSkgewoJCQljb25zdCBleGNlZWRlZCA9IHN0YXJ0ICsgY2h1bmtTaXplID4gY29udGVudExlbmd0aAoJCQljb25zdCBjdXJDaHVua1NpemUgPSBleGNlZWRlZCA/IGNvbnRlbnRMZW5ndGggLSBzdGFydCA6IGNodW5rU2l6ZQoJCQljb25zdCBlbmQgPSBleGNlZWRlZCA/IG51bGwgOiBzdGFydCArIGNodW5rU2l6ZQoJCQljb25zdCBwID0gcXVldWUuYWRkKCgpID0+IHsKCQkJCWNvbnNvbGUubG9nKCdkbCBzdGFydCcsIHVybCwgc3RhcnQsIGVuZCkKCQkJCXJldHVybiBnZXRCdWZmZXIoc3RhcnQsIGVuZCkKCQkJCQkudGhlbihidWYgPT4gewoJCQkJCQljb25zb2xlLmxvZygnZGwgZG9uZScsIHVybCwgc3RhcnQsIGVuZCkKCQkJCQkJZG93bmxvYWRlZCArPSBjdXJDaHVua1NpemUKCQkJCQkJZGF0YS5zZXQobmV3IFVpbnQ4QXJyYXkoYnVmKSwgc3RhcnQpCgkJCQkJCWNvbnN0IGRzID0gKERhdGUubm93KCkgLSBzdGFydFRpbWUgKyAxKSAvIDEwMDAKCQkJCQkJcHJvZ3Jlc3NDYih7CgkJCQkJCQlsb2FkZWQ6IGRvd25sb2FkZWQsCgkJCQkJCQl0b3RhbDogY29udGVudExlbmd0aCwKCQkJCQkJCXNwZWVkOiBkb3dubG9hZGVkIC8gZHMKCQkJCQkJfSkKCQkJCQl9KQoJCQkJCS5jYXRjaChlcnIgPT4gewoJCQkJCQlxdWV1ZS5jbGVhcigpCgkJCQkJCWFsZXJ0KCdEb3dubG9hZCBlcnJvcicpCgkJCQkJfSkKCQkJfSkKCQkJcHMucHVzaChwKQoJCX0KCQlhd2FpdCBQcm9taXNlLmFsbChwcykKCQlyZXR1cm4gZGF0YQoJfQoKCWNvbnN0IGZmV29ya2VyID0gRkZtcGVnLmNyZWF0ZVdvcmtlcih7CgkJbG9nZ2VyOiBERUJVRyA/IG0gPT4gbG9nZ2VyLmxvZyhtLm1lc3NhZ2UpIDogKCkgPT4ge30KCX0pCglsZXQgZmZXb3JrZXJMb2FkZWQgPSBmYWxzZQoJY29uc3QgbWVyZ2VWaWRlbyA9IGFzeW5jICh2aWRlbywgYXVkaW8pID0+IHsKCQlpZiAoIWZmV29ya2VyTG9hZGVkKSBhd2FpdCBmZldvcmtlci5sb2FkKCkKCQlhd2FpdCBmZldvcmtlci53cml0ZSgndmlkZW8ubXA0JywgdmlkZW8pCgkJYXdhaXQgZmZXb3JrZXIud3JpdGUoJ2F1ZGlvLm1wNCcsIGF1ZGlvKQoJCWF3YWl0IGZmV29ya2VyLnJ1bignLWkgdmlkZW8ubXA0IC1pIGF1ZGlvLm1wNCAtYyBjb3B5IG91dHB1dC5tcDQnLCB7CgkJCWlucHV0OiBbJ3ZpZGVvLm1wNCcsICdhdWRpby5tcDQnXSwKCQkJb3V0cHV0OiAnb3V0cHV0Lm1wNCcKCQl9KQoJCWNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgZmZXb3JrZXIucmVhZCgnb3V0cHV0Lm1wNCcpCgkJYXdhaXQgZmZXb3JrZXIucmVtb3ZlKCdvdXRwdXQubXA0JykKCQlyZXR1cm4gZGF0YQoJfQoJY29uc3QgdHJpZ2dlckRvd25sb2FkID0gKHVybCwgZmlsZW5hbWUpID0+IHsKCQljb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpCgkJYS5ocmVmID0gdXJsCgkJYS5kb3dubG9hZCA9IGZpbGVuYW1lCgkJZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKQoJCWEuY2xpY2soKQoJCWEucmVtb3ZlKCkKCX0KCWNvbnN0IGRsTW9kYWxUZW1wbGF0ZSA9IGAKPGRpdiBzdHlsZT0id2lkdGg6IDEwMCU7IGhlaWdodDogMTAwJTsiPgoJPGRpdiB2LWlmPSJtZXJnaW5nIiBzdHlsZT0iaGVpZ2h0OiAxMDAlOyB3aWR0aDogMTAwJTsgZGlzcGxheTogZmxleDsganVzdGlmeS1jb250ZW50OiBjZW50ZXI7IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGZvbnQtc2l6ZTogMjRweDsiPk1lcmdpbmcgdmlkZW8sIHBsZWFzZSB3YWl0Li4uPC9kaXY+Cgk8ZGl2IHYtZWxzZSBzdHlsZT0iaGVpZ2h0OiAxMDAlOyB3aWR0aDogMTAwJTsgZGlzcGxheTogZmxleDsgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsiPgogCQk8ZGl2IHN0eWxlPSJmbGV4OiAxOyBtYXJnaW46IDEwcHg7Ij4KCQkJPHAgc3R5bGU9ImZvbnQtc2l6ZTogMjRweDsiPlZpZGVvPC9wPgoJCQk8cHJvZ3Jlc3Mgc3R5bGU9IndpZHRoOiAxMDAlOyIgOnZhbHVlPSJ2aWRlby5wcm9ncmVzcyIgbWluPSIwIiBtYXg9IjEwMCI+PC9wcm9ncmVzcz4KCQkJPGRpdiBzdHlsZT0iZGlzcGxheTogZmxleDsganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOyI+CgkJCQk8c3Bhbj57e3ZpZGVvLnNwZWVkfX0ga0Ivczwvc3Bhbj4KCQkJCTxzcGFuPnt7dmlkZW8ubG9hZGVkfX0ve3t2aWRlby50b3RhbH19IE1CPC9zcGFuPgoJCQk8L2Rpdj4KCQk8L2Rpdj4KCQk8ZGl2IHN0eWxlPSJmbGV4OiAxOyBtYXJnaW46IDEwcHg7Ij4KCQkJPHAgc3R5bGU9ImZvbnQtc2l6ZTogMjRweDsiPkF1ZGlvPC9wPgoJCQk8cHJvZ3Jlc3Mgc3R5bGU9IndpZHRoOiAxMDAlOyIgOnZhbHVlPSJhdWRpby5wcm9ncmVzcyIgbWluPSIwIiBtYXg9IjEwMCI+PC9wcm9ncmVzcz4KCQkJPGRpdiBzdHlsZT0iZGlzcGxheTogZmxleDsganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOyI+CgkJCQk8c3Bhbj57e2F1ZGlvLnNwZWVkfX0ga0Ivczwvc3Bhbj4KCQkJCTxzcGFuPnt7YXVkaW8ubG9hZGVkfX0ve3thdWRpby50b3RhbH19IE1CPC9zcGFuPgoJCQk8L2Rpdj4KCQk8L2Rpdj4KCTwvZGl2Pgo8L2Rpdj4KYAoJZnVuY3Rpb24gb3BlbkRvd25sb2FkTW9kZWwoYWRhcHRpdmUsIHRpdGxlKSB7CgkJY29uc3Qgd2luID0gb3BlbigKCQkJJycsCgkJCSdWaWRlbyBEb3dubG9hZCcsCgkJCWB0b29sYmFyPW5vLGhlaWdodD0ke3NjcmVlbi5oZWlnaHQgLyAyfSx3aWR0aD0ke3NjcmVlbi53aWR0aCAvIDJ9LGxlZnQ9JHtzY3JlZW5MZWZ0fSx0b3A9JHtzY3JlZW5Ub3B9YAoJCSkKCQljb25zdCBkaXYgPSB3aW4uZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykKCQl3aW4uZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChkaXYpCgkJd2luLmRvY3VtZW50LnRpdGxlID0gYERvd25sb2FkaW5nICIke3RpdGxlfSJgCgkJY29uc3QgZGxNb2RhbEFwcCA9IG5ldyBWdWUoewoJCQl0ZW1wbGF0ZTogZGxNb2RhbFRlbXBsYXRlLAoJCQlkYXRhKCkgewoJCQkJcmV0dXJuIHsKCQkJCQl2aWRlbzogewoJCQkJCQlwcm9ncmVzczogMCwKCQkJCQkJdG90YWw6IDAsCgkJCQkJCWxvYWRlZDogMCwKCQkJCQkJc3BlZWQ6IDAKCQkJCQl9LAoJCQkJCWF1ZGlvOiB7CgkJCQkJCXByb2dyZXNzOiAwLAoJCQkJCQl0b3RhbDogMCwKCQkJCQkJbG9hZGVkOiAwLAoJCQkJCQlzcGVlZDogMAoJCQkJCX0sCgkJCQkJbWVyZ2luZzogZmFsc2UKCQkJCX0KCQkJfSwKCQkJbWV0aG9kczogewoJCQkJYXN5bmMgc3RhcnQoYWRhcHRpdmUsIHRpdGxlKSB7CgkJCQkJd2luLm9uYmVmb3JldW5sb2FkID0gKCkgPT4gdHJ1ZQoJCQkJCS8vIFlvdVR1YmUncyBkZWZhdWx0IG9yZGVyIGlzIGRlc2NlbmRpbmcgYnkgdmlkZW8gcXVhbGl0eQoJCQkJCWNvbnN0IHZpZGVvT2JqID0gYWRhcHRpdmUKCQkJCQkJLmZpbHRlcih4ID0+IHgubWltZVR5cGUuaW5jbHVkZXMoJ3ZpZGVvL21wNCcpIHx8IHgubWltZVR5cGUuaW5jbHVkZXMoJ3ZpZGVvL3dlYm0nKSkKCQkJCQkJLm1hcCh2ID0+IHsKCQkJCQkJCWNvbnN0IFtfLCBxdWFsaXR5LCBmcHNdID0gLyhcZCspcChcZCopLy5leGVjKHYucXVhbGl0eUxhYmVsKQoJCQkJCQkJdi5xdWFsaXR5TnVtID0gcGFyc2VJbnQocXVhbGl0eSkKCQkJCQkJCXYuZnBzID0gZnBzID8gcGFyc2VJbnQoZnBzKSA6IDMwCgkJCQkJCQlyZXR1cm4gdgoJCQkJCQl9KQoJCQkJCQkuc29ydCgoYSwgYikgPT4gewoJCQkJCQkJaWYgKGEucXVhbGl0eU51bSA9PT0gYi5xdWFsaXR5TnVtKSByZXR1cm4gYi5mcHMgLSBhLmZwcyAvLyBleDogMzAtNjA9LTMwLCB0aGVuIGEgd2lsbCBiZSBwdXQgYmVmb3JlIGIKCQkJCQkJCXJldHVybiBiLnF1YWxpdHlOdW0gLSBhLnF1YWxpdHlOdW0KCQkJCQkJfSlbMF0KCQkJCQljb25zdCBhdWRpb09iaiA9IGFkYXB0aXZlLmZpbmQoeCA9PiB4Lm1pbWVUeXBlLmluY2x1ZGVzKCdhdWRpby9tcDQnKSkKCQkJCQljb25zdCB2UHJvbWlzZSA9IHhockRvd25sb2FkVWludDhBcnJheSh2aWRlb09iaiwgZSA9PiB7CgkJCQkJCXRoaXMudmlkZW8ucHJvZ3Jlc3MgPSAoZS5sb2FkZWQgLyBlLnRvdGFsKSAqIDEwMAoJCQkJCQl0aGlzLnZpZGVvLmxvYWRlZCA9IChlLmxvYWRlZCAvIDEwMjQgLyAxMDI0KS50b0ZpeGVkKDIpCgkJCQkJCXRoaXMudmlkZW8udG90YWwgPSAoZS50b3RhbCAvIDEwMjQgLyAxMDI0KS50b0ZpeGVkKDIpCgkJCQkJCXRoaXMudmlkZW8uc3BlZWQgPSAoZS5zcGVlZCAvIDEwMjQpLnRvRml4ZWQoMikKCQkJCQl9KQoJCQkJCWNvbnN0IGFQcm9taXNlID0geGhyRG93bmxvYWRVaW50OEFycmF5KGF1ZGlvT2JqLCBlID0+IHsKCQkJCQkJdGhpcy5hdWRpby5wcm9ncmVzcyA9IChlLmxvYWRlZCAvIGUudG90YWwpICogMTAwCgkJCQkJCXRoaXMuYXVkaW8ubG9hZGVkID0gKGUubG9hZGVkIC8gMTAyNCAvIDEwMjQpLnRvRml4ZWQoMikKCQkJCQkJdGhpcy5hdWRpby50b3RhbCA9IChlLnRvdGFsIC8gMTAyNCAvIDEwMjQpLnRvRml4ZWQoMikKCQkJCQkJdGhpcy5hdWRpby5zcGVlZCA9IChlLnNwZWVkIC8gMTAyNCkudG9GaXhlZCgyKQoJCQkJCX0pCgkJCQkJY29uc3QgW3ZhcnIsIGFhcnJdID0gYXdhaXQgUHJvbWlzZS5hbGwoW3ZQcm9taXNlLCBhUHJvbWlzZV0pCgkJCQkJdGhpcy5tZXJnaW5nID0gdHJ1ZQoJCQkJCXdpbi5vbnVubG9hZCA9ICgpID0+IHsKCQkJCQkJLy8gdHJpZ2dlciBkb3dubG9hZCB3aGVuIHVzZXIgY2xvc2UgaXQKCQkJCQkJY29uc3QgYnZ1cmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKG5ldyBCbG9iKFt2YXJyXSkpCgkJCQkJCWNvbnN0IGJhdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChuZXcgQmxvYihbYWFycl0pKQoJCQkJCQl0cmlnZ2VyRG93bmxvYWQoYnZ1cmwsIHRpdGxlICsgJy12aWRlb29ubHkubXA0JykKCQkJCQkJdHJpZ2dlckRvd25sb2FkKGJhdXJsLCB0aXRsZSArICctYXVkaW9vbmx5Lm1wNCcpCgkJCQkJfQoJCQkJCWNvbnN0IHJlc3VsdCA9IGF3YWl0IFByb21pc2UucmFjZShbbWVyZ2VWaWRlbyh2YXJyLCBhYXJyKSwgc2xlZXAoMTAwMCAqIDI1KS50aGVuKCgpID0+IG51bGwpXSkKCQkJCQlpZiAoIXJlc3VsdCkgewoJCQkJCQlhbGVydCgnQW4gZXJyb3IgaGFzIG9jY3VycmVkIHdoZW4gbWVyZ2luZyB2aWRlbycpCgkJCQkJCWNvbnN0IGJ2dXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChuZXcgQmxvYihbdmFycl0pKQoJCQkJCQljb25zdCBiYXVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwobmV3IEJsb2IoW2FhcnJdKSkKCQkJCQkJdHJpZ2dlckRvd25sb2FkKGJ2dXJsLCB0aXRsZSArICctdmlkZW9vbmx5Lm1wNCcpCgkJCQkJCXRyaWdnZXJEb3dubG9hZChiYXVybCwgdGl0bGUgKyAnLWF1ZGlvb25seS5tcDQnKQoJCQkJCQlyZXR1cm4gdGhpcy5jbG9zZSgpCgkJCQkJfQoJCQkJCXRoaXMubWVyZ2luZyA9IGZhbHNlCgkJCQkJY29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChuZXcgQmxvYihbcmVzdWx0XSkpCgkJCQkJdHJpZ2dlckRvd25sb2FkKHVybCwgdGl0bGUgKyAnLm1wNCcpCgkJCQkJd2luLm9uYmVmb3JldW5sb2FkID0gbnVsbAoJCQkJCXdpbi5vbnVubG9hZCA9IG51bGwKCQkJCQl3aW4uY2xvc2UoKQoJCQkJfQoJCQl9CgkJfSkuJG1vdW50KGRpdikKCQlkbE1vZGFsQXBwLnN0YXJ0KGFkYXB0aXZlLCB0aXRsZSkKCX0KCgljb25zdCB0ZW1wbGF0ZSA9IGAKPGRpdiBjbGFzcz0iYm94IiA6Y2xhc3M9InsnZGFyayc6ZGFya30iPgogIDx0ZW1wbGF0ZSB2LWlmPSIhaXNMaXZlU3RyZWFtIj4KICAgIDxkaXYgdi1pZj0iYWRhcHRpdmUubGVuZ3RoIiBjbGFzcz0ib2YtaCB0LWNlbnRlciBjLXBvaW50ZXIgbGgtMjAiPgogICAgICA8YSBjbGFzcz0iZnMtMTRweCIgQGNsaWNrPSJkbG1wNCIgdi10ZXh0PSJzdHJpbmdzLmRsbXA0Ij48L2E+CiAgICA8L2Rpdj4KICAgIDxkaXYgQGNsaWNrPSJoaWRlPSFoaWRlIiBjbGFzcz0iYm94LXRvZ2dsZSBkaXYtYSB0LWNlbnRlciBmcy0xNHB4IGMtcG9pbnRlciBsaC0yMCIgdi10ZXh0PSJzdHJpbmdzLnRvZ2dsZWxpbmtzIj48L2Rpdj4KICAgIDxkaXYgOmNsYXNzPSJ7J2hpZGUnOmhpZGV9Ij4KICAgICAgPGRpdiBjbGFzcz0idC1jZW50ZXIgZnMtMTRweCIgdi10ZXh0PSJzdHJpbmdzLnZpZGVvaWQraWQiPjwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJkLWZsZXgiPgogICAgICAgIDxkaXYgY2xhc3M9ImYtMSBvZi1oIj4KICAgICAgICAgIDxkaXYgY2xhc3M9InQtY2VudGVyIGZzLTE0cHgiIHYtdGV4dD0ic3RyaW5ncy5zdHJlYW0iPjwvZGl2PgogICAgICAgICAgPGEgY2xhc3M9Inl0ZGwtbGluay1idG4gZnMtMTRweCIgdGFyZ2V0PSJfYmxhbmsiIHYtZm9yPSJ2aWQgaW4gc3RyZWFtIiA6aHJlZj0idmlkLnVybCIgOnRpdGxlPSJ2aWQudHlwZSIgdi10ZXh0PSJmb3JtYXRTdHJlYW1UZXh0KHZpZCkiPjwvYT4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJmLTEgb2YtaCI+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJ0LWNlbnRlciBmcy0xNHB4IiB2LXRleHQ9InN0cmluZ3MuYWRhcHRpdmUiPjwvZGl2PgogICAgICAgICAgPGEgY2xhc3M9Inl0ZGwtbGluay1idG4gZnMtMTRweCIgdGFyZ2V0PSJfYmxhbmsiIHYtZm9yPSJ2aWQgaW4gYWRhcHRpdmUiIDpocmVmPSJ2aWQudXJsIiA6dGl0bGU9InZpZC50eXBlIiB2LXRleHQ9ImZvcm1hdEFkYXB0aXZlVGV4dCh2aWQpIj48L2E+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJvZi1oIHQtY2VudGVyIj4KICAgICAgICA8YSBjbGFzcz0iZnMtMTRweCIgaHJlZj0iaHR0cHM6Ly9tYXBsZTMxNDIuZ2l0aHViLmlvL21lcmdlbXA0LyIgdGFyZ2V0PSJfYmxhbmsiIHYtdGV4dD0ic3RyaW5ncy5pbmJyb3dzZXJfYWRhcHRpdmVfbWVyZ2VyIj48L2E+CiAgICAgIDwvZGl2PgogICAgPC9kaXY+CiAgPC90ZW1wbGF0ZT4KICA8dGVtcGxhdGUgdi1lbHNlPgogICAgPGRpdiBjbGFzcz0idC1jZW50ZXIgZnMtMTRweCBsaC0yMCIgdi10ZXh0PSJzdHJpbmdzLmxpdmVfc3RyZWFtX2Rpc2FibGVkX21lc3NhZ2UiPjwvZGl2PgogIDwvdGVtcGxhdGU+CjwvZGl2PgpgLnNsaWNlKDEpCgljb25zdCBhcHAgPSBuZXcgVnVlKHsKCQlkYXRhKCkgewoJCQlyZXR1cm4gewoJCQkJaGlkZTogdHJ1ZSwKCQkJCWlkOiAnJywKCQkJCWlzTGl2ZVN0cmVhbTogZmFsc2UsCgkJCQlzdHJlYW06IFtdLAoJCQkJYWRhcHRpdmU6IFtdLAoJCQkJZGV0YWlsczogbnVsbCwKCQkJCWRhcms6IGZhbHNlLAoJCQkJbGFuZzogZmluZExhbmcoZ2V0TGFuZ0NvZGUoKSkKCQkJfQoJCX0sCgkJY29tcHV0ZWQ6IHsKCQkJc3RyaW5ncygpIHsKCQkJCXJldHVybiBMT0NBTEVbdGhpcy5sYW5nLnRvTG93ZXJDYXNlKCldCgkJCX0KCQl9LAoJCW1ldGhvZHM6IHsKCQkJZGxtcDQoKSB7CgkJCQlvcGVuRG93bmxvYWRNb2RlbCh0aGlzLmFkYXB0aXZlLCB0aGlzLmRldGFpbHMudGl0bGUpCgkJCX0sCgkJCWZvcm1hdFN0cmVhbVRleHQodmlkKSB7CgkJCQlyZXR1cm4gW3ZpZC5xdWFsaXR5TGFiZWwsIHZpZC5xdWFsaXR5XS5maWx0ZXIoeCA9PiB4KS5qb2luKCc6ICcpCgkJCX0sCgkJCWZvcm1hdEFkYXB0aXZlVGV4dCh2aWQpIHsKCQkJCWxldCBzdHIgPSBbdmlkLnF1YWxpdHlMYWJlbCwgdmlkLm1pbWVUeXBlXS5maWx0ZXIoeCA9PiB4KS5qb2luKCc6ICcpCgkJCQlpZiAodmlkLm1pbWVUeXBlLmluY2x1ZGVzKCdhdWRpbycpKSB7CgkJCQkJc3RyICs9IGAgJHtNYXRoLnJvdW5kKHZpZC5iaXRyYXRlIC8gMTAwMCl9a2Jwc2AKCQkJCX0KCQkJCXJldHVybiBzdHIKCQkJfQoJCX0sCgkJdGVtcGxhdGUKCX0pCglsb2dnZXIubG9nKGBkZWZhdWx0IGxhbmd1YWdlOiAlc2AsIGFwcC5sYW5nKQoKCS8vIGF0dGFjaCBlbGVtZW50Cgljb25zdCBzaGFkb3dIb3N0ID0gJGVsKCdkaXYnKQoJY29uc3Qgc2hhZG93ID0gc2hhZG93SG9zdC5hdHRhY2hTaGFkb3cgPyBzaGFkb3dIb3N0LmF0dGFjaFNoYWRvdyh7IG1vZGU6ICdjbG9zZWQnIH0pIDogc2hhZG93SG9zdCAvLyBubyBzaGFkb3cgZG9tCglsb2dnZXIubG9nKCdzaGFkb3dIb3N0OiAlbycsIHNoYWRvd0hvc3QpCgljb25zdCBjb250YWluZXIgPSAkZWwoJ2RpdicpCglzaGFkb3cuYXBwZW5kQ2hpbGQoY29udGFpbmVyKQoJYXBwLiRtb3VudChjb250YWluZXIpCgoJaWYgKERFQlVHICYmIHR5cGVvZiB1bnNhZmVXaW5kb3cgIT09ICd1bmRlZmluZWQnKSB7CgkJLy8gZXhwb3NlIHNvbWUgZnVuY3Rpb25zIGZvciBkZWJ1Z2dpbmcKCQl1bnNhZmVXaW5kb3cuJGFwcCA9IGFwcAoJCXVuc2FmZVdpbmRvdy5wYXJzZVF1ZXJ5ID0gcGFyc2VRdWVyeQoJCXVuc2FmZVdpbmRvdy5wYXJzZURlY3NpZyA9IHBhcnNlRGVjc2lnCgkJdW5zYWZlV2luZG93LnBhcnNlUmVzcG9uc2UgPSBwYXJzZVJlc3BvbnNlCgl9Cgljb25zdCBsb2FkID0gYXN5bmMgcGxheWVyUmVzcG9uc2UgPT4gewoJCXRyeSB7CgkJCWNvbnN0IGJhc2VqcyA9CgkJCQkodHlwZW9mIHl0cGxheWVyICE9PSAndW5kZWZpbmVkJyAmJiAnY29uZmlnJyBpbiB5dHBsYXllciAmJiB5dHBsYXllci5jb25maWcuYXNzZXRzCgkJCQkJPyAnaHR0cHM6Ly8nICsgbG9jYXRpb24uaG9zdCArIHl0cGxheWVyLmNvbmZpZy5hc3NldHMuanMKCQkJCQk6ICd3ZWJfcGxheWVyX2NvbnRleHRfY29uZmlnJyBpbiB5dHBsYXllcgoJCQkJCT8gJ2h0dHBzOi8vJyArIGxvY2F0aW9uLmhvc3QgKyB5dHBsYXllci53ZWJfcGxheWVyX2NvbnRleHRfY29uZmlnLmpzVXJsCgkJCQkJOiBudWxsKSB8fCAkKCdzY3JpcHRbc3JjJD0iYmFzZS5qcyJdJykuc3JjCgkJCWNvbnN0IGRlY3NpZyA9IGF3YWl0IHhmLmdldChiYXNlanMpLnRleHQocGFyc2VEZWNzaWcpCgkJCWNvbnN0IGlkID0gcGFyc2VRdWVyeShsb2NhdGlvbi5zZWFyY2gpLnYKCQkJY29uc3QgZGF0YSA9IHBhcnNlUmVzcG9uc2UoaWQsIHBsYXllclJlc3BvbnNlLCBkZWNzaWcpCgkJCWxvZ2dlci5sb2coJ3ZpZGVvIGxvYWRlZDogJXMnLCBpZCkKCQkJYXBwLmlzTGl2ZVN0cmVhbSA9IGRhdGEucGxheWVyUmVzcG9uc2UucGxheWFiaWxpdHlTdGF0dXMubGl2ZVN0cmVhbWFiaWxpdHkgIT0gbnVsbAoJCQlhcHAuaWQgPSBpZAoJCQlhcHAuc3RyZWFtID0gZGF0YS5zdHJlYW0KCQkJYXBwLmFkYXB0aXZlID0gZGF0YS5hZGFwdGl2ZQoJCQlhcHAuZGV0YWlscyA9IGRhdGEuZGV0YWlscwoKCQkJY29uc3QgYWN0TGFuZyA9IGdldExhbmdDb2RlKCkKCQkJaWYgKGFjdExhbmcgIT0gbnVsbCkgewoJCQkJY29uc3QgbGFuZyA9IGZpbmRMYW5nKGFjdExhbmcpCgkJCQlsb2dnZXIubG9nKCd5b3V0dWJlIHVpIGxhbmc6ICVzJywgYWN0TGFuZykKCQkJCWxvZ2dlci5sb2coJ3l0ZGwgbGFuZzonLCBsYW5nKQoJCQkJYXBwLmxhbmcgPSBsYW5nCgkJCX0KCQl9IGNhdGNoIChlcnIpIHsKCQkJYWxlcnQoYXBwLnN0cmluZ3MuZ2V0X3ZpZGVvX2ZhaWxlZCkKCQkJbG9nZ2VyLmVycm9yKCdsb2FkJywgZXJyKQoJCX0KCX0KCgkvLyBob29rIGZldGNoIHJlc3BvbnNlCgljb25zdCBmZiA9IGZldGNoCgl1bnNhZmVXaW5kb3cuZmV0Y2ggPSAoLi4uYXJncykgPT4gewoJCWlmIChhcmdzWzBdIGluc3RhbmNlb2YgUmVxdWVzdCkgewoJCQlyZXR1cm4gZmYoLi4uYXJncykudGhlbihyZXNwID0+IHsKCQkJCWlmIChyZXNwLnVybC5pbmNsdWRlcygncGxheWVyJykpIHsKCQkJCQlyZXNwLmNsb25lKCkuanNvbigpLnRoZW4obG9hZCkKCQkJCX0KCQkJCXJldHVybiByZXNwCgkJCX0pCgkJfQoJCXJldHVybiBmZiguLi5hcmdzKQoJfQoKCS8vIGF0dGFjaCBlbGVtZW50Cgljb25zdCBpdCA9IHNldEludGVydmFsKCgpID0+IHsKCQljb25zdCBlbCA9CgkJCSQoJ3l0ZC13YXRjaC1tZXRhZGF0YScpIHx8CgkJCSQoJyNpbmZvLWNvbnRlbnRzJykgfHwKCQkJJCgnI3dhdGNoLWhlYWRlcicpIHx8CgkJCSQoJy5wYWdlLWNvbnRhaW5lcjpub3QoW2hpZGRlbl0pIHl0bS1pdGVtLXNlY3Rpb24tcmVuZGVyZXI+bGF6eS1saXN0JykKCQlpZiAoZWwgJiYgIWVsLmNvbnRhaW5zKHNoYWRvd0hvc3QpKSB7CgkJCWVsLmFwcGVuZENoaWxkKHNoYWRvd0hvc3QpCgkJCWNsZWFySW50ZXJ2YWwoaXQpCgkJfQoJfSwgMTAwKQoKCS8vIGluaXQKCXVuc2FmZVdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgKCkgPT4gewoJCWNvbnN0IGZpcnN0UmVzcCA9IHVuc2FmZVdpbmRvdz8ueXRwbGF5ZXI/LmNvbmZpZz8uYXJncz8ucmF3X3BsYXllcl9yZXNwb25zZQoJCWlmIChmaXJzdFJlc3ApIHsKCQkJbG9hZChmaXJzdFJlc3ApCgkJfQoJfSkKCgkvLyBsaXN0ZW4gdG8gZGFyayBtb2RlIHRvZ2dsZQoJY29uc3QgJGh0bWwgPSAkKCdodG1sJykKCW5ldyBNdXRhdGlvbk9ic2VydmVyKCgpID0+IHsKCQlhcHAuZGFyayA9ICRodG1sLmdldEF0dHJpYnV0ZSgnZGFyaycpICE9PSBudWxsCgl9KS5vYnNlcnZlKCRodG1sLCB7IGF0dHJpYnV0ZXM6IHRydWUgfSkKCWFwcC5kYXJrID0gJGh0bWwuZ2V0QXR0cmlidXRlKCdkYXJrJykgIT09IG51bGwKCgljb25zdCBjc3MgPSBgCi5oaWRlewoJZGlzcGxheTogbm9uZTsKfQoudC1jZW50ZXJ7Cgl0ZXh0LWFsaWduOiBjZW50ZXI7Cn0KLmQtZmxleHsKCWRpc3BsYXk6IGZsZXg7Cn0KLmYtMXsKCWZsZXg6IDE7Cn0KLmZzLTE0cHh7Cglmb250LXNpemU6IDE0cHg7Cn0KLm9mLWh7CglvdmVyZmxvdzogaGlkZGVuOwp9Ci5ib3h7CiAgcGFkZGluZy10b3A6IC41ZW07CiAgcGFkZGluZy1ib3R0b206IC41ZW07Cglib3JkZXItYm90dG9tOiAxcHggc29saWQgdmFyKC0teXQtYm9yZGVyLWNvbG9yKTsKCWZvbnQtZmFtaWx5OiBBcmlhbDsKfQouYm94LXRvZ2dsZXsKCW1hcmdpbjogM3B4OwoJdXNlci1zZWxlY3Q6IG5vbmU7CgktbW96LXVzZXItc2VsZWN0OiAtbW96LW5vbmU7Cn0KLnl0ZGwtbGluay1idG57CglkaXNwbGF5OiBibG9jazsKCWJvcmRlcjogMXB4IHNvbGlkICFpbXBvcnRhbnQ7Cglib3JkZXItcmFkaXVzOiAzcHg7Cgl0ZXh0LWRlY29yYXRpb246IG5vbmUgIWltcG9ydGFudDsKCW91dGxpbmU6IDA7Cgl0ZXh0LWFsaWduOiBjZW50ZXI7CglwYWRkaW5nOiAycHg7CgltYXJnaW46IDVweDsKCWNvbG9yOiBibGFjazsKfQphLCAuZGl2LWF7Cgl0ZXh0LWRlY29yYXRpb246IG5vbmU7Cgljb2xvcjogdmFyKC0teXQtYnV0dG9uLWNvbG9yLCBpbmhlcml0KTsKfQphOmhvdmVyLCAuZGl2LWE6aG92ZXJ7Cgljb2xvcjogdmFyKC0teXQtc3BlYy1jYWxsLXRvLWFjdGlvbiwgYmx1ZSk7Cn0KLmJveC5kYXJrewoJY29sb3I6IHZhcigtLXl0LWVuZHBvaW50LWNvbG9yLCB2YXIoLS15dC1zcGVjLXRleHQtcHJpbWFyeSkpOwp9Ci5ib3guZGFyayAueXRkbC1saW5rLWJ0bnsKCWNvbG9yOiB2YXIoLS15dC1lbmRwb2ludC1jb2xvciwgdmFyKC0teXQtc3BlYy10ZXh0LXByaW1hcnkpKTsKfQouYm94LmRhcmsgLnl0ZGwtbGluay1idG46aG92ZXJ7Cgljb2xvcjogcmdiYSgyMDAsIDIwMCwgMjU1LCAwLjgpOwp9Ci5ib3guZGFyayAuYm94LXRvZ2dsZTpob3ZlcnsKCWNvbG9yOiByZ2JhKDIwMCwgMjAwLCAyNTUsIDAuOCk7Cn0KLmMtcG9pbnRlcnsKCWN1cnNvcjogcG9pbnRlcjsKfQoubGgtMjB7CglsaW5lLWhlaWdodDogMjBweDsKfQpgCglzaGFkb3cuYXBwZW5kQ2hpbGQoJGVsKCdzdHlsZScsIHsgdGV4dENvbnRlbnQ6IGNzcyB9KSkKfSkoKQo=","requires":[{"meta":{"name":"vue.js","url":"https://unpkg.com/vue@2.6.10/dist/vue.js","ts":1698548178657,"mimetype":"text/javascript"},"source":"LyohCiAqIFZ1ZS5qcyB2Mi42LjEwCiAqIChjKSAyMDE0LTIwMTkgRXZhbiBZb3UKICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLgogKi8KKGZ1bmN0aW9uIChnbG9iYWwsIGZhY3RvcnkpIHsKICB0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgPyBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKSA6CiAgdHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kID8gZGVmaW5lKGZhY3RvcnkpIDoKICAoZ2xvYmFsID0gZ2xvYmFsIHx8IHNlbGYsIGdsb2JhbC5WdWUgPSBmYWN0b3J5KCkpOwp9KHRoaXMsIGZ1bmN0aW9uICgpIHsgJ3VzZSBzdHJpY3QnOwoKICAvKiAgKi8KCiAgdmFyIGVtcHR5T2JqZWN0ID0gT2JqZWN0LmZyZWV6ZSh7fSk7CgogIC8vIFRoZXNlIGhlbHBlcnMgcHJvZHVjZSBiZXR0ZXIgVk0gY29kZSBpbiBKUyBlbmdpbmVzIGR1ZSB0byB0aGVpcgogIC8vIGV4cGxpY2l0bmVzcyBhbmQgZnVuY3Rpb24gaW5saW5pbmcuCiAgZnVuY3Rpb24gaXNVbmRlZiAodikgewogICAgcmV0dXJuIHYgPT09IHVuZGVmaW5lZCB8fCB2ID09PSBudWxsCiAgfQoKICBmdW5jdGlvbiBpc0RlZiAodikgewogICAgcmV0dXJuIHYgIT09IHVuZGVmaW5lZCAmJiB2ICE9PSBudWxsCiAgfQoKICBmdW5jdGlvbiBpc1RydWUgKHYpIHsKICAgIHJldHVybiB2ID09PSB0cnVlCiAgfQoKICBmdW5jdGlvbiBpc0ZhbHNlICh2KSB7CiAgICByZXR1cm4gdiA9PT0gZmFsc2UKICB9CgogIC8qKgogICAqIENoZWNrIGlmIHZhbHVlIGlzIHByaW1pdGl2ZS4KICAgKi8KICBmdW5jdGlvbiBpc1ByaW1pdGl2ZSAodmFsdWUpIHsKICAgIHJldHVybiAoCiAgICAgIHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgfHwKICAgICAgdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyB8fAogICAgICAvLyAkZmxvdy1kaXNhYmxlLWxpbmUKICAgICAgdHlwZW9mIHZhbHVlID09PSAnc3ltYm9sJyB8fAogICAgICB0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJwogICAgKQogIH0KCiAgLyoqCiAgICogUXVpY2sgb2JqZWN0IGNoZWNrIC0gdGhpcyBpcyBwcmltYXJpbHkgdXNlZCB0byB0ZWxsCiAgICogT2JqZWN0cyBmcm9tIHByaW1pdGl2ZSB2YWx1ZXMgd2hlbiB3ZSBrbm93IHRoZSB2YWx1ZQogICAqIGlzIGEgSlNPTi1jb21wbGlhbnQgdHlwZS4KICAgKi8KICBmdW5jdGlvbiBpc09iamVjdCAob2JqKSB7CiAgICByZXR1cm4gb2JqICE9PSBudWxsICYmIHR5cGVvZiBvYmogPT09ICdvYmplY3QnCiAgfQoKICAvKioKICAgKiBHZXQgdGhlIHJhdyB0eXBlIHN0cmluZyBvZiBhIHZhbHVlLCBlLmcuLCBbb2JqZWN0IE9iamVjdF0uCiAgICovCiAgdmFyIF90b1N0cmluZyA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmc7CgogIGZ1bmN0aW9uIHRvUmF3VHlwZSAodmFsdWUpIHsKICAgIHJldHVybiBfdG9TdHJpbmcuY2FsbCh2YWx1ZSkuc2xpY2UoOCwgLTEpCiAgfQoKICAvKioKICAgKiBTdHJpY3Qgb2JqZWN0IHR5cGUgY2hlY2suIE9ubHkgcmV0dXJucyB0cnVlCiAgICogZm9yIHBsYWluIEphdmFTY3JpcHQgb2JqZWN0cy4KICAgKi8KICBmdW5jdGlvbiBpc1BsYWluT2JqZWN0IChvYmopIHsKICAgIHJldHVybiBfdG9TdHJpbmcuY2FsbChvYmopID09PSAnW29iamVjdCBPYmplY3RdJwogIH0KCiAgZnVuY3Rpb24gaXNSZWdFeHAgKHYpIHsKICAgIHJldHVybiBfdG9TdHJpbmcuY2FsbCh2KSA9PT0gJ1tvYmplY3QgUmVnRXhwXScKICB9CgogIC8qKgogICAqIENoZWNrIGlmIHZhbCBpcyBhIHZhbGlkIGFycmF5IGluZGV4LgogICAqLwogIGZ1bmN0aW9uIGlzVmFsaWRBcnJheUluZGV4ICh2YWwpIHsKICAgIHZhciBuID0gcGFyc2VGbG9hdChTdHJpbmcodmFsKSk7CiAgICByZXR1cm4gbiA+PSAwICYmIE1hdGguZmxvb3IobikgPT09IG4gJiYgaXNGaW5pdGUodmFsKQogIH0KCiAgZnVuY3Rpb24gaXNQcm9taXNlICh2YWwpIHsKICAgIHJldHVybiAoCiAgICAgIGlzRGVmKHZhbCkgJiYKICAgICAgdHlwZW9mIHZhbC50aGVuID09PSAnZnVuY3Rpb24nICYmCiAgICAgIHR5cGVvZiB2YWwuY2F0Y2ggPT09ICdmdW5jdGlvbicKICAgICkKICB9CgogIC8qKgogICAqIENvbnZlcnQgYSB2YWx1ZSB0byBhIHN0cmluZyB0aGF0IGlzIGFjdHVhbGx5IHJlbmRlcmVkLgogICAqLwogIGZ1bmN0aW9uIHRvU3RyaW5nICh2YWwpIHsKICAgIHJldHVybiB2YWwgPT0gbnVsbAogICAgICA/ICcnCiAgICAgIDogQXJyYXkuaXNBcnJheSh2YWwpIHx8IChpc1BsYWluT2JqZWN0KHZhbCkgJiYgdmFsLnRvU3RyaW5nID09PSBfdG9TdHJpbmcpCiAgICAgICAgPyBKU09OLnN0cmluZ2lmeSh2YWwsIG51bGwsIDIpCiAgICAgICAgOiBTdHJpbmcodmFsKQogIH0KCiAgLyoqCiAgICogQ29udmVydCBhbiBpbnB1dCB2YWx1ZSB0byBhIG51bWJlciBmb3IgcGVyc2lzdGVuY2UuCiAgICogSWYgdGhlIGNvbnZlcnNpb24gZmFpbHMsIHJldHVybiBvcmlnaW5hbCBzdHJpbmcuCiAgICovCiAgZnVuY3Rpb24gdG9OdW1iZXIgKHZhbCkgewogICAgdmFyIG4gPSBwYXJzZUZsb2F0KHZhbCk7CiAgICByZXR1cm4gaXNOYU4obikgPyB2YWwgOiBuCiAgfQoKICAvKioKICAgKiBNYWtlIGEgbWFwIGFuZCByZXR1cm4gYSBmdW5jdGlvbiBmb3IgY2hlY2tpbmcgaWYgYSBrZXkKICAgKiBpcyBpbiB0aGF0IG1hcC4KICAgKi8KICBmdW5jdGlvbiBtYWtlTWFwICgKICAgIHN0ciwKICAgIGV4cGVjdHNMb3dlckNhc2UKICApIHsKICAgIHZhciBtYXAgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgdmFyIGxpc3QgPSBzdHIuc3BsaXQoJywnKTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykgewogICAgICBtYXBbbGlzdFtpXV0gPSB0cnVlOwogICAgfQogICAgcmV0dXJuIGV4cGVjdHNMb3dlckNhc2UKICAgICAgPyBmdW5jdGlvbiAodmFsKSB7IHJldHVybiBtYXBbdmFsLnRvTG93ZXJDYXNlKCldOyB9CiAgICAgIDogZnVuY3Rpb24gKHZhbCkgeyByZXR1cm4gbWFwW3ZhbF07IH0KICB9CgogIC8qKgogICAqIENoZWNrIGlmIGEgdGFnIGlzIGEgYnVpbHQtaW4gdGFnLgogICAqLwogIHZhciBpc0J1aWx0SW5UYWcgPSBtYWtlTWFwKCdzbG90LGNvbXBvbmVudCcsIHRydWUpOwoKICAvKioKICAgKiBDaGVjayBpZiBhbiBhdHRyaWJ1dGUgaXMgYSByZXNlcnZlZCBhdHRyaWJ1dGUuCiAgICovCiAgdmFyIGlzUmVzZXJ2ZWRBdHRyaWJ1dGUgPSBtYWtlTWFwKCdrZXkscmVmLHNsb3Qsc2xvdC1zY29wZSxpcycpOwoKICAvKioKICAgKiBSZW1vdmUgYW4gaXRlbSBmcm9tIGFuIGFycmF5LgogICAqLwogIGZ1bmN0aW9uIHJlbW92ZSAoYXJyLCBpdGVtKSB7CiAgICBpZiAoYXJyLmxlbmd0aCkgewogICAgICB2YXIgaW5kZXggPSBhcnIuaW5kZXhPZihpdGVtKTsKICAgICAgaWYgKGluZGV4ID4gLTEpIHsKICAgICAgICByZXR1cm4gYXJyLnNwbGljZShpbmRleCwgMSkKICAgICAgfQogICAgfQogIH0KCiAgLyoqCiAgICogQ2hlY2sgd2hldGhlciBhbiBvYmplY3QgaGFzIHRoZSBwcm9wZXJ0eS4KICAgKi8KICB2YXIgaGFzT3duUHJvcGVydHkgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5OwogIGZ1bmN0aW9uIGhhc093biAob2JqLCBrZXkpIHsKICAgIHJldHVybiBoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KQogIH0KCiAgLyoqCiAgICogQ3JlYXRlIGEgY2FjaGVkIHZlcnNpb24gb2YgYSBwdXJlIGZ1bmN0aW9uLgogICAqLwogIGZ1bmN0aW9uIGNhY2hlZCAoZm4pIHsKICAgIHZhciBjYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICByZXR1cm4gKGZ1bmN0aW9uIGNhY2hlZEZuIChzdHIpIHsKICAgICAgdmFyIGhpdCA9IGNhY2hlW3N0cl07CiAgICAgIHJldHVybiBoaXQgfHwgKGNhY2hlW3N0cl0gPSBmbihzdHIpKQogICAgfSkKICB9CgogIC8qKgogICAqIENhbWVsaXplIGEgaHlwaGVuLWRlbGltaXRlZCBzdHJpbmcuCiAgICovCiAgdmFyIGNhbWVsaXplUkUgPSAvLShcdykvZzsKICB2YXIgY2FtZWxpemUgPSBjYWNoZWQoZnVuY3Rpb24gKHN0cikgewogICAgcmV0dXJuIHN0ci5yZXBsYWNlKGNhbWVsaXplUkUsIGZ1bmN0aW9uIChfLCBjKSB7IHJldHVybiBjID8gYy50b1VwcGVyQ2FzZSgpIDogJyc7IH0pCiAgfSk7CgogIC8qKgogICAqIENhcGl0YWxpemUgYSBzdHJpbmcuCiAgICovCiAgdmFyIGNhcGl0YWxpemUgPSBjYWNoZWQoZnVuY3Rpb24gKHN0cikgewogICAgcmV0dXJuIHN0ci5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHN0ci5zbGljZSgxKQogIH0pOwoKICAvKioKICAgKiBIeXBoZW5hdGUgYSBjYW1lbENhc2Ugc3RyaW5nLgogICAqLwogIHZhciBoeXBoZW5hdGVSRSA9IC9cQihbQS1aXSkvZzsKICB2YXIgaHlwaGVuYXRlID0gY2FjaGVkKGZ1bmN0aW9uIChzdHIpIHsKICAgIHJldHVybiBzdHIucmVwbGFjZShoeXBoZW5hdGVSRSwgJy0kMScpLnRvTG93ZXJDYXNlKCkKICB9KTsKCiAgLyoqCiAgICogU2ltcGxlIGJpbmQgcG9seWZpbGwgZm9yIGVudmlyb25tZW50cyB0aGF0IGRvIG5vdCBzdXBwb3J0IGl0LAogICAqIGUuZy4sIFBoYW50b21KUyAxLnguIFRlY2huaWNhbGx5LCB3ZSBkb24ndCBuZWVkIHRoaXMgYW55bW9yZQogICAqIHNpbmNlIG5hdGl2ZSBiaW5kIGlzIG5vdyBwZXJmb3JtYW50IGVub3VnaCBpbiBtb3N0IGJyb3dzZXJzLgogICAqIEJ1dCByZW1vdmluZyBpdCB3b3VsZCBtZWFuIGJyZWFraW5nIGNvZGUgdGhhdCB3YXMgYWJsZSB0byBydW4gaW4KICAgKiBQaGFudG9tSlMgMS54LCBzbyB0aGlzIG11c3QgYmUga2VwdCBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eS4KICAgKi8KCiAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICBmdW5jdGlvbiBwb2x5ZmlsbEJpbmQgKGZuLCBjdHgpIHsKICAgIGZ1bmN0aW9uIGJvdW5kRm4gKGEpIHsKICAgICAgdmFyIGwgPSBhcmd1bWVudHMubGVuZ3RoOwogICAgICByZXR1cm4gbAogICAgICAgID8gbCA+IDEKICAgICAgICAgID8gZm4uYXBwbHkoY3R4LCBhcmd1bWVudHMpCiAgICAgICAgICA6IGZuLmNhbGwoY3R4LCBhKQogICAgICAgIDogZm4uY2FsbChjdHgpCiAgICB9CgogICAgYm91bmRGbi5fbGVuZ3RoID0gZm4ubGVuZ3RoOwogICAgcmV0dXJuIGJvdW5kRm4KICB9CgogIGZ1bmN0aW9uIG5hdGl2ZUJpbmQgKGZuLCBjdHgpIHsKICAgIHJldHVybiBmbi5iaW5kKGN0eCkKICB9CgogIHZhciBiaW5kID0gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQKICAgID8gbmF0aXZlQmluZAogICAgOiBwb2x5ZmlsbEJpbmQ7CgogIC8qKgogICAqIENvbnZlcnQgYW4gQXJyYXktbGlrZSBvYmplY3QgdG8gYSByZWFsIEFycmF5LgogICAqLwogIGZ1bmN0aW9uIHRvQXJyYXkgKGxpc3QsIHN0YXJ0KSB7CiAgICBzdGFydCA9IHN0YXJ0IHx8IDA7CiAgICB2YXIgaSA9IGxpc3QubGVuZ3RoIC0gc3RhcnQ7CiAgICB2YXIgcmV0ID0gbmV3IEFycmF5KGkpOwogICAgd2hpbGUgKGktLSkgewogICAgICByZXRbaV0gPSBsaXN0W2kgKyBzdGFydF07CiAgICB9CiAgICByZXR1cm4gcmV0CiAgfQoKICAvKioKICAgKiBNaXggcHJvcGVydGllcyBpbnRvIHRhcmdldCBvYmplY3QuCiAgICovCiAgZnVuY3Rpb24gZXh0ZW5kICh0bywgX2Zyb20pIHsKICAgIGZvciAodmFyIGtleSBpbiBfZnJvbSkgewogICAgICB0b1trZXldID0gX2Zyb21ba2V5XTsKICAgIH0KICAgIHJldHVybiB0bwogIH0KCiAgLyoqCiAgICogTWVyZ2UgYW4gQXJyYXkgb2YgT2JqZWN0cyBpbnRvIGEgc2luZ2xlIE9iamVjdC4KICAgKi8KICBmdW5jdGlvbiB0b09iamVjdCAoYXJyKSB7CiAgICB2YXIgcmVzID0ge307CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykgewogICAgICBpZiAoYXJyW2ldKSB7CiAgICAgICAgZXh0ZW5kKHJlcywgYXJyW2ldKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlcwogIH0KCiAgLyogZXNsaW50LWRpc2FibGUgbm8tdW51c2VkLXZhcnMgKi8KCiAgLyoqCiAgICogUGVyZm9ybSBubyBvcGVyYXRpb24uCiAgICogU3R1YmJpbmcgYXJncyB0byBtYWtlIEZsb3cgaGFwcHkgd2l0aG91dCBsZWF2aW5nIHVzZWxlc3MgdHJhbnNwaWxlZCBjb2RlCiAgICogd2l0aCAuLi5yZXN0IChodHRwczovL2Zsb3cub3JnL2Jsb2cvMjAxNy8wNS8wNy9TdHJpY3QtRnVuY3Rpb24tQ2FsbC1Bcml0eS8pLgogICAqLwogIGZ1bmN0aW9uIG5vb3AgKGEsIGIsIGMpIHt9CgogIC8qKgogICAqIEFsd2F5cyByZXR1cm4gZmFsc2UuCiAgICovCiAgdmFyIG5vID0gZnVuY3Rpb24gKGEsIGIsIGMpIHsgcmV0dXJuIGZhbHNlOyB9OwoKICAvKiBlc2xpbnQtZW5hYmxlIG5vLXVudXNlZC12YXJzICovCgogIC8qKgogICAqIFJldHVybiB0aGUgc2FtZSB2YWx1ZS4KICAgKi8KICB2YXIgaWRlbnRpdHkgPSBmdW5jdGlvbiAoXykgeyByZXR1cm4gXzsgfTsKCiAgLyoqCiAgICogR2VuZXJhdGUgYSBzdHJpbmcgY29udGFpbmluZyBzdGF0aWMga2V5cyBmcm9tIGNvbXBpbGVyIG1vZHVsZXMuCiAgICovCiAgZnVuY3Rpb24gZ2VuU3RhdGljS2V5cyAobW9kdWxlcykgewogICAgcmV0dXJuIG1vZHVsZXMucmVkdWNlKGZ1bmN0aW9uIChrZXlzLCBtKSB7CiAgICAgIHJldHVybiBrZXlzLmNvbmNhdChtLnN0YXRpY0tleXMgfHwgW10pCiAgICB9LCBbXSkuam9pbignLCcpCiAgfQoKICAvKioKICAgKiBDaGVjayBpZiB0d28gdmFsdWVzIGFyZSBsb29zZWx5IGVxdWFsIC0gdGhhdCBpcywKICAgKiBpZiB0aGV5IGFyZSBwbGFpbiBvYmplY3RzLCBkbyB0aGV5IGhhdmUgdGhlIHNhbWUgc2hhcGU/CiAgICovCiAgZnVuY3Rpb24gbG9vc2VFcXVhbCAoYSwgYikgewogICAgaWYgKGEgPT09IGIpIHsgcmV0dXJuIHRydWUgfQogICAgdmFyIGlzT2JqZWN0QSA9IGlzT2JqZWN0KGEpOwogICAgdmFyIGlzT2JqZWN0QiA9IGlzT2JqZWN0KGIpOwogICAgaWYgKGlzT2JqZWN0QSAmJiBpc09iamVjdEIpIHsKICAgICAgdHJ5IHsKICAgICAgICB2YXIgaXNBcnJheUEgPSBBcnJheS5pc0FycmF5KGEpOwogICAgICAgIHZhciBpc0FycmF5QiA9IEFycmF5LmlzQXJyYXkoYik7CiAgICAgICAgaWYgKGlzQXJyYXlBICYmIGlzQXJyYXlCKSB7CiAgICAgICAgICByZXR1cm4gYS5sZW5ndGggPT09IGIubGVuZ3RoICYmIGEuZXZlcnkoZnVuY3Rpb24gKGUsIGkpIHsKICAgICAgICAgICAgcmV0dXJuIGxvb3NlRXF1YWwoZSwgYltpXSkKICAgICAgICAgIH0pCiAgICAgICAgfSBlbHNlIGlmIChhIGluc3RhbmNlb2YgRGF0ZSAmJiBiIGluc3RhbmNlb2YgRGF0ZSkgewogICAgICAgICAgcmV0dXJuIGEuZ2V0VGltZSgpID09PSBiLmdldFRpbWUoKQogICAgICAgIH0gZWxzZSBpZiAoIWlzQXJyYXlBICYmICFpc0FycmF5QikgewogICAgICAgICAgdmFyIGtleXNBID0gT2JqZWN0LmtleXMoYSk7CiAgICAgICAgICB2YXIga2V5c0IgPSBPYmplY3Qua2V5cyhiKTsKICAgICAgICAgIHJldHVybiBrZXlzQS5sZW5ndGggPT09IGtleXNCLmxlbmd0aCAmJiBrZXlzQS5ldmVyeShmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICAgIHJldHVybiBsb29zZUVxdWFsKGFba2V5XSwgYltrZXldKQogICAgICAgICAgfSkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgIH0KICAgIH0gZWxzZSBpZiAoIWlzT2JqZWN0QSAmJiAhaXNPYmplY3RCKSB7CiAgICAgIHJldHVybiBTdHJpbmcoYSkgPT09IFN0cmluZyhiKQogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGZhbHNlCiAgICB9CiAgfQoKICAvKioKICAgKiBSZXR1cm4gdGhlIGZpcnN0IGluZGV4IGF0IHdoaWNoIGEgbG9vc2VseSBlcXVhbCB2YWx1ZSBjYW4gYmUKICAgKiBmb3VuZCBpbiB0aGUgYXJyYXkgKGlmIHZhbHVlIGlzIGEgcGxhaW4gb2JqZWN0LCB0aGUgYXJyYXkgbXVzdAogICAqIGNvbnRhaW4gYW4gb2JqZWN0IG9mIHRoZSBzYW1lIHNoYXBlKSwgb3IgLTEgaWYgaXQgaXMgbm90IHByZXNlbnQuCiAgICovCiAgZnVuY3Rpb24gbG9vc2VJbmRleE9mIChhcnIsIHZhbCkgewogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKGxvb3NlRXF1YWwoYXJyW2ldLCB2YWwpKSB7IHJldHVybiBpIH0KICAgIH0KICAgIHJldHVybiAtMQogIH0KCiAgLyoqCiAgICogRW5zdXJlIGEgZnVuY3Rpb24gaXMgY2FsbGVkIG9ubHkgb25jZS4KICAgKi8KICBmdW5jdGlvbiBvbmNlIChmbikgewogICAgdmFyIGNhbGxlZCA9IGZhbHNlOwogICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKCFjYWxsZWQpIHsKICAgICAgICBjYWxsZWQgPSB0cnVlOwogICAgICAgIGZuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KICAgIH0KICB9CgogIHZhciBTU1JfQVRUUiA9ICdkYXRhLXNlcnZlci1yZW5kZXJlZCc7CgogIHZhciBBU1NFVF9UWVBFUyA9IFsKICAgICdjb21wb25lbnQnLAogICAgJ2RpcmVjdGl2ZScsCiAgICAnZmlsdGVyJwogIF07CgogIHZhciBMSUZFQ1lDTEVfSE9PS1MgPSBbCiAgICAnYmVmb3JlQ3JlYXRlJywKICAgICdjcmVhdGVkJywKICAgICdiZWZvcmVNb3VudCcsCiAgICAnbW91bnRlZCcsCiAgICAnYmVmb3JlVXBkYXRlJywKICAgICd1cGRhdGVkJywKICAgICdiZWZvcmVEZXN0cm95JywKICAgICdkZXN0cm95ZWQnLAogICAgJ2FjdGl2YXRlZCcsCiAgICAnZGVhY3RpdmF0ZWQnLAogICAgJ2Vycm9yQ2FwdHVyZWQnLAogICAgJ3NlcnZlclByZWZldGNoJwogIF07CgogIC8qICAqLwoKCgogIHZhciBjb25maWcgPSAoewogICAgLyoqCiAgICAgKiBPcHRpb24gbWVyZ2Ugc3RyYXRlZ2llcyAodXNlZCBpbiBjb3JlL3V0aWwvb3B0aW9ucykKICAgICAqLwogICAgLy8gJGZsb3ctZGlzYWJsZS1saW5lCiAgICBvcHRpb25NZXJnZVN0cmF0ZWdpZXM6IE9iamVjdC5jcmVhdGUobnVsbCksCgogICAgLyoqCiAgICAgKiBXaGV0aGVyIHRvIHN1cHByZXNzIHdhcm5pbmdzLgogICAgICovCiAgICBzaWxlbnQ6IGZhbHNlLAoKICAgIC8qKgogICAgICogU2hvdyBwcm9kdWN0aW9uIG1vZGUgdGlwIG1lc3NhZ2Ugb24gYm9vdD8KICAgICAqLwogICAgcHJvZHVjdGlvblRpcDogImRldmVsb3BtZW50IiAhPT0gJ3Byb2R1Y3Rpb24nLAoKICAgIC8qKgogICAgICogV2hldGhlciB0byBlbmFibGUgZGV2dG9vbHMKICAgICAqLwogICAgZGV2dG9vbHM6ICJkZXZlbG9wbWVudCIgIT09ICdwcm9kdWN0aW9uJywKCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gcmVjb3JkIHBlcmYKICAgICAqLwogICAgcGVyZm9ybWFuY2U6IGZhbHNlLAoKICAgIC8qKgogICAgICogRXJyb3IgaGFuZGxlciBmb3Igd2F0Y2hlciBlcnJvcnMKICAgICAqLwogICAgZXJyb3JIYW5kbGVyOiBudWxsLAoKICAgIC8qKgogICAgICogV2FybiBoYW5kbGVyIGZvciB3YXRjaGVyIHdhcm5zCiAgICAgKi8KICAgIHdhcm5IYW5kbGVyOiBudWxsLAoKICAgIC8qKgogICAgICogSWdub3JlIGNlcnRhaW4gY3VzdG9tIGVsZW1lbnRzCiAgICAgKi8KICAgIGlnbm9yZWRFbGVtZW50czogW10sCgogICAgLyoqCiAgICAgKiBDdXN0b20gdXNlciBrZXkgYWxpYXNlcyBmb3Igdi1vbgogICAgICovCiAgICAvLyAkZmxvdy1kaXNhYmxlLWxpbmUKICAgIGtleUNvZGVzOiBPYmplY3QuY3JlYXRlKG51bGwpLAoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYSB0YWcgaXMgcmVzZXJ2ZWQgc28gdGhhdCBpdCBjYW5ub3QgYmUgcmVnaXN0ZXJlZCBhcyBhCiAgICAgKiBjb21wb25lbnQuIFRoaXMgaXMgcGxhdGZvcm0tZGVwZW5kZW50IGFuZCBtYXkgYmUgb3ZlcndyaXR0ZW4uCiAgICAgKi8KICAgIGlzUmVzZXJ2ZWRUYWc6IG5vLAoKICAgIC8qKgogICAgICogQ2hlY2sgaWYgYW4gYXR0cmlidXRlIGlzIHJlc2VydmVkIHNvIHRoYXQgaXQgY2Fubm90IGJlIHVzZWQgYXMgYSBjb21wb25lbnQKICAgICAqIHByb3AuIFRoaXMgaXMgcGxhdGZvcm0tZGVwZW5kZW50IGFuZCBtYXkgYmUgb3ZlcndyaXR0ZW4uCiAgICAgKi8KICAgIGlzUmVzZXJ2ZWRBdHRyOiBubywKCiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdGFnIGlzIGFuIHVua25vd24gZWxlbWVudC4KICAgICAqIFBsYXRmb3JtLWRlcGVuZGVudC4KICAgICAqLwogICAgaXNVbmtub3duRWxlbWVudDogbm8sCgogICAgLyoqCiAgICAgKiBHZXQgdGhlIG5hbWVzcGFjZSBvZiBhbiBlbGVtZW50CiAgICAgKi8KICAgIGdldFRhZ05hbWVzcGFjZTogbm9vcCwKCiAgICAvKioKICAgICAqIFBhcnNlIHRoZSByZWFsIHRhZyBuYW1lIGZvciB0aGUgc3BlY2lmaWMgcGxhdGZvcm0uCiAgICAgKi8KICAgIHBhcnNlUGxhdGZvcm1UYWdOYW1lOiBpZGVudGl0eSwKCiAgICAvKioKICAgICAqIENoZWNrIGlmIGFuIGF0dHJpYnV0ZSBtdXN0IGJlIGJvdW5kIHVzaW5nIHByb3BlcnR5LCBlLmcuIHZhbHVlCiAgICAgKiBQbGF0Zm9ybS1kZXBlbmRlbnQuCiAgICAgKi8KICAgIG11c3RVc2VQcm9wOiBubywKCiAgICAvKioKICAgICAqIFBlcmZvcm0gdXBkYXRlcyBhc3luY2hyb25vdXNseS4gSW50ZW5kZWQgdG8gYmUgdXNlZCBieSBWdWUgVGVzdCBVdGlscwogICAgICogVGhpcyB3aWxsIHNpZ25pZmljYW50bHkgcmVkdWNlIHBlcmZvcm1hbmNlIGlmIHNldCB0byBmYWxzZS4KICAgICAqLwogICAgYXN5bmM6IHRydWUsCgogICAgLyoqCiAgICAgKiBFeHBvc2VkIGZvciBsZWdhY3kgcmVhc29ucwogICAgICovCiAgICBfbGlmZWN5Y2xlSG9va3M6IExJRkVDWUNMRV9IT09LUwogIH0pOwoKICAvKiAgKi8KCiAgLyoqCiAgICogdW5pY29kZSBsZXR0ZXJzIHVzZWQgZm9yIHBhcnNpbmcgaHRtbCB0YWdzLCBjb21wb25lbnQgbmFtZXMgYW5kIHByb3BlcnR5IHBhdGhzLgogICAqIHVzaW5nIGh0dHBzOi8vd3d3LnczLm9yZy9UUi9odG1sNTMvc2VtYW50aWNzLXNjcmlwdGluZy5odG1sI3BvdGVudGlhbGN1c3RvbWVsZW1lbnRuYW1lCiAgICogc2tpcHBpbmcgXHUxMDAwMC1cdUVGRkZGIGR1ZSB0byBpdCBmcmVlemluZyB1cCBQaGFudG9tSlMKICAgKi8KICB2YXIgdW5pY29kZVJlZ0V4cCA9IC9hLXpBLVpcdTAwQjdcdTAwQzAtXHUwMEQ2XHUwMEQ4LVx1MDBGNlx1MDBGOC1cdTAzN0RcdTAzN0YtXHUxRkZGXHUyMDBDLVx1MjAwRFx1MjAzRi1cdTIwNDBcdTIwNzAtXHUyMThGXHUyQzAwLVx1MkZFRlx1MzAwMS1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZGRC87CgogIC8qKgogICAqIENoZWNrIGlmIGEgc3RyaW5nIHN0YXJ0cyB3aXRoICQgb3IgXwogICAqLwogIGZ1bmN0aW9uIGlzUmVzZXJ2ZWQgKHN0cikgewogICAgdmFyIGMgPSAoc3RyICsgJycpLmNoYXJDb2RlQXQoMCk7CiAgICByZXR1cm4gYyA9PT0gMHgyNCB8fCBjID09PSAweDVGCiAgfQoKICAvKioKICAgKiBEZWZpbmUgYSBwcm9wZXJ0eS4KICAgKi8KICBmdW5jdGlvbiBkZWYgKG9iaiwga2V5LCB2YWwsIGVudW1lcmFibGUpIHsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICB2YWx1ZTogdmFsLAogICAgICBlbnVtZXJhYmxlOiAhIWVudW1lcmFibGUsCiAgICAgIHdyaXRhYmxlOiB0cnVlLAogICAgICBjb25maWd1cmFibGU6IHRydWUKICAgIH0pOwogIH0KCiAgLyoqCiAgICogUGFyc2Ugc2ltcGxlIHBhdGguCiAgICovCiAgdmFyIGJhaWxSRSA9IG5ldyBSZWdFeHAoKCJbXiIgKyAodW5pY29kZVJlZ0V4cC5zb3VyY2UpICsgIi4kX1xcZF0iKSk7CiAgZnVuY3Rpb24gcGFyc2VQYXRoIChwYXRoKSB7CiAgICBpZiAoYmFpbFJFLnRlc3QocGF0aCkpIHsKICAgICAgcmV0dXJuCiAgICB9CiAgICB2YXIgc2VnbWVudHMgPSBwYXRoLnNwbGl0KCcuJyk7CiAgICByZXR1cm4gZnVuY3Rpb24gKG9iaikgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlZ21lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKCFvYmopIHsgcmV0dXJuIH0KICAgICAgICBvYmogPSBvYmpbc2VnbWVudHNbaV1dOwogICAgICB9CiAgICAgIHJldHVybiBvYmoKICAgIH0KICB9CgogIC8qICAqLwoKICAvLyBjYW4gd2UgdXNlIF9fcHJvdG9fXz8KICB2YXIgaGFzUHJvdG8gPSAnX19wcm90b19fJyBpbiB7fTsKCiAgLy8gQnJvd3NlciBlbnZpcm9ubWVudCBzbmlmZmluZwogIHZhciBpbkJyb3dzZXIgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJzsKICB2YXIgaW5XZWV4ID0gdHlwZW9mIFdYRW52aXJvbm1lbnQgIT09ICd1bmRlZmluZWQnICYmICEhV1hFbnZpcm9ubWVudC5wbGF0Zm9ybTsKICB2YXIgd2VleFBsYXRmb3JtID0gaW5XZWV4ICYmIFdYRW52aXJvbm1lbnQucGxhdGZvcm0udG9Mb3dlckNhc2UoKTsKICB2YXIgVUEgPSBpbkJyb3dzZXIgJiYgd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKTsKICB2YXIgaXNJRSA9IFVBICYmIC9tc2llfHRyaWRlbnQvLnRlc3QoVUEpOwogIHZhciBpc0lFOSA9IFVBICYmIFVBLmluZGV4T2YoJ21zaWUgOS4wJykgPiAwOwogIHZhciBpc0VkZ2UgPSBVQSAmJiBVQS5pbmRleE9mKCdlZGdlLycpID4gMDsKICB2YXIgaXNBbmRyb2lkID0gKFVBICYmIFVBLmluZGV4T2YoJ2FuZHJvaWQnKSA+IDApIHx8ICh3ZWV4UGxhdGZvcm0gPT09ICdhbmRyb2lkJyk7CiAgdmFyIGlzSU9TID0gKFVBICYmIC9pcGhvbmV8aXBhZHxpcG9kfGlvcy8udGVzdChVQSkpIHx8ICh3ZWV4UGxhdGZvcm0gPT09ICdpb3MnKTsKICB2YXIgaXNDaHJvbWUgPSBVQSAmJiAvY2hyb21lXC9cZCsvLnRlc3QoVUEpICYmICFpc0VkZ2U7CiAgdmFyIGlzUGhhbnRvbUpTID0gVUEgJiYgL3BoYW50b21qcy8udGVzdChVQSk7CiAgdmFyIGlzRkYgPSBVQSAmJiBVQS5tYXRjaCgvZmlyZWZveFwvKFxkKykvKTsKCiAgLy8gRmlyZWZveCBoYXMgYSAid2F0Y2giIGZ1bmN0aW9uIG9uIE9iamVjdC5wcm90b3R5cGUuLi4KICB2YXIgbmF0aXZlV2F0Y2ggPSAoe30pLndhdGNoOwoKICB2YXIgc3VwcG9ydHNQYXNzaXZlID0gZmFsc2U7CiAgaWYgKGluQnJvd3NlcikgewogICAgdHJ5IHsKICAgICAgdmFyIG9wdHMgPSB7fTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9wdHMsICdwYXNzaXZlJywgKHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uIGdldCAoKSB7CiAgICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogICAgICAgICAgc3VwcG9ydHNQYXNzaXZlID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0pKTsgLy8gaHR0cHM6Ly9naXRodWIuY29tL2ZhY2Vib29rL2Zsb3cvaXNzdWVzLzI4NQogICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigndGVzdC1wYXNzaXZlJywgbnVsbCwgb3B0cyk7CiAgICB9IGNhdGNoIChlKSB7fQogIH0KCiAgLy8gdGhpcyBuZWVkcyB0byBiZSBsYXp5LWV2YWxlZCBiZWNhdXNlIHZ1ZSBtYXkgYmUgcmVxdWlyZWQgYmVmb3JlCiAgLy8gdnVlLXNlcnZlci1yZW5kZXJlciBjYW4gc2V0IFZVRV9FTlYKICB2YXIgX2lzU2VydmVyOwogIHZhciBpc1NlcnZlclJlbmRlcmluZyA9IGZ1bmN0aW9uICgpIHsKICAgIGlmIChfaXNTZXJ2ZXIgPT09IHVuZGVmaW5lZCkgewogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgaWYgKCFpbkJyb3dzZXIgJiYgIWluV2VleCAmJiB0eXBlb2YgZ2xvYmFsICE9PSAndW5kZWZpbmVkJykgewogICAgICAgIC8vIGRldGVjdCBwcmVzZW5jZSBvZiB2dWUtc2VydmVyLXJlbmRlcmVyIGFuZCBhdm9pZAogICAgICAgIC8vIFdlYnBhY2sgc2hpbW1pbmcgdGhlIHByb2Nlc3MKICAgICAgICBfaXNTZXJ2ZXIgPSBnbG9iYWxbJ3Byb2Nlc3MnXSAmJiBnbG9iYWxbJ3Byb2Nlc3MnXS5lbnYuVlVFX0VOViA9PT0gJ3NlcnZlcic7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgX2lzU2VydmVyID0gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBfaXNTZXJ2ZXIKICB9OwoKICAvLyBkZXRlY3QgZGV2dG9vbHMKICB2YXIgZGV2dG9vbHMgPSBpbkJyb3dzZXIgJiYgd2luZG93Ll9fVlVFX0RFVlRPT0xTX0dMT0JBTF9IT09LX187CgogIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgZnVuY3Rpb24gaXNOYXRpdmUgKEN0b3IpIHsKICAgIHJldHVybiB0eXBlb2YgQ3RvciA9PT0gJ2Z1bmN0aW9uJyAmJiAvbmF0aXZlIGNvZGUvLnRlc3QoQ3Rvci50b1N0cmluZygpKQogIH0KCiAgdmFyIGhhc1N5bWJvbCA9CiAgICB0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBpc05hdGl2ZShTeW1ib2wpICYmCiAgICB0eXBlb2YgUmVmbGVjdCAhPT0gJ3VuZGVmaW5lZCcgJiYgaXNOYXRpdmUoUmVmbGVjdC5vd25LZXlzKTsKCiAgdmFyIF9TZXQ7CiAgLyogaXN0YW5idWwgaWdub3JlIGlmICovIC8vICRmbG93LWRpc2FibGUtbGluZQogIGlmICh0eXBlb2YgU2V0ICE9PSAndW5kZWZpbmVkJyAmJiBpc05hdGl2ZShTZXQpKSB7CiAgICAvLyB1c2UgbmF0aXZlIFNldCB3aGVuIGF2YWlsYWJsZS4KICAgIF9TZXQgPSBTZXQ7CiAgfSBlbHNlIHsKICAgIC8vIGEgbm9uLXN0YW5kYXJkIFNldCBwb2x5ZmlsbCB0aGF0IG9ubHkgd29ya3Mgd2l0aCBwcmltaXRpdmUga2V5cy4KICAgIF9TZXQgPSAvKkBfX1BVUkVfXyovKGZ1bmN0aW9uICgpIHsKICAgICAgZnVuY3Rpb24gU2V0ICgpIHsKICAgICAgICB0aGlzLnNldCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIH0KICAgICAgU2V0LnByb3RvdHlwZS5oYXMgPSBmdW5jdGlvbiBoYXMgKGtleSkgewogICAgICAgIHJldHVybiB0aGlzLnNldFtrZXldID09PSB0cnVlCiAgICAgIH07CiAgICAgIFNldC5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gYWRkIChrZXkpIHsKICAgICAgICB0aGlzLnNldFtrZXldID0gdHJ1ZTsKICAgICAgfTsKICAgICAgU2V0LnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uIGNsZWFyICgpIHsKICAgICAgICB0aGlzLnNldCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIH07CgogICAgICByZXR1cm4gU2V0OwogICAgfSgpKTsKICB9CgogIC8qICAqLwoKICB2YXIgd2FybiA9IG5vb3A7CiAgdmFyIHRpcCA9IG5vb3A7CiAgdmFyIGdlbmVyYXRlQ29tcG9uZW50VHJhY2UgPSAobm9vcCk7IC8vIHdvcmsgYXJvdW5kIGZsb3cgY2hlY2sKICB2YXIgZm9ybWF0Q29tcG9uZW50TmFtZSA9IChub29wKTsKCiAgewogICAgdmFyIGhhc0NvbnNvbGUgPSB0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCc7CiAgICB2YXIgY2xhc3NpZnlSRSA9IC8oPzpefFstX10pKFx3KS9nOwogICAgdmFyIGNsYXNzaWZ5ID0gZnVuY3Rpb24gKHN0cikgeyByZXR1cm4gc3RyCiAgICAgIC5yZXBsYWNlKGNsYXNzaWZ5UkUsIGZ1bmN0aW9uIChjKSB7IHJldHVybiBjLnRvVXBwZXJDYXNlKCk7IH0pCiAgICAgIC5yZXBsYWNlKC9bLV9dL2csICcnKTsgfTsKCiAgICB3YXJuID0gZnVuY3Rpb24gKG1zZywgdm0pIHsKICAgICAgdmFyIHRyYWNlID0gdm0gPyBnZW5lcmF0ZUNvbXBvbmVudFRyYWNlKHZtKSA6ICcnOwoKICAgICAgaWYgKGNvbmZpZy53YXJuSGFuZGxlcikgewogICAgICAgIGNvbmZpZy53YXJuSGFuZGxlci5jYWxsKG51bGwsIG1zZywgdm0sIHRyYWNlKTsKICAgICAgfSBlbHNlIGlmIChoYXNDb25zb2xlICYmICghY29uZmlnLnNpbGVudCkpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCgiW1Z1ZSB3YXJuXTogIiArIG1zZyArIHRyYWNlKSk7CiAgICAgIH0KICAgIH07CgogICAgdGlwID0gZnVuY3Rpb24gKG1zZywgdm0pIHsKICAgICAgaWYgKGhhc0NvbnNvbGUgJiYgKCFjb25maWcuc2lsZW50KSkgewogICAgICAgIGNvbnNvbGUud2FybigiW1Z1ZSB0aXBdOiAiICsgbXNnICsgKAogICAgICAgICAgdm0gPyBnZW5lcmF0ZUNvbXBvbmVudFRyYWNlKHZtKSA6ICcnCiAgICAgICAgKSk7CiAgICAgIH0KICAgIH07CgogICAgZm9ybWF0Q29tcG9uZW50TmFtZSA9IGZ1bmN0aW9uICh2bSwgaW5jbHVkZUZpbGUpIHsKICAgICAgaWYgKHZtLiRyb290ID09PSB2bSkgewogICAgICAgIHJldHVybiAnPFJvb3Q+JwogICAgICB9CiAgICAgIHZhciBvcHRpb25zID0gdHlwZW9mIHZtID09PSAnZnVuY3Rpb24nICYmIHZtLmNpZCAhPSBudWxsCiAgICAgICAgPyB2bS5vcHRpb25zCiAgICAgICAgOiB2bS5faXNWdWUKICAgICAgICAgID8gdm0uJG9wdGlvbnMgfHwgdm0uY29uc3RydWN0b3Iub3B0aW9ucwogICAgICAgICAgOiB2bTsKICAgICAgdmFyIG5hbWUgPSBvcHRpb25zLm5hbWUgfHwgb3B0aW9ucy5fY29tcG9uZW50VGFnOwogICAgICB2YXIgZmlsZSA9IG9wdGlvbnMuX19maWxlOwogICAgICBpZiAoIW5hbWUgJiYgZmlsZSkgewogICAgICAgIHZhciBtYXRjaCA9IGZpbGUubWF0Y2goLyhbXi9cXF0rKVwudnVlJC8pOwogICAgICAgIG5hbWUgPSBtYXRjaCAmJiBtYXRjaFsxXTsKICAgICAgfQoKICAgICAgcmV0dXJuICgKICAgICAgICAobmFtZSA/ICgiPCIgKyAoY2xhc3NpZnkobmFtZSkpICsgIj4iKSA6ICI8QW5vbnltb3VzPiIpICsKICAgICAgICAoZmlsZSAmJiBpbmNsdWRlRmlsZSAhPT0gZmFsc2UgPyAoIiBhdCAiICsgZmlsZSkgOiAnJykKICAgICAgKQogICAgfTsKCiAgICB2YXIgcmVwZWF0ID0gZnVuY3Rpb24gKHN0ciwgbikgewogICAgICB2YXIgcmVzID0gJyc7CiAgICAgIHdoaWxlIChuKSB7CiAgICAgICAgaWYgKG4gJSAyID09PSAxKSB7IHJlcyArPSBzdHI7IH0KICAgICAgICBpZiAobiA+IDEpIHsgc3RyICs9IHN0cjsgfQogICAgICAgIG4gPj49IDE7CiAgICAgIH0KICAgICAgcmV0dXJuIHJlcwogICAgfTsKCiAgICBnZW5lcmF0ZUNvbXBvbmVudFRyYWNlID0gZnVuY3Rpb24gKHZtKSB7CiAgICAgIGlmICh2bS5faXNWdWUgJiYgdm0uJHBhcmVudCkgewogICAgICAgIHZhciB0cmVlID0gW107CiAgICAgICAgdmFyIGN1cnJlbnRSZWN1cnNpdmVTZXF1ZW5jZSA9IDA7CiAgICAgICAgd2hpbGUgKHZtKSB7CiAgICAgICAgICBpZiAodHJlZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHZhciBsYXN0ID0gdHJlZVt0cmVlLmxlbmd0aCAtIDFdOwogICAgICAgICAgICBpZiAobGFzdC5jb25zdHJ1Y3RvciA9PT0gdm0uY29uc3RydWN0b3IpIHsKICAgICAgICAgICAgICBjdXJyZW50UmVjdXJzaXZlU2VxdWVuY2UrKzsKICAgICAgICAgICAgICB2bSA9IHZtLiRwYXJlbnQ7CiAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgfSBlbHNlIGlmIChjdXJyZW50UmVjdXJzaXZlU2VxdWVuY2UgPiAwKSB7CiAgICAgICAgICAgICAgdHJlZVt0cmVlLmxlbmd0aCAtIDFdID0gW2xhc3QsIGN1cnJlbnRSZWN1cnNpdmVTZXF1ZW5jZV07CiAgICAgICAgICAgICAgY3VycmVudFJlY3Vyc2l2ZVNlcXVlbmNlID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgdHJlZS5wdXNoKHZtKTsKICAgICAgICAgIHZtID0gdm0uJHBhcmVudDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICdcblxuZm91bmQgaW5cblxuJyArIHRyZWUKICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKHZtLCBpKSB7IHJldHVybiAoIiIgKyAoaSA9PT0gMCA/ICctLS0+ICcgOiByZXBlYXQoJyAnLCA1ICsgaSAqIDIpKSArIChBcnJheS5pc0FycmF5KHZtKQogICAgICAgICAgICAgID8gKChmb3JtYXRDb21wb25lbnROYW1lKHZtWzBdKSkgKyAiLi4uICgiICsgKHZtWzFdKSArICIgcmVjdXJzaXZlIGNhbGxzKSIpCiAgICAgICAgICAgICAgOiBmb3JtYXRDb21wb25lbnROYW1lKHZtKSkpOyB9KQogICAgICAgICAgLmpvaW4oJ1xuJykKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gKCJcblxuKGZvdW5kIGluICIgKyAoZm9ybWF0Q29tcG9uZW50TmFtZSh2bSkpICsgIikiKQogICAgICB9CiAgICB9OwogIH0KCiAgLyogICovCgogIHZhciB1aWQgPSAwOwoKICAvKioKICAgKiBBIGRlcCBpcyBhbiBvYnNlcnZhYmxlIHRoYXQgY2FuIGhhdmUgbXVsdGlwbGUKICAgKiBkaXJlY3RpdmVzIHN1YnNjcmliaW5nIHRvIGl0LgogICAqLwogIHZhciBEZXAgPSBmdW5jdGlvbiBEZXAgKCkgewogICAgdGhpcy5pZCA9IHVpZCsrOwogICAgdGhpcy5zdWJzID0gW107CiAgfTsKCiAgRGVwLnByb3RvdHlwZS5hZGRTdWIgPSBmdW5jdGlvbiBhZGRTdWIgKHN1YikgewogICAgdGhpcy5zdWJzLnB1c2goc3ViKTsKICB9OwoKICBEZXAucHJvdG90eXBlLnJlbW92ZVN1YiA9IGZ1bmN0aW9uIHJlbW92ZVN1YiAoc3ViKSB7CiAgICByZW1vdmUodGhpcy5zdWJzLCBzdWIpOwogIH07CgogIERlcC5wcm90b3R5cGUuZGVwZW5kID0gZnVuY3Rpb24gZGVwZW5kICgpIHsKICAgIGlmIChEZXAudGFyZ2V0KSB7CiAgICAgIERlcC50YXJnZXQuYWRkRGVwKHRoaXMpOwogICAgfQogIH07CgogIERlcC5wcm90b3R5cGUubm90aWZ5ID0gZnVuY3Rpb24gbm90aWZ5ICgpIHsKICAgIC8vIHN0YWJpbGl6ZSB0aGUgc3Vic2NyaWJlciBsaXN0IGZpcnN0CiAgICB2YXIgc3VicyA9IHRoaXMuc3Vicy5zbGljZSgpOwogICAgaWYgKCFjb25maWcuYXN5bmMpIHsKICAgICAgLy8gc3VicyBhcmVuJ3Qgc29ydGVkIGluIHNjaGVkdWxlciBpZiBub3QgcnVubmluZyBhc3luYwogICAgICAvLyB3ZSBuZWVkIHRvIHNvcnQgdGhlbSBub3cgdG8gbWFrZSBzdXJlIHRoZXkgZmlyZSBpbiBjb3JyZWN0CiAgICAgIC8vIG9yZGVyCiAgICAgIHN1YnMuc29ydChmdW5jdGlvbiAoYSwgYikgeyByZXR1cm4gYS5pZCAtIGIuaWQ7IH0pOwogICAgfQogICAgZm9yICh2YXIgaSA9IDAsIGwgPSBzdWJzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICBzdWJzW2ldLnVwZGF0ZSgpOwogICAgfQogIH07CgogIC8vIFRoZSBjdXJyZW50IHRhcmdldCB3YXRjaGVyIGJlaW5nIGV2YWx1YXRlZC4KICAvLyBUaGlzIGlzIGdsb2JhbGx5IHVuaXF1ZSBiZWNhdXNlIG9ubHkgb25lIHdhdGNoZXIKICAvLyBjYW4gYmUgZXZhbHVhdGVkIGF0IGEgdGltZS4KICBEZXAudGFyZ2V0ID0gbnVsbDsKICB2YXIgdGFyZ2V0U3RhY2sgPSBbXTsKCiAgZnVuY3Rpb24gcHVzaFRhcmdldCAodGFyZ2V0KSB7CiAgICB0YXJnZXRTdGFjay5wdXNoKHRhcmdldCk7CiAgICBEZXAudGFyZ2V0ID0gdGFyZ2V0OwogIH0KCiAgZnVuY3Rpb24gcG9wVGFyZ2V0ICgpIHsKICAgIHRhcmdldFN0YWNrLnBvcCgpOwogICAgRGVwLnRhcmdldCA9IHRhcmdldFN0YWNrW3RhcmdldFN0YWNrLmxlbmd0aCAtIDFdOwogIH0KCiAgLyogICovCgogIHZhciBWTm9kZSA9IGZ1bmN0aW9uIFZOb2RlICgKICAgIHRhZywKICAgIGRhdGEsCiAgICBjaGlsZHJlbiwKICAgIHRleHQsCiAgICBlbG0sCiAgICBjb250ZXh0LAogICAgY29tcG9uZW50T3B0aW9ucywKICAgIGFzeW5jRmFjdG9yeQogICkgewogICAgdGhpcy50YWcgPSB0YWc7CiAgICB0aGlzLmRhdGEgPSBkYXRhOwogICAgdGhpcy5jaGlsZHJlbiA9IGNoaWxkcmVuOwogICAgdGhpcy50ZXh0ID0gdGV4dDsKICAgIHRoaXMuZWxtID0gZWxtOwogICAgdGhpcy5ucyA9IHVuZGVmaW5lZDsKICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7CiAgICB0aGlzLmZuQ29udGV4dCA9IHVuZGVmaW5lZDsKICAgIHRoaXMuZm5PcHRpb25zID0gdW5kZWZpbmVkOwogICAgdGhpcy5mblNjb3BlSWQgPSB1bmRlZmluZWQ7CiAgICB0aGlzLmtleSA9IGRhdGEgJiYgZGF0YS5rZXk7CiAgICB0aGlzLmNvbXBvbmVudE9wdGlvbnMgPSBjb21wb25lbnRPcHRpb25zOwogICAgdGhpcy5jb21wb25lbnRJbnN0YW5jZSA9IHVuZGVmaW5lZDsKICAgIHRoaXMucGFyZW50ID0gdW5kZWZpbmVkOwogICAgdGhpcy5yYXcgPSBmYWxzZTsKICAgIHRoaXMuaXNTdGF0aWMgPSBmYWxzZTsKICAgIHRoaXMuaXNSb290SW5zZXJ0ID0gdHJ1ZTsKICAgIHRoaXMuaXNDb21tZW50ID0gZmFsc2U7CiAgICB0aGlzLmlzQ2xvbmVkID0gZmFsc2U7CiAgICB0aGlzLmlzT25jZSA9IGZhbHNlOwogICAgdGhpcy5hc3luY0ZhY3RvcnkgPSBhc3luY0ZhY3Rvcnk7CiAgICB0aGlzLmFzeW5jTWV0YSA9IHVuZGVmaW5lZDsKICAgIHRoaXMuaXNBc3luY1BsYWNlaG9sZGVyID0gZmFsc2U7CiAgfTsKCiAgdmFyIHByb3RvdHlwZUFjY2Vzc29ycyA9IHsgY2hpbGQ6IHsgY29uZmlndXJhYmxlOiB0cnVlIH0gfTsKCiAgLy8gREVQUkVDQVRFRDogYWxpYXMgZm9yIGNvbXBvbmVudEluc3RhbmNlIGZvciBiYWNrd2FyZHMgY29tcGF0LgogIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgcHJvdG90eXBlQWNjZXNzb3JzLmNoaWxkLmdldCA9IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB0aGlzLmNvbXBvbmVudEluc3RhbmNlCiAgfTsKCiAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoIFZOb2RlLnByb3RvdHlwZSwgcHJvdG90eXBlQWNjZXNzb3JzICk7CgogIHZhciBjcmVhdGVFbXB0eVZOb2RlID0gZnVuY3Rpb24gKHRleHQpIHsKICAgIGlmICggdGV4dCA9PT0gdm9pZCAwICkgdGV4dCA9ICcnOwoKICAgIHZhciBub2RlID0gbmV3IFZOb2RlKCk7CiAgICBub2RlLnRleHQgPSB0ZXh0OwogICAgbm9kZS5pc0NvbW1lbnQgPSB0cnVlOwogICAgcmV0dXJuIG5vZGUKICB9OwoKICBmdW5jdGlvbiBjcmVhdGVUZXh0Vk5vZGUgKHZhbCkgewogICAgcmV0dXJuIG5ldyBWTm9kZSh1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBTdHJpbmcodmFsKSkKICB9CgogIC8vIG9wdGltaXplZCBzaGFsbG93IGNsb25lCiAgLy8gdXNlZCBmb3Igc3RhdGljIG5vZGVzIGFuZCBzbG90IG5vZGVzIGJlY2F1c2UgdGhleSBtYXkgYmUgcmV1c2VkIGFjcm9zcwogIC8vIG11bHRpcGxlIHJlbmRlcnMsIGNsb25pbmcgdGhlbSBhdm9pZHMgZXJyb3JzIHdoZW4gRE9NIG1hbmlwdWxhdGlvbnMgcmVseQogIC8vIG9uIHRoZWlyIGVsbSByZWZlcmVuY2UuCiAgZnVuY3Rpb24gY2xvbmVWTm9kZSAodm5vZGUpIHsKICAgIHZhciBjbG9uZWQgPSBuZXcgVk5vZGUoCiAgICAgIHZub2RlLnRhZywKICAgICAgdm5vZGUuZGF0YSwKICAgICAgLy8gIzc5NzUKICAgICAgLy8gY2xvbmUgY2hpbGRyZW4gYXJyYXkgdG8gYXZvaWQgbXV0YXRpbmcgb3JpZ2luYWwgaW4gY2FzZSBvZiBjbG9uaW5nCiAgICAgIC8vIGEgY2hpbGQuCiAgICAgIHZub2RlLmNoaWxkcmVuICYmIHZub2RlLmNoaWxkcmVuLnNsaWNlKCksCiAgICAgIHZub2RlLnRleHQsCiAgICAgIHZub2RlLmVsbSwKICAgICAgdm5vZGUuY29udGV4dCwKICAgICAgdm5vZGUuY29tcG9uZW50T3B0aW9ucywKICAgICAgdm5vZGUuYXN5bmNGYWN0b3J5CiAgICApOwogICAgY2xvbmVkLm5zID0gdm5vZGUubnM7CiAgICBjbG9uZWQuaXNTdGF0aWMgPSB2bm9kZS5pc1N0YXRpYzsKICAgIGNsb25lZC5rZXkgPSB2bm9kZS5rZXk7CiAgICBjbG9uZWQuaXNDb21tZW50ID0gdm5vZGUuaXNDb21tZW50OwogICAgY2xvbmVkLmZuQ29udGV4dCA9IHZub2RlLmZuQ29udGV4dDsKICAgIGNsb25lZC5mbk9wdGlvbnMgPSB2bm9kZS5mbk9wdGlvbnM7CiAgICBjbG9uZWQuZm5TY29wZUlkID0gdm5vZGUuZm5TY29wZUlkOwogICAgY2xvbmVkLmFzeW5jTWV0YSA9IHZub2RlLmFzeW5jTWV0YTsKICAgIGNsb25lZC5pc0Nsb25lZCA9IHRydWU7CiAgICByZXR1cm4gY2xvbmVkCiAgfQoKICAvKgogICAqIG5vdCB0eXBlIGNoZWNraW5nIHRoaXMgZmlsZSBiZWNhdXNlIGZsb3cgZG9lc24ndCBwbGF5IHdlbGwgd2l0aAogICAqIGR5bmFtaWNhbGx5IGFjY2Vzc2luZyBtZXRob2RzIG9uIEFycmF5IHByb3RvdHlwZQogICAqLwoKICB2YXIgYXJyYXlQcm90byA9IEFycmF5LnByb3RvdHlwZTsKICB2YXIgYXJyYXlNZXRob2RzID0gT2JqZWN0LmNyZWF0ZShhcnJheVByb3RvKTsKCiAgdmFyIG1ldGhvZHNUb1BhdGNoID0gWwogICAgJ3B1c2gnLAogICAgJ3BvcCcsCiAgICAnc2hpZnQnLAogICAgJ3Vuc2hpZnQnLAogICAgJ3NwbGljZScsCiAgICAnc29ydCcsCiAgICAncmV2ZXJzZScKICBdOwoKICAvKioKICAgKiBJbnRlcmNlcHQgbXV0YXRpbmcgbWV0aG9kcyBhbmQgZW1pdCBldmVudHMKICAgKi8KICBtZXRob2RzVG9QYXRjaC5mb3JFYWNoKGZ1bmN0aW9uIChtZXRob2QpIHsKICAgIC8vIGNhY2hlIG9yaWdpbmFsIG1ldGhvZAogICAgdmFyIG9yaWdpbmFsID0gYXJyYXlQcm90b1ttZXRob2RdOwogICAgZGVmKGFycmF5TWV0aG9kcywgbWV0aG9kLCBmdW5jdGlvbiBtdXRhdG9yICgpIHsKICAgICAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDsKICAgICAgd2hpbGUgKCBsZW4tLSApIGFyZ3NbIGxlbiBdID0gYXJndW1lbnRzWyBsZW4gXTsKCiAgICAgIHZhciByZXN1bHQgPSBvcmlnaW5hbC5hcHBseSh0aGlzLCBhcmdzKTsKICAgICAgdmFyIG9iID0gdGhpcy5fX29iX187CiAgICAgIHZhciBpbnNlcnRlZDsKICAgICAgc3dpdGNoIChtZXRob2QpIHsKICAgICAgICBjYXNlICdwdXNoJzoKICAgICAgICBjYXNlICd1bnNoaWZ0JzoKICAgICAgICAgIGluc2VydGVkID0gYXJnczsKICAgICAgICAgIGJyZWFrCiAgICAgICAgY2FzZSAnc3BsaWNlJzoKICAgICAgICAgIGluc2VydGVkID0gYXJncy5zbGljZSgyKTsKICAgICAgICAgIGJyZWFrCiAgICAgIH0KICAgICAgaWYgKGluc2VydGVkKSB7IG9iLm9ic2VydmVBcnJheShpbnNlcnRlZCk7IH0KICAgICAgLy8gbm90aWZ5IGNoYW5nZQogICAgICBvYi5kZXAubm90aWZ5KCk7CiAgICAgIHJldHVybiByZXN1bHQKICAgIH0pOwogIH0pOwoKICAvKiAgKi8KCiAgdmFyIGFycmF5S2V5cyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGFycmF5TWV0aG9kcyk7CgogIC8qKgogICAqIEluIHNvbWUgY2FzZXMgd2UgbWF5IHdhbnQgdG8gZGlzYWJsZSBvYnNlcnZhdGlvbiBpbnNpZGUgYSBjb21wb25lbnQncwogICAqIHVwZGF0ZSBjb21wdXRhdGlvbi4KICAgKi8KICB2YXIgc2hvdWxkT2JzZXJ2ZSA9IHRydWU7CgogIGZ1bmN0aW9uIHRvZ2dsZU9ic2VydmluZyAodmFsdWUpIHsKICAgIHNob3VsZE9ic2VydmUgPSB2YWx1ZTsKICB9CgogIC8qKgogICAqIE9ic2VydmVyIGNsYXNzIHRoYXQgaXMgYXR0YWNoZWQgdG8gZWFjaCBvYnNlcnZlZAogICAqIG9iamVjdC4gT25jZSBhdHRhY2hlZCwgdGhlIG9ic2VydmVyIGNvbnZlcnRzIHRoZSB0YXJnZXQKICAgKiBvYmplY3QncyBwcm9wZXJ0eSBrZXlzIGludG8gZ2V0dGVyL3NldHRlcnMgdGhhdAogICAqIGNvbGxlY3QgZGVwZW5kZW5jaWVzIGFuZCBkaXNwYXRjaCB1cGRhdGVzLgogICAqLwogIHZhciBPYnNlcnZlciA9IGZ1bmN0aW9uIE9ic2VydmVyICh2YWx1ZSkgewogICAgdGhpcy52YWx1ZSA9IHZhbHVlOwogICAgdGhpcy5kZXAgPSBuZXcgRGVwKCk7CiAgICB0aGlzLnZtQ291bnQgPSAwOwogICAgZGVmKHZhbHVlLCAnX19vYl9fJywgdGhpcyk7CiAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHsKICAgICAgaWYgKGhhc1Byb3RvKSB7CiAgICAgICAgcHJvdG9BdWdtZW50KHZhbHVlLCBhcnJheU1ldGhvZHMpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvcHlBdWdtZW50KHZhbHVlLCBhcnJheU1ldGhvZHMsIGFycmF5S2V5cyk7CiAgICAgIH0KICAgICAgdGhpcy5vYnNlcnZlQXJyYXkodmFsdWUpOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy53YWxrKHZhbHVlKTsKICAgIH0KICB9OwoKICAvKioKICAgKiBXYWxrIHRocm91Z2ggYWxsIHByb3BlcnRpZXMgYW5kIGNvbnZlcnQgdGhlbSBpbnRvCiAgICogZ2V0dGVyL3NldHRlcnMuIFRoaXMgbWV0aG9kIHNob3VsZCBvbmx5IGJlIGNhbGxlZCB3aGVuCiAgICogdmFsdWUgdHlwZSBpcyBPYmplY3QuCiAgICovCiAgT2JzZXJ2ZXIucHJvdG90eXBlLndhbGsgPSBmdW5jdGlvbiB3YWxrIChvYmopIHsKICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqKTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgewogICAgICBkZWZpbmVSZWFjdGl2ZSQkMShvYmosIGtleXNbaV0pOwogICAgfQogIH07CgogIC8qKgogICAqIE9ic2VydmUgYSBsaXN0IG9mIEFycmF5IGl0ZW1zLgogICAqLwogIE9ic2VydmVyLnByb3RvdHlwZS5vYnNlcnZlQXJyYXkgPSBmdW5jdGlvbiBvYnNlcnZlQXJyYXkgKGl0ZW1zKSB7CiAgICBmb3IgKHZhciBpID0gMCwgbCA9IGl0ZW1zLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICBvYnNlcnZlKGl0ZW1zW2ldKTsKICAgIH0KICB9OwoKICAvLyBoZWxwZXJzCgogIC8qKgogICAqIEF1Z21lbnQgYSB0YXJnZXQgT2JqZWN0IG9yIEFycmF5IGJ5IGludGVyY2VwdGluZwogICAqIHRoZSBwcm90b3R5cGUgY2hhaW4gdXNpbmcgX19wcm90b19fCiAgICovCiAgZnVuY3Rpb24gcHJvdG9BdWdtZW50ICh0YXJnZXQsIHNyYykgewogICAgLyogZXNsaW50LWRpc2FibGUgbm8tcHJvdG8gKi8KICAgIHRhcmdldC5fX3Byb3RvX18gPSBzcmM7CiAgICAvKiBlc2xpbnQtZW5hYmxlIG5vLXByb3RvICovCiAgfQoKICAvKioKICAgKiBBdWdtZW50IGEgdGFyZ2V0IE9iamVjdCBvciBBcnJheSBieSBkZWZpbmluZwogICAqIGhpZGRlbiBwcm9wZXJ0aWVzLgogICAqLwogIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgZnVuY3Rpb24gY29weUF1Z21lbnQgKHRhcmdldCwgc3JjLCBrZXlzKSB7CiAgICBmb3IgKHZhciBpID0gMCwgbCA9IGtleXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgIHZhciBrZXkgPSBrZXlzW2ldOwogICAgICBkZWYodGFyZ2V0LCBrZXksIHNyY1trZXldKTsKICAgIH0KICB9CgogIC8qKgogICAqIEF0dGVtcHQgdG8gY3JlYXRlIGFuIG9ic2VydmVyIGluc3RhbmNlIGZvciBhIHZhbHVlLAogICAqIHJldHVybnMgdGhlIG5ldyBvYnNlcnZlciBpZiBzdWNjZXNzZnVsbHkgb2JzZXJ2ZWQsCiAgICogb3IgdGhlIGV4aXN0aW5nIG9ic2VydmVyIGlmIHRoZSB2YWx1ZSBhbHJlYWR5IGhhcyBvbmUuCiAgICovCiAgZnVuY3Rpb24gb2JzZXJ2ZSAodmFsdWUsIGFzUm9vdERhdGEpIHsKICAgIGlmICghaXNPYmplY3QodmFsdWUpIHx8IHZhbHVlIGluc3RhbmNlb2YgVk5vZGUpIHsKICAgICAgcmV0dXJuCiAgICB9CiAgICB2YXIgb2I7CiAgICBpZiAoaGFzT3duKHZhbHVlLCAnX19vYl9fJykgJiYgdmFsdWUuX19vYl9fIGluc3RhbmNlb2YgT2JzZXJ2ZXIpIHsKICAgICAgb2IgPSB2YWx1ZS5fX29iX187CiAgICB9IGVsc2UgaWYgKAogICAgICBzaG91bGRPYnNlcnZlICYmCiAgICAgICFpc1NlcnZlclJlbmRlcmluZygpICYmCiAgICAgIChBcnJheS5pc0FycmF5KHZhbHVlKSB8fCBpc1BsYWluT2JqZWN0KHZhbHVlKSkgJiYKICAgICAgT2JqZWN0LmlzRXh0ZW5zaWJsZSh2YWx1ZSkgJiYKICAgICAgIXZhbHVlLl9pc1Z1ZQogICAgKSB7CiAgICAgIG9iID0gbmV3IE9ic2VydmVyKHZhbHVlKTsKICAgIH0KICAgIGlmIChhc1Jvb3REYXRhICYmIG9iKSB7CiAgICAgIG9iLnZtQ291bnQrKzsKICAgIH0KICAgIHJldHVybiBvYgogIH0KCiAgLyoqCiAgICogRGVmaW5lIGEgcmVhY3RpdmUgcHJvcGVydHkgb24gYW4gT2JqZWN0LgogICAqLwogIGZ1bmN0aW9uIGRlZmluZVJlYWN0aXZlJCQxICgKICAgIG9iaiwKICAgIGtleSwKICAgIHZhbCwKICAgIGN1c3RvbVNldHRlciwKICAgIHNoYWxsb3cKICApIHsKICAgIHZhciBkZXAgPSBuZXcgRGVwKCk7CgogICAgdmFyIHByb3BlcnR5ID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSk7CiAgICBpZiAocHJvcGVydHkgJiYgcHJvcGVydHkuY29uZmlndXJhYmxlID09PSBmYWxzZSkgewogICAgICByZXR1cm4KICAgIH0KCiAgICAvLyBjYXRlciBmb3IgcHJlLWRlZmluZWQgZ2V0dGVyL3NldHRlcnMKICAgIHZhciBnZXR0ZXIgPSBwcm9wZXJ0eSAmJiBwcm9wZXJ0eS5nZXQ7CiAgICB2YXIgc2V0dGVyID0gcHJvcGVydHkgJiYgcHJvcGVydHkuc2V0OwogICAgaWYgKCghZ2V0dGVyIHx8IHNldHRlcikgJiYgYXJndW1lbnRzLmxlbmd0aCA9PT0gMikgewogICAgICB2YWwgPSBvYmpba2V5XTsKICAgIH0KCiAgICB2YXIgY2hpbGRPYiA9ICFzaGFsbG93ICYmIG9ic2VydmUodmFsKTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgewogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgIGdldDogZnVuY3Rpb24gcmVhY3RpdmVHZXR0ZXIgKCkgewogICAgICAgIHZhciB2YWx1ZSA9IGdldHRlciA/IGdldHRlci5jYWxsKG9iaikgOiB2YWw7CiAgICAgICAgaWYgKERlcC50YXJnZXQpIHsKICAgICAgICAgIGRlcC5kZXBlbmQoKTsKICAgICAgICAgIGlmIChjaGlsZE9iKSB7CiAgICAgICAgICAgIGNoaWxkT2IuZGVwLmRlcGVuZCgpOwogICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHsKICAgICAgICAgICAgICBkZXBlbmRBcnJheSh2YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHZhbHVlCiAgICAgIH0sCiAgICAgIHNldDogZnVuY3Rpb24gcmVhY3RpdmVTZXR0ZXIgKG5ld1ZhbCkgewogICAgICAgIHZhciB2YWx1ZSA9IGdldHRlciA/IGdldHRlci5jYWxsKG9iaikgOiB2YWw7CiAgICAgICAgLyogZXNsaW50LWRpc2FibGUgbm8tc2VsZi1jb21wYXJlICovCiAgICAgICAgaWYgKG5ld1ZhbCA9PT0gdmFsdWUgfHwgKG5ld1ZhbCAhPT0gbmV3VmFsICYmIHZhbHVlICE9PSB2YWx1ZSkpIHsKICAgICAgICAgIHJldHVybgogICAgICAgIH0KICAgICAgICAvKiBlc2xpbnQtZW5hYmxlIG5vLXNlbGYtY29tcGFyZSAqLwogICAgICAgIGlmIChjdXN0b21TZXR0ZXIpIHsKICAgICAgICAgIGN1c3RvbVNldHRlcigpOwogICAgICAgIH0KICAgICAgICAvLyAjNzk4MTogZm9yIGFjY2Vzc29yIHByb3BlcnRpZXMgd2l0aG91dCBzZXR0ZXIKICAgICAgICBpZiAoZ2V0dGVyICYmICFzZXR0ZXIpIHsgcmV0dXJuIH0KICAgICAgICBpZiAoc2V0dGVyKSB7CiAgICAgICAgICBzZXR0ZXIuY2FsbChvYmosIG5ld1ZhbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhbCA9IG5ld1ZhbDsKICAgICAgICB9CiAgICAgICAgY2hpbGRPYiA9ICFzaGFsbG93ICYmIG9ic2VydmUobmV3VmFsKTsKICAgICAgICBkZXAubm90aWZ5KCk7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgLyoqCiAgICogU2V0IGEgcHJvcGVydHkgb24gYW4gb2JqZWN0LiBBZGRzIHRoZSBuZXcgcHJvcGVydHkgYW5kCiAgICogdHJpZ2dlcnMgY2hhbmdlIG5vdGlmaWNhdGlvbiBpZiB0aGUgcHJvcGVydHkgZG9lc24ndAogICAqIGFscmVhZHkgZXhpc3QuCiAgICovCiAgZnVuY3Rpb24gc2V0ICh0YXJnZXQsIGtleSwgdmFsKSB7CiAgICBpZiAoaXNVbmRlZih0YXJnZXQpIHx8IGlzUHJpbWl0aXZlKHRhcmdldCkKICAgICkgewogICAgICB3YXJuKCgiQ2Fubm90IHNldCByZWFjdGl2ZSBwcm9wZXJ0eSBvbiB1bmRlZmluZWQsIG51bGwsIG9yIHByaW1pdGl2ZSB2YWx1ZTogIiArICgodGFyZ2V0KSkpKTsKICAgIH0KICAgIGlmIChBcnJheS5pc0FycmF5KHRhcmdldCkgJiYgaXNWYWxpZEFycmF5SW5kZXgoa2V5KSkgewogICAgICB0YXJnZXQubGVuZ3RoID0gTWF0aC5tYXgodGFyZ2V0Lmxlbmd0aCwga2V5KTsKICAgICAgdGFyZ2V0LnNwbGljZShrZXksIDEsIHZhbCk7CiAgICAgIHJldHVybiB2YWwKICAgIH0KICAgIGlmIChrZXkgaW4gdGFyZ2V0ICYmICEoa2V5IGluIE9iamVjdC5wcm90b3R5cGUpKSB7CiAgICAgIHRhcmdldFtrZXldID0gdmFsOwogICAgICByZXR1cm4gdmFsCiAgICB9CiAgICB2YXIgb2IgPSAodGFyZ2V0KS5fX29iX187CiAgICBpZiAodGFyZ2V0Ll9pc1Z1ZSB8fCAob2IgJiYgb2Iudm1Db3VudCkpIHsKICAgICAgd2FybigKICAgICAgICAnQXZvaWQgYWRkaW5nIHJlYWN0aXZlIHByb3BlcnRpZXMgdG8gYSBWdWUgaW5zdGFuY2Ugb3IgaXRzIHJvb3QgJGRhdGEgJyArCiAgICAgICAgJ2F0IHJ1bnRpbWUgLSBkZWNsYXJlIGl0IHVwZnJvbnQgaW4gdGhlIGRhdGEgb3B0aW9uLicKICAgICAgKTsKICAgICAgcmV0dXJuIHZhbAogICAgfQogICAgaWYgKCFvYikgewogICAgICB0YXJnZXRba2V5XSA9IHZhbDsKICAgICAgcmV0dXJuIHZhbAogICAgfQogICAgZGVmaW5lUmVhY3RpdmUkJDEob2IudmFsdWUsIGtleSwgdmFsKTsKICAgIG9iLmRlcC5ub3RpZnkoKTsKICAgIHJldHVybiB2YWwKICB9CgogIC8qKgogICAqIERlbGV0ZSBhIHByb3BlcnR5IGFuZCB0cmlnZ2VyIGNoYW5nZSBpZiBuZWNlc3NhcnkuCiAgICovCiAgZnVuY3Rpb24gZGVsICh0YXJnZXQsIGtleSkgewogICAgaWYgKGlzVW5kZWYodGFyZ2V0KSB8fCBpc1ByaW1pdGl2ZSh0YXJnZXQpCiAgICApIHsKICAgICAgd2FybigoIkNhbm5vdCBkZWxldGUgcmVhY3RpdmUgcHJvcGVydHkgb24gdW5kZWZpbmVkLCBudWxsLCBvciBwcmltaXRpdmUgdmFsdWU6ICIgKyAoKHRhcmdldCkpKSk7CiAgICB9CiAgICBpZiAoQXJyYXkuaXNBcnJheSh0YXJnZXQpICYmIGlzVmFsaWRBcnJheUluZGV4KGtleSkpIHsKICAgICAgdGFyZ2V0LnNwbGljZShrZXksIDEpOwogICAgICByZXR1cm4KICAgIH0KICAgIHZhciBvYiA9ICh0YXJnZXQpLl9fb2JfXzsKICAgIGlmICh0YXJnZXQuX2lzVnVlIHx8IChvYiAmJiBvYi52bUNvdW50KSkgewogICAgICB3YXJuKAogICAgICAgICdBdm9pZCBkZWxldGluZyBwcm9wZXJ0aWVzIG9uIGEgVnVlIGluc3RhbmNlIG9yIGl0cyByb290ICRkYXRhICcgKwogICAgICAgICctIGp1c3Qgc2V0IGl0IHRvIG51bGwuJwogICAgICApOwogICAgICByZXR1cm4KICAgIH0KICAgIGlmICghaGFzT3duKHRhcmdldCwga2V5KSkgewogICAgICByZXR1cm4KICAgIH0KICAgIGRlbGV0ZSB0YXJnZXRba2V5XTsKICAgIGlmICghb2IpIHsKICAgICAgcmV0dXJuCiAgICB9CiAgICBvYi5kZXAubm90aWZ5KCk7CiAgfQoKICAvKioKICAgKiBDb2xsZWN0IGRlcGVuZGVuY2llcyBvbiBhcnJheSBlbGVtZW50cyB3aGVuIHRoZSBhcnJheSBpcyB0b3VjaGVkLCBzaW5jZQogICAqIHdlIGNhbm5vdCBpbnRlcmNlcHQgYXJyYXkgZWxlbWVudCBhY2Nlc3MgbGlrZSBwcm9wZXJ0eSBnZXR0ZXJzLgogICAqLwogIGZ1bmN0aW9uIGRlcGVuZEFycmF5ICh2YWx1ZSkgewogICAgZm9yICh2YXIgZSA9ICh2b2lkIDApLCBpID0gMCwgbCA9IHZhbHVlLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICBlID0gdmFsdWVbaV07CiAgICAgIGUgJiYgZS5fX29iX18gJiYgZS5fX29iX18uZGVwLmRlcGVuZCgpOwogICAgICBpZiAoQXJyYXkuaXNBcnJheShlKSkgewogICAgICAgIGRlcGVuZEFycmF5KGUpOwogICAgICB9CiAgICB9CiAgfQoKICAvKiAgKi8KCiAgLyoqCiAgICogT3B0aW9uIG92ZXJ3cml0aW5nIHN0cmF0ZWdpZXMgYXJlIGZ1bmN0aW9ucyB0aGF0IGhhbmRsZQogICAqIGhvdyB0byBtZXJnZSBhIHBhcmVudCBvcHRpb24gdmFsdWUgYW5kIGEgY2hpbGQgb3B0aW9uCiAgICogdmFsdWUgaW50byB0aGUgZmluYWwgdmFsdWUuCiAgICovCiAgdmFyIHN0cmF0cyA9IGNvbmZpZy5vcHRpb25NZXJnZVN0cmF0ZWdpZXM7CgogIC8qKgogICAqIE9wdGlvbnMgd2l0aCByZXN0cmljdGlvbnMKICAgKi8KICB7CiAgICBzdHJhdHMuZWwgPSBzdHJhdHMucHJvcHNEYXRhID0gZnVuY3Rpb24gKHBhcmVudCwgY2hpbGQsIHZtLCBrZXkpIHsKICAgICAgaWYgKCF2bSkgewogICAgICAgIHdhcm4oCiAgICAgICAgICAib3B0aW9uIFwiIiArIGtleSArICJcIiBjYW4gb25seSBiZSB1c2VkIGR1cmluZyBpbnN0YW5jZSAiICsKICAgICAgICAgICdjcmVhdGlvbiB3aXRoIHRoZSBgbmV3YCBrZXl3b3JkLicKICAgICAgICApOwogICAgICB9CiAgICAgIHJldHVybiBkZWZhdWx0U3RyYXQocGFyZW50LCBjaGlsZCkKICAgIH07CiAgfQoKICAvKioKICAgKiBIZWxwZXIgdGhhdCByZWN1cnNpdmVseSBtZXJnZXMgdHdvIGRhdGEgb2JqZWN0cyB0b2dldGhlci4KICAgKi8KICBmdW5jdGlvbiBtZXJnZURhdGEgKHRvLCBmcm9tKSB7CiAgICBpZiAoIWZyb20pIHsgcmV0dXJuIHRvIH0KICAgIHZhciBrZXksIHRvVmFsLCBmcm9tVmFsOwoKICAgIHZhciBrZXlzID0gaGFzU3ltYm9sCiAgICAgID8gUmVmbGVjdC5vd25LZXlzKGZyb20pCiAgICAgIDogT2JqZWN0LmtleXMoZnJvbSk7CgogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGtleSA9IGtleXNbaV07CiAgICAgIC8vIGluIGNhc2UgdGhlIG9iamVjdCBpcyBhbHJlYWR5IG9ic2VydmVkLi4uCiAgICAgIGlmIChrZXkgPT09ICdfX29iX18nKSB7IGNvbnRpbnVlIH0KICAgICAgdG9WYWwgPSB0b1trZXldOwogICAgICBmcm9tVmFsID0gZnJvbVtrZXldOwogICAgICBpZiAoIWhhc093bih0bywga2V5KSkgewogICAgICAgIHNldCh0bywga2V5LCBmcm9tVmFsKTsKICAgICAgfSBlbHNlIGlmICgKICAgICAgICB0b1ZhbCAhPT0gZnJvbVZhbCAmJgogICAgICAgIGlzUGxhaW5PYmplY3QodG9WYWwpICYmCiAgICAgICAgaXNQbGFpbk9iamVjdChmcm9tVmFsKQogICAgICApIHsKICAgICAgICBtZXJnZURhdGEodG9WYWwsIGZyb21WYWwpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdG8KICB9CgogIC8qKgogICAqIERhdGEKICAgKi8KICBmdW5jdGlvbiBtZXJnZURhdGFPckZuICgKICAgIHBhcmVudFZhbCwKICAgIGNoaWxkVmFsLAogICAgdm0KICApIHsKICAgIGlmICghdm0pIHsKICAgICAgLy8gaW4gYSBWdWUuZXh0ZW5kIG1lcmdlLCBib3RoIHNob3VsZCBiZSBmdW5jdGlvbnMKICAgICAgaWYgKCFjaGlsZFZhbCkgewogICAgICAgIHJldHVybiBwYXJlbnRWYWwKICAgICAgfQogICAgICBpZiAoIXBhcmVudFZhbCkgewogICAgICAgIHJldHVybiBjaGlsZFZhbAogICAgICB9CiAgICAgIC8vIHdoZW4gcGFyZW50VmFsICYgY2hpbGRWYWwgYXJlIGJvdGggcHJlc2VudCwKICAgICAgLy8gd2UgbmVlZCB0byByZXR1cm4gYSBmdW5jdGlvbiB0aGF0IHJldHVybnMgdGhlCiAgICAgIC8vIG1lcmdlZCByZXN1bHQgb2YgYm90aCBmdW5jdGlvbnMuLi4gbm8gbmVlZCB0bwogICAgICAvLyBjaGVjayBpZiBwYXJlbnRWYWwgaXMgYSBmdW5jdGlvbiBoZXJlIGJlY2F1c2UKICAgICAgLy8gaXQgaGFzIHRvIGJlIGEgZnVuY3Rpb24gdG8gcGFzcyBwcmV2aW91cyBtZXJnZXMuCiAgICAgIHJldHVybiBmdW5jdGlvbiBtZXJnZWREYXRhRm4gKCkgewogICAgICAgIHJldHVybiBtZXJnZURhdGEoCiAgICAgICAgICB0eXBlb2YgY2hpbGRWYWwgPT09ICdmdW5jdGlvbicgPyBjaGlsZFZhbC5jYWxsKHRoaXMsIHRoaXMpIDogY2hpbGRWYWwsCiAgICAgICAgICB0eXBlb2YgcGFyZW50VmFsID09PSAnZnVuY3Rpb24nID8gcGFyZW50VmFsLmNhbGwodGhpcywgdGhpcykgOiBwYXJlbnRWYWwKICAgICAgICApCiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiBtZXJnZWRJbnN0YW5jZURhdGFGbiAoKSB7CiAgICAgICAgLy8gaW5zdGFuY2UgbWVyZ2UKICAgICAgICB2YXIgaW5zdGFuY2VEYXRhID0gdHlwZW9mIGNoaWxkVmFsID09PSAnZnVuY3Rpb24nCiAgICAgICAgICA/IGNoaWxkVmFsLmNhbGwodm0sIHZtKQogICAgICAgICAgOiBjaGlsZFZhbDsKICAgICAgICB2YXIgZGVmYXVsdERhdGEgPSB0eXBlb2YgcGFyZW50VmFsID09PSAnZnVuY3Rpb24nCiAgICAgICAgICA/IHBhcmVudFZhbC5jYWxsKHZtLCB2bSkKICAgICAgICAgIDogcGFyZW50VmFsOwogICAgICAgIGlmIChpbnN0YW5jZURhdGEpIHsKICAgICAgICAgIHJldHVybiBtZXJnZURhdGEoaW5zdGFuY2VEYXRhLCBkZWZhdWx0RGF0YSkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIGRlZmF1bHREYXRhCiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICBzdHJhdHMuZGF0YSA9IGZ1bmN0aW9uICgKICAgIHBhcmVudFZhbCwKICAgIGNoaWxkVmFsLAogICAgdm0KICApIHsKICAgIGlmICghdm0pIHsKICAgICAgaWYgKGNoaWxkVmFsICYmIHR5cGVvZiBjaGlsZFZhbCAhPT0gJ2Z1bmN0aW9uJykgewogICAgICAgIHdhcm4oCiAgICAgICAgICAnVGhlICJkYXRhIiBvcHRpb24gc2hvdWxkIGJlIGEgZnVuY3Rpb24gJyArCiAgICAgICAgICAndGhhdCByZXR1cm5zIGEgcGVyLWluc3RhbmNlIHZhbHVlIGluIGNvbXBvbmVudCAnICsKICAgICAgICAgICdkZWZpbml0aW9ucy4nLAogICAgICAgICAgdm0KICAgICAgICApOwoKICAgICAgICByZXR1cm4gcGFyZW50VmFsCiAgICAgIH0KICAgICAgcmV0dXJuIG1lcmdlRGF0YU9yRm4ocGFyZW50VmFsLCBjaGlsZFZhbCkKICAgIH0KCiAgICByZXR1cm4gbWVyZ2VEYXRhT3JGbihwYXJlbnRWYWwsIGNoaWxkVmFsLCB2bSkKICB9OwoKICAvKioKICAgKiBIb29rcyBhbmQgcHJvcHMgYXJlIG1lcmdlZCBhcyBhcnJheXMuCiAgICovCiAgZnVuY3Rpb24gbWVyZ2VIb29rICgKICAgIHBhcmVudFZhbCwKICAgIGNoaWxkVmFsCiAgKSB7CiAgICB2YXIgcmVzID0gY2hpbGRWYWwKICAgICAgPyBwYXJlbnRWYWwKICAgICAgICA/IHBhcmVudFZhbC5jb25jYXQoY2hpbGRWYWwpCiAgICAgICAgOiBBcnJheS5pc0FycmF5KGNoaWxkVmFsKQogICAgICAgICAgPyBjaGlsZFZhbAogICAgICAgICAgOiBbY2hpbGRWYWxdCiAgICAgIDogcGFyZW50VmFsOwogICAgcmV0dXJuIHJlcwogICAgICA/IGRlZHVwZUhvb2tzKHJlcykKICAgICAgOiByZXMKICB9CgogIGZ1bmN0aW9uIGRlZHVwZUhvb2tzIChob29rcykgewogICAgdmFyIHJlcyA9IFtdOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBob29rcy5sZW5ndGg7IGkrKykgewogICAgICBpZiAocmVzLmluZGV4T2YoaG9va3NbaV0pID09PSAtMSkgewogICAgICAgIHJlcy5wdXNoKGhvb2tzW2ldKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlcwogIH0KCiAgTElGRUNZQ0xFX0hPT0tTLmZvckVhY2goZnVuY3Rpb24gKGhvb2spIHsKICAgIHN0cmF0c1tob29rXSA9IG1lcmdlSG9vazsKICB9KTsKCiAgLyoqCiAgICogQXNzZXRzCiAgICoKICAgKiBXaGVuIGEgdm0gaXMgcHJlc2VudCAoaW5zdGFuY2UgY3JlYXRpb24pLCB3ZSBuZWVkIHRvIGRvCiAgICogYSB0aHJlZS13YXkgbWVyZ2UgYmV0d2VlbiBjb25zdHJ1Y3RvciBvcHRpb25zLCBpbnN0YW5jZQogICAqIG9wdGlvbnMgYW5kIHBhcmVudCBvcHRpb25zLgogICAqLwogIGZ1bmN0aW9uIG1lcmdlQXNzZXRzICgKICAgIHBhcmVudFZhbCwKICAgIGNoaWxkVmFsLAogICAgdm0sCiAgICBrZXkKICApIHsKICAgIHZhciByZXMgPSBPYmplY3QuY3JlYXRlKHBhcmVudFZhbCB8fCBudWxsKTsKICAgIGlmIChjaGlsZFZhbCkgewogICAgICBhc3NlcnRPYmplY3RUeXBlKGtleSwgY2hpbGRWYWwsIHZtKTsKICAgICAgcmV0dXJuIGV4dGVuZChyZXMsIGNoaWxkVmFsKQogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHJlcwogICAgfQogIH0KCiAgQVNTRVRfVFlQRVMuZm9yRWFjaChmdW5jdGlvbiAodHlwZSkgewogICAgc3RyYXRzW3R5cGUgKyAncyddID0gbWVyZ2VBc3NldHM7CiAgfSk7CgogIC8qKgogICAqIFdhdGNoZXJzLgogICAqCiAgICogV2F0Y2hlcnMgaGFzaGVzIHNob3VsZCBub3Qgb3ZlcndyaXRlIG9uZQogICAqIGFub3RoZXIsIHNvIHdlIG1lcmdlIHRoZW0gYXMgYXJyYXlzLgogICAqLwogIHN0cmF0cy53YXRjaCA9IGZ1bmN0aW9uICgKICAgIHBhcmVudFZhbCwKICAgIGNoaWxkVmFsLAogICAgdm0sCiAgICBrZXkKICApIHsKICAgIC8vIHdvcmsgYXJvdW5kIEZpcmVmb3gncyBPYmplY3QucHJvdG90eXBlLndhdGNoLi4uCiAgICBpZiAocGFyZW50VmFsID09PSBuYXRpdmVXYXRjaCkgeyBwYXJlbnRWYWwgPSB1bmRlZmluZWQ7IH0KICAgIGlmIChjaGlsZFZhbCA9PT0gbmF0aXZlV2F0Y2gpIHsgY2hpbGRWYWwgPSB1bmRlZmluZWQ7IH0KICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgaWYgKCFjaGlsZFZhbCkgeyByZXR1cm4gT2JqZWN0LmNyZWF0ZShwYXJlbnRWYWwgfHwgbnVsbCkgfQogICAgewogICAgICBhc3NlcnRPYmplY3RUeXBlKGtleSwgY2hpbGRWYWwsIHZtKTsKICAgIH0KICAgIGlmICghcGFyZW50VmFsKSB7IHJldHVybiBjaGlsZFZhbCB9CiAgICB2YXIgcmV0ID0ge307CiAgICBleHRlbmQocmV0LCBwYXJlbnRWYWwpOwogICAgZm9yICh2YXIga2V5JDEgaW4gY2hpbGRWYWwpIHsKICAgICAgdmFyIHBhcmVudCA9IHJldFtrZXkkMV07CiAgICAgIHZhciBjaGlsZCA9IGNoaWxkVmFsW2tleSQxXTsKICAgICAgaWYgKHBhcmVudCAmJiAhQXJyYXkuaXNBcnJheShwYXJlbnQpKSB7CiAgICAgICAgcGFyZW50ID0gW3BhcmVudF07CiAgICAgIH0KICAgICAgcmV0W2tleSQxXSA9IHBhcmVudAogICAgICAgID8gcGFyZW50LmNvbmNhdChjaGlsZCkKICAgICAgICA6IEFycmF5LmlzQXJyYXkoY2hpbGQpID8gY2hpbGQgOiBbY2hpbGRdOwogICAgfQogICAgcmV0dXJuIHJldAogIH07CgogIC8qKgogICAqIE90aGVyIG9iamVjdCBoYXNoZXMuCiAgICovCiAgc3RyYXRzLnByb3BzID0KICBzdHJhdHMubWV0aG9kcyA9CiAgc3RyYXRzLmluamVjdCA9CiAgc3RyYXRzLmNvbXB1dGVkID0gZnVuY3Rpb24gKAogICAgcGFyZW50VmFsLAogICAgY2hpbGRWYWwsCiAgICB2bSwKICAgIGtleQogICkgewogICAgaWYgKGNoaWxkVmFsICYmICJkZXZlbG9wbWVudCIgIT09ICdwcm9kdWN0aW9uJykgewogICAgICBhc3NlcnRPYmplY3RUeXBlKGtleSwgY2hpbGRWYWwsIHZtKTsKICAgIH0KICAgIGlmICghcGFyZW50VmFsKSB7IHJldHVybiBjaGlsZFZhbCB9CiAgICB2YXIgcmV0ID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGV4dGVuZChyZXQsIHBhcmVudFZhbCk7CiAgICBpZiAoY2hpbGRWYWwpIHsgZXh0ZW5kKHJldCwgY2hpbGRWYWwpOyB9CiAgICByZXR1cm4gcmV0CiAgfTsKICBzdHJhdHMucHJvdmlkZSA9IG1lcmdlRGF0YU9yRm47CgogIC8qKgogICAqIERlZmF1bHQgc3RyYXRlZ3kuCiAgICovCiAgdmFyIGRlZmF1bHRTdHJhdCA9IGZ1bmN0aW9uIChwYXJlbnRWYWwsIGNoaWxkVmFsKSB7CiAgICByZXR1cm4gY2hpbGRWYWwgPT09IHVuZGVmaW5lZAogICAgICA/IHBhcmVudFZhbAogICAgICA6IGNoaWxkVmFsCiAgfTsKCiAgLyoqCiAgICogVmFsaWRhdGUgY29tcG9uZW50IG5hbWVzCiAgICovCiAgZnVuY3Rpb24gY2hlY2tDb21wb25lbnRzIChvcHRpb25zKSB7CiAgICBmb3IgKHZhciBrZXkgaW4gb3B0aW9ucy5jb21wb25lbnRzKSB7CiAgICAgIHZhbGlkYXRlQ29tcG9uZW50TmFtZShrZXkpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gdmFsaWRhdGVDb21wb25lbnROYW1lIChuYW1lKSB7CiAgICBpZiAoIW5ldyBSZWdFeHAoKCJeW2EtekEtWl1bXFwtXFwuMC05XyIgKyAodW5pY29kZVJlZ0V4cC5zb3VyY2UpICsgIl0qJCIpKS50ZXN0KG5hbWUpKSB7CiAgICAgIHdhcm4oCiAgICAgICAgJ0ludmFsaWQgY29tcG9uZW50IG5hbWU6ICInICsgbmFtZSArICciLiBDb21wb25lbnQgbmFtZXMgJyArCiAgICAgICAgJ3Nob3VsZCBjb25mb3JtIHRvIHZhbGlkIGN1c3RvbSBlbGVtZW50IG5hbWUgaW4gaHRtbDUgc3BlY2lmaWNhdGlvbi4nCiAgICAgICk7CiAgICB9CiAgICBpZiAoaXNCdWlsdEluVGFnKG5hbWUpIHx8IGNvbmZpZy5pc1Jlc2VydmVkVGFnKG5hbWUpKSB7CiAgICAgIHdhcm4oCiAgICAgICAgJ0RvIG5vdCB1c2UgYnVpbHQtaW4gb3IgcmVzZXJ2ZWQgSFRNTCBlbGVtZW50cyBhcyBjb21wb25lbnQgJyArCiAgICAgICAgJ2lkOiAnICsgbmFtZQogICAgICApOwogICAgfQogIH0KCiAgLyoqCiAgICogRW5zdXJlIGFsbCBwcm9wcyBvcHRpb24gc3ludGF4IGFyZSBub3JtYWxpemVkIGludG8gdGhlCiAgICogT2JqZWN0LWJhc2VkIGZvcm1hdC4KICAgKi8KICBmdW5jdGlvbiBub3JtYWxpemVQcm9wcyAob3B0aW9ucywgdm0pIHsKICAgIHZhciBwcm9wcyA9IG9wdGlvbnMucHJvcHM7CiAgICBpZiAoIXByb3BzKSB7IHJldHVybiB9CiAgICB2YXIgcmVzID0ge307CiAgICB2YXIgaSwgdmFsLCBuYW1lOwogICAgaWYgKEFycmF5LmlzQXJyYXkocHJvcHMpKSB7CiAgICAgIGkgPSBwcm9wcy5sZW5ndGg7CiAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICB2YWwgPSBwcm9wc1tpXTsKICAgICAgICBpZiAodHlwZW9mIHZhbCA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgIG5hbWUgPSBjYW1lbGl6ZSh2YWwpOwogICAgICAgICAgcmVzW25hbWVdID0geyB0eXBlOiBudWxsIH07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHdhcm4oJ3Byb3BzIG11c3QgYmUgc3RyaW5ncyB3aGVuIHVzaW5nIGFycmF5IHN5bnRheC4nKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoaXNQbGFpbk9iamVjdChwcm9wcykpIHsKICAgICAgZm9yICh2YXIga2V5IGluIHByb3BzKSB7CiAgICAgICAgdmFsID0gcHJvcHNba2V5XTsKICAgICAgICBuYW1lID0gY2FtZWxpemUoa2V5KTsKICAgICAgICByZXNbbmFtZV0gPSBpc1BsYWluT2JqZWN0KHZhbCkKICAgICAgICAgID8gdmFsCiAgICAgICAgICA6IHsgdHlwZTogdmFsIH07CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHdhcm4oCiAgICAgICAgIkludmFsaWQgdmFsdWUgZm9yIG9wdGlvbiBcInByb3BzXCI6IGV4cGVjdGVkIGFuIEFycmF5IG9yIGFuIE9iamVjdCwgIiArCiAgICAgICAgImJ1dCBnb3QgIiArICh0b1Jhd1R5cGUocHJvcHMpKSArICIuIiwKICAgICAgICB2bQogICAgICApOwogICAgfQogICAgb3B0aW9ucy5wcm9wcyA9IHJlczsKICB9CgogIC8qKgogICAqIE5vcm1hbGl6ZSBhbGwgaW5qZWN0aW9ucyBpbnRvIE9iamVjdC1iYXNlZCBmb3JtYXQKICAgKi8KICBmdW5jdGlvbiBub3JtYWxpemVJbmplY3QgKG9wdGlvbnMsIHZtKSB7CiAgICB2YXIgaW5qZWN0ID0gb3B0aW9ucy5pbmplY3Q7CiAgICBpZiAoIWluamVjdCkgeyByZXR1cm4gfQogICAgdmFyIG5vcm1hbGl6ZWQgPSBvcHRpb25zLmluamVjdCA9IHt9OwogICAgaWYgKEFycmF5LmlzQXJyYXkoaW5qZWN0KSkgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGluamVjdC5sZW5ndGg7IGkrKykgewogICAgICAgIG5vcm1hbGl6ZWRbaW5qZWN0W2ldXSA9IHsgZnJvbTogaW5qZWN0W2ldIH07CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoaXNQbGFpbk9iamVjdChpbmplY3QpKSB7CiAgICAgIGZvciAodmFyIGtleSBpbiBpbmplY3QpIHsKICAgICAgICB2YXIgdmFsID0gaW5qZWN0W2tleV07CiAgICAgICAgbm9ybWFsaXplZFtrZXldID0gaXNQbGFpbk9iamVjdCh2YWwpCiAgICAgICAgICA/IGV4dGVuZCh7IGZyb206IGtleSB9LCB2YWwpCiAgICAgICAgICA6IHsgZnJvbTogdmFsIH07CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHdhcm4oCiAgICAgICAgIkludmFsaWQgdmFsdWUgZm9yIG9wdGlvbiBcImluamVjdFwiOiBleHBlY3RlZCBhbiBBcnJheSBvciBhbiBPYmplY3QsICIgKwogICAgICAgICJidXQgZ290ICIgKyAodG9SYXdUeXBlKGluamVjdCkpICsgIi4iLAogICAgICAgIHZtCiAgICAgICk7CiAgICB9CiAgfQoKICAvKioKICAgKiBOb3JtYWxpemUgcmF3IGZ1bmN0aW9uIGRpcmVjdGl2ZXMgaW50byBvYmplY3QgZm9ybWF0LgogICAqLwogIGZ1bmN0aW9uIG5vcm1hbGl6ZURpcmVjdGl2ZXMgKG9wdGlvbnMpIHsKICAgIHZhciBkaXJzID0gb3B0aW9ucy5kaXJlY3RpdmVzOwogICAgaWYgKGRpcnMpIHsKICAgICAgZm9yICh2YXIga2V5IGluIGRpcnMpIHsKICAgICAgICB2YXIgZGVmJCQxID0gZGlyc1trZXldOwogICAgICAgIGlmICh0eXBlb2YgZGVmJCQxID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICBkaXJzW2tleV0gPSB7IGJpbmQ6IGRlZiQkMSwgdXBkYXRlOiBkZWYkJDEgfTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGFzc2VydE9iamVjdFR5cGUgKG5hbWUsIHZhbHVlLCB2bSkgewogICAgaWYgKCFpc1BsYWluT2JqZWN0KHZhbHVlKSkgewogICAgICB3YXJuKAogICAgICAgICJJbnZhbGlkIHZhbHVlIGZvciBvcHRpb24gXCIiICsgbmFtZSArICJcIjogZXhwZWN0ZWQgYW4gT2JqZWN0LCAiICsKICAgICAgICAiYnV0IGdvdCAiICsgKHRvUmF3VHlwZSh2YWx1ZSkpICsgIi4iLAogICAgICAgIHZtCiAgICAgICk7CiAgICB9CiAgfQoKICAvKioKICAgKiBNZXJnZSB0d28gb3B0aW9uIG9iamVjdHMgaW50byBhIG5ldyBvbmUuCiAgICogQ29yZSB1dGlsaXR5IHVzZWQgaW4gYm90aCBpbnN0YW50aWF0aW9uIGFuZCBpbmhlcml0YW5jZS4KICAgKi8KICBmdW5jdGlvbiBtZXJnZU9wdGlvbnMgKAogICAgcGFyZW50LAogICAgY2hpbGQsCiAgICB2bQogICkgewogICAgewogICAgICBjaGVja0NvbXBvbmVudHMoY2hpbGQpOwogICAgfQoKICAgIGlmICh0eXBlb2YgY2hpbGQgPT09ICdmdW5jdGlvbicpIHsKICAgICAgY2hpbGQgPSBjaGlsZC5vcHRpb25zOwogICAgfQoKICAgIG5vcm1hbGl6ZVByb3BzKGNoaWxkLCB2bSk7CiAgICBub3JtYWxpemVJbmplY3QoY2hpbGQsIHZtKTsKICAgIG5vcm1hbGl6ZURpcmVjdGl2ZXMoY2hpbGQpOwoKICAgIC8vIEFwcGx5IGV4dGVuZHMgYW5kIG1peGlucyBvbiB0aGUgY2hpbGQgb3B0aW9ucywKICAgIC8vIGJ1dCBvbmx5IGlmIGl0IGlzIGEgcmF3IG9wdGlvbnMgb2JqZWN0IHRoYXQgaXNuJ3QKICAgIC8vIHRoZSByZXN1bHQgb2YgYW5vdGhlciBtZXJnZU9wdGlvbnMgY2FsbC4KICAgIC8vIE9ubHkgbWVyZ2VkIG9wdGlvbnMgaGFzIHRoZSBfYmFzZSBwcm9wZXJ0eS4KICAgIGlmICghY2hpbGQuX2Jhc2UpIHsKICAgICAgaWYgKGNoaWxkLmV4dGVuZHMpIHsKICAgICAgICBwYXJlbnQgPSBtZXJnZU9wdGlvbnMocGFyZW50LCBjaGlsZC5leHRlbmRzLCB2bSk7CiAgICAgIH0KICAgICAgaWYgKGNoaWxkLm1peGlucykgewogICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gY2hpbGQubWl4aW5zLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAgcGFyZW50ID0gbWVyZ2VPcHRpb25zKHBhcmVudCwgY2hpbGQubWl4aW5zW2ldLCB2bSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgdmFyIG9wdGlvbnMgPSB7fTsKICAgIHZhciBrZXk7CiAgICBmb3IgKGtleSBpbiBwYXJlbnQpIHsKICAgICAgbWVyZ2VGaWVsZChrZXkpOwogICAgfQogICAgZm9yIChrZXkgaW4gY2hpbGQpIHsKICAgICAgaWYgKCFoYXNPd24ocGFyZW50LCBrZXkpKSB7CiAgICAgICAgbWVyZ2VGaWVsZChrZXkpOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBtZXJnZUZpZWxkIChrZXkpIHsKICAgICAgdmFyIHN0cmF0ID0gc3RyYXRzW2tleV0gfHwgZGVmYXVsdFN0cmF0OwogICAgICBvcHRpb25zW2tleV0gPSBzdHJhdChwYXJlbnRba2V5XSwgY2hpbGRba2V5XSwgdm0sIGtleSk7CiAgICB9CiAgICByZXR1cm4gb3B0aW9ucwogIH0KCiAgLyoqCiAgICogUmVzb2x2ZSBhbiBhc3NldC4KICAgKiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgYmVjYXVzZSBjaGlsZCBpbnN0YW5jZXMgbmVlZCBhY2Nlc3MKICAgKiB0byBhc3NldHMgZGVmaW5lZCBpbiBpdHMgYW5jZXN0b3IgY2hhaW4uCiAgICovCiAgZnVuY3Rpb24gcmVzb2x2ZUFzc2V0ICgKICAgIG9wdGlvbnMsCiAgICB0eXBlLAogICAgaWQsCiAgICB3YXJuTWlzc2luZwogICkgewogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAodHlwZW9mIGlkICE9PSAnc3RyaW5nJykgewogICAgICByZXR1cm4KICAgIH0KICAgIHZhciBhc3NldHMgPSBvcHRpb25zW3R5cGVdOwogICAgLy8gY2hlY2sgbG9jYWwgcmVnaXN0cmF0aW9uIHZhcmlhdGlvbnMgZmlyc3QKICAgIGlmIChoYXNPd24oYXNzZXRzLCBpZCkpIHsgcmV0dXJuIGFzc2V0c1tpZF0gfQogICAgdmFyIGNhbWVsaXplZElkID0gY2FtZWxpemUoaWQpOwogICAgaWYgKGhhc093bihhc3NldHMsIGNhbWVsaXplZElkKSkgeyByZXR1cm4gYXNzZXRzW2NhbWVsaXplZElkXSB9CiAgICB2YXIgUGFzY2FsQ2FzZUlkID0gY2FwaXRhbGl6ZShjYW1lbGl6ZWRJZCk7CiAgICBpZiAoaGFzT3duKGFzc2V0cywgUGFzY2FsQ2FzZUlkKSkgeyByZXR1cm4gYXNzZXRzW1Bhc2NhbENhc2VJZF0gfQogICAgLy8gZmFsbGJhY2sgdG8gcHJvdG90eXBlIGNoYWluCiAgICB2YXIgcmVzID0gYXNzZXRzW2lkXSB8fCBhc3NldHNbY2FtZWxpemVkSWRdIHx8IGFzc2V0c1tQYXNjYWxDYXNlSWRdOwogICAgaWYgKHdhcm5NaXNzaW5nICYmICFyZXMpIHsKICAgICAgd2FybigKICAgICAgICAnRmFpbGVkIHRvIHJlc29sdmUgJyArIHR5cGUuc2xpY2UoMCwgLTEpICsgJzogJyArIGlkLAogICAgICAgIG9wdGlvbnMKICAgICAgKTsKICAgIH0KICAgIHJldHVybiByZXMKICB9CgogIC8qICAqLwoKCgogIGZ1bmN0aW9uIHZhbGlkYXRlUHJvcCAoCiAgICBrZXksCiAgICBwcm9wT3B0aW9ucywKICAgIHByb3BzRGF0YSwKICAgIHZtCiAgKSB7CiAgICB2YXIgcHJvcCA9IHByb3BPcHRpb25zW2tleV07CiAgICB2YXIgYWJzZW50ID0gIWhhc093bihwcm9wc0RhdGEsIGtleSk7CiAgICB2YXIgdmFsdWUgPSBwcm9wc0RhdGFba2V5XTsKICAgIC8vIGJvb2xlYW4gY2FzdGluZwogICAgdmFyIGJvb2xlYW5JbmRleCA9IGdldFR5cGVJbmRleChCb29sZWFuLCBwcm9wLnR5cGUpOwogICAgaWYgKGJvb2xlYW5JbmRleCA+IC0xKSB7CiAgICAgIGlmIChhYnNlbnQgJiYgIWhhc093bihwcm9wLCAnZGVmYXVsdCcpKSB7CiAgICAgICAgdmFsdWUgPSBmYWxzZTsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gJycgfHwgdmFsdWUgPT09IGh5cGhlbmF0ZShrZXkpKSB7CiAgICAgICAgLy8gb25seSBjYXN0IGVtcHR5IHN0cmluZyAvIHNhbWUgbmFtZSB0byBib29sZWFuIGlmCiAgICAgICAgLy8gYm9vbGVhbiBoYXMgaGlnaGVyIHByaW9yaXR5CiAgICAgICAgdmFyIHN0cmluZ0luZGV4ID0gZ2V0VHlwZUluZGV4KFN0cmluZywgcHJvcC50eXBlKTsKICAgICAgICBpZiAoc3RyaW5nSW5kZXggPCAwIHx8IGJvb2xlYW5JbmRleCA8IHN0cmluZ0luZGV4KSB7CiAgICAgICAgICB2YWx1ZSA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvLyBjaGVjayBkZWZhdWx0IHZhbHVlCiAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICB2YWx1ZSA9IGdldFByb3BEZWZhdWx0VmFsdWUodm0sIHByb3AsIGtleSk7CiAgICAgIC8vIHNpbmNlIHRoZSBkZWZhdWx0IHZhbHVlIGlzIGEgZnJlc2ggY29weSwKICAgICAgLy8gbWFrZSBzdXJlIHRvIG9ic2VydmUgaXQuCiAgICAgIHZhciBwcmV2U2hvdWxkT2JzZXJ2ZSA9IHNob3VsZE9ic2VydmU7CiAgICAgIHRvZ2dsZU9ic2VydmluZyh0cnVlKTsKICAgICAgb2JzZXJ2ZSh2YWx1ZSk7CiAgICAgIHRvZ2dsZU9ic2VydmluZyhwcmV2U2hvdWxkT2JzZXJ2ZSk7CiAgICB9CiAgICB7CiAgICAgIGFzc2VydFByb3AocHJvcCwga2V5LCB2YWx1ZSwgdm0sIGFic2VudCk7CiAgICB9CiAgICByZXR1cm4gdmFsdWUKICB9CgogIC8qKgogICAqIEdldCB0aGUgZGVmYXVsdCB2YWx1ZSBvZiBhIHByb3AuCiAgICovCiAgZnVuY3Rpb24gZ2V0UHJvcERlZmF1bHRWYWx1ZSAodm0sIHByb3AsIGtleSkgewogICAgLy8gbm8gZGVmYXVsdCwgcmV0dXJuIHVuZGVmaW5lZAogICAgaWYgKCFoYXNPd24ocHJvcCwgJ2RlZmF1bHQnKSkgewogICAgICByZXR1cm4gdW5kZWZpbmVkCiAgICB9CiAgICB2YXIgZGVmID0gcHJvcC5kZWZhdWx0OwogICAgLy8gd2FybiBhZ2FpbnN0IG5vbi1mYWN0b3J5IGRlZmF1bHRzIGZvciBPYmplY3QgJiBBcnJheQogICAgaWYgKGlzT2JqZWN0KGRlZikpIHsKICAgICAgd2FybigKICAgICAgICAnSW52YWxpZCBkZWZhdWx0IHZhbHVlIGZvciBwcm9wICInICsga2V5ICsgJyI6ICcgKwogICAgICAgICdQcm9wcyB3aXRoIHR5cGUgT2JqZWN0L0FycmF5IG11c3QgdXNlIGEgZmFjdG9yeSBmdW5jdGlvbiAnICsKICAgICAgICAndG8gcmV0dXJuIHRoZSBkZWZhdWx0IHZhbHVlLicsCiAgICAgICAgdm0KICAgICAgKTsKICAgIH0KICAgIC8vIHRoZSByYXcgcHJvcCB2YWx1ZSB3YXMgYWxzbyB1bmRlZmluZWQgZnJvbSBwcmV2aW91cyByZW5kZXIsCiAgICAvLyByZXR1cm4gcHJldmlvdXMgZGVmYXVsdCB2YWx1ZSB0byBhdm9pZCB1bm5lY2Vzc2FyeSB3YXRjaGVyIHRyaWdnZXIKICAgIGlmICh2bSAmJiB2bS4kb3B0aW9ucy5wcm9wc0RhdGEgJiYKICAgICAgdm0uJG9wdGlvbnMucHJvcHNEYXRhW2tleV0gPT09IHVuZGVmaW5lZCAmJgogICAgICB2bS5fcHJvcHNba2V5XSAhPT0gdW5kZWZpbmVkCiAgICApIHsKICAgICAgcmV0dXJuIHZtLl9wcm9wc1trZXldCiAgICB9CiAgICAvLyBjYWxsIGZhY3RvcnkgZnVuY3Rpb24gZm9yIG5vbi1GdW5jdGlvbiB0eXBlcwogICAgLy8gYSB2YWx1ZSBpcyBGdW5jdGlvbiBpZiBpdHMgcHJvdG90eXBlIGlzIGZ1bmN0aW9uIGV2ZW4gYWNyb3NzIGRpZmZlcmVudCBleGVjdXRpb24gY29udGV4dAogICAgcmV0dXJuIHR5cGVvZiBkZWYgPT09ICdmdW5jdGlvbicgJiYgZ2V0VHlwZShwcm9wLnR5cGUpICE9PSAnRnVuY3Rpb24nCiAgICAgID8gZGVmLmNhbGwodm0pCiAgICAgIDogZGVmCiAgfQoKICAvKioKICAgKiBBc3NlcnQgd2hldGhlciBhIHByb3AgaXMgdmFsaWQuCiAgICovCiAgZnVuY3Rpb24gYXNzZXJ0UHJvcCAoCiAgICBwcm9wLAogICAgbmFtZSwKICAgIHZhbHVlLAogICAgdm0sCiAgICBhYnNlbnQKICApIHsKICAgIGlmIChwcm9wLnJlcXVpcmVkICYmIGFic2VudCkgewogICAgICB3YXJuKAogICAgICAgICdNaXNzaW5nIHJlcXVpcmVkIHByb3A6ICInICsgbmFtZSArICciJywKICAgICAgICB2bQogICAgICApOwogICAgICByZXR1cm4KICAgIH0KICAgIGlmICh2YWx1ZSA9PSBudWxsICYmICFwcm9wLnJlcXVpcmVkKSB7CiAgICAgIHJldHVybgogICAgfQogICAgdmFyIHR5cGUgPSBwcm9wLnR5cGU7CiAgICB2YXIgdmFsaWQgPSAhdHlwZSB8fCB0eXBlID09PSB0cnVlOwogICAgdmFyIGV4cGVjdGVkVHlwZXMgPSBbXTsKICAgIGlmICh0eXBlKSB7CiAgICAgIGlmICghQXJyYXkuaXNBcnJheSh0eXBlKSkgewogICAgICAgIHR5cGUgPSBbdHlwZV07CiAgICAgIH0KICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0eXBlLmxlbmd0aCAmJiAhdmFsaWQ7IGkrKykgewogICAgICAgIHZhciBhc3NlcnRlZFR5cGUgPSBhc3NlcnRUeXBlKHZhbHVlLCB0eXBlW2ldKTsKICAgICAgICBleHBlY3RlZFR5cGVzLnB1c2goYXNzZXJ0ZWRUeXBlLmV4cGVjdGVkVHlwZSB8fCAnJyk7CiAgICAgICAgdmFsaWQgPSBhc3NlcnRlZFR5cGUudmFsaWQ7CiAgICAgIH0KICAgIH0KCiAgICBpZiAoIXZhbGlkKSB7CiAgICAgIHdhcm4oCiAgICAgICAgZ2V0SW52YWxpZFR5cGVNZXNzYWdlKG5hbWUsIHZhbHVlLCBleHBlY3RlZFR5cGVzKSwKICAgICAgICB2bQogICAgICApOwogICAgICByZXR1cm4KICAgIH0KICAgIHZhciB2YWxpZGF0b3IgPSBwcm9wLnZhbGlkYXRvcjsKICAgIGlmICh2YWxpZGF0b3IpIHsKICAgICAgaWYgKCF2YWxpZGF0b3IodmFsdWUpKSB7CiAgICAgICAgd2FybigKICAgICAgICAgICdJbnZhbGlkIHByb3A6IGN1c3RvbSB2YWxpZGF0b3IgY2hlY2sgZmFpbGVkIGZvciBwcm9wICInICsgbmFtZSArICciLicsCiAgICAgICAgICB2bQogICAgICAgICk7CiAgICAgIH0KICAgIH0KICB9CgogIHZhciBzaW1wbGVDaGVja1JFID0gL14oU3RyaW5nfE51bWJlcnxCb29sZWFufEZ1bmN0aW9ufFN5bWJvbCkkLzsKCiAgZnVuY3Rpb24gYXNzZXJ0VHlwZSAodmFsdWUsIHR5cGUpIHsKICAgIHZhciB2YWxpZDsKICAgIHZhciBleHBlY3RlZFR5cGUgPSBnZXRUeXBlKHR5cGUpOwogICAgaWYgKHNpbXBsZUNoZWNrUkUudGVzdChleHBlY3RlZFR5cGUpKSB7CiAgICAgIHZhciB0ID0gdHlwZW9mIHZhbHVlOwogICAgICB2YWxpZCA9IHQgPT09IGV4cGVjdGVkVHlwZS50b0xvd2VyQ2FzZSgpOwogICAgICAvLyBmb3IgcHJpbWl0aXZlIHdyYXBwZXIgb2JqZWN0cwogICAgICBpZiAoIXZhbGlkICYmIHQgPT09ICdvYmplY3QnKSB7CiAgICAgICAgdmFsaWQgPSB2YWx1ZSBpbnN0YW5jZW9mIHR5cGU7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoZXhwZWN0ZWRUeXBlID09PSAnT2JqZWN0JykgewogICAgICB2YWxpZCA9IGlzUGxhaW5PYmplY3QodmFsdWUpOwogICAgfSBlbHNlIGlmIChleHBlY3RlZFR5cGUgPT09ICdBcnJheScpIHsKICAgICAgdmFsaWQgPSBBcnJheS5pc0FycmF5KHZhbHVlKTsKICAgIH0gZWxzZSB7CiAgICAgIHZhbGlkID0gdmFsdWUgaW5zdGFuY2VvZiB0eXBlOwogICAgfQogICAgcmV0dXJuIHsKICAgICAgdmFsaWQ6IHZhbGlkLAogICAgICBleHBlY3RlZFR5cGU6IGV4cGVjdGVkVHlwZQogICAgfQogIH0KCiAgLyoqCiAgICogVXNlIGZ1bmN0aW9uIHN0cmluZyBuYW1lIHRvIGNoZWNrIGJ1aWx0LWluIHR5cGVzLAogICAqIGJlY2F1c2UgYSBzaW1wbGUgZXF1YWxpdHkgY2hlY2sgd2lsbCBmYWlsIHdoZW4gcnVubmluZwogICAqIGFjcm9zcyBkaWZmZXJlbnQgdm1zIC8gaWZyYW1lcy4KICAgKi8KICBmdW5jdGlvbiBnZXRUeXBlIChmbikgewogICAgdmFyIG1hdGNoID0gZm4gJiYgZm4udG9TdHJpbmcoKS5tYXRjaCgvXlxzKmZ1bmN0aW9uIChcdyspLyk7CiAgICByZXR1cm4gbWF0Y2ggPyBtYXRjaFsxXSA6ICcnCiAgfQoKICBmdW5jdGlvbiBpc1NhbWVUeXBlIChhLCBiKSB7CiAgICByZXR1cm4gZ2V0VHlwZShhKSA9PT0gZ2V0VHlwZShiKQogIH0KCiAgZnVuY3Rpb24gZ2V0VHlwZUluZGV4ICh0eXBlLCBleHBlY3RlZFR5cGVzKSB7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkoZXhwZWN0ZWRUeXBlcykpIHsKICAgICAgcmV0dXJuIGlzU2FtZVR5cGUoZXhwZWN0ZWRUeXBlcywgdHlwZSkgPyAwIDogLTEKICAgIH0KICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBleHBlY3RlZFR5cGVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgIGlmIChpc1NhbWVUeXBlKGV4cGVjdGVkVHlwZXNbaV0sIHR5cGUpKSB7CiAgICAgICAgcmV0dXJuIGkKICAgICAgfQogICAgfQogICAgcmV0dXJuIC0xCiAgfQoKICBmdW5jdGlvbiBnZXRJbnZhbGlkVHlwZU1lc3NhZ2UgKG5hbWUsIHZhbHVlLCBleHBlY3RlZFR5cGVzKSB7CiAgICB2YXIgbWVzc2FnZSA9ICJJbnZhbGlkIHByb3A6IHR5cGUgY2hlY2sgZmFpbGVkIGZvciBwcm9wIFwiIiArIG5hbWUgKyAiXCIuIiArCiAgICAgICIgRXhwZWN0ZWQgIiArIChleHBlY3RlZFR5cGVzLm1hcChjYXBpdGFsaXplKS5qb2luKCcsICcpKTsKICAgIHZhciBleHBlY3RlZFR5cGUgPSBleHBlY3RlZFR5cGVzWzBdOwogICAgdmFyIHJlY2VpdmVkVHlwZSA9IHRvUmF3VHlwZSh2YWx1ZSk7CiAgICB2YXIgZXhwZWN0ZWRWYWx1ZSA9IHN0eWxlVmFsdWUodmFsdWUsIGV4cGVjdGVkVHlwZSk7CiAgICB2YXIgcmVjZWl2ZWRWYWx1ZSA9IHN0eWxlVmFsdWUodmFsdWUsIHJlY2VpdmVkVHlwZSk7CiAgICAvLyBjaGVjayBpZiB3ZSBuZWVkIHRvIHNwZWNpZnkgZXhwZWN0ZWQgdmFsdWUKICAgIGlmIChleHBlY3RlZFR5cGVzLmxlbmd0aCA9PT0gMSAmJgogICAgICAgIGlzRXhwbGljYWJsZShleHBlY3RlZFR5cGUpICYmCiAgICAgICAgIWlzQm9vbGVhbihleHBlY3RlZFR5cGUsIHJlY2VpdmVkVHlwZSkpIHsKICAgICAgbWVzc2FnZSArPSAiIHdpdGggdmFsdWUgIiArIGV4cGVjdGVkVmFsdWU7CiAgICB9CiAgICBtZXNzYWdlICs9ICIsIGdvdCAiICsgcmVjZWl2ZWRUeXBlICsgIiAiOwogICAgLy8gY2hlY2sgaWYgd2UgbmVlZCB0byBzcGVjaWZ5IHJlY2VpdmVkIHZhbHVlCiAgICBpZiAoaXNFeHBsaWNhYmxlKHJlY2VpdmVkVHlwZSkpIHsKICAgICAgbWVzc2FnZSArPSAid2l0aCB2YWx1ZSAiICsgcmVjZWl2ZWRWYWx1ZSArICIuIjsKICAgIH0KICAgIHJldHVybiBtZXNzYWdlCiAgfQoKICBmdW5jdGlvbiBzdHlsZVZhbHVlICh2YWx1ZSwgdHlwZSkgewogICAgaWYgKHR5cGUgPT09ICdTdHJpbmcnKSB7CiAgICAgIHJldHVybiAoIlwiIiArIHZhbHVlICsgIlwiIikKICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ051bWJlcicpIHsKICAgICAgcmV0dXJuICgiIiArIChOdW1iZXIodmFsdWUpKSkKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiAoIiIgKyB2YWx1ZSkKICAgIH0KICB9CgogIGZ1bmN0aW9uIGlzRXhwbGljYWJsZSAodmFsdWUpIHsKICAgIHZhciBleHBsaWNpdFR5cGVzID0gWydzdHJpbmcnLCAnbnVtYmVyJywgJ2Jvb2xlYW4nXTsKICAgIHJldHVybiBleHBsaWNpdFR5cGVzLnNvbWUoZnVuY3Rpb24gKGVsZW0pIHsgcmV0dXJuIHZhbHVlLnRvTG93ZXJDYXNlKCkgPT09IGVsZW07IH0pCiAgfQoKICBmdW5jdGlvbiBpc0Jvb2xlYW4gKCkgewogICAgdmFyIGFyZ3MgPSBbXSwgbGVuID0gYXJndW1lbnRzLmxlbmd0aDsKICAgIHdoaWxlICggbGVuLS0gKSBhcmdzWyBsZW4gXSA9IGFyZ3VtZW50c1sgbGVuIF07CgogICAgcmV0dXJuIGFyZ3Muc29tZShmdW5jdGlvbiAoZWxlbSkgeyByZXR1cm4gZWxlbS50b0xvd2VyQ2FzZSgpID09PSAnYm9vbGVhbic7IH0pCiAgfQoKICAvKiAgKi8KCiAgZnVuY3Rpb24gaGFuZGxlRXJyb3IgKGVyciwgdm0sIGluZm8pIHsKICAgIC8vIERlYWN0aXZhdGUgZGVwcyB0cmFja2luZyB3aGlsZSBwcm9jZXNzaW5nIGVycm9yIGhhbmRsZXIgdG8gYXZvaWQgcG9zc2libGUgaW5maW5pdGUgcmVuZGVyaW5nLgogICAgLy8gU2VlOiBodHRwczovL2dpdGh1Yi5jb20vdnVlanMvdnVleC9pc3N1ZXMvMTUwNQogICAgcHVzaFRhcmdldCgpOwogICAgdHJ5IHsKICAgICAgaWYgKHZtKSB7CiAgICAgICAgdmFyIGN1ciA9IHZtOwogICAgICAgIHdoaWxlICgoY3VyID0gY3VyLiRwYXJlbnQpKSB7CiAgICAgICAgICB2YXIgaG9va3MgPSBjdXIuJG9wdGlvbnMuZXJyb3JDYXB0dXJlZDsKICAgICAgICAgIGlmIChob29rcykgewogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhvb2tzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHZhciBjYXB0dXJlID0gaG9va3NbaV0uY2FsbChjdXIsIGVyciwgdm0sIGluZm8pID09PSBmYWxzZTsKICAgICAgICAgICAgICAgIGlmIChjYXB0dXJlKSB7IHJldHVybiB9CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgZ2xvYmFsSGFuZGxlRXJyb3IoZSwgY3VyLCAnZXJyb3JDYXB0dXJlZCBob29rJyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGdsb2JhbEhhbmRsZUVycm9yKGVyciwgdm0sIGluZm8pOwogICAgfSBmaW5hbGx5IHsKICAgICAgcG9wVGFyZ2V0KCk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBpbnZva2VXaXRoRXJyb3JIYW5kbGluZyAoCiAgICBoYW5kbGVyLAogICAgY29udGV4dCwKICAgIGFyZ3MsCiAgICB2bSwKICAgIGluZm8KICApIHsKICAgIHZhciByZXM7CiAgICB0cnkgewogICAgICByZXMgPSBhcmdzID8gaGFuZGxlci5hcHBseShjb250ZXh0LCBhcmdzKSA6IGhhbmRsZXIuY2FsbChjb250ZXh0KTsKICAgICAgaWYgKHJlcyAmJiAhcmVzLl9pc1Z1ZSAmJiBpc1Byb21pc2UocmVzKSAmJiAhcmVzLl9oYW5kbGVkKSB7CiAgICAgICAgcmVzLmNhdGNoKGZ1bmN0aW9uIChlKSB7IHJldHVybiBoYW5kbGVFcnJvcihlLCB2bSwgaW5mbyArICIgKFByb21pc2UvYXN5bmMpIik7IH0pOwogICAgICAgIC8vIGlzc3VlICM5NTExCiAgICAgICAgLy8gYXZvaWQgY2F0Y2ggdHJpZ2dlcmluZyBtdWx0aXBsZSB0aW1lcyB3aGVuIG5lc3RlZCBjYWxscwogICAgICAgIHJlcy5faGFuZGxlZCA9IHRydWU7CiAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgaGFuZGxlRXJyb3IoZSwgdm0sIGluZm8pOwogICAgfQogICAgcmV0dXJuIHJlcwogIH0KCiAgZnVuY3Rpb24gZ2xvYmFsSGFuZGxlRXJyb3IgKGVyciwgdm0sIGluZm8pIHsKICAgIGlmIChjb25maWcuZXJyb3JIYW5kbGVyKSB7CiAgICAgIHRyeSB7CiAgICAgICAgcmV0dXJuIGNvbmZpZy5lcnJvckhhbmRsZXIuY2FsbChudWxsLCBlcnIsIHZtLCBpbmZvKQogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgLy8gaWYgdGhlIHVzZXIgaW50ZW50aW9uYWxseSB0aHJvd3MgdGhlIG9yaWdpbmFsIGVycm9yIGluIHRoZSBoYW5kbGVyLAogICAgICAgIC8vIGRvIG5vdCBsb2cgaXQgdHdpY2UKICAgICAgICBpZiAoZSAhPT0gZXJyKSB7CiAgICAgICAgICBsb2dFcnJvcihlLCBudWxsLCAnY29uZmlnLmVycm9ySGFuZGxlcicpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgbG9nRXJyb3IoZXJyLCB2bSwgaW5mbyk7CiAgfQoKICBmdW5jdGlvbiBsb2dFcnJvciAoZXJyLCB2bSwgaW5mbykgewogICAgewogICAgICB3YXJuKCgiRXJyb3IgaW4gIiArIGluZm8gKyAiOiBcIiIgKyAoZXJyLnRvU3RyaW5nKCkpICsgIlwiIiksIHZtKTsKICAgIH0KICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovCiAgICBpZiAoKGluQnJvd3NlciB8fCBpbldlZXgpICYmIHR5cGVvZiBjb25zb2xlICE9PSAndW5kZWZpbmVkJykgewogICAgICBjb25zb2xlLmVycm9yKGVycik7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBlcnIKICAgIH0KICB9CgogIC8qICAqLwoKICB2YXIgaXNVc2luZ01pY3JvVGFzayA9IGZhbHNlOwoKICB2YXIgY2FsbGJhY2tzID0gW107CiAgdmFyIHBlbmRpbmcgPSBmYWxzZTsKCiAgZnVuY3Rpb24gZmx1c2hDYWxsYmFja3MgKCkgewogICAgcGVuZGluZyA9IGZhbHNlOwogICAgdmFyIGNvcGllcyA9IGNhbGxiYWNrcy5zbGljZSgwKTsKICAgIGNhbGxiYWNrcy5sZW5ndGggPSAwOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb3BpZXMubGVuZ3RoOyBpKyspIHsKICAgICAgY29waWVzW2ldKCk7CiAgICB9CiAgfQoKICAvLyBIZXJlIHdlIGhhdmUgYXN5bmMgZGVmZXJyaW5nIHdyYXBwZXJzIHVzaW5nIG1pY3JvdGFza3MuCiAgLy8gSW4gMi41IHdlIHVzZWQgKG1hY3JvKSB0YXNrcyAoaW4gY29tYmluYXRpb24gd2l0aCBtaWNyb3Rhc2tzKS4KICAvLyBIb3dldmVyLCBpdCBoYXMgc3VidGxlIHByb2JsZW1zIHdoZW4gc3RhdGUgaXMgY2hhbmdlZCByaWdodCBiZWZvcmUgcmVwYWludAogIC8vIChlLmcuICM2ODEzLCBvdXQtaW4gdHJhbnNpdGlvbnMpLgogIC8vIEFsc28sIHVzaW5nIChtYWNybykgdGFza3MgaW4gZXZlbnQgaGFuZGxlciB3b3VsZCBjYXVzZSBzb21lIHdlaXJkIGJlaGF2aW9ycwogIC8vIHRoYXQgY2Fubm90IGJlIGNpcmN1bXZlbnRlZCAoZS5nLiAjNzEwOSwgIzcxNTMsICM3NTQ2LCAjNzgzNCwgIzgxMDkpLgogIC8vIFNvIHdlIG5vdyB1c2UgbWljcm90YXNrcyBldmVyeXdoZXJlLCBhZ2Fpbi4KICAvLyBBIG1ham9yIGRyYXdiYWNrIG9mIHRoaXMgdHJhZGVvZmYgaXMgdGhhdCB0aGVyZSBhcmUgc29tZSBzY2VuYXJpb3MKICAvLyB3aGVyZSBtaWNyb3Rhc2tzIGhhdmUgdG9vIGhpZ2ggYSBwcmlvcml0eSBhbmQgZmlyZSBpbiBiZXR3ZWVuIHN1cHBvc2VkbHkKICAvLyBzZXF1ZW50aWFsIGV2ZW50cyAoZS5nLiAjNDUyMSwgIzY2OTAsIHdoaWNoIGhhdmUgd29ya2Fyb3VuZHMpCiAgLy8gb3IgZXZlbiBiZXR3ZWVuIGJ1YmJsaW5nIG9mIHRoZSBzYW1lIGV2ZW50ICgjNjU2NikuCiAgdmFyIHRpbWVyRnVuYzsKCiAgLy8gVGhlIG5leHRUaWNrIGJlaGF2aW9yIGxldmVyYWdlcyB0aGUgbWljcm90YXNrIHF1ZXVlLCB3aGljaCBjYW4gYmUgYWNjZXNzZWQKICAvLyB2aWEgZWl0aGVyIG5hdGl2ZSBQcm9taXNlLnRoZW4gb3IgTXV0YXRpb25PYnNlcnZlci4KICAvLyBNdXRhdGlvbk9ic2VydmVyIGhhcyB3aWRlciBzdXBwb3J0LCBob3dldmVyIGl0IGlzIHNlcmlvdXNseSBidWdnZWQgaW4KICAvLyBVSVdlYlZpZXcgaW4gaU9TID49IDkuMy4zIHdoZW4gdHJpZ2dlcmVkIGluIHRvdWNoIGV2ZW50IGhhbmRsZXJzLiBJdAogIC8vIGNvbXBsZXRlbHkgc3RvcHMgd29ya2luZyBhZnRlciB0cmlnZ2VyaW5nIGEgZmV3IHRpbWVzLi4uIHNvLCBpZiBuYXRpdmUKICAvLyBQcm9taXNlIGlzIGF2YWlsYWJsZSwgd2Ugd2lsbCB1c2UgaXQ6CiAgLyogaXN0YW5idWwgaWdub3JlIG5leHQsICRmbG93LWRpc2FibGUtbGluZSAqLwogIGlmICh0eXBlb2YgUHJvbWlzZSAhPT0gJ3VuZGVmaW5lZCcgJiYgaXNOYXRpdmUoUHJvbWlzZSkpIHsKICAgIHZhciBwID0gUHJvbWlzZS5yZXNvbHZlKCk7CiAgICB0aW1lckZ1bmMgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHAudGhlbihmbHVzaENhbGxiYWNrcyk7CiAgICAgIC8vIEluIHByb2JsZW1hdGljIFVJV2ViVmlld3MsIFByb21pc2UudGhlbiBkb2Vzbid0IGNvbXBsZXRlbHkgYnJlYWssIGJ1dAogICAgICAvLyBpdCBjYW4gZ2V0IHN0dWNrIGluIGEgd2VpcmQgc3RhdGUgd2hlcmUgY2FsbGJhY2tzIGFyZSBwdXNoZWQgaW50byB0aGUKICAgICAgLy8gbWljcm90YXNrIHF1ZXVlIGJ1dCB0aGUgcXVldWUgaXNuJ3QgYmVpbmcgZmx1c2hlZCwgdW50aWwgdGhlIGJyb3dzZXIKICAgICAgLy8gbmVlZHMgdG8gZG8gc29tZSBvdGhlciB3b3JrLCBlLmcuIGhhbmRsZSBhIHRpbWVyLiBUaGVyZWZvcmUgd2UgY2FuCiAgICAgIC8vICJmb3JjZSIgdGhlIG1pY3JvdGFzayBxdWV1ZSB0byBiZSBmbHVzaGVkIGJ5IGFkZGluZyBhbiBlbXB0eSB0aW1lci4KICAgICAgaWYgKGlzSU9TKSB7IHNldFRpbWVvdXQobm9vcCk7IH0KICAgIH07CiAgICBpc1VzaW5nTWljcm9UYXNrID0gdHJ1ZTsKICB9IGVsc2UgaWYgKCFpc0lFICYmIHR5cGVvZiBNdXRhdGlvbk9ic2VydmVyICE9PSAndW5kZWZpbmVkJyAmJiAoCiAgICBpc05hdGl2ZShNdXRhdGlvbk9ic2VydmVyKSB8fAogICAgLy8gUGhhbnRvbUpTIGFuZCBpT1MgNy54CiAgICBNdXRhdGlvbk9ic2VydmVyLnRvU3RyaW5nKCkgPT09ICdbb2JqZWN0IE11dGF0aW9uT2JzZXJ2ZXJDb25zdHJ1Y3Rvcl0nCiAgKSkgewogICAgLy8gVXNlIE11dGF0aW9uT2JzZXJ2ZXIgd2hlcmUgbmF0aXZlIFByb21pc2UgaXMgbm90IGF2YWlsYWJsZSwKICAgIC8vIGUuZy4gUGhhbnRvbUpTLCBpT1M3LCBBbmRyb2lkIDQuNAogICAgLy8gKCM2NDY2IE11dGF0aW9uT2JzZXJ2ZXIgaXMgdW5yZWxpYWJsZSBpbiBJRTExKQogICAgdmFyIGNvdW50ZXIgPSAxOwogICAgdmFyIG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoZmx1c2hDYWxsYmFja3MpOwogICAgdmFyIHRleHROb2RlID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoU3RyaW5nKGNvdW50ZXIpKTsKICAgIG9ic2VydmVyLm9ic2VydmUodGV4dE5vZGUsIHsKICAgICAgY2hhcmFjdGVyRGF0YTogdHJ1ZQogICAgfSk7CiAgICB0aW1lckZ1bmMgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGNvdW50ZXIgPSAoY291bnRlciArIDEpICUgMjsKICAgICAgdGV4dE5vZGUuZGF0YSA9IFN0cmluZyhjb3VudGVyKTsKICAgIH07CiAgICBpc1VzaW5nTWljcm9UYXNrID0gdHJ1ZTsKICB9IGVsc2UgaWYgKHR5cGVvZiBzZXRJbW1lZGlhdGUgIT09ICd1bmRlZmluZWQnICYmIGlzTmF0aXZlKHNldEltbWVkaWF0ZSkpIHsKICAgIC8vIEZhbGxiYWNrIHRvIHNldEltbWVkaWF0ZS4KICAgIC8vIFRlY2hpbmljYWxseSBpdCBsZXZlcmFnZXMgdGhlIChtYWNybykgdGFzayBxdWV1ZSwKICAgIC8vIGJ1dCBpdCBpcyBzdGlsbCBhIGJldHRlciBjaG9pY2UgdGhhbiBzZXRUaW1lb3V0LgogICAgdGltZXJGdW5jID0gZnVuY3Rpb24gKCkgewogICAgICBzZXRJbW1lZGlhdGUoZmx1c2hDYWxsYmFja3MpOwogICAgfTsKICB9IGVsc2UgewogICAgLy8gRmFsbGJhY2sgdG8gc2V0VGltZW91dC4KICAgIHRpbWVyRnVuYyA9IGZ1bmN0aW9uICgpIHsKICAgICAgc2V0VGltZW91dChmbHVzaENhbGxiYWNrcywgMCk7CiAgICB9OwogIH0KCiAgZnVuY3Rpb24gbmV4dFRpY2sgKGNiLCBjdHgpIHsKICAgIHZhciBfcmVzb2x2ZTsKICAgIGNhbGxiYWNrcy5wdXNoKGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKGNiKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGNiLmNhbGwoY3R4KTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICBoYW5kbGVFcnJvcihlLCBjdHgsICduZXh0VGljaycpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChfcmVzb2x2ZSkgewogICAgICAgIF9yZXNvbHZlKGN0eCk7CiAgICAgIH0KICAgIH0pOwogICAgaWYgKCFwZW5kaW5nKSB7CiAgICAgIHBlbmRpbmcgPSB0cnVlOwogICAgICB0aW1lckZ1bmMoKTsKICAgIH0KICAgIC8vICRmbG93LWRpc2FibGUtbGluZQogICAgaWYgKCFjYiAmJiB0eXBlb2YgUHJvbWlzZSAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgX3Jlc29sdmUgPSByZXNvbHZlOwogICAgICB9KQogICAgfQogIH0KCiAgLyogICovCgogIHZhciBtYXJrOwogIHZhciBtZWFzdXJlOwoKICB7CiAgICB2YXIgcGVyZiA9IGluQnJvd3NlciAmJiB3aW5kb3cucGVyZm9ybWFuY2U7CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgIGlmICgKICAgICAgcGVyZiAmJgogICAgICBwZXJmLm1hcmsgJiYKICAgICAgcGVyZi5tZWFzdXJlICYmCiAgICAgIHBlcmYuY2xlYXJNYXJrcyAmJgogICAgICBwZXJmLmNsZWFyTWVhc3VyZXMKICAgICkgewogICAgICBtYXJrID0gZnVuY3Rpb24gKHRhZykgeyByZXR1cm4gcGVyZi5tYXJrKHRhZyk7IH07CiAgICAgIG1lYXN1cmUgPSBmdW5jdGlvbiAobmFtZSwgc3RhcnRUYWcsIGVuZFRhZykgewogICAgICAgIHBlcmYubWVhc3VyZShuYW1lLCBzdGFydFRhZywgZW5kVGFnKTsKICAgICAgICBwZXJmLmNsZWFyTWFya3Moc3RhcnRUYWcpOwogICAgICAgIHBlcmYuY2xlYXJNYXJrcyhlbmRUYWcpOwogICAgICAgIC8vIHBlcmYuY2xlYXJNZWFzdXJlcyhuYW1lKQogICAgICB9OwogICAgfQogIH0KCiAgLyogbm90IHR5cGUgY2hlY2tpbmcgdGhpcyBmaWxlIGJlY2F1c2UgZmxvdyBkb2Vzbid0IHBsYXkgd2VsbCB3aXRoIFByb3h5ICovCgogIHZhciBpbml0UHJveHk7CgogIHsKICAgIHZhciBhbGxvd2VkR2xvYmFscyA9IG1ha2VNYXAoCiAgICAgICdJbmZpbml0eSx1bmRlZmluZWQsTmFOLGlzRmluaXRlLGlzTmFOLCcgKwogICAgICAncGFyc2VGbG9hdCxwYXJzZUludCxkZWNvZGVVUkksZGVjb2RlVVJJQ29tcG9uZW50LGVuY29kZVVSSSxlbmNvZGVVUklDb21wb25lbnQsJyArCiAgICAgICdNYXRoLE51bWJlcixEYXRlLEFycmF5LE9iamVjdCxCb29sZWFuLFN0cmluZyxSZWdFeHAsTWFwLFNldCxKU09OLEludGwsJyArCiAgICAgICdyZXF1aXJlJyAvLyBmb3IgV2VicGFjay9Ccm93c2VyaWZ5CiAgICApOwoKICAgIHZhciB3YXJuTm9uUHJlc2VudCA9IGZ1bmN0aW9uICh0YXJnZXQsIGtleSkgewogICAgICB3YXJuKAogICAgICAgICJQcm9wZXJ0eSBvciBtZXRob2QgXCIiICsga2V5ICsgIlwiIGlzIG5vdCBkZWZpbmVkIG9uIHRoZSBpbnN0YW5jZSBidXQgIiArCiAgICAgICAgJ3JlZmVyZW5jZWQgZHVyaW5nIHJlbmRlci4gTWFrZSBzdXJlIHRoYXQgdGhpcyBwcm9wZXJ0eSBpcyByZWFjdGl2ZSwgJyArCiAgICAgICAgJ2VpdGhlciBpbiB0aGUgZGF0YSBvcHRpb24sIG9yIGZvciBjbGFzcy1iYXNlZCBjb21wb25lbnRzLCBieSAnICsKICAgICAgICAnaW5pdGlhbGl6aW5nIHRoZSBwcm9wZXJ0eS4gJyArCiAgICAgICAgJ1NlZTogaHR0cHM6Ly92dWVqcy5vcmcvdjIvZ3VpZGUvcmVhY3Rpdml0eS5odG1sI0RlY2xhcmluZy1SZWFjdGl2ZS1Qcm9wZXJ0aWVzLicsCiAgICAgICAgdGFyZ2V0CiAgICAgICk7CiAgICB9OwoKICAgIHZhciB3YXJuUmVzZXJ2ZWRQcmVmaXggPSBmdW5jdGlvbiAodGFyZ2V0LCBrZXkpIHsKICAgICAgd2FybigKICAgICAgICAiUHJvcGVydHkgXCIiICsga2V5ICsgIlwiIG11c3QgYmUgYWNjZXNzZWQgd2l0aCBcIiRkYXRhLiIgKyBrZXkgKyAiXCIgYmVjYXVzZSAiICsKICAgICAgICAncHJvcGVydGllcyBzdGFydGluZyB3aXRoICIkIiBvciAiXyIgYXJlIG5vdCBwcm94aWVkIGluIHRoZSBWdWUgaW5zdGFuY2UgdG8gJyArCiAgICAgICAgJ3ByZXZlbnQgY29uZmxpY3RzIHdpdGggVnVlIGludGVybmFscycgKwogICAgICAgICdTZWU6IGh0dHBzOi8vdnVlanMub3JnL3YyL2FwaS8jZGF0YScsCiAgICAgICAgdGFyZ2V0CiAgICAgICk7CiAgICB9OwoKICAgIHZhciBoYXNQcm94eSA9CiAgICAgIHR5cGVvZiBQcm94eSAhPT0gJ3VuZGVmaW5lZCcgJiYgaXNOYXRpdmUoUHJveHkpOwoKICAgIGlmIChoYXNQcm94eSkgewogICAgICB2YXIgaXNCdWlsdEluTW9kaWZpZXIgPSBtYWtlTWFwKCdzdG9wLHByZXZlbnQsc2VsZixjdHJsLHNoaWZ0LGFsdCxtZXRhLGV4YWN0Jyk7CiAgICAgIGNvbmZpZy5rZXlDb2RlcyA9IG5ldyBQcm94eShjb25maWcua2V5Q29kZXMsIHsKICAgICAgICBzZXQ6IGZ1bmN0aW9uIHNldCAodGFyZ2V0LCBrZXksIHZhbHVlKSB7CiAgICAgICAgICBpZiAoaXNCdWlsdEluTW9kaWZpZXIoa2V5KSkgewogICAgICAgICAgICB3YXJuKCgiQXZvaWQgb3ZlcndyaXRpbmcgYnVpbHQtaW4gbW9kaWZpZXIgaW4gY29uZmlnLmtleUNvZGVzOiAuIiArIGtleSkpOwogICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRhcmdldFtrZXldID0gdmFsdWU7CiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KCiAgICB2YXIgaGFzSGFuZGxlciA9IHsKICAgICAgaGFzOiBmdW5jdGlvbiBoYXMgKHRhcmdldCwga2V5KSB7CiAgICAgICAgdmFyIGhhcyA9IGtleSBpbiB0YXJnZXQ7CiAgICAgICAgdmFyIGlzQWxsb3dlZCA9IGFsbG93ZWRHbG9iYWxzKGtleSkgfHwKICAgICAgICAgICh0eXBlb2Yga2V5ID09PSAnc3RyaW5nJyAmJiBrZXkuY2hhckF0KDApID09PSAnXycgJiYgIShrZXkgaW4gdGFyZ2V0LiRkYXRhKSk7CiAgICAgICAgaWYgKCFoYXMgJiYgIWlzQWxsb3dlZCkgewogICAgICAgICAgaWYgKGtleSBpbiB0YXJnZXQuJGRhdGEpIHsgd2FyblJlc2VydmVkUHJlZml4KHRhcmdldCwga2V5KTsgfQogICAgICAgICAgZWxzZSB7IHdhcm5Ob25QcmVzZW50KHRhcmdldCwga2V5KTsgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gaGFzIHx8ICFpc0FsbG93ZWQKICAgICAgfQogICAgfTsKCiAgICB2YXIgZ2V0SGFuZGxlciA9IHsKICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQgKHRhcmdldCwga2V5KSB7CiAgICAgICAgaWYgKHR5cGVvZiBrZXkgPT09ICdzdHJpbmcnICYmICEoa2V5IGluIHRhcmdldCkpIHsKICAgICAgICAgIGlmIChrZXkgaW4gdGFyZ2V0LiRkYXRhKSB7IHdhcm5SZXNlcnZlZFByZWZpeCh0YXJnZXQsIGtleSk7IH0KICAgICAgICAgIGVsc2UgeyB3YXJuTm9uUHJlc2VudCh0YXJnZXQsIGtleSk7IH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRhcmdldFtrZXldCiAgICAgIH0KICAgIH07CgogICAgaW5pdFByb3h5ID0gZnVuY3Rpb24gaW5pdFByb3h5ICh2bSkgewogICAgICBpZiAoaGFzUHJveHkpIHsKICAgICAgICAvLyBkZXRlcm1pbmUgd2hpY2ggcHJveHkgaGFuZGxlciB0byB1c2UKICAgICAgICB2YXIgb3B0aW9ucyA9IHZtLiRvcHRpb25zOwogICAgICAgIHZhciBoYW5kbGVycyA9IG9wdGlvbnMucmVuZGVyICYmIG9wdGlvbnMucmVuZGVyLl93aXRoU3RyaXBwZWQKICAgICAgICAgID8gZ2V0SGFuZGxlcgogICAgICAgICAgOiBoYXNIYW5kbGVyOwogICAgICAgIHZtLl9yZW5kZXJQcm94eSA9IG5ldyBQcm94eSh2bSwgaGFuZGxlcnMpOwogICAgICB9IGVsc2UgewogICAgICAgIHZtLl9yZW5kZXJQcm94eSA9IHZtOwogICAgICB9CiAgICB9OwogIH0KCiAgLyogICovCgogIHZhciBzZWVuT2JqZWN0cyA9IG5ldyBfU2V0KCk7CgogIC8qKgogICAqIFJlY3Vyc2l2ZWx5IHRyYXZlcnNlIGFuIG9iamVjdCB0byBldm9rZSBhbGwgY29udmVydGVkCiAgICogZ2V0dGVycywgc28gdGhhdCBldmVyeSBuZXN0ZWQgcHJvcGVydHkgaW5zaWRlIHRoZSBvYmplY3QKICAgKiBpcyBjb2xsZWN0ZWQgYXMgYSAiZGVlcCIgZGVwZW5kZW5jeS4KICAgKi8KICBmdW5jdGlvbiB0cmF2ZXJzZSAodmFsKSB7CiAgICBfdHJhdmVyc2UodmFsLCBzZWVuT2JqZWN0cyk7CiAgICBzZWVuT2JqZWN0cy5jbGVhcigpOwogIH0KCiAgZnVuY3Rpb24gX3RyYXZlcnNlICh2YWwsIHNlZW4pIHsKICAgIHZhciBpLCBrZXlzOwogICAgdmFyIGlzQSA9IEFycmF5LmlzQXJyYXkodmFsKTsKICAgIGlmICgoIWlzQSAmJiAhaXNPYmplY3QodmFsKSkgfHwgT2JqZWN0LmlzRnJvemVuKHZhbCkgfHwgdmFsIGluc3RhbmNlb2YgVk5vZGUpIHsKICAgICAgcmV0dXJuCiAgICB9CiAgICBpZiAodmFsLl9fb2JfXykgewogICAgICB2YXIgZGVwSWQgPSB2YWwuX19vYl9fLmRlcC5pZDsKICAgICAgaWYgKHNlZW4uaGFzKGRlcElkKSkgewogICAgICAgIHJldHVybgogICAgICB9CiAgICAgIHNlZW4uYWRkKGRlcElkKTsKICAgIH0KICAgIGlmIChpc0EpIHsKICAgICAgaSA9IHZhbC5sZW5ndGg7CiAgICAgIHdoaWxlIChpLS0pIHsgX3RyYXZlcnNlKHZhbFtpXSwgc2Vlbik7IH0KICAgIH0gZWxzZSB7CiAgICAgIGtleXMgPSBPYmplY3Qua2V5cyh2YWwpOwogICAgICBpID0ga2V5cy5sZW5ndGg7CiAgICAgIHdoaWxlIChpLS0pIHsgX3RyYXZlcnNlKHZhbFtrZXlzW2ldXSwgc2Vlbik7IH0KICAgIH0KICB9CgogIC8qICAqLwoKICB2YXIgbm9ybWFsaXplRXZlbnQgPSBjYWNoZWQoZnVuY3Rpb24gKG5hbWUpIHsKICAgIHZhciBwYXNzaXZlID0gbmFtZS5jaGFyQXQoMCkgPT09ICcmJzsKICAgIG5hbWUgPSBwYXNzaXZlID8gbmFtZS5zbGljZSgxKSA6IG5hbWU7CiAgICB2YXIgb25jZSQkMSA9IG5hbWUuY2hhckF0KDApID09PSAnfic7IC8vIFByZWZpeGVkIGxhc3QsIGNoZWNrZWQgZmlyc3QKICAgIG5hbWUgPSBvbmNlJCQxID8gbmFtZS5zbGljZSgxKSA6IG5hbWU7CiAgICB2YXIgY2FwdHVyZSA9IG5hbWUuY2hhckF0KDApID09PSAnISc7CiAgICBuYW1lID0gY2FwdHVyZSA/IG5hbWUuc2xpY2UoMSkgOiBuYW1lOwogICAgcmV0dXJuIHsKICAgICAgbmFtZTogbmFtZSwKICAgICAgb25jZTogb25jZSQkMSwKICAgICAgY2FwdHVyZTogY2FwdHVyZSwKICAgICAgcGFzc2l2ZTogcGFzc2l2ZQogICAgfQogIH0pOwoKICBmdW5jdGlvbiBjcmVhdGVGbkludm9rZXIgKGZucywgdm0pIHsKICAgIGZ1bmN0aW9uIGludm9rZXIgKCkgewogICAgICB2YXIgYXJndW1lbnRzJDEgPSBhcmd1bWVudHM7CgogICAgICB2YXIgZm5zID0gaW52b2tlci5mbnM7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KGZucykpIHsKICAgICAgICB2YXIgY2xvbmVkID0gZm5zLnNsaWNlKCk7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjbG9uZWQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGludm9rZVdpdGhFcnJvckhhbmRsaW5nKGNsb25lZFtpXSwgbnVsbCwgYXJndW1lbnRzJDEsIHZtLCAidi1vbiBoYW5kbGVyIik7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIHJldHVybiBoYW5kbGVyIHJldHVybiB2YWx1ZSBmb3Igc2luZ2xlIGhhbmRsZXJzCiAgICAgICAgcmV0dXJuIGludm9rZVdpdGhFcnJvckhhbmRsaW5nKGZucywgbnVsbCwgYXJndW1lbnRzLCB2bSwgInYtb24gaGFuZGxlciIpCiAgICAgIH0KICAgIH0KICAgIGludm9rZXIuZm5zID0gZm5zOwogICAgcmV0dXJuIGludm9rZXIKICB9CgogIGZ1bmN0aW9uIHVwZGF0ZUxpc3RlbmVycyAoCiAgICBvbiwKICAgIG9sZE9uLAogICAgYWRkLAogICAgcmVtb3ZlJCQxLAogICAgY3JlYXRlT25jZUhhbmRsZXIsCiAgICB2bQogICkgewogICAgdmFyIG5hbWUsIGRlZiQkMSwgY3VyLCBvbGQsIGV2ZW50OwogICAgZm9yIChuYW1lIGluIG9uKSB7CiAgICAgIGRlZiQkMSA9IGN1ciA9IG9uW25hbWVdOwogICAgICBvbGQgPSBvbGRPbltuYW1lXTsKICAgICAgZXZlbnQgPSBub3JtYWxpemVFdmVudChuYW1lKTsKICAgICAgaWYgKGlzVW5kZWYoY3VyKSkgewogICAgICAgIHdhcm4oCiAgICAgICAgICAiSW52YWxpZCBoYW5kbGVyIGZvciBldmVudCBcIiIgKyAoZXZlbnQubmFtZSkgKyAiXCI6IGdvdCAiICsgU3RyaW5nKGN1ciksCiAgICAgICAgICB2bQogICAgICAgICk7CiAgICAgIH0gZWxzZSBpZiAoaXNVbmRlZihvbGQpKSB7CiAgICAgICAgaWYgKGlzVW5kZWYoY3VyLmZucykpIHsKICAgICAgICAgIGN1ciA9IG9uW25hbWVdID0gY3JlYXRlRm5JbnZva2VyKGN1ciwgdm0pOwogICAgICAgIH0KICAgICAgICBpZiAoaXNUcnVlKGV2ZW50Lm9uY2UpKSB7CiAgICAgICAgICBjdXIgPSBvbltuYW1lXSA9IGNyZWF0ZU9uY2VIYW5kbGVyKGV2ZW50Lm5hbWUsIGN1ciwgZXZlbnQuY2FwdHVyZSk7CiAgICAgICAgfQogICAgICAgIGFkZChldmVudC5uYW1lLCBjdXIsIGV2ZW50LmNhcHR1cmUsIGV2ZW50LnBhc3NpdmUsIGV2ZW50LnBhcmFtcyk7CiAgICAgIH0gZWxzZSBpZiAoY3VyICE9PSBvbGQpIHsKICAgICAgICBvbGQuZm5zID0gY3VyOwogICAgICAgIG9uW25hbWVdID0gb2xkOwogICAgICB9CiAgICB9CiAgICBmb3IgKG5hbWUgaW4gb2xkT24pIHsKICAgICAgaWYgKGlzVW5kZWYob25bbmFtZV0pKSB7CiAgICAgICAgZXZlbnQgPSBub3JtYWxpemVFdmVudChuYW1lKTsKICAgICAgICByZW1vdmUkJDEoZXZlbnQubmFtZSwgb2xkT25bbmFtZV0sIGV2ZW50LmNhcHR1cmUpOwogICAgICB9CiAgICB9CiAgfQoKICAvKiAgKi8KCiAgZnVuY3Rpb24gbWVyZ2VWTm9kZUhvb2sgKGRlZiwgaG9va0tleSwgaG9vaykgewogICAgaWYgKGRlZiBpbnN0YW5jZW9mIFZOb2RlKSB7CiAgICAgIGRlZiA9IGRlZi5kYXRhLmhvb2sgfHwgKGRlZi5kYXRhLmhvb2sgPSB7fSk7CiAgICB9CiAgICB2YXIgaW52b2tlcjsKICAgIHZhciBvbGRIb29rID0gZGVmW2hvb2tLZXldOwoKICAgIGZ1bmN0aW9uIHdyYXBwZWRIb29rICgpIHsKICAgICAgaG9vay5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAvLyBpbXBvcnRhbnQ6IHJlbW92ZSBtZXJnZWQgaG9vayB0byBlbnN1cmUgaXQncyBjYWxsZWQgb25seSBvbmNlCiAgICAgIC8vIGFuZCBwcmV2ZW50IG1lbW9yeSBsZWFrCiAgICAgIHJlbW92ZShpbnZva2VyLmZucywgd3JhcHBlZEhvb2spOwogICAgfQoKICAgIGlmIChpc1VuZGVmKG9sZEhvb2spKSB7CiAgICAgIC8vIG5vIGV4aXN0aW5nIGhvb2sKICAgICAgaW52b2tlciA9IGNyZWF0ZUZuSW52b2tlcihbd3JhcHBlZEhvb2tdKTsKICAgIH0gZWxzZSB7CiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgICBpZiAoaXNEZWYob2xkSG9vay5mbnMpICYmIGlzVHJ1ZShvbGRIb29rLm1lcmdlZCkpIHsKICAgICAgICAvLyBhbHJlYWR5IGEgbWVyZ2VkIGludm9rZXIKICAgICAgICBpbnZva2VyID0gb2xkSG9vazsKICAgICAgICBpbnZva2VyLmZucy5wdXNoKHdyYXBwZWRIb29rKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBleGlzdGluZyBwbGFpbiBob29rCiAgICAgICAgaW52b2tlciA9IGNyZWF0ZUZuSW52b2tlcihbb2xkSG9vaywgd3JhcHBlZEhvb2tdKTsKICAgICAgfQogICAgfQoKICAgIGludm9rZXIubWVyZ2VkID0gdHJ1ZTsKICAgIGRlZltob29rS2V5XSA9IGludm9rZXI7CiAgfQoKICAvKiAgKi8KCiAgZnVuY3Rpb24gZXh0cmFjdFByb3BzRnJvbVZOb2RlRGF0YSAoCiAgICBkYXRhLAogICAgQ3RvciwKICAgIHRhZwogICkgewogICAgLy8gd2UgYXJlIG9ubHkgZXh0cmFjdGluZyByYXcgdmFsdWVzIGhlcmUuCiAgICAvLyB2YWxpZGF0aW9uIGFuZCBkZWZhdWx0IHZhbHVlcyBhcmUgaGFuZGxlZCBpbiB0aGUgY2hpbGQKICAgIC8vIGNvbXBvbmVudCBpdHNlbGYuCiAgICB2YXIgcHJvcE9wdGlvbnMgPSBDdG9yLm9wdGlvbnMucHJvcHM7CiAgICBpZiAoaXNVbmRlZihwcm9wT3B0aW9ucykpIHsKICAgICAgcmV0dXJuCiAgICB9CiAgICB2YXIgcmVzID0ge307CiAgICB2YXIgYXR0cnMgPSBkYXRhLmF0dHJzOwogICAgdmFyIHByb3BzID0gZGF0YS5wcm9wczsKICAgIGlmIChpc0RlZihhdHRycykgfHwgaXNEZWYocHJvcHMpKSB7CiAgICAgIGZvciAodmFyIGtleSBpbiBwcm9wT3B0aW9ucykgewogICAgICAgIHZhciBhbHRLZXkgPSBoeXBoZW5hdGUoa2V5KTsKICAgICAgICB7CiAgICAgICAgICB2YXIga2V5SW5Mb3dlckNhc2UgPSBrZXkudG9Mb3dlckNhc2UoKTsKICAgICAgICAgIGlmICgKICAgICAgICAgICAga2V5ICE9PSBrZXlJbkxvd2VyQ2FzZSAmJgogICAgICAgICAgICBhdHRycyAmJiBoYXNPd24oYXR0cnMsIGtleUluTG93ZXJDYXNlKQogICAgICAgICAgKSB7CiAgICAgICAgICAgIHRpcCgKICAgICAgICAgICAgICAiUHJvcCBcIiIgKyBrZXlJbkxvd2VyQ2FzZSArICJcIiBpcyBwYXNzZWQgdG8gY29tcG9uZW50ICIgKwogICAgICAgICAgICAgIChmb3JtYXRDb21wb25lbnROYW1lKHRhZyB8fCBDdG9yKSkgKyAiLCBidXQgdGhlIGRlY2xhcmVkIHByb3AgbmFtZSBpcyIgKwogICAgICAgICAgICAgICIgXCIiICsga2V5ICsgIlwiLiAiICsKICAgICAgICAgICAgICAiTm90ZSB0aGF0IEhUTUwgYXR0cmlidXRlcyBhcmUgY2FzZS1pbnNlbnNpdGl2ZSBhbmQgY2FtZWxDYXNlZCAiICsKICAgICAgICAgICAgICAicHJvcHMgbmVlZCB0byB1c2UgdGhlaXIga2ViYWItY2FzZSBlcXVpdmFsZW50cyB3aGVuIHVzaW5nIGluLURPTSAiICsKICAgICAgICAgICAgICAidGVtcGxhdGVzLiBZb3Ugc2hvdWxkIHByb2JhYmx5IHVzZSBcIiIgKyBhbHRLZXkgKyAiXCIgaW5zdGVhZCBvZiBcIiIgKyBrZXkgKyAiXCIuIgogICAgICAgICAgICApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjaGVja1Byb3AocmVzLCBwcm9wcywga2V5LCBhbHRLZXksIHRydWUpIHx8CiAgICAgICAgY2hlY2tQcm9wKHJlcywgYXR0cnMsIGtleSwgYWx0S2V5LCBmYWxzZSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXMKICB9CgogIGZ1bmN0aW9uIGNoZWNrUHJvcCAoCiAgICByZXMsCiAgICBoYXNoLAogICAga2V5LAogICAgYWx0S2V5LAogICAgcHJlc2VydmUKICApIHsKICAgIGlmIChpc0RlZihoYXNoKSkgewogICAgICBpZiAoaGFzT3duKGhhc2gsIGtleSkpIHsKICAgICAgICByZXNba2V5XSA9IGhhc2hba2V5XTsKICAgICAgICBpZiAoIXByZXNlcnZlKSB7CiAgICAgICAgICBkZWxldGUgaGFzaFtrZXldOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZQogICAgICB9IGVsc2UgaWYgKGhhc093bihoYXNoLCBhbHRLZXkpKSB7CiAgICAgICAgcmVzW2tleV0gPSBoYXNoW2FsdEtleV07CiAgICAgICAgaWYgKCFwcmVzZXJ2ZSkgewogICAgICAgICAgZGVsZXRlIGhhc2hbYWx0S2V5XTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWUKICAgICAgfQogICAgfQogICAgcmV0dXJuIGZhbHNlCiAgfQoKICAvKiAgKi8KCiAgLy8gVGhlIHRlbXBsYXRlIGNvbXBpbGVyIGF0dGVtcHRzIHRvIG1pbmltaXplIHRoZSBuZWVkIGZvciBub3JtYWxpemF0aW9uIGJ5CiAgLy8gc3RhdGljYWxseSBhbmFseXppbmcgdGhlIHRlbXBsYXRlIGF0IGNvbXBpbGUgdGltZS4KICAvLwogIC8vIEZvciBwbGFpbiBIVE1MIG1hcmt1cCwgbm9ybWFsaXphdGlvbiBjYW4gYmUgY29tcGxldGVseSBza2lwcGVkIGJlY2F1c2UgdGhlCiAgLy8gZ2VuZXJhdGVkIHJlbmRlciBmdW5jdGlvbiBpcyBndWFyYW50ZWVkIHRvIHJldHVybiBBcnJheTxWTm9kZT4uIFRoZXJlIGFyZQogIC8vIHR3byBjYXNlcyB3aGVyZSBleHRyYSBub3JtYWxpemF0aW9uIGlzIG5lZWRlZDoKCiAgLy8gMS4gV2hlbiB0aGUgY2hpbGRyZW4gY29udGFpbnMgY29tcG9uZW50cyAtIGJlY2F1c2UgYSBmdW5jdGlvbmFsIGNvbXBvbmVudAogIC8vIG1heSByZXR1cm4gYW4gQXJyYXkgaW5zdGVhZCBvZiBhIHNpbmdsZSByb290LiBJbiB0aGlzIGNhc2UsIGp1c3QgYSBzaW1wbGUKICAvLyBub3JtYWxpemF0aW9uIGlzIG5lZWRlZCAtIGlmIGFueSBjaGlsZCBpcyBhbiBBcnJheSwgd2UgZmxhdHRlbiB0aGUgd2hvbGUKICAvLyB0aGluZyB3aXRoIEFycmF5LnByb3RvdHlwZS5jb25jYXQuIEl0IGlzIGd1YXJhbnRlZWQgdG8gYmUgb25seSAxLWxldmVsIGRlZXAKICAvLyBiZWNhdXNlIGZ1bmN0aW9uYWwgY29tcG9uZW50cyBhbHJlYWR5IG5vcm1hbGl6ZSB0aGVpciBvd24gY2hpbGRyZW4uCiAgZnVuY3Rpb24gc2ltcGxlTm9ybWFsaXplQ2hpbGRyZW4gKGNoaWxkcmVuKSB7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KGNoaWxkcmVuW2ldKSkgewogICAgICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuY29uY2F0LmFwcGx5KFtdLCBjaGlsZHJlbikKICAgICAgfQogICAgfQogICAgcmV0dXJuIGNoaWxkcmVuCiAgfQoKICAvLyAyLiBXaGVuIHRoZSBjaGlsZHJlbiBjb250YWlucyBjb25zdHJ1Y3RzIHRoYXQgYWx3YXlzIGdlbmVyYXRlZCBuZXN0ZWQgQXJyYXlzLAogIC8vIGUuZy4gPHRlbXBsYXRlPiwgPHNsb3Q+LCB2LWZvciwgb3Igd2hlbiB0aGUgY2hpbGRyZW4gaXMgcHJvdmlkZWQgYnkgdXNlcgogIC8vIHdpdGggaGFuZC13cml0dGVuIHJlbmRlciBmdW5jdGlvbnMgLyBKU1guIEluIHN1Y2ggY2FzZXMgYSBmdWxsIG5vcm1hbGl6YXRpb24KICAvLyBpcyBuZWVkZWQgdG8gY2F0ZXIgdG8gYWxsIHBvc3NpYmxlIHR5cGVzIG9mIGNoaWxkcmVuIHZhbHVlcy4KICBmdW5jdGlvbiBub3JtYWxpemVDaGlsZHJlbiAoY2hpbGRyZW4pIHsKICAgIHJldHVybiBpc1ByaW1pdGl2ZShjaGlsZHJlbikKICAgICAgPyBbY3JlYXRlVGV4dFZOb2RlKGNoaWxkcmVuKV0KICAgICAgOiBBcnJheS5pc0FycmF5KGNoaWxkcmVuKQogICAgICAgID8gbm9ybWFsaXplQXJyYXlDaGlsZHJlbihjaGlsZHJlbikKICAgICAgICA6IHVuZGVmaW5lZAogIH0KCiAgZnVuY3Rpb24gaXNUZXh0Tm9kZSAobm9kZSkgewogICAgcmV0dXJuIGlzRGVmKG5vZGUpICYmIGlzRGVmKG5vZGUudGV4dCkgJiYgaXNGYWxzZShub2RlLmlzQ29tbWVudCkKICB9CgogIGZ1bmN0aW9uIG5vcm1hbGl6ZUFycmF5Q2hpbGRyZW4gKGNoaWxkcmVuLCBuZXN0ZWRJbmRleCkgewogICAgdmFyIHJlcyA9IFtdOwogICAgdmFyIGksIGMsIGxhc3RJbmRleCwgbGFzdDsKICAgIGZvciAoaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICBjID0gY2hpbGRyZW5baV07CiAgICAgIGlmIChpc1VuZGVmKGMpIHx8IHR5cGVvZiBjID09PSAnYm9vbGVhbicpIHsgY29udGludWUgfQogICAgICBsYXN0SW5kZXggPSByZXMubGVuZ3RoIC0gMTsKICAgICAgbGFzdCA9IHJlc1tsYXN0SW5kZXhdOwogICAgICAvLyAgbmVzdGVkCiAgICAgIGlmIChBcnJheS5pc0FycmF5KGMpKSB7CiAgICAgICAgaWYgKGMubGVuZ3RoID4gMCkgewogICAgICAgICAgYyA9IG5vcm1hbGl6ZUFycmF5Q2hpbGRyZW4oYywgKChuZXN0ZWRJbmRleCB8fCAnJykgKyAiXyIgKyBpKSk7CiAgICAgICAgICAvLyBtZXJnZSBhZGphY2VudCB0ZXh0IG5vZGVzCiAgICAgICAgICBpZiAoaXNUZXh0Tm9kZShjWzBdKSAmJiBpc1RleHROb2RlKGxhc3QpKSB7CiAgICAgICAgICAgIHJlc1tsYXN0SW5kZXhdID0gY3JlYXRlVGV4dFZOb2RlKGxhc3QudGV4dCArIChjWzBdKS50ZXh0KTsKICAgICAgICAgICAgYy5zaGlmdCgpOwogICAgICAgICAgfQogICAgICAgICAgcmVzLnB1c2guYXBwbHkocmVzLCBjKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoaXNQcmltaXRpdmUoYykpIHsKICAgICAgICBpZiAoaXNUZXh0Tm9kZShsYXN0KSkgewogICAgICAgICAgLy8gbWVyZ2UgYWRqYWNlbnQgdGV4dCBub2RlcwogICAgICAgICAgLy8gdGhpcyBpcyBuZWNlc3NhcnkgZm9yIFNTUiBoeWRyYXRpb24gYmVjYXVzZSB0ZXh0IG5vZGVzIGFyZQogICAgICAgICAgLy8gZXNzZW50aWFsbHkgbWVyZ2VkIHdoZW4gcmVuZGVyZWQgdG8gSFRNTCBzdHJpbmdzCiAgICAgICAgICByZXNbbGFzdEluZGV4XSA9IGNyZWF0ZVRleHRWTm9kZShsYXN0LnRleHQgKyBjKTsKICAgICAgICB9IGVsc2UgaWYgKGMgIT09ICcnKSB7CiAgICAgICAgICAvLyBjb252ZXJ0IHByaW1pdGl2ZSB0byB2bm9kZQogICAgICAgICAgcmVzLnB1c2goY3JlYXRlVGV4dFZOb2RlKGMpKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGlzVGV4dE5vZGUoYykgJiYgaXNUZXh0Tm9kZShsYXN0KSkgewogICAgICAgICAgLy8gbWVyZ2UgYWRqYWNlbnQgdGV4dCBub2RlcwogICAgICAgICAgcmVzW2xhc3RJbmRleF0gPSBjcmVhdGVUZXh0Vk5vZGUobGFzdC50ZXh0ICsgYy50ZXh0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gZGVmYXVsdCBrZXkgZm9yIG5lc3RlZCBhcnJheSBjaGlsZHJlbiAobGlrZWx5IGdlbmVyYXRlZCBieSB2LWZvcikKICAgICAgICAgIGlmIChpc1RydWUoY2hpbGRyZW4uX2lzVkxpc3QpICYmCiAgICAgICAgICAgIGlzRGVmKGMudGFnKSAmJgogICAgICAgICAgICBpc1VuZGVmKGMua2V5KSAmJgogICAgICAgICAgICBpc0RlZihuZXN0ZWRJbmRleCkpIHsKICAgICAgICAgICAgYy5rZXkgPSAiX192bGlzdCIgKyBuZXN0ZWRJbmRleCArICJfIiArIGkgKyAiX18iOwogICAgICAgICAgfQogICAgICAgICAgcmVzLnB1c2goYyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzCiAgfQoKICAvKiAgKi8KCiAgZnVuY3Rpb24gaW5pdFByb3ZpZGUgKHZtKSB7CiAgICB2YXIgcHJvdmlkZSA9IHZtLiRvcHRpb25zLnByb3ZpZGU7CiAgICBpZiAocHJvdmlkZSkgewogICAgICB2bS5fcHJvdmlkZWQgPSB0eXBlb2YgcHJvdmlkZSA9PT0gJ2Z1bmN0aW9uJwogICAgICAgID8gcHJvdmlkZS5jYWxsKHZtKQogICAgICAgIDogcHJvdmlkZTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGluaXRJbmplY3Rpb25zICh2bSkgewogICAgdmFyIHJlc3VsdCA9IHJlc29sdmVJbmplY3Qodm0uJG9wdGlvbnMuaW5qZWN0LCB2bSk7CiAgICBpZiAocmVzdWx0KSB7CiAgICAgIHRvZ2dsZU9ic2VydmluZyhmYWxzZSk7CiAgICAgIE9iamVjdC5rZXlzKHJlc3VsdCkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIGVsc2UgKi8KICAgICAgICB7CiAgICAgICAgICBkZWZpbmVSZWFjdGl2ZSQkMSh2bSwga2V5LCByZXN1bHRba2V5XSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICB3YXJuKAogICAgICAgICAgICAgICJBdm9pZCBtdXRhdGluZyBhbiBpbmplY3RlZCB2YWx1ZSBkaXJlY3RseSBzaW5jZSB0aGUgY2hhbmdlcyB3aWxsIGJlICIgKwogICAgICAgICAgICAgICJvdmVyd3JpdHRlbiB3aGVuZXZlciB0aGUgcHJvdmlkZWQgY29tcG9uZW50IHJlLXJlbmRlcnMuICIgKwogICAgICAgICAgICAgICJpbmplY3Rpb24gYmVpbmcgbXV0YXRlZDogXCIiICsga2V5ICsgIlwiIiwKICAgICAgICAgICAgICB2bQogICAgICAgICAgICApOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdG9nZ2xlT2JzZXJ2aW5nKHRydWUpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gcmVzb2x2ZUluamVjdCAoaW5qZWN0LCB2bSkgewogICAgaWYgKGluamVjdCkgewogICAgICAvLyBpbmplY3QgaXMgOmFueSBiZWNhdXNlIGZsb3cgaXMgbm90IHNtYXJ0IGVub3VnaCB0byBmaWd1cmUgb3V0IGNhY2hlZAogICAgICB2YXIgcmVzdWx0ID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgdmFyIGtleXMgPSBoYXNTeW1ib2wKICAgICAgICA/IFJlZmxlY3Qub3duS2V5cyhpbmplY3QpCiAgICAgICAgOiBPYmplY3Qua2V5cyhpbmplY3QpOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBrZXlzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGtleSA9IGtleXNbaV07CiAgICAgICAgLy8gIzY1NzQgaW4gY2FzZSB0aGUgaW5qZWN0IG9iamVjdCBpcyBvYnNlcnZlZC4uLgogICAgICAgIGlmIChrZXkgPT09ICdfX29iX18nKSB7IGNvbnRpbnVlIH0KICAgICAgICB2YXIgcHJvdmlkZUtleSA9IGluamVjdFtrZXldLmZyb207CiAgICAgICAgdmFyIHNvdXJjZSA9IHZtOwogICAgICAgIHdoaWxlIChzb3VyY2UpIHsKICAgICAgICAgIGlmIChzb3VyY2UuX3Byb3ZpZGVkICYmIGhhc093bihzb3VyY2UuX3Byb3ZpZGVkLCBwcm92aWRlS2V5KSkgewogICAgICAgICAgICByZXN1bHRba2V5XSA9IHNvdXJjZS5fcHJvdmlkZWRbcHJvdmlkZUtleV07CiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICB9CiAgICAgICAgICBzb3VyY2UgPSBzb3VyY2UuJHBhcmVudDsKICAgICAgICB9CiAgICAgICAgaWYgKCFzb3VyY2UpIHsKICAgICAgICAgIGlmICgnZGVmYXVsdCcgaW4gaW5qZWN0W2tleV0pIHsKICAgICAgICAgICAgdmFyIHByb3ZpZGVEZWZhdWx0ID0gaW5qZWN0W2tleV0uZGVmYXVsdDsKICAgICAgICAgICAgcmVzdWx0W2tleV0gPSB0eXBlb2YgcHJvdmlkZURlZmF1bHQgPT09ICdmdW5jdGlvbicKICAgICAgICAgICAgICA/IHByb3ZpZGVEZWZhdWx0LmNhbGwodm0pCiAgICAgICAgICAgICAgOiBwcm92aWRlRGVmYXVsdDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHdhcm4oKCJJbmplY3Rpb24gXCIiICsga2V5ICsgIlwiIG5vdCBmb3VuZCIpLCB2bSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiByZXN1bHQKICAgIH0KICB9CgogIC8qICAqLwoKCgogIC8qKgogICAqIFJ1bnRpbWUgaGVscGVyIGZvciByZXNvbHZpbmcgcmF3IGNoaWxkcmVuIFZOb2RlcyBpbnRvIGEgc2xvdCBvYmplY3QuCiAgICovCiAgZnVuY3Rpb24gcmVzb2x2ZVNsb3RzICgKICAgIGNoaWxkcmVuLAogICAgY29udGV4dAogICkgewogICAgaWYgKCFjaGlsZHJlbiB8fCAhY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgIHJldHVybiB7fQogICAgfQogICAgdmFyIHNsb3RzID0ge307CiAgICBmb3IgKHZhciBpID0gMCwgbCA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICB2YXIgY2hpbGQgPSBjaGlsZHJlbltpXTsKICAgICAgdmFyIGRhdGEgPSBjaGlsZC5kYXRhOwogICAgICAvLyByZW1vdmUgc2xvdCBhdHRyaWJ1dGUgaWYgdGhlIG5vZGUgaXMgcmVzb2x2ZWQgYXMgYSBWdWUgc2xvdCBub2RlCiAgICAgIGlmIChkYXRhICYmIGRhdGEuYXR0cnMgJiYgZGF0YS5hdHRycy5zbG90KSB7CiAgICAgICAgZGVsZXRlIGRhdGEuYXR0cnMuc2xvdDsKICAgICAgfQogICAgICAvLyBuYW1lZCBzbG90cyBzaG91bGQgb25seSBiZSByZXNwZWN0ZWQgaWYgdGhlIHZub2RlIHdhcyByZW5kZXJlZCBpbiB0aGUKICAgICAgLy8gc2FtZSBjb250ZXh0LgogICAgICBpZiAoKGNoaWxkLmNvbnRleHQgPT09IGNvbnRleHQgfHwgY2hpbGQuZm5Db250ZXh0ID09PSBjb250ZXh0KSAmJgogICAgICAgIGRhdGEgJiYgZGF0YS5zbG90ICE9IG51bGwKICAgICAgKSB7CiAgICAgICAgdmFyIG5hbWUgPSBkYXRhLnNsb3Q7CiAgICAgICAgdmFyIHNsb3QgPSAoc2xvdHNbbmFtZV0gfHwgKHNsb3RzW25hbWVdID0gW10pKTsKICAgICAgICBpZiAoY2hpbGQudGFnID09PSAndGVtcGxhdGUnKSB7CiAgICAgICAgICBzbG90LnB1c2guYXBwbHkoc2xvdCwgY2hpbGQuY2hpbGRyZW4gfHwgW10pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzbG90LnB1c2goY2hpbGQpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAoc2xvdHMuZGVmYXVsdCB8fCAoc2xvdHMuZGVmYXVsdCA9IFtdKSkucHVzaChjaGlsZCk7CiAgICAgIH0KICAgIH0KICAgIC8vIGlnbm9yZSBzbG90cyB0aGF0IGNvbnRhaW5zIG9ubHkgd2hpdGVzcGFjZQogICAgZm9yICh2YXIgbmFtZSQxIGluIHNsb3RzKSB7CiAgICAgIGlmIChzbG90c1tuYW1lJDFdLmV2ZXJ5KGlzV2hpdGVzcGFjZSkpIHsKICAgICAgICBkZWxldGUgc2xvdHNbbmFtZSQxXTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHNsb3RzCiAgfQoKICBmdW5jdGlvbiBpc1doaXRlc3BhY2UgKG5vZGUpIHsKICAgIHJldHVybiAobm9kZS5pc0NvbW1lbnQgJiYgIW5vZGUuYXN5bmNGYWN0b3J5KSB8fCBub2RlLnRleHQgPT09ICcgJwogIH0KCiAgLyogICovCgogIGZ1bmN0aW9uIG5vcm1hbGl6ZVNjb3BlZFNsb3RzICgKICAgIHNsb3RzLAogICAgbm9ybWFsU2xvdHMsCiAgICBwcmV2U2xvdHMKICApIHsKICAgIHZhciByZXM7CiAgICB2YXIgaGFzTm9ybWFsU2xvdHMgPSBPYmplY3Qua2V5cyhub3JtYWxTbG90cykubGVuZ3RoID4gMDsKICAgIHZhciBpc1N0YWJsZSA9IHNsb3RzID8gISFzbG90cy4kc3RhYmxlIDogIWhhc05vcm1hbFNsb3RzOwogICAgdmFyIGtleSA9IHNsb3RzICYmIHNsb3RzLiRrZXk7CiAgICBpZiAoIXNsb3RzKSB7CiAgICAgIHJlcyA9IHt9OwogICAgfSBlbHNlIGlmIChzbG90cy5fbm9ybWFsaXplZCkgewogICAgICAvLyBmYXN0IHBhdGggMTogY2hpbGQgY29tcG9uZW50IHJlLXJlbmRlciBvbmx5LCBwYXJlbnQgZGlkIG5vdCBjaGFuZ2UKICAgICAgcmV0dXJuIHNsb3RzLl9ub3JtYWxpemVkCiAgICB9IGVsc2UgaWYgKAogICAgICBpc1N0YWJsZSAmJgogICAgICBwcmV2U2xvdHMgJiYKICAgICAgcHJldlNsb3RzICE9PSBlbXB0eU9iamVjdCAmJgogICAgICBrZXkgPT09IHByZXZTbG90cy4ka2V5ICYmCiAgICAgICFoYXNOb3JtYWxTbG90cyAmJgogICAgICAhcHJldlNsb3RzLiRoYXNOb3JtYWwKICAgICkgewogICAgICAvLyBmYXN0IHBhdGggMjogc3RhYmxlIHNjb3BlZCBzbG90cyB3LyBubyBub3JtYWwgc2xvdHMgdG8gcHJveHksCiAgICAgIC8vIG9ubHkgbmVlZCB0byBub3JtYWxpemUgb25jZQogICAgICByZXR1cm4gcHJldlNsb3RzCiAgICB9IGVsc2UgewogICAgICByZXMgPSB7fTsKICAgICAgZm9yICh2YXIga2V5JDEgaW4gc2xvdHMpIHsKICAgICAgICBpZiAoc2xvdHNba2V5JDFdICYmIGtleSQxWzBdICE9PSAnJCcpIHsKICAgICAgICAgIHJlc1trZXkkMV0gPSBub3JtYWxpemVTY29wZWRTbG90KG5vcm1hbFNsb3RzLCBrZXkkMSwgc2xvdHNba2V5JDFdKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8vIGV4cG9zZSBub3JtYWwgc2xvdHMgb24gc2NvcGVkU2xvdHMKICAgIGZvciAodmFyIGtleSQyIGluIG5vcm1hbFNsb3RzKSB7CiAgICAgIGlmICghKGtleSQyIGluIHJlcykpIHsKICAgICAgICByZXNba2V5JDJdID0gcHJveHlOb3JtYWxTbG90KG5vcm1hbFNsb3RzLCBrZXkkMik7CiAgICAgIH0KICAgIH0KICAgIC8vIGF2b3JpYXogc2VlbXMgdG8gbW9jayBhIG5vbi1leHRlbnNpYmxlICRzY29wZWRTbG90cyBvYmplY3QKICAgIC8vIGFuZCB3aGVuIHRoYXQgaXMgcGFzc2VkIGRvd24gdGhpcyB3b3VsZCBjYXVzZSBhbiBlcnJvcgogICAgaWYgKHNsb3RzICYmIE9iamVjdC5pc0V4dGVuc2libGUoc2xvdHMpKSB7CiAgICAgIChzbG90cykuX25vcm1hbGl6ZWQgPSByZXM7CiAgICB9CiAgICBkZWYocmVzLCAnJHN0YWJsZScsIGlzU3RhYmxlKTsKICAgIGRlZihyZXMsICcka2V5Jywga2V5KTsKICAgIGRlZihyZXMsICckaGFzTm9ybWFsJywgaGFzTm9ybWFsU2xvdHMpOwogICAgcmV0dXJuIHJlcwogIH0KCiAgZnVuY3Rpb24gbm9ybWFsaXplU2NvcGVkU2xvdChub3JtYWxTbG90cywga2V5LCBmbikgewogICAgdmFyIG5vcm1hbGl6ZWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciByZXMgPSBhcmd1bWVudHMubGVuZ3RoID8gZm4uYXBwbHkobnVsbCwgYXJndW1lbnRzKSA6IGZuKHt9KTsKICAgICAgcmVzID0gcmVzICYmIHR5cGVvZiByZXMgPT09ICdvYmplY3QnICYmICFBcnJheS5pc0FycmF5KHJlcykKICAgICAgICA/IFtyZXNdIC8vIHNpbmdsZSB2bm9kZQogICAgICAgIDogbm9ybWFsaXplQ2hpbGRyZW4ocmVzKTsKICAgICAgcmV0dXJuIHJlcyAmJiAoCiAgICAgICAgcmVzLmxlbmd0aCA9PT0gMCB8fAogICAgICAgIChyZXMubGVuZ3RoID09PSAxICYmIHJlc1swXS5pc0NvbW1lbnQpIC8vICM5NjU4CiAgICAgICkgPyB1bmRlZmluZWQKICAgICAgICA6IHJlcwogICAgfTsKICAgIC8vIHRoaXMgaXMgYSBzbG90IHVzaW5nIHRoZSBuZXcgdi1zbG90IHN5bnRheCB3aXRob3V0IHNjb3BlLiBhbHRob3VnaCBpdCBpcwogICAgLy8gY29tcGlsZWQgYXMgYSBzY29wZWQgc2xvdCwgcmVuZGVyIGZuIHVzZXJzIHdvdWxkIGV4cGVjdCBpdCB0byBiZSBwcmVzZW50CiAgICAvLyBvbiB0aGlzLiRzbG90cyBiZWNhdXNlIHRoZSB1c2FnZSBpcyBzZW1hbnRpY2FsbHkgYSBub3JtYWwgc2xvdC4KICAgIGlmIChmbi5wcm94eSkgewogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobm9ybWFsU2xvdHMsIGtleSwgewogICAgICAgIGdldDogbm9ybWFsaXplZCwKICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICB9KTsKICAgIH0KICAgIHJldHVybiBub3JtYWxpemVkCiAgfQoKICBmdW5jdGlvbiBwcm94eU5vcm1hbFNsb3Qoc2xvdHMsIGtleSkgewogICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsgcmV0dXJuIHNsb3RzW2tleV07IH0KICB9CgogIC8qICAqLwoKICAvKioKICAgKiBSdW50aW1lIGhlbHBlciBmb3IgcmVuZGVyaW5nIHYtZm9yIGxpc3RzLgogICAqLwogIGZ1bmN0aW9uIHJlbmRlckxpc3QgKAogICAgdmFsLAogICAgcmVuZGVyCiAgKSB7CiAgICB2YXIgcmV0LCBpLCBsLCBrZXlzLCBrZXk7CiAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWwpIHx8IHR5cGVvZiB2YWwgPT09ICdzdHJpbmcnKSB7CiAgICAgIHJldCA9IG5ldyBBcnJheSh2YWwubGVuZ3RoKTsKICAgICAgZm9yIChpID0gMCwgbCA9IHZhbC5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICByZXRbaV0gPSByZW5kZXIodmFsW2ldLCBpKTsKICAgICAgfQogICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsID09PSAnbnVtYmVyJykgewogICAgICByZXQgPSBuZXcgQXJyYXkodmFsKTsKICAgICAgZm9yIChpID0gMDsgaSA8IHZhbDsgaSsrKSB7CiAgICAgICAgcmV0W2ldID0gcmVuZGVyKGkgKyAxLCBpKTsKICAgICAgfQogICAgfSBlbHNlIGlmIChpc09iamVjdCh2YWwpKSB7CiAgICAgIGlmIChoYXNTeW1ib2wgJiYgdmFsW1N5bWJvbC5pdGVyYXRvcl0pIHsKICAgICAgICByZXQgPSBbXTsKICAgICAgICB2YXIgaXRlcmF0b3IgPSB2YWxbU3ltYm9sLml0ZXJhdG9yXSgpOwogICAgICAgIHZhciByZXN1bHQgPSBpdGVyYXRvci5uZXh0KCk7CiAgICAgICAgd2hpbGUgKCFyZXN1bHQuZG9uZSkgewogICAgICAgICAgcmV0LnB1c2gocmVuZGVyKHJlc3VsdC52YWx1ZSwgcmV0Lmxlbmd0aCkpOwogICAgICAgICAgcmVzdWx0ID0gaXRlcmF0b3IubmV4dCgpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBrZXlzID0gT2JqZWN0LmtleXModmFsKTsKICAgICAgICByZXQgPSBuZXcgQXJyYXkoa2V5cy5sZW5ndGgpOwogICAgICAgIGZvciAoaSA9IDAsIGwgPSBrZXlzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgICAga2V5ID0ga2V5c1tpXTsKICAgICAgICAgIHJldFtpXSA9IHJlbmRlcih2YWxba2V5XSwga2V5LCBpKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmICghaXNEZWYocmV0KSkgewogICAgICByZXQgPSBbXTsKICAgIH0KICAgIChyZXQpLl9pc1ZMaXN0ID0gdHJ1ZTsKICAgIHJldHVybiByZXQKICB9CgogIC8qICAqLwoKICAvKioKICAgKiBSdW50aW1lIGhlbHBlciBmb3IgcmVuZGVyaW5nIDxzbG90PgogICAqLwogIGZ1bmN0aW9uIHJlbmRlclNsb3QgKAogICAgbmFtZSwKICAgIGZhbGxiYWNrLAogICAgcHJvcHMsCiAgICBiaW5kT2JqZWN0CiAgKSB7CiAgICB2YXIgc2NvcGVkU2xvdEZuID0gdGhpcy4kc2NvcGVkU2xvdHNbbmFtZV07CiAgICB2YXIgbm9kZXM7CiAgICBpZiAoc2NvcGVkU2xvdEZuKSB7IC8vIHNjb3BlZCBzbG90CiAgICAgIHByb3BzID0gcHJvcHMgfHwge307CiAgICAgIGlmIChiaW5kT2JqZWN0KSB7CiAgICAgICAgaWYgKCFpc09iamVjdChiaW5kT2JqZWN0KSkgewogICAgICAgICAgd2FybigKICAgICAgICAgICAgJ3Nsb3Qgdi1iaW5kIHdpdGhvdXQgYXJndW1lbnQgZXhwZWN0cyBhbiBPYmplY3QnLAogICAgICAgICAgICB0aGlzCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBwcm9wcyA9IGV4dGVuZChleHRlbmQoe30sIGJpbmRPYmplY3QpLCBwcm9wcyk7CiAgICAgIH0KICAgICAgbm9kZXMgPSBzY29wZWRTbG90Rm4ocHJvcHMpIHx8IGZhbGxiYWNrOwogICAgfSBlbHNlIHsKICAgICAgbm9kZXMgPSB0aGlzLiRzbG90c1tuYW1lXSB8fCBmYWxsYmFjazsKICAgIH0KCiAgICB2YXIgdGFyZ2V0ID0gcHJvcHMgJiYgcHJvcHMuc2xvdDsKICAgIGlmICh0YXJnZXQpIHsKICAgICAgcmV0dXJuIHRoaXMuJGNyZWF0ZUVsZW1lbnQoJ3RlbXBsYXRlJywgeyBzbG90OiB0YXJnZXQgfSwgbm9kZXMpCiAgICB9IGVsc2UgewogICAgICByZXR1cm4gbm9kZXMKICAgIH0KICB9CgogIC8qICAqLwoKICAvKioKICAgKiBSdW50aW1lIGhlbHBlciBmb3IgcmVzb2x2aW5nIGZpbHRlcnMKICAgKi8KICBmdW5jdGlvbiByZXNvbHZlRmlsdGVyIChpZCkgewogICAgcmV0dXJuIHJlc29sdmVBc3NldCh0aGlzLiRvcHRpb25zLCAnZmlsdGVycycsIGlkLCB0cnVlKSB8fCBpZGVudGl0eQogIH0KCiAgLyogICovCgogIGZ1bmN0aW9uIGlzS2V5Tm90TWF0Y2ggKGV4cGVjdCwgYWN0dWFsKSB7CiAgICBpZiAoQXJyYXkuaXNBcnJheShleHBlY3QpKSB7CiAgICAgIHJldHVybiBleHBlY3QuaW5kZXhPZihhY3R1YWwpID09PSAtMQogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGV4cGVjdCAhPT0gYWN0dWFsCiAgICB9CiAgfQoKICAvKioKICAgKiBSdW50aW1lIGhlbHBlciBmb3IgY2hlY2tpbmcga2V5Q29kZXMgZnJvbSBjb25maWcuCiAgICogZXhwb3NlZCBhcyBWdWUucHJvdG90eXBlLl9rCiAgICogcGFzc2luZyBpbiBldmVudEtleU5hbWUgYXMgbGFzdCBhcmd1bWVudCBzZXBhcmF0ZWx5IGZvciBiYWNrd2FyZHMgY29tcGF0CiAgICovCiAgZnVuY3Rpb24gY2hlY2tLZXlDb2RlcyAoCiAgICBldmVudEtleUNvZGUsCiAgICBrZXksCiAgICBidWlsdEluS2V5Q29kZSwKICAgIGV2ZW50S2V5TmFtZSwKICAgIGJ1aWx0SW5LZXlOYW1lCiAgKSB7CiAgICB2YXIgbWFwcGVkS2V5Q29kZSA9IGNvbmZpZy5rZXlDb2Rlc1trZXldIHx8IGJ1aWx0SW5LZXlDb2RlOwogICAgaWYgKGJ1aWx0SW5LZXlOYW1lICYmIGV2ZW50S2V5TmFtZSAmJiAhY29uZmlnLmtleUNvZGVzW2tleV0pIHsKICAgICAgcmV0dXJuIGlzS2V5Tm90TWF0Y2goYnVpbHRJbktleU5hbWUsIGV2ZW50S2V5TmFtZSkKICAgIH0gZWxzZSBpZiAobWFwcGVkS2V5Q29kZSkgewogICAgICByZXR1cm4gaXNLZXlOb3RNYXRjaChtYXBwZWRLZXlDb2RlLCBldmVudEtleUNvZGUpCiAgICB9IGVsc2UgaWYgKGV2ZW50S2V5TmFtZSkgewogICAgICByZXR1cm4gaHlwaGVuYXRlKGV2ZW50S2V5TmFtZSkgIT09IGtleQogICAgfQogIH0KCiAgLyogICovCgogIC8qKgogICAqIFJ1bnRpbWUgaGVscGVyIGZvciBtZXJnaW5nIHYtYmluZD0ib2JqZWN0IiBpbnRvIGEgVk5vZGUncyBkYXRhLgogICAqLwogIGZ1bmN0aW9uIGJpbmRPYmplY3RQcm9wcyAoCiAgICBkYXRhLAogICAgdGFnLAogICAgdmFsdWUsCiAgICBhc1Byb3AsCiAgICBpc1N5bmMKICApIHsKICAgIGlmICh2YWx1ZSkgewogICAgICBpZiAoIWlzT2JqZWN0KHZhbHVlKSkgewogICAgICAgIHdhcm4oCiAgICAgICAgICAndi1iaW5kIHdpdGhvdXQgYXJndW1lbnQgZXhwZWN0cyBhbiBPYmplY3Qgb3IgQXJyYXkgdmFsdWUnLAogICAgICAgICAgdGhpcwogICAgICAgICk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7CiAgICAgICAgICB2YWx1ZSA9IHRvT2JqZWN0KHZhbHVlKTsKICAgICAgICB9CiAgICAgICAgdmFyIGhhc2g7CiAgICAgICAgdmFyIGxvb3AgPSBmdW5jdGlvbiAoIGtleSApIHsKICAgICAgICAgIGlmICgKICAgICAgICAgICAga2V5ID09PSAnY2xhc3MnIHx8CiAgICAgICAgICAgIGtleSA9PT0gJ3N0eWxlJyB8fAogICAgICAgICAgICBpc1Jlc2VydmVkQXR0cmlidXRlKGtleSkKICAgICAgICAgICkgewogICAgICAgICAgICBoYXNoID0gZGF0YTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciB0eXBlID0gZGF0YS5hdHRycyAmJiBkYXRhLmF0dHJzLnR5cGU7CiAgICAgICAgICAgIGhhc2ggPSBhc1Byb3AgfHwgY29uZmlnLm11c3RVc2VQcm9wKHRhZywgdHlwZSwga2V5KQogICAgICAgICAgICAgID8gZGF0YS5kb21Qcm9wcyB8fCAoZGF0YS5kb21Qcm9wcyA9IHt9KQogICAgICAgICAgICAgIDogZGF0YS5hdHRycyB8fCAoZGF0YS5hdHRycyA9IHt9KTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBjYW1lbGl6ZWRLZXkgPSBjYW1lbGl6ZShrZXkpOwogICAgICAgICAgdmFyIGh5cGhlbmF0ZWRLZXkgPSBoeXBoZW5hdGUoa2V5KTsKICAgICAgICAgIGlmICghKGNhbWVsaXplZEtleSBpbiBoYXNoKSAmJiAhKGh5cGhlbmF0ZWRLZXkgaW4gaGFzaCkpIHsKICAgICAgICAgICAgaGFzaFtrZXldID0gdmFsdWVba2V5XTsKCiAgICAgICAgICAgIGlmIChpc1N5bmMpIHsKICAgICAgICAgICAgICB2YXIgb24gPSBkYXRhLm9uIHx8IChkYXRhLm9uID0ge30pOwogICAgICAgICAgICAgIG9uWygidXBkYXRlOiIgKyBrZXkpXSA9IGZ1bmN0aW9uICgkZXZlbnQpIHsKICAgICAgICAgICAgICAgIHZhbHVlW2tleV0gPSAkZXZlbnQ7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIGZvciAodmFyIGtleSBpbiB2YWx1ZSkgbG9vcCgga2V5ICk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBkYXRhCiAgfQoKICAvKiAgKi8KCiAgLyoqCiAgICogUnVudGltZSBoZWxwZXIgZm9yIHJlbmRlcmluZyBzdGF0aWMgdHJlZXMuCiAgICovCiAgZnVuY3Rpb24gcmVuZGVyU3RhdGljICgKICAgIGluZGV4LAogICAgaXNJbkZvcgogICkgewogICAgdmFyIGNhY2hlZCA9IHRoaXMuX3N0YXRpY1RyZWVzIHx8ICh0aGlzLl9zdGF0aWNUcmVlcyA9IFtdKTsKICAgIHZhciB0cmVlID0gY2FjaGVkW2luZGV4XTsKICAgIC8vIGlmIGhhcyBhbHJlYWR5LXJlbmRlcmVkIHN0YXRpYyB0cmVlIGFuZCBub3QgaW5zaWRlIHYtZm9yLAogICAgLy8gd2UgY2FuIHJldXNlIHRoZSBzYW1lIHRyZWUuCiAgICBpZiAodHJlZSAmJiAhaXNJbkZvcikgewogICAgICByZXR1cm4gdHJlZQogICAgfQogICAgLy8gb3RoZXJ3aXNlLCByZW5kZXIgYSBmcmVzaCB0cmVlLgogICAgdHJlZSA9IGNhY2hlZFtpbmRleF0gPSB0aGlzLiRvcHRpb25zLnN0YXRpY1JlbmRlckZuc1tpbmRleF0uY2FsbCgKICAgICAgdGhpcy5fcmVuZGVyUHJveHksCiAgICAgIG51bGwsCiAgICAgIHRoaXMgLy8gZm9yIHJlbmRlciBmbnMgZ2VuZXJhdGVkIGZvciBmdW5jdGlvbmFsIGNvbXBvbmVudCB0ZW1wbGF0ZXMKICAgICk7CiAgICBtYXJrU3RhdGljKHRyZWUsICgiX19zdGF0aWNfXyIgKyBpbmRleCksIGZhbHNlKTsKICAgIHJldHVybiB0cmVlCiAgfQoKICAvKioKICAgKiBSdW50aW1lIGhlbHBlciBmb3Igdi1vbmNlLgogICAqIEVmZmVjdGl2ZWx5IGl0IG1lYW5zIG1hcmtpbmcgdGhlIG5vZGUgYXMgc3RhdGljIHdpdGggYSB1bmlxdWUga2V5LgogICAqLwogIGZ1bmN0aW9uIG1hcmtPbmNlICgKICAgIHRyZWUsCiAgICBpbmRleCwKICAgIGtleQogICkgewogICAgbWFya1N0YXRpYyh0cmVlLCAoIl9fb25jZV9fIiArIGluZGV4ICsgKGtleSA/ICgiXyIgKyBrZXkpIDogIiIpKSwgdHJ1ZSk7CiAgICByZXR1cm4gdHJlZQogIH0KCiAgZnVuY3Rpb24gbWFya1N0YXRpYyAoCiAgICB0cmVlLAogICAga2V5LAogICAgaXNPbmNlCiAgKSB7CiAgICBpZiAoQXJyYXkuaXNBcnJheSh0cmVlKSkgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRyZWUubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAodHJlZVtpXSAmJiB0eXBlb2YgdHJlZVtpXSAhPT0gJ3N0cmluZycpIHsKICAgICAgICAgIG1hcmtTdGF0aWNOb2RlKHRyZWVbaV0sIChrZXkgKyAiXyIgKyBpKSwgaXNPbmNlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIG1hcmtTdGF0aWNOb2RlKHRyZWUsIGtleSwgaXNPbmNlKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIG1hcmtTdGF0aWNOb2RlIChub2RlLCBrZXksIGlzT25jZSkgewogICAgbm9kZS5pc1N0YXRpYyA9IHRydWU7CiAgICBub2RlLmtleSA9IGtleTsKICAgIG5vZGUuaXNPbmNlID0gaXNPbmNlOwogIH0KCiAgLyogICovCgogIGZ1bmN0aW9uIGJpbmRPYmplY3RMaXN0ZW5lcnMgKGRhdGEsIHZhbHVlKSB7CiAgICBpZiAodmFsdWUpIHsKICAgICAgaWYgKCFpc1BsYWluT2JqZWN0KHZhbHVlKSkgewogICAgICAgIHdhcm4oCiAgICAgICAgICAndi1vbiB3aXRob3V0IGFyZ3VtZW50IGV4cGVjdHMgYW4gT2JqZWN0IHZhbHVlJywKICAgICAgICAgIHRoaXMKICAgICAgICApOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBvbiA9IGRhdGEub24gPSBkYXRhLm9uID8gZXh0ZW5kKHt9LCBkYXRhLm9uKSA6IHt9OwogICAgICAgIGZvciAodmFyIGtleSBpbiB2YWx1ZSkgewogICAgICAgICAgdmFyIGV4aXN0aW5nID0gb25ba2V5XTsKICAgICAgICAgIHZhciBvdXJzID0gdmFsdWVba2V5XTsKICAgICAgICAgIG9uW2tleV0gPSBleGlzdGluZyA/IFtdLmNvbmNhdChleGlzdGluZywgb3VycykgOiBvdXJzOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIGRhdGEKICB9CgogIC8qICAqLwoKICBmdW5jdGlvbiByZXNvbHZlU2NvcGVkU2xvdHMgKAogICAgZm5zLCAvLyBzZWUgZmxvdy92bm9kZQogICAgcmVzLAogICAgLy8gdGhlIGZvbGxvd2luZyBhcmUgYWRkZWQgaW4gMi42CiAgICBoYXNEeW5hbWljS2V5cywKICAgIGNvbnRlbnRIYXNoS2V5CiAgKSB7CiAgICByZXMgPSByZXMgfHwgeyAkc3RhYmxlOiAhaGFzRHluYW1pY0tleXMgfTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZm5zLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBzbG90ID0gZm5zW2ldOwogICAgICBpZiAoQXJyYXkuaXNBcnJheShzbG90KSkgewogICAgICAgIHJlc29sdmVTY29wZWRTbG90cyhzbG90LCByZXMsIGhhc0R5bmFtaWNLZXlzKTsKICAgICAgfSBlbHNlIGlmIChzbG90KSB7CiAgICAgICAgLy8gbWFya2VyIGZvciByZXZlcnNlIHByb3h5aW5nIHYtc2xvdCB3aXRob3V0IHNjb3BlIG9uIHRoaXMuJHNsb3RzCiAgICAgICAgaWYgKHNsb3QucHJveHkpIHsKICAgICAgICAgIHNsb3QuZm4ucHJveHkgPSB0cnVlOwogICAgICAgIH0KICAgICAgICByZXNbc2xvdC5rZXldID0gc2xvdC5mbjsKICAgICAgfQogICAgfQogICAgaWYgKGNvbnRlbnRIYXNoS2V5KSB7CiAgICAgIChyZXMpLiRrZXkgPSBjb250ZW50SGFzaEtleTsKICAgIH0KICAgIHJldHVybiByZXMKICB9CgogIC8qICAqLwoKICBmdW5jdGlvbiBiaW5kRHluYW1pY0tleXMgKGJhc2VPYmosIHZhbHVlcykgewogICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2YWx1ZXMubGVuZ3RoOyBpICs9IDIpIHsKICAgICAgdmFyIGtleSA9IHZhbHVlc1tpXTsKICAgICAgaWYgKHR5cGVvZiBrZXkgPT09ICdzdHJpbmcnICYmIGtleSkgewogICAgICAgIGJhc2VPYmpbdmFsdWVzW2ldXSA9IHZhbHVlc1tpICsgMV07CiAgICAgIH0gZWxzZSBpZiAoa2V5ICE9PSAnJyAmJiBrZXkgIT09IG51bGwpIHsKICAgICAgICAvLyBudWxsIGlzIGEgc3BlaWNhbCB2YWx1ZSBmb3IgZXhwbGljaXRseSByZW1vdmluZyBhIGJpbmRpbmcKICAgICAgICB3YXJuKAogICAgICAgICAgKCJJbnZhbGlkIHZhbHVlIGZvciBkeW5hbWljIGRpcmVjdGl2ZSBhcmd1bWVudCAoZXhwZWN0ZWQgc3RyaW5nIG9yIG51bGwpOiAiICsga2V5KSwKICAgICAgICAgIHRoaXMKICAgICAgICApOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gYmFzZU9iagogIH0KCiAgLy8gaGVscGVyIHRvIGR5bmFtaWNhbGx5IGFwcGVuZCBtb2RpZmllciBydW50aW1lIG1hcmtlcnMgdG8gZXZlbnQgbmFtZXMuCiAgLy8gZW5zdXJlIG9ubHkgYXBwZW5kIHdoZW4gdmFsdWUgaXMgYWxyZWFkeSBzdHJpbmcsIG90aGVyd2lzZSBpdCB3aWxsIGJlIGNhc3QKICAvLyB0byBzdHJpbmcgYW5kIGNhdXNlIHRoZSB0eXBlIGNoZWNrIHRvIG1pc3MuCiAgZnVuY3Rpb24gcHJlcGVuZE1vZGlmaWVyICh2YWx1ZSwgc3ltYm9sKSB7CiAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyA/IHN5bWJvbCArIHZhbHVlIDogdmFsdWUKICB9CgogIC8qICAqLwoKICBmdW5jdGlvbiBpbnN0YWxsUmVuZGVySGVscGVycyAodGFyZ2V0KSB7CiAgICB0YXJnZXQuX28gPSBtYXJrT25jZTsKICAgIHRhcmdldC5fbiA9IHRvTnVtYmVyOwogICAgdGFyZ2V0Ll9zID0gdG9TdHJpbmc7CiAgICB0YXJnZXQuX2wgPSByZW5kZXJMaXN0OwogICAgdGFyZ2V0Ll90ID0gcmVuZGVyU2xvdDsKICAgIHRhcmdldC5fcSA9IGxvb3NlRXF1YWw7CiAgICB0YXJnZXQuX2kgPSBsb29zZUluZGV4T2Y7CiAgICB0YXJnZXQuX20gPSByZW5kZXJTdGF0aWM7CiAgICB0YXJnZXQuX2YgPSByZXNvbHZlRmlsdGVyOwogICAgdGFyZ2V0Ll9rID0gY2hlY2tLZXlDb2RlczsKICAgIHRhcmdldC5fYiA9IGJpbmRPYmplY3RQcm9wczsKICAgIHRhcmdldC5fdiA9IGNyZWF0ZVRleHRWTm9kZTsKICAgIHRhcmdldC5fZSA9IGNyZWF0ZUVtcHR5Vk5vZGU7CiAgICB0YXJnZXQuX3UgPSByZXNvbHZlU2NvcGVkU2xvdHM7CiAgICB0YXJnZXQuX2cgPSBiaW5kT2JqZWN0TGlzdGVuZXJzOwogICAgdGFyZ2V0Ll9kID0gYmluZER5bmFtaWNLZXlzOwogICAgdGFyZ2V0Ll9wID0gcHJlcGVuZE1vZGlmaWVyOwogIH0KCiAgLyogICovCgogIGZ1bmN0aW9uIEZ1bmN0aW9uYWxSZW5kZXJDb250ZXh0ICgKICAgIGRhdGEsCiAgICBwcm9wcywKICAgIGNoaWxkcmVuLAogICAgcGFyZW50LAogICAgQ3RvcgogICkgewogICAgdmFyIHRoaXMkMSA9IHRoaXM7CgogICAgdmFyIG9wdGlvbnMgPSBDdG9yLm9wdGlvbnM7CiAgICAvLyBlbnN1cmUgdGhlIGNyZWF0ZUVsZW1lbnQgZnVuY3Rpb24gaW4gZnVuY3Rpb25hbCBjb21wb25lbnRzCiAgICAvLyBnZXRzIGEgdW5pcXVlIGNvbnRleHQgLSB0aGlzIGlzIG5lY2Vzc2FyeSBmb3IgY29ycmVjdCBuYW1lZCBzbG90IGNoZWNrCiAgICB2YXIgY29udGV4dFZtOwogICAgaWYgKGhhc093bihwYXJlbnQsICdfdWlkJykpIHsKICAgICAgY29udGV4dFZtID0gT2JqZWN0LmNyZWF0ZShwYXJlbnQpOwogICAgICAvLyAkZmxvdy1kaXNhYmxlLWxpbmUKICAgICAgY29udGV4dFZtLl9vcmlnaW5hbCA9IHBhcmVudDsKICAgIH0gZWxzZSB7CiAgICAgIC8vIHRoZSBjb250ZXh0IHZtIHBhc3NlZCBpbiBpcyBhIGZ1bmN0aW9uYWwgY29udGV4dCBhcyB3ZWxsLgogICAgICAvLyBpbiB0aGlzIGNhc2Ugd2Ugd2FudCB0byBtYWtlIHN1cmUgd2UgYXJlIGFibGUgdG8gZ2V0IGEgaG9sZCB0byB0aGUKICAgICAgLy8gcmVhbCBjb250ZXh0IGluc3RhbmNlLgogICAgICBjb250ZXh0Vm0gPSBwYXJlbnQ7CiAgICAgIC8vICRmbG93LWRpc2FibGUtbGluZQogICAgICBwYXJlbnQgPSBwYXJlbnQuX29yaWdpbmFsOwogICAgfQogICAgdmFyIGlzQ29tcGlsZWQgPSBpc1RydWUob3B0aW9ucy5fY29tcGlsZWQpOwogICAgdmFyIG5lZWROb3JtYWxpemF0aW9uID0gIWlzQ29tcGlsZWQ7CgogICAgdGhpcy5kYXRhID0gZGF0YTsKICAgIHRoaXMucHJvcHMgPSBwcm9wczsKICAgIHRoaXMuY2hpbGRyZW4gPSBjaGlsZHJlbjsKICAgIHRoaXMucGFyZW50ID0gcGFyZW50OwogICAgdGhpcy5saXN0ZW5lcnMgPSBkYXRhLm9uIHx8IGVtcHR5T2JqZWN0OwogICAgdGhpcy5pbmplY3Rpb25zID0gcmVzb2x2ZUluamVjdChvcHRpb25zLmluamVjdCwgcGFyZW50KTsKICAgIHRoaXMuc2xvdHMgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGlmICghdGhpcyQxLiRzbG90cykgewogICAgICAgIG5vcm1hbGl6ZVNjb3BlZFNsb3RzKAogICAgICAgICAgZGF0YS5zY29wZWRTbG90cywKICAgICAgICAgIHRoaXMkMS4kc2xvdHMgPSByZXNvbHZlU2xvdHMoY2hpbGRyZW4sIHBhcmVudCkKICAgICAgICApOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzJDEuJHNsb3RzCiAgICB9OwoKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAnc2NvcGVkU2xvdHMnLCAoewogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICBnZXQ6IGZ1bmN0aW9uIGdldCAoKSB7CiAgICAgICAgcmV0dXJuIG5vcm1hbGl6ZVNjb3BlZFNsb3RzKGRhdGEuc2NvcGVkU2xvdHMsIHRoaXMuc2xvdHMoKSkKICAgICAgfQogICAgfSkpOwoKICAgIC8vIHN1cHBvcnQgZm9yIGNvbXBpbGVkIGZ1bmN0aW9uYWwgdGVtcGxhdGUKICAgIGlmIChpc0NvbXBpbGVkKSB7CiAgICAgIC8vIGV4cG9zaW5nICRvcHRpb25zIGZvciByZW5kZXJTdGF0aWMoKQogICAgICB0aGlzLiRvcHRpb25zID0gb3B0aW9uczsKICAgICAgLy8gcHJlLXJlc29sdmUgc2xvdHMgZm9yIHJlbmRlclNsb3QoKQogICAgICB0aGlzLiRzbG90cyA9IHRoaXMuc2xvdHMoKTsKICAgICAgdGhpcy4kc2NvcGVkU2xvdHMgPSBub3JtYWxpemVTY29wZWRTbG90cyhkYXRhLnNjb3BlZFNsb3RzLCB0aGlzLiRzbG90cyk7CiAgICB9CgogICAgaWYgKG9wdGlvbnMuX3Njb3BlSWQpIHsKICAgICAgdGhpcy5fYyA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkKSB7CiAgICAgICAgdmFyIHZub2RlID0gY3JlYXRlRWxlbWVudChjb250ZXh0Vm0sIGEsIGIsIGMsIGQsIG5lZWROb3JtYWxpemF0aW9uKTsKICAgICAgICBpZiAodm5vZGUgJiYgIUFycmF5LmlzQXJyYXkodm5vZGUpKSB7CiAgICAgICAgICB2bm9kZS5mblNjb3BlSWQgPSBvcHRpb25zLl9zY29wZUlkOwogICAgICAgICAgdm5vZGUuZm5Db250ZXh0ID0gcGFyZW50OwogICAgICAgIH0KICAgICAgICByZXR1cm4gdm5vZGUKICAgICAgfTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuX2MgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCkgeyByZXR1cm4gY3JlYXRlRWxlbWVudChjb250ZXh0Vm0sIGEsIGIsIGMsIGQsIG5lZWROb3JtYWxpemF0aW9uKTsgfTsKICAgIH0KICB9CgogIGluc3RhbGxSZW5kZXJIZWxwZXJzKEZ1bmN0aW9uYWxSZW5kZXJDb250ZXh0LnByb3RvdHlwZSk7CgogIGZ1bmN0aW9uIGNyZWF0ZUZ1bmN0aW9uYWxDb21wb25lbnQgKAogICAgQ3RvciwKICAgIHByb3BzRGF0YSwKICAgIGRhdGEsCiAgICBjb250ZXh0Vm0sCiAgICBjaGlsZHJlbgogICkgewogICAgdmFyIG9wdGlvbnMgPSBDdG9yLm9wdGlvbnM7CiAgICB2YXIgcHJvcHMgPSB7fTsKICAgIHZhciBwcm9wT3B0aW9ucyA9IG9wdGlvbnMucHJvcHM7CiAgICBpZiAoaXNEZWYocHJvcE9wdGlvbnMpKSB7CiAgICAgIGZvciAodmFyIGtleSBpbiBwcm9wT3B0aW9ucykgewogICAgICAgIHByb3BzW2tleV0gPSB2YWxpZGF0ZVByb3Aoa2V5LCBwcm9wT3B0aW9ucywgcHJvcHNEYXRhIHx8IGVtcHR5T2JqZWN0KTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgaWYgKGlzRGVmKGRhdGEuYXR0cnMpKSB7IG1lcmdlUHJvcHMocHJvcHMsIGRhdGEuYXR0cnMpOyB9CiAgICAgIGlmIChpc0RlZihkYXRhLnByb3BzKSkgeyBtZXJnZVByb3BzKHByb3BzLCBkYXRhLnByb3BzKTsgfQogICAgfQoKICAgIHZhciByZW5kZXJDb250ZXh0ID0gbmV3IEZ1bmN0aW9uYWxSZW5kZXJDb250ZXh0KAogICAgICBkYXRhLAogICAgICBwcm9wcywKICAgICAgY2hpbGRyZW4sCiAgICAgIGNvbnRleHRWbSwKICAgICAgQ3RvcgogICAgKTsKCiAgICB2YXIgdm5vZGUgPSBvcHRpb25zLnJlbmRlci5jYWxsKG51bGwsIHJlbmRlckNvbnRleHQuX2MsIHJlbmRlckNvbnRleHQpOwoKICAgIGlmICh2bm9kZSBpbnN0YW5jZW9mIFZOb2RlKSB7CiAgICAgIHJldHVybiBjbG9uZUFuZE1hcmtGdW5jdGlvbmFsUmVzdWx0KHZub2RlLCBkYXRhLCByZW5kZXJDb250ZXh0LnBhcmVudCwgb3B0aW9ucywgcmVuZGVyQ29udGV4dCkKICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheSh2bm9kZSkpIHsKICAgICAgdmFyIHZub2RlcyA9IG5vcm1hbGl6ZUNoaWxkcmVuKHZub2RlKSB8fCBbXTsKICAgICAgdmFyIHJlcyA9IG5ldyBBcnJheSh2bm9kZXMubGVuZ3RoKTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2bm9kZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICByZXNbaV0gPSBjbG9uZUFuZE1hcmtGdW5jdGlvbmFsUmVzdWx0KHZub2Rlc1tpXSwgZGF0YSwgcmVuZGVyQ29udGV4dC5wYXJlbnQsIG9wdGlvbnMsIHJlbmRlckNvbnRleHQpOwogICAgICB9CiAgICAgIHJldHVybiByZXMKICAgIH0KICB9CgogIGZ1bmN0aW9uIGNsb25lQW5kTWFya0Z1bmN0aW9uYWxSZXN1bHQgKHZub2RlLCBkYXRhLCBjb250ZXh0Vm0sIG9wdGlvbnMsIHJlbmRlckNvbnRleHQpIHsKICAgIC8vICM3ODE3IGNsb25lIG5vZGUgYmVmb3JlIHNldHRpbmcgZm5Db250ZXh0LCBvdGhlcndpc2UgaWYgdGhlIG5vZGUgaXMgcmV1c2VkCiAgICAvLyAoZS5nLiBpdCB3YXMgZnJvbSBhIGNhY2hlZCBub3JtYWwgc2xvdCkgdGhlIGZuQ29udGV4dCBjYXVzZXMgbmFtZWQgc2xvdHMKICAgIC8vIHRoYXQgc2hvdWxkIG5vdCBiZSBtYXRjaGVkIHRvIG1hdGNoLgogICAgdmFyIGNsb25lID0gY2xvbmVWTm9kZSh2bm9kZSk7CiAgICBjbG9uZS5mbkNvbnRleHQgPSBjb250ZXh0Vm07CiAgICBjbG9uZS5mbk9wdGlvbnMgPSBvcHRpb25zOwogICAgewogICAgICAoY2xvbmUuZGV2dG9vbHNNZXRhID0gY2xvbmUuZGV2dG9vbHNNZXRhIHx8IHt9KS5yZW5kZXJDb250ZXh0ID0gcmVuZGVyQ29udGV4dDsKICAgIH0KICAgIGlmIChkYXRhLnNsb3QpIHsKICAgICAgKGNsb25lLmRhdGEgfHwgKGNsb25lLmRhdGEgPSB7fSkpLnNsb3QgPSBkYXRhLnNsb3Q7CiAgICB9CiAgICByZXR1cm4gY2xvbmUKICB9CgogIGZ1bmN0aW9uIG1lcmdlUHJvcHMgKHRvLCBmcm9tKSB7CiAgICBmb3IgKHZhciBrZXkgaW4gZnJvbSkgewogICAgICB0b1tjYW1lbGl6ZShrZXkpXSA9IGZyb21ba2V5XTsKICAgIH0KICB9CgogIC8qICAqLwoKICAvKiAgKi8KCiAgLyogICovCgogIC8qICAqLwoKICAvLyBpbmxpbmUgaG9va3MgdG8gYmUgaW52b2tlZCBvbiBjb21wb25lbnQgVk5vZGVzIGR1cmluZyBwYXRjaAogIHZhciBjb21wb25lbnRWTm9kZUhvb2tzID0gewogICAgaW5pdDogZnVuY3Rpb24gaW5pdCAodm5vZGUsIGh5ZHJhdGluZykgewogICAgICBpZiAoCiAgICAgICAgdm5vZGUuY29tcG9uZW50SW5zdGFuY2UgJiYKICAgICAgICAhdm5vZGUuY29tcG9uZW50SW5zdGFuY2UuX2lzRGVzdHJveWVkICYmCiAgICAgICAgdm5vZGUuZGF0YS5rZWVwQWxpdmUKICAgICAgKSB7CiAgICAgICAgLy8ga2VwdC1hbGl2ZSBjb21wb25lbnRzLCB0cmVhdCBhcyBhIHBhdGNoCiAgICAgICAgdmFyIG1vdW50ZWROb2RlID0gdm5vZGU7IC8vIHdvcmsgYXJvdW5kIGZsb3cKICAgICAgICBjb21wb25lbnRWTm9kZUhvb2tzLnByZXBhdGNoKG1vdW50ZWROb2RlLCBtb3VudGVkTm9kZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIGNoaWxkID0gdm5vZGUuY29tcG9uZW50SW5zdGFuY2UgPSBjcmVhdGVDb21wb25lbnRJbnN0YW5jZUZvclZub2RlKAogICAgICAgICAgdm5vZGUsCiAgICAgICAgICBhY3RpdmVJbnN0YW5jZQogICAgICAgICk7CiAgICAgICAgY2hpbGQuJG1vdW50KGh5ZHJhdGluZyA/IHZub2RlLmVsbSA6IHVuZGVmaW5lZCwgaHlkcmF0aW5nKTsKICAgICAgfQogICAgfSwKCiAgICBwcmVwYXRjaDogZnVuY3Rpb24gcHJlcGF0Y2ggKG9sZFZub2RlLCB2bm9kZSkgewogICAgICB2YXIgb3B0aW9ucyA9IHZub2RlLmNvbXBvbmVudE9wdGlvbnM7CiAgICAgIHZhciBjaGlsZCA9IHZub2RlLmNvbXBvbmVudEluc3RhbmNlID0gb2xkVm5vZGUuY29tcG9uZW50SW5zdGFuY2U7CiAgICAgIHVwZGF0ZUNoaWxkQ29tcG9uZW50KAogICAgICAgIGNoaWxkLAogICAgICAgIG9wdGlvbnMucHJvcHNEYXRhLCAvLyB1cGRhdGVkIHByb3BzCiAgICAgICAgb3B0aW9ucy5saXN0ZW5lcnMsIC8vIHVwZGF0ZWQgbGlzdGVuZXJzCiAgICAgICAgdm5vZGUsIC8vIG5ldyBwYXJlbnQgdm5vZGUKICAgICAgICBvcHRpb25zLmNoaWxkcmVuIC8vIG5ldyBjaGlsZHJlbgogICAgICApOwogICAgfSwKCiAgICBpbnNlcnQ6IGZ1bmN0aW9uIGluc2VydCAodm5vZGUpIHsKICAgICAgdmFyIGNvbnRleHQgPSB2bm9kZS5jb250ZXh0OwogICAgICB2YXIgY29tcG9uZW50SW5zdGFuY2UgPSB2bm9kZS5jb21wb25lbnRJbnN0YW5jZTsKICAgICAgaWYgKCFjb21wb25lbnRJbnN0YW5jZS5faXNNb3VudGVkKSB7CiAgICAgICAgY29tcG9uZW50SW5zdGFuY2UuX2lzTW91bnRlZCA9IHRydWU7CiAgICAgICAgY2FsbEhvb2soY29tcG9uZW50SW5zdGFuY2UsICdtb3VudGVkJyk7CiAgICAgIH0KICAgICAgaWYgKHZub2RlLmRhdGEua2VlcEFsaXZlKSB7CiAgICAgICAgaWYgKGNvbnRleHQuX2lzTW91bnRlZCkgewogICAgICAgICAgLy8gdnVlLXJvdXRlciMxMjEyCiAgICAgICAgICAvLyBEdXJpbmcgdXBkYXRlcywgYSBrZXB0LWFsaXZlIGNvbXBvbmVudCdzIGNoaWxkIGNvbXBvbmVudHMgbWF5CiAgICAgICAgICAvLyBjaGFuZ2UsIHNvIGRpcmVjdGx5IHdhbGtpbmcgdGhlIHRyZWUgaGVyZSBtYXkgY2FsbCBhY3RpdmF0ZWQgaG9va3MKICAgICAgICAgIC8vIG9uIGluY29ycmVjdCBjaGlsZHJlbi4gSW5zdGVhZCB3ZSBwdXNoIHRoZW0gaW50byBhIHF1ZXVlIHdoaWNoIHdpbGwKICAgICAgICAgIC8vIGJlIHByb2Nlc3NlZCBhZnRlciB0aGUgd2hvbGUgcGF0Y2ggcHJvY2VzcyBlbmRlZC4KICAgICAgICAgIHF1ZXVlQWN0aXZhdGVkQ29tcG9uZW50KGNvbXBvbmVudEluc3RhbmNlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYWN0aXZhdGVDaGlsZENvbXBvbmVudChjb21wb25lbnRJbnN0YW5jZSwgdHJ1ZSAvKiBkaXJlY3QgKi8pOwogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICBkZXN0cm95OiBmdW5jdGlvbiBkZXN0cm95ICh2bm9kZSkgewogICAgICB2YXIgY29tcG9uZW50SW5zdGFuY2UgPSB2bm9kZS5jb21wb25lbnRJbnN0YW5jZTsKICAgICAgaWYgKCFjb21wb25lbnRJbnN0YW5jZS5faXNEZXN0cm95ZWQpIHsKICAgICAgICBpZiAoIXZub2RlLmRhdGEua2VlcEFsaXZlKSB7CiAgICAgICAgICBjb21wb25lbnRJbnN0YW5jZS4kZGVzdHJveSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBkZWFjdGl2YXRlQ2hpbGRDb21wb25lbnQoY29tcG9uZW50SW5zdGFuY2UsIHRydWUgLyogZGlyZWN0ICovKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OwoKICB2YXIgaG9va3NUb01lcmdlID0gT2JqZWN0LmtleXMoY29tcG9uZW50Vk5vZGVIb29rcyk7CgogIGZ1bmN0aW9uIGNyZWF0ZUNvbXBvbmVudCAoCiAgICBDdG9yLAogICAgZGF0YSwKICAgIGNvbnRleHQsCiAgICBjaGlsZHJlbiwKICAgIHRhZwogICkgewogICAgaWYgKGlzVW5kZWYoQ3RvcikpIHsKICAgICAgcmV0dXJuCiAgICB9CgogICAgdmFyIGJhc2VDdG9yID0gY29udGV4dC4kb3B0aW9ucy5fYmFzZTsKCiAgICAvLyBwbGFpbiBvcHRpb25zIG9iamVjdDogdHVybiBpdCBpbnRvIGEgY29uc3RydWN0b3IKICAgIGlmIChpc09iamVjdChDdG9yKSkgewogICAgICBDdG9yID0gYmFzZUN0b3IuZXh0ZW5kKEN0b3IpOwogICAgfQoKICAgIC8vIGlmIGF0IHRoaXMgc3RhZ2UgaXQncyBub3QgYSBjb25zdHJ1Y3RvciBvciBhbiBhc3luYyBjb21wb25lbnQgZmFjdG9yeSwKICAgIC8vIHJlamVjdC4KICAgIGlmICh0eXBlb2YgQ3RvciAhPT0gJ2Z1bmN0aW9uJykgewogICAgICB7CiAgICAgICAgd2FybigoIkludmFsaWQgQ29tcG9uZW50IGRlZmluaXRpb246ICIgKyAoU3RyaW5nKEN0b3IpKSksIGNvbnRleHQpOwogICAgICB9CiAgICAgIHJldHVybgogICAgfQoKICAgIC8vIGFzeW5jIGNvbXBvbmVudAogICAgdmFyIGFzeW5jRmFjdG9yeTsKICAgIGlmIChpc1VuZGVmKEN0b3IuY2lkKSkgewogICAgICBhc3luY0ZhY3RvcnkgPSBDdG9yOwogICAgICBDdG9yID0gcmVzb2x2ZUFzeW5jQ29tcG9uZW50KGFzeW5jRmFjdG9yeSwgYmFzZUN0b3IpOwogICAgICBpZiAoQ3RvciA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgLy8gcmV0dXJuIGEgcGxhY2Vob2xkZXIgbm9kZSBmb3IgYXN5bmMgY29tcG9uZW50LCB3aGljaCBpcyByZW5kZXJlZAogICAgICAgIC8vIGFzIGEgY29tbWVudCBub2RlIGJ1dCBwcmVzZXJ2ZXMgYWxsIHRoZSByYXcgaW5mb3JtYXRpb24gZm9yIHRoZSBub2RlLgogICAgICAgIC8vIHRoZSBpbmZvcm1hdGlvbiB3aWxsIGJlIHVzZWQgZm9yIGFzeW5jIHNlcnZlci1yZW5kZXJpbmcgYW5kIGh5ZHJhdGlvbi4KICAgICAgICByZXR1cm4gY3JlYXRlQXN5bmNQbGFjZWhvbGRlcigKICAgICAgICAgIGFzeW5jRmFjdG9yeSwKICAgICAgICAgIGRhdGEsCiAgICAgICAgICBjb250ZXh0LAogICAgICAgICAgY2hpbGRyZW4sCiAgICAgICAgICB0YWcKICAgICAgICApCiAgICAgIH0KICAgIH0KCiAgICBkYXRhID0gZGF0YSB8fCB7fTsKCiAgICAvLyByZXNvbHZlIGNvbnN0cnVjdG9yIG9wdGlvbnMgaW4gY2FzZSBnbG9iYWwgbWl4aW5zIGFyZSBhcHBsaWVkIGFmdGVyCiAgICAvLyBjb21wb25lbnQgY29uc3RydWN0b3IgY3JlYXRpb24KICAgIHJlc29sdmVDb25zdHJ1Y3Rvck9wdGlvbnMoQ3Rvcik7CgogICAgLy8gdHJhbnNmb3JtIGNvbXBvbmVudCB2LW1vZGVsIGRhdGEgaW50byBwcm9wcyAmIGV2ZW50cwogICAgaWYgKGlzRGVmKGRhdGEubW9kZWwpKSB7CiAgICAgIHRyYW5zZm9ybU1vZGVsKEN0b3Iub3B0aW9ucywgZGF0YSk7CiAgICB9CgogICAgLy8gZXh0cmFjdCBwcm9wcwogICAgdmFyIHByb3BzRGF0YSA9IGV4dHJhY3RQcm9wc0Zyb21WTm9kZURhdGEoZGF0YSwgQ3RvciwgdGFnKTsKCiAgICAvLyBmdW5jdGlvbmFsIGNvbXBvbmVudAogICAgaWYgKGlzVHJ1ZShDdG9yLm9wdGlvbnMuZnVuY3Rpb25hbCkpIHsKICAgICAgcmV0dXJuIGNyZWF0ZUZ1bmN0aW9uYWxDb21wb25lbnQoQ3RvciwgcHJvcHNEYXRhLCBkYXRhLCBjb250ZXh0LCBjaGlsZHJlbikKICAgIH0KCiAgICAvLyBleHRyYWN0IGxpc3RlbmVycywgc2luY2UgdGhlc2UgbmVlZHMgdG8gYmUgdHJlYXRlZCBhcwogICAgLy8gY2hpbGQgY29tcG9uZW50IGxpc3RlbmVycyBpbnN0ZWFkIG9mIERPTSBsaXN0ZW5lcnMKICAgIHZhciBsaXN0ZW5lcnMgPSBkYXRhLm9uOwogICAgLy8gcmVwbGFjZSB3aXRoIGxpc3RlbmVycyB3aXRoIC5uYXRpdmUgbW9kaWZpZXIKICAgIC8vIHNvIGl0IGdldHMgcHJvY2Vzc2VkIGR1cmluZyBwYXJlbnQgY29tcG9uZW50IHBhdGNoLgogICAgZGF0YS5vbiA9IGRhdGEubmF0aXZlT247CgogICAgaWYgKGlzVHJ1ZShDdG9yLm9wdGlvbnMuYWJzdHJhY3QpKSB7CiAgICAgIC8vIGFic3RyYWN0IGNvbXBvbmVudHMgZG8gbm90IGtlZXAgYW55dGhpbmcKICAgICAgLy8gb3RoZXIgdGhhbiBwcm9wcyAmIGxpc3RlbmVycyAmIHNsb3QKCiAgICAgIC8vIHdvcmsgYXJvdW5kIGZsb3cKICAgICAgdmFyIHNsb3QgPSBkYXRhLnNsb3Q7CiAgICAgIGRhdGEgPSB7fTsKICAgICAgaWYgKHNsb3QpIHsKICAgICAgICBkYXRhLnNsb3QgPSBzbG90OwogICAgICB9CiAgICB9CgogICAgLy8gaW5zdGFsbCBjb21wb25lbnQgbWFuYWdlbWVudCBob29rcyBvbnRvIHRoZSBwbGFjZWhvbGRlciBub2RlCiAgICBpbnN0YWxsQ29tcG9uZW50SG9va3MoZGF0YSk7CgogICAgLy8gcmV0dXJuIGEgcGxhY2Vob2xkZXIgdm5vZGUKICAgIHZhciBuYW1lID0gQ3Rvci5vcHRpb25zLm5hbWUgfHwgdGFnOwogICAgdmFyIHZub2RlID0gbmV3IFZOb2RlKAogICAgICAoInZ1ZS1jb21wb25lbnQtIiArIChDdG9yLmNpZCkgKyAobmFtZSA/ICgiLSIgKyBuYW1lKSA6ICcnKSksCiAgICAgIGRhdGEsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIGNvbnRleHQsCiAgICAgIHsgQ3RvcjogQ3RvciwgcHJvcHNEYXRhOiBwcm9wc0RhdGEsIGxpc3RlbmVyczogbGlzdGVuZXJzLCB0YWc6IHRhZywgY2hpbGRyZW46IGNoaWxkcmVuIH0sCiAgICAgIGFzeW5jRmFjdG9yeQogICAgKTsKCiAgICByZXR1cm4gdm5vZGUKICB9CgogIGZ1bmN0aW9uIGNyZWF0ZUNvbXBvbmVudEluc3RhbmNlRm9yVm5vZGUgKAogICAgdm5vZGUsIC8vIHdlIGtub3cgaXQncyBNb3VudGVkQ29tcG9uZW50Vk5vZGUgYnV0IGZsb3cgZG9lc24ndAogICAgcGFyZW50IC8vIGFjdGl2ZUluc3RhbmNlIGluIGxpZmVjeWNsZSBzdGF0ZQogICkgewogICAgdmFyIG9wdGlvbnMgPSB7CiAgICAgIF9pc0NvbXBvbmVudDogdHJ1ZSwKICAgICAgX3BhcmVudFZub2RlOiB2bm9kZSwKICAgICAgcGFyZW50OiBwYXJlbnQKICAgIH07CiAgICAvLyBjaGVjayBpbmxpbmUtdGVtcGxhdGUgcmVuZGVyIGZ1bmN0aW9ucwogICAgdmFyIGlubGluZVRlbXBsYXRlID0gdm5vZGUuZGF0YS5pbmxpbmVUZW1wbGF0ZTsKICAgIGlmIChpc0RlZihpbmxpbmVUZW1wbGF0ZSkpIHsKICAgICAgb3B0aW9ucy5yZW5kZXIgPSBpbmxpbmVUZW1wbGF0ZS5yZW5kZXI7CiAgICAgIG9wdGlvbnMuc3RhdGljUmVuZGVyRm5zID0gaW5saW5lVGVtcGxhdGUuc3RhdGljUmVuZGVyRm5zOwogICAgfQogICAgcmV0dXJuIG5ldyB2bm9kZS5jb21wb25lbnRPcHRpb25zLkN0b3Iob3B0aW9ucykKICB9CgogIGZ1bmN0aW9uIGluc3RhbGxDb21wb25lbnRIb29rcyAoZGF0YSkgewogICAgdmFyIGhvb2tzID0gZGF0YS5ob29rIHx8IChkYXRhLmhvb2sgPSB7fSk7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhvb2tzVG9NZXJnZS5sZW5ndGg7IGkrKykgewogICAgICB2YXIga2V5ID0gaG9va3NUb01lcmdlW2ldOwogICAgICB2YXIgZXhpc3RpbmcgPSBob29rc1trZXldOwogICAgICB2YXIgdG9NZXJnZSA9IGNvbXBvbmVudFZOb2RlSG9va3Nba2V5XTsKICAgICAgaWYgKGV4aXN0aW5nICE9PSB0b01lcmdlICYmICEoZXhpc3RpbmcgJiYgZXhpc3RpbmcuX21lcmdlZCkpIHsKICAgICAgICBob29rc1trZXldID0gZXhpc3RpbmcgPyBtZXJnZUhvb2skMSh0b01lcmdlLCBleGlzdGluZykgOiB0b01lcmdlOwogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBtZXJnZUhvb2skMSAoZjEsIGYyKSB7CiAgICB2YXIgbWVyZ2VkID0gZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgLy8gZmxvdyBjb21wbGFpbnMgYWJvdXQgZXh0cmEgYXJncyB3aGljaCBpcyB3aHkgd2UgdXNlIGFueQogICAgICBmMShhLCBiKTsKICAgICAgZjIoYSwgYik7CiAgICB9OwogICAgbWVyZ2VkLl9tZXJnZWQgPSB0cnVlOwogICAgcmV0dXJuIG1lcmdlZAogIH0KCiAgLy8gdHJhbnNmb3JtIGNvbXBvbmVudCB2LW1vZGVsIGluZm8gKHZhbHVlIGFuZCBjYWxsYmFjaykgaW50bwogIC8vIHByb3AgYW5kIGV2ZW50IGhhbmRsZXIgcmVzcGVjdGl2ZWx5LgogIGZ1bmN0aW9uIHRyYW5zZm9ybU1vZGVsIChvcHRpb25zLCBkYXRhKSB7CiAgICB2YXIgcHJvcCA9IChvcHRpb25zLm1vZGVsICYmIG9wdGlvbnMubW9kZWwucHJvcCkgfHwgJ3ZhbHVlJzsKICAgIHZhciBldmVudCA9IChvcHRpb25zLm1vZGVsICYmIG9wdGlvbnMubW9kZWwuZXZlbnQpIHx8ICdpbnB1dCcKICAgIDsoZGF0YS5hdHRycyB8fCAoZGF0YS5hdHRycyA9IHt9KSlbcHJvcF0gPSBkYXRhLm1vZGVsLnZhbHVlOwogICAgdmFyIG9uID0gZGF0YS5vbiB8fCAoZGF0YS5vbiA9IHt9KTsKICAgIHZhciBleGlzdGluZyA9IG9uW2V2ZW50XTsKICAgIHZhciBjYWxsYmFjayA9IGRhdGEubW9kZWwuY2FsbGJhY2s7CiAgICBpZiAoaXNEZWYoZXhpc3RpbmcpKSB7CiAgICAgIGlmICgKICAgICAgICBBcnJheS5pc0FycmF5KGV4aXN0aW5nKQogICAgICAgICAgPyBleGlzdGluZy5pbmRleE9mKGNhbGxiYWNrKSA9PT0gLTEKICAgICAgICAgIDogZXhpc3RpbmcgIT09IGNhbGxiYWNrCiAgICAgICkgewogICAgICAgIG9uW2V2ZW50XSA9IFtjYWxsYmFja10uY29uY2F0KGV4aXN0aW5nKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgb25bZXZlbnRdID0gY2FsbGJhY2s7CiAgICB9CiAgfQoKICAvKiAgKi8KCiAgdmFyIFNJTVBMRV9OT1JNQUxJWkUgPSAxOwogIHZhciBBTFdBWVNfTk9STUFMSVpFID0gMjsKCiAgLy8gd3JhcHBlciBmdW5jdGlvbiBmb3IgcHJvdmlkaW5nIGEgbW9yZSBmbGV4aWJsZSBpbnRlcmZhY2UKICAvLyB3aXRob3V0IGdldHRpbmcgeWVsbGVkIGF0IGJ5IGZsb3cKICBmdW5jdGlvbiBjcmVhdGVFbGVtZW50ICgKICAgIGNvbnRleHQsCiAgICB0YWcsCiAgICBkYXRhLAogICAgY2hpbGRyZW4sCiAgICBub3JtYWxpemF0aW9uVHlwZSwKICAgIGFsd2F5c05vcm1hbGl6ZQogICkgewogICAgaWYgKEFycmF5LmlzQXJyYXkoZGF0YSkgfHwgaXNQcmltaXRpdmUoZGF0YSkpIHsKICAgICAgbm9ybWFsaXphdGlvblR5cGUgPSBjaGlsZHJlbjsKICAgICAgY2hpbGRyZW4gPSBkYXRhOwogICAgICBkYXRhID0gdW5kZWZpbmVkOwogICAgfQogICAgaWYgKGlzVHJ1ZShhbHdheXNOb3JtYWxpemUpKSB7CiAgICAgIG5vcm1hbGl6YXRpb25UeXBlID0gQUxXQVlTX05PUk1BTElaRTsKICAgIH0KICAgIHJldHVybiBfY3JlYXRlRWxlbWVudChjb250ZXh0LCB0YWcsIGRhdGEsIGNoaWxkcmVuLCBub3JtYWxpemF0aW9uVHlwZSkKICB9CgogIGZ1bmN0aW9uIF9jcmVhdGVFbGVtZW50ICgKICAgIGNvbnRleHQsCiAgICB0YWcsCiAgICBkYXRhLAogICAgY2hpbGRyZW4sCiAgICBub3JtYWxpemF0aW9uVHlwZQogICkgewogICAgaWYgKGlzRGVmKGRhdGEpICYmIGlzRGVmKChkYXRhKS5fX29iX18pKSB7CiAgICAgIHdhcm4oCiAgICAgICAgIkF2b2lkIHVzaW5nIG9ic2VydmVkIGRhdGEgb2JqZWN0IGFzIHZub2RlIGRhdGE6ICIgKyAoSlNPTi5zdHJpbmdpZnkoZGF0YSkpICsgIlxuIiArCiAgICAgICAgJ0Fsd2F5cyBjcmVhdGUgZnJlc2ggdm5vZGUgZGF0YSBvYmplY3RzIGluIGVhY2ggcmVuZGVyIScsCiAgICAgICAgY29udGV4dAogICAgICApOwogICAgICByZXR1cm4gY3JlYXRlRW1wdHlWTm9kZSgpCiAgICB9CiAgICAvLyBvYmplY3Qgc3ludGF4IGluIHYtYmluZAogICAgaWYgKGlzRGVmKGRhdGEpICYmIGlzRGVmKGRhdGEuaXMpKSB7CiAgICAgIHRhZyA9IGRhdGEuaXM7CiAgICB9CiAgICBpZiAoIXRhZykgewogICAgICAvLyBpbiBjYXNlIG9mIGNvbXBvbmVudCA6aXMgc2V0IHRvIGZhbHN5IHZhbHVlCiAgICAgIHJldHVybiBjcmVhdGVFbXB0eVZOb2RlKCkKICAgIH0KICAgIC8vIHdhcm4gYWdhaW5zdCBub24tcHJpbWl0aXZlIGtleQogICAgaWYgKGlzRGVmKGRhdGEpICYmIGlzRGVmKGRhdGEua2V5KSAmJiAhaXNQcmltaXRpdmUoZGF0YS5rZXkpCiAgICApIHsKICAgICAgewogICAgICAgIHdhcm4oCiAgICAgICAgICAnQXZvaWQgdXNpbmcgbm9uLXByaW1pdGl2ZSB2YWx1ZSBhcyBrZXksICcgKwogICAgICAgICAgJ3VzZSBzdHJpbmcvbnVtYmVyIHZhbHVlIGluc3RlYWQuJywKICAgICAgICAgIGNvbnRleHQKICAgICAgICApOwogICAgICB9CiAgICB9CiAgICAvLyBzdXBwb3J0IHNpbmdsZSBmdW5jdGlvbiBjaGlsZHJlbiBhcyBkZWZhdWx0IHNjb3BlZCBzbG90CiAgICBpZiAoQXJyYXkuaXNBcnJheShjaGlsZHJlbikgJiYKICAgICAgdHlwZW9mIGNoaWxkcmVuWzBdID09PSAnZnVuY3Rpb24nCiAgICApIHsKICAgICAgZGF0YSA9IGRhdGEgfHwge307CiAgICAgIGRhdGEuc2NvcGVkU2xvdHMgPSB7IGRlZmF1bHQ6IGNoaWxkcmVuWzBdIH07CiAgICAgIGNoaWxkcmVuLmxlbmd0aCA9IDA7CiAgICB9CiAgICBpZiAobm9ybWFsaXphdGlvblR5cGUgPT09IEFMV0FZU19OT1JNQUxJWkUpIHsKICAgICAgY2hpbGRyZW4gPSBub3JtYWxpemVDaGlsZHJlbihjaGlsZHJlbik7CiAgICB9IGVsc2UgaWYgKG5vcm1hbGl6YXRpb25UeXBlID09PSBTSU1QTEVfTk9STUFMSVpFKSB7CiAgICAgIGNoaWxkcmVuID0gc2ltcGxlTm9ybWFsaXplQ2hpbGRyZW4oY2hpbGRyZW4pOwogICAgfQogICAgdmFyIHZub2RlLCBuczsKICAgIGlmICh0eXBlb2YgdGFnID09PSAnc3RyaW5nJykgewogICAgICB2YXIgQ3RvcjsKICAgICAgbnMgPSAoY29udGV4dC4kdm5vZGUgJiYgY29udGV4dC4kdm5vZGUubnMpIHx8IGNvbmZpZy5nZXRUYWdOYW1lc3BhY2UodGFnKTsKICAgICAgaWYgKGNvbmZpZy5pc1Jlc2VydmVkVGFnKHRhZykpIHsKICAgICAgICAvLyBwbGF0Zm9ybSBidWlsdC1pbiBlbGVtZW50cwogICAgICAgIHZub2RlID0gbmV3IFZOb2RlKAogICAgICAgICAgY29uZmlnLnBhcnNlUGxhdGZvcm1UYWdOYW1lKHRhZyksIGRhdGEsIGNoaWxkcmVuLAogICAgICAgICAgdW5kZWZpbmVkLCB1bmRlZmluZWQsIGNvbnRleHQKICAgICAgICApOwogICAgICB9IGVsc2UgaWYgKCghZGF0YSB8fCAhZGF0YS5wcmUpICYmIGlzRGVmKEN0b3IgPSByZXNvbHZlQXNzZXQoY29udGV4dC4kb3B0aW9ucywgJ2NvbXBvbmVudHMnLCB0YWcpKSkgewogICAgICAgIC8vIGNvbXBvbmVudAogICAgICAgIHZub2RlID0gY3JlYXRlQ29tcG9uZW50KEN0b3IsIGRhdGEsIGNvbnRleHQsIGNoaWxkcmVuLCB0YWcpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIHVua25vd24gb3IgdW5saXN0ZWQgbmFtZXNwYWNlZCBlbGVtZW50cwogICAgICAgIC8vIGNoZWNrIGF0IHJ1bnRpbWUgYmVjYXVzZSBpdCBtYXkgZ2V0IGFzc2lnbmVkIGEgbmFtZXNwYWNlIHdoZW4gaXRzCiAgICAgICAgLy8gcGFyZW50IG5vcm1hbGl6ZXMgY2hpbGRyZW4KICAgICAgICB2bm9kZSA9IG5ldyBWTm9kZSgKICAgICAgICAgIHRhZywgZGF0YSwgY2hpbGRyZW4sCiAgICAgICAgICB1bmRlZmluZWQsIHVuZGVmaW5lZCwgY29udGV4dAogICAgICAgICk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIC8vIGRpcmVjdCBjb21wb25lbnQgb3B0aW9ucyAvIGNvbnN0cnVjdG9yCiAgICAgIHZub2RlID0gY3JlYXRlQ29tcG9uZW50KHRhZywgZGF0YSwgY29udGV4dCwgY2hpbGRyZW4pOwogICAgfQogICAgaWYgKEFycmF5LmlzQXJyYXkodm5vZGUpKSB7CiAgICAgIHJldHVybiB2bm9kZQogICAgfSBlbHNlIGlmIChpc0RlZih2bm9kZSkpIHsKICAgICAgaWYgKGlzRGVmKG5zKSkgeyBhcHBseU5TKHZub2RlLCBucyk7IH0KICAgICAgaWYgKGlzRGVmKGRhdGEpKSB7IHJlZ2lzdGVyRGVlcEJpbmRpbmdzKGRhdGEpOyB9CiAgICAgIHJldHVybiB2bm9kZQogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGNyZWF0ZUVtcHR5Vk5vZGUoKQogICAgfQogIH0KCiAgZnVuY3Rpb24gYXBwbHlOUyAodm5vZGUsIG5zLCBmb3JjZSkgewogICAgdm5vZGUubnMgPSBuczsKICAgIGlmICh2bm9kZS50YWcgPT09ICdmb3JlaWduT2JqZWN0JykgewogICAgICAvLyB1c2UgZGVmYXVsdCBuYW1lc3BhY2UgaW5zaWRlIGZvcmVpZ25PYmplY3QKICAgICAgbnMgPSB1bmRlZmluZWQ7CiAgICAgIGZvcmNlID0gdHJ1ZTsKICAgIH0KICAgIGlmIChpc0RlZih2bm9kZS5jaGlsZHJlbikpIHsKICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSB2bm9kZS5jaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICB2YXIgY2hpbGQgPSB2bm9kZS5jaGlsZHJlbltpXTsKICAgICAgICBpZiAoaXNEZWYoY2hpbGQudGFnKSAmJiAoCiAgICAgICAgICBpc1VuZGVmKGNoaWxkLm5zKSB8fCAoaXNUcnVlKGZvcmNlKSAmJiBjaGlsZC50YWcgIT09ICdzdmcnKSkpIHsKICAgICAgICAgIGFwcGx5TlMoY2hpbGQsIG5zLCBmb3JjZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICAvLyByZWYgIzUzMTgKICAvLyBuZWNlc3NhcnkgdG8gZW5zdXJlIHBhcmVudCByZS1yZW5kZXIgd2hlbiBkZWVwIGJpbmRpbmdzIGxpa2UgOnN0eWxlIGFuZAogIC8vIDpjbGFzcyBhcmUgdXNlZCBvbiBzbG90IG5vZGVzCiAgZnVuY3Rpb24gcmVnaXN0ZXJEZWVwQmluZGluZ3MgKGRhdGEpIHsKICAgIGlmIChpc09iamVjdChkYXRhLnN0eWxlKSkgewogICAgICB0cmF2ZXJzZShkYXRhLnN0eWxlKTsKICAgIH0KICAgIGlmIChpc09iamVjdChkYXRhLmNsYXNzKSkgewogICAgICB0cmF2ZXJzZShkYXRhLmNsYXNzKTsKICAgIH0KICB9CgogIC8qICAqLwoKICBmdW5jdGlvbiBpbml0UmVuZGVyICh2bSkgewogICAgdm0uX3Zub2RlID0gbnVsbDsgLy8gdGhlIHJvb3Qgb2YgdGhlIGNoaWxkIHRyZWUKICAgIHZtLl9zdGF0aWNUcmVlcyA9IG51bGw7IC8vIHYtb25jZSBjYWNoZWQgdHJlZXMKICAgIHZhciBvcHRpb25zID0gdm0uJG9wdGlvbnM7CiAgICB2YXIgcGFyZW50Vm5vZGUgPSB2bS4kdm5vZGUgPSBvcHRpb25zLl9wYXJlbnRWbm9kZTsgLy8gdGhlIHBsYWNlaG9sZGVyIG5vZGUgaW4gcGFyZW50IHRyZWUKICAgIHZhciByZW5kZXJDb250ZXh0ID0gcGFyZW50Vm5vZGUgJiYgcGFyZW50Vm5vZGUuY29udGV4dDsKICAgIHZtLiRzbG90cyA9IHJlc29sdmVTbG90cyhvcHRpb25zLl9yZW5kZXJDaGlsZHJlbiwgcmVuZGVyQ29udGV4dCk7CiAgICB2bS4kc2NvcGVkU2xvdHMgPSBlbXB0eU9iamVjdDsKICAgIC8vIGJpbmQgdGhlIGNyZWF0ZUVsZW1lbnQgZm4gdG8gdGhpcyBpbnN0YW5jZQogICAgLy8gc28gdGhhdCB3ZSBnZXQgcHJvcGVyIHJlbmRlciBjb250ZXh0IGluc2lkZSBpdC4KICAgIC8vIGFyZ3Mgb3JkZXI6IHRhZywgZGF0YSwgY2hpbGRyZW4sIG5vcm1hbGl6YXRpb25UeXBlLCBhbHdheXNOb3JtYWxpemUKICAgIC8vIGludGVybmFsIHZlcnNpb24gaXMgdXNlZCBieSByZW5kZXIgZnVuY3Rpb25zIGNvbXBpbGVkIGZyb20gdGVtcGxhdGVzCiAgICB2bS5fYyA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkKSB7IHJldHVybiBjcmVhdGVFbGVtZW50KHZtLCBhLCBiLCBjLCBkLCBmYWxzZSk7IH07CiAgICAvLyBub3JtYWxpemF0aW9uIGlzIGFsd2F5cyBhcHBsaWVkIGZvciB0aGUgcHVibGljIHZlcnNpb24sIHVzZWQgaW4KICAgIC8vIHVzZXItd3JpdHRlbiByZW5kZXIgZnVuY3Rpb25zLgogICAgdm0uJGNyZWF0ZUVsZW1lbnQgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCkgeyByZXR1cm4gY3JlYXRlRWxlbWVudCh2bSwgYSwgYiwgYywgZCwgdHJ1ZSk7IH07CgogICAgLy8gJGF0dHJzICYgJGxpc3RlbmVycyBhcmUgZXhwb3NlZCBmb3IgZWFzaWVyIEhPQyBjcmVhdGlvbi4KICAgIC8vIHRoZXkgbmVlZCB0byBiZSByZWFjdGl2ZSBzbyB0aGF0IEhPQ3MgdXNpbmcgdGhlbSBhcmUgYWx3YXlzIHVwZGF0ZWQKICAgIHZhciBwYXJlbnREYXRhID0gcGFyZW50Vm5vZGUgJiYgcGFyZW50Vm5vZGUuZGF0YTsKCiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgZWxzZSAqLwogICAgewogICAgICBkZWZpbmVSZWFjdGl2ZSQkMSh2bSwgJyRhdHRycycsIHBhcmVudERhdGEgJiYgcGFyZW50RGF0YS5hdHRycyB8fCBlbXB0eU9iamVjdCwgZnVuY3Rpb24gKCkgewogICAgICAgICFpc1VwZGF0aW5nQ2hpbGRDb21wb25lbnQgJiYgd2FybigiJGF0dHJzIGlzIHJlYWRvbmx5LiIsIHZtKTsKICAgICAgfSwgdHJ1ZSk7CiAgICAgIGRlZmluZVJlYWN0aXZlJCQxKHZtLCAnJGxpc3RlbmVycycsIG9wdGlvbnMuX3BhcmVudExpc3RlbmVycyB8fCBlbXB0eU9iamVjdCwgZnVuY3Rpb24gKCkgewogICAgICAgICFpc1VwZGF0aW5nQ2hpbGRDb21wb25lbnQgJiYgd2FybigiJGxpc3RlbmVycyBpcyByZWFkb25seS4iLCB2bSk7CiAgICAgIH0sIHRydWUpOwogICAgfQogIH0KCiAgdmFyIGN1cnJlbnRSZW5kZXJpbmdJbnN0YW5jZSA9IG51bGw7CgogIGZ1bmN0aW9uIHJlbmRlck1peGluIChWdWUpIHsKICAgIC8vIGluc3RhbGwgcnVudGltZSBjb252ZW5pZW5jZSBoZWxwZXJzCiAgICBpbnN0YWxsUmVuZGVySGVscGVycyhWdWUucHJvdG90eXBlKTsKCiAgICBWdWUucHJvdG90eXBlLiRuZXh0VGljayA9IGZ1bmN0aW9uIChmbikgewogICAgICByZXR1cm4gbmV4dFRpY2soZm4sIHRoaXMpCiAgICB9OwoKICAgIFZ1ZS5wcm90b3R5cGUuX3JlbmRlciA9IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgdmFyIHJlZiA9IHZtLiRvcHRpb25zOwogICAgICB2YXIgcmVuZGVyID0gcmVmLnJlbmRlcjsKICAgICAgdmFyIF9wYXJlbnRWbm9kZSA9IHJlZi5fcGFyZW50Vm5vZGU7CgogICAgICBpZiAoX3BhcmVudFZub2RlKSB7CiAgICAgICAgdm0uJHNjb3BlZFNsb3RzID0gbm9ybWFsaXplU2NvcGVkU2xvdHMoCiAgICAgICAgICBfcGFyZW50Vm5vZGUuZGF0YS5zY29wZWRTbG90cywKICAgICAgICAgIHZtLiRzbG90cywKICAgICAgICAgIHZtLiRzY29wZWRTbG90cwogICAgICAgICk7CiAgICAgIH0KCiAgICAgIC8vIHNldCBwYXJlbnQgdm5vZGUuIHRoaXMgYWxsb3dzIHJlbmRlciBmdW5jdGlvbnMgdG8gaGF2ZSBhY2Nlc3MKICAgICAgLy8gdG8gdGhlIGRhdGEgb24gdGhlIHBsYWNlaG9sZGVyIG5vZGUuCiAgICAgIHZtLiR2bm9kZSA9IF9wYXJlbnRWbm9kZTsKICAgICAgLy8gcmVuZGVyIHNlbGYKICAgICAgdmFyIHZub2RlOwogICAgICB0cnkgewogICAgICAgIC8vIFRoZXJlJ3Mgbm8gbmVlZCB0byBtYWludGFpbiBhIHN0YWNrIGJlY2F1ZXMgYWxsIHJlbmRlciBmbnMgYXJlIGNhbGxlZAogICAgICAgIC8vIHNlcGFyYXRlbHkgZnJvbSBvbmUgYW5vdGhlci4gTmVzdGVkIGNvbXBvbmVudCdzIHJlbmRlciBmbnMgYXJlIGNhbGxlZAogICAgICAgIC8vIHdoZW4gcGFyZW50IGNvbXBvbmVudCBpcyBwYXRjaGVkLgogICAgICAgIGN1cnJlbnRSZW5kZXJpbmdJbnN0YW5jZSA9IHZtOwogICAgICAgIHZub2RlID0gcmVuZGVyLmNhbGwodm0uX3JlbmRlclByb3h5LCB2bS4kY3JlYXRlRWxlbWVudCk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBoYW5kbGVFcnJvcihlLCB2bSwgInJlbmRlciIpOwogICAgICAgIC8vIHJldHVybiBlcnJvciByZW5kZXIgcmVzdWx0LAogICAgICAgIC8vIG9yIHByZXZpb3VzIHZub2RlIHRvIHByZXZlbnQgcmVuZGVyIGVycm9yIGNhdXNpbmcgYmxhbmsgY29tcG9uZW50CiAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIGVsc2UgKi8KICAgICAgICBpZiAodm0uJG9wdGlvbnMucmVuZGVyRXJyb3IpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHZub2RlID0gdm0uJG9wdGlvbnMucmVuZGVyRXJyb3IuY2FsbCh2bS5fcmVuZGVyUHJveHksIHZtLiRjcmVhdGVFbGVtZW50LCBlKTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgaGFuZGxlRXJyb3IoZSwgdm0sICJyZW5kZXJFcnJvciIpOwogICAgICAgICAgICB2bm9kZSA9IHZtLl92bm9kZTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdm5vZGUgPSB2bS5fdm5vZGU7CiAgICAgICAgfQogICAgICB9IGZpbmFsbHkgewogICAgICAgIGN1cnJlbnRSZW5kZXJpbmdJbnN0YW5jZSA9IG51bGw7CiAgICAgIH0KICAgICAgLy8gaWYgdGhlIHJldHVybmVkIGFycmF5IGNvbnRhaW5zIG9ubHkgYSBzaW5nbGUgbm9kZSwgYWxsb3cgaXQKICAgICAgaWYgKEFycmF5LmlzQXJyYXkodm5vZGUpICYmIHZub2RlLmxlbmd0aCA9PT0gMSkgewogICAgICAgIHZub2RlID0gdm5vZGVbMF07CiAgICAgIH0KICAgICAgLy8gcmV0dXJuIGVtcHR5IHZub2RlIGluIGNhc2UgdGhlIHJlbmRlciBmdW5jdGlvbiBlcnJvcmVkIG91dAogICAgICBpZiAoISh2bm9kZSBpbnN0YW5jZW9mIFZOb2RlKSkgewogICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZub2RlKSkgewogICAgICAgICAgd2FybigKICAgICAgICAgICAgJ011bHRpcGxlIHJvb3Qgbm9kZXMgcmV0dXJuZWQgZnJvbSByZW5kZXIgZnVuY3Rpb24uIFJlbmRlciBmdW5jdGlvbiAnICsKICAgICAgICAgICAgJ3Nob3VsZCByZXR1cm4gYSBzaW5nbGUgcm9vdCBub2RlLicsCiAgICAgICAgICAgIHZtCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICB2bm9kZSA9IGNyZWF0ZUVtcHR5Vk5vZGUoKTsKICAgICAgfQogICAgICAvLyBzZXQgcGFyZW50CiAgICAgIHZub2RlLnBhcmVudCA9IF9wYXJlbnRWbm9kZTsKICAgICAgcmV0dXJuIHZub2RlCiAgICB9OwogIH0KCiAgLyogICovCgogIGZ1bmN0aW9uIGVuc3VyZUN0b3IgKGNvbXAsIGJhc2UpIHsKICAgIGlmICgKICAgICAgY29tcC5fX2VzTW9kdWxlIHx8CiAgICAgIChoYXNTeW1ib2wgJiYgY29tcFtTeW1ib2wudG9TdHJpbmdUYWddID09PSAnTW9kdWxlJykKICAgICkgewogICAgICBjb21wID0gY29tcC5kZWZhdWx0OwogICAgfQogICAgcmV0dXJuIGlzT2JqZWN0KGNvbXApCiAgICAgID8gYmFzZS5leHRlbmQoY29tcCkKICAgICAgOiBjb21wCiAgfQoKICBmdW5jdGlvbiBjcmVhdGVBc3luY1BsYWNlaG9sZGVyICgKICAgIGZhY3RvcnksCiAgICBkYXRhLAogICAgY29udGV4dCwKICAgIGNoaWxkcmVuLAogICAgdGFnCiAgKSB7CiAgICB2YXIgbm9kZSA9IGNyZWF0ZUVtcHR5Vk5vZGUoKTsKICAgIG5vZGUuYXN5bmNGYWN0b3J5ID0gZmFjdG9yeTsKICAgIG5vZGUuYXN5bmNNZXRhID0geyBkYXRhOiBkYXRhLCBjb250ZXh0OiBjb250ZXh0LCBjaGlsZHJlbjogY2hpbGRyZW4sIHRhZzogdGFnIH07CiAgICByZXR1cm4gbm9kZQogIH0KCiAgZnVuY3Rpb24gcmVzb2x2ZUFzeW5jQ29tcG9uZW50ICgKICAgIGZhY3RvcnksCiAgICBiYXNlQ3RvcgogICkgewogICAgaWYgKGlzVHJ1ZShmYWN0b3J5LmVycm9yKSAmJiBpc0RlZihmYWN0b3J5LmVycm9yQ29tcCkpIHsKICAgICAgcmV0dXJuIGZhY3RvcnkuZXJyb3JDb21wCiAgICB9CgogICAgaWYgKGlzRGVmKGZhY3RvcnkucmVzb2x2ZWQpKSB7CiAgICAgIHJldHVybiBmYWN0b3J5LnJlc29sdmVkCiAgICB9CgogICAgdmFyIG93bmVyID0gY3VycmVudFJlbmRlcmluZ0luc3RhbmNlOwogICAgaWYgKG93bmVyICYmIGlzRGVmKGZhY3Rvcnkub3duZXJzKSAmJiBmYWN0b3J5Lm93bmVycy5pbmRleE9mKG93bmVyKSA9PT0gLTEpIHsKICAgICAgLy8gYWxyZWFkeSBwZW5kaW5nCiAgICAgIGZhY3Rvcnkub3duZXJzLnB1c2gob3duZXIpOwogICAgfQoKICAgIGlmIChpc1RydWUoZmFjdG9yeS5sb2FkaW5nKSAmJiBpc0RlZihmYWN0b3J5LmxvYWRpbmdDb21wKSkgewogICAgICByZXR1cm4gZmFjdG9yeS5sb2FkaW5nQ29tcAogICAgfQoKICAgIGlmIChvd25lciAmJiAhaXNEZWYoZmFjdG9yeS5vd25lcnMpKSB7CiAgICAgIHZhciBvd25lcnMgPSBmYWN0b3J5Lm93bmVycyA9IFtvd25lcl07CiAgICAgIHZhciBzeW5jID0gdHJ1ZTsKICAgICAgdmFyIHRpbWVyTG9hZGluZyA9IG51bGw7CiAgICAgIHZhciB0aW1lclRpbWVvdXQgPSBudWxsCgogICAgICA7KG93bmVyKS4kb24oJ2hvb2s6ZGVzdHJveWVkJywgZnVuY3Rpb24gKCkgeyByZXR1cm4gcmVtb3ZlKG93bmVycywgb3duZXIpOyB9KTsKCiAgICAgIHZhciBmb3JjZVJlbmRlciA9IGZ1bmN0aW9uIChyZW5kZXJDb21wbGV0ZWQpIHsKICAgICAgICBmb3IgKHZhciBpID0gMCwgbCA9IG93bmVycy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgIChvd25lcnNbaV0pLiRmb3JjZVVwZGF0ZSgpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHJlbmRlckNvbXBsZXRlZCkgewogICAgICAgICAgb3duZXJzLmxlbmd0aCA9IDA7CiAgICAgICAgICBpZiAodGltZXJMb2FkaW5nICE9PSBudWxsKSB7CiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lckxvYWRpbmcpOwogICAgICAgICAgICB0aW1lckxvYWRpbmcgPSBudWxsOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRpbWVyVGltZW91dCAhPT0gbnVsbCkgewogICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZXJUaW1lb3V0KTsKICAgICAgICAgICAgdGltZXJUaW1lb3V0ID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH07CgogICAgICB2YXIgcmVzb2x2ZSA9IG9uY2UoZnVuY3Rpb24gKHJlcykgewogICAgICAgIC8vIGNhY2hlIHJlc29sdmVkCiAgICAgICAgZmFjdG9yeS5yZXNvbHZlZCA9IGVuc3VyZUN0b3IocmVzLCBiYXNlQ3Rvcik7CiAgICAgICAgLy8gaW52b2tlIGNhbGxiYWNrcyBvbmx5IGlmIHRoaXMgaXMgbm90IGEgc3luY2hyb25vdXMgcmVzb2x2ZQogICAgICAgIC8vIChhc3luYyByZXNvbHZlcyBhcmUgc2hpbW1lZCBhcyBzeW5jaHJvbm91cyBkdXJpbmcgU1NSKQogICAgICAgIGlmICghc3luYykgewogICAgICAgICAgZm9yY2VSZW5kZXIodHJ1ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG93bmVycy5sZW5ndGggPSAwOwogICAgICAgIH0KICAgICAgfSk7CgogICAgICB2YXIgcmVqZWN0ID0gb25jZShmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgd2FybigKICAgICAgICAgICJGYWlsZWQgdG8gcmVzb2x2ZSBhc3luYyBjb21wb25lbnQ6ICIgKyAoU3RyaW5nKGZhY3RvcnkpKSArCiAgICAgICAgICAocmVhc29uID8gKCJcblJlYXNvbjogIiArIHJlYXNvbikgOiAnJykKICAgICAgICApOwogICAgICAgIGlmIChpc0RlZihmYWN0b3J5LmVycm9yQ29tcCkpIHsKICAgICAgICAgIGZhY3RvcnkuZXJyb3IgPSB0cnVlOwogICAgICAgICAgZm9yY2VSZW5kZXIodHJ1ZSk7CiAgICAgICAgfQogICAgICB9KTsKCiAgICAgIHZhciByZXMgPSBmYWN0b3J5KHJlc29sdmUsIHJlamVjdCk7CgogICAgICBpZiAoaXNPYmplY3QocmVzKSkgewogICAgICAgIGlmIChpc1Byb21pc2UocmVzKSkgewogICAgICAgICAgLy8gKCkgPT4gUHJvbWlzZQogICAgICAgICAgaWYgKGlzVW5kZWYoZmFjdG9yeS5yZXNvbHZlZCkpIHsKICAgICAgICAgICAgcmVzLnRoZW4ocmVzb2x2ZSwgcmVqZWN0KTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGlzUHJvbWlzZShyZXMuY29tcG9uZW50KSkgewogICAgICAgICAgcmVzLmNvbXBvbmVudC50aGVuKHJlc29sdmUsIHJlamVjdCk7CgogICAgICAgICAgaWYgKGlzRGVmKHJlcy5lcnJvcikpIHsKICAgICAgICAgICAgZmFjdG9yeS5lcnJvckNvbXAgPSBlbnN1cmVDdG9yKHJlcy5lcnJvciwgYmFzZUN0b3IpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChpc0RlZihyZXMubG9hZGluZykpIHsKICAgICAgICAgICAgZmFjdG9yeS5sb2FkaW5nQ29tcCA9IGVuc3VyZUN0b3IocmVzLmxvYWRpbmcsIGJhc2VDdG9yKTsKICAgICAgICAgICAgaWYgKHJlcy5kZWxheSA9PT0gMCkgewogICAgICAgICAgICAgIGZhY3RvcnkubG9hZGluZyA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGltZXJMb2FkaW5nID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB0aW1lckxvYWRpbmcgPSBudWxsOwogICAgICAgICAgICAgICAgaWYgKGlzVW5kZWYoZmFjdG9yeS5yZXNvbHZlZCkgJiYgaXNVbmRlZihmYWN0b3J5LmVycm9yKSkgewogICAgICAgICAgICAgICAgICBmYWN0b3J5LmxvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgICBmb3JjZVJlbmRlcihmYWxzZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwgcmVzLmRlbGF5IHx8IDIwMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoaXNEZWYocmVzLnRpbWVvdXQpKSB7CiAgICAgICAgICAgIHRpbWVyVGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHRpbWVyVGltZW91dCA9IG51bGw7CiAgICAgICAgICAgICAgaWYgKGlzVW5kZWYoZmFjdG9yeS5yZXNvbHZlZCkpIHsKICAgICAgICAgICAgICAgIHJlamVjdCgKICAgICAgICAgICAgICAgICAgInRpbWVvdXQgKCIgKyAocmVzLnRpbWVvdXQpICsgIm1zKSIKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCByZXMudGltZW91dCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICBzeW5jID0gZmFsc2U7CiAgICAgIC8vIHJldHVybiBpbiBjYXNlIHJlc29sdmVkIHN5bmNocm9ub3VzbHkKICAgICAgcmV0dXJuIGZhY3RvcnkubG9hZGluZwogICAgICAgID8gZmFjdG9yeS5sb2FkaW5nQ29tcAogICAgICAgIDogZmFjdG9yeS5yZXNvbHZlZAogICAgfQogIH0KCiAgLyogICovCgogIGZ1bmN0aW9uIGlzQXN5bmNQbGFjZWhvbGRlciAobm9kZSkgewogICAgcmV0dXJuIG5vZGUuaXNDb21tZW50ICYmIG5vZGUuYXN5bmNGYWN0b3J5CiAgfQoKICAvKiAgKi8KCiAgZnVuY3Rpb24gZ2V0Rmlyc3RDb21wb25lbnRDaGlsZCAoY2hpbGRyZW4pIHsKICAgIGlmIChBcnJheS5pc0FycmF5KGNoaWxkcmVuKSkgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGMgPSBjaGlsZHJlbltpXTsKICAgICAgICBpZiAoaXNEZWYoYykgJiYgKGlzRGVmKGMuY29tcG9uZW50T3B0aW9ucykgfHwgaXNBc3luY1BsYWNlaG9sZGVyKGMpKSkgewogICAgICAgICAgcmV0dXJuIGMKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIC8qICAqLwoKICAvKiAgKi8KCiAgZnVuY3Rpb24gaW5pdEV2ZW50cyAodm0pIHsKICAgIHZtLl9ldmVudHMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgdm0uX2hhc0hvb2tFdmVudCA9IGZhbHNlOwogICAgLy8gaW5pdCBwYXJlbnQgYXR0YWNoZWQgZXZlbnRzCiAgICB2YXIgbGlzdGVuZXJzID0gdm0uJG9wdGlvbnMuX3BhcmVudExpc3RlbmVyczsKICAgIGlmIChsaXN0ZW5lcnMpIHsKICAgICAgdXBkYXRlQ29tcG9uZW50TGlzdGVuZXJzKHZtLCBsaXN0ZW5lcnMpOwogICAgfQogIH0KCiAgdmFyIHRhcmdldDsKCiAgZnVuY3Rpb24gYWRkIChldmVudCwgZm4pIHsKICAgIHRhcmdldC4kb24oZXZlbnQsIGZuKTsKICB9CgogIGZ1bmN0aW9uIHJlbW92ZSQxIChldmVudCwgZm4pIHsKICAgIHRhcmdldC4kb2ZmKGV2ZW50LCBmbik7CiAgfQoKICBmdW5jdGlvbiBjcmVhdGVPbmNlSGFuZGxlciAoZXZlbnQsIGZuKSB7CiAgICB2YXIgX3RhcmdldCA9IHRhcmdldDsKICAgIHJldHVybiBmdW5jdGlvbiBvbmNlSGFuZGxlciAoKSB7CiAgICAgIHZhciByZXMgPSBmbi5hcHBseShudWxsLCBhcmd1bWVudHMpOwogICAgICBpZiAocmVzICE9PSBudWxsKSB7CiAgICAgICAgX3RhcmdldC4kb2ZmKGV2ZW50LCBvbmNlSGFuZGxlcik7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIHVwZGF0ZUNvbXBvbmVudExpc3RlbmVycyAoCiAgICB2bSwKICAgIGxpc3RlbmVycywKICAgIG9sZExpc3RlbmVycwogICkgewogICAgdGFyZ2V0ID0gdm07CiAgICB1cGRhdGVMaXN0ZW5lcnMobGlzdGVuZXJzLCBvbGRMaXN0ZW5lcnMgfHwge30sIGFkZCwgcmVtb3ZlJDEsIGNyZWF0ZU9uY2VIYW5kbGVyLCB2bSk7CiAgICB0YXJnZXQgPSB1bmRlZmluZWQ7CiAgfQoKICBmdW5jdGlvbiBldmVudHNNaXhpbiAoVnVlKSB7CiAgICB2YXIgaG9va1JFID0gL15ob29rOi87CiAgICBWdWUucHJvdG90eXBlLiRvbiA9IGZ1bmN0aW9uIChldmVudCwgZm4pIHsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZXZlbnQpKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBldmVudC5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgIHZtLiRvbihldmVudFtpXSwgZm4pOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAodm0uX2V2ZW50c1tldmVudF0gfHwgKHZtLl9ldmVudHNbZXZlbnRdID0gW10pKS5wdXNoKGZuKTsKICAgICAgICAvLyBvcHRpbWl6ZSBob29rOmV2ZW50IGNvc3QgYnkgdXNpbmcgYSBib29sZWFuIGZsYWcgbWFya2VkIGF0IHJlZ2lzdHJhdGlvbgogICAgICAgIC8vIGluc3RlYWQgb2YgYSBoYXNoIGxvb2t1cAogICAgICAgIGlmIChob29rUkUudGVzdChldmVudCkpIHsKICAgICAgICAgIHZtLl9oYXNIb29rRXZlbnQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gdm0KICAgIH07CgogICAgVnVlLnByb3RvdHlwZS4kb25jZSA9IGZ1bmN0aW9uIChldmVudCwgZm4pIHsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgZnVuY3Rpb24gb24gKCkgewogICAgICAgIHZtLiRvZmYoZXZlbnQsIG9uKTsKICAgICAgICBmbi5hcHBseSh2bSwgYXJndW1lbnRzKTsKICAgICAgfQogICAgICBvbi5mbiA9IGZuOwogICAgICB2bS4kb24oZXZlbnQsIG9uKTsKICAgICAgcmV0dXJuIHZtCiAgICB9OwoKICAgIFZ1ZS5wcm90b3R5cGUuJG9mZiA9IGZ1bmN0aW9uIChldmVudCwgZm4pIHsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgLy8gYWxsCiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgewogICAgICAgIHZtLl9ldmVudHMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgIHJldHVybiB2bQogICAgICB9CiAgICAgIC8vIGFycmF5IG9mIGV2ZW50cwogICAgICBpZiAoQXJyYXkuaXNBcnJheShldmVudCkpIHsKICAgICAgICBmb3IgKHZhciBpJDEgPSAwLCBsID0gZXZlbnQubGVuZ3RoOyBpJDEgPCBsOyBpJDErKykgewogICAgICAgICAgdm0uJG9mZihldmVudFtpJDFdLCBmbik7CiAgICAgICAgfQogICAgICAgIHJldHVybiB2bQogICAgICB9CiAgICAgIC8vIHNwZWNpZmljIGV2ZW50CiAgICAgIHZhciBjYnMgPSB2bS5fZXZlbnRzW2V2ZW50XTsKICAgICAgaWYgKCFjYnMpIHsKICAgICAgICByZXR1cm4gdm0KICAgICAgfQogICAgICBpZiAoIWZuKSB7CiAgICAgICAgdm0uX2V2ZW50c1tldmVudF0gPSBudWxsOwogICAgICAgIHJldHVybiB2bQogICAgICB9CiAgICAgIC8vIHNwZWNpZmljIGhhbmRsZXIKICAgICAgdmFyIGNiOwogICAgICB2YXIgaSA9IGNicy5sZW5ndGg7CiAgICAgIHdoaWxlIChpLS0pIHsKICAgICAgICBjYiA9IGNic1tpXTsKICAgICAgICBpZiAoY2IgPT09IGZuIHx8IGNiLmZuID09PSBmbikgewogICAgICAgICAgY2JzLnNwbGljZShpLCAxKTsKICAgICAgICAgIGJyZWFrCiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB2bQogICAgfTsKCiAgICBWdWUucHJvdG90eXBlLiRlbWl0ID0gZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgIHsKICAgICAgICB2YXIgbG93ZXJDYXNlRXZlbnQgPSBldmVudC50b0xvd2VyQ2FzZSgpOwogICAgICAgIGlmIChsb3dlckNhc2VFdmVudCAhPT0gZXZlbnQgJiYgdm0uX2V2ZW50c1tsb3dlckNhc2VFdmVudF0pIHsKICAgICAgICAgIHRpcCgKICAgICAgICAgICAgIkV2ZW50IFwiIiArIGxvd2VyQ2FzZUV2ZW50ICsgIlwiIGlzIGVtaXR0ZWQgaW4gY29tcG9uZW50ICIgKwogICAgICAgICAgICAoZm9ybWF0Q29tcG9uZW50TmFtZSh2bSkpICsgIiBidXQgdGhlIGhhbmRsZXIgaXMgcmVnaXN0ZXJlZCBmb3IgXCIiICsgZXZlbnQgKyAiXCIuICIgKwogICAgICAgICAgICAiTm90ZSB0aGF0IEhUTUwgYXR0cmlidXRlcyBhcmUgY2FzZS1pbnNlbnNpdGl2ZSBhbmQgeW91IGNhbm5vdCB1c2UgIiArCiAgICAgICAgICAgICJ2LW9uIHRvIGxpc3RlbiB0byBjYW1lbENhc2UgZXZlbnRzIHdoZW4gdXNpbmcgaW4tRE9NIHRlbXBsYXRlcy4gIiArCiAgICAgICAgICAgICJZb3Ugc2hvdWxkIHByb2JhYmx5IHVzZSBcIiIgKyAoaHlwaGVuYXRlKGV2ZW50KSkgKyAiXCIgaW5zdGVhZCBvZiBcIiIgKyBldmVudCArICJcIi4iCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgfQogICAgICB2YXIgY2JzID0gdm0uX2V2ZW50c1tldmVudF07CiAgICAgIGlmIChjYnMpIHsKICAgICAgICBjYnMgPSBjYnMubGVuZ3RoID4gMSA/IHRvQXJyYXkoY2JzKSA6IGNiczsKICAgICAgICB2YXIgYXJncyA9IHRvQXJyYXkoYXJndW1lbnRzLCAxKTsKICAgICAgICB2YXIgaW5mbyA9ICJldmVudCBoYW5kbGVyIGZvciBcIiIgKyBldmVudCArICJcIiI7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBjYnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICBpbnZva2VXaXRoRXJyb3JIYW5kbGluZyhjYnNbaV0sIHZtLCBhcmdzLCB2bSwgaW5mbyk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB2bQogICAgfTsKICB9CgogIC8qICAqLwoKICB2YXIgYWN0aXZlSW5zdGFuY2UgPSBudWxsOwogIHZhciBpc1VwZGF0aW5nQ2hpbGRDb21wb25lbnQgPSBmYWxzZTsKCiAgZnVuY3Rpb24gc2V0QWN0aXZlSW5zdGFuY2Uodm0pIHsKICAgIHZhciBwcmV2QWN0aXZlSW5zdGFuY2UgPSBhY3RpdmVJbnN0YW5jZTsKICAgIGFjdGl2ZUluc3RhbmNlID0gdm07CiAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICBhY3RpdmVJbnN0YW5jZSA9IHByZXZBY3RpdmVJbnN0YW5jZTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGluaXRMaWZlY3ljbGUgKHZtKSB7CiAgICB2YXIgb3B0aW9ucyA9IHZtLiRvcHRpb25zOwoKICAgIC8vIGxvY2F0ZSBmaXJzdCBub24tYWJzdHJhY3QgcGFyZW50CiAgICB2YXIgcGFyZW50ID0gb3B0aW9ucy5wYXJlbnQ7CiAgICBpZiAocGFyZW50ICYmICFvcHRpb25zLmFic3RyYWN0KSB7CiAgICAgIHdoaWxlIChwYXJlbnQuJG9wdGlvbnMuYWJzdHJhY3QgJiYgcGFyZW50LiRwYXJlbnQpIHsKICAgICAgICBwYXJlbnQgPSBwYXJlbnQuJHBhcmVudDsKICAgICAgfQogICAgICBwYXJlbnQuJGNoaWxkcmVuLnB1c2godm0pOwogICAgfQoKICAgIHZtLiRwYXJlbnQgPSBwYXJlbnQ7CiAgICB2bS4kcm9vdCA9IHBhcmVudCA/IHBhcmVudC4kcm9vdCA6IHZtOwoKICAgIHZtLiRjaGlsZHJlbiA9IFtdOwogICAgdm0uJHJlZnMgPSB7fTsKCiAgICB2bS5fd2F0Y2hlciA9IG51bGw7CiAgICB2bS5faW5hY3RpdmUgPSBudWxsOwogICAgdm0uX2RpcmVjdEluYWN0aXZlID0gZmFsc2U7CiAgICB2bS5faXNNb3VudGVkID0gZmFsc2U7CiAgICB2bS5faXNEZXN0cm95ZWQgPSBmYWxzZTsKICAgIHZtLl9pc0JlaW5nRGVzdHJveWVkID0gZmFsc2U7CiAgfQoKICBmdW5jdGlvbiBsaWZlY3ljbGVNaXhpbiAoVnVlKSB7CiAgICBWdWUucHJvdG90eXBlLl91cGRhdGUgPSBmdW5jdGlvbiAodm5vZGUsIGh5ZHJhdGluZykgewogICAgICB2YXIgdm0gPSB0aGlzOwogICAgICB2YXIgcHJldkVsID0gdm0uJGVsOwogICAgICB2YXIgcHJldlZub2RlID0gdm0uX3Zub2RlOwogICAgICB2YXIgcmVzdG9yZUFjdGl2ZUluc3RhbmNlID0gc2V0QWN0aXZlSW5zdGFuY2Uodm0pOwogICAgICB2bS5fdm5vZGUgPSB2bm9kZTsKICAgICAgLy8gVnVlLnByb3RvdHlwZS5fX3BhdGNoX18gaXMgaW5qZWN0ZWQgaW4gZW50cnkgcG9pbnRzCiAgICAgIC8vIGJhc2VkIG9uIHRoZSByZW5kZXJpbmcgYmFja2VuZCB1c2VkLgogICAgICBpZiAoIXByZXZWbm9kZSkgewogICAgICAgIC8vIGluaXRpYWwgcmVuZGVyCiAgICAgICAgdm0uJGVsID0gdm0uX19wYXRjaF9fKHZtLiRlbCwgdm5vZGUsIGh5ZHJhdGluZywgZmFsc2UgLyogcmVtb3ZlT25seSAqLyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gdXBkYXRlcwogICAgICAgIHZtLiRlbCA9IHZtLl9fcGF0Y2hfXyhwcmV2Vm5vZGUsIHZub2RlKTsKICAgICAgfQogICAgICByZXN0b3JlQWN0aXZlSW5zdGFuY2UoKTsKICAgICAgLy8gdXBkYXRlIF9fdnVlX18gcmVmZXJlbmNlCiAgICAgIGlmIChwcmV2RWwpIHsKICAgICAgICBwcmV2RWwuX192dWVfXyA9IG51bGw7CiAgICAgIH0KICAgICAgaWYgKHZtLiRlbCkgewogICAgICAgIHZtLiRlbC5fX3Z1ZV9fID0gdm07CiAgICAgIH0KICAgICAgLy8gaWYgcGFyZW50IGlzIGFuIEhPQywgdXBkYXRlIGl0cyAkZWwgYXMgd2VsbAogICAgICBpZiAodm0uJHZub2RlICYmIHZtLiRwYXJlbnQgJiYgdm0uJHZub2RlID09PSB2bS4kcGFyZW50Ll92bm9kZSkgewogICAgICAgIHZtLiRwYXJlbnQuJGVsID0gdm0uJGVsOwogICAgICB9CiAgICAgIC8vIHVwZGF0ZWQgaG9vayBpcyBjYWxsZWQgYnkgdGhlIHNjaGVkdWxlciB0byBlbnN1cmUgdGhhdCBjaGlsZHJlbiBhcmUKICAgICAgLy8gdXBkYXRlZCBpbiBhIHBhcmVudCdzIHVwZGF0ZWQgaG9vay4KICAgIH07CgogICAgVnVlLnByb3RvdHlwZS4kZm9yY2VVcGRhdGUgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgIGlmICh2bS5fd2F0Y2hlcikgewogICAgICAgIHZtLl93YXRjaGVyLnVwZGF0ZSgpOwogICAgICB9CiAgICB9OwoKICAgIFZ1ZS5wcm90b3R5cGUuJGRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgIGlmICh2bS5faXNCZWluZ0Rlc3Ryb3llZCkgewogICAgICAgIHJldHVybgogICAgICB9CiAgICAgIGNhbGxIb29rKHZtLCAnYmVmb3JlRGVzdHJveScpOwogICAgICB2bS5faXNCZWluZ0Rlc3Ryb3llZCA9IHRydWU7CiAgICAgIC8vIHJlbW92ZSBzZWxmIGZyb20gcGFyZW50CiAgICAgIHZhciBwYXJlbnQgPSB2bS4kcGFyZW50OwogICAgICBpZiAocGFyZW50ICYmICFwYXJlbnQuX2lzQmVpbmdEZXN0cm95ZWQgJiYgIXZtLiRvcHRpb25zLmFic3RyYWN0KSB7CiAgICAgICAgcmVtb3ZlKHBhcmVudC4kY2hpbGRyZW4sIHZtKTsKICAgICAgfQogICAgICAvLyB0ZWFyZG93biB3YXRjaGVycwogICAgICBpZiAodm0uX3dhdGNoZXIpIHsKICAgICAgICB2bS5fd2F0Y2hlci50ZWFyZG93bigpOwogICAgICB9CiAgICAgIHZhciBpID0gdm0uX3dhdGNoZXJzLmxlbmd0aDsKICAgICAgd2hpbGUgKGktLSkgewogICAgICAgIHZtLl93YXRjaGVyc1tpXS50ZWFyZG93bigpOwogICAgICB9CiAgICAgIC8vIHJlbW92ZSByZWZlcmVuY2UgZnJvbSBkYXRhIG9iCiAgICAgIC8vIGZyb3plbiBvYmplY3QgbWF5IG5vdCBoYXZlIG9ic2VydmVyLgogICAgICBpZiAodm0uX2RhdGEuX19vYl9fKSB7CiAgICAgICAgdm0uX2RhdGEuX19vYl9fLnZtQ291bnQtLTsKICAgICAgfQogICAgICAvLyBjYWxsIHRoZSBsYXN0IGhvb2suLi4KICAgICAgdm0uX2lzRGVzdHJveWVkID0gdHJ1ZTsKICAgICAgLy8gaW52b2tlIGRlc3Ryb3kgaG9va3Mgb24gY3VycmVudCByZW5kZXJlZCB0cmVlCiAgICAgIHZtLl9fcGF0Y2hfXyh2bS5fdm5vZGUsIG51bGwpOwogICAgICAvLyBmaXJlIGRlc3Ryb3llZCBob29rCiAgICAgIGNhbGxIb29rKHZtLCAnZGVzdHJveWVkJyk7CiAgICAgIC8vIHR1cm4gb2ZmIGFsbCBpbnN0YW5jZSBsaXN0ZW5lcnMuCiAgICAgIHZtLiRvZmYoKTsKICAgICAgLy8gcmVtb3ZlIF9fdnVlX18gcmVmZXJlbmNlCiAgICAgIGlmICh2bS4kZWwpIHsKICAgICAgICB2bS4kZWwuX192dWVfXyA9IG51bGw7CiAgICAgIH0KICAgICAgLy8gcmVsZWFzZSBjaXJjdWxhciByZWZlcmVuY2UgKCM2NzU5KQogICAgICBpZiAodm0uJHZub2RlKSB7CiAgICAgICAgdm0uJHZub2RlLnBhcmVudCA9IG51bGw7CiAgICAgIH0KICAgIH07CiAgfQoKICBmdW5jdGlvbiBtb3VudENvbXBvbmVudCAoCiAgICB2bSwKICAgIGVsLAogICAgaHlkcmF0aW5nCiAgKSB7CiAgICB2bS4kZWwgPSBlbDsKICAgIGlmICghdm0uJG9wdGlvbnMucmVuZGVyKSB7CiAgICAgIHZtLiRvcHRpb25zLnJlbmRlciA9IGNyZWF0ZUVtcHR5Vk5vZGU7CiAgICAgIHsKICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgICBpZiAoKHZtLiRvcHRpb25zLnRlbXBsYXRlICYmIHZtLiRvcHRpb25zLnRlbXBsYXRlLmNoYXJBdCgwKSAhPT0gJyMnKSB8fAogICAgICAgICAgdm0uJG9wdGlvbnMuZWwgfHwgZWwpIHsKICAgICAgICAgIHdhcm4oCiAgICAgICAgICAgICdZb3UgYXJlIHVzaW5nIHRoZSBydW50aW1lLW9ubHkgYnVpbGQgb2YgVnVlIHdoZXJlIHRoZSB0ZW1wbGF0ZSAnICsKICAgICAgICAgICAgJ2NvbXBpbGVyIGlzIG5vdCBhdmFpbGFibGUuIEVpdGhlciBwcmUtY29tcGlsZSB0aGUgdGVtcGxhdGVzIGludG8gJyArCiAgICAgICAgICAgICdyZW5kZXIgZnVuY3Rpb25zLCBvciB1c2UgdGhlIGNvbXBpbGVyLWluY2x1ZGVkIGJ1aWxkLicsCiAgICAgICAgICAgIHZtCiAgICAgICAgICApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB3YXJuKAogICAgICAgICAgICAnRmFpbGVkIHRvIG1vdW50IGNvbXBvbmVudDogdGVtcGxhdGUgb3IgcmVuZGVyIGZ1bmN0aW9uIG5vdCBkZWZpbmVkLicsCiAgICAgICAgICAgIHZtCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgY2FsbEhvb2sodm0sICdiZWZvcmVNb3VudCcpOwoKICAgIHZhciB1cGRhdGVDb21wb25lbnQ7CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgIGlmIChjb25maWcucGVyZm9ybWFuY2UgJiYgbWFyaykgewogICAgICB1cGRhdGVDb21wb25lbnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIG5hbWUgPSB2bS5fbmFtZTsKICAgICAgICB2YXIgaWQgPSB2bS5fdWlkOwogICAgICAgIHZhciBzdGFydFRhZyA9ICJ2dWUtcGVyZi1zdGFydDoiICsgaWQ7CiAgICAgICAgdmFyIGVuZFRhZyA9ICJ2dWUtcGVyZi1lbmQ6IiArIGlkOwoKICAgICAgICBtYXJrKHN0YXJ0VGFnKTsKICAgICAgICB2YXIgdm5vZGUgPSB2bS5fcmVuZGVyKCk7CiAgICAgICAgbWFyayhlbmRUYWcpOwogICAgICAgIG1lYXN1cmUoKCJ2dWUgIiArIG5hbWUgKyAiIHJlbmRlciIpLCBzdGFydFRhZywgZW5kVGFnKTsKCiAgICAgICAgbWFyayhzdGFydFRhZyk7CiAgICAgICAgdm0uX3VwZGF0ZSh2bm9kZSwgaHlkcmF0aW5nKTsKICAgICAgICBtYXJrKGVuZFRhZyk7CiAgICAgICAgbWVhc3VyZSgoInZ1ZSAiICsgbmFtZSArICIgcGF0Y2giKSwgc3RhcnRUYWcsIGVuZFRhZyk7CiAgICAgIH07CiAgICB9IGVsc2UgewogICAgICB1cGRhdGVDb21wb25lbnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgdm0uX3VwZGF0ZSh2bS5fcmVuZGVyKCksIGh5ZHJhdGluZyk7CiAgICAgIH07CiAgICB9CgogICAgLy8gd2Ugc2V0IHRoaXMgdG8gdm0uX3dhdGNoZXIgaW5zaWRlIHRoZSB3YXRjaGVyJ3MgY29uc3RydWN0b3IKICAgIC8vIHNpbmNlIHRoZSB3YXRjaGVyJ3MgaW5pdGlhbCBwYXRjaCBtYXkgY2FsbCAkZm9yY2VVcGRhdGUgKGUuZy4gaW5zaWRlIGNoaWxkCiAgICAvLyBjb21wb25lbnQncyBtb3VudGVkIGhvb2spLCB3aGljaCByZWxpZXMgb24gdm0uX3dhdGNoZXIgYmVpbmcgYWxyZWFkeSBkZWZpbmVkCiAgICBuZXcgV2F0Y2hlcih2bSwgdXBkYXRlQ29tcG9uZW50LCBub29wLCB7CiAgICAgIGJlZm9yZTogZnVuY3Rpb24gYmVmb3JlICgpIHsKICAgICAgICBpZiAodm0uX2lzTW91bnRlZCAmJiAhdm0uX2lzRGVzdHJveWVkKSB7CiAgICAgICAgICBjYWxsSG9vayh2bSwgJ2JlZm9yZVVwZGF0ZScpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgdHJ1ZSAvKiBpc1JlbmRlcldhdGNoZXIgKi8pOwogICAgaHlkcmF0aW5nID0gZmFsc2U7CgogICAgLy8gbWFudWFsbHkgbW91bnRlZCBpbnN0YW5jZSwgY2FsbCBtb3VudGVkIG9uIHNlbGYKICAgIC8vIG1vdW50ZWQgaXMgY2FsbGVkIGZvciByZW5kZXItY3JlYXRlZCBjaGlsZCBjb21wb25lbnRzIGluIGl0cyBpbnNlcnRlZCBob29rCiAgICBpZiAodm0uJHZub2RlID09IG51bGwpIHsKICAgICAgdm0uX2lzTW91bnRlZCA9IHRydWU7CiAgICAgIGNhbGxIb29rKHZtLCAnbW91bnRlZCcpOwogICAgfQogICAgcmV0dXJuIHZtCiAgfQoKICBmdW5jdGlvbiB1cGRhdGVDaGlsZENvbXBvbmVudCAoCiAgICB2bSwKICAgIHByb3BzRGF0YSwKICAgIGxpc3RlbmVycywKICAgIHBhcmVudFZub2RlLAogICAgcmVuZGVyQ2hpbGRyZW4KICApIHsKICAgIHsKICAgICAgaXNVcGRhdGluZ0NoaWxkQ29tcG9uZW50ID0gdHJ1ZTsKICAgIH0KCiAgICAvLyBkZXRlcm1pbmUgd2hldGhlciBjb21wb25lbnQgaGFzIHNsb3QgY2hpbGRyZW4KICAgIC8vIHdlIG5lZWQgdG8gZG8gdGhpcyBiZWZvcmUgb3ZlcndyaXRpbmcgJG9wdGlvbnMuX3JlbmRlckNoaWxkcmVuLgoKICAgIC8vIGNoZWNrIGlmIHRoZXJlIGFyZSBkeW5hbWljIHNjb3BlZFNsb3RzIChoYW5kLXdyaXR0ZW4gb3IgY29tcGlsZWQgYnV0IHdpdGgKICAgIC8vIGR5bmFtaWMgc2xvdCBuYW1lcykuIFN0YXRpYyBzY29wZWQgc2xvdHMgY29tcGlsZWQgZnJvbSB0ZW1wbGF0ZSBoYXMgdGhlCiAgICAvLyAiJHN0YWJsZSIgbWFya2VyLgogICAgdmFyIG5ld1Njb3BlZFNsb3RzID0gcGFyZW50Vm5vZGUuZGF0YS5zY29wZWRTbG90czsKICAgIHZhciBvbGRTY29wZWRTbG90cyA9IHZtLiRzY29wZWRTbG90czsKICAgIHZhciBoYXNEeW5hbWljU2NvcGVkU2xvdCA9ICEhKAogICAgICAobmV3U2NvcGVkU2xvdHMgJiYgIW5ld1Njb3BlZFNsb3RzLiRzdGFibGUpIHx8CiAgICAgIChvbGRTY29wZWRTbG90cyAhPT0gZW1wdHlPYmplY3QgJiYgIW9sZFNjb3BlZFNsb3RzLiRzdGFibGUpIHx8CiAgICAgIChuZXdTY29wZWRTbG90cyAmJiB2bS4kc2NvcGVkU2xvdHMuJGtleSAhPT0gbmV3U2NvcGVkU2xvdHMuJGtleSkKICAgICk7CgogICAgLy8gQW55IHN0YXRpYyBzbG90IGNoaWxkcmVuIGZyb20gdGhlIHBhcmVudCBtYXkgaGF2ZSBjaGFuZ2VkIGR1cmluZyBwYXJlbnQncwogICAgLy8gdXBkYXRlLiBEeW5hbWljIHNjb3BlZCBzbG90cyBtYXkgYWxzbyBoYXZlIGNoYW5nZWQuIEluIHN1Y2ggY2FzZXMsIGEgZm9yY2VkCiAgICAvLyB1cGRhdGUgaXMgbmVjZXNzYXJ5IHRvIGVuc3VyZSBjb3JyZWN0bmVzcy4KICAgIHZhciBuZWVkc0ZvcmNlVXBkYXRlID0gISEoCiAgICAgIHJlbmRlckNoaWxkcmVuIHx8ICAgICAgICAgICAgICAgLy8gaGFzIG5ldyBzdGF0aWMgc2xvdHMKICAgICAgdm0uJG9wdGlvbnMuX3JlbmRlckNoaWxkcmVuIHx8ICAvLyBoYXMgb2xkIHN0YXRpYyBzbG90cwogICAgICBoYXNEeW5hbWljU2NvcGVkU2xvdAogICAgKTsKCiAgICB2bS4kb3B0aW9ucy5fcGFyZW50Vm5vZGUgPSBwYXJlbnRWbm9kZTsKICAgIHZtLiR2bm9kZSA9IHBhcmVudFZub2RlOyAvLyB1cGRhdGUgdm0ncyBwbGFjZWhvbGRlciBub2RlIHdpdGhvdXQgcmUtcmVuZGVyCgogICAgaWYgKHZtLl92bm9kZSkgeyAvLyB1cGRhdGUgY2hpbGQgdHJlZSdzIHBhcmVudAogICAgICB2bS5fdm5vZGUucGFyZW50ID0gcGFyZW50Vm5vZGU7CiAgICB9CiAgICB2bS4kb3B0aW9ucy5fcmVuZGVyQ2hpbGRyZW4gPSByZW5kZXJDaGlsZHJlbjsKCiAgICAvLyB1cGRhdGUgJGF0dHJzIGFuZCAkbGlzdGVuZXJzIGhhc2gKICAgIC8vIHRoZXNlIGFyZSBhbHNvIHJlYWN0aXZlIHNvIHRoZXkgbWF5IHRyaWdnZXIgY2hpbGQgdXBkYXRlIGlmIHRoZSBjaGlsZAogICAgLy8gdXNlZCB0aGVtIGR1cmluZyByZW5kZXIKICAgIHZtLiRhdHRycyA9IHBhcmVudFZub2RlLmRhdGEuYXR0cnMgfHwgZW1wdHlPYmplY3Q7CiAgICB2bS4kbGlzdGVuZXJzID0gbGlzdGVuZXJzIHx8IGVtcHR5T2JqZWN0OwoKICAgIC8vIHVwZGF0ZSBwcm9wcwogICAgaWYgKHByb3BzRGF0YSAmJiB2bS4kb3B0aW9ucy5wcm9wcykgewogICAgICB0b2dnbGVPYnNlcnZpbmcoZmFsc2UpOwogICAgICB2YXIgcHJvcHMgPSB2bS5fcHJvcHM7CiAgICAgIHZhciBwcm9wS2V5cyA9IHZtLiRvcHRpb25zLl9wcm9wS2V5cyB8fCBbXTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wS2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBrZXkgPSBwcm9wS2V5c1tpXTsKICAgICAgICB2YXIgcHJvcE9wdGlvbnMgPSB2bS4kb3B0aW9ucy5wcm9wczsgLy8gd3RmIGZsb3c/CiAgICAgICAgcHJvcHNba2V5XSA9IHZhbGlkYXRlUHJvcChrZXksIHByb3BPcHRpb25zLCBwcm9wc0RhdGEsIHZtKTsKICAgICAgfQogICAgICB0b2dnbGVPYnNlcnZpbmcodHJ1ZSk7CiAgICAgIC8vIGtlZXAgYSBjb3B5IG9mIHJhdyBwcm9wc0RhdGEKICAgICAgdm0uJG9wdGlvbnMucHJvcHNEYXRhID0gcHJvcHNEYXRhOwogICAgfQoKICAgIC8vIHVwZGF0ZSBsaXN0ZW5lcnMKICAgIGxpc3RlbmVycyA9IGxpc3RlbmVycyB8fCBlbXB0eU9iamVjdDsKICAgIHZhciBvbGRMaXN0ZW5lcnMgPSB2bS4kb3B0aW9ucy5fcGFyZW50TGlzdGVuZXJzOwogICAgdm0uJG9wdGlvbnMuX3BhcmVudExpc3RlbmVycyA9IGxpc3RlbmVyczsKICAgIHVwZGF0ZUNvbXBvbmVudExpc3RlbmVycyh2bSwgbGlzdGVuZXJzLCBvbGRMaXN0ZW5lcnMpOwoKICAgIC8vIHJlc29sdmUgc2xvdHMgKyBmb3JjZSB1cGRhdGUgaWYgaGFzIGNoaWxkcmVuCiAgICBpZiAobmVlZHNGb3JjZVVwZGF0ZSkgewogICAgICB2bS4kc2xvdHMgPSByZXNvbHZlU2xvdHMocmVuZGVyQ2hpbGRyZW4sIHBhcmVudFZub2RlLmNvbnRleHQpOwogICAgICB2bS4kZm9yY2VVcGRhdGUoKTsKICAgIH0KCiAgICB7CiAgICAgIGlzVXBkYXRpbmdDaGlsZENvbXBvbmVudCA9IGZhbHNlOwogICAgfQogIH0KCiAgZnVuY3Rpb24gaXNJbkluYWN0aXZlVHJlZSAodm0pIHsKICAgIHdoaWxlICh2bSAmJiAodm0gPSB2bS4kcGFyZW50KSkgewogICAgICBpZiAodm0uX2luYWN0aXZlKSB7IHJldHVybiB0cnVlIH0KICAgIH0KICAgIHJldHVybiBmYWxzZQogIH0KCiAgZnVuY3Rpb24gYWN0aXZhdGVDaGlsZENvbXBvbmVudCAodm0sIGRpcmVjdCkgewogICAgaWYgKGRpcmVjdCkgewogICAgICB2bS5fZGlyZWN0SW5hY3RpdmUgPSBmYWxzZTsKICAgICAgaWYgKGlzSW5JbmFjdGl2ZVRyZWUodm0pKSB7CiAgICAgICAgcmV0dXJuCiAgICAgIH0KICAgIH0gZWxzZSBpZiAodm0uX2RpcmVjdEluYWN0aXZlKSB7CiAgICAgIHJldHVybgogICAgfQogICAgaWYgKHZtLl9pbmFjdGl2ZSB8fCB2bS5faW5hY3RpdmUgPT09IG51bGwpIHsKICAgICAgdm0uX2luYWN0aXZlID0gZmFsc2U7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0uJGNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgYWN0aXZhdGVDaGlsZENvbXBvbmVudCh2bS4kY2hpbGRyZW5baV0pOwogICAgICB9CiAgICAgIGNhbGxIb29rKHZtLCAnYWN0aXZhdGVkJyk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBkZWFjdGl2YXRlQ2hpbGRDb21wb25lbnQgKHZtLCBkaXJlY3QpIHsKICAgIGlmIChkaXJlY3QpIHsKICAgICAgdm0uX2RpcmVjdEluYWN0aXZlID0gdHJ1ZTsKICAgICAgaWYgKGlzSW5JbmFjdGl2ZVRyZWUodm0pKSB7CiAgICAgICAgcmV0dXJuCiAgICAgIH0KICAgIH0KICAgIGlmICghdm0uX2luYWN0aXZlKSB7CiAgICAgIHZtLl9pbmFjdGl2ZSA9IHRydWU7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdm0uJGNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZGVhY3RpdmF0ZUNoaWxkQ29tcG9uZW50KHZtLiRjaGlsZHJlbltpXSk7CiAgICAgIH0KICAgICAgY2FsbEhvb2sodm0sICdkZWFjdGl2YXRlZCcpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gY2FsbEhvb2sgKHZtLCBob29rKSB7CiAgICAvLyAjNzU3MyBkaXNhYmxlIGRlcCBjb2xsZWN0aW9uIHdoZW4gaW52b2tpbmcgbGlmZWN5Y2xlIGhvb2tzCiAgICBwdXNoVGFyZ2V0KCk7CiAgICB2YXIgaGFuZGxlcnMgPSB2bS4kb3B0aW9uc1tob29rXTsKICAgIHZhciBpbmZvID0gaG9vayArICIgaG9vayI7CiAgICBpZiAoaGFuZGxlcnMpIHsKICAgICAgZm9yICh2YXIgaSA9IDAsIGogPSBoYW5kbGVycy5sZW5ndGg7IGkgPCBqOyBpKyspIHsKICAgICAgICBpbnZva2VXaXRoRXJyb3JIYW5kbGluZyhoYW5kbGVyc1tpXSwgdm0sIG51bGwsIHZtLCBpbmZvKTsKICAgICAgfQogICAgfQogICAgaWYgKHZtLl9oYXNIb29rRXZlbnQpIHsKICAgICAgdm0uJGVtaXQoJ2hvb2s6JyArIGhvb2spOwogICAgfQogICAgcG9wVGFyZ2V0KCk7CiAgfQoKICAvKiAgKi8KCiAgdmFyIE1BWF9VUERBVEVfQ09VTlQgPSAxMDA7CgogIHZhciBxdWV1ZSA9IFtdOwogIHZhciBhY3RpdmF0ZWRDaGlsZHJlbiA9IFtdOwogIHZhciBoYXMgPSB7fTsKICB2YXIgY2lyY3VsYXIgPSB7fTsKICB2YXIgd2FpdGluZyA9IGZhbHNlOwogIHZhciBmbHVzaGluZyA9IGZhbHNlOwogIHZhciBpbmRleCA9IDA7CgogIC8qKgogICAqIFJlc2V0IHRoZSBzY2hlZHVsZXIncyBzdGF0ZS4KICAgKi8KICBmdW5jdGlvbiByZXNldFNjaGVkdWxlclN0YXRlICgpIHsKICAgIGluZGV4ID0gcXVldWUubGVuZ3RoID0gYWN0aXZhdGVkQ2hpbGRyZW4ubGVuZ3RoID0gMDsKICAgIGhhcyA9IHt9OwogICAgewogICAgICBjaXJjdWxhciA9IHt9OwogICAgfQogICAgd2FpdGluZyA9IGZsdXNoaW5nID0gZmFsc2U7CiAgfQoKICAvLyBBc3luYyBlZGdlIGNhc2UgIzY1NjYgcmVxdWlyZXMgc2F2aW5nIHRoZSB0aW1lc3RhbXAgd2hlbiBldmVudCBsaXN0ZW5lcnMgYXJlCiAgLy8gYXR0YWNoZWQuIEhvd2V2ZXIsIGNhbGxpbmcgcGVyZm9ybWFuY2Uubm93KCkgaGFzIGEgcGVyZiBvdmVyaGVhZCBlc3BlY2lhbGx5CiAgLy8gaWYgdGhlIHBhZ2UgaGFzIHRob3VzYW5kcyBvZiBldmVudCBsaXN0ZW5lcnMuIEluc3RlYWQsIHdlIHRha2UgYSB0aW1lc3RhbXAKICAvLyBldmVyeSB0aW1lIHRoZSBzY2hlZHVsZXIgZmx1c2hlcyBhbmQgdXNlIHRoYXQgZm9yIGFsbCBldmVudCBsaXN0ZW5lcnMKICAvLyBhdHRhY2hlZCBkdXJpbmcgdGhhdCBmbHVzaC4KICB2YXIgY3VycmVudEZsdXNoVGltZXN0YW1wID0gMDsKCiAgLy8gQXN5bmMgZWRnZSBjYXNlIGZpeCByZXF1aXJlcyBzdG9yaW5nIGFuIGV2ZW50IGxpc3RlbmVyJ3MgYXR0YWNoIHRpbWVzdGFtcC4KICB2YXIgZ2V0Tm93ID0gRGF0ZS5ub3c7CgogIC8vIERldGVybWluZSB3aGF0IGV2ZW50IHRpbWVzdGFtcCB0aGUgYnJvd3NlciBpcyB1c2luZy4gQW5ub3lpbmdseSwgdGhlCiAgLy8gdGltZXN0YW1wIGNhbiBlaXRoZXIgYmUgaGktcmVzIChyZWxhdGl2ZSB0byBwYWdlIGxvYWQpIG9yIGxvdy1yZXMKICAvLyAocmVsYXRpdmUgdG8gVU5JWCBlcG9jaCksIHNvIGluIG9yZGVyIHRvIGNvbXBhcmUgdGltZSB3ZSBoYXZlIHRvIHVzZSB0aGUKICAvLyBzYW1lIHRpbWVzdGFtcCB0eXBlIHdoZW4gc2F2aW5nIHRoZSBmbHVzaCB0aW1lc3RhbXAuCiAgLy8gQWxsIElFIHZlcnNpb25zIHVzZSBsb3ctcmVzIGV2ZW50IHRpbWVzdGFtcHMsIGFuZCBoYXZlIHByb2JsZW1hdGljIGNsb2NrCiAgLy8gaW1wbGVtZW50YXRpb25zICgjOTYzMikKICBpZiAoaW5Ccm93c2VyICYmICFpc0lFKSB7CiAgICB2YXIgcGVyZm9ybWFuY2UgPSB3aW5kb3cucGVyZm9ybWFuY2U7CiAgICBpZiAoCiAgICAgIHBlcmZvcm1hbmNlICYmCiAgICAgIHR5cGVvZiBwZXJmb3JtYW5jZS5ub3cgPT09ICdmdW5jdGlvbicgJiYKICAgICAgZ2V0Tm93KCkgPiBkb2N1bWVudC5jcmVhdGVFdmVudCgnRXZlbnQnKS50aW1lU3RhbXAKICAgICkgewogICAgICAvLyBpZiB0aGUgZXZlbnQgdGltZXN0YW1wLCBhbHRob3VnaCBldmFsdWF0ZWQgQUZURVIgdGhlIERhdGUubm93KCksIGlzCiAgICAgIC8vIHNtYWxsZXIgdGhhbiBpdCwgaXQgbWVhbnMgdGhlIGV2ZW50IGlzIHVzaW5nIGEgaGktcmVzIHRpbWVzdGFtcCwKICAgICAgLy8gYW5kIHdlIG5lZWQgdG8gdXNlIHRoZSBoaS1yZXMgdmVyc2lvbiBmb3IgZXZlbnQgbGlzdGVuZXIgdGltZXN0YW1wcyBhcwogICAgICAvLyB3ZWxsLgogICAgICBnZXROb3cgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBwZXJmb3JtYW5jZS5ub3coKTsgfTsKICAgIH0KICB9CgogIC8qKgogICAqIEZsdXNoIGJvdGggcXVldWVzIGFuZCBydW4gdGhlIHdhdGNoZXJzLgogICAqLwogIGZ1bmN0aW9uIGZsdXNoU2NoZWR1bGVyUXVldWUgKCkgewogICAgY3VycmVudEZsdXNoVGltZXN0YW1wID0gZ2V0Tm93KCk7CiAgICBmbHVzaGluZyA9IHRydWU7CiAgICB2YXIgd2F0Y2hlciwgaWQ7CgogICAgLy8gU29ydCBxdWV1ZSBiZWZvcmUgZmx1c2guCiAgICAvLyBUaGlzIGVuc3VyZXMgdGhhdDoKICAgIC8vIDEuIENvbXBvbmVudHMgYXJlIHVwZGF0ZWQgZnJvbSBwYXJlbnQgdG8gY2hpbGQuIChiZWNhdXNlIHBhcmVudCBpcyBhbHdheXMKICAgIC8vICAgIGNyZWF0ZWQgYmVmb3JlIHRoZSBjaGlsZCkKICAgIC8vIDIuIEEgY29tcG9uZW50J3MgdXNlciB3YXRjaGVycyBhcmUgcnVuIGJlZm9yZSBpdHMgcmVuZGVyIHdhdGNoZXIgKGJlY2F1c2UKICAgIC8vICAgIHVzZXIgd2F0Y2hlcnMgYXJlIGNyZWF0ZWQgYmVmb3JlIHRoZSByZW5kZXIgd2F0Y2hlcikKICAgIC8vIDMuIElmIGEgY29tcG9uZW50IGlzIGRlc3Ryb3llZCBkdXJpbmcgYSBwYXJlbnQgY29tcG9uZW50J3Mgd2F0Y2hlciBydW4sCiAgICAvLyAgICBpdHMgd2F0Y2hlcnMgY2FuIGJlIHNraXBwZWQuCiAgICBxdWV1ZS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7IHJldHVybiBhLmlkIC0gYi5pZDsgfSk7CgogICAgLy8gZG8gbm90IGNhY2hlIGxlbmd0aCBiZWNhdXNlIG1vcmUgd2F0Y2hlcnMgbWlnaHQgYmUgcHVzaGVkCiAgICAvLyBhcyB3ZSBydW4gZXhpc3Rpbmcgd2F0Y2hlcnMKICAgIGZvciAoaW5kZXggPSAwOyBpbmRleCA8IHF1ZXVlLmxlbmd0aDsgaW5kZXgrKykgewogICAgICB3YXRjaGVyID0gcXVldWVbaW5kZXhdOwogICAgICBpZiAod2F0Y2hlci5iZWZvcmUpIHsKICAgICAgICB3YXRjaGVyLmJlZm9yZSgpOwogICAgICB9CiAgICAgIGlkID0gd2F0Y2hlci5pZDsKICAgICAgaGFzW2lkXSA9IG51bGw7CiAgICAgIHdhdGNoZXIucnVuKCk7CiAgICAgIC8vIGluIGRldiBidWlsZCwgY2hlY2sgYW5kIHN0b3AgY2lyY3VsYXIgdXBkYXRlcy4KICAgICAgaWYgKGhhc1tpZF0gIT0gbnVsbCkgewogICAgICAgIGNpcmN1bGFyW2lkXSA9IChjaXJjdWxhcltpZF0gfHwgMCkgKyAxOwogICAgICAgIGlmIChjaXJjdWxhcltpZF0gPiBNQVhfVVBEQVRFX0NPVU5UKSB7CiAgICAgICAgICB3YXJuKAogICAgICAgICAgICAnWW91IG1heSBoYXZlIGFuIGluZmluaXRlIHVwZGF0ZSBsb29wICcgKyAoCiAgICAgICAgICAgICAgd2F0Y2hlci51c2VyCiAgICAgICAgICAgICAgICA/ICgiaW4gd2F0Y2hlciB3aXRoIGV4cHJlc3Npb24gXCIiICsgKHdhdGNoZXIuZXhwcmVzc2lvbikgKyAiXCIiKQogICAgICAgICAgICAgICAgOiAiaW4gYSBjb21wb25lbnQgcmVuZGVyIGZ1bmN0aW9uLiIKICAgICAgICAgICAgKSwKICAgICAgICAgICAgd2F0Y2hlci52bQogICAgICAgICAgKTsKICAgICAgICAgIGJyZWFrCiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgLy8ga2VlcCBjb3BpZXMgb2YgcG9zdCBxdWV1ZXMgYmVmb3JlIHJlc2V0dGluZyBzdGF0ZQogICAgdmFyIGFjdGl2YXRlZFF1ZXVlID0gYWN0aXZhdGVkQ2hpbGRyZW4uc2xpY2UoKTsKICAgIHZhciB1cGRhdGVkUXVldWUgPSBxdWV1ZS5zbGljZSgpOwoKICAgIHJlc2V0U2NoZWR1bGVyU3RhdGUoKTsKCiAgICAvLyBjYWxsIGNvbXBvbmVudCB1cGRhdGVkIGFuZCBhY3RpdmF0ZWQgaG9va3MKICAgIGNhbGxBY3RpdmF0ZWRIb29rcyhhY3RpdmF0ZWRRdWV1ZSk7CiAgICBjYWxsVXBkYXRlZEhvb2tzKHVwZGF0ZWRRdWV1ZSk7CgogICAgLy8gZGV2dG9vbCBob29rCiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgIGlmIChkZXZ0b29scyAmJiBjb25maWcuZGV2dG9vbHMpIHsKICAgICAgZGV2dG9vbHMuZW1pdCgnZmx1c2gnKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGNhbGxVcGRhdGVkSG9va3MgKHF1ZXVlKSB7CiAgICB2YXIgaSA9IHF1ZXVlLmxlbmd0aDsKICAgIHdoaWxlIChpLS0pIHsKICAgICAgdmFyIHdhdGNoZXIgPSBxdWV1ZVtpXTsKICAgICAgdmFyIHZtID0gd2F0Y2hlci52bTsKICAgICAgaWYgKHZtLl93YXRjaGVyID09PSB3YXRjaGVyICYmIHZtLl9pc01vdW50ZWQgJiYgIXZtLl9pc0Rlc3Ryb3llZCkgewogICAgICAgIGNhbGxIb29rKHZtLCAndXBkYXRlZCcpOwogICAgICB9CiAgICB9CiAgfQoKICAvKioKICAgKiBRdWV1ZSBhIGtlcHQtYWxpdmUgY29tcG9uZW50IHRoYXQgd2FzIGFjdGl2YXRlZCBkdXJpbmcgcGF0Y2guCiAgICogVGhlIHF1ZXVlIHdpbGwgYmUgcHJvY2Vzc2VkIGFmdGVyIHRoZSBlbnRpcmUgdHJlZSBoYXMgYmVlbiBwYXRjaGVkLgogICAqLwogIGZ1bmN0aW9uIHF1ZXVlQWN0aXZhdGVkQ29tcG9uZW50ICh2bSkgewogICAgLy8gc2V0dGluZyBfaW5hY3RpdmUgdG8gZmFsc2UgaGVyZSBzbyB0aGF0IGEgcmVuZGVyIGZ1bmN0aW9uIGNhbgogICAgLy8gcmVseSBvbiBjaGVja2luZyB3aGV0aGVyIGl0J3MgaW4gYW4gaW5hY3RpdmUgdHJlZSAoZS5nLiByb3V0ZXItdmlldykKICAgIHZtLl9pbmFjdGl2ZSA9IGZhbHNlOwogICAgYWN0aXZhdGVkQ2hpbGRyZW4ucHVzaCh2bSk7CiAgfQoKICBmdW5jdGlvbiBjYWxsQWN0aXZhdGVkSG9va3MgKHF1ZXVlKSB7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHF1ZXVlLmxlbmd0aDsgaSsrKSB7CiAgICAgIHF1ZXVlW2ldLl9pbmFjdGl2ZSA9IHRydWU7CiAgICAgIGFjdGl2YXRlQ2hpbGRDb21wb25lbnQocXVldWVbaV0sIHRydWUgLyogdHJ1ZSAqLyk7CiAgICB9CiAgfQoKICAvKioKICAgKiBQdXNoIGEgd2F0Y2hlciBpbnRvIHRoZSB3YXRjaGVyIHF1ZXVlLgogICAqIEpvYnMgd2l0aCBkdXBsaWNhdGUgSURzIHdpbGwgYmUgc2tpcHBlZCB1bmxlc3MgaXQncwogICAqIHB1c2hlZCB3aGVuIHRoZSBxdWV1ZSBpcyBiZWluZyBmbHVzaGVkLgogICAqLwogIGZ1bmN0aW9uIHF1ZXVlV2F0Y2hlciAod2F0Y2hlcikgewogICAgdmFyIGlkID0gd2F0Y2hlci5pZDsKICAgIGlmIChoYXNbaWRdID09IG51bGwpIHsKICAgICAgaGFzW2lkXSA9IHRydWU7CiAgICAgIGlmICghZmx1c2hpbmcpIHsKICAgICAgICBxdWV1ZS5wdXNoKHdhdGNoZXIpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIGlmIGFscmVhZHkgZmx1c2hpbmcsIHNwbGljZSB0aGUgd2F0Y2hlciBiYXNlZCBvbiBpdHMgaWQKICAgICAgICAvLyBpZiBhbHJlYWR5IHBhc3QgaXRzIGlkLCBpdCB3aWxsIGJlIHJ1biBuZXh0IGltbWVkaWF0ZWx5LgogICAgICAgIHZhciBpID0gcXVldWUubGVuZ3RoIC0gMTsKICAgICAgICB3aGlsZSAoaSA+IGluZGV4ICYmIHF1ZXVlW2ldLmlkID4gd2F0Y2hlci5pZCkgewogICAgICAgICAgaS0tOwogICAgICAgIH0KICAgICAgICBxdWV1ZS5zcGxpY2UoaSArIDEsIDAsIHdhdGNoZXIpOwogICAgICB9CiAgICAgIC8vIHF1ZXVlIHRoZSBmbHVzaAogICAgICBpZiAoIXdhaXRpbmcpIHsKICAgICAgICB3YWl0aW5nID0gdHJ1ZTsKCiAgICAgICAgaWYgKCFjb25maWcuYXN5bmMpIHsKICAgICAgICAgIGZsdXNoU2NoZWR1bGVyUXVldWUoKTsKICAgICAgICAgIHJldHVybgogICAgICAgIH0KICAgICAgICBuZXh0VGljayhmbHVzaFNjaGVkdWxlclF1ZXVlKTsKICAgICAgfQogICAgfQogIH0KCiAgLyogICovCgoKCiAgdmFyIHVpZCQyID0gMDsKCiAgLyoqCiAgICogQSB3YXRjaGVyIHBhcnNlcyBhbiBleHByZXNzaW9uLCBjb2xsZWN0cyBkZXBlbmRlbmNpZXMsCiAgICogYW5kIGZpcmVzIGNhbGxiYWNrIHdoZW4gdGhlIGV4cHJlc3Npb24gdmFsdWUgY2hhbmdlcy4KICAgKiBUaGlzIGlzIHVzZWQgZm9yIGJvdGggdGhlICR3YXRjaCgpIGFwaSBhbmQgZGlyZWN0aXZlcy4KICAgKi8KICB2YXIgV2F0Y2hlciA9IGZ1bmN0aW9uIFdhdGNoZXIgKAogICAgdm0sCiAgICBleHBPckZuLAogICAgY2IsCiAgICBvcHRpb25zLAogICAgaXNSZW5kZXJXYXRjaGVyCiAgKSB7CiAgICB0aGlzLnZtID0gdm07CiAgICBpZiAoaXNSZW5kZXJXYXRjaGVyKSB7CiAgICAgIHZtLl93YXRjaGVyID0gdGhpczsKICAgIH0KICAgIHZtLl93YXRjaGVycy5wdXNoKHRoaXMpOwogICAgLy8gb3B0aW9ucwogICAgaWYgKG9wdGlvbnMpIHsKICAgICAgdGhpcy5kZWVwID0gISFvcHRpb25zLmRlZXA7CiAgICAgIHRoaXMudXNlciA9ICEhb3B0aW9ucy51c2VyOwogICAgICB0aGlzLmxhenkgPSAhIW9wdGlvbnMubGF6eTsKICAgICAgdGhpcy5zeW5jID0gISFvcHRpb25zLnN5bmM7CiAgICAgIHRoaXMuYmVmb3JlID0gb3B0aW9ucy5iZWZvcmU7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmRlZXAgPSB0aGlzLnVzZXIgPSB0aGlzLmxhenkgPSB0aGlzLnN5bmMgPSBmYWxzZTsKICAgIH0KICAgIHRoaXMuY2IgPSBjYjsKICAgIHRoaXMuaWQgPSArK3VpZCQyOyAvLyB1aWQgZm9yIGJhdGNoaW5nCiAgICB0aGlzLmFjdGl2ZSA9IHRydWU7CiAgICB0aGlzLmRpcnR5ID0gdGhpcy5sYXp5OyAvLyBmb3IgbGF6eSB3YXRjaGVycwogICAgdGhpcy5kZXBzID0gW107CiAgICB0aGlzLm5ld0RlcHMgPSBbXTsKICAgIHRoaXMuZGVwSWRzID0gbmV3IF9TZXQoKTsKICAgIHRoaXMubmV3RGVwSWRzID0gbmV3IF9TZXQoKTsKICAgIHRoaXMuZXhwcmVzc2lvbiA9IGV4cE9yRm4udG9TdHJpbmcoKTsKICAgIC8vIHBhcnNlIGV4cHJlc3Npb24gZm9yIGdldHRlcgogICAgaWYgKHR5cGVvZiBleHBPckZuID09PSAnZnVuY3Rpb24nKSB7CiAgICAgIHRoaXMuZ2V0dGVyID0gZXhwT3JGbjsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZ2V0dGVyID0gcGFyc2VQYXRoKGV4cE9yRm4pOwogICAgICBpZiAoIXRoaXMuZ2V0dGVyKSB7CiAgICAgICAgdGhpcy5nZXR0ZXIgPSBub29wOwogICAgICAgIHdhcm4oCiAgICAgICAgICAiRmFpbGVkIHdhdGNoaW5nIHBhdGg6IFwiIiArIGV4cE9yRm4gKyAiXCIgIiArCiAgICAgICAgICAnV2F0Y2hlciBvbmx5IGFjY2VwdHMgc2ltcGxlIGRvdC1kZWxpbWl0ZWQgcGF0aHMuICcgKwogICAgICAgICAgJ0ZvciBmdWxsIGNvbnRyb2wsIHVzZSBhIGZ1bmN0aW9uIGluc3RlYWQuJywKICAgICAgICAgIHZtCiAgICAgICAgKTsKICAgICAgfQogICAgfQogICAgdGhpcy52YWx1ZSA9IHRoaXMubGF6eQogICAgICA/IHVuZGVmaW5lZAogICAgICA6IHRoaXMuZ2V0KCk7CiAgfTsKCiAgLyoqCiAgICogRXZhbHVhdGUgdGhlIGdldHRlciwgYW5kIHJlLWNvbGxlY3QgZGVwZW5kZW5jaWVzLgogICAqLwogIFdhdGNoZXIucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIGdldCAoKSB7CiAgICBwdXNoVGFyZ2V0KHRoaXMpOwogICAgdmFyIHZhbHVlOwogICAgdmFyIHZtID0gdGhpcy52bTsKICAgIHRyeSB7CiAgICAgIHZhbHVlID0gdGhpcy5nZXR0ZXIuY2FsbCh2bSwgdm0pOwogICAgfSBjYXRjaCAoZSkgewogICAgICBpZiAodGhpcy51c2VyKSB7CiAgICAgICAgaGFuZGxlRXJyb3IoZSwgdm0sICgiZ2V0dGVyIGZvciB3YXRjaGVyIFwiIiArICh0aGlzLmV4cHJlc3Npb24pICsgIlwiIikpOwogICAgICB9IGVsc2UgewogICAgICAgIHRocm93IGUKICAgICAgfQogICAgfSBmaW5hbGx5IHsKICAgICAgLy8gInRvdWNoIiBldmVyeSBwcm9wZXJ0eSBzbyB0aGV5IGFyZSBhbGwgdHJhY2tlZCBhcwogICAgICAvLyBkZXBlbmRlbmNpZXMgZm9yIGRlZXAgd2F0Y2hpbmcKICAgICAgaWYgKHRoaXMuZGVlcCkgewogICAgICAgIHRyYXZlcnNlKHZhbHVlKTsKICAgICAgfQogICAgICBwb3BUYXJnZXQoKTsKICAgICAgdGhpcy5jbGVhbnVwRGVwcygpOwogICAgfQogICAgcmV0dXJuIHZhbHVlCiAgfTsKCiAgLyoqCiAgICogQWRkIGEgZGVwZW5kZW5jeSB0byB0aGlzIGRpcmVjdGl2ZS4KICAgKi8KICBXYXRjaGVyLnByb3RvdHlwZS5hZGREZXAgPSBmdW5jdGlvbiBhZGREZXAgKGRlcCkgewogICAgdmFyIGlkID0gZGVwLmlkOwogICAgaWYgKCF0aGlzLm5ld0RlcElkcy5oYXMoaWQpKSB7CiAgICAgIHRoaXMubmV3RGVwSWRzLmFkZChpZCk7CiAgICAgIHRoaXMubmV3RGVwcy5wdXNoKGRlcCk7CiAgICAgIGlmICghdGhpcy5kZXBJZHMuaGFzKGlkKSkgewogICAgICAgIGRlcC5hZGRTdWIodGhpcyk7CiAgICAgIH0KICAgIH0KICB9OwoKICAvKioKICAgKiBDbGVhbiB1cCBmb3IgZGVwZW5kZW5jeSBjb2xsZWN0aW9uLgogICAqLwogIFdhdGNoZXIucHJvdG90eXBlLmNsZWFudXBEZXBzID0gZnVuY3Rpb24gY2xlYW51cERlcHMgKCkgewogICAgdmFyIGkgPSB0aGlzLmRlcHMubGVuZ3RoOwogICAgd2hpbGUgKGktLSkgewogICAgICB2YXIgZGVwID0gdGhpcy5kZXBzW2ldOwogICAgICBpZiAoIXRoaXMubmV3RGVwSWRzLmhhcyhkZXAuaWQpKSB7CiAgICAgICAgZGVwLnJlbW92ZVN1Yih0aGlzKTsKICAgICAgfQogICAgfQogICAgdmFyIHRtcCA9IHRoaXMuZGVwSWRzOwogICAgdGhpcy5kZXBJZHMgPSB0aGlzLm5ld0RlcElkczsKICAgIHRoaXMubmV3RGVwSWRzID0gdG1wOwogICAgdGhpcy5uZXdEZXBJZHMuY2xlYXIoKTsKICAgIHRtcCA9IHRoaXMuZGVwczsKICAgIHRoaXMuZGVwcyA9IHRoaXMubmV3RGVwczsKICAgIHRoaXMubmV3RGVwcyA9IHRtcDsKICAgIHRoaXMubmV3RGVwcy5sZW5ndGggPSAwOwogIH07CgogIC8qKgogICAqIFN1YnNjcmliZXIgaW50ZXJmYWNlLgogICAqIFdpbGwgYmUgY2FsbGVkIHdoZW4gYSBkZXBlbmRlbmN5IGNoYW5nZXMuCiAgICovCiAgV2F0Y2hlci5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gdXBkYXRlICgpIHsKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovCiAgICBpZiAodGhpcy5sYXp5KSB7CiAgICAgIHRoaXMuZGlydHkgPSB0cnVlOwogICAgfSBlbHNlIGlmICh0aGlzLnN5bmMpIHsKICAgICAgdGhpcy5ydW4oKTsKICAgIH0gZWxzZSB7CiAgICAgIHF1ZXVlV2F0Y2hlcih0aGlzKTsKICAgIH0KICB9OwoKICAvKioKICAgKiBTY2hlZHVsZXIgam9iIGludGVyZmFjZS4KICAgKiBXaWxsIGJlIGNhbGxlZCBieSB0aGUgc2NoZWR1bGVyLgogICAqLwogIFdhdGNoZXIucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uIHJ1biAoKSB7CiAgICBpZiAodGhpcy5hY3RpdmUpIHsKICAgICAgdmFyIHZhbHVlID0gdGhpcy5nZXQoKTsKICAgICAgaWYgKAogICAgICAgIHZhbHVlICE9PSB0aGlzLnZhbHVlIHx8CiAgICAgICAgLy8gRGVlcCB3YXRjaGVycyBhbmQgd2F0Y2hlcnMgb24gT2JqZWN0L0FycmF5cyBzaG91bGQgZmlyZSBldmVuCiAgICAgICAgLy8gd2hlbiB0aGUgdmFsdWUgaXMgdGhlIHNhbWUsIGJlY2F1c2UgdGhlIHZhbHVlIG1heQogICAgICAgIC8vIGhhdmUgbXV0YXRlZC4KICAgICAgICBpc09iamVjdCh2YWx1ZSkgfHwKICAgICAgICB0aGlzLmRlZXAKICAgICAgKSB7CiAgICAgICAgLy8gc2V0IG5ldyB2YWx1ZQogICAgICAgIHZhciBvbGRWYWx1ZSA9IHRoaXMudmFsdWU7CiAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlOwogICAgICAgIGlmICh0aGlzLnVzZXIpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHRoaXMuY2IuY2FsbCh0aGlzLnZtLCB2YWx1ZSwgb2xkVmFsdWUpOwogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBoYW5kbGVFcnJvcihlLCB0aGlzLnZtLCAoImNhbGxiYWNrIGZvciB3YXRjaGVyIFwiIiArICh0aGlzLmV4cHJlc3Npb24pICsgIlwiIikpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmNiLmNhbGwodGhpcy52bSwgdmFsdWUsIG9sZFZhbHVlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9OwoKICAvKioKICAgKiBFdmFsdWF0ZSB0aGUgdmFsdWUgb2YgdGhlIHdhdGNoZXIuCiAgICogVGhpcyBvbmx5IGdldHMgY2FsbGVkIGZvciBsYXp5IHdhdGNoZXJzLgogICAqLwogIFdhdGNoZXIucHJvdG90eXBlLmV2YWx1YXRlID0gZnVuY3Rpb24gZXZhbHVhdGUgKCkgewogICAgdGhpcy52YWx1ZSA9IHRoaXMuZ2V0KCk7CiAgICB0aGlzLmRpcnR5ID0gZmFsc2U7CiAgfTsKCiAgLyoqCiAgICogRGVwZW5kIG9uIGFsbCBkZXBzIGNvbGxlY3RlZCBieSB0aGlzIHdhdGNoZXIuCiAgICovCiAgV2F0Y2hlci5wcm90b3R5cGUuZGVwZW5kID0gZnVuY3Rpb24gZGVwZW5kICgpIHsKICAgIHZhciBpID0gdGhpcy5kZXBzLmxlbmd0aDsKICAgIHdoaWxlIChpLS0pIHsKICAgICAgdGhpcy5kZXBzW2ldLmRlcGVuZCgpOwogICAgfQogIH07CgogIC8qKgogICAqIFJlbW92ZSBzZWxmIGZyb20gYWxsIGRlcGVuZGVuY2llcycgc3Vic2NyaWJlciBsaXN0LgogICAqLwogIFdhdGNoZXIucHJvdG90eXBlLnRlYXJkb3duID0gZnVuY3Rpb24gdGVhcmRvd24gKCkgewogICAgaWYgKHRoaXMuYWN0aXZlKSB7CiAgICAgIC8vIHJlbW92ZSBzZWxmIGZyb20gdm0ncyB3YXRjaGVyIGxpc3QKICAgICAgLy8gdGhpcyBpcyBhIHNvbWV3aGF0IGV4cGVuc2l2ZSBvcGVyYXRpb24gc28gd2Ugc2tpcCBpdAogICAgICAvLyBpZiB0aGUgdm0gaXMgYmVpbmcgZGVzdHJveWVkLgogICAgICBpZiAoIXRoaXMudm0uX2lzQmVpbmdEZXN0cm95ZWQpIHsKICAgICAgICByZW1vdmUodGhpcy52bS5fd2F0Y2hlcnMsIHRoaXMpOwogICAgICB9CiAgICAgIHZhciBpID0gdGhpcy5kZXBzLmxlbmd0aDsKICAgICAgd2hpbGUgKGktLSkgewogICAgICAgIHRoaXMuZGVwc1tpXS5yZW1vdmVTdWIodGhpcyk7CiAgICAgIH0KICAgICAgdGhpcy5hY3RpdmUgPSBmYWxzZTsKICAgIH0KICB9OwoKICAvKiAgKi8KCiAgdmFyIHNoYXJlZFByb3BlcnR5RGVmaW5pdGlvbiA9IHsKICAgIGVudW1lcmFibGU6IHRydWUsCiAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICBnZXQ6IG5vb3AsCiAgICBzZXQ6IG5vb3AKICB9OwoKICBmdW5jdGlvbiBwcm94eSAodGFyZ2V0LCBzb3VyY2VLZXksIGtleSkgewogICAgc2hhcmVkUHJvcGVydHlEZWZpbml0aW9uLmdldCA9IGZ1bmN0aW9uIHByb3h5R2V0dGVyICgpIHsKICAgICAgcmV0dXJuIHRoaXNbc291cmNlS2V5XVtrZXldCiAgICB9OwogICAgc2hhcmVkUHJvcGVydHlEZWZpbml0aW9uLnNldCA9IGZ1bmN0aW9uIHByb3h5U2V0dGVyICh2YWwpIHsKICAgICAgdGhpc1tzb3VyY2VLZXldW2tleV0gPSB2YWw7CiAgICB9OwogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzaGFyZWRQcm9wZXJ0eURlZmluaXRpb24pOwogIH0KCiAgZnVuY3Rpb24gaW5pdFN0YXRlICh2bSkgewogICAgdm0uX3dhdGNoZXJzID0gW107CiAgICB2YXIgb3B0cyA9IHZtLiRvcHRpb25zOwogICAgaWYgKG9wdHMucHJvcHMpIHsgaW5pdFByb3BzKHZtLCBvcHRzLnByb3BzKTsgfQogICAgaWYgKG9wdHMubWV0aG9kcykgeyBpbml0TWV0aG9kcyh2bSwgb3B0cy5tZXRob2RzKTsgfQogICAgaWYgKG9wdHMuZGF0YSkgewogICAgICBpbml0RGF0YSh2bSk7CiAgICB9IGVsc2UgewogICAgICBvYnNlcnZlKHZtLl9kYXRhID0ge30sIHRydWUgLyogYXNSb290RGF0YSAqLyk7CiAgICB9CiAgICBpZiAob3B0cy5jb21wdXRlZCkgeyBpbml0Q29tcHV0ZWQodm0sIG9wdHMuY29tcHV0ZWQpOyB9CiAgICBpZiAob3B0cy53YXRjaCAmJiBvcHRzLndhdGNoICE9PSBuYXRpdmVXYXRjaCkgewogICAgICBpbml0V2F0Y2godm0sIG9wdHMud2F0Y2gpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gaW5pdFByb3BzICh2bSwgcHJvcHNPcHRpb25zKSB7CiAgICB2YXIgcHJvcHNEYXRhID0gdm0uJG9wdGlvbnMucHJvcHNEYXRhIHx8IHt9OwogICAgdmFyIHByb3BzID0gdm0uX3Byb3BzID0ge307CiAgICAvLyBjYWNoZSBwcm9wIGtleXMgc28gdGhhdCBmdXR1cmUgcHJvcHMgdXBkYXRlcyBjYW4gaXRlcmF0ZSB1c2luZyBBcnJheQogICAgLy8gaW5zdGVhZCBvZiBkeW5hbWljIG9iamVjdCBrZXkgZW51bWVyYXRpb24uCiAgICB2YXIga2V5cyA9IHZtLiRvcHRpb25zLl9wcm9wS2V5cyA9IFtdOwogICAgdmFyIGlzUm9vdCA9ICF2bS4kcGFyZW50OwogICAgLy8gcm9vdCBpbnN0YW5jZSBwcm9wcyBzaG91bGQgYmUgY29udmVydGVkCiAgICBpZiAoIWlzUm9vdCkgewogICAgICB0b2dnbGVPYnNlcnZpbmcoZmFsc2UpOwogICAgfQogICAgdmFyIGxvb3AgPSBmdW5jdGlvbiAoIGtleSApIHsKICAgICAga2V5cy5wdXNoKGtleSk7CiAgICAgIHZhciB2YWx1ZSA9IHZhbGlkYXRlUHJvcChrZXksIHByb3BzT3B0aW9ucywgcHJvcHNEYXRhLCB2bSk7CiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovCiAgICAgIHsKICAgICAgICB2YXIgaHlwaGVuYXRlZEtleSA9IGh5cGhlbmF0ZShrZXkpOwogICAgICAgIGlmIChpc1Jlc2VydmVkQXR0cmlidXRlKGh5cGhlbmF0ZWRLZXkpIHx8CiAgICAgICAgICAgIGNvbmZpZy5pc1Jlc2VydmVkQXR0cihoeXBoZW5hdGVkS2V5KSkgewogICAgICAgICAgd2FybigKICAgICAgICAgICAgKCJcIiIgKyBoeXBoZW5hdGVkS2V5ICsgIlwiIGlzIGEgcmVzZXJ2ZWQgYXR0cmlidXRlIGFuZCBjYW5ub3QgYmUgdXNlZCBhcyBjb21wb25lbnQgcHJvcC4iKSwKICAgICAgICAgICAgdm0KICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGRlZmluZVJlYWN0aXZlJCQxKHByb3BzLCBrZXksIHZhbHVlLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAoIWlzUm9vdCAmJiAhaXNVcGRhdGluZ0NoaWxkQ29tcG9uZW50KSB7CiAgICAgICAgICAgIHdhcm4oCiAgICAgICAgICAgICAgIkF2b2lkIG11dGF0aW5nIGEgcHJvcCBkaXJlY3RseSBzaW5jZSB0aGUgdmFsdWUgd2lsbCBiZSAiICsKICAgICAgICAgICAgICAib3ZlcndyaXR0ZW4gd2hlbmV2ZXIgdGhlIHBhcmVudCBjb21wb25lbnQgcmUtcmVuZGVycy4gIiArCiAgICAgICAgICAgICAgIkluc3RlYWQsIHVzZSBhIGRhdGEgb3IgY29tcHV0ZWQgcHJvcGVydHkgYmFzZWQgb24gdGhlIHByb3AncyAiICsKICAgICAgICAgICAgICAidmFsdWUuIFByb3AgYmVpbmcgbXV0YXRlZDogXCIiICsga2V5ICsgIlwiIiwKICAgICAgICAgICAgICB2bQogICAgICAgICAgICApOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICAgIC8vIHN0YXRpYyBwcm9wcyBhcmUgYWxyZWFkeSBwcm94aWVkIG9uIHRoZSBjb21wb25lbnQncyBwcm90b3R5cGUKICAgICAgLy8gZHVyaW5nIFZ1ZS5leHRlbmQoKS4gV2Ugb25seSBuZWVkIHRvIHByb3h5IHByb3BzIGRlZmluZWQgYXQKICAgICAgLy8gaW5zdGFudGlhdGlvbiBoZXJlLgogICAgICBpZiAoIShrZXkgaW4gdm0pKSB7CiAgICAgICAgcHJveHkodm0sICJfcHJvcHMiLCBrZXkpOwogICAgICB9CiAgICB9OwoKICAgIGZvciAodmFyIGtleSBpbiBwcm9wc09wdGlvbnMpIGxvb3AoIGtleSApOwogICAgdG9nZ2xlT2JzZXJ2aW5nKHRydWUpOwogIH0KCiAgZnVuY3Rpb24gaW5pdERhdGEgKHZtKSB7CiAgICB2YXIgZGF0YSA9IHZtLiRvcHRpb25zLmRhdGE7CiAgICBkYXRhID0gdm0uX2RhdGEgPSB0eXBlb2YgZGF0YSA9PT0gJ2Z1bmN0aW9uJwogICAgICA/IGdldERhdGEoZGF0YSwgdm0pCiAgICAgIDogZGF0YSB8fCB7fTsKICAgIGlmICghaXNQbGFpbk9iamVjdChkYXRhKSkgewogICAgICBkYXRhID0ge307CiAgICAgIHdhcm4oCiAgICAgICAgJ2RhdGEgZnVuY3Rpb25zIHNob3VsZCByZXR1cm4gYW4gb2JqZWN0OlxuJyArCiAgICAgICAgJ2h0dHBzOi8vdnVlanMub3JnL3YyL2d1aWRlL2NvbXBvbmVudHMuaHRtbCNkYXRhLU11c3QtQmUtYS1GdW5jdGlvbicsCiAgICAgICAgdm0KICAgICAgKTsKICAgIH0KICAgIC8vIHByb3h5IGRhdGEgb24gaW5zdGFuY2UKICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMoZGF0YSk7CiAgICB2YXIgcHJvcHMgPSB2bS4kb3B0aW9ucy5wcm9wczsKICAgIHZhciBtZXRob2RzID0gdm0uJG9wdGlvbnMubWV0aG9kczsKICAgIHZhciBpID0ga2V5cy5sZW5ndGg7CiAgICB3aGlsZSAoaS0tKSB7CiAgICAgIHZhciBrZXkgPSBrZXlzW2ldOwogICAgICB7CiAgICAgICAgaWYgKG1ldGhvZHMgJiYgaGFzT3duKG1ldGhvZHMsIGtleSkpIHsKICAgICAgICAgIHdhcm4oCiAgICAgICAgICAgICgiTWV0aG9kIFwiIiArIGtleSArICJcIiBoYXMgYWxyZWFkeSBiZWVuIGRlZmluZWQgYXMgYSBkYXRhIHByb3BlcnR5LiIpLAogICAgICAgICAgICB2bQogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHByb3BzICYmIGhhc093bihwcm9wcywga2V5KSkgewogICAgICAgIHdhcm4oCiAgICAgICAgICAiVGhlIGRhdGEgcHJvcGVydHkgXCIiICsga2V5ICsgIlwiIGlzIGFscmVhZHkgZGVjbGFyZWQgYXMgYSBwcm9wLiAiICsKICAgICAgICAgICJVc2UgcHJvcCBkZWZhdWx0IHZhbHVlIGluc3RlYWQuIiwKICAgICAgICAgIHZtCiAgICAgICAgKTsKICAgICAgfSBlbHNlIGlmICghaXNSZXNlcnZlZChrZXkpKSB7CiAgICAgICAgcHJveHkodm0sICJfZGF0YSIsIGtleSk7CiAgICAgIH0KICAgIH0KICAgIC8vIG9ic2VydmUgZGF0YQogICAgb2JzZXJ2ZShkYXRhLCB0cnVlIC8qIGFzUm9vdERhdGEgKi8pOwogIH0KCiAgZnVuY3Rpb24gZ2V0RGF0YSAoZGF0YSwgdm0pIHsKICAgIC8vICM3NTczIGRpc2FibGUgZGVwIGNvbGxlY3Rpb24gd2hlbiBpbnZva2luZyBkYXRhIGdldHRlcnMKICAgIHB1c2hUYXJnZXQoKTsKICAgIHRyeSB7CiAgICAgIHJldHVybiBkYXRhLmNhbGwodm0sIHZtKQogICAgfSBjYXRjaCAoZSkgewogICAgICBoYW5kbGVFcnJvcihlLCB2bSwgImRhdGEoKSIpOwogICAgICByZXR1cm4ge30KICAgIH0gZmluYWxseSB7CiAgICAgIHBvcFRhcmdldCgpOwogICAgfQogIH0KCiAgdmFyIGNvbXB1dGVkV2F0Y2hlck9wdGlvbnMgPSB7IGxhenk6IHRydWUgfTsKCiAgZnVuY3Rpb24gaW5pdENvbXB1dGVkICh2bSwgY29tcHV0ZWQpIHsKICAgIC8vICRmbG93LWRpc2FibGUtbGluZQogICAgdmFyIHdhdGNoZXJzID0gdm0uX2NvbXB1dGVkV2F0Y2hlcnMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgLy8gY29tcHV0ZWQgcHJvcGVydGllcyBhcmUganVzdCBnZXR0ZXJzIGR1cmluZyBTU1IKICAgIHZhciBpc1NTUiA9IGlzU2VydmVyUmVuZGVyaW5nKCk7CgogICAgZm9yICh2YXIga2V5IGluIGNvbXB1dGVkKSB7CiAgICAgIHZhciB1c2VyRGVmID0gY29tcHV0ZWRba2V5XTsKICAgICAgdmFyIGdldHRlciA9IHR5cGVvZiB1c2VyRGVmID09PSAnZnVuY3Rpb24nID8gdXNlckRlZiA6IHVzZXJEZWYuZ2V0OwogICAgICBpZiAoZ2V0dGVyID09IG51bGwpIHsKICAgICAgICB3YXJuKAogICAgICAgICAgKCJHZXR0ZXIgaXMgbWlzc2luZyBmb3IgY29tcHV0ZWQgcHJvcGVydHkgXCIiICsga2V5ICsgIlwiLiIpLAogICAgICAgICAgdm0KICAgICAgICApOwogICAgICB9CgogICAgICBpZiAoIWlzU1NSKSB7CiAgICAgICAgLy8gY3JlYXRlIGludGVybmFsIHdhdGNoZXIgZm9yIHRoZSBjb21wdXRlZCBwcm9wZXJ0eS4KICAgICAgICB3YXRjaGVyc1trZXldID0gbmV3IFdhdGNoZXIoCiAgICAgICAgICB2bSwKICAgICAgICAgIGdldHRlciB8fCBub29wLAogICAgICAgICAgbm9vcCwKICAgICAgICAgIGNvbXB1dGVkV2F0Y2hlck9wdGlvbnMKICAgICAgICApOwogICAgICB9CgogICAgICAvLyBjb21wb25lbnQtZGVmaW5lZCBjb21wdXRlZCBwcm9wZXJ0aWVzIGFyZSBhbHJlYWR5IGRlZmluZWQgb24gdGhlCiAgICAgIC8vIGNvbXBvbmVudCBwcm90b3R5cGUuIFdlIG9ubHkgbmVlZCB0byBkZWZpbmUgY29tcHV0ZWQgcHJvcGVydGllcyBkZWZpbmVkCiAgICAgIC8vIGF0IGluc3RhbnRpYXRpb24gaGVyZS4KICAgICAgaWYgKCEoa2V5IGluIHZtKSkgewogICAgICAgIGRlZmluZUNvbXB1dGVkKHZtLCBrZXksIHVzZXJEZWYpOwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChrZXkgaW4gdm0uJGRhdGEpIHsKICAgICAgICAgIHdhcm4oKCJUaGUgY29tcHV0ZWQgcHJvcGVydHkgXCIiICsga2V5ICsgIlwiIGlzIGFscmVhZHkgZGVmaW5lZCBpbiBkYXRhLiIpLCB2bSk7CiAgICAgICAgfSBlbHNlIGlmICh2bS4kb3B0aW9ucy5wcm9wcyAmJiBrZXkgaW4gdm0uJG9wdGlvbnMucHJvcHMpIHsKICAgICAgICAgIHdhcm4oKCJUaGUgY29tcHV0ZWQgcHJvcGVydHkgXCIiICsga2V5ICsgIlwiIGlzIGFscmVhZHkgZGVmaW5lZCBhcyBhIHByb3AuIiksIHZtKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGRlZmluZUNvbXB1dGVkICgKICAgIHRhcmdldCwKICAgIGtleSwKICAgIHVzZXJEZWYKICApIHsKICAgIHZhciBzaG91bGRDYWNoZSA9ICFpc1NlcnZlclJlbmRlcmluZygpOwogICAgaWYgKHR5cGVvZiB1c2VyRGVmID09PSAnZnVuY3Rpb24nKSB7CiAgICAgIHNoYXJlZFByb3BlcnR5RGVmaW5pdGlvbi5nZXQgPSBzaG91bGRDYWNoZQogICAgICAgID8gY3JlYXRlQ29tcHV0ZWRHZXR0ZXIoa2V5KQogICAgICAgIDogY3JlYXRlR2V0dGVySW52b2tlcih1c2VyRGVmKTsKICAgICAgc2hhcmVkUHJvcGVydHlEZWZpbml0aW9uLnNldCA9IG5vb3A7CiAgICB9IGVsc2UgewogICAgICBzaGFyZWRQcm9wZXJ0eURlZmluaXRpb24uZ2V0ID0gdXNlckRlZi5nZXQKICAgICAgICA/IHNob3VsZENhY2hlICYmIHVzZXJEZWYuY2FjaGUgIT09IGZhbHNlCiAgICAgICAgICA/IGNyZWF0ZUNvbXB1dGVkR2V0dGVyKGtleSkKICAgICAgICAgIDogY3JlYXRlR2V0dGVySW52b2tlcih1c2VyRGVmLmdldCkKICAgICAgICA6IG5vb3A7CiAgICAgIHNoYXJlZFByb3BlcnR5RGVmaW5pdGlvbi5zZXQgPSB1c2VyRGVmLnNldCB8fCBub29wOwogICAgfQogICAgaWYgKHNoYXJlZFByb3BlcnR5RGVmaW5pdGlvbi5zZXQgPT09IG5vb3ApIHsKICAgICAgc2hhcmVkUHJvcGVydHlEZWZpbml0aW9uLnNldCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB3YXJuKAogICAgICAgICAgKCJDb21wdXRlZCBwcm9wZXJ0eSBcIiIgKyBrZXkgKyAiXCIgd2FzIGFzc2lnbmVkIHRvIGJ1dCBpdCBoYXMgbm8gc2V0dGVyLiIpLAogICAgICAgICAgdGhpcwogICAgICAgICk7CiAgICAgIH07CiAgICB9CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHNoYXJlZFByb3BlcnR5RGVmaW5pdGlvbik7CiAgfQoKICBmdW5jdGlvbiBjcmVhdGVDb21wdXRlZEdldHRlciAoa2V5KSB7CiAgICByZXR1cm4gZnVuY3Rpb24gY29tcHV0ZWRHZXR0ZXIgKCkgewogICAgICB2YXIgd2F0Y2hlciA9IHRoaXMuX2NvbXB1dGVkV2F0Y2hlcnMgJiYgdGhpcy5fY29tcHV0ZWRXYXRjaGVyc1trZXldOwogICAgICBpZiAod2F0Y2hlcikgewogICAgICAgIGlmICh3YXRjaGVyLmRpcnR5KSB7CiAgICAgICAgICB3YXRjaGVyLmV2YWx1YXRlKCk7CiAgICAgICAgfQogICAgICAgIGlmIChEZXAudGFyZ2V0KSB7CiAgICAgICAgICB3YXRjaGVyLmRlcGVuZCgpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gd2F0Y2hlci52YWx1ZQogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBjcmVhdGVHZXR0ZXJJbnZva2VyKGZuKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gY29tcHV0ZWRHZXR0ZXIgKCkgewogICAgICByZXR1cm4gZm4uY2FsbCh0aGlzLCB0aGlzKQogICAgfQogIH0KCiAgZnVuY3Rpb24gaW5pdE1ldGhvZHMgKHZtLCBtZXRob2RzKSB7CiAgICB2YXIgcHJvcHMgPSB2bS4kb3B0aW9ucy5wcm9wczsKICAgIGZvciAodmFyIGtleSBpbiBtZXRob2RzKSB7CiAgICAgIHsKICAgICAgICBpZiAodHlwZW9mIG1ldGhvZHNba2V5XSAhPT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgd2FybigKICAgICAgICAgICAgIk1ldGhvZCBcIiIgKyBrZXkgKyAiXCIgaGFzIHR5cGUgXCIiICsgKHR5cGVvZiBtZXRob2RzW2tleV0pICsgIlwiIGluIHRoZSBjb21wb25lbnQgZGVmaW5pdGlvbi4gIiArCiAgICAgICAgICAgICJEaWQgeW91IHJlZmVyZW5jZSB0aGUgZnVuY3Rpb24gY29ycmVjdGx5PyIsCiAgICAgICAgICAgIHZtCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBpZiAocHJvcHMgJiYgaGFzT3duKHByb3BzLCBrZXkpKSB7CiAgICAgICAgICB3YXJuKAogICAgICAgICAgICAoIk1ldGhvZCBcIiIgKyBrZXkgKyAiXCIgaGFzIGFscmVhZHkgYmVlbiBkZWZpbmVkIGFzIGEgcHJvcC4iKSwKICAgICAgICAgICAgdm0KICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGlmICgoa2V5IGluIHZtKSAmJiBpc1Jlc2VydmVkKGtleSkpIHsKICAgICAgICAgIHdhcm4oCiAgICAgICAgICAgICJNZXRob2QgXCIiICsga2V5ICsgIlwiIGNvbmZsaWN0cyB3aXRoIGFuIGV4aXN0aW5nIFZ1ZSBpbnN0YW5jZSBtZXRob2QuICIgKwogICAgICAgICAgICAiQXZvaWQgZGVmaW5pbmcgY29tcG9uZW50IG1ldGhvZHMgdGhhdCBzdGFydCB3aXRoIF8gb3IgJC4iCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgfQogICAgICB2bVtrZXldID0gdHlwZW9mIG1ldGhvZHNba2V5XSAhPT0gJ2Z1bmN0aW9uJyA/IG5vb3AgOiBiaW5kKG1ldGhvZHNba2V5XSwgdm0pOwogICAgfQogIH0KCiAgZnVuY3Rpb24gaW5pdFdhdGNoICh2bSwgd2F0Y2gpIHsKICAgIGZvciAodmFyIGtleSBpbiB3YXRjaCkgewogICAgICB2YXIgaGFuZGxlciA9IHdhdGNoW2tleV07CiAgICAgIGlmIChBcnJheS5pc0FycmF5KGhhbmRsZXIpKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBoYW5kbGVyLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBjcmVhdGVXYXRjaGVyKHZtLCBrZXksIGhhbmRsZXJbaV0pOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBjcmVhdGVXYXRjaGVyKHZtLCBrZXksIGhhbmRsZXIpOwogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBjcmVhdGVXYXRjaGVyICgKICAgIHZtLAogICAgZXhwT3JGbiwKICAgIGhhbmRsZXIsCiAgICBvcHRpb25zCiAgKSB7CiAgICBpZiAoaXNQbGFpbk9iamVjdChoYW5kbGVyKSkgewogICAgICBvcHRpb25zID0gaGFuZGxlcjsKICAgICAgaGFuZGxlciA9IGhhbmRsZXIuaGFuZGxlcjsKICAgIH0KICAgIGlmICh0eXBlb2YgaGFuZGxlciA9PT0gJ3N0cmluZycpIHsKICAgICAgaGFuZGxlciA9IHZtW2hhbmRsZXJdOwogICAgfQogICAgcmV0dXJuIHZtLiR3YXRjaChleHBPckZuLCBoYW5kbGVyLCBvcHRpb25zKQogIH0KCiAgZnVuY3Rpb24gc3RhdGVNaXhpbiAoVnVlKSB7CiAgICAvLyBmbG93IHNvbWVob3cgaGFzIHByb2JsZW1zIHdpdGggZGlyZWN0bHkgZGVjbGFyZWQgZGVmaW5pdGlvbiBvYmplY3QKICAgIC8vIHdoZW4gdXNpbmcgT2JqZWN0LmRlZmluZVByb3BlcnR5LCBzbyB3ZSBoYXZlIHRvIHByb2NlZHVyYWxseSBidWlsZCB1cAogICAgLy8gdGhlIG9iamVjdCBoZXJlLgogICAgdmFyIGRhdGFEZWYgPSB7fTsKICAgIGRhdGFEZWYuZ2V0ID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fZGF0YSB9OwogICAgdmFyIHByb3BzRGVmID0ge307CiAgICBwcm9wc0RlZi5nZXQgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9wcm9wcyB9OwogICAgewogICAgICBkYXRhRGVmLnNldCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB3YXJuKAogICAgICAgICAgJ0F2b2lkIHJlcGxhY2luZyBpbnN0YW5jZSByb290ICRkYXRhLiAnICsKICAgICAgICAgICdVc2UgbmVzdGVkIGRhdGEgcHJvcGVydGllcyBpbnN0ZWFkLicsCiAgICAgICAgICB0aGlzCiAgICAgICAgKTsKICAgICAgfTsKICAgICAgcHJvcHNEZWYuc2V0ID0gZnVuY3Rpb24gKCkgewogICAgICAgIHdhcm4oIiRwcm9wcyBpcyByZWFkb25seS4iLCB0aGlzKTsKICAgICAgfTsKICAgIH0KICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShWdWUucHJvdG90eXBlLCAnJGRhdGEnLCBkYXRhRGVmKTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShWdWUucHJvdG90eXBlLCAnJHByb3BzJywgcHJvcHNEZWYpOwoKICAgIFZ1ZS5wcm90b3R5cGUuJHNldCA9IHNldDsKICAgIFZ1ZS5wcm90b3R5cGUuJGRlbGV0ZSA9IGRlbDsKCiAgICBWdWUucHJvdG90eXBlLiR3YXRjaCA9IGZ1bmN0aW9uICgKICAgICAgZXhwT3JGbiwKICAgICAgY2IsCiAgICAgIG9wdGlvbnMKICAgICkgewogICAgICB2YXIgdm0gPSB0aGlzOwogICAgICBpZiAoaXNQbGFpbk9iamVjdChjYikpIHsKICAgICAgICByZXR1cm4gY3JlYXRlV2F0Y2hlcih2bSwgZXhwT3JGbiwgY2IsIG9wdGlvbnMpCiAgICAgIH0KICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CiAgICAgIG9wdGlvbnMudXNlciA9IHRydWU7CiAgICAgIHZhciB3YXRjaGVyID0gbmV3IFdhdGNoZXIodm0sIGV4cE9yRm4sIGNiLCBvcHRpb25zKTsKICAgICAgaWYgKG9wdGlvbnMuaW1tZWRpYXRlKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGNiLmNhbGwodm0sIHdhdGNoZXIudmFsdWUpOwogICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICBoYW5kbGVFcnJvcihlcnJvciwgdm0sICgiY2FsbGJhY2sgZm9yIGltbWVkaWF0ZSB3YXRjaGVyIFwiIiArICh3YXRjaGVyLmV4cHJlc3Npb24pICsgIlwiIikpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gZnVuY3Rpb24gdW53YXRjaEZuICgpIHsKICAgICAgICB3YXRjaGVyLnRlYXJkb3duKCk7CiAgICAgIH0KICAgIH07CiAgfQoKICAvKiAgKi8KCiAgdmFyIHVpZCQzID0gMDsKCiAgZnVuY3Rpb24gaW5pdE1peGluIChWdWUpIHsKICAgIFZ1ZS5wcm90b3R5cGUuX2luaXQgPSBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICB2YXIgdm0gPSB0aGlzOwogICAgICAvLyBhIHVpZAogICAgICB2bS5fdWlkID0gdWlkJDMrKzsKCiAgICAgIHZhciBzdGFydFRhZywgZW5kVGFnOwogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgaWYgKGNvbmZpZy5wZXJmb3JtYW5jZSAmJiBtYXJrKSB7CiAgICAgICAgc3RhcnRUYWcgPSAidnVlLXBlcmYtc3RhcnQ6IiArICh2bS5fdWlkKTsKICAgICAgICBlbmRUYWcgPSAidnVlLXBlcmYtZW5kOiIgKyAodm0uX3VpZCk7CiAgICAgICAgbWFyayhzdGFydFRhZyk7CiAgICAgIH0KCiAgICAgIC8vIGEgZmxhZyB0byBhdm9pZCB0aGlzIGJlaW5nIG9ic2VydmVkCiAgICAgIHZtLl9pc1Z1ZSA9IHRydWU7CiAgICAgIC8vIG1lcmdlIG9wdGlvbnMKICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5faXNDb21wb25lbnQpIHsKICAgICAgICAvLyBvcHRpbWl6ZSBpbnRlcm5hbCBjb21wb25lbnQgaW5zdGFudGlhdGlvbgogICAgICAgIC8vIHNpbmNlIGR5bmFtaWMgb3B0aW9ucyBtZXJnaW5nIGlzIHByZXR0eSBzbG93LCBhbmQgbm9uZSBvZiB0aGUKICAgICAgICAvLyBpbnRlcm5hbCBjb21wb25lbnQgb3B0aW9ucyBuZWVkcyBzcGVjaWFsIHRyZWF0bWVudC4KICAgICAgICBpbml0SW50ZXJuYWxDb21wb25lbnQodm0sIG9wdGlvbnMpOwogICAgICB9IGVsc2UgewogICAgICAgIHZtLiRvcHRpb25zID0gbWVyZ2VPcHRpb25zKAogICAgICAgICAgcmVzb2x2ZUNvbnN0cnVjdG9yT3B0aW9ucyh2bS5jb25zdHJ1Y3RvciksCiAgICAgICAgICBvcHRpb25zIHx8IHt9LAogICAgICAgICAgdm0KICAgICAgICApOwogICAgICB9CiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovCiAgICAgIHsKICAgICAgICBpbml0UHJveHkodm0pOwogICAgICB9CiAgICAgIC8vIGV4cG9zZSByZWFsIHNlbGYKICAgICAgdm0uX3NlbGYgPSB2bTsKICAgICAgaW5pdExpZmVjeWNsZSh2bSk7CiAgICAgIGluaXRFdmVudHModm0pOwogICAgICBpbml0UmVuZGVyKHZtKTsKICAgICAgY2FsbEhvb2sodm0sICdiZWZvcmVDcmVhdGUnKTsKICAgICAgaW5pdEluamVjdGlvbnModm0pOyAvLyByZXNvbHZlIGluamVjdGlvbnMgYmVmb3JlIGRhdGEvcHJvcHMKICAgICAgaW5pdFN0YXRlKHZtKTsKICAgICAgaW5pdFByb3ZpZGUodm0pOyAvLyByZXNvbHZlIHByb3ZpZGUgYWZ0ZXIgZGF0YS9wcm9wcwogICAgICBjYWxsSG9vayh2bSwgJ2NyZWF0ZWQnKTsKCiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgICBpZiAoY29uZmlnLnBlcmZvcm1hbmNlICYmIG1hcmspIHsKICAgICAgICB2bS5fbmFtZSA9IGZvcm1hdENvbXBvbmVudE5hbWUodm0sIGZhbHNlKTsKICAgICAgICBtYXJrKGVuZFRhZyk7CiAgICAgICAgbWVhc3VyZSgoInZ1ZSAiICsgKHZtLl9uYW1lKSArICIgaW5pdCIpLCBzdGFydFRhZywgZW5kVGFnKTsKICAgICAgfQoKICAgICAgaWYgKHZtLiRvcHRpb25zLmVsKSB7CiAgICAgICAgdm0uJG1vdW50KHZtLiRvcHRpb25zLmVsKTsKICAgICAgfQogICAgfTsKICB9CgogIGZ1bmN0aW9uIGluaXRJbnRlcm5hbENvbXBvbmVudCAodm0sIG9wdGlvbnMpIHsKICAgIHZhciBvcHRzID0gdm0uJG9wdGlvbnMgPSBPYmplY3QuY3JlYXRlKHZtLmNvbnN0cnVjdG9yLm9wdGlvbnMpOwogICAgLy8gZG9pbmcgdGhpcyBiZWNhdXNlIGl0J3MgZmFzdGVyIHRoYW4gZHluYW1pYyBlbnVtZXJhdGlvbi4KICAgIHZhciBwYXJlbnRWbm9kZSA9IG9wdGlvbnMuX3BhcmVudFZub2RlOwogICAgb3B0cy5wYXJlbnQgPSBvcHRpb25zLnBhcmVudDsKICAgIG9wdHMuX3BhcmVudFZub2RlID0gcGFyZW50Vm5vZGU7CgogICAgdmFyIHZub2RlQ29tcG9uZW50T3B0aW9ucyA9IHBhcmVudFZub2RlLmNvbXBvbmVudE9wdGlvbnM7CiAgICBvcHRzLnByb3BzRGF0YSA9IHZub2RlQ29tcG9uZW50T3B0aW9ucy5wcm9wc0RhdGE7CiAgICBvcHRzLl9wYXJlbnRMaXN0ZW5lcnMgPSB2bm9kZUNvbXBvbmVudE9wdGlvbnMubGlzdGVuZXJzOwogICAgb3B0cy5fcmVuZGVyQ2hpbGRyZW4gPSB2bm9kZUNvbXBvbmVudE9wdGlvbnMuY2hpbGRyZW47CiAgICBvcHRzLl9jb21wb25lbnRUYWcgPSB2bm9kZUNvbXBvbmVudE9wdGlvbnMudGFnOwoKICAgIGlmIChvcHRpb25zLnJlbmRlcikgewogICAgICBvcHRzLnJlbmRlciA9IG9wdGlvbnMucmVuZGVyOwogICAgICBvcHRzLnN0YXRpY1JlbmRlckZucyA9IG9wdGlvbnMuc3RhdGljUmVuZGVyRm5zOwogICAgfQogIH0KCiAgZnVuY3Rpb24gcmVzb2x2ZUNvbnN0cnVjdG9yT3B0aW9ucyAoQ3RvcikgewogICAgdmFyIG9wdGlvbnMgPSBDdG9yLm9wdGlvbnM7CiAgICBpZiAoQ3Rvci5zdXBlcikgewogICAgICB2YXIgc3VwZXJPcHRpb25zID0gcmVzb2x2ZUNvbnN0cnVjdG9yT3B0aW9ucyhDdG9yLnN1cGVyKTsKICAgICAgdmFyIGNhY2hlZFN1cGVyT3B0aW9ucyA9IEN0b3Iuc3VwZXJPcHRpb25zOwogICAgICBpZiAoc3VwZXJPcHRpb25zICE9PSBjYWNoZWRTdXBlck9wdGlvbnMpIHsKICAgICAgICAvLyBzdXBlciBvcHRpb24gY2hhbmdlZCwKICAgICAgICAvLyBuZWVkIHRvIHJlc29sdmUgbmV3IG9wdGlvbnMuCiAgICAgICAgQ3Rvci5zdXBlck9wdGlvbnMgPSBzdXBlck9wdGlvbnM7CiAgICAgICAgLy8gY2hlY2sgaWYgdGhlcmUgYXJlIGFueSBsYXRlLW1vZGlmaWVkL2F0dGFjaGVkIG9wdGlvbnMgKCM0OTc2KQogICAgICAgIHZhciBtb2RpZmllZE9wdGlvbnMgPSByZXNvbHZlTW9kaWZpZWRPcHRpb25zKEN0b3IpOwogICAgICAgIC8vIHVwZGF0ZSBiYXNlIGV4dGVuZCBvcHRpb25zCiAgICAgICAgaWYgKG1vZGlmaWVkT3B0aW9ucykgewogICAgICAgICAgZXh0ZW5kKEN0b3IuZXh0ZW5kT3B0aW9ucywgbW9kaWZpZWRPcHRpb25zKTsKICAgICAgICB9CiAgICAgICAgb3B0aW9ucyA9IEN0b3Iub3B0aW9ucyA9IG1lcmdlT3B0aW9ucyhzdXBlck9wdGlvbnMsIEN0b3IuZXh0ZW5kT3B0aW9ucyk7CiAgICAgICAgaWYgKG9wdGlvbnMubmFtZSkgewogICAgICAgICAgb3B0aW9ucy5jb21wb25lbnRzW29wdGlvbnMubmFtZV0gPSBDdG9yOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIG9wdGlvbnMKICB9CgogIGZ1bmN0aW9uIHJlc29sdmVNb2RpZmllZE9wdGlvbnMgKEN0b3IpIHsKICAgIHZhciBtb2RpZmllZDsKICAgIHZhciBsYXRlc3QgPSBDdG9yLm9wdGlvbnM7CiAgICB2YXIgc2VhbGVkID0gQ3Rvci5zZWFsZWRPcHRpb25zOwogICAgZm9yICh2YXIga2V5IGluIGxhdGVzdCkgewogICAgICBpZiAobGF0ZXN0W2tleV0gIT09IHNlYWxlZFtrZXldKSB7CiAgICAgICAgaWYgKCFtb2RpZmllZCkgeyBtb2RpZmllZCA9IHt9OyB9CiAgICAgICAgbW9kaWZpZWRba2V5XSA9IGxhdGVzdFtrZXldOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbW9kaWZpZWQKICB9CgogIGZ1bmN0aW9uIFZ1ZSAob3B0aW9ucykgewogICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFZ1ZSkKICAgICkgewogICAgICB3YXJuKCdWdWUgaXMgYSBjb25zdHJ1Y3RvciBhbmQgc2hvdWxkIGJlIGNhbGxlZCB3aXRoIHRoZSBgbmV3YCBrZXl3b3JkJyk7CiAgICB9CiAgICB0aGlzLl9pbml0KG9wdGlvbnMpOwogIH0KCiAgaW5pdE1peGluKFZ1ZSk7CiAgc3RhdGVNaXhpbihWdWUpOwogIGV2ZW50c01peGluKFZ1ZSk7CiAgbGlmZWN5Y2xlTWl4aW4oVnVlKTsKICByZW5kZXJNaXhpbihWdWUpOwoKICAvKiAgKi8KCiAgZnVuY3Rpb24gaW5pdFVzZSAoVnVlKSB7CiAgICBWdWUudXNlID0gZnVuY3Rpb24gKHBsdWdpbikgewogICAgICB2YXIgaW5zdGFsbGVkUGx1Z2lucyA9ICh0aGlzLl9pbnN0YWxsZWRQbHVnaW5zIHx8ICh0aGlzLl9pbnN0YWxsZWRQbHVnaW5zID0gW10pKTsKICAgICAgaWYgKGluc3RhbGxlZFBsdWdpbnMuaW5kZXhPZihwbHVnaW4pID4gLTEpIHsKICAgICAgICByZXR1cm4gdGhpcwogICAgICB9CgogICAgICAvLyBhZGRpdGlvbmFsIHBhcmFtZXRlcnMKICAgICAgdmFyIGFyZ3MgPSB0b0FycmF5KGFyZ3VtZW50cywgMSk7CiAgICAgIGFyZ3MudW5zaGlmdCh0aGlzKTsKICAgICAgaWYgKHR5cGVvZiBwbHVnaW4uaW5zdGFsbCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIHBsdWdpbi5pbnN0YWxsLmFwcGx5KHBsdWdpbiwgYXJncyk7CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHBsdWdpbiA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIHBsdWdpbi5hcHBseShudWxsLCBhcmdzKTsKICAgICAgfQogICAgICBpbnN0YWxsZWRQbHVnaW5zLnB1c2gocGx1Z2luKTsKICAgICAgcmV0dXJuIHRoaXMKICAgIH07CiAgfQoKICAvKiAgKi8KCiAgZnVuY3Rpb24gaW5pdE1peGluJDEgKFZ1ZSkgewogICAgVnVlLm1peGluID0gZnVuY3Rpb24gKG1peGluKSB7CiAgICAgIHRoaXMub3B0aW9ucyA9IG1lcmdlT3B0aW9ucyh0aGlzLm9wdGlvbnMsIG1peGluKTsKICAgICAgcmV0dXJuIHRoaXMKICAgIH07CiAgfQoKICAvKiAgKi8KCiAgZnVuY3Rpb24gaW5pdEV4dGVuZCAoVnVlKSB7CiAgICAvKioKICAgICAqIEVhY2ggaW5zdGFuY2UgY29uc3RydWN0b3IsIGluY2x1ZGluZyBWdWUsIGhhcyBhIHVuaXF1ZQogICAgICogY2lkLiBUaGlzIGVuYWJsZXMgdXMgdG8gY3JlYXRlIHdyYXBwZWQgImNoaWxkCiAgICAgKiBjb25zdHJ1Y3RvcnMiIGZvciBwcm90b3R5cGFsIGluaGVyaXRhbmNlIGFuZCBjYWNoZSB0aGVtLgogICAgICovCiAgICBWdWUuY2lkID0gMDsKICAgIHZhciBjaWQgPSAxOwoKICAgIC8qKgogICAgICogQ2xhc3MgaW5oZXJpdGFuY2UKICAgICAqLwogICAgVnVlLmV4dGVuZCA9IGZ1bmN0aW9uIChleHRlbmRPcHRpb25zKSB7CiAgICAgIGV4dGVuZE9wdGlvbnMgPSBleHRlbmRPcHRpb25zIHx8IHt9OwogICAgICB2YXIgU3VwZXIgPSB0aGlzOwogICAgICB2YXIgU3VwZXJJZCA9IFN1cGVyLmNpZDsKICAgICAgdmFyIGNhY2hlZEN0b3JzID0gZXh0ZW5kT3B0aW9ucy5fQ3RvciB8fCAoZXh0ZW5kT3B0aW9ucy5fQ3RvciA9IHt9KTsKICAgICAgaWYgKGNhY2hlZEN0b3JzW1N1cGVySWRdKSB7CiAgICAgICAgcmV0dXJuIGNhY2hlZEN0b3JzW1N1cGVySWRdCiAgICAgIH0KCiAgICAgIHZhciBuYW1lID0gZXh0ZW5kT3B0aW9ucy5uYW1lIHx8IFN1cGVyLm9wdGlvbnMubmFtZTsKICAgICAgaWYgKG5hbWUpIHsKICAgICAgICB2YWxpZGF0ZUNvbXBvbmVudE5hbWUobmFtZSk7CiAgICAgIH0KCiAgICAgIHZhciBTdWIgPSBmdW5jdGlvbiBWdWVDb21wb25lbnQgKG9wdGlvbnMpIHsKICAgICAgICB0aGlzLl9pbml0KG9wdGlvbnMpOwogICAgICB9OwogICAgICBTdWIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShTdXBlci5wcm90b3R5cGUpOwogICAgICBTdWIucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gU3ViOwogICAgICBTdWIuY2lkID0gY2lkKys7CiAgICAgIFN1Yi5vcHRpb25zID0gbWVyZ2VPcHRpb25zKAogICAgICAgIFN1cGVyLm9wdGlvbnMsCiAgICAgICAgZXh0ZW5kT3B0aW9ucwogICAgICApOwogICAgICBTdWJbJ3N1cGVyJ10gPSBTdXBlcjsKCiAgICAgIC8vIEZvciBwcm9wcyBhbmQgY29tcHV0ZWQgcHJvcGVydGllcywgd2UgZGVmaW5lIHRoZSBwcm94eSBnZXR0ZXJzIG9uCiAgICAgIC8vIHRoZSBWdWUgaW5zdGFuY2VzIGF0IGV4dGVuc2lvbiB0aW1lLCBvbiB0aGUgZXh0ZW5kZWQgcHJvdG90eXBlLiBUaGlzCiAgICAgIC8vIGF2b2lkcyBPYmplY3QuZGVmaW5lUHJvcGVydHkgY2FsbHMgZm9yIGVhY2ggaW5zdGFuY2UgY3JlYXRlZC4KICAgICAgaWYgKFN1Yi5vcHRpb25zLnByb3BzKSB7CiAgICAgICAgaW5pdFByb3BzJDEoU3ViKTsKICAgICAgfQogICAgICBpZiAoU3ViLm9wdGlvbnMuY29tcHV0ZWQpIHsKICAgICAgICBpbml0Q29tcHV0ZWQkMShTdWIpOwogICAgICB9CgogICAgICAvLyBhbGxvdyBmdXJ0aGVyIGV4dGVuc2lvbi9taXhpbi9wbHVnaW4gdXNhZ2UKICAgICAgU3ViLmV4dGVuZCA9IFN1cGVyLmV4dGVuZDsKICAgICAgU3ViLm1peGluID0gU3VwZXIubWl4aW47CiAgICAgIFN1Yi51c2UgPSBTdXBlci51c2U7CgogICAgICAvLyBjcmVhdGUgYXNzZXQgcmVnaXN0ZXJzLCBzbyBleHRlbmRlZCBjbGFzc2VzCiAgICAgIC8vIGNhbiBoYXZlIHRoZWlyIHByaXZhdGUgYXNzZXRzIHRvby4KICAgICAgQVNTRVRfVFlQRVMuZm9yRWFjaChmdW5jdGlvbiAodHlwZSkgewogICAgICAgIFN1Ylt0eXBlXSA9IFN1cGVyW3R5cGVdOwogICAgICB9KTsKICAgICAgLy8gZW5hYmxlIHJlY3Vyc2l2ZSBzZWxmLWxvb2t1cAogICAgICBpZiAobmFtZSkgewogICAgICAgIFN1Yi5vcHRpb25zLmNvbXBvbmVudHNbbmFtZV0gPSBTdWI7CiAgICAgIH0KCiAgICAgIC8vIGtlZXAgYSByZWZlcmVuY2UgdG8gdGhlIHN1cGVyIG9wdGlvbnMgYXQgZXh0ZW5zaW9uIHRpbWUuCiAgICAgIC8vIGxhdGVyIGF0IGluc3RhbnRpYXRpb24gd2UgY2FuIGNoZWNrIGlmIFN1cGVyJ3Mgb3B0aW9ucyBoYXZlCiAgICAgIC8vIGJlZW4gdXBkYXRlZC4KICAgICAgU3ViLnN1cGVyT3B0aW9ucyA9IFN1cGVyLm9wdGlvbnM7CiAgICAgIFN1Yi5leHRlbmRPcHRpb25zID0gZXh0ZW5kT3B0aW9uczsKICAgICAgU3ViLnNlYWxlZE9wdGlvbnMgPSBleHRlbmQoe30sIFN1Yi5vcHRpb25zKTsKCiAgICAgIC8vIGNhY2hlIGNvbnN0cnVjdG9yCiAgICAgIGNhY2hlZEN0b3JzW1N1cGVySWRdID0gU3ViOwogICAgICByZXR1cm4gU3ViCiAgICB9OwogIH0KCiAgZnVuY3Rpb24gaW5pdFByb3BzJDEgKENvbXApIHsKICAgIHZhciBwcm9wcyA9IENvbXAub3B0aW9ucy5wcm9wczsKICAgIGZvciAodmFyIGtleSBpbiBwcm9wcykgewogICAgICBwcm94eShDb21wLnByb3RvdHlwZSwgIl9wcm9wcyIsIGtleSk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBpbml0Q29tcHV0ZWQkMSAoQ29tcCkgewogICAgdmFyIGNvbXB1dGVkID0gQ29tcC5vcHRpb25zLmNvbXB1dGVkOwogICAgZm9yICh2YXIga2V5IGluIGNvbXB1dGVkKSB7CiAgICAgIGRlZmluZUNvbXB1dGVkKENvbXAucHJvdG90eXBlLCBrZXksIGNvbXB1dGVkW2tleV0pOwogICAgfQogIH0KCiAgLyogICovCgogIGZ1bmN0aW9uIGluaXRBc3NldFJlZ2lzdGVycyAoVnVlKSB7CiAgICAvKioKICAgICAqIENyZWF0ZSBhc3NldCByZWdpc3RyYXRpb24gbWV0aG9kcy4KICAgICAqLwogICAgQVNTRVRfVFlQRVMuZm9yRWFjaChmdW5jdGlvbiAodHlwZSkgewogICAgICBWdWVbdHlwZV0gPSBmdW5jdGlvbiAoCiAgICAgICAgaWQsCiAgICAgICAgZGVmaW5pdGlvbgogICAgICApIHsKICAgICAgICBpZiAoIWRlZmluaXRpb24pIHsKICAgICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnNbdHlwZSArICdzJ11baWRdCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgICAgICAgaWYgKHR5cGUgPT09ICdjb21wb25lbnQnKSB7CiAgICAgICAgICAgIHZhbGlkYXRlQ29tcG9uZW50TmFtZShpZCk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodHlwZSA9PT0gJ2NvbXBvbmVudCcgJiYgaXNQbGFpbk9iamVjdChkZWZpbml0aW9uKSkgewogICAgICAgICAgICBkZWZpbml0aW9uLm5hbWUgPSBkZWZpbml0aW9uLm5hbWUgfHwgaWQ7CiAgICAgICAgICAgIGRlZmluaXRpb24gPSB0aGlzLm9wdGlvbnMuX2Jhc2UuZXh0ZW5kKGRlZmluaXRpb24pOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHR5cGUgPT09ICdkaXJlY3RpdmUnICYmIHR5cGVvZiBkZWZpbml0aW9uID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgIGRlZmluaXRpb24gPSB7IGJpbmQ6IGRlZmluaXRpb24sIHVwZGF0ZTogZGVmaW5pdGlvbiB9OwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5vcHRpb25zW3R5cGUgKyAncyddW2lkXSA9IGRlZmluaXRpb247CiAgICAgICAgICByZXR1cm4gZGVmaW5pdGlvbgogICAgICAgIH0KICAgICAgfTsKICAgIH0pOwogIH0KCiAgLyogICovCgoKCiAgZnVuY3Rpb24gZ2V0Q29tcG9uZW50TmFtZSAob3B0cykgewogICAgcmV0dXJuIG9wdHMgJiYgKG9wdHMuQ3Rvci5vcHRpb25zLm5hbWUgfHwgb3B0cy50YWcpCiAgfQoKICBmdW5jdGlvbiBtYXRjaGVzIChwYXR0ZXJuLCBuYW1lKSB7CiAgICBpZiAoQXJyYXkuaXNBcnJheShwYXR0ZXJuKSkgewogICAgICByZXR1cm4gcGF0dGVybi5pbmRleE9mKG5hbWUpID4gLTEKICAgIH0gZWxzZSBpZiAodHlwZW9mIHBhdHRlcm4gPT09ICdzdHJpbmcnKSB7CiAgICAgIHJldHVybiBwYXR0ZXJuLnNwbGl0KCcsJykuaW5kZXhPZihuYW1lKSA+IC0xCiAgICB9IGVsc2UgaWYgKGlzUmVnRXhwKHBhdHRlcm4pKSB7CiAgICAgIHJldHVybiBwYXR0ZXJuLnRlc3QobmFtZSkKICAgIH0KICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICByZXR1cm4gZmFsc2UKICB9CgogIGZ1bmN0aW9uIHBydW5lQ2FjaGUgKGtlZXBBbGl2ZUluc3RhbmNlLCBmaWx0ZXIpIHsKICAgIHZhciBjYWNoZSA9IGtlZXBBbGl2ZUluc3RhbmNlLmNhY2hlOwogICAgdmFyIGtleXMgPSBrZWVwQWxpdmVJbnN0YW5jZS5rZXlzOwogICAgdmFyIF92bm9kZSA9IGtlZXBBbGl2ZUluc3RhbmNlLl92bm9kZTsKICAgIGZvciAodmFyIGtleSBpbiBjYWNoZSkgewogICAgICB2YXIgY2FjaGVkTm9kZSA9IGNhY2hlW2tleV07CiAgICAgIGlmIChjYWNoZWROb2RlKSB7CiAgICAgICAgdmFyIG5hbWUgPSBnZXRDb21wb25lbnROYW1lKGNhY2hlZE5vZGUuY29tcG9uZW50T3B0aW9ucyk7CiAgICAgICAgaWYgKG5hbWUgJiYgIWZpbHRlcihuYW1lKSkgewogICAgICAgICAgcHJ1bmVDYWNoZUVudHJ5KGNhY2hlLCBrZXksIGtleXMsIF92bm9kZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBwcnVuZUNhY2hlRW50cnkgKAogICAgY2FjaGUsCiAgICBrZXksCiAgICBrZXlzLAogICAgY3VycmVudAogICkgewogICAgdmFyIGNhY2hlZCQkMSA9IGNhY2hlW2tleV07CiAgICBpZiAoY2FjaGVkJCQxICYmICghY3VycmVudCB8fCBjYWNoZWQkJDEudGFnICE9PSBjdXJyZW50LnRhZykpIHsKICAgICAgY2FjaGVkJCQxLmNvbXBvbmVudEluc3RhbmNlLiRkZXN0cm95KCk7CiAgICB9CiAgICBjYWNoZVtrZXldID0gbnVsbDsKICAgIHJlbW92ZShrZXlzLCBrZXkpOwogIH0KCiAgdmFyIHBhdHRlcm5UeXBlcyA9IFtTdHJpbmcsIFJlZ0V4cCwgQXJyYXldOwoKICB2YXIgS2VlcEFsaXZlID0gewogICAgbmFtZTogJ2tlZXAtYWxpdmUnLAogICAgYWJzdHJhY3Q6IHRydWUsCgogICAgcHJvcHM6IHsKICAgICAgaW5jbHVkZTogcGF0dGVyblR5cGVzLAogICAgICBleGNsdWRlOiBwYXR0ZXJuVHlwZXMsCiAgICAgIG1heDogW1N0cmluZywgTnVtYmVyXQogICAgfSwKCiAgICBjcmVhdGVkOiBmdW5jdGlvbiBjcmVhdGVkICgpIHsKICAgICAgdGhpcy5jYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIHRoaXMua2V5cyA9IFtdOwogICAgfSwKCiAgICBkZXN0cm95ZWQ6IGZ1bmN0aW9uIGRlc3Ryb3llZCAoKSB7CiAgICAgIGZvciAodmFyIGtleSBpbiB0aGlzLmNhY2hlKSB7CiAgICAgICAgcHJ1bmVDYWNoZUVudHJ5KHRoaXMuY2FjaGUsIGtleSwgdGhpcy5rZXlzKTsKICAgICAgfQogICAgfSwKCiAgICBtb3VudGVkOiBmdW5jdGlvbiBtb3VudGVkICgpIHsKICAgICAgdmFyIHRoaXMkMSA9IHRoaXM7CgogICAgICB0aGlzLiR3YXRjaCgnaW5jbHVkZScsIGZ1bmN0aW9uICh2YWwpIHsKICAgICAgICBwcnVuZUNhY2hlKHRoaXMkMSwgZnVuY3Rpb24gKG5hbWUpIHsgcmV0dXJuIG1hdGNoZXModmFsLCBuYW1lKTsgfSk7CiAgICAgIH0pOwogICAgICB0aGlzLiR3YXRjaCgnZXhjbHVkZScsIGZ1bmN0aW9uICh2YWwpIHsKICAgICAgICBwcnVuZUNhY2hlKHRoaXMkMSwgZnVuY3Rpb24gKG5hbWUpIHsgcmV0dXJuICFtYXRjaGVzKHZhbCwgbmFtZSk7IH0pOwogICAgICB9KTsKICAgIH0sCgogICAgcmVuZGVyOiBmdW5jdGlvbiByZW5kZXIgKCkgewogICAgICB2YXIgc2xvdCA9IHRoaXMuJHNsb3RzLmRlZmF1bHQ7CiAgICAgIHZhciB2bm9kZSA9IGdldEZpcnN0Q29tcG9uZW50Q2hpbGQoc2xvdCk7CiAgICAgIHZhciBjb21wb25lbnRPcHRpb25zID0gdm5vZGUgJiYgdm5vZGUuY29tcG9uZW50T3B0aW9uczsKICAgICAgaWYgKGNvbXBvbmVudE9wdGlvbnMpIHsKICAgICAgICAvLyBjaGVjayBwYXR0ZXJuCiAgICAgICAgdmFyIG5hbWUgPSBnZXRDb21wb25lbnROYW1lKGNvbXBvbmVudE9wdGlvbnMpOwogICAgICAgIHZhciByZWYgPSB0aGlzOwogICAgICAgIHZhciBpbmNsdWRlID0gcmVmLmluY2x1ZGU7CiAgICAgICAgdmFyIGV4Y2x1ZGUgPSByZWYuZXhjbHVkZTsKICAgICAgICBpZiAoCiAgICAgICAgICAvLyBub3QgaW5jbHVkZWQKICAgICAgICAgIChpbmNsdWRlICYmICghbmFtZSB8fCAhbWF0Y2hlcyhpbmNsdWRlLCBuYW1lKSkpIHx8CiAgICAgICAgICAvLyBleGNsdWRlZAogICAgICAgICAgKGV4Y2x1ZGUgJiYgbmFtZSAmJiBtYXRjaGVzKGV4Y2x1ZGUsIG5hbWUpKQogICAgICAgICkgewogICAgICAgICAgcmV0dXJuIHZub2RlCiAgICAgICAgfQoKICAgICAgICB2YXIgcmVmJDEgPSB0aGlzOwogICAgICAgIHZhciBjYWNoZSA9IHJlZiQxLmNhY2hlOwogICAgICAgIHZhciBrZXlzID0gcmVmJDEua2V5czsKICAgICAgICB2YXIga2V5ID0gdm5vZGUua2V5ID09IG51bGwKICAgICAgICAgIC8vIHNhbWUgY29uc3RydWN0b3IgbWF5IGdldCByZWdpc3RlcmVkIGFzIGRpZmZlcmVudCBsb2NhbCBjb21wb25lbnRzCiAgICAgICAgICAvLyBzbyBjaWQgYWxvbmUgaXMgbm90IGVub3VnaCAoIzMyNjkpCiAgICAgICAgICA/IGNvbXBvbmVudE9wdGlvbnMuQ3Rvci5jaWQgKyAoY29tcG9uZW50T3B0aW9ucy50YWcgPyAoIjo6IiArIChjb21wb25lbnRPcHRpb25zLnRhZykpIDogJycpCiAgICAgICAgICA6IHZub2RlLmtleTsKICAgICAgICBpZiAoY2FjaGVba2V5XSkgewogICAgICAgICAgdm5vZGUuY29tcG9uZW50SW5zdGFuY2UgPSBjYWNoZVtrZXldLmNvbXBvbmVudEluc3RhbmNlOwogICAgICAgICAgLy8gbWFrZSBjdXJyZW50IGtleSBmcmVzaGVzdAogICAgICAgICAgcmVtb3ZlKGtleXMsIGtleSk7CiAgICAgICAgICBrZXlzLnB1c2goa2V5KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY2FjaGVba2V5XSA9IHZub2RlOwogICAgICAgICAga2V5cy5wdXNoKGtleSk7CiAgICAgICAgICAvLyBwcnVuZSBvbGRlc3QgZW50cnkKICAgICAgICAgIGlmICh0aGlzLm1heCAmJiBrZXlzLmxlbmd0aCA+IHBhcnNlSW50KHRoaXMubWF4KSkgewogICAgICAgICAgICBwcnVuZUNhY2hlRW50cnkoY2FjaGUsIGtleXNbMF0sIGtleXMsIHRoaXMuX3Zub2RlKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZub2RlLmRhdGEua2VlcEFsaXZlID0gdHJ1ZTsKICAgICAgfQogICAgICByZXR1cm4gdm5vZGUgfHwgKHNsb3QgJiYgc2xvdFswXSkKICAgIH0KICB9OwoKICB2YXIgYnVpbHRJbkNvbXBvbmVudHMgPSB7CiAgICBLZWVwQWxpdmU6IEtlZXBBbGl2ZQogIH07CgogIC8qICAqLwoKICBmdW5jdGlvbiBpbml0R2xvYmFsQVBJIChWdWUpIHsKICAgIC8vIGNvbmZpZwogICAgdmFyIGNvbmZpZ0RlZiA9IHt9OwogICAgY29uZmlnRGVmLmdldCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGNvbmZpZzsgfTsKICAgIHsKICAgICAgY29uZmlnRGVmLnNldCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICB3YXJuKAogICAgICAgICAgJ0RvIG5vdCByZXBsYWNlIHRoZSBWdWUuY29uZmlnIG9iamVjdCwgc2V0IGluZGl2aWR1YWwgZmllbGRzIGluc3RlYWQuJwogICAgICAgICk7CiAgICAgIH07CiAgICB9CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoVnVlLCAnY29uZmlnJywgY29uZmlnRGVmKTsKCiAgICAvLyBleHBvc2VkIHV0aWwgbWV0aG9kcy4KICAgIC8vIE5PVEU6IHRoZXNlIGFyZSBub3QgY29uc2lkZXJlZCBwYXJ0IG9mIHRoZSBwdWJsaWMgQVBJIC0gYXZvaWQgcmVseWluZyBvbgogICAgLy8gdGhlbSB1bmxlc3MgeW91IGFyZSBhd2FyZSBvZiB0aGUgcmlzay4KICAgIFZ1ZS51dGlsID0gewogICAgICB3YXJuOiB3YXJuLAogICAgICBleHRlbmQ6IGV4dGVuZCwKICAgICAgbWVyZ2VPcHRpb25zOiBtZXJnZU9wdGlvbnMsCiAgICAgIGRlZmluZVJlYWN0aXZlOiBkZWZpbmVSZWFjdGl2ZSQkMQogICAgfTsKCiAgICBWdWUuc2V0ID0gc2V0OwogICAgVnVlLmRlbGV0ZSA9IGRlbDsKICAgIFZ1ZS5uZXh0VGljayA9IG5leHRUaWNrOwoKICAgIC8vIDIuNiBleHBsaWNpdCBvYnNlcnZhYmxlIEFQSQogICAgVnVlLm9ic2VydmFibGUgPSBmdW5jdGlvbiAob2JqKSB7CiAgICAgIG9ic2VydmUob2JqKTsKICAgICAgcmV0dXJuIG9iagogICAgfTsKCiAgICBWdWUub3B0aW9ucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBBU1NFVF9UWVBFUy5mb3JFYWNoKGZ1bmN0aW9uICh0eXBlKSB7CiAgICAgIFZ1ZS5vcHRpb25zW3R5cGUgKyAncyddID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIH0pOwoKICAgIC8vIHRoaXMgaXMgdXNlZCB0byBpZGVudGlmeSB0aGUgImJhc2UiIGNvbnN0cnVjdG9yIHRvIGV4dGVuZCBhbGwgcGxhaW4tb2JqZWN0CiAgICAvLyBjb21wb25lbnRzIHdpdGggaW4gV2VleCdzIG11bHRpLWluc3RhbmNlIHNjZW5hcmlvcy4KICAgIFZ1ZS5vcHRpb25zLl9iYXNlID0gVnVlOwoKICAgIGV4dGVuZChWdWUub3B0aW9ucy5jb21wb25lbnRzLCBidWlsdEluQ29tcG9uZW50cyk7CgogICAgaW5pdFVzZShWdWUpOwogICAgaW5pdE1peGluJDEoVnVlKTsKICAgIGluaXRFeHRlbmQoVnVlKTsKICAgIGluaXRBc3NldFJlZ2lzdGVycyhWdWUpOwogIH0KCiAgaW5pdEdsb2JhbEFQSShWdWUpOwoKICBPYmplY3QuZGVmaW5lUHJvcGVydHkoVnVlLnByb3RvdHlwZSwgJyRpc1NlcnZlcicsIHsKICAgIGdldDogaXNTZXJ2ZXJSZW5kZXJpbmcKICB9KTsKCiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFZ1ZS5wcm90b3R5cGUsICckc3NyQ29udGV4dCcsIHsKICAgIGdldDogZnVuY3Rpb24gZ2V0ICgpIHsKICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICAgICAgcmV0dXJuIHRoaXMuJHZub2RlICYmIHRoaXMuJHZub2RlLnNzckNvbnRleHQKICAgIH0KICB9KTsKCiAgLy8gZXhwb3NlIEZ1bmN0aW9uYWxSZW5kZXJDb250ZXh0IGZvciBzc3IgcnVudGltZSBoZWxwZXIgaW5zdGFsbGF0aW9uCiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFZ1ZSwgJ0Z1bmN0aW9uYWxSZW5kZXJDb250ZXh0JywgewogICAgdmFsdWU6IEZ1bmN0aW9uYWxSZW5kZXJDb250ZXh0CiAgfSk7CgogIFZ1ZS52ZXJzaW9uID0gJzIuNi4xMCc7CgogIC8qICAqLwoKICAvLyB0aGVzZSBhcmUgcmVzZXJ2ZWQgZm9yIHdlYiBiZWNhdXNlIHRoZXkgYXJlIGRpcmVjdGx5IGNvbXBpbGVkIGF3YXkKICAvLyBkdXJpbmcgdGVtcGxhdGUgY29tcGlsYXRpb24KICB2YXIgaXNSZXNlcnZlZEF0dHIgPSBtYWtlTWFwKCdzdHlsZSxjbGFzcycpOwoKICAvLyBhdHRyaWJ1dGVzIHRoYXQgc2hvdWxkIGJlIHVzaW5nIHByb3BzIGZvciBiaW5kaW5nCiAgdmFyIGFjY2VwdFZhbHVlID0gbWFrZU1hcCgnaW5wdXQsdGV4dGFyZWEsb3B0aW9uLHNlbGVjdCxwcm9ncmVzcycpOwogIHZhciBtdXN0VXNlUHJvcCA9IGZ1bmN0aW9uICh0YWcsIHR5cGUsIGF0dHIpIHsKICAgIHJldHVybiAoCiAgICAgIChhdHRyID09PSAndmFsdWUnICYmIGFjY2VwdFZhbHVlKHRhZykpICYmIHR5cGUgIT09ICdidXR0b24nIHx8CiAgICAgIChhdHRyID09PSAnc2VsZWN0ZWQnICYmIHRhZyA9PT0gJ29wdGlvbicpIHx8CiAgICAgIChhdHRyID09PSAnY2hlY2tlZCcgJiYgdGFnID09PSAnaW5wdXQnKSB8fAogICAgICAoYXR0ciA9PT0gJ211dGVkJyAmJiB0YWcgPT09ICd2aWRlbycpCiAgICApCiAgfTsKCiAgdmFyIGlzRW51bWVyYXRlZEF0dHIgPSBtYWtlTWFwKCdjb250ZW50ZWRpdGFibGUsZHJhZ2dhYmxlLHNwZWxsY2hlY2snKTsKCiAgdmFyIGlzVmFsaWRDb250ZW50RWRpdGFibGVWYWx1ZSA9IG1ha2VNYXAoJ2V2ZW50cyxjYXJldCx0eXBpbmcscGxhaW50ZXh0LW9ubHknKTsKCiAgdmFyIGNvbnZlcnRFbnVtZXJhdGVkVmFsdWUgPSBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkgewogICAgcmV0dXJuIGlzRmFsc3lBdHRyVmFsdWUodmFsdWUpIHx8IHZhbHVlID09PSAnZmFsc2UnCiAgICAgID8gJ2ZhbHNlJwogICAgICAvLyBhbGxvdyBhcmJpdHJhcnkgc3RyaW5nIHZhbHVlIGZvciBjb250ZW50ZWRpdGFibGUKICAgICAgOiBrZXkgPT09ICdjb250ZW50ZWRpdGFibGUnICYmIGlzVmFsaWRDb250ZW50RWRpdGFibGVWYWx1ZSh2YWx1ZSkKICAgICAgICA/IHZhbHVlCiAgICAgICAgOiAndHJ1ZScKICB9OwoKICB2YXIgaXNCb29sZWFuQXR0ciA9IG1ha2VNYXAoCiAgICAnYWxsb3dmdWxsc2NyZWVuLGFzeW5jLGF1dG9mb2N1cyxhdXRvcGxheSxjaGVja2VkLGNvbXBhY3QsY29udHJvbHMsZGVjbGFyZSwnICsKICAgICdkZWZhdWx0LGRlZmF1bHRjaGVja2VkLGRlZmF1bHRtdXRlZCxkZWZhdWx0c2VsZWN0ZWQsZGVmZXIsZGlzYWJsZWQsJyArCiAgICAnZW5hYmxlZCxmb3Jtbm92YWxpZGF0ZSxoaWRkZW4saW5kZXRlcm1pbmF0ZSxpbmVydCxpc21hcCxpdGVtc2NvcGUsbG9vcCxtdWx0aXBsZSwnICsKICAgICdtdXRlZCxub2hyZWYsbm9yZXNpemUsbm9zaGFkZSxub3ZhbGlkYXRlLG5vd3JhcCxvcGVuLHBhdXNlb25leGl0LHJlYWRvbmx5LCcgKwogICAgJ3JlcXVpcmVkLHJldmVyc2VkLHNjb3BlZCxzZWFtbGVzcyxzZWxlY3RlZCxzb3J0YWJsZSx0cmFuc2xhdGUsJyArCiAgICAndHJ1ZXNwZWVkLHR5cGVtdXN0bWF0Y2gsdmlzaWJsZScKICApOwoKICB2YXIgeGxpbmtOUyA9ICdodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rJzsKCiAgdmFyIGlzWGxpbmsgPSBmdW5jdGlvbiAobmFtZSkgewogICAgcmV0dXJuIG5hbWUuY2hhckF0KDUpID09PSAnOicgJiYgbmFtZS5zbGljZSgwLCA1KSA9PT0gJ3hsaW5rJwogIH07CgogIHZhciBnZXRYbGlua1Byb3AgPSBmdW5jdGlvbiAobmFtZSkgewogICAgcmV0dXJuIGlzWGxpbmsobmFtZSkgPyBuYW1lLnNsaWNlKDYsIG5hbWUubGVuZ3RoKSA6ICcnCiAgfTsKCiAgdmFyIGlzRmFsc3lBdHRyVmFsdWUgPSBmdW5jdGlvbiAodmFsKSB7CiAgICByZXR1cm4gdmFsID09IG51bGwgfHwgdmFsID09PSBmYWxzZQogIH07CgogIC8qICAqLwoKICBmdW5jdGlvbiBnZW5DbGFzc0ZvclZub2RlICh2bm9kZSkgewogICAgdmFyIGRhdGEgPSB2bm9kZS5kYXRhOwogICAgdmFyIHBhcmVudE5vZGUgPSB2bm9kZTsKICAgIHZhciBjaGlsZE5vZGUgPSB2bm9kZTsKICAgIHdoaWxlIChpc0RlZihjaGlsZE5vZGUuY29tcG9uZW50SW5zdGFuY2UpKSB7CiAgICAgIGNoaWxkTm9kZSA9IGNoaWxkTm9kZS5jb21wb25lbnRJbnN0YW5jZS5fdm5vZGU7CiAgICAgIGlmIChjaGlsZE5vZGUgJiYgY2hpbGROb2RlLmRhdGEpIHsKICAgICAgICBkYXRhID0gbWVyZ2VDbGFzc0RhdGEoY2hpbGROb2RlLmRhdGEsIGRhdGEpOwogICAgICB9CiAgICB9CiAgICB3aGlsZSAoaXNEZWYocGFyZW50Tm9kZSA9IHBhcmVudE5vZGUucGFyZW50KSkgewogICAgICBpZiAocGFyZW50Tm9kZSAmJiBwYXJlbnROb2RlLmRhdGEpIHsKICAgICAgICBkYXRhID0gbWVyZ2VDbGFzc0RhdGEoZGF0YSwgcGFyZW50Tm9kZS5kYXRhKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlbmRlckNsYXNzKGRhdGEuc3RhdGljQ2xhc3MsIGRhdGEuY2xhc3MpCiAgfQoKICBmdW5jdGlvbiBtZXJnZUNsYXNzRGF0YSAoY2hpbGQsIHBhcmVudCkgewogICAgcmV0dXJuIHsKICAgICAgc3RhdGljQ2xhc3M6IGNvbmNhdChjaGlsZC5zdGF0aWNDbGFzcywgcGFyZW50LnN0YXRpY0NsYXNzKSwKICAgICAgY2xhc3M6IGlzRGVmKGNoaWxkLmNsYXNzKQogICAgICAgID8gW2NoaWxkLmNsYXNzLCBwYXJlbnQuY2xhc3NdCiAgICAgICAgOiBwYXJlbnQuY2xhc3MKICAgIH0KICB9CgogIGZ1bmN0aW9uIHJlbmRlckNsYXNzICgKICAgIHN0YXRpY0NsYXNzLAogICAgZHluYW1pY0NsYXNzCiAgKSB7CiAgICBpZiAoaXNEZWYoc3RhdGljQ2xhc3MpIHx8IGlzRGVmKGR5bmFtaWNDbGFzcykpIHsKICAgICAgcmV0dXJuIGNvbmNhdChzdGF0aWNDbGFzcywgc3RyaW5naWZ5Q2xhc3MoZHluYW1pY0NsYXNzKSkKICAgIH0KICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICByZXR1cm4gJycKICB9CgogIGZ1bmN0aW9uIGNvbmNhdCAoYSwgYikgewogICAgcmV0dXJuIGEgPyBiID8gKGEgKyAnICcgKyBiKSA6IGEgOiAoYiB8fCAnJykKICB9CgogIGZ1bmN0aW9uIHN0cmluZ2lmeUNsYXNzICh2YWx1ZSkgewogICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7CiAgICAgIHJldHVybiBzdHJpbmdpZnlBcnJheSh2YWx1ZSkKICAgIH0KICAgIGlmIChpc09iamVjdCh2YWx1ZSkpIHsKICAgICAgcmV0dXJuIHN0cmluZ2lmeU9iamVjdCh2YWx1ZSkKICAgIH0KICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7CiAgICAgIHJldHVybiB2YWx1ZQogICAgfQogICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICAgIHJldHVybiAnJwogIH0KCiAgZnVuY3Rpb24gc3RyaW5naWZ5QXJyYXkgKHZhbHVlKSB7CiAgICB2YXIgcmVzID0gJyc7CiAgICB2YXIgc3RyaW5naWZpZWQ7CiAgICBmb3IgKHZhciBpID0gMCwgbCA9IHZhbHVlLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICBpZiAoaXNEZWYoc3RyaW5naWZpZWQgPSBzdHJpbmdpZnlDbGFzcyh2YWx1ZVtpXSkpICYmIHN0cmluZ2lmaWVkICE9PSAnJykgewogICAgICAgIGlmIChyZXMpIHsgcmVzICs9ICcgJzsgfQogICAgICAgIHJlcyArPSBzdHJpbmdpZmllZDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlcwogIH0KCiAgZnVuY3Rpb24gc3RyaW5naWZ5T2JqZWN0ICh2YWx1ZSkgewogICAgdmFyIHJlcyA9ICcnOwogICAgZm9yICh2YXIga2V5IGluIHZhbHVlKSB7CiAgICAgIGlmICh2YWx1ZVtrZXldKSB7CiAgICAgICAgaWYgKHJlcykgeyByZXMgKz0gJyAnOyB9CiAgICAgICAgcmVzICs9IGtleTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlcwogIH0KCiAgLyogICovCgogIHZhciBuYW1lc3BhY2VNYXAgPSB7CiAgICBzdmc6ICdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsCiAgICBtYXRoOiAnaHR0cDovL3d3dy53My5vcmcvMTk5OC9NYXRoL01hdGhNTCcKICB9OwoKICB2YXIgaXNIVE1MVGFnID0gbWFrZU1hcCgKICAgICdodG1sLGJvZHksYmFzZSxoZWFkLGxpbmssbWV0YSxzdHlsZSx0aXRsZSwnICsKICAgICdhZGRyZXNzLGFydGljbGUsYXNpZGUsZm9vdGVyLGhlYWRlcixoMSxoMixoMyxoNCxoNSxoNixoZ3JvdXAsbmF2LHNlY3Rpb24sJyArCiAgICAnZGl2LGRkLGRsLGR0LGZpZ2NhcHRpb24sZmlndXJlLHBpY3R1cmUsaHIsaW1nLGxpLG1haW4sb2wscCxwcmUsdWwsJyArCiAgICAnYSxiLGFiYnIsYmRpLGJkbyxicixjaXRlLGNvZGUsZGF0YSxkZm4sZW0saSxrYmQsbWFyayxxLHJwLHJ0LHJ0YyxydWJ5LCcgKwogICAgJ3Msc2FtcCxzbWFsbCxzcGFuLHN0cm9uZyxzdWIsc3VwLHRpbWUsdSx2YXIsd2JyLGFyZWEsYXVkaW8sbWFwLHRyYWNrLHZpZGVvLCcgKwogICAgJ2VtYmVkLG9iamVjdCxwYXJhbSxzb3VyY2UsY2FudmFzLHNjcmlwdCxub3NjcmlwdCxkZWwsaW5zLCcgKwogICAgJ2NhcHRpb24sY29sLGNvbGdyb3VwLHRhYmxlLHRoZWFkLHRib2R5LHRkLHRoLHRyLCcgKwogICAgJ2J1dHRvbixkYXRhbGlzdCxmaWVsZHNldCxmb3JtLGlucHV0LGxhYmVsLGxlZ2VuZCxtZXRlcixvcHRncm91cCxvcHRpb24sJyArCiAgICAnb3V0cHV0LHByb2dyZXNzLHNlbGVjdCx0ZXh0YXJlYSwnICsKICAgICdkZXRhaWxzLGRpYWxvZyxtZW51LG1lbnVpdGVtLHN1bW1hcnksJyArCiAgICAnY29udGVudCxlbGVtZW50LHNoYWRvdyx0ZW1wbGF0ZSxibG9ja3F1b3RlLGlmcmFtZSx0Zm9vdCcKICApOwoKICAvLyB0aGlzIG1hcCBpcyBpbnRlbnRpb25hbGx5IHNlbGVjdGl2ZSwgb25seSBjb3ZlcmluZyBTVkcgZWxlbWVudHMgdGhhdCBtYXkKICAvLyBjb250YWluIGNoaWxkIGVsZW1lbnRzLgogIHZhciBpc1NWRyA9IG1ha2VNYXAoCiAgICAnc3ZnLGFuaW1hdGUsY2lyY2xlLGNsaXBwYXRoLGN1cnNvcixkZWZzLGRlc2MsZWxsaXBzZSxmaWx0ZXIsZm9udC1mYWNlLCcgKwogICAgJ2ZvcmVpZ25PYmplY3QsZyxnbHlwaCxpbWFnZSxsaW5lLG1hcmtlcixtYXNrLG1pc3NpbmctZ2x5cGgscGF0aCxwYXR0ZXJuLCcgKwogICAgJ3BvbHlnb24scG9seWxpbmUscmVjdCxzd2l0Y2gsc3ltYm9sLHRleHQsdGV4dHBhdGgsdHNwYW4sdXNlLHZpZXcnLAogICAgdHJ1ZQogICk7CgogIHZhciBpc1ByZVRhZyA9IGZ1bmN0aW9uICh0YWcpIHsgcmV0dXJuIHRhZyA9PT0gJ3ByZSc7IH07CgogIHZhciBpc1Jlc2VydmVkVGFnID0gZnVuY3Rpb24gKHRhZykgewogICAgcmV0dXJuIGlzSFRNTFRhZyh0YWcpIHx8IGlzU1ZHKHRhZykKICB9OwoKICBmdW5jdGlvbiBnZXRUYWdOYW1lc3BhY2UgKHRhZykgewogICAgaWYgKGlzU1ZHKHRhZykpIHsKICAgICAgcmV0dXJuICdzdmcnCiAgICB9CiAgICAvLyBiYXNpYyBzdXBwb3J0IGZvciBNYXRoTUwKICAgIC8vIG5vdGUgaXQgZG9lc24ndCBzdXBwb3J0IG90aGVyIE1hdGhNTCBlbGVtZW50cyBiZWluZyBjb21wb25lbnQgcm9vdHMKICAgIGlmICh0YWcgPT09ICdtYXRoJykgewogICAgICByZXR1cm4gJ21hdGgnCiAgICB9CiAgfQoKICB2YXIgdW5rbm93bkVsZW1lbnRDYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgZnVuY3Rpb24gaXNVbmtub3duRWxlbWVudCAodGFnKSB7CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgIGlmICghaW5Ccm93c2VyKSB7CiAgICAgIHJldHVybiB0cnVlCiAgICB9CiAgICBpZiAoaXNSZXNlcnZlZFRhZyh0YWcpKSB7CiAgICAgIHJldHVybiBmYWxzZQogICAgfQogICAgdGFnID0gdGFnLnRvTG93ZXJDYXNlKCk7CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgIGlmICh1bmtub3duRWxlbWVudENhY2hlW3RhZ10gIT0gbnVsbCkgewogICAgICByZXR1cm4gdW5rbm93bkVsZW1lbnRDYWNoZVt0YWddCiAgICB9CiAgICB2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRhZyk7CiAgICBpZiAodGFnLmluZGV4T2YoJy0nKSA+IC0xKSB7CiAgICAgIC8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9hLzI4MjEwMzY0LzEwNzAyNDQKICAgICAgcmV0dXJuICh1bmtub3duRWxlbWVudENhY2hlW3RhZ10gPSAoCiAgICAgICAgZWwuY29uc3RydWN0b3IgPT09IHdpbmRvdy5IVE1MVW5rbm93bkVsZW1lbnQgfHwKICAgICAgICBlbC5jb25zdHJ1Y3RvciA9PT0gd2luZG93LkhUTUxFbGVtZW50CiAgICAgICkpCiAgICB9IGVsc2UgewogICAgICByZXR1cm4gKHVua25vd25FbGVtZW50Q2FjaGVbdGFnXSA9IC9IVE1MVW5rbm93bkVsZW1lbnQvLnRlc3QoZWwudG9TdHJpbmcoKSkpCiAgICB9CiAgfQoKICB2YXIgaXNUZXh0SW5wdXRUeXBlID0gbWFrZU1hcCgndGV4dCxudW1iZXIscGFzc3dvcmQsc2VhcmNoLGVtYWlsLHRlbCx1cmwnKTsKCiAgLyogICovCgogIC8qKgogICAqIFF1ZXJ5IGFuIGVsZW1lbnQgc2VsZWN0b3IgaWYgaXQncyBub3QgYW4gZWxlbWVudCBhbHJlYWR5LgogICAqLwogIGZ1bmN0aW9uIHF1ZXJ5IChlbCkgewogICAgaWYgKHR5cGVvZiBlbCA9PT0gJ3N0cmluZycpIHsKICAgICAgdmFyIHNlbGVjdGVkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihlbCk7CiAgICAgIGlmICghc2VsZWN0ZWQpIHsKICAgICAgICB3YXJuKAogICAgICAgICAgJ0Nhbm5vdCBmaW5kIGVsZW1lbnQ6ICcgKyBlbAogICAgICAgICk7CiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpCiAgICAgIH0KICAgICAgcmV0dXJuIHNlbGVjdGVkCiAgICB9IGVsc2UgewogICAgICByZXR1cm4gZWwKICAgIH0KICB9CgogIC8qICAqLwoKICBmdW5jdGlvbiBjcmVhdGVFbGVtZW50JDEgKHRhZ05hbWUsIHZub2RlKSB7CiAgICB2YXIgZWxtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWdOYW1lKTsKICAgIGlmICh0YWdOYW1lICE9PSAnc2VsZWN0JykgewogICAgICByZXR1cm4gZWxtCiAgICB9CiAgICAvLyBmYWxzZSBvciBudWxsIHdpbGwgcmVtb3ZlIHRoZSBhdHRyaWJ1dGUgYnV0IHVuZGVmaW5lZCB3aWxsIG5vdAogICAgaWYgKHZub2RlLmRhdGEgJiYgdm5vZGUuZGF0YS5hdHRycyAmJiB2bm9kZS5kYXRhLmF0dHJzLm11bHRpcGxlICE9PSB1bmRlZmluZWQpIHsKICAgICAgZWxtLnNldEF0dHJpYnV0ZSgnbXVsdGlwbGUnLCAnbXVsdGlwbGUnKTsKICAgIH0KICAgIHJldHVybiBlbG0KICB9CgogIGZ1bmN0aW9uIGNyZWF0ZUVsZW1lbnROUyAobmFtZXNwYWNlLCB0YWdOYW1lKSB7CiAgICByZXR1cm4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKG5hbWVzcGFjZU1hcFtuYW1lc3BhY2VdLCB0YWdOYW1lKQogIH0KCiAgZnVuY3Rpb24gY3JlYXRlVGV4dE5vZGUgKHRleHQpIHsKICAgIHJldHVybiBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0ZXh0KQogIH0KCiAgZnVuY3Rpb24gY3JlYXRlQ29tbWVudCAodGV4dCkgewogICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUNvbW1lbnQodGV4dCkKICB9CgogIGZ1bmN0aW9uIGluc2VydEJlZm9yZSAocGFyZW50Tm9kZSwgbmV3Tm9kZSwgcmVmZXJlbmNlTm9kZSkgewogICAgcGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobmV3Tm9kZSwgcmVmZXJlbmNlTm9kZSk7CiAgfQoKICBmdW5jdGlvbiByZW1vdmVDaGlsZCAobm9kZSwgY2hpbGQpIHsKICAgIG5vZGUucmVtb3ZlQ2hpbGQoY2hpbGQpOwogIH0KCiAgZnVuY3Rpb24gYXBwZW5kQ2hpbGQgKG5vZGUsIGNoaWxkKSB7CiAgICBub2RlLmFwcGVuZENoaWxkKGNoaWxkKTsKICB9CgogIGZ1bmN0aW9uIHBhcmVudE5vZGUgKG5vZGUpIHsKICAgIHJldHVybiBub2RlLnBhcmVudE5vZGUKICB9CgogIGZ1bmN0aW9uIG5leHRTaWJsaW5nIChub2RlKSB7CiAgICByZXR1cm4gbm9kZS5uZXh0U2libGluZwogIH0KCiAgZnVuY3Rpb24gdGFnTmFtZSAobm9kZSkgewogICAgcmV0dXJuIG5vZGUudGFnTmFtZQogIH0KCiAgZnVuY3Rpb24gc2V0VGV4dENvbnRlbnQgKG5vZGUsIHRleHQpIHsKICAgIG5vZGUudGV4dENvbnRlbnQgPSB0ZXh0OwogIH0KCiAgZnVuY3Rpb24gc2V0U3R5bGVTY29wZSAobm9kZSwgc2NvcGVJZCkgewogICAgbm9kZS5zZXRBdHRyaWJ1dGUoc2NvcGVJZCwgJycpOwogIH0KCiAgdmFyIG5vZGVPcHMgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CiAgICBjcmVhdGVFbGVtZW50OiBjcmVhdGVFbGVtZW50JDEsCiAgICBjcmVhdGVFbGVtZW50TlM6IGNyZWF0ZUVsZW1lbnROUywKICAgIGNyZWF0ZVRleHROb2RlOiBjcmVhdGVUZXh0Tm9kZSwKICAgIGNyZWF0ZUNvbW1lbnQ6IGNyZWF0ZUNvbW1lbnQsCiAgICBpbnNlcnRCZWZvcmU6IGluc2VydEJlZm9yZSwKICAgIHJlbW92ZUNoaWxkOiByZW1vdmVDaGlsZCwKICAgIGFwcGVuZENoaWxkOiBhcHBlbmRDaGlsZCwKICAgIHBhcmVudE5vZGU6IHBhcmVudE5vZGUsCiAgICBuZXh0U2libGluZzogbmV4dFNpYmxpbmcsCiAgICB0YWdOYW1lOiB0YWdOYW1lLAogICAgc2V0VGV4dENvbnRlbnQ6IHNldFRleHRDb250ZW50LAogICAgc2V0U3R5bGVTY29wZTogc2V0U3R5bGVTY29wZQogIH0pOwoKICAvKiAgKi8KCiAgdmFyIHJlZiA9IHsKICAgIGNyZWF0ZTogZnVuY3Rpb24gY3JlYXRlIChfLCB2bm9kZSkgewogICAgICByZWdpc3RlclJlZih2bm9kZSk7CiAgICB9LAogICAgdXBkYXRlOiBmdW5jdGlvbiB1cGRhdGUgKG9sZFZub2RlLCB2bm9kZSkgewogICAgICBpZiAob2xkVm5vZGUuZGF0YS5yZWYgIT09IHZub2RlLmRhdGEucmVmKSB7CiAgICAgICAgcmVnaXN0ZXJSZWYob2xkVm5vZGUsIHRydWUpOwogICAgICAgIHJlZ2lzdGVyUmVmKHZub2RlKTsKICAgICAgfQogICAgfSwKICAgIGRlc3Ryb3k6IGZ1bmN0aW9uIGRlc3Ryb3kgKHZub2RlKSB7CiAgICAgIHJlZ2lzdGVyUmVmKHZub2RlLCB0cnVlKTsKICAgIH0KICB9OwoKICBmdW5jdGlvbiByZWdpc3RlclJlZiAodm5vZGUsIGlzUmVtb3ZhbCkgewogICAgdmFyIGtleSA9IHZub2RlLmRhdGEucmVmOwogICAgaWYgKCFpc0RlZihrZXkpKSB7IHJldHVybiB9CgogICAgdmFyIHZtID0gdm5vZGUuY29udGV4dDsKICAgIHZhciByZWYgPSB2bm9kZS5jb21wb25lbnRJbnN0YW5jZSB8fCB2bm9kZS5lbG07CiAgICB2YXIgcmVmcyA9IHZtLiRyZWZzOwogICAgaWYgKGlzUmVtb3ZhbCkgewogICAgICBpZiAoQXJyYXkuaXNBcnJheShyZWZzW2tleV0pKSB7CiAgICAgICAgcmVtb3ZlKHJlZnNba2V5XSwgcmVmKTsKICAgICAgfSBlbHNlIGlmIChyZWZzW2tleV0gPT09IHJlZikgewogICAgICAgIHJlZnNba2V5XSA9IHVuZGVmaW5lZDsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgaWYgKHZub2RlLmRhdGEucmVmSW5Gb3IpIHsKICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkocmVmc1trZXldKSkgewogICAgICAgICAgcmVmc1trZXldID0gW3JlZl07CiAgICAgICAgfSBlbHNlIGlmIChyZWZzW2tleV0uaW5kZXhPZihyZWYpIDwgMCkgewogICAgICAgICAgLy8gJGZsb3ctZGlzYWJsZS1saW5lCiAgICAgICAgICByZWZzW2tleV0ucHVzaChyZWYpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICByZWZzW2tleV0gPSByZWY7CiAgICAgIH0KICAgIH0KICB9CgogIC8qKgogICAqIFZpcnR1YWwgRE9NIHBhdGNoaW5nIGFsZ29yaXRobSBiYXNlZCBvbiBTbmFiYmRvbSBieQogICAqIFNpbW9uIEZyaWlzIFZpbmR1bSAoQHBhbGRlcGluZCkKICAgKiBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UKICAgKiBodHRwczovL2dpdGh1Yi5jb20vcGFsZGVwaW5kL3NuYWJiZG9tL2Jsb2IvbWFzdGVyL0xJQ0VOU0UKICAgKgogICAqIG1vZGlmaWVkIGJ5IEV2YW4gWW91IChAeXl4OTkwODAzKQogICAqCiAgICogTm90IHR5cGUtY2hlY2tpbmcgdGhpcyBiZWNhdXNlIHRoaXMgZmlsZSBpcyBwZXJmLWNyaXRpY2FsIGFuZCB0aGUgY29zdAogICAqIG9mIG1ha2luZyBmbG93IHVuZGVyc3RhbmQgaXQgaXMgbm90IHdvcnRoIGl0LgogICAqLwoKICB2YXIgZW1wdHlOb2RlID0gbmV3IFZOb2RlKCcnLCB7fSwgW10pOwoKICB2YXIgaG9va3MgPSBbJ2NyZWF0ZScsICdhY3RpdmF0ZScsICd1cGRhdGUnLCAncmVtb3ZlJywgJ2Rlc3Ryb3knXTsKCiAgZnVuY3Rpb24gc2FtZVZub2RlIChhLCBiKSB7CiAgICByZXR1cm4gKAogICAgICBhLmtleSA9PT0gYi5rZXkgJiYgKAogICAgICAgICgKICAgICAgICAgIGEudGFnID09PSBiLnRhZyAmJgogICAgICAgICAgYS5pc0NvbW1lbnQgPT09IGIuaXNDb21tZW50ICYmCiAgICAgICAgICBpc0RlZihhLmRhdGEpID09PSBpc0RlZihiLmRhdGEpICYmCiAgICAgICAgICBzYW1lSW5wdXRUeXBlKGEsIGIpCiAgICAgICAgKSB8fCAoCiAgICAgICAgICBpc1RydWUoYS5pc0FzeW5jUGxhY2Vob2xkZXIpICYmCiAgICAgICAgICBhLmFzeW5jRmFjdG9yeSA9PT0gYi5hc3luY0ZhY3RvcnkgJiYKICAgICAgICAgIGlzVW5kZWYoYi5hc3luY0ZhY3RvcnkuZXJyb3IpCiAgICAgICAgKQogICAgICApCiAgICApCiAgfQoKICBmdW5jdGlvbiBzYW1lSW5wdXRUeXBlIChhLCBiKSB7CiAgICBpZiAoYS50YWcgIT09ICdpbnB1dCcpIHsgcmV0dXJuIHRydWUgfQogICAgdmFyIGk7CiAgICB2YXIgdHlwZUEgPSBpc0RlZihpID0gYS5kYXRhKSAmJiBpc0RlZihpID0gaS5hdHRycykgJiYgaS50eXBlOwogICAgdmFyIHR5cGVCID0gaXNEZWYoaSA9IGIuZGF0YSkgJiYgaXNEZWYoaSA9IGkuYXR0cnMpICYmIGkudHlwZTsKICAgIHJldHVybiB0eXBlQSA9PT0gdHlwZUIgfHwgaXNUZXh0SW5wdXRUeXBlKHR5cGVBKSAmJiBpc1RleHRJbnB1dFR5cGUodHlwZUIpCiAgfQoKICBmdW5jdGlvbiBjcmVhdGVLZXlUb09sZElkeCAoY2hpbGRyZW4sIGJlZ2luSWR4LCBlbmRJZHgpIHsKICAgIHZhciBpLCBrZXk7CiAgICB2YXIgbWFwID0ge307CiAgICBmb3IgKGkgPSBiZWdpbklkeDsgaSA8PSBlbmRJZHg7ICsraSkgewogICAgICBrZXkgPSBjaGlsZHJlbltpXS5rZXk7CiAgICAgIGlmIChpc0RlZihrZXkpKSB7IG1hcFtrZXldID0gaTsgfQogICAgfQogICAgcmV0dXJuIG1hcAogIH0KCiAgZnVuY3Rpb24gY3JlYXRlUGF0Y2hGdW5jdGlvbiAoYmFja2VuZCkgewogICAgdmFyIGksIGo7CiAgICB2YXIgY2JzID0ge307CgogICAgdmFyIG1vZHVsZXMgPSBiYWNrZW5kLm1vZHVsZXM7CiAgICB2YXIgbm9kZU9wcyA9IGJhY2tlbmQubm9kZU9wczsKCiAgICBmb3IgKGkgPSAwOyBpIDwgaG9va3MubGVuZ3RoOyArK2kpIHsKICAgICAgY2JzW2hvb2tzW2ldXSA9IFtdOwogICAgICBmb3IgKGogPSAwOyBqIDwgbW9kdWxlcy5sZW5ndGg7ICsraikgewogICAgICAgIGlmIChpc0RlZihtb2R1bGVzW2pdW2hvb2tzW2ldXSkpIHsKICAgICAgICAgIGNic1tob29rc1tpXV0ucHVzaChtb2R1bGVzW2pdW2hvb2tzW2ldXSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gZW1wdHlOb2RlQXQgKGVsbSkgewogICAgICByZXR1cm4gbmV3IFZOb2RlKG5vZGVPcHMudGFnTmFtZShlbG0pLnRvTG93ZXJDYXNlKCksIHt9LCBbXSwgdW5kZWZpbmVkLCBlbG0pCiAgICB9CgogICAgZnVuY3Rpb24gY3JlYXRlUm1DYiAoY2hpbGRFbG0sIGxpc3RlbmVycykgewogICAgICBmdW5jdGlvbiByZW1vdmUkJDEgKCkgewogICAgICAgIGlmICgtLXJlbW92ZSQkMS5saXN0ZW5lcnMgPT09IDApIHsKICAgICAgICAgIHJlbW92ZU5vZGUoY2hpbGRFbG0pOwogICAgICAgIH0KICAgICAgfQogICAgICByZW1vdmUkJDEubGlzdGVuZXJzID0gbGlzdGVuZXJzOwogICAgICByZXR1cm4gcmVtb3ZlJCQxCiAgICB9CgogICAgZnVuY3Rpb24gcmVtb3ZlTm9kZSAoZWwpIHsKICAgICAgdmFyIHBhcmVudCA9IG5vZGVPcHMucGFyZW50Tm9kZShlbCk7CiAgICAgIC8vIGVsZW1lbnQgbWF5IGhhdmUgYWxyZWFkeSBiZWVuIHJlbW92ZWQgZHVlIHRvIHYtaHRtbCAvIHYtdGV4dAogICAgICBpZiAoaXNEZWYocGFyZW50KSkgewogICAgICAgIG5vZGVPcHMucmVtb3ZlQ2hpbGQocGFyZW50LCBlbCk7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBpc1Vua25vd25FbGVtZW50JCQxICh2bm9kZSwgaW5WUHJlKSB7CiAgICAgIHJldHVybiAoCiAgICAgICAgIWluVlByZSAmJgogICAgICAgICF2bm9kZS5ucyAmJgogICAgICAgICEoCiAgICAgICAgICBjb25maWcuaWdub3JlZEVsZW1lbnRzLmxlbmd0aCAmJgogICAgICAgICAgY29uZmlnLmlnbm9yZWRFbGVtZW50cy5zb21lKGZ1bmN0aW9uIChpZ25vcmUpIHsKICAgICAgICAgICAgcmV0dXJuIGlzUmVnRXhwKGlnbm9yZSkKICAgICAgICAgICAgICA/IGlnbm9yZS50ZXN0KHZub2RlLnRhZykKICAgICAgICAgICAgICA6IGlnbm9yZSA9PT0gdm5vZGUudGFnCiAgICAgICAgICB9KQogICAgICAgICkgJiYKICAgICAgICBjb25maWcuaXNVbmtub3duRWxlbWVudCh2bm9kZS50YWcpCiAgICAgICkKICAgIH0KCiAgICB2YXIgY3JlYXRpbmdFbG1JblZQcmUgPSAwOwoKICAgIGZ1bmN0aW9uIGNyZWF0ZUVsbSAoCiAgICAgIHZub2RlLAogICAgICBpbnNlcnRlZFZub2RlUXVldWUsCiAgICAgIHBhcmVudEVsbSwKICAgICAgcmVmRWxtLAogICAgICBuZXN0ZWQsCiAgICAgIG93bmVyQXJyYXksCiAgICAgIGluZGV4CiAgICApIHsKICAgICAgaWYgKGlzRGVmKHZub2RlLmVsbSkgJiYgaXNEZWYob3duZXJBcnJheSkpIHsKICAgICAgICAvLyBUaGlzIHZub2RlIHdhcyB1c2VkIGluIGEgcHJldmlvdXMgcmVuZGVyIQogICAgICAgIC8vIG5vdyBpdCdzIHVzZWQgYXMgYSBuZXcgbm9kZSwgb3ZlcndyaXRpbmcgaXRzIGVsbSB3b3VsZCBjYXVzZQogICAgICAgIC8vIHBvdGVudGlhbCBwYXRjaCBlcnJvcnMgZG93biB0aGUgcm9hZCB3aGVuIGl0J3MgdXNlZCBhcyBhbiBpbnNlcnRpb24KICAgICAgICAvLyByZWZlcmVuY2Ugbm9kZS4gSW5zdGVhZCwgd2UgY2xvbmUgdGhlIG5vZGUgb24tZGVtYW5kIGJlZm9yZSBjcmVhdGluZwogICAgICAgIC8vIGFzc29jaWF0ZWQgRE9NIGVsZW1lbnQgZm9yIGl0LgogICAgICAgIHZub2RlID0gb3duZXJBcnJheVtpbmRleF0gPSBjbG9uZVZOb2RlKHZub2RlKTsKICAgICAgfQoKICAgICAgdm5vZGUuaXNSb290SW5zZXJ0ID0gIW5lc3RlZDsgLy8gZm9yIHRyYW5zaXRpb24gZW50ZXIgY2hlY2sKICAgICAgaWYgKGNyZWF0ZUNvbXBvbmVudCh2bm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlLCBwYXJlbnRFbG0sIHJlZkVsbSkpIHsKICAgICAgICByZXR1cm4KICAgICAgfQoKICAgICAgdmFyIGRhdGEgPSB2bm9kZS5kYXRhOwogICAgICB2YXIgY2hpbGRyZW4gPSB2bm9kZS5jaGlsZHJlbjsKICAgICAgdmFyIHRhZyA9IHZub2RlLnRhZzsKICAgICAgaWYgKGlzRGVmKHRhZykpIHsKICAgICAgICB7CiAgICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLnByZSkgewogICAgICAgICAgICBjcmVhdGluZ0VsbUluVlByZSsrOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGlzVW5rbm93bkVsZW1lbnQkJDEodm5vZGUsIGNyZWF0aW5nRWxtSW5WUHJlKSkgewogICAgICAgICAgICB3YXJuKAogICAgICAgICAgICAgICdVbmtub3duIGN1c3RvbSBlbGVtZW50OiA8JyArIHRhZyArICc+IC0gZGlkIHlvdSAnICsKICAgICAgICAgICAgICAncmVnaXN0ZXIgdGhlIGNvbXBvbmVudCBjb3JyZWN0bHk/IEZvciByZWN1cnNpdmUgY29tcG9uZW50cywgJyArCiAgICAgICAgICAgICAgJ21ha2Ugc3VyZSB0byBwcm92aWRlIHRoZSAibmFtZSIgb3B0aW9uLicsCiAgICAgICAgICAgICAgdm5vZGUuY29udGV4dAogICAgICAgICAgICApOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdm5vZGUuZWxtID0gdm5vZGUubnMKICAgICAgICAgID8gbm9kZU9wcy5jcmVhdGVFbGVtZW50TlModm5vZGUubnMsIHRhZykKICAgICAgICAgIDogbm9kZU9wcy5jcmVhdGVFbGVtZW50KHRhZywgdm5vZGUpOwogICAgICAgIHNldFNjb3BlKHZub2RlKTsKCiAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICAgICAgewogICAgICAgICAgY3JlYXRlQ2hpbGRyZW4odm5vZGUsIGNoaWxkcmVuLCBpbnNlcnRlZFZub2RlUXVldWUpOwogICAgICAgICAgaWYgKGlzRGVmKGRhdGEpKSB7CiAgICAgICAgICAgIGludm9rZUNyZWF0ZUhvb2tzKHZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUpOwogICAgICAgICAgfQogICAgICAgICAgaW5zZXJ0KHBhcmVudEVsbSwgdm5vZGUuZWxtLCByZWZFbG0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5wcmUpIHsKICAgICAgICAgIGNyZWF0aW5nRWxtSW5WUHJlLS07CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGlzVHJ1ZSh2bm9kZS5pc0NvbW1lbnQpKSB7CiAgICAgICAgdm5vZGUuZWxtID0gbm9kZU9wcy5jcmVhdGVDb21tZW50KHZub2RlLnRleHQpOwogICAgICAgIGluc2VydChwYXJlbnRFbG0sIHZub2RlLmVsbSwgcmVmRWxtKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2bm9kZS5lbG0gPSBub2RlT3BzLmNyZWF0ZVRleHROb2RlKHZub2RlLnRleHQpOwogICAgICAgIGluc2VydChwYXJlbnRFbG0sIHZub2RlLmVsbSwgcmVmRWxtKTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGNyZWF0ZUNvbXBvbmVudCAodm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSwgcGFyZW50RWxtLCByZWZFbG0pIHsKICAgICAgdmFyIGkgPSB2bm9kZS5kYXRhOwogICAgICBpZiAoaXNEZWYoaSkpIHsKICAgICAgICB2YXIgaXNSZWFjdGl2YXRlZCA9IGlzRGVmKHZub2RlLmNvbXBvbmVudEluc3RhbmNlKSAmJiBpLmtlZXBBbGl2ZTsKICAgICAgICBpZiAoaXNEZWYoaSA9IGkuaG9vaykgJiYgaXNEZWYoaSA9IGkuaW5pdCkpIHsKICAgICAgICAgIGkodm5vZGUsIGZhbHNlIC8qIGh5ZHJhdGluZyAqLyk7CiAgICAgICAgfQogICAgICAgIC8vIGFmdGVyIGNhbGxpbmcgdGhlIGluaXQgaG9vaywgaWYgdGhlIHZub2RlIGlzIGEgY2hpbGQgY29tcG9uZW50CiAgICAgICAgLy8gaXQgc2hvdWxkJ3ZlIGNyZWF0ZWQgYSBjaGlsZCBpbnN0YW5jZSBhbmQgbW91bnRlZCBpdC4gdGhlIGNoaWxkCiAgICAgICAgLy8gY29tcG9uZW50IGFsc28gaGFzIHNldCB0aGUgcGxhY2Vob2xkZXIgdm5vZGUncyBlbG0uCiAgICAgICAgLy8gaW4gdGhhdCBjYXNlIHdlIGNhbiBqdXN0IHJldHVybiB0aGUgZWxlbWVudCBhbmQgYmUgZG9uZS4KICAgICAgICBpZiAoaXNEZWYodm5vZGUuY29tcG9uZW50SW5zdGFuY2UpKSB7CiAgICAgICAgICBpbml0Q29tcG9uZW50KHZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUpOwogICAgICAgICAgaW5zZXJ0KHBhcmVudEVsbSwgdm5vZGUuZWxtLCByZWZFbG0pOwogICAgICAgICAgaWYgKGlzVHJ1ZShpc1JlYWN0aXZhdGVkKSkgewogICAgICAgICAgICByZWFjdGl2YXRlQ29tcG9uZW50KHZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUsIHBhcmVudEVsbSwgcmVmRWxtKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gaW5pdENvbXBvbmVudCAodm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSkgewogICAgICBpZiAoaXNEZWYodm5vZGUuZGF0YS5wZW5kaW5nSW5zZXJ0KSkgewogICAgICAgIGluc2VydGVkVm5vZGVRdWV1ZS5wdXNoLmFwcGx5KGluc2VydGVkVm5vZGVRdWV1ZSwgdm5vZGUuZGF0YS5wZW5kaW5nSW5zZXJ0KTsKICAgICAgICB2bm9kZS5kYXRhLnBlbmRpbmdJbnNlcnQgPSBudWxsOwogICAgICB9CiAgICAgIHZub2RlLmVsbSA9IHZub2RlLmNvbXBvbmVudEluc3RhbmNlLiRlbDsKICAgICAgaWYgKGlzUGF0Y2hhYmxlKHZub2RlKSkgewogICAgICAgIGludm9rZUNyZWF0ZUhvb2tzKHZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUpOwogICAgICAgIHNldFNjb3BlKHZub2RlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBlbXB0eSBjb21wb25lbnQgcm9vdC4KICAgICAgICAvLyBza2lwIGFsbCBlbGVtZW50LXJlbGF0ZWQgbW9kdWxlcyBleGNlcHQgZm9yIHJlZiAoIzM0NTUpCiAgICAgICAgcmVnaXN0ZXJSZWYodm5vZGUpOwogICAgICAgIC8vIG1ha2Ugc3VyZSB0byBpbnZva2UgdGhlIGluc2VydCBob29rCiAgICAgICAgaW5zZXJ0ZWRWbm9kZVF1ZXVlLnB1c2godm5vZGUpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcmVhY3RpdmF0ZUNvbXBvbmVudCAodm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSwgcGFyZW50RWxtLCByZWZFbG0pIHsKICAgICAgdmFyIGk7CiAgICAgIC8vIGhhY2sgZm9yICM0MzM5OiBhIHJlYWN0aXZhdGVkIGNvbXBvbmVudCB3aXRoIGlubmVyIHRyYW5zaXRpb24KICAgICAgLy8gZG9lcyBub3QgdHJpZ2dlciBiZWNhdXNlIHRoZSBpbm5lciBub2RlJ3MgY3JlYXRlZCBob29rcyBhcmUgbm90IGNhbGxlZAogICAgICAvLyBhZ2Fpbi4gSXQncyBub3QgaWRlYWwgdG8gaW52b2x2ZSBtb2R1bGUtc3BlY2lmaWMgbG9naWMgaW4gaGVyZSBidXQKICAgICAgLy8gdGhlcmUgZG9lc24ndCBzZWVtIHRvIGJlIGEgYmV0dGVyIHdheSB0byBkbyBpdC4KICAgICAgdmFyIGlubmVyTm9kZSA9IHZub2RlOwogICAgICB3aGlsZSAoaW5uZXJOb2RlLmNvbXBvbmVudEluc3RhbmNlKSB7CiAgICAgICAgaW5uZXJOb2RlID0gaW5uZXJOb2RlLmNvbXBvbmVudEluc3RhbmNlLl92bm9kZTsKICAgICAgICBpZiAoaXNEZWYoaSA9IGlubmVyTm9kZS5kYXRhKSAmJiBpc0RlZihpID0gaS50cmFuc2l0aW9uKSkgewogICAgICAgICAgZm9yIChpID0gMDsgaSA8IGNicy5hY3RpdmF0ZS5sZW5ndGg7ICsraSkgewogICAgICAgICAgICBjYnMuYWN0aXZhdGVbaV0oZW1wdHlOb2RlLCBpbm5lck5vZGUpOwogICAgICAgICAgfQogICAgICAgICAgaW5zZXJ0ZWRWbm9kZVF1ZXVlLnB1c2goaW5uZXJOb2RlKTsKICAgICAgICAgIGJyZWFrCiAgICAgICAgfQogICAgICB9CiAgICAgIC8vIHVubGlrZSBhIG5ld2x5IGNyZWF0ZWQgY29tcG9uZW50LAogICAgICAvLyBhIHJlYWN0aXZhdGVkIGtlZXAtYWxpdmUgY29tcG9uZW50IGRvZXNuJ3QgaW5zZXJ0IGl0c2VsZgogICAgICBpbnNlcnQocGFyZW50RWxtLCB2bm9kZS5lbG0sIHJlZkVsbSk7CiAgICB9CgogICAgZnVuY3Rpb24gaW5zZXJ0IChwYXJlbnQsIGVsbSwgcmVmJCQxKSB7CiAgICAgIGlmIChpc0RlZihwYXJlbnQpKSB7CiAgICAgICAgaWYgKGlzRGVmKHJlZiQkMSkpIHsKICAgICAgICAgIGlmIChub2RlT3BzLnBhcmVudE5vZGUocmVmJCQxKSA9PT0gcGFyZW50KSB7CiAgICAgICAgICAgIG5vZGVPcHMuaW5zZXJ0QmVmb3JlKHBhcmVudCwgZWxtLCByZWYkJDEpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBub2RlT3BzLmFwcGVuZENoaWxkKHBhcmVudCwgZWxtKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBjcmVhdGVDaGlsZHJlbiAodm5vZGUsIGNoaWxkcmVuLCBpbnNlcnRlZFZub2RlUXVldWUpIHsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY2hpbGRyZW4pKSB7CiAgICAgICAgewogICAgICAgICAgY2hlY2tEdXBsaWNhdGVLZXlzKGNoaWxkcmVuKTsKICAgICAgICB9CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7ICsraSkgewogICAgICAgICAgY3JlYXRlRWxtKGNoaWxkcmVuW2ldLCBpbnNlcnRlZFZub2RlUXVldWUsIHZub2RlLmVsbSwgbnVsbCwgdHJ1ZSwgY2hpbGRyZW4sIGkpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChpc1ByaW1pdGl2ZSh2bm9kZS50ZXh0KSkgewogICAgICAgIG5vZGVPcHMuYXBwZW5kQ2hpbGQodm5vZGUuZWxtLCBub2RlT3BzLmNyZWF0ZVRleHROb2RlKFN0cmluZyh2bm9kZS50ZXh0KSkpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gaXNQYXRjaGFibGUgKHZub2RlKSB7CiAgICAgIHdoaWxlICh2bm9kZS5jb21wb25lbnRJbnN0YW5jZSkgewogICAgICAgIHZub2RlID0gdm5vZGUuY29tcG9uZW50SW5zdGFuY2UuX3Zub2RlOwogICAgICB9CiAgICAgIHJldHVybiBpc0RlZih2bm9kZS50YWcpCiAgICB9CgogICAgZnVuY3Rpb24gaW52b2tlQ3JlYXRlSG9va3MgKHZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUpIHsKICAgICAgZm9yICh2YXIgaSQxID0gMDsgaSQxIDwgY2JzLmNyZWF0ZS5sZW5ndGg7ICsraSQxKSB7CiAgICAgICAgY2JzLmNyZWF0ZVtpJDFdKGVtcHR5Tm9kZSwgdm5vZGUpOwogICAgICB9CiAgICAgIGkgPSB2bm9kZS5kYXRhLmhvb2s7IC8vIFJldXNlIHZhcmlhYmxlCiAgICAgIGlmIChpc0RlZihpKSkgewogICAgICAgIGlmIChpc0RlZihpLmNyZWF0ZSkpIHsgaS5jcmVhdGUoZW1wdHlOb2RlLCB2bm9kZSk7IH0KICAgICAgICBpZiAoaXNEZWYoaS5pbnNlcnQpKSB7IGluc2VydGVkVm5vZGVRdWV1ZS5wdXNoKHZub2RlKTsgfQogICAgICB9CiAgICB9CgogICAgLy8gc2V0IHNjb3BlIGlkIGF0dHJpYnV0ZSBmb3Igc2NvcGVkIENTUy4KICAgIC8vIHRoaXMgaXMgaW1wbGVtZW50ZWQgYXMgYSBzcGVjaWFsIGNhc2UgdG8gYXZvaWQgdGhlIG92ZXJoZWFkCiAgICAvLyBvZiBnb2luZyB0aHJvdWdoIHRoZSBub3JtYWwgYXR0cmlidXRlIHBhdGNoaW5nIHByb2Nlc3MuCiAgICBmdW5jdGlvbiBzZXRTY29wZSAodm5vZGUpIHsKICAgICAgdmFyIGk7CiAgICAgIGlmIChpc0RlZihpID0gdm5vZGUuZm5TY29wZUlkKSkgewogICAgICAgIG5vZGVPcHMuc2V0U3R5bGVTY29wZSh2bm9kZS5lbG0sIGkpOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBhbmNlc3RvciA9IHZub2RlOwogICAgICAgIHdoaWxlIChhbmNlc3RvcikgewogICAgICAgICAgaWYgKGlzRGVmKGkgPSBhbmNlc3Rvci5jb250ZXh0KSAmJiBpc0RlZihpID0gaS4kb3B0aW9ucy5fc2NvcGVJZCkpIHsKICAgICAgICAgICAgbm9kZU9wcy5zZXRTdHlsZVNjb3BlKHZub2RlLmVsbSwgaSk7CiAgICAgICAgICB9CiAgICAgICAgICBhbmNlc3RvciA9IGFuY2VzdG9yLnBhcmVudDsKICAgICAgICB9CiAgICAgIH0KICAgICAgLy8gZm9yIHNsb3QgY29udGVudCB0aGV5IHNob3VsZCBhbHNvIGdldCB0aGUgc2NvcGVJZCBmcm9tIHRoZSBob3N0IGluc3RhbmNlLgogICAgICBpZiAoaXNEZWYoaSA9IGFjdGl2ZUluc3RhbmNlKSAmJgogICAgICAgIGkgIT09IHZub2RlLmNvbnRleHQgJiYKICAgICAgICBpICE9PSB2bm9kZS5mbkNvbnRleHQgJiYKICAgICAgICBpc0RlZihpID0gaS4kb3B0aW9ucy5fc2NvcGVJZCkKICAgICAgKSB7CiAgICAgICAgbm9kZU9wcy5zZXRTdHlsZVNjb3BlKHZub2RlLmVsbSwgaSk7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBhZGRWbm9kZXMgKHBhcmVudEVsbSwgcmVmRWxtLCB2bm9kZXMsIHN0YXJ0SWR4LCBlbmRJZHgsIGluc2VydGVkVm5vZGVRdWV1ZSkgewogICAgICBmb3IgKDsgc3RhcnRJZHggPD0gZW5kSWR4OyArK3N0YXJ0SWR4KSB7CiAgICAgICAgY3JlYXRlRWxtKHZub2Rlc1tzdGFydElkeF0sIGluc2VydGVkVm5vZGVRdWV1ZSwgcGFyZW50RWxtLCByZWZFbG0sIGZhbHNlLCB2bm9kZXMsIHN0YXJ0SWR4KTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGludm9rZURlc3Ryb3lIb29rICh2bm9kZSkgewogICAgICB2YXIgaSwgajsKICAgICAgdmFyIGRhdGEgPSB2bm9kZS5kYXRhOwogICAgICBpZiAoaXNEZWYoZGF0YSkpIHsKICAgICAgICBpZiAoaXNEZWYoaSA9IGRhdGEuaG9vaykgJiYgaXNEZWYoaSA9IGkuZGVzdHJveSkpIHsgaSh2bm9kZSk7IH0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY2JzLmRlc3Ryb3kubGVuZ3RoOyArK2kpIHsgY2JzLmRlc3Ryb3lbaV0odm5vZGUpOyB9CiAgICAgIH0KICAgICAgaWYgKGlzRGVmKGkgPSB2bm9kZS5jaGlsZHJlbikpIHsKICAgICAgICBmb3IgKGogPSAwOyBqIDwgdm5vZGUuY2hpbGRyZW4ubGVuZ3RoOyArK2opIHsKICAgICAgICAgIGludm9rZURlc3Ryb3lIb29rKHZub2RlLmNoaWxkcmVuW2pdKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiByZW1vdmVWbm9kZXMgKHBhcmVudEVsbSwgdm5vZGVzLCBzdGFydElkeCwgZW5kSWR4KSB7CiAgICAgIGZvciAoOyBzdGFydElkeCA8PSBlbmRJZHg7ICsrc3RhcnRJZHgpIHsKICAgICAgICB2YXIgY2ggPSB2bm9kZXNbc3RhcnRJZHhdOwogICAgICAgIGlmIChpc0RlZihjaCkpIHsKICAgICAgICAgIGlmIChpc0RlZihjaC50YWcpKSB7CiAgICAgICAgICAgIHJlbW92ZUFuZEludm9rZVJlbW92ZUhvb2soY2gpOwogICAgICAgICAgICBpbnZva2VEZXN0cm95SG9vayhjaCk7CiAgICAgICAgICB9IGVsc2UgeyAvLyBUZXh0IG5vZGUKICAgICAgICAgICAgcmVtb3ZlTm9kZShjaC5lbG0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHJlbW92ZUFuZEludm9rZVJlbW92ZUhvb2sgKHZub2RlLCBybSkgewogICAgICBpZiAoaXNEZWYocm0pIHx8IGlzRGVmKHZub2RlLmRhdGEpKSB7CiAgICAgICAgdmFyIGk7CiAgICAgICAgdmFyIGxpc3RlbmVycyA9IGNicy5yZW1vdmUubGVuZ3RoICsgMTsKICAgICAgICBpZiAoaXNEZWYocm0pKSB7CiAgICAgICAgICAvLyB3ZSBoYXZlIGEgcmVjdXJzaXZlbHkgcGFzc2VkIGRvd24gcm0gY2FsbGJhY2sKICAgICAgICAgIC8vIGluY3JlYXNlIHRoZSBsaXN0ZW5lcnMgY291bnQKICAgICAgICAgIHJtLmxpc3RlbmVycyArPSBsaXN0ZW5lcnM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIGRpcmVjdGx5IHJlbW92aW5nCiAgICAgICAgICBybSA9IGNyZWF0ZVJtQ2Iodm5vZGUuZWxtLCBsaXN0ZW5lcnMpOwogICAgICAgIH0KICAgICAgICAvLyByZWN1cnNpdmVseSBpbnZva2UgaG9va3Mgb24gY2hpbGQgY29tcG9uZW50IHJvb3Qgbm9kZQogICAgICAgIGlmIChpc0RlZihpID0gdm5vZGUuY29tcG9uZW50SW5zdGFuY2UpICYmIGlzRGVmKGkgPSBpLl92bm9kZSkgJiYgaXNEZWYoaS5kYXRhKSkgewogICAgICAgICAgcmVtb3ZlQW5kSW52b2tlUmVtb3ZlSG9vayhpLCBybSk7CiAgICAgICAgfQogICAgICAgIGZvciAoaSA9IDA7IGkgPCBjYnMucmVtb3ZlLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICBjYnMucmVtb3ZlW2ldKHZub2RlLCBybSk7CiAgICAgICAgfQogICAgICAgIGlmIChpc0RlZihpID0gdm5vZGUuZGF0YS5ob29rKSAmJiBpc0RlZihpID0gaS5yZW1vdmUpKSB7CiAgICAgICAgICBpKHZub2RlLCBybSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJtKCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHJlbW92ZU5vZGUodm5vZGUuZWxtKTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHVwZGF0ZUNoaWxkcmVuIChwYXJlbnRFbG0sIG9sZENoLCBuZXdDaCwgaW5zZXJ0ZWRWbm9kZVF1ZXVlLCByZW1vdmVPbmx5KSB7CiAgICAgIHZhciBvbGRTdGFydElkeCA9IDA7CiAgICAgIHZhciBuZXdTdGFydElkeCA9IDA7CiAgICAgIHZhciBvbGRFbmRJZHggPSBvbGRDaC5sZW5ndGggLSAxOwogICAgICB2YXIgb2xkU3RhcnRWbm9kZSA9IG9sZENoWzBdOwogICAgICB2YXIgb2xkRW5kVm5vZGUgPSBvbGRDaFtvbGRFbmRJZHhdOwogICAgICB2YXIgbmV3RW5kSWR4ID0gbmV3Q2gubGVuZ3RoIC0gMTsKICAgICAgdmFyIG5ld1N0YXJ0Vm5vZGUgPSBuZXdDaFswXTsKICAgICAgdmFyIG5ld0VuZFZub2RlID0gbmV3Q2hbbmV3RW5kSWR4XTsKICAgICAgdmFyIG9sZEtleVRvSWR4LCBpZHhJbk9sZCwgdm5vZGVUb01vdmUsIHJlZkVsbTsKCiAgICAgIC8vIHJlbW92ZU9ubHkgaXMgYSBzcGVjaWFsIGZsYWcgdXNlZCBvbmx5IGJ5IDx0cmFuc2l0aW9uLWdyb3VwPgogICAgICAvLyB0byBlbnN1cmUgcmVtb3ZlZCBlbGVtZW50cyBzdGF5IGluIGNvcnJlY3QgcmVsYXRpdmUgcG9zaXRpb25zCiAgICAgIC8vIGR1cmluZyBsZWF2aW5nIHRyYW5zaXRpb25zCiAgICAgIHZhciBjYW5Nb3ZlID0gIXJlbW92ZU9ubHk7CgogICAgICB7CiAgICAgICAgY2hlY2tEdXBsaWNhdGVLZXlzKG5ld0NoKTsKICAgICAgfQoKICAgICAgd2hpbGUgKG9sZFN0YXJ0SWR4IDw9IG9sZEVuZElkeCAmJiBuZXdTdGFydElkeCA8PSBuZXdFbmRJZHgpIHsKICAgICAgICBpZiAoaXNVbmRlZihvbGRTdGFydFZub2RlKSkgewogICAgICAgICAgb2xkU3RhcnRWbm9kZSA9IG9sZENoWysrb2xkU3RhcnRJZHhdOyAvLyBWbm9kZSBoYXMgYmVlbiBtb3ZlZCBsZWZ0CiAgICAgICAgfSBlbHNlIGlmIChpc1VuZGVmKG9sZEVuZFZub2RlKSkgewogICAgICAgICAgb2xkRW5kVm5vZGUgPSBvbGRDaFstLW9sZEVuZElkeF07CiAgICAgICAgfSBlbHNlIGlmIChzYW1lVm5vZGUob2xkU3RhcnRWbm9kZSwgbmV3U3RhcnRWbm9kZSkpIHsKICAgICAgICAgIHBhdGNoVm5vZGUob2xkU3RhcnRWbm9kZSwgbmV3U3RhcnRWbm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlLCBuZXdDaCwgbmV3U3RhcnRJZHgpOwogICAgICAgICAgb2xkU3RhcnRWbm9kZSA9IG9sZENoWysrb2xkU3RhcnRJZHhdOwogICAgICAgICAgbmV3U3RhcnRWbm9kZSA9IG5ld0NoWysrbmV3U3RhcnRJZHhdOwogICAgICAgIH0gZWxzZSBpZiAoc2FtZVZub2RlKG9sZEVuZFZub2RlLCBuZXdFbmRWbm9kZSkpIHsKICAgICAgICAgIHBhdGNoVm5vZGUob2xkRW5kVm5vZGUsIG5ld0VuZFZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUsIG5ld0NoLCBuZXdFbmRJZHgpOwogICAgICAgICAgb2xkRW5kVm5vZGUgPSBvbGRDaFstLW9sZEVuZElkeF07CiAgICAgICAgICBuZXdFbmRWbm9kZSA9IG5ld0NoWy0tbmV3RW5kSWR4XTsKICAgICAgICB9IGVsc2UgaWYgKHNhbWVWbm9kZShvbGRTdGFydFZub2RlLCBuZXdFbmRWbm9kZSkpIHsgLy8gVm5vZGUgbW92ZWQgcmlnaHQKICAgICAgICAgIHBhdGNoVm5vZGUob2xkU3RhcnRWbm9kZSwgbmV3RW5kVm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSwgbmV3Q2gsIG5ld0VuZElkeCk7CiAgICAgICAgICBjYW5Nb3ZlICYmIG5vZGVPcHMuaW5zZXJ0QmVmb3JlKHBhcmVudEVsbSwgb2xkU3RhcnRWbm9kZS5lbG0sIG5vZGVPcHMubmV4dFNpYmxpbmcob2xkRW5kVm5vZGUuZWxtKSk7CiAgICAgICAgICBvbGRTdGFydFZub2RlID0gb2xkQ2hbKytvbGRTdGFydElkeF07CiAgICAgICAgICBuZXdFbmRWbm9kZSA9IG5ld0NoWy0tbmV3RW5kSWR4XTsKICAgICAgICB9IGVsc2UgaWYgKHNhbWVWbm9kZShvbGRFbmRWbm9kZSwgbmV3U3RhcnRWbm9kZSkpIHsgLy8gVm5vZGUgbW92ZWQgbGVmdAogICAgICAgICAgcGF0Y2hWbm9kZShvbGRFbmRWbm9kZSwgbmV3U3RhcnRWbm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlLCBuZXdDaCwgbmV3U3RhcnRJZHgpOwogICAgICAgICAgY2FuTW92ZSAmJiBub2RlT3BzLmluc2VydEJlZm9yZShwYXJlbnRFbG0sIG9sZEVuZFZub2RlLmVsbSwgb2xkU3RhcnRWbm9kZS5lbG0pOwogICAgICAgICAgb2xkRW5kVm5vZGUgPSBvbGRDaFstLW9sZEVuZElkeF07CiAgICAgICAgICBuZXdTdGFydFZub2RlID0gbmV3Q2hbKytuZXdTdGFydElkeF07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChpc1VuZGVmKG9sZEtleVRvSWR4KSkgeyBvbGRLZXlUb0lkeCA9IGNyZWF0ZUtleVRvT2xkSWR4KG9sZENoLCBvbGRTdGFydElkeCwgb2xkRW5kSWR4KTsgfQogICAgICAgICAgaWR4SW5PbGQgPSBpc0RlZihuZXdTdGFydFZub2RlLmtleSkKICAgICAgICAgICAgPyBvbGRLZXlUb0lkeFtuZXdTdGFydFZub2RlLmtleV0KICAgICAgICAgICAgOiBmaW5kSWR4SW5PbGQobmV3U3RhcnRWbm9kZSwgb2xkQ2gsIG9sZFN0YXJ0SWR4LCBvbGRFbmRJZHgpOwogICAgICAgICAgaWYgKGlzVW5kZWYoaWR4SW5PbGQpKSB7IC8vIE5ldyBlbGVtZW50CiAgICAgICAgICAgIGNyZWF0ZUVsbShuZXdTdGFydFZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUsIHBhcmVudEVsbSwgb2xkU3RhcnRWbm9kZS5lbG0sIGZhbHNlLCBuZXdDaCwgbmV3U3RhcnRJZHgpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdm5vZGVUb01vdmUgPSBvbGRDaFtpZHhJbk9sZF07CiAgICAgICAgICAgIGlmIChzYW1lVm5vZGUodm5vZGVUb01vdmUsIG5ld1N0YXJ0Vm5vZGUpKSB7CiAgICAgICAgICAgICAgcGF0Y2hWbm9kZSh2bm9kZVRvTW92ZSwgbmV3U3RhcnRWbm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlLCBuZXdDaCwgbmV3U3RhcnRJZHgpOwogICAgICAgICAgICAgIG9sZENoW2lkeEluT2xkXSA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICBjYW5Nb3ZlICYmIG5vZGVPcHMuaW5zZXJ0QmVmb3JlKHBhcmVudEVsbSwgdm5vZGVUb01vdmUuZWxtLCBvbGRTdGFydFZub2RlLmVsbSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgLy8gc2FtZSBrZXkgYnV0IGRpZmZlcmVudCBlbGVtZW50LiB0cmVhdCBhcyBuZXcgZWxlbWVudAogICAgICAgICAgICAgIGNyZWF0ZUVsbShuZXdTdGFydFZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUsIHBhcmVudEVsbSwgb2xkU3RhcnRWbm9kZS5lbG0sIGZhbHNlLCBuZXdDaCwgbmV3U3RhcnRJZHgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBuZXdTdGFydFZub2RlID0gbmV3Q2hbKytuZXdTdGFydElkeF07CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChvbGRTdGFydElkeCA+IG9sZEVuZElkeCkgewogICAgICAgIHJlZkVsbSA9IGlzVW5kZWYobmV3Q2hbbmV3RW5kSWR4ICsgMV0pID8gbnVsbCA6IG5ld0NoW25ld0VuZElkeCArIDFdLmVsbTsKICAgICAgICBhZGRWbm9kZXMocGFyZW50RWxtLCByZWZFbG0sIG5ld0NoLCBuZXdTdGFydElkeCwgbmV3RW5kSWR4LCBpbnNlcnRlZFZub2RlUXVldWUpOwogICAgICB9IGVsc2UgaWYgKG5ld1N0YXJ0SWR4ID4gbmV3RW5kSWR4KSB7CiAgICAgICAgcmVtb3ZlVm5vZGVzKHBhcmVudEVsbSwgb2xkQ2gsIG9sZFN0YXJ0SWR4LCBvbGRFbmRJZHgpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gY2hlY2tEdXBsaWNhdGVLZXlzIChjaGlsZHJlbikgewogICAgICB2YXIgc2VlbktleXMgPSB7fTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciB2bm9kZSA9IGNoaWxkcmVuW2ldOwogICAgICAgIHZhciBrZXkgPSB2bm9kZS5rZXk7CiAgICAgICAgaWYgKGlzRGVmKGtleSkpIHsKICAgICAgICAgIGlmIChzZWVuS2V5c1trZXldKSB7CiAgICAgICAgICAgIHdhcm4oCiAgICAgICAgICAgICAgKCJEdXBsaWNhdGUga2V5cyBkZXRlY3RlZDogJyIgKyBrZXkgKyAiJy4gVGhpcyBtYXkgY2F1c2UgYW4gdXBkYXRlIGVycm9yLiIpLAogICAgICAgICAgICAgIHZub2RlLmNvbnRleHQKICAgICAgICAgICAgKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHNlZW5LZXlzW2tleV0gPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGZpbmRJZHhJbk9sZCAobm9kZSwgb2xkQ2gsIHN0YXJ0LCBlbmQpIHsKICAgICAgZm9yICh2YXIgaSA9IHN0YXJ0OyBpIDwgZW5kOyBpKyspIHsKICAgICAgICB2YXIgYyA9IG9sZENoW2ldOwogICAgICAgIGlmIChpc0RlZihjKSAmJiBzYW1lVm5vZGUobm9kZSwgYykpIHsgcmV0dXJuIGkgfQogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcGF0Y2hWbm9kZSAoCiAgICAgIG9sZFZub2RlLAogICAgICB2bm9kZSwKICAgICAgaW5zZXJ0ZWRWbm9kZVF1ZXVlLAogICAgICBvd25lckFycmF5LAogICAgICBpbmRleCwKICAgICAgcmVtb3ZlT25seQogICAgKSB7CiAgICAgIGlmIChvbGRWbm9kZSA9PT0gdm5vZGUpIHsKICAgICAgICByZXR1cm4KICAgICAgfQoKICAgICAgaWYgKGlzRGVmKHZub2RlLmVsbSkgJiYgaXNEZWYob3duZXJBcnJheSkpIHsKICAgICAgICAvLyBjbG9uZSByZXVzZWQgdm5vZGUKICAgICAgICB2bm9kZSA9IG93bmVyQXJyYXlbaW5kZXhdID0gY2xvbmVWTm9kZSh2bm9kZSk7CiAgICAgIH0KCiAgICAgIHZhciBlbG0gPSB2bm9kZS5lbG0gPSBvbGRWbm9kZS5lbG07CgogICAgICBpZiAoaXNUcnVlKG9sZFZub2RlLmlzQXN5bmNQbGFjZWhvbGRlcikpIHsKICAgICAgICBpZiAoaXNEZWYodm5vZGUuYXN5bmNGYWN0b3J5LnJlc29sdmVkKSkgewogICAgICAgICAgaHlkcmF0ZShvbGRWbm9kZS5lbG0sIHZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2bm9kZS5pc0FzeW5jUGxhY2Vob2xkZXIgPSB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4KICAgICAgfQoKICAgICAgLy8gcmV1c2UgZWxlbWVudCBmb3Igc3RhdGljIHRyZWVzLgogICAgICAvLyBub3RlIHdlIG9ubHkgZG8gdGhpcyBpZiB0aGUgdm5vZGUgaXMgY2xvbmVkIC0KICAgICAgLy8gaWYgdGhlIG5ldyBub2RlIGlzIG5vdCBjbG9uZWQgaXQgbWVhbnMgdGhlIHJlbmRlciBmdW5jdGlvbnMgaGF2ZSBiZWVuCiAgICAgIC8vIHJlc2V0IGJ5IHRoZSBob3QtcmVsb2FkLWFwaSBhbmQgd2UgbmVlZCB0byBkbyBhIHByb3BlciByZS1yZW5kZXIuCiAgICAgIGlmIChpc1RydWUodm5vZGUuaXNTdGF0aWMpICYmCiAgICAgICAgaXNUcnVlKG9sZFZub2RlLmlzU3RhdGljKSAmJgogICAgICAgIHZub2RlLmtleSA9PT0gb2xkVm5vZGUua2V5ICYmCiAgICAgICAgKGlzVHJ1ZSh2bm9kZS5pc0Nsb25lZCkgfHwgaXNUcnVlKHZub2RlLmlzT25jZSkpCiAgICAgICkgewogICAgICAgIHZub2RlLmNvbXBvbmVudEluc3RhbmNlID0gb2xkVm5vZGUuY29tcG9uZW50SW5zdGFuY2U7CiAgICAgICAgcmV0dXJuCiAgICAgIH0KCiAgICAgIHZhciBpOwogICAgICB2YXIgZGF0YSA9IHZub2RlLmRhdGE7CiAgICAgIGlmIChpc0RlZihkYXRhKSAmJiBpc0RlZihpID0gZGF0YS5ob29rKSAmJiBpc0RlZihpID0gaS5wcmVwYXRjaCkpIHsKICAgICAgICBpKG9sZFZub2RlLCB2bm9kZSk7CiAgICAgIH0KCiAgICAgIHZhciBvbGRDaCA9IG9sZFZub2RlLmNoaWxkcmVuOwogICAgICB2YXIgY2ggPSB2bm9kZS5jaGlsZHJlbjsKICAgICAgaWYgKGlzRGVmKGRhdGEpICYmIGlzUGF0Y2hhYmxlKHZub2RlKSkgewogICAgICAgIGZvciAoaSA9IDA7IGkgPCBjYnMudXBkYXRlLmxlbmd0aDsgKytpKSB7IGNicy51cGRhdGVbaV0ob2xkVm5vZGUsIHZub2RlKTsgfQogICAgICAgIGlmIChpc0RlZihpID0gZGF0YS5ob29rKSAmJiBpc0RlZihpID0gaS51cGRhdGUpKSB7IGkob2xkVm5vZGUsIHZub2RlKTsgfQogICAgICB9CiAgICAgIGlmIChpc1VuZGVmKHZub2RlLnRleHQpKSB7CiAgICAgICAgaWYgKGlzRGVmKG9sZENoKSAmJiBpc0RlZihjaCkpIHsKICAgICAgICAgIGlmIChvbGRDaCAhPT0gY2gpIHsgdXBkYXRlQ2hpbGRyZW4oZWxtLCBvbGRDaCwgY2gsIGluc2VydGVkVm5vZGVRdWV1ZSwgcmVtb3ZlT25seSk7IH0KICAgICAgICB9IGVsc2UgaWYgKGlzRGVmKGNoKSkgewogICAgICAgICAgewogICAgICAgICAgICBjaGVja0R1cGxpY2F0ZUtleXMoY2gpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGlzRGVmKG9sZFZub2RlLnRleHQpKSB7IG5vZGVPcHMuc2V0VGV4dENvbnRlbnQoZWxtLCAnJyk7IH0KICAgICAgICAgIGFkZFZub2RlcyhlbG0sIG51bGwsIGNoLCAwLCBjaC5sZW5ndGggLSAxLCBpbnNlcnRlZFZub2RlUXVldWUpOwogICAgICAgIH0gZWxzZSBpZiAoaXNEZWYob2xkQ2gpKSB7CiAgICAgICAgICByZW1vdmVWbm9kZXMoZWxtLCBvbGRDaCwgMCwgb2xkQ2gubGVuZ3RoIC0gMSk7CiAgICAgICAgfSBlbHNlIGlmIChpc0RlZihvbGRWbm9kZS50ZXh0KSkgewogICAgICAgICAgbm9kZU9wcy5zZXRUZXh0Q29udGVudChlbG0sICcnKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAob2xkVm5vZGUudGV4dCAhPT0gdm5vZGUudGV4dCkgewogICAgICAgIG5vZGVPcHMuc2V0VGV4dENvbnRlbnQoZWxtLCB2bm9kZS50ZXh0KTsKICAgICAgfQogICAgICBpZiAoaXNEZWYoZGF0YSkpIHsKICAgICAgICBpZiAoaXNEZWYoaSA9IGRhdGEuaG9vaykgJiYgaXNEZWYoaSA9IGkucG9zdHBhdGNoKSkgeyBpKG9sZFZub2RlLCB2bm9kZSk7IH0KICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGludm9rZUluc2VydEhvb2sgKHZub2RlLCBxdWV1ZSwgaW5pdGlhbCkgewogICAgICAvLyBkZWxheSBpbnNlcnQgaG9va3MgZm9yIGNvbXBvbmVudCByb290IG5vZGVzLCBpbnZva2UgdGhlbSBhZnRlciB0aGUKICAgICAgLy8gZWxlbWVudCBpcyByZWFsbHkgaW5zZXJ0ZWQKICAgICAgaWYgKGlzVHJ1ZShpbml0aWFsKSAmJiBpc0RlZih2bm9kZS5wYXJlbnQpKSB7CiAgICAgICAgdm5vZGUucGFyZW50LmRhdGEucGVuZGluZ0luc2VydCA9IHF1ZXVlOwogICAgICB9IGVsc2UgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcXVldWUubGVuZ3RoOyArK2kpIHsKICAgICAgICAgIHF1ZXVlW2ldLmRhdGEuaG9vay5pbnNlcnQocXVldWVbaV0pOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHZhciBoeWRyYXRpb25CYWlsZWQgPSBmYWxzZTsKICAgIC8vIGxpc3Qgb2YgbW9kdWxlcyB0aGF0IGNhbiBza2lwIGNyZWF0ZSBob29rIGR1cmluZyBoeWRyYXRpb24gYmVjYXVzZSB0aGV5CiAgICAvLyBhcmUgYWxyZWFkeSByZW5kZXJlZCBvbiB0aGUgY2xpZW50IG9yIGhhcyBubyBuZWVkIGZvciBpbml0aWFsaXphdGlvbgogICAgLy8gTm90ZTogc3R5bGUgaXMgZXhjbHVkZWQgYmVjYXVzZSBpdCByZWxpZXMgb24gaW5pdGlhbCBjbG9uZSBmb3IgZnV0dXJlCiAgICAvLyBkZWVwIHVwZGF0ZXMgKCM3MDYzKS4KICAgIHZhciBpc1JlbmRlcmVkTW9kdWxlID0gbWFrZU1hcCgnYXR0cnMsY2xhc3Msc3RhdGljQ2xhc3Msc3RhdGljU3R5bGUsa2V5Jyk7CgogICAgLy8gTm90ZTogdGhpcyBpcyBhIGJyb3dzZXItb25seSBmdW5jdGlvbiBzbyB3ZSBjYW4gYXNzdW1lIGVsbXMgYXJlIERPTSBub2Rlcy4KICAgIGZ1bmN0aW9uIGh5ZHJhdGUgKGVsbSwgdm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSwgaW5WUHJlKSB7CiAgICAgIHZhciBpOwogICAgICB2YXIgdGFnID0gdm5vZGUudGFnOwogICAgICB2YXIgZGF0YSA9IHZub2RlLmRhdGE7CiAgICAgIHZhciBjaGlsZHJlbiA9IHZub2RlLmNoaWxkcmVuOwogICAgICBpblZQcmUgPSBpblZQcmUgfHwgKGRhdGEgJiYgZGF0YS5wcmUpOwogICAgICB2bm9kZS5lbG0gPSBlbG07CgogICAgICBpZiAoaXNUcnVlKHZub2RlLmlzQ29tbWVudCkgJiYgaXNEZWYodm5vZGUuYXN5bmNGYWN0b3J5KSkgewogICAgICAgIHZub2RlLmlzQXN5bmNQbGFjZWhvbGRlciA9IHRydWU7CiAgICAgICAgcmV0dXJuIHRydWUKICAgICAgfQogICAgICAvLyBhc3NlcnQgbm9kZSBtYXRjaAogICAgICB7CiAgICAgICAgaWYgKCFhc3NlcnROb2RlTWF0Y2goZWxtLCB2bm9kZSwgaW5WUHJlKSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChpc0RlZihkYXRhKSkgewogICAgICAgIGlmIChpc0RlZihpID0gZGF0YS5ob29rKSAmJiBpc0RlZihpID0gaS5pbml0KSkgeyBpKHZub2RlLCB0cnVlIC8qIGh5ZHJhdGluZyAqLyk7IH0KICAgICAgICBpZiAoaXNEZWYoaSA9IHZub2RlLmNvbXBvbmVudEluc3RhbmNlKSkgewogICAgICAgICAgLy8gY2hpbGQgY29tcG9uZW50LiBpdCBzaG91bGQgaGF2ZSBoeWRyYXRlZCBpdHMgb3duIHRyZWUuCiAgICAgICAgICBpbml0Q29tcG9uZW50KHZub2RlLCBpbnNlcnRlZFZub2RlUXVldWUpOwogICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGlzRGVmKHRhZykpIHsKICAgICAgICBpZiAoaXNEZWYoY2hpbGRyZW4pKSB7CiAgICAgICAgICAvLyBlbXB0eSBlbGVtZW50LCBhbGxvdyBjbGllbnQgdG8gcGljayB1cCBhbmQgcG9wdWxhdGUgY2hpbGRyZW4KICAgICAgICAgIGlmICghZWxtLmhhc0NoaWxkTm9kZXMoKSkgewogICAgICAgICAgICBjcmVhdGVDaGlsZHJlbih2bm9kZSwgY2hpbGRyZW4sIGluc2VydGVkVm5vZGVRdWV1ZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyB2LWh0bWwgYW5kIGRvbVByb3BzOiBpbm5lckhUTUwKICAgICAgICAgICAgaWYgKGlzRGVmKGkgPSBkYXRhKSAmJiBpc0RlZihpID0gaS5kb21Qcm9wcykgJiYgaXNEZWYoaSA9IGkuaW5uZXJIVE1MKSkgewogICAgICAgICAgICAgIGlmIChpICE9PSBlbG0uaW5uZXJIVE1MKSB7CiAgICAgICAgICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCcgJiYKICAgICAgICAgICAgICAgICAgIWh5ZHJhdGlvbkJhaWxlZAogICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgIGh5ZHJhdGlvbkJhaWxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybignUGFyZW50OiAnLCBlbG0pOwogICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ3NlcnZlciBpbm5lckhUTUw6ICcsIGkpOwogICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ2NsaWVudCBpbm5lckhUTUw6ICcsIGVsbS5pbm5lckhUTUwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIC8vIGl0ZXJhdGUgYW5kIGNvbXBhcmUgY2hpbGRyZW4gbGlzdHMKICAgICAgICAgICAgICB2YXIgY2hpbGRyZW5NYXRjaCA9IHRydWU7CiAgICAgICAgICAgICAgdmFyIGNoaWxkTm9kZSA9IGVsbS5maXJzdENoaWxkOwogICAgICAgICAgICAgIGZvciAodmFyIGkkMSA9IDA7IGkkMSA8IGNoaWxkcmVuLmxlbmd0aDsgaSQxKyspIHsKICAgICAgICAgICAgICAgIGlmICghY2hpbGROb2RlIHx8ICFoeWRyYXRlKGNoaWxkTm9kZSwgY2hpbGRyZW5baSQxXSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlLCBpblZQcmUpKSB7CiAgICAgICAgICAgICAgICAgIGNoaWxkcmVuTWF0Y2ggPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNoaWxkTm9kZSA9IGNoaWxkTm9kZS5uZXh0U2libGluZzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgLy8gaWYgY2hpbGROb2RlIGlzIG5vdCBudWxsLCBpdCBtZWFucyB0aGUgYWN0dWFsIGNoaWxkTm9kZXMgbGlzdCBpcwogICAgICAgICAgICAgIC8vIGxvbmdlciB0aGFuIHRoZSB2aXJ0dWFsIGNoaWxkcmVuIGxpc3QuCiAgICAgICAgICAgICAgaWYgKCFjaGlsZHJlbk1hdGNoIHx8IGNoaWxkTm9kZSkgewogICAgICAgICAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnICYmCiAgICAgICAgICAgICAgICAgICFoeWRyYXRpb25CYWlsZWQKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICBoeWRyYXRpb25CYWlsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ1BhcmVudDogJywgZWxtKTsKICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdNaXNtYXRjaGluZyBjaGlsZE5vZGVzIHZzLiBWTm9kZXM6ICcsIGVsbS5jaGlsZE5vZGVzLCBjaGlsZHJlbik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGlzRGVmKGRhdGEpKSB7CiAgICAgICAgICB2YXIgZnVsbEludm9rZSA9IGZhbHNlOwogICAgICAgICAgZm9yICh2YXIga2V5IGluIGRhdGEpIHsKICAgICAgICAgICAgaWYgKCFpc1JlbmRlcmVkTW9kdWxlKGtleSkpIHsKICAgICAgICAgICAgICBmdWxsSW52b2tlID0gdHJ1ZTsKICAgICAgICAgICAgICBpbnZva2VDcmVhdGVIb29rcyh2bm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKTsKICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIWZ1bGxJbnZva2UgJiYgZGF0YVsnY2xhc3MnXSkgewogICAgICAgICAgICAvLyBlbnN1cmUgY29sbGVjdGluZyBkZXBzIGZvciBkZWVwIGNsYXNzIGJpbmRpbmdzIGZvciBmdXR1cmUgdXBkYXRlcwogICAgICAgICAgICB0cmF2ZXJzZShkYXRhWydjbGFzcyddKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoZWxtLmRhdGEgIT09IHZub2RlLnRleHQpIHsKICAgICAgICBlbG0uZGF0YSA9IHZub2RlLnRleHQ7CiAgICAgIH0KICAgICAgcmV0dXJuIHRydWUKICAgIH0KCiAgICBmdW5jdGlvbiBhc3NlcnROb2RlTWF0Y2ggKG5vZGUsIHZub2RlLCBpblZQcmUpIHsKICAgICAgaWYgKGlzRGVmKHZub2RlLnRhZykpIHsKICAgICAgICByZXR1cm4gdm5vZGUudGFnLmluZGV4T2YoJ3Z1ZS1jb21wb25lbnQnKSA9PT0gMCB8fCAoCiAgICAgICAgICAhaXNVbmtub3duRWxlbWVudCQkMSh2bm9kZSwgaW5WUHJlKSAmJgogICAgICAgICAgdm5vZGUudGFnLnRvTG93ZXJDYXNlKCkgPT09IChub2RlLnRhZ05hbWUgJiYgbm9kZS50YWdOYW1lLnRvTG93ZXJDYXNlKCkpCiAgICAgICAgKQogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBub2RlLm5vZGVUeXBlID09PSAodm5vZGUuaXNDb21tZW50ID8gOCA6IDMpCiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gZnVuY3Rpb24gcGF0Y2ggKG9sZFZub2RlLCB2bm9kZSwgaHlkcmF0aW5nLCByZW1vdmVPbmx5KSB7CiAgICAgIGlmIChpc1VuZGVmKHZub2RlKSkgewogICAgICAgIGlmIChpc0RlZihvbGRWbm9kZSkpIHsgaW52b2tlRGVzdHJveUhvb2sob2xkVm5vZGUpOyB9CiAgICAgICAgcmV0dXJuCiAgICAgIH0KCiAgICAgIHZhciBpc0luaXRpYWxQYXRjaCA9IGZhbHNlOwogICAgICB2YXIgaW5zZXJ0ZWRWbm9kZVF1ZXVlID0gW107CgogICAgICBpZiAoaXNVbmRlZihvbGRWbm9kZSkpIHsKICAgICAgICAvLyBlbXB0eSBtb3VudCAobGlrZWx5IGFzIGNvbXBvbmVudCksIGNyZWF0ZSBuZXcgcm9vdCBlbGVtZW50CiAgICAgICAgaXNJbml0aWFsUGF0Y2ggPSB0cnVlOwogICAgICAgIGNyZWF0ZUVsbSh2bm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgaXNSZWFsRWxlbWVudCA9IGlzRGVmKG9sZFZub2RlLm5vZGVUeXBlKTsKICAgICAgICBpZiAoIWlzUmVhbEVsZW1lbnQgJiYgc2FtZVZub2RlKG9sZFZub2RlLCB2bm9kZSkpIHsKICAgICAgICAgIC8vIHBhdGNoIGV4aXN0aW5nIHJvb3Qgbm9kZQogICAgICAgICAgcGF0Y2hWbm9kZShvbGRWbm9kZSwgdm5vZGUsIGluc2VydGVkVm5vZGVRdWV1ZSwgbnVsbCwgbnVsbCwgcmVtb3ZlT25seSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChpc1JlYWxFbGVtZW50KSB7CiAgICAgICAgICAgIC8vIG1vdW50aW5nIHRvIGEgcmVhbCBlbGVtZW50CiAgICAgICAgICAgIC8vIGNoZWNrIGlmIHRoaXMgaXMgc2VydmVyLXJlbmRlcmVkIGNvbnRlbnQgYW5kIGlmIHdlIGNhbiBwZXJmb3JtCiAgICAgICAgICAgIC8vIGEgc3VjY2Vzc2Z1bCBoeWRyYXRpb24uCiAgICAgICAgICAgIGlmIChvbGRWbm9kZS5ub2RlVHlwZSA9PT0gMSAmJiBvbGRWbm9kZS5oYXNBdHRyaWJ1dGUoU1NSX0FUVFIpKSB7CiAgICAgICAgICAgICAgb2xkVm5vZGUucmVtb3ZlQXR0cmlidXRlKFNTUl9BVFRSKTsKICAgICAgICAgICAgICBoeWRyYXRpbmcgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChpc1RydWUoaHlkcmF0aW5nKSkgewogICAgICAgICAgICAgIGlmIChoeWRyYXRlKG9sZFZub2RlLCB2bm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlKSkgewogICAgICAgICAgICAgICAgaW52b2tlSW5zZXJ0SG9vayh2bm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlLCB0cnVlKTsKICAgICAgICAgICAgICAgIHJldHVybiBvbGRWbm9kZQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB3YXJuKAogICAgICAgICAgICAgICAgICAnVGhlIGNsaWVudC1zaWRlIHJlbmRlcmVkIHZpcnR1YWwgRE9NIHRyZWUgaXMgbm90IG1hdGNoaW5nICcgKwogICAgICAgICAgICAgICAgICAnc2VydmVyLXJlbmRlcmVkIGNvbnRlbnQuIFRoaXMgaXMgbGlrZWx5IGNhdXNlZCBieSBpbmNvcnJlY3QgJyArCiAgICAgICAgICAgICAgICAgICdIVE1MIG1hcmt1cCwgZm9yIGV4YW1wbGUgbmVzdGluZyBibG9jay1sZXZlbCBlbGVtZW50cyBpbnNpZGUgJyArCiAgICAgICAgICAgICAgICAgICc8cD4sIG9yIG1pc3NpbmcgPHRib2R5Pi4gQmFpbGluZyBoeWRyYXRpb24gYW5kIHBlcmZvcm1pbmcgJyArCiAgICAgICAgICAgICAgICAgICdmdWxsIGNsaWVudC1zaWRlIHJlbmRlci4nCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBlaXRoZXIgbm90IHNlcnZlci1yZW5kZXJlZCwgb3IgaHlkcmF0aW9uIGZhaWxlZC4KICAgICAgICAgICAgLy8gY3JlYXRlIGFuIGVtcHR5IG5vZGUgYW5kIHJlcGxhY2UgaXQKICAgICAgICAgICAgb2xkVm5vZGUgPSBlbXB0eU5vZGVBdChvbGRWbm9kZSk7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gcmVwbGFjaW5nIGV4aXN0aW5nIGVsZW1lbnQKICAgICAgICAgIHZhciBvbGRFbG0gPSBvbGRWbm9kZS5lbG07CiAgICAgICAgICB2YXIgcGFyZW50RWxtID0gbm9kZU9wcy5wYXJlbnROb2RlKG9sZEVsbSk7CgogICAgICAgICAgLy8gY3JlYXRlIG5ldyBub2RlCiAgICAgICAgICBjcmVhdGVFbG0oCiAgICAgICAgICAgIHZub2RlLAogICAgICAgICAgICBpbnNlcnRlZFZub2RlUXVldWUsCiAgICAgICAgICAgIC8vIGV4dHJlbWVseSByYXJlIGVkZ2UgY2FzZTogZG8gbm90IGluc2VydCBpZiBvbGQgZWxlbWVudCBpcyBpbiBhCiAgICAgICAgICAgIC8vIGxlYXZpbmcgdHJhbnNpdGlvbi4gT25seSBoYXBwZW5zIHdoZW4gY29tYmluaW5nIHRyYW5zaXRpb24gKwogICAgICAgICAgICAvLyBrZWVwLWFsaXZlICsgSE9Dcy4gKCM0NTkwKQogICAgICAgICAgICBvbGRFbG0uX2xlYXZlQ2IgPyBudWxsIDogcGFyZW50RWxtLAogICAgICAgICAgICBub2RlT3BzLm5leHRTaWJsaW5nKG9sZEVsbSkKICAgICAgICAgICk7CgogICAgICAgICAgLy8gdXBkYXRlIHBhcmVudCBwbGFjZWhvbGRlciBub2RlIGVsZW1lbnQsIHJlY3Vyc2l2ZWx5CiAgICAgICAgICBpZiAoaXNEZWYodm5vZGUucGFyZW50KSkgewogICAgICAgICAgICB2YXIgYW5jZXN0b3IgPSB2bm9kZS5wYXJlbnQ7CiAgICAgICAgICAgIHZhciBwYXRjaGFibGUgPSBpc1BhdGNoYWJsZSh2bm9kZSk7CiAgICAgICAgICAgIHdoaWxlIChhbmNlc3RvcikgewogICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2JzLmRlc3Ryb3kubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgICAgIGNicy5kZXN0cm95W2ldKGFuY2VzdG9yKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYW5jZXN0b3IuZWxtID0gdm5vZGUuZWxtOwogICAgICAgICAgICAgIGlmIChwYXRjaGFibGUpIHsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkkMSA9IDA7IGkkMSA8IGNicy5jcmVhdGUubGVuZ3RoOyArK2kkMSkgewogICAgICAgICAgICAgICAgICBjYnMuY3JlYXRlW2kkMV0oZW1wdHlOb2RlLCBhbmNlc3Rvcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyAjNjUxMwogICAgICAgICAgICAgICAgLy8gaW52b2tlIGluc2VydCBob29rcyB0aGF0IG1heSBoYXZlIGJlZW4gbWVyZ2VkIGJ5IGNyZWF0ZSBob29rcy4KICAgICAgICAgICAgICAgIC8vIGUuZy4gZm9yIGRpcmVjdGl2ZXMgdGhhdCB1c2VzIHRoZSAiaW5zZXJ0ZWQiIGhvb2suCiAgICAgICAgICAgICAgICB2YXIgaW5zZXJ0ID0gYW5jZXN0b3IuZGF0YS5ob29rLmluc2VydDsKICAgICAgICAgICAgICAgIGlmIChpbnNlcnQubWVyZ2VkKSB7CiAgICAgICAgICAgICAgICAgIC8vIHN0YXJ0IGF0IGluZGV4IDEgdG8gYXZvaWQgcmUtaW52b2tpbmcgY29tcG9uZW50IG1vdW50ZWQgaG9vawogICAgICAgICAgICAgICAgICBmb3IgKHZhciBpJDIgPSAxOyBpJDIgPCBpbnNlcnQuZm5zLmxlbmd0aDsgaSQyKyspIHsKICAgICAgICAgICAgICAgICAgICBpbnNlcnQuZm5zW2kkMl0oKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZWdpc3RlclJlZihhbmNlc3Rvcik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGFuY2VzdG9yID0gYW5jZXN0b3IucGFyZW50OwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgLy8gZGVzdHJveSBvbGQgbm9kZQogICAgICAgICAgaWYgKGlzRGVmKHBhcmVudEVsbSkpIHsKICAgICAgICAgICAgcmVtb3ZlVm5vZGVzKHBhcmVudEVsbSwgW29sZFZub2RlXSwgMCwgMCk7CiAgICAgICAgICB9IGVsc2UgaWYgKGlzRGVmKG9sZFZub2RlLnRhZykpIHsKICAgICAgICAgICAgaW52b2tlRGVzdHJveUhvb2sob2xkVm5vZGUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaW52b2tlSW5zZXJ0SG9vayh2bm9kZSwgaW5zZXJ0ZWRWbm9kZVF1ZXVlLCBpc0luaXRpYWxQYXRjaCk7CiAgICAgIHJldHVybiB2bm9kZS5lbG0KICAgIH0KICB9CgogIC8qICAqLwoKICB2YXIgZGlyZWN0aXZlcyA9IHsKICAgIGNyZWF0ZTogdXBkYXRlRGlyZWN0aXZlcywKICAgIHVwZGF0ZTogdXBkYXRlRGlyZWN0aXZlcywKICAgIGRlc3Ryb3k6IGZ1bmN0aW9uIHVuYmluZERpcmVjdGl2ZXMgKHZub2RlKSB7CiAgICAgIHVwZGF0ZURpcmVjdGl2ZXModm5vZGUsIGVtcHR5Tm9kZSk7CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gdXBkYXRlRGlyZWN0aXZlcyAob2xkVm5vZGUsIHZub2RlKSB7CiAgICBpZiAob2xkVm5vZGUuZGF0YS5kaXJlY3RpdmVzIHx8IHZub2RlLmRhdGEuZGlyZWN0aXZlcykgewogICAgICBfdXBkYXRlKG9sZFZub2RlLCB2bm9kZSk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBfdXBkYXRlIChvbGRWbm9kZSwgdm5vZGUpIHsKICAgIHZhciBpc0NyZWF0ZSA9IG9sZFZub2RlID09PSBlbXB0eU5vZGU7CiAgICB2YXIgaXNEZXN0cm95ID0gdm5vZGUgPT09IGVtcHR5Tm9kZTsKICAgIHZhciBvbGREaXJzID0gbm9ybWFsaXplRGlyZWN0aXZlcyQxKG9sZFZub2RlLmRhdGEuZGlyZWN0aXZlcywgb2xkVm5vZGUuY29udGV4dCk7CiAgICB2YXIgbmV3RGlycyA9IG5vcm1hbGl6ZURpcmVjdGl2ZXMkMSh2bm9kZS5kYXRhLmRpcmVjdGl2ZXMsIHZub2RlLmNvbnRleHQpOwoKICAgIHZhciBkaXJzV2l0aEluc2VydCA9IFtdOwogICAgdmFyIGRpcnNXaXRoUG9zdHBhdGNoID0gW107CgogICAgdmFyIGtleSwgb2xkRGlyLCBkaXI7CiAgICBmb3IgKGtleSBpbiBuZXdEaXJzKSB7CiAgICAgIG9sZERpciA9IG9sZERpcnNba2V5XTsKICAgICAgZGlyID0gbmV3RGlyc1trZXldOwogICAgICBpZiAoIW9sZERpcikgewogICAgICAgIC8vIG5ldyBkaXJlY3RpdmUsIGJpbmQKICAgICAgICBjYWxsSG9vayQxKGRpciwgJ2JpbmQnLCB2bm9kZSwgb2xkVm5vZGUpOwogICAgICAgIGlmIChkaXIuZGVmICYmIGRpci5kZWYuaW5zZXJ0ZWQpIHsKICAgICAgICAgIGRpcnNXaXRoSW5zZXJ0LnB1c2goZGlyKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gZXhpc3RpbmcgZGlyZWN0aXZlLCB1cGRhdGUKICAgICAgICBkaXIub2xkVmFsdWUgPSBvbGREaXIudmFsdWU7CiAgICAgICAgZGlyLm9sZEFyZyA9IG9sZERpci5hcmc7CiAgICAgICAgY2FsbEhvb2skMShkaXIsICd1cGRhdGUnLCB2bm9kZSwgb2xkVm5vZGUpOwogICAgICAgIGlmIChkaXIuZGVmICYmIGRpci5kZWYuY29tcG9uZW50VXBkYXRlZCkgewogICAgICAgICAgZGlyc1dpdGhQb3N0cGF0Y2gucHVzaChkaXIpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGlmIChkaXJzV2l0aEluc2VydC5sZW5ndGgpIHsKICAgICAgdmFyIGNhbGxJbnNlcnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkaXJzV2l0aEluc2VydC5sZW5ndGg7IGkrKykgewogICAgICAgICAgY2FsbEhvb2skMShkaXJzV2l0aEluc2VydFtpXSwgJ2luc2VydGVkJywgdm5vZGUsIG9sZFZub2RlKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIGlmIChpc0NyZWF0ZSkgewogICAgICAgIG1lcmdlVk5vZGVIb29rKHZub2RlLCAnaW5zZXJ0JywgY2FsbEluc2VydCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY2FsbEluc2VydCgpOwogICAgICB9CiAgICB9CgogICAgaWYgKGRpcnNXaXRoUG9zdHBhdGNoLmxlbmd0aCkgewogICAgICBtZXJnZVZOb2RlSG9vayh2bm9kZSwgJ3Bvc3RwYXRjaCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRpcnNXaXRoUG9zdHBhdGNoLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBjYWxsSG9vayQxKGRpcnNXaXRoUG9zdHBhdGNoW2ldLCAnY29tcG9uZW50VXBkYXRlZCcsIHZub2RlLCBvbGRWbm9kZSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KCiAgICBpZiAoIWlzQ3JlYXRlKSB7CiAgICAgIGZvciAoa2V5IGluIG9sZERpcnMpIHsKICAgICAgICBpZiAoIW5ld0RpcnNba2V5XSkgewogICAgICAgICAgLy8gbm8gbG9uZ2VyIHByZXNlbnQsIHVuYmluZAogICAgICAgICAgY2FsbEhvb2skMShvbGREaXJzW2tleV0sICd1bmJpbmQnLCBvbGRWbm9kZSwgb2xkVm5vZGUsIGlzRGVzdHJveSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICB2YXIgZW1wdHlNb2RpZmllcnMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwoKICBmdW5jdGlvbiBub3JtYWxpemVEaXJlY3RpdmVzJDEgKAogICAgZGlycywKICAgIHZtCiAgKSB7CiAgICB2YXIgcmVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGlmICghZGlycykgewogICAgICAvLyAkZmxvdy1kaXNhYmxlLWxpbmUKICAgICAgcmV0dXJuIHJlcwogICAgfQogICAgdmFyIGksIGRpcjsKICAgIGZvciAoaSA9IDA7IGkgPCBkaXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGRpciA9IGRpcnNbaV07CiAgICAgIGlmICghZGlyLm1vZGlmaWVycykgewogICAgICAgIC8vICRmbG93LWRpc2FibGUtbGluZQogICAgICAgIGRpci5tb2RpZmllcnMgPSBlbXB0eU1vZGlmaWVyczsKICAgICAgfQogICAgICByZXNbZ2V0UmF3RGlyTmFtZShkaXIpXSA9IGRpcjsKICAgICAgZGlyLmRlZiA9IHJlc29sdmVBc3NldCh2bS4kb3B0aW9ucywgJ2RpcmVjdGl2ZXMnLCBkaXIubmFtZSwgdHJ1ZSk7CiAgICB9CiAgICAvLyAkZmxvdy1kaXNhYmxlLWxpbmUKICAgIHJldHVybiByZXMKICB9CgogIGZ1bmN0aW9uIGdldFJhd0Rpck5hbWUgKGRpcikgewogICAgcmV0dXJuIGRpci5yYXdOYW1lIHx8ICgoZGlyLm5hbWUpICsgIi4iICsgKE9iamVjdC5rZXlzKGRpci5tb2RpZmllcnMgfHwge30pLmpvaW4oJy4nKSkpCiAgfQoKICBmdW5jdGlvbiBjYWxsSG9vayQxIChkaXIsIGhvb2ssIHZub2RlLCBvbGRWbm9kZSwgaXNEZXN0cm95KSB7CiAgICB2YXIgZm4gPSBkaXIuZGVmICYmIGRpci5kZWZbaG9va107CiAgICBpZiAoZm4pIHsKICAgICAgdHJ5IHsKICAgICAgICBmbih2bm9kZS5lbG0sIGRpciwgdm5vZGUsIG9sZFZub2RlLCBpc0Rlc3Ryb3kpOwogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgaGFuZGxlRXJyb3IoZSwgdm5vZGUuY29udGV4dCwgKCJkaXJlY3RpdmUgIiArIChkaXIubmFtZSkgKyAiICIgKyBob29rICsgIiBob29rIikpOwogICAgICB9CiAgICB9CiAgfQoKICB2YXIgYmFzZU1vZHVsZXMgPSBbCiAgICByZWYsCiAgICBkaXJlY3RpdmVzCiAgXTsKCiAgLyogICovCgogIGZ1bmN0aW9uIHVwZGF0ZUF0dHJzIChvbGRWbm9kZSwgdm5vZGUpIHsKICAgIHZhciBvcHRzID0gdm5vZGUuY29tcG9uZW50T3B0aW9uczsKICAgIGlmIChpc0RlZihvcHRzKSAmJiBvcHRzLkN0b3Iub3B0aW9ucy5pbmhlcml0QXR0cnMgPT09IGZhbHNlKSB7CiAgICAgIHJldHVybgogICAgfQogICAgaWYgKGlzVW5kZWYob2xkVm5vZGUuZGF0YS5hdHRycykgJiYgaXNVbmRlZih2bm9kZS5kYXRhLmF0dHJzKSkgewogICAgICByZXR1cm4KICAgIH0KICAgIHZhciBrZXksIGN1ciwgb2xkOwogICAgdmFyIGVsbSA9IHZub2RlLmVsbTsKICAgIHZhciBvbGRBdHRycyA9IG9sZFZub2RlLmRhdGEuYXR0cnMgfHwge307CiAgICB2YXIgYXR0cnMgPSB2bm9kZS5kYXRhLmF0dHJzIHx8IHt9OwogICAgLy8gY2xvbmUgb2JzZXJ2ZWQgb2JqZWN0cywgYXMgdGhlIHVzZXIgcHJvYmFibHkgd2FudHMgdG8gbXV0YXRlIGl0CiAgICBpZiAoaXNEZWYoYXR0cnMuX19vYl9fKSkgewogICAgICBhdHRycyA9IHZub2RlLmRhdGEuYXR0cnMgPSBleHRlbmQoe30sIGF0dHJzKTsKICAgIH0KCiAgICBmb3IgKGtleSBpbiBhdHRycykgewogICAgICBjdXIgPSBhdHRyc1trZXldOwogICAgICBvbGQgPSBvbGRBdHRyc1trZXldOwogICAgICBpZiAob2xkICE9PSBjdXIpIHsKICAgICAgICBzZXRBdHRyKGVsbSwga2V5LCBjdXIpOwogICAgICB9CiAgICB9CiAgICAvLyAjNDM5MTogaW4gSUU5LCBzZXR0aW5nIHR5cGUgY2FuIHJlc2V0IHZhbHVlIGZvciBpbnB1dFt0eXBlPXJhZGlvXQogICAgLy8gIzY2NjY6IElFL0VkZ2UgZm9yY2VzIHByb2dyZXNzIHZhbHVlIGRvd24gdG8gMSBiZWZvcmUgc2V0dGluZyBhIG1heAogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAoKGlzSUUgfHwgaXNFZGdlKSAmJiBhdHRycy52YWx1ZSAhPT0gb2xkQXR0cnMudmFsdWUpIHsKICAgICAgc2V0QXR0cihlbG0sICd2YWx1ZScsIGF0dHJzLnZhbHVlKTsKICAgIH0KICAgIGZvciAoa2V5IGluIG9sZEF0dHJzKSB7CiAgICAgIGlmIChpc1VuZGVmKGF0dHJzW2tleV0pKSB7CiAgICAgICAgaWYgKGlzWGxpbmsoa2V5KSkgewogICAgICAgICAgZWxtLnJlbW92ZUF0dHJpYnV0ZU5TKHhsaW5rTlMsIGdldFhsaW5rUHJvcChrZXkpKTsKICAgICAgICB9IGVsc2UgaWYgKCFpc0VudW1lcmF0ZWRBdHRyKGtleSkpIHsKICAgICAgICAgIGVsbS5yZW1vdmVBdHRyaWJ1dGUoa2V5KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIHNldEF0dHIgKGVsLCBrZXksIHZhbHVlKSB7CiAgICBpZiAoZWwudGFnTmFtZS5pbmRleE9mKCctJykgPiAtMSkgewogICAgICBiYXNlU2V0QXR0cihlbCwga2V5LCB2YWx1ZSk7CiAgICB9IGVsc2UgaWYgKGlzQm9vbGVhbkF0dHIoa2V5KSkgewogICAgICAvLyBzZXQgYXR0cmlidXRlIGZvciBibGFuayB2YWx1ZQogICAgICAvLyBlLmcuIDxvcHRpb24gZGlzYWJsZWQ+U2VsZWN0IG9uZTwvb3B0aW9uPgogICAgICBpZiAoaXNGYWxzeUF0dHJWYWx1ZSh2YWx1ZSkpIHsKICAgICAgICBlbC5yZW1vdmVBdHRyaWJ1dGUoa2V5KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyB0ZWNobmljYWxseSBhbGxvd2Z1bGxzY3JlZW4gaXMgYSBib29sZWFuIGF0dHJpYnV0ZSBmb3IgPGlmcmFtZT4sCiAgICAgICAgLy8gYnV0IEZsYXNoIGV4cGVjdHMgYSB2YWx1ZSBvZiAidHJ1ZSIgd2hlbiB1c2VkIG9uIDxlbWJlZD4gdGFnCiAgICAgICAgdmFsdWUgPSBrZXkgPT09ICdhbGxvd2Z1bGxzY3JlZW4nICYmIGVsLnRhZ05hbWUgPT09ICdFTUJFRCcKICAgICAgICAgID8gJ3RydWUnCiAgICAgICAgICA6IGtleTsKICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoa2V5LCB2YWx1ZSk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoaXNFbnVtZXJhdGVkQXR0cihrZXkpKSB7CiAgICAgIGVsLnNldEF0dHJpYnV0ZShrZXksIGNvbnZlcnRFbnVtZXJhdGVkVmFsdWUoa2V5LCB2YWx1ZSkpOwogICAgfSBlbHNlIGlmIChpc1hsaW5rKGtleSkpIHsKICAgICAgaWYgKGlzRmFsc3lBdHRyVmFsdWUodmFsdWUpKSB7CiAgICAgICAgZWwucmVtb3ZlQXR0cmlidXRlTlMoeGxpbmtOUywgZ2V0WGxpbmtQcm9wKGtleSkpOwogICAgICB9IGVsc2UgewogICAgICAgIGVsLnNldEF0dHJpYnV0ZU5TKHhsaW5rTlMsIGtleSwgdmFsdWUpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBiYXNlU2V0QXR0cihlbCwga2V5LCB2YWx1ZSk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBiYXNlU2V0QXR0ciAoZWwsIGtleSwgdmFsdWUpIHsKICAgIGlmIChpc0ZhbHN5QXR0clZhbHVlKHZhbHVlKSkgewogICAgICBlbC5yZW1vdmVBdHRyaWJ1dGUoa2V5KTsKICAgIH0gZWxzZSB7CiAgICAgIC8vICM3MTM4OiBJRTEwICYgMTEgZmlyZXMgaW5wdXQgZXZlbnQgd2hlbiBzZXR0aW5nIHBsYWNlaG9sZGVyIG9uCiAgICAgIC8vIDx0ZXh0YXJlYT4uLi4gYmxvY2sgdGhlIGZpcnN0IGlucHV0IGV2ZW50IGFuZCByZW1vdmUgdGhlIGJsb2NrZXIKICAgICAgLy8gaW1tZWRpYXRlbHkuCiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgICBpZiAoCiAgICAgICAgaXNJRSAmJiAhaXNJRTkgJiYKICAgICAgICBlbC50YWdOYW1lID09PSAnVEVYVEFSRUEnICYmCiAgICAgICAga2V5ID09PSAncGxhY2Vob2xkZXInICYmIHZhbHVlICE9PSAnJyAmJiAhZWwuX19pZXBoCiAgICAgICkgewogICAgICAgIHZhciBibG9ja2VyID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7CiAgICAgICAgICBlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdpbnB1dCcsIGJsb2NrZXIpOwogICAgICAgIH07CiAgICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBibG9ja2VyKTsKICAgICAgICAvLyAkZmxvdy1kaXNhYmxlLWxpbmUKICAgICAgICBlbC5fX2llcGggPSB0cnVlOyAvKiBJRSBwbGFjZWhvbGRlciBwYXRjaGVkICovCiAgICAgIH0KICAgICAgZWwuc2V0QXR0cmlidXRlKGtleSwgdmFsdWUpOwogICAgfQogIH0KCiAgdmFyIGF0dHJzID0gewogICAgY3JlYXRlOiB1cGRhdGVBdHRycywKICAgIHVwZGF0ZTogdXBkYXRlQXR0cnMKICB9OwoKICAvKiAgKi8KCiAgZnVuY3Rpb24gdXBkYXRlQ2xhc3MgKG9sZFZub2RlLCB2bm9kZSkgewogICAgdmFyIGVsID0gdm5vZGUuZWxtOwogICAgdmFyIGRhdGEgPSB2bm9kZS5kYXRhOwogICAgdmFyIG9sZERhdGEgPSBvbGRWbm9kZS5kYXRhOwogICAgaWYgKAogICAgICBpc1VuZGVmKGRhdGEuc3RhdGljQ2xhc3MpICYmCiAgICAgIGlzVW5kZWYoZGF0YS5jbGFzcykgJiYgKAogICAgICAgIGlzVW5kZWYob2xkRGF0YSkgfHwgKAogICAgICAgICAgaXNVbmRlZihvbGREYXRhLnN0YXRpY0NsYXNzKSAmJgogICAgICAgICAgaXNVbmRlZihvbGREYXRhLmNsYXNzKQogICAgICAgICkKICAgICAgKQogICAgKSB7CiAgICAgIHJldHVybgogICAgfQoKICAgIHZhciBjbHMgPSBnZW5DbGFzc0ZvclZub2RlKHZub2RlKTsKCiAgICAvLyBoYW5kbGUgdHJhbnNpdGlvbiBjbGFzc2VzCiAgICB2YXIgdHJhbnNpdGlvbkNsYXNzID0gZWwuX3RyYW5zaXRpb25DbGFzc2VzOwogICAgaWYgKGlzRGVmKHRyYW5zaXRpb25DbGFzcykpIHsKICAgICAgY2xzID0gY29uY2F0KGNscywgc3RyaW5naWZ5Q2xhc3ModHJhbnNpdGlvbkNsYXNzKSk7CiAgICB9CgogICAgLy8gc2V0IHRoZSBjbGFzcwogICAgaWYgKGNscyAhPT0gZWwuX3ByZXZDbGFzcykgewogICAgICBlbC5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgY2xzKTsKICAgICAgZWwuX3ByZXZDbGFzcyA9IGNsczsKICAgIH0KICB9CgogIHZhciBrbGFzcyA9IHsKICAgIGNyZWF0ZTogdXBkYXRlQ2xhc3MsCiAgICB1cGRhdGU6IHVwZGF0ZUNsYXNzCiAgfTsKCiAgLyogICovCgogIHZhciB2YWxpZERpdmlzaW9uQ2hhclJFID0gL1tcdykuK1wtXyRcXV0vOwoKICBmdW5jdGlvbiBwYXJzZUZpbHRlcnMgKGV4cCkgewogICAgdmFyIGluU2luZ2xlID0gZmFsc2U7CiAgICB2YXIgaW5Eb3VibGUgPSBmYWxzZTsKICAgIHZhciBpblRlbXBsYXRlU3RyaW5nID0gZmFsc2U7CiAgICB2YXIgaW5SZWdleCA9IGZhbHNlOwogICAgdmFyIGN1cmx5ID0gMDsKICAgIHZhciBzcXVhcmUgPSAwOwogICAgdmFyIHBhcmVuID0gMDsKICAgIHZhciBsYXN0RmlsdGVySW5kZXggPSAwOwogICAgdmFyIGMsIHByZXYsIGksIGV4cHJlc3Npb24sIGZpbHRlcnM7CgogICAgZm9yIChpID0gMDsgaSA8IGV4cC5sZW5ndGg7IGkrKykgewogICAgICBwcmV2ID0gYzsKICAgICAgYyA9IGV4cC5jaGFyQ29kZUF0KGkpOwogICAgICBpZiAoaW5TaW5nbGUpIHsKICAgICAgICBpZiAoYyA9PT0gMHgyNyAmJiBwcmV2ICE9PSAweDVDKSB7IGluU2luZ2xlID0gZmFsc2U7IH0KICAgICAgfSBlbHNlIGlmIChpbkRvdWJsZSkgewogICAgICAgIGlmIChjID09PSAweDIyICYmIHByZXYgIT09IDB4NUMpIHsgaW5Eb3VibGUgPSBmYWxzZTsgfQogICAgICB9IGVsc2UgaWYgKGluVGVtcGxhdGVTdHJpbmcpIHsKICAgICAgICBpZiAoYyA9PT0gMHg2MCAmJiBwcmV2ICE9PSAweDVDKSB7IGluVGVtcGxhdGVTdHJpbmcgPSBmYWxzZTsgfQogICAgICB9IGVsc2UgaWYgKGluUmVnZXgpIHsKICAgICAgICBpZiAoYyA9PT0gMHgyZiAmJiBwcmV2ICE9PSAweDVDKSB7IGluUmVnZXggPSBmYWxzZTsgfQogICAgICB9IGVsc2UgaWYgKAogICAgICAgIGMgPT09IDB4N0MgJiYgLy8gcGlwZQogICAgICAgIGV4cC5jaGFyQ29kZUF0KGkgKyAxKSAhPT0gMHg3QyAmJgogICAgICAgIGV4cC5jaGFyQ29kZUF0KGkgLSAxKSAhPT0gMHg3QyAmJgogICAgICAgICFjdXJseSAmJiAhc3F1YXJlICYmICFwYXJlbgogICAgICApIHsKICAgICAgICBpZiAoZXhwcmVzc2lvbiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAvLyBmaXJzdCBmaWx0ZXIsIGVuZCBvZiBleHByZXNzaW9uCiAgICAgICAgICBsYXN0RmlsdGVySW5kZXggPSBpICsgMTsKICAgICAgICAgIGV4cHJlc3Npb24gPSBleHAuc2xpY2UoMCwgaSkudHJpbSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBwdXNoRmlsdGVyKCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHN3aXRjaCAoYykgewogICAgICAgICAgY2FzZSAweDIyOiBpbkRvdWJsZSA9IHRydWU7IGJyZWFrICAgICAgICAgLy8gIgogICAgICAgICAgY2FzZSAweDI3OiBpblNpbmdsZSA9IHRydWU7IGJyZWFrICAgICAgICAgLy8gJwogICAgICAgICAgY2FzZSAweDYwOiBpblRlbXBsYXRlU3RyaW5nID0gdHJ1ZTsgYnJlYWsgLy8gYAogICAgICAgICAgY2FzZSAweDI4OiBwYXJlbisrOyBicmVhayAgICAgICAgICAgICAgICAgLy8gKAogICAgICAgICAgY2FzZSAweDI5OiBwYXJlbi0tOyBicmVhayAgICAgICAgICAgICAgICAgLy8gKQogICAgICAgICAgY2FzZSAweDVCOiBzcXVhcmUrKzsgYnJlYWsgICAgICAgICAgICAgICAgLy8gWwogICAgICAgICAgY2FzZSAweDVEOiBzcXVhcmUtLTsgYnJlYWsgICAgICAgICAgICAgICAgLy8gXQogICAgICAgICAgY2FzZSAweDdCOiBjdXJseSsrOyBicmVhayAgICAgICAgICAgICAgICAgLy8gewogICAgICAgICAgY2FzZSAweDdEOiBjdXJseS0tOyBicmVhayAgICAgICAgICAgICAgICAgLy8gfQogICAgICAgIH0KICAgICAgICBpZiAoYyA9PT0gMHgyZikgeyAvLyAvCiAgICAgICAgICB2YXIgaiA9IGkgLSAxOwogICAgICAgICAgdmFyIHAgPSAodm9pZCAwKTsKICAgICAgICAgIC8vIGZpbmQgZmlyc3Qgbm9uLXdoaXRlc3BhY2UgcHJldiBjaGFyCiAgICAgICAgICBmb3IgKDsgaiA+PSAwOyBqLS0pIHsKICAgICAgICAgICAgcCA9IGV4cC5jaGFyQXQoaik7CiAgICAgICAgICAgIGlmIChwICE9PSAnICcpIHsgYnJlYWsgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKCFwIHx8ICF2YWxpZERpdmlzaW9uQ2hhclJFLnRlc3QocCkpIHsKICAgICAgICAgICAgaW5SZWdleCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaWYgKGV4cHJlc3Npb24gPT09IHVuZGVmaW5lZCkgewogICAgICBleHByZXNzaW9uID0gZXhwLnNsaWNlKDAsIGkpLnRyaW0oKTsKICAgIH0gZWxzZSBpZiAobGFzdEZpbHRlckluZGV4ICE9PSAwKSB7CiAgICAgIHB1c2hGaWx0ZXIoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBwdXNoRmlsdGVyICgpIHsKICAgICAgKGZpbHRlcnMgfHwgKGZpbHRlcnMgPSBbXSkpLnB1c2goZXhwLnNsaWNlKGxhc3RGaWx0ZXJJbmRleCwgaSkudHJpbSgpKTsKICAgICAgbGFzdEZpbHRlckluZGV4ID0gaSArIDE7CiAgICB9CgogICAgaWYgKGZpbHRlcnMpIHsKICAgICAgZm9yIChpID0gMDsgaSA8IGZpbHRlcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBleHByZXNzaW9uID0gd3JhcEZpbHRlcihleHByZXNzaW9uLCBmaWx0ZXJzW2ldKTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBleHByZXNzaW9uCiAgfQoKICBmdW5jdGlvbiB3cmFwRmlsdGVyIChleHAsIGZpbHRlcikgewogICAgdmFyIGkgPSBmaWx0ZXIuaW5kZXhPZignKCcpOwogICAgaWYgKGkgPCAwKSB7CiAgICAgIC8vIF9mOiByZXNvbHZlRmlsdGVyCiAgICAgIHJldHVybiAoIl9mKFwiIiArIGZpbHRlciArICJcIikoIiArIGV4cCArICIpIikKICAgIH0gZWxzZSB7CiAgICAgIHZhciBuYW1lID0gZmlsdGVyLnNsaWNlKDAsIGkpOwogICAgICB2YXIgYXJncyA9IGZpbHRlci5zbGljZShpICsgMSk7CiAgICAgIHJldHVybiAoIl9mKFwiIiArIG5hbWUgKyAiXCIpKCIgKyBleHAgKyAoYXJncyAhPT0gJyknID8gJywnICsgYXJncyA6IGFyZ3MpKQogICAgfQogIH0KCiAgLyogICovCgoKCiAgLyogZXNsaW50LWRpc2FibGUgbm8tdW51c2VkLXZhcnMgKi8KICBmdW5jdGlvbiBiYXNlV2FybiAobXNnLCByYW5nZSkgewogICAgY29uc29sZS5lcnJvcigoIltWdWUgY29tcGlsZXJdOiAiICsgbXNnKSk7CiAgfQogIC8qIGVzbGludC1lbmFibGUgbm8tdW51c2VkLXZhcnMgKi8KCiAgZnVuY3Rpb24gcGx1Y2tNb2R1bGVGdW5jdGlvbiAoCiAgICBtb2R1bGVzLAogICAga2V5CiAgKSB7CiAgICByZXR1cm4gbW9kdWxlcwogICAgICA/IG1vZHVsZXMubWFwKGZ1bmN0aW9uIChtKSB7IHJldHVybiBtW2tleV07IH0pLmZpbHRlcihmdW5jdGlvbiAoXykgeyByZXR1cm4gXzsgfSkKICAgICAgOiBbXQogIH0KCiAgZnVuY3Rpb24gYWRkUHJvcCAoZWwsIG5hbWUsIHZhbHVlLCByYW5nZSwgZHluYW1pYykgewogICAgKGVsLnByb3BzIHx8IChlbC5wcm9wcyA9IFtdKSkucHVzaChyYW5nZVNldEl0ZW0oeyBuYW1lOiBuYW1lLCB2YWx1ZTogdmFsdWUsIGR5bmFtaWM6IGR5bmFtaWMgfSwgcmFuZ2UpKTsKICAgIGVsLnBsYWluID0gZmFsc2U7CiAgfQoKICBmdW5jdGlvbiBhZGRBdHRyIChlbCwgbmFtZSwgdmFsdWUsIHJhbmdlLCBkeW5hbWljKSB7CiAgICB2YXIgYXR0cnMgPSBkeW5hbWljCiAgICAgID8gKGVsLmR5bmFtaWNBdHRycyB8fCAoZWwuZHluYW1pY0F0dHJzID0gW10pKQogICAgICA6IChlbC5hdHRycyB8fCAoZWwuYXR0cnMgPSBbXSkpOwogICAgYXR0cnMucHVzaChyYW5nZVNldEl0ZW0oeyBuYW1lOiBuYW1lLCB2YWx1ZTogdmFsdWUsIGR5bmFtaWM6IGR5bmFtaWMgfSwgcmFuZ2UpKTsKICAgIGVsLnBsYWluID0gZmFsc2U7CiAgfQoKICAvLyBhZGQgYSByYXcgYXR0ciAodXNlIHRoaXMgaW4gcHJlVHJhbnNmb3JtcykKICBmdW5jdGlvbiBhZGRSYXdBdHRyIChlbCwgbmFtZSwgdmFsdWUsIHJhbmdlKSB7CiAgICBlbC5hdHRyc01hcFtuYW1lXSA9IHZhbHVlOwogICAgZWwuYXR0cnNMaXN0LnB1c2gocmFuZ2VTZXRJdGVtKHsgbmFtZTogbmFtZSwgdmFsdWU6IHZhbHVlIH0sIHJhbmdlKSk7CiAgfQoKICBmdW5jdGlvbiBhZGREaXJlY3RpdmUgKAogICAgZWwsCiAgICBuYW1lLAogICAgcmF3TmFtZSwKICAgIHZhbHVlLAogICAgYXJnLAogICAgaXNEeW5hbWljQXJnLAogICAgbW9kaWZpZXJzLAogICAgcmFuZ2UKICApIHsKICAgIChlbC5kaXJlY3RpdmVzIHx8IChlbC5kaXJlY3RpdmVzID0gW10pKS5wdXNoKHJhbmdlU2V0SXRlbSh7CiAgICAgIG5hbWU6IG5hbWUsCiAgICAgIHJhd05hbWU6IHJhd05hbWUsCiAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgYXJnOiBhcmcsCiAgICAgIGlzRHluYW1pY0FyZzogaXNEeW5hbWljQXJnLAogICAgICBtb2RpZmllcnM6IG1vZGlmaWVycwogICAgfSwgcmFuZ2UpKTsKICAgIGVsLnBsYWluID0gZmFsc2U7CiAgfQoKICBmdW5jdGlvbiBwcmVwZW5kTW9kaWZpZXJNYXJrZXIgKHN5bWJvbCwgbmFtZSwgZHluYW1pYykgewogICAgcmV0dXJuIGR5bmFtaWMKICAgICAgPyAoIl9wKCIgKyBuYW1lICsgIixcIiIgKyBzeW1ib2wgKyAiXCIpIikKICAgICAgOiBzeW1ib2wgKyBuYW1lIC8vIG1hcmsgdGhlIGV2ZW50IGFzIGNhcHR1cmVkCiAgfQoKICBmdW5jdGlvbiBhZGRIYW5kbGVyICgKICAgIGVsLAogICAgbmFtZSwKICAgIHZhbHVlLAogICAgbW9kaWZpZXJzLAogICAgaW1wb3J0YW50LAogICAgd2FybiwKICAgIHJhbmdlLAogICAgZHluYW1pYwogICkgewogICAgbW9kaWZpZXJzID0gbW9kaWZpZXJzIHx8IGVtcHR5T2JqZWN0OwogICAgLy8gd2FybiBwcmV2ZW50IGFuZCBwYXNzaXZlIG1vZGlmaWVyCiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgIGlmICgKICAgICAgd2FybiAmJgogICAgICBtb2RpZmllcnMucHJldmVudCAmJiBtb2RpZmllcnMucGFzc2l2ZQogICAgKSB7CiAgICAgIHdhcm4oCiAgICAgICAgJ3Bhc3NpdmUgYW5kIHByZXZlbnQgY2FuXCd0IGJlIHVzZWQgdG9nZXRoZXIuICcgKwogICAgICAgICdQYXNzaXZlIGhhbmRsZXIgY2FuXCd0IHByZXZlbnQgZGVmYXVsdCBldmVudC4nLAogICAgICAgIHJhbmdlCiAgICAgICk7CiAgICB9CgogICAgLy8gbm9ybWFsaXplIGNsaWNrLnJpZ2h0IGFuZCBjbGljay5taWRkbGUgc2luY2UgdGhleSBkb24ndCBhY3R1YWxseSBmaXJlCiAgICAvLyB0aGlzIGlzIHRlY2huaWNhbGx5IGJyb3dzZXItc3BlY2lmaWMsIGJ1dCBhdCBsZWFzdCBmb3Igbm93IGJyb3dzZXJzIGFyZQogICAgLy8gdGhlIG9ubHkgdGFyZ2V0IGVudnMgdGhhdCBoYXZlIHJpZ2h0L21pZGRsZSBjbGlja3MuCiAgICBpZiAobW9kaWZpZXJzLnJpZ2h0KSB7CiAgICAgIGlmIChkeW5hbWljKSB7CiAgICAgICAgbmFtZSA9ICIoIiArIG5hbWUgKyAiKT09PSdjbGljayc/J2NvbnRleHRtZW51JzooIiArIG5hbWUgKyAiKSI7CiAgICAgIH0gZWxzZSBpZiAobmFtZSA9PT0gJ2NsaWNrJykgewogICAgICAgIG5hbWUgPSAnY29udGV4dG1lbnUnOwogICAgICAgIGRlbGV0ZSBtb2RpZmllcnMucmlnaHQ7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAobW9kaWZpZXJzLm1pZGRsZSkgewogICAgICBpZiAoZHluYW1pYykgewogICAgICAgIG5hbWUgPSAiKCIgKyBuYW1lICsgIik9PT0nY2xpY2snPydtb3VzZXVwJzooIiArIG5hbWUgKyAiKSI7CiAgICAgIH0gZWxzZSBpZiAobmFtZSA9PT0gJ2NsaWNrJykgewogICAgICAgIG5hbWUgPSAnbW91c2V1cCc7CiAgICAgIH0KICAgIH0KCiAgICAvLyBjaGVjayBjYXB0dXJlIG1vZGlmaWVyCiAgICBpZiAobW9kaWZpZXJzLmNhcHR1cmUpIHsKICAgICAgZGVsZXRlIG1vZGlmaWVycy5jYXB0dXJlOwogICAgICBuYW1lID0gcHJlcGVuZE1vZGlmaWVyTWFya2VyKCchJywgbmFtZSwgZHluYW1pYyk7CiAgICB9CiAgICBpZiAobW9kaWZpZXJzLm9uY2UpIHsKICAgICAgZGVsZXRlIG1vZGlmaWVycy5vbmNlOwogICAgICBuYW1lID0gcHJlcGVuZE1vZGlmaWVyTWFya2VyKCd+JywgbmFtZSwgZHluYW1pYyk7CiAgICB9CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgIGlmIChtb2RpZmllcnMucGFzc2l2ZSkgewogICAgICBkZWxldGUgbW9kaWZpZXJzLnBhc3NpdmU7CiAgICAgIG5hbWUgPSBwcmVwZW5kTW9kaWZpZXJNYXJrZXIoJyYnLCBuYW1lLCBkeW5hbWljKTsKICAgIH0KCiAgICB2YXIgZXZlbnRzOwogICAgaWYgKG1vZGlmaWVycy5uYXRpdmUpIHsKICAgICAgZGVsZXRlIG1vZGlmaWVycy5uYXRpdmU7CiAgICAgIGV2ZW50cyA9IGVsLm5hdGl2ZUV2ZW50cyB8fCAoZWwubmF0aXZlRXZlbnRzID0ge30pOwogICAgfSBlbHNlIHsKICAgICAgZXZlbnRzID0gZWwuZXZlbnRzIHx8IChlbC5ldmVudHMgPSB7fSk7CiAgICB9CgogICAgdmFyIG5ld0hhbmRsZXIgPSByYW5nZVNldEl0ZW0oeyB2YWx1ZTogdmFsdWUudHJpbSgpLCBkeW5hbWljOiBkeW5hbWljIH0sIHJhbmdlKTsKICAgIGlmIChtb2RpZmllcnMgIT09IGVtcHR5T2JqZWN0KSB7CiAgICAgIG5ld0hhbmRsZXIubW9kaWZpZXJzID0gbW9kaWZpZXJzOwogICAgfQoKICAgIHZhciBoYW5kbGVycyA9IGV2ZW50c1tuYW1lXTsKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgaWYgKEFycmF5LmlzQXJyYXkoaGFuZGxlcnMpKSB7CiAgICAgIGltcG9ydGFudCA/IGhhbmRsZXJzLnVuc2hpZnQobmV3SGFuZGxlcikgOiBoYW5kbGVycy5wdXNoKG5ld0hhbmRsZXIpOwogICAgfSBlbHNlIGlmIChoYW5kbGVycykgewogICAgICBldmVudHNbbmFtZV0gPSBpbXBvcnRhbnQgPyBbbmV3SGFuZGxlciwgaGFuZGxlcnNdIDogW2hhbmRsZXJzLCBuZXdIYW5kbGVyXTsKICAgIH0gZWxzZSB7CiAgICAgIGV2ZW50c1tuYW1lXSA9IG5ld0hhbmRsZXI7CiAgICB9CgogICAgZWwucGxhaW4gPSBmYWxzZTsKICB9CgogIGZ1bmN0aW9uIGdldFJhd0JpbmRpbmdBdHRyICgKICAgIGVsLAogICAgbmFtZQogICkgewogICAgcmV0dXJuIGVsLnJhd0F0dHJzTWFwWyc6JyArIG5hbWVdIHx8CiAgICAgIGVsLnJhd0F0dHJzTWFwWyd2LWJpbmQ6JyArIG5hbWVdIHx8CiAgICAgIGVsLnJhd0F0dHJzTWFwW25hbWVdCiAgfQoKICBmdW5jdGlvbiBnZXRCaW5kaW5nQXR0ciAoCiAgICBlbCwKICAgIG5hbWUsCiAgICBnZXRTdGF0aWMKICApIHsKICAgIHZhciBkeW5hbWljVmFsdWUgPQogICAgICBnZXRBbmRSZW1vdmVBdHRyKGVsLCAnOicgKyBuYW1lKSB8fAogICAgICBnZXRBbmRSZW1vdmVBdHRyKGVsLCAndi1iaW5kOicgKyBuYW1lKTsKICAgIGlmIChkeW5hbWljVmFsdWUgIT0gbnVsbCkgewogICAgICByZXR1cm4gcGFyc2VGaWx0ZXJzKGR5bmFtaWNWYWx1ZSkKICAgIH0gZWxzZSBpZiAoZ2V0U3RhdGljICE9PSBmYWxzZSkgewogICAgICB2YXIgc3RhdGljVmFsdWUgPSBnZXRBbmRSZW1vdmVBdHRyKGVsLCBuYW1lKTsKICAgICAgaWYgKHN0YXRpY1ZhbHVlICE9IG51bGwpIHsKICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoc3RhdGljVmFsdWUpCiAgICAgIH0KICAgIH0KICB9CgogIC8vIG5vdGU6IHRoaXMgb25seSByZW1vdmVzIHRoZSBhdHRyIGZyb20gdGhlIEFycmF5IChhdHRyc0xpc3QpIHNvIHRoYXQgaXQKICAvLyBkb2Vzbid0IGdldCBwcm9jZXNzZWQgYnkgcHJvY2Vzc0F0dHJzLgogIC8vIEJ5IGRlZmF1bHQgaXQgZG9lcyBOT1QgcmVtb3ZlIGl0IGZyb20gdGhlIG1hcCAoYXR0cnNNYXApIGJlY2F1c2UgdGhlIG1hcCBpcwogIC8vIG5lZWRlZCBkdXJpbmcgY29kZWdlbi4KICBmdW5jdGlvbiBnZXRBbmRSZW1vdmVBdHRyICgKICAgIGVsLAogICAgbmFtZSwKICAgIHJlbW92ZUZyb21NYXAKICApIHsKICAgIHZhciB2YWw7CiAgICBpZiAoKHZhbCA9IGVsLmF0dHJzTWFwW25hbWVdKSAhPSBudWxsKSB7CiAgICAgIHZhciBsaXN0ID0gZWwuYXR0cnNMaXN0OwogICAgICBmb3IgKHZhciBpID0gMCwgbCA9IGxpc3QubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgaWYgKGxpc3RbaV0ubmFtZSA9PT0gbmFtZSkgewogICAgICAgICAgbGlzdC5zcGxpY2UoaSwgMSk7CiAgICAgICAgICBicmVhawogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKHJlbW92ZUZyb21NYXApIHsKICAgICAgZGVsZXRlIGVsLmF0dHJzTWFwW25hbWVdOwogICAgfQogICAgcmV0dXJuIHZhbAogIH0KCiAgZnVuY3Rpb24gZ2V0QW5kUmVtb3ZlQXR0ckJ5UmVnZXggKAogICAgZWwsCiAgICBuYW1lCiAgKSB7CiAgICB2YXIgbGlzdCA9IGVsLmF0dHJzTGlzdDsKICAgIGZvciAodmFyIGkgPSAwLCBsID0gbGlzdC5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgdmFyIGF0dHIgPSBsaXN0W2ldOwogICAgICBpZiAobmFtZS50ZXN0KGF0dHIubmFtZSkpIHsKICAgICAgICBsaXN0LnNwbGljZShpLCAxKTsKICAgICAgICByZXR1cm4gYXR0cgogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiByYW5nZVNldEl0ZW0gKAogICAgaXRlbSwKICAgIHJhbmdlCiAgKSB7CiAgICBpZiAocmFuZ2UpIHsKICAgICAgaWYgKHJhbmdlLnN0YXJ0ICE9IG51bGwpIHsKICAgICAgICBpdGVtLnN0YXJ0ID0gcmFuZ2Uuc3RhcnQ7CiAgICAgIH0KICAgICAgaWYgKHJhbmdlLmVuZCAhPSBudWxsKSB7CiAgICAgICAgaXRlbS5lbmQgPSByYW5nZS5lbmQ7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBpdGVtCiAgfQoKICAvKiAgKi8KCiAgLyoqCiAgICogQ3Jvc3MtcGxhdGZvcm0gY29kZSBnZW5lcmF0aW9uIGZvciBjb21wb25lbnQgdi1tb2RlbAogICAqLwogIGZ1bmN0aW9uIGdlbkNvbXBvbmVudE1vZGVsICgKICAgIGVsLAogICAgdmFsdWUsCiAgICBtb2RpZmllcnMKICApIHsKICAgIHZhciByZWYgPSBtb2RpZmllcnMgfHwge307CiAgICB2YXIgbnVtYmVyID0gcmVmLm51bWJlcjsKICAgIHZhciB0cmltID0gcmVmLnRyaW07CgogICAgdmFyIGJhc2VWYWx1ZUV4cHJlc3Npb24gPSAnJCR2JzsKICAgIHZhciB2YWx1ZUV4cHJlc3Npb24gPSBiYXNlVmFsdWVFeHByZXNzaW9uOwogICAgaWYgKHRyaW0pIHsKICAgICAgdmFsdWVFeHByZXNzaW9uID0KICAgICAgICAiKHR5cGVvZiAiICsgYmFzZVZhbHVlRXhwcmVzc2lvbiArICIgPT09ICdzdHJpbmcnIiArCiAgICAgICAgIj8gIiArIGJhc2VWYWx1ZUV4cHJlc3Npb24gKyAiLnRyaW0oKSIgKwogICAgICAgICI6ICIgKyBiYXNlVmFsdWVFeHByZXNzaW9uICsgIikiOwogICAgfQogICAgaWYgKG51bWJlcikgewogICAgICB2YWx1ZUV4cHJlc3Npb24gPSAiX24oIiArIHZhbHVlRXhwcmVzc2lvbiArICIpIjsKICAgIH0KICAgIHZhciBhc3NpZ25tZW50ID0gZ2VuQXNzaWdubWVudENvZGUodmFsdWUsIHZhbHVlRXhwcmVzc2lvbik7CgogICAgZWwubW9kZWwgPSB7CiAgICAgIHZhbHVlOiAoIigiICsgdmFsdWUgKyAiKSIpLAogICAgICBleHByZXNzaW9uOiBKU09OLnN0cmluZ2lmeSh2YWx1ZSksCiAgICAgIGNhbGxiYWNrOiAoImZ1bmN0aW9uICgiICsgYmFzZVZhbHVlRXhwcmVzc2lvbiArICIpIHsiICsgYXNzaWdubWVudCArICJ9IikKICAgIH07CiAgfQoKICAvKioKICAgKiBDcm9zcy1wbGF0Zm9ybSBjb2RlZ2VuIGhlbHBlciBmb3IgZ2VuZXJhdGluZyB2LW1vZGVsIHZhbHVlIGFzc2lnbm1lbnQgY29kZS4KICAgKi8KICBmdW5jdGlvbiBnZW5Bc3NpZ25tZW50Q29kZSAoCiAgICB2YWx1ZSwKICAgIGFzc2lnbm1lbnQKICApIHsKICAgIHZhciByZXMgPSBwYXJzZU1vZGVsKHZhbHVlKTsKICAgIGlmIChyZXMua2V5ID09PSBudWxsKSB7CiAgICAgIHJldHVybiAodmFsdWUgKyAiPSIgKyBhc3NpZ25tZW50KQogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuICgiJHNldCgiICsgKHJlcy5leHApICsgIiwgIiArIChyZXMua2V5KSArICIsICIgKyBhc3NpZ25tZW50ICsgIikiKQogICAgfQogIH0KCiAgLyoqCiAgICogUGFyc2UgYSB2LW1vZGVsIGV4cHJlc3Npb24gaW50byBhIGJhc2UgcGF0aCBhbmQgYSBmaW5hbCBrZXkgc2VnbWVudC4KICAgKiBIYW5kbGVzIGJvdGggZG90LXBhdGggYW5kIHBvc3NpYmxlIHNxdWFyZSBicmFja2V0cy4KICAgKgogICAqIFBvc3NpYmxlIGNhc2VzOgogICAqCiAgICogLSB0ZXN0CiAgICogLSB0ZXN0W2tleV0KICAgKiAtIHRlc3RbdGVzdDFba2V5XV0KICAgKiAtIHRlc3RbImEiXVtrZXldCiAgICogLSB4eHgudGVzdFthW2FdLnRlc3QxW2tleV1dCiAgICogLSB0ZXN0Lnh4eC5hWyJhc2EiXVt0ZXN0MVtrZXldXQogICAqCiAgICovCgogIHZhciBsZW4sIHN0ciwgY2hyLCBpbmRleCQxLCBleHByZXNzaW9uUG9zLCBleHByZXNzaW9uRW5kUG9zOwoKCgogIGZ1bmN0aW9uIHBhcnNlTW9kZWwgKHZhbCkgewogICAgLy8gRml4IGh0dHBzOi8vZ2l0aHViLmNvbS92dWVqcy92dWUvcHVsbC83NzMwCiAgICAvLyBhbGxvdyB2LW1vZGVsPSJvYmoudmFsICIgKHRyYWlsaW5nIHdoaXRlc3BhY2UpCiAgICB2YWwgPSB2YWwudHJpbSgpOwogICAgbGVuID0gdmFsLmxlbmd0aDsKCiAgICBpZiAodmFsLmluZGV4T2YoJ1snKSA8IDAgfHwgdmFsLmxhc3RJbmRleE9mKCddJykgPCBsZW4gLSAxKSB7CiAgICAgIGluZGV4JDEgPSB2YWwubGFzdEluZGV4T2YoJy4nKTsKICAgICAgaWYgKGluZGV4JDEgPiAtMSkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBleHA6IHZhbC5zbGljZSgwLCBpbmRleCQxKSwKICAgICAgICAgIGtleTogJyInICsgdmFsLnNsaWNlKGluZGV4JDEgKyAxKSArICciJwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgZXhwOiB2YWwsCiAgICAgICAgICBrZXk6IG51bGwKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzdHIgPSB2YWw7CiAgICBpbmRleCQxID0gZXhwcmVzc2lvblBvcyA9IGV4cHJlc3Npb25FbmRQb3MgPSAwOwoKICAgIHdoaWxlICghZW9mKCkpIHsKICAgICAgY2hyID0gbmV4dCgpOwogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgaWYgKGlzU3RyaW5nU3RhcnQoY2hyKSkgewogICAgICAgIHBhcnNlU3RyaW5nKGNocik7CiAgICAgIH0gZWxzZSBpZiAoY2hyID09PSAweDVCKSB7CiAgICAgICAgcGFyc2VCcmFja2V0KGNocik7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gewogICAgICBleHA6IHZhbC5zbGljZSgwLCBleHByZXNzaW9uUG9zKSwKICAgICAga2V5OiB2YWwuc2xpY2UoZXhwcmVzc2lvblBvcyArIDEsIGV4cHJlc3Npb25FbmRQb3MpCiAgICB9CiAgfQoKICBmdW5jdGlvbiBuZXh0ICgpIHsKICAgIHJldHVybiBzdHIuY2hhckNvZGVBdCgrK2luZGV4JDEpCiAgfQoKICBmdW5jdGlvbiBlb2YgKCkgewogICAgcmV0dXJuIGluZGV4JDEgPj0gbGVuCiAgfQoKICBmdW5jdGlvbiBpc1N0cmluZ1N0YXJ0IChjaHIpIHsKICAgIHJldHVybiBjaHIgPT09IDB4MjIgfHwgY2hyID09PSAweDI3CiAgfQoKICBmdW5jdGlvbiBwYXJzZUJyYWNrZXQgKGNocikgewogICAgdmFyIGluQnJhY2tldCA9IDE7CiAgICBleHByZXNzaW9uUG9zID0gaW5kZXgkMTsKICAgIHdoaWxlICghZW9mKCkpIHsKICAgICAgY2hyID0gbmV4dCgpOwogICAgICBpZiAoaXNTdHJpbmdTdGFydChjaHIpKSB7CiAgICAgICAgcGFyc2VTdHJpbmcoY2hyKTsKICAgICAgICBjb250aW51ZQogICAgICB9CiAgICAgIGlmIChjaHIgPT09IDB4NUIpIHsgaW5CcmFja2V0Kys7IH0KICAgICAgaWYgKGNociA9PT0gMHg1RCkgeyBpbkJyYWNrZXQtLTsgfQogICAgICBpZiAoaW5CcmFja2V0ID09PSAwKSB7CiAgICAgICAgZXhwcmVzc2lvbkVuZFBvcyA9IGluZGV4JDE7CiAgICAgICAgYnJlYWsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gcGFyc2VTdHJpbmcgKGNocikgewogICAgdmFyIHN0cmluZ1F1b3RlID0gY2hyOwogICAgd2hpbGUgKCFlb2YoKSkgewogICAgICBjaHIgPSBuZXh0KCk7CiAgICAgIGlmIChjaHIgPT09IHN0cmluZ1F1b3RlKSB7CiAgICAgICAgYnJlYWsKICAgICAgfQogICAgfQogIH0KCiAgLyogICovCgogIHZhciB3YXJuJDE7CgogIC8vIGluIHNvbWUgY2FzZXMsIHRoZSBldmVudCB1c2VkIGhhcyB0byBiZSBkZXRlcm1pbmVkIGF0IHJ1bnRpbWUKICAvLyBzbyB3ZSB1c2VkIHNvbWUgcmVzZXJ2ZWQgdG9rZW5zIGR1cmluZyBjb21waWxlLgogIHZhciBSQU5HRV9UT0tFTiA9ICdfX3InOwogIHZhciBDSEVDS0JPWF9SQURJT19UT0tFTiA9ICdfX2MnOwoKICBmdW5jdGlvbiBtb2RlbCAoCiAgICBlbCwKICAgIGRpciwKICAgIF93YXJuCiAgKSB7CiAgICB3YXJuJDEgPSBfd2FybjsKICAgIHZhciB2YWx1ZSA9IGRpci52YWx1ZTsKICAgIHZhciBtb2RpZmllcnMgPSBkaXIubW9kaWZpZXJzOwogICAgdmFyIHRhZyA9IGVsLnRhZzsKICAgIHZhciB0eXBlID0gZWwuYXR0cnNNYXAudHlwZTsKCiAgICB7CiAgICAgIC8vIGlucHV0cyB3aXRoIHR5cGU9ImZpbGUiIGFyZSByZWFkIG9ubHkgYW5kIHNldHRpbmcgdGhlIGlucHV0J3MKICAgICAgLy8gdmFsdWUgd2lsbCB0aHJvdyBhbiBlcnJvci4KICAgICAgaWYgKHRhZyA9PT0gJ2lucHV0JyAmJiB0eXBlID09PSAnZmlsZScpIHsKICAgICAgICB3YXJuJDEoCiAgICAgICAgICAiPCIgKyAoZWwudGFnKSArICIgdi1tb2RlbD1cIiIgKyB2YWx1ZSArICJcIiB0eXBlPVwiZmlsZVwiPjpcbiIgKwogICAgICAgICAgIkZpbGUgaW5wdXRzIGFyZSByZWFkIG9ubHkuIFVzZSBhIHYtb246Y2hhbmdlIGxpc3RlbmVyIGluc3RlYWQuIiwKICAgICAgICAgIGVsLnJhd0F0dHJzTWFwWyd2LW1vZGVsJ10KICAgICAgICApOwogICAgICB9CiAgICB9CgogICAgaWYgKGVsLmNvbXBvbmVudCkgewogICAgICBnZW5Db21wb25lbnRNb2RlbChlbCwgdmFsdWUsIG1vZGlmaWVycyk7CiAgICAgIC8vIGNvbXBvbmVudCB2LW1vZGVsIGRvZXNuJ3QgbmVlZCBleHRyYSBydW50aW1lCiAgICAgIHJldHVybiBmYWxzZQogICAgfSBlbHNlIGlmICh0YWcgPT09ICdzZWxlY3QnKSB7CiAgICAgIGdlblNlbGVjdChlbCwgdmFsdWUsIG1vZGlmaWVycyk7CiAgICB9IGVsc2UgaWYgKHRhZyA9PT0gJ2lucHV0JyAmJiB0eXBlID09PSAnY2hlY2tib3gnKSB7CiAgICAgIGdlbkNoZWNrYm94TW9kZWwoZWwsIHZhbHVlLCBtb2RpZmllcnMpOwogICAgfSBlbHNlIGlmICh0YWcgPT09ICdpbnB1dCcgJiYgdHlwZSA9PT0gJ3JhZGlvJykgewogICAgICBnZW5SYWRpb01vZGVsKGVsLCB2YWx1ZSwgbW9kaWZpZXJzKTsKICAgIH0gZWxzZSBpZiAodGFnID09PSAnaW5wdXQnIHx8IHRhZyA9PT0gJ3RleHRhcmVhJykgewogICAgICBnZW5EZWZhdWx0TW9kZWwoZWwsIHZhbHVlLCBtb2RpZmllcnMpOwogICAgfSBlbHNlIGlmICghY29uZmlnLmlzUmVzZXJ2ZWRUYWcodGFnKSkgewogICAgICBnZW5Db21wb25lbnRNb2RlbChlbCwgdmFsdWUsIG1vZGlmaWVycyk7CiAgICAgIC8vIGNvbXBvbmVudCB2LW1vZGVsIGRvZXNuJ3QgbmVlZCBleHRyYSBydW50aW1lCiAgICAgIHJldHVybiBmYWxzZQogICAgfSBlbHNlIHsKICAgICAgd2FybiQxKAogICAgICAgICI8IiArIChlbC50YWcpICsgIiB2LW1vZGVsPVwiIiArIHZhbHVlICsgIlwiPjogIiArCiAgICAgICAgInYtbW9kZWwgaXMgbm90IHN1cHBvcnRlZCBvbiB0aGlzIGVsZW1lbnQgdHlwZS4gIiArCiAgICAgICAgJ0lmIHlvdSBhcmUgd29ya2luZyB3aXRoIGNvbnRlbnRlZGl0YWJsZSwgaXRcJ3MgcmVjb21tZW5kZWQgdG8gJyArCiAgICAgICAgJ3dyYXAgYSBsaWJyYXJ5IGRlZGljYXRlZCBmb3IgdGhhdCBwdXJwb3NlIGluc2lkZSBhIGN1c3RvbSBjb21wb25lbnQuJywKICAgICAgICBlbC5yYXdBdHRyc01hcFsndi1tb2RlbCddCiAgICAgICk7CiAgICB9CgogICAgLy8gZW5zdXJlIHJ1bnRpbWUgZGlyZWN0aXZlIG1ldGFkYXRhCiAgICByZXR1cm4gdHJ1ZQogIH0KCiAgZnVuY3Rpb24gZ2VuQ2hlY2tib3hNb2RlbCAoCiAgICBlbCwKICAgIHZhbHVlLAogICAgbW9kaWZpZXJzCiAgKSB7CiAgICB2YXIgbnVtYmVyID0gbW9kaWZpZXJzICYmIG1vZGlmaWVycy5udW1iZXI7CiAgICB2YXIgdmFsdWVCaW5kaW5nID0gZ2V0QmluZGluZ0F0dHIoZWwsICd2YWx1ZScpIHx8ICdudWxsJzsKICAgIHZhciB0cnVlVmFsdWVCaW5kaW5nID0gZ2V0QmluZGluZ0F0dHIoZWwsICd0cnVlLXZhbHVlJykgfHwgJ3RydWUnOwogICAgdmFyIGZhbHNlVmFsdWVCaW5kaW5nID0gZ2V0QmluZGluZ0F0dHIoZWwsICdmYWxzZS12YWx1ZScpIHx8ICdmYWxzZSc7CiAgICBhZGRQcm9wKGVsLCAnY2hlY2tlZCcsCiAgICAgICJBcnJheS5pc0FycmF5KCIgKyB2YWx1ZSArICIpIiArCiAgICAgICI/X2koIiArIHZhbHVlICsgIiwiICsgdmFsdWVCaW5kaW5nICsgIik+LTEiICsgKAogICAgICAgIHRydWVWYWx1ZUJpbmRpbmcgPT09ICd0cnVlJwogICAgICAgICAgPyAoIjooIiArIHZhbHVlICsgIikiKQogICAgICAgICAgOiAoIjpfcSgiICsgdmFsdWUgKyAiLCIgKyB0cnVlVmFsdWVCaW5kaW5nICsgIikiKQogICAgICApCiAgICApOwogICAgYWRkSGFuZGxlcihlbCwgJ2NoYW5nZScsCiAgICAgICJ2YXIgJCRhPSIgKyB2YWx1ZSArICIsIiArCiAgICAgICAgICAnJCRlbD0kZXZlbnQudGFyZ2V0LCcgKwogICAgICAgICAgIiQkYz0kJGVsLmNoZWNrZWQ/KCIgKyB0cnVlVmFsdWVCaW5kaW5nICsgIik6KCIgKyBmYWxzZVZhbHVlQmluZGluZyArICIpOyIgKwogICAgICAnaWYoQXJyYXkuaXNBcnJheSgkJGEpKXsnICsKICAgICAgICAidmFyICQkdj0iICsgKG51bWJlciA/ICdfbignICsgdmFsdWVCaW5kaW5nICsgJyknIDogdmFsdWVCaW5kaW5nKSArICIsIiArCiAgICAgICAgICAgICckJGk9X2koJCRhLCQkdik7JyArCiAgICAgICAgImlmKCQkZWwuY2hlY2tlZCl7JCRpPDAmJigiICsgKGdlbkFzc2lnbm1lbnRDb2RlKHZhbHVlLCAnJCRhLmNvbmNhdChbJCR2XSknKSkgKyAiKX0iICsKICAgICAgICAiZWxzZXskJGk+LTEmJigiICsgKGdlbkFzc2lnbm1lbnRDb2RlKHZhbHVlLCAnJCRhLnNsaWNlKDAsJCRpKS5jb25jYXQoJCRhLnNsaWNlKCQkaSsxKSknKSkgKyAiKX0iICsKICAgICAgIn1lbHNleyIgKyAoZ2VuQXNzaWdubWVudENvZGUodmFsdWUsICckJGMnKSkgKyAifSIsCiAgICAgIG51bGwsIHRydWUKICAgICk7CiAgfQoKICBmdW5jdGlvbiBnZW5SYWRpb01vZGVsICgKICAgIGVsLAogICAgdmFsdWUsCiAgICBtb2RpZmllcnMKICApIHsKICAgIHZhciBudW1iZXIgPSBtb2RpZmllcnMgJiYgbW9kaWZpZXJzLm51bWJlcjsKICAgIHZhciB2YWx1ZUJpbmRpbmcgPSBnZXRCaW5kaW5nQXR0cihlbCwgJ3ZhbHVlJykgfHwgJ251bGwnOwogICAgdmFsdWVCaW5kaW5nID0gbnVtYmVyID8gKCJfbigiICsgdmFsdWVCaW5kaW5nICsgIikiKSA6IHZhbHVlQmluZGluZzsKICAgIGFkZFByb3AoZWwsICdjaGVja2VkJywgKCJfcSgiICsgdmFsdWUgKyAiLCIgKyB2YWx1ZUJpbmRpbmcgKyAiKSIpKTsKICAgIGFkZEhhbmRsZXIoZWwsICdjaGFuZ2UnLCBnZW5Bc3NpZ25tZW50Q29kZSh2YWx1ZSwgdmFsdWVCaW5kaW5nKSwgbnVsbCwgdHJ1ZSk7CiAgfQoKICBmdW5jdGlvbiBnZW5TZWxlY3QgKAogICAgZWwsCiAgICB2YWx1ZSwKICAgIG1vZGlmaWVycwogICkgewogICAgdmFyIG51bWJlciA9IG1vZGlmaWVycyAmJiBtb2RpZmllcnMubnVtYmVyOwogICAgdmFyIHNlbGVjdGVkVmFsID0gIkFycmF5LnByb3RvdHlwZS5maWx0ZXIiICsKICAgICAgIi5jYWxsKCRldmVudC50YXJnZXQub3B0aW9ucyxmdW5jdGlvbihvKXtyZXR1cm4gby5zZWxlY3RlZH0pIiArCiAgICAgICIubWFwKGZ1bmN0aW9uKG8pe3ZhciB2YWwgPSBcIl92YWx1ZVwiIGluIG8gPyBvLl92YWx1ZSA6IG8udmFsdWU7IiArCiAgICAgICJyZXR1cm4gIiArIChudW1iZXIgPyAnX24odmFsKScgOiAndmFsJykgKyAifSkiOwoKICAgIHZhciBhc3NpZ25tZW50ID0gJyRldmVudC50YXJnZXQubXVsdGlwbGUgPyAkJHNlbGVjdGVkVmFsIDogJCRzZWxlY3RlZFZhbFswXSc7CiAgICB2YXIgY29kZSA9ICJ2YXIgJCRzZWxlY3RlZFZhbCA9ICIgKyBzZWxlY3RlZFZhbCArICI7IjsKICAgIGNvZGUgPSBjb2RlICsgIiAiICsgKGdlbkFzc2lnbm1lbnRDb2RlKHZhbHVlLCBhc3NpZ25tZW50KSk7CiAgICBhZGRIYW5kbGVyKGVsLCAnY2hhbmdlJywgY29kZSwgbnVsbCwgdHJ1ZSk7CiAgfQoKICBmdW5jdGlvbiBnZW5EZWZhdWx0TW9kZWwgKAogICAgZWwsCiAgICB2YWx1ZSwKICAgIG1vZGlmaWVycwogICkgewogICAgdmFyIHR5cGUgPSBlbC5hdHRyc01hcC50eXBlOwoKICAgIC8vIHdhcm4gaWYgdi1iaW5kOnZhbHVlIGNvbmZsaWN0cyB3aXRoIHYtbW9kZWwKICAgIC8vIGV4Y2VwdCBmb3IgaW5wdXRzIHdpdGggdi1iaW5kOnR5cGUKICAgIHsKICAgICAgdmFyIHZhbHVlJDEgPSBlbC5hdHRyc01hcFsndi1iaW5kOnZhbHVlJ10gfHwgZWwuYXR0cnNNYXBbJzp2YWx1ZSddOwogICAgICB2YXIgdHlwZUJpbmRpbmcgPSBlbC5hdHRyc01hcFsndi1iaW5kOnR5cGUnXSB8fCBlbC5hdHRyc01hcFsnOnR5cGUnXTsKICAgICAgaWYgKHZhbHVlJDEgJiYgIXR5cGVCaW5kaW5nKSB7CiAgICAgICAgdmFyIGJpbmRpbmcgPSBlbC5hdHRyc01hcFsndi1iaW5kOnZhbHVlJ10gPyAndi1iaW5kOnZhbHVlJyA6ICc6dmFsdWUnOwogICAgICAgIHdhcm4kMSgKICAgICAgICAgIGJpbmRpbmcgKyAiPVwiIiArIHZhbHVlJDEgKyAiXCIgY29uZmxpY3RzIHdpdGggdi1tb2RlbCBvbiB0aGUgc2FtZSBlbGVtZW50ICIgKwogICAgICAgICAgJ2JlY2F1c2UgdGhlIGxhdHRlciBhbHJlYWR5IGV4cGFuZHMgdG8gYSB2YWx1ZSBiaW5kaW5nIGludGVybmFsbHknLAogICAgICAgICAgZWwucmF3QXR0cnNNYXBbYmluZGluZ10KICAgICAgICApOwogICAgICB9CiAgICB9CgogICAgdmFyIHJlZiA9IG1vZGlmaWVycyB8fCB7fTsKICAgIHZhciBsYXp5ID0gcmVmLmxhenk7CiAgICB2YXIgbnVtYmVyID0gcmVmLm51bWJlcjsKICAgIHZhciB0cmltID0gcmVmLnRyaW07CiAgICB2YXIgbmVlZENvbXBvc2l0aW9uR3VhcmQgPSAhbGF6eSAmJiB0eXBlICE9PSAncmFuZ2UnOwogICAgdmFyIGV2ZW50ID0gbGF6eQogICAgICA/ICdjaGFuZ2UnCiAgICAgIDogdHlwZSA9PT0gJ3JhbmdlJwogICAgICAgID8gUkFOR0VfVE9LRU4KICAgICAgICA6ICdpbnB1dCc7CgogICAgdmFyIHZhbHVlRXhwcmVzc2lvbiA9ICckZXZlbnQudGFyZ2V0LnZhbHVlJzsKICAgIGlmICh0cmltKSB7CiAgICAgIHZhbHVlRXhwcmVzc2lvbiA9ICIkZXZlbnQudGFyZ2V0LnZhbHVlLnRyaW0oKSI7CiAgICB9CiAgICBpZiAobnVtYmVyKSB7CiAgICAgIHZhbHVlRXhwcmVzc2lvbiA9ICJfbigiICsgdmFsdWVFeHByZXNzaW9uICsgIikiOwogICAgfQoKICAgIHZhciBjb2RlID0gZ2VuQXNzaWdubWVudENvZGUodmFsdWUsIHZhbHVlRXhwcmVzc2lvbik7CiAgICBpZiAobmVlZENvbXBvc2l0aW9uR3VhcmQpIHsKICAgICAgY29kZSA9ICJpZigkZXZlbnQudGFyZ2V0LmNvbXBvc2luZylyZXR1cm47IiArIGNvZGU7CiAgICB9CgogICAgYWRkUHJvcChlbCwgJ3ZhbHVlJywgKCIoIiArIHZhbHVlICsgIikiKSk7CiAgICBhZGRIYW5kbGVyKGVsLCBldmVudCwgY29kZSwgbnVsbCwgdHJ1ZSk7CiAgICBpZiAodHJpbSB8fCBudW1iZXIpIHsKICAgICAgYWRkSGFuZGxlcihlbCwgJ2JsdXInLCAnJGZvcmNlVXBkYXRlKCknKTsKICAgIH0KICB9CgogIC8qICAqLwoKICAvLyBub3JtYWxpemUgdi1tb2RlbCBldmVudCB0b2tlbnMgdGhhdCBjYW4gb25seSBiZSBkZXRlcm1pbmVkIGF0IHJ1bnRpbWUuCiAgLy8gaXQncyBpbXBvcnRhbnQgdG8gcGxhY2UgdGhlIGV2ZW50IGFzIHRoZSBmaXJzdCBpbiB0aGUgYXJyYXkgYmVjYXVzZQogIC8vIHRoZSB3aG9sZSBwb2ludCBpcyBlbnN1cmluZyB0aGUgdi1tb2RlbCBjYWxsYmFjayBnZXRzIGNhbGxlZCBiZWZvcmUKICAvLyB1c2VyLWF0dGFjaGVkIGhhbmRsZXJzLgogIGZ1bmN0aW9uIG5vcm1hbGl6ZUV2ZW50cyAob24pIHsKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgaWYgKGlzRGVmKG9uW1JBTkdFX1RPS0VOXSkpIHsKICAgICAgLy8gSUUgaW5wdXRbdHlwZT1yYW5nZV0gb25seSBzdXBwb3J0cyBgY2hhbmdlYCBldmVudAogICAgICB2YXIgZXZlbnQgPSBpc0lFID8gJ2NoYW5nZScgOiAnaW5wdXQnOwogICAgICBvbltldmVudF0gPSBbXS5jb25jYXQob25bUkFOR0VfVE9LRU5dLCBvbltldmVudF0gfHwgW10pOwogICAgICBkZWxldGUgb25bUkFOR0VfVE9LRU5dOwogICAgfQogICAgLy8gVGhpcyB3YXMgb3JpZ2luYWxseSBpbnRlbmRlZCB0byBmaXggIzQ1MjEgYnV0IG5vIGxvbmdlciBuZWNlc3NhcnkKICAgIC8vIGFmdGVyIDIuNS4gS2VlcGluZyBpdCBmb3IgYmFja3dhcmRzIGNvbXBhdCB3aXRoIGdlbmVyYXRlZCBjb2RlIGZyb20gPCAyLjQKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgaWYgKGlzRGVmKG9uW0NIRUNLQk9YX1JBRElPX1RPS0VOXSkpIHsKICAgICAgb24uY2hhbmdlID0gW10uY29uY2F0KG9uW0NIRUNLQk9YX1JBRElPX1RPS0VOXSwgb24uY2hhbmdlIHx8IFtdKTsKICAgICAgZGVsZXRlIG9uW0NIRUNLQk9YX1JBRElPX1RPS0VOXTsKICAgIH0KICB9CgogIHZhciB0YXJnZXQkMTsKCiAgZnVuY3Rpb24gY3JlYXRlT25jZUhhbmRsZXIkMSAoZXZlbnQsIGhhbmRsZXIsIGNhcHR1cmUpIHsKICAgIHZhciBfdGFyZ2V0ID0gdGFyZ2V0JDE7IC8vIHNhdmUgY3VycmVudCB0YXJnZXQgZWxlbWVudCBpbiBjbG9zdXJlCiAgICByZXR1cm4gZnVuY3Rpb24gb25jZUhhbmRsZXIgKCkgewogICAgICB2YXIgcmVzID0gaGFuZGxlci5hcHBseShudWxsLCBhcmd1bWVudHMpOwogICAgICBpZiAocmVzICE9PSBudWxsKSB7CiAgICAgICAgcmVtb3ZlJDIoZXZlbnQsIG9uY2VIYW5kbGVyLCBjYXB0dXJlLCBfdGFyZ2V0KTsKICAgICAgfQogICAgfQogIH0KCiAgLy8gIzk0NDY6IEZpcmVmb3ggPD0gNTMgKGluIHBhcnRpY3VsYXIsIEVTUiA1MikgaGFzIGluY29ycmVjdCBFdmVudC50aW1lU3RhbXAKICAvLyBpbXBsZW1lbnRhdGlvbiBhbmQgZG9lcyBub3QgZmlyZSBtaWNyb3Rhc2tzIGluIGJldHdlZW4gZXZlbnQgcHJvcGFnYXRpb24sIHNvCiAgLy8gc2FmZSB0byBleGNsdWRlLgogIHZhciB1c2VNaWNyb3Rhc2tGaXggPSBpc1VzaW5nTWljcm9UYXNrICYmICEoaXNGRiAmJiBOdW1iZXIoaXNGRlsxXSkgPD0gNTMpOwoKICBmdW5jdGlvbiBhZGQkMSAoCiAgICBuYW1lLAogICAgaGFuZGxlciwKICAgIGNhcHR1cmUsCiAgICBwYXNzaXZlCiAgKSB7CiAgICAvLyBhc3luYyBlZGdlIGNhc2UgIzY1NjY6IGlubmVyIGNsaWNrIGV2ZW50IHRyaWdnZXJzIHBhdGNoLCBldmVudCBoYW5kbGVyCiAgICAvLyBhdHRhY2hlZCB0byBvdXRlciBlbGVtZW50IGR1cmluZyBwYXRjaCwgYW5kIHRyaWdnZXJlZCBhZ2Fpbi4gVGhpcwogICAgLy8gaGFwcGVucyBiZWNhdXNlIGJyb3dzZXJzIGZpcmUgbWljcm90YXNrIHRpY2tzIGJldHdlZW4gZXZlbnQgcHJvcGFnYXRpb24uCiAgICAvLyB0aGUgc29sdXRpb24gaXMgc2ltcGxlOiB3ZSBzYXZlIHRoZSB0aW1lc3RhbXAgd2hlbiBhIGhhbmRsZXIgaXMgYXR0YWNoZWQsCiAgICAvLyBhbmQgdGhlIGhhbmRsZXIgd291bGQgb25seSBmaXJlIGlmIHRoZSBldmVudCBwYXNzZWQgdG8gaXQgd2FzIGZpcmVkCiAgICAvLyBBRlRFUiBpdCB3YXMgYXR0YWNoZWQuCiAgICBpZiAodXNlTWljcm90YXNrRml4KSB7CiAgICAgIHZhciBhdHRhY2hlZFRpbWVzdGFtcCA9IGN1cnJlbnRGbHVzaFRpbWVzdGFtcDsKICAgICAgdmFyIG9yaWdpbmFsID0gaGFuZGxlcjsKICAgICAgaGFuZGxlciA9IG9yaWdpbmFsLl93cmFwcGVyID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICBpZiAoCiAgICAgICAgICAvLyBubyBidWJibGluZywgc2hvdWxkIGFsd2F5cyBmaXJlLgogICAgICAgICAgLy8gdGhpcyBpcyBqdXN0IGEgc2FmZXR5IG5ldCBpbiBjYXNlIGV2ZW50LnRpbWVTdGFtcCBpcyB1bnJlbGlhYmxlIGluCiAgICAgICAgICAvLyBjZXJ0YWluIHdlaXJkIGVudmlyb25tZW50cy4uLgogICAgICAgICAgZS50YXJnZXQgPT09IGUuY3VycmVudFRhcmdldCB8fAogICAgICAgICAgLy8gZXZlbnQgaXMgZmlyZWQgYWZ0ZXIgaGFuZGxlciBhdHRhY2htZW50CiAgICAgICAgICBlLnRpbWVTdGFtcCA+PSBhdHRhY2hlZFRpbWVzdGFtcCB8fAogICAgICAgICAgLy8gYmFpbCBmb3IgZW52aXJvbm1lbnRzIHRoYXQgaGF2ZSBidWdneSBldmVudC50aW1lU3RhbXAgaW1wbGVtZW50YXRpb25zCiAgICAgICAgICAvLyAjOTQ2MiBpT1MgOSBidWc6IGV2ZW50LnRpbWVTdGFtcCBpcyAwIGFmdGVyIGhpc3RvcnkucHVzaFN0YXRlCiAgICAgICAgICAvLyAjOTY4MSBRdFdlYkVuZ2luZSBldmVudC50aW1lU3RhbXAgaXMgbmVnYXRpdmUgdmFsdWUKICAgICAgICAgIGUudGltZVN0YW1wIDw9IDAgfHwKICAgICAgICAgIC8vICM5NDQ4IGJhaWwgaWYgZXZlbnQgaXMgZmlyZWQgaW4gYW5vdGhlciBkb2N1bWVudCBpbiBhIG11bHRpLXBhZ2UKICAgICAgICAgIC8vIGVsZWN0cm9uL253LmpzIGFwcCwgc2luY2UgZXZlbnQudGltZVN0YW1wIHdpbGwgYmUgdXNpbmcgYSBkaWZmZXJlbnQKICAgICAgICAgIC8vIHN0YXJ0aW5nIHJlZmVyZW5jZQogICAgICAgICAgZS50YXJnZXQub3duZXJEb2N1bWVudCAhPT0gZG9jdW1lbnQKICAgICAgICApIHsKICAgICAgICAgIHJldHVybiBvcmlnaW5hbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpCiAgICAgICAgfQogICAgICB9OwogICAgfQogICAgdGFyZ2V0JDEuYWRkRXZlbnRMaXN0ZW5lcigKICAgICAgbmFtZSwKICAgICAgaGFuZGxlciwKICAgICAgc3VwcG9ydHNQYXNzaXZlCiAgICAgICAgPyB7IGNhcHR1cmU6IGNhcHR1cmUsIHBhc3NpdmU6IHBhc3NpdmUgfQogICAgICAgIDogY2FwdHVyZQogICAgKTsKICB9CgogIGZ1bmN0aW9uIHJlbW92ZSQyICgKICAgIG5hbWUsCiAgICBoYW5kbGVyLAogICAgY2FwdHVyZSwKICAgIF90YXJnZXQKICApIHsKICAgIChfdGFyZ2V0IHx8IHRhcmdldCQxKS5yZW1vdmVFdmVudExpc3RlbmVyKAogICAgICBuYW1lLAogICAgICBoYW5kbGVyLl93cmFwcGVyIHx8IGhhbmRsZXIsCiAgICAgIGNhcHR1cmUKICAgICk7CiAgfQoKICBmdW5jdGlvbiB1cGRhdGVET01MaXN0ZW5lcnMgKG9sZFZub2RlLCB2bm9kZSkgewogICAgaWYgKGlzVW5kZWYob2xkVm5vZGUuZGF0YS5vbikgJiYgaXNVbmRlZih2bm9kZS5kYXRhLm9uKSkgewogICAgICByZXR1cm4KICAgIH0KICAgIHZhciBvbiA9IHZub2RlLmRhdGEub24gfHwge307CiAgICB2YXIgb2xkT24gPSBvbGRWbm9kZS5kYXRhLm9uIHx8IHt9OwogICAgdGFyZ2V0JDEgPSB2bm9kZS5lbG07CiAgICBub3JtYWxpemVFdmVudHMob24pOwogICAgdXBkYXRlTGlzdGVuZXJzKG9uLCBvbGRPbiwgYWRkJDEsIHJlbW92ZSQyLCBjcmVhdGVPbmNlSGFuZGxlciQxLCB2bm9kZS5jb250ZXh0KTsKICAgIHRhcmdldCQxID0gdW5kZWZpbmVkOwogIH0KCiAgdmFyIGV2ZW50cyA9IHsKICAgIGNyZWF0ZTogdXBkYXRlRE9NTGlzdGVuZXJzLAogICAgdXBkYXRlOiB1cGRhdGVET01MaXN0ZW5lcnMKICB9OwoKICAvKiAgKi8KCiAgdmFyIHN2Z0NvbnRhaW5lcjsKCiAgZnVuY3Rpb24gdXBkYXRlRE9NUHJvcHMgKG9sZFZub2RlLCB2bm9kZSkgewogICAgaWYgKGlzVW5kZWYob2xkVm5vZGUuZGF0YS5kb21Qcm9wcykgJiYgaXNVbmRlZih2bm9kZS5kYXRhLmRvbVByb3BzKSkgewogICAgICByZXR1cm4KICAgIH0KICAgIHZhciBrZXksIGN1cjsKICAgIHZhciBlbG0gPSB2bm9kZS5lbG07CiAgICB2YXIgb2xkUHJvcHMgPSBvbGRWbm9kZS5kYXRhLmRvbVByb3BzIHx8IHt9OwogICAgdmFyIHByb3BzID0gdm5vZGUuZGF0YS5kb21Qcm9wcyB8fCB7fTsKICAgIC8vIGNsb25lIG9ic2VydmVkIG9iamVjdHMsIGFzIHRoZSB1c2VyIHByb2JhYmx5IHdhbnRzIHRvIG11dGF0ZSBpdAogICAgaWYgKGlzRGVmKHByb3BzLl9fb2JfXykpIHsKICAgICAgcHJvcHMgPSB2bm9kZS5kYXRhLmRvbVByb3BzID0gZXh0ZW5kKHt9LCBwcm9wcyk7CiAgICB9CgogICAgZm9yIChrZXkgaW4gb2xkUHJvcHMpIHsKICAgICAgaWYgKCEoa2V5IGluIHByb3BzKSkgewogICAgICAgIGVsbVtrZXldID0gJyc7CiAgICAgIH0KICAgIH0KCiAgICBmb3IgKGtleSBpbiBwcm9wcykgewogICAgICBjdXIgPSBwcm9wc1trZXldOwogICAgICAvLyBpZ25vcmUgY2hpbGRyZW4gaWYgdGhlIG5vZGUgaGFzIHRleHRDb250ZW50IG9yIGlubmVySFRNTCwKICAgICAgLy8gYXMgdGhlc2Ugd2lsbCB0aHJvdyBhd2F5IGV4aXN0aW5nIERPTSBub2RlcyBhbmQgY2F1c2UgcmVtb3ZhbCBlcnJvcnMKICAgICAgLy8gb24gc3Vic2VxdWVudCBwYXRjaGVzICgjMzM2MCkKICAgICAgaWYgKGtleSA9PT0gJ3RleHRDb250ZW50JyB8fCBrZXkgPT09ICdpbm5lckhUTUwnKSB7CiAgICAgICAgaWYgKHZub2RlLmNoaWxkcmVuKSB7IHZub2RlLmNoaWxkcmVuLmxlbmd0aCA9IDA7IH0KICAgICAgICBpZiAoY3VyID09PSBvbGRQcm9wc1trZXldKSB7IGNvbnRpbnVlIH0KICAgICAgICAvLyAjNjYwMSB3b3JrIGFyb3VuZCBDaHJvbWUgdmVyc2lvbiA8PSA1NSBidWcgd2hlcmUgc2luZ2xlIHRleHROb2RlCiAgICAgICAgLy8gcmVwbGFjZWQgYnkgaW5uZXJIVE1ML3RleHRDb250ZW50IHJldGFpbnMgaXRzIHBhcmVudE5vZGUgcHJvcGVydHkKICAgICAgICBpZiAoZWxtLmNoaWxkTm9kZXMubGVuZ3RoID09PSAxKSB7CiAgICAgICAgICBlbG0ucmVtb3ZlQ2hpbGQoZWxtLmNoaWxkTm9kZXNbMF0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKGtleSA9PT0gJ3ZhbHVlJyAmJiBlbG0udGFnTmFtZSAhPT0gJ1BST0dSRVNTJykgewogICAgICAgIC8vIHN0b3JlIHZhbHVlIGFzIF92YWx1ZSBhcyB3ZWxsIHNpbmNlCiAgICAgICAgLy8gbm9uLXN0cmluZyB2YWx1ZXMgd2lsbCBiZSBzdHJpbmdpZmllZAogICAgICAgIGVsbS5fdmFsdWUgPSBjdXI7CiAgICAgICAgLy8gYXZvaWQgcmVzZXR0aW5nIGN1cnNvciBwb3NpdGlvbiB3aGVuIHZhbHVlIGlzIHRoZSBzYW1lCiAgICAgICAgdmFyIHN0ckN1ciA9IGlzVW5kZWYoY3VyKSA/ICcnIDogU3RyaW5nKGN1cik7CiAgICAgICAgaWYgKHNob3VsZFVwZGF0ZVZhbHVlKGVsbSwgc3RyQ3VyKSkgewogICAgICAgICAgZWxtLnZhbHVlID0gc3RyQ3VyOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChrZXkgPT09ICdpbm5lckhUTUwnICYmIGlzU1ZHKGVsbS50YWdOYW1lKSAmJiBpc1VuZGVmKGVsbS5pbm5lckhUTUwpKSB7CiAgICAgICAgLy8gSUUgZG9lc24ndCBzdXBwb3J0IGlubmVySFRNTCBmb3IgU1ZHIGVsZW1lbnRzCiAgICAgICAgc3ZnQ29udGFpbmVyID0gc3ZnQ29udGFpbmVyIHx8IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICAgIHN2Z0NvbnRhaW5lci5pbm5lckhUTUwgPSAiPHN2Zz4iICsgY3VyICsgIjwvc3ZnPiI7CiAgICAgICAgdmFyIHN2ZyA9IHN2Z0NvbnRhaW5lci5maXJzdENoaWxkOwogICAgICAgIHdoaWxlIChlbG0uZmlyc3RDaGlsZCkgewogICAgICAgICAgZWxtLnJlbW92ZUNoaWxkKGVsbS5maXJzdENoaWxkKTsKICAgICAgICB9CiAgICAgICAgd2hpbGUgKHN2Zy5maXJzdENoaWxkKSB7CiAgICAgICAgICBlbG0uYXBwZW5kQ2hpbGQoc3ZnLmZpcnN0Q2hpbGQpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICgKICAgICAgICAvLyBza2lwIHRoZSB1cGRhdGUgaWYgb2xkIGFuZCBuZXcgVkRPTSBzdGF0ZSBpcyB0aGUgc2FtZS4KICAgICAgICAvLyBgdmFsdWVgIGlzIGhhbmRsZWQgc2VwYXJhdGVseSBiZWNhdXNlIHRoZSBET00gdmFsdWUgbWF5IGJlIHRlbXBvcmFyaWx5CiAgICAgICAgLy8gb3V0IG9mIHN5bmMgd2l0aCBWRE9NIHN0YXRlIGR1ZSB0byBmb2N1cywgY29tcG9zaXRpb24gYW5kIG1vZGlmaWVycy4KICAgICAgICAvLyBUaGlzICAjNDUyMSBieSBza2lwcGluZyB0aGUgdW5uZWNlc2FycnkgYGNoZWNrZWRgIHVwZGF0ZS4KICAgICAgICBjdXIgIT09IG9sZFByb3BzW2tleV0KICAgICAgKSB7CiAgICAgICAgLy8gc29tZSBwcm9wZXJ0eSB1cGRhdGVzIGNhbiB0aHJvdwogICAgICAgIC8vIGUuZy4gYHZhbHVlYCBvbiA8cHJvZ3Jlc3M+IHcvIG5vbi1maW5pdGUgdmFsdWUKICAgICAgICB0cnkgewogICAgICAgICAgZWxtW2tleV0gPSBjdXI7CiAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgfQogICAgfQogIH0KCiAgLy8gY2hlY2sgcGxhdGZvcm1zL3dlYi91dGlsL2F0dHJzLmpzIGFjY2VwdFZhbHVlCgoKICBmdW5jdGlvbiBzaG91bGRVcGRhdGVWYWx1ZSAoZWxtLCBjaGVja1ZhbCkgewogICAgcmV0dXJuICghZWxtLmNvbXBvc2luZyAmJiAoCiAgICAgIGVsbS50YWdOYW1lID09PSAnT1BUSU9OJyB8fAogICAgICBpc05vdEluRm9jdXNBbmREaXJ0eShlbG0sIGNoZWNrVmFsKSB8fAogICAgICBpc0RpcnR5V2l0aE1vZGlmaWVycyhlbG0sIGNoZWNrVmFsKQogICAgKSkKICB9CgogIGZ1bmN0aW9uIGlzTm90SW5Gb2N1c0FuZERpcnR5IChlbG0sIGNoZWNrVmFsKSB7CiAgICAvLyByZXR1cm4gdHJ1ZSB3aGVuIHRleHRib3ggKC5udW1iZXIgYW5kIC50cmltKSBsb3NlcyBmb2N1cyBhbmQgaXRzIHZhbHVlIGlzCiAgICAvLyBub3QgZXF1YWwgdG8gdGhlIHVwZGF0ZWQgdmFsdWUKICAgIHZhciBub3RJbkZvY3VzID0gdHJ1ZTsKICAgIC8vICM2MTU3CiAgICAvLyB3b3JrIGFyb3VuZCBJRSBidWcgd2hlbiBhY2Nlc3NpbmcgZG9jdW1lbnQuYWN0aXZlRWxlbWVudCBpbiBhbiBpZnJhbWUKICAgIHRyeSB7IG5vdEluRm9jdXMgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50ICE9PSBlbG07IH0gY2F0Y2ggKGUpIHt9CiAgICByZXR1cm4gbm90SW5Gb2N1cyAmJiBlbG0udmFsdWUgIT09IGNoZWNrVmFsCiAgfQoKICBmdW5jdGlvbiBpc0RpcnR5V2l0aE1vZGlmaWVycyAoZWxtLCBuZXdWYWwpIHsKICAgIHZhciB2YWx1ZSA9IGVsbS52YWx1ZTsKICAgIHZhciBtb2RpZmllcnMgPSBlbG0uX3ZNb2RpZmllcnM7IC8vIGluamVjdGVkIGJ5IHYtbW9kZWwgcnVudGltZQogICAgaWYgKGlzRGVmKG1vZGlmaWVycykpIHsKICAgICAgaWYgKG1vZGlmaWVycy5udW1iZXIpIHsKICAgICAgICByZXR1cm4gdG9OdW1iZXIodmFsdWUpICE9PSB0b051bWJlcihuZXdWYWwpCiAgICAgIH0KICAgICAgaWYgKG1vZGlmaWVycy50cmltKSB7CiAgICAgICAgcmV0dXJuIHZhbHVlLnRyaW0oKSAhPT0gbmV3VmFsLnRyaW0oKQogICAgICB9CiAgICB9CiAgICByZXR1cm4gdmFsdWUgIT09IG5ld1ZhbAogIH0KCiAgdmFyIGRvbVByb3BzID0gewogICAgY3JlYXRlOiB1cGRhdGVET01Qcm9wcywKICAgIHVwZGF0ZTogdXBkYXRlRE9NUHJvcHMKICB9OwoKICAvKiAgKi8KCiAgdmFyIHBhcnNlU3R5bGVUZXh0ID0gY2FjaGVkKGZ1bmN0aW9uIChjc3NUZXh0KSB7CiAgICB2YXIgcmVzID0ge307CiAgICB2YXIgbGlzdERlbGltaXRlciA9IC87KD8hW14oXSpcKSkvZzsKICAgIHZhciBwcm9wZXJ0eURlbGltaXRlciA9IC86KC4rKS87CiAgICBjc3NUZXh0LnNwbGl0KGxpc3REZWxpbWl0ZXIpLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgaWYgKGl0ZW0pIHsKICAgICAgICB2YXIgdG1wID0gaXRlbS5zcGxpdChwcm9wZXJ0eURlbGltaXRlcik7CiAgICAgICAgdG1wLmxlbmd0aCA+IDEgJiYgKHJlc1t0bXBbMF0udHJpbSgpXSA9IHRtcFsxXS50cmltKCkpOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiByZXMKICB9KTsKCiAgLy8gbWVyZ2Ugc3RhdGljIGFuZCBkeW5hbWljIHN0eWxlIGRhdGEgb24gdGhlIHNhbWUgdm5vZGUKICBmdW5jdGlvbiBub3JtYWxpemVTdHlsZURhdGEgKGRhdGEpIHsKICAgIHZhciBzdHlsZSA9IG5vcm1hbGl6ZVN0eWxlQmluZGluZyhkYXRhLnN0eWxlKTsKICAgIC8vIHN0YXRpYyBzdHlsZSBpcyBwcmUtcHJvY2Vzc2VkIGludG8gYW4gb2JqZWN0IGR1cmluZyBjb21waWxhdGlvbgogICAgLy8gYW5kIGlzIGFsd2F5cyBhIGZyZXNoIG9iamVjdCwgc28gaXQncyBzYWZlIHRvIG1lcmdlIGludG8gaXQKICAgIHJldHVybiBkYXRhLnN0YXRpY1N0eWxlCiAgICAgID8gZXh0ZW5kKGRhdGEuc3RhdGljU3R5bGUsIHN0eWxlKQogICAgICA6IHN0eWxlCiAgfQoKICAvLyBub3JtYWxpemUgcG9zc2libGUgYXJyYXkgLyBzdHJpbmcgdmFsdWVzIGludG8gT2JqZWN0CiAgZnVuY3Rpb24gbm9ybWFsaXplU3R5bGVCaW5kaW5nIChiaW5kaW5nU3R5bGUpIHsKICAgIGlmIChBcnJheS5pc0FycmF5KGJpbmRpbmdTdHlsZSkpIHsKICAgICAgcmV0dXJuIHRvT2JqZWN0KGJpbmRpbmdTdHlsZSkKICAgIH0KICAgIGlmICh0eXBlb2YgYmluZGluZ1N0eWxlID09PSAnc3RyaW5nJykgewogICAgICByZXR1cm4gcGFyc2VTdHlsZVRleHQoYmluZGluZ1N0eWxlKQogICAgfQogICAgcmV0dXJuIGJpbmRpbmdTdHlsZQogIH0KCiAgLyoqCiAgICogcGFyZW50IGNvbXBvbmVudCBzdHlsZSBzaG91bGQgYmUgYWZ0ZXIgY2hpbGQncwogICAqIHNvIHRoYXQgcGFyZW50IGNvbXBvbmVudCdzIHN0eWxlIGNvdWxkIG92ZXJyaWRlIGl0CiAgICovCiAgZnVuY3Rpb24gZ2V0U3R5bGUgKHZub2RlLCBjaGVja0NoaWxkKSB7CiAgICB2YXIgcmVzID0ge307CiAgICB2YXIgc3R5bGVEYXRhOwoKICAgIGlmIChjaGVja0NoaWxkKSB7CiAgICAgIHZhciBjaGlsZE5vZGUgPSB2bm9kZTsKICAgICAgd2hpbGUgKGNoaWxkTm9kZS5jb21wb25lbnRJbnN0YW5jZSkgewogICAgICAgIGNoaWxkTm9kZSA9IGNoaWxkTm9kZS5jb21wb25lbnRJbnN0YW5jZS5fdm5vZGU7CiAgICAgICAgaWYgKAogICAgICAgICAgY2hpbGROb2RlICYmIGNoaWxkTm9kZS5kYXRhICYmCiAgICAgICAgICAoc3R5bGVEYXRhID0gbm9ybWFsaXplU3R5bGVEYXRhKGNoaWxkTm9kZS5kYXRhKSkKICAgICAgICApIHsKICAgICAgICAgIGV4dGVuZChyZXMsIHN0eWxlRGF0YSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaWYgKChzdHlsZURhdGEgPSBub3JtYWxpemVTdHlsZURhdGEodm5vZGUuZGF0YSkpKSB7CiAgICAgIGV4dGVuZChyZXMsIHN0eWxlRGF0YSk7CiAgICB9CgogICAgdmFyIHBhcmVudE5vZGUgPSB2bm9kZTsKICAgIHdoaWxlICgocGFyZW50Tm9kZSA9IHBhcmVudE5vZGUucGFyZW50KSkgewogICAgICBpZiAocGFyZW50Tm9kZS5kYXRhICYmIChzdHlsZURhdGEgPSBub3JtYWxpemVTdHlsZURhdGEocGFyZW50Tm9kZS5kYXRhKSkpIHsKICAgICAgICBleHRlbmQocmVzLCBzdHlsZURhdGEpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzCiAgfQoKICAvKiAgKi8KCiAgdmFyIGNzc1ZhclJFID0gL14tLS87CiAgdmFyIGltcG9ydGFudFJFID0gL1xzKiFpbXBvcnRhbnQkLzsKICB2YXIgc2V0UHJvcCA9IGZ1bmN0aW9uIChlbCwgbmFtZSwgdmFsKSB7CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgIGlmIChjc3NWYXJSRS50ZXN0KG5hbWUpKSB7CiAgICAgIGVsLnN0eWxlLnNldFByb3BlcnR5KG5hbWUsIHZhbCk7CiAgICB9IGVsc2UgaWYgKGltcG9ydGFudFJFLnRlc3QodmFsKSkgewogICAgICBlbC5zdHlsZS5zZXRQcm9wZXJ0eShoeXBoZW5hdGUobmFtZSksIHZhbC5yZXBsYWNlKGltcG9ydGFudFJFLCAnJyksICdpbXBvcnRhbnQnKTsKICAgIH0gZWxzZSB7CiAgICAgIHZhciBub3JtYWxpemVkTmFtZSA9IG5vcm1hbGl6ZShuYW1lKTsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsKSkgewogICAgICAgIC8vIFN1cHBvcnQgdmFsdWVzIGFycmF5IGNyZWF0ZWQgYnkgYXV0b3ByZWZpeGVyLCBlLmcuCiAgICAgICAgLy8ge2Rpc3BsYXk6IFsiLXdlYmtpdC1ib3giLCAiLW1zLWZsZXhib3giLCAiZmxleCJdfQogICAgICAgIC8vIFNldCB0aGVtIG9uZSBieSBvbmUsIGFuZCB0aGUgYnJvd3NlciB3aWxsIG9ubHkgc2V0IHRob3NlIGl0IGNhbiByZWNvZ25pemUKICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gdmFsLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgICBlbC5zdHlsZVtub3JtYWxpemVkTmFtZV0gPSB2YWxbaV07CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGVsLnN0eWxlW25vcm1hbGl6ZWROYW1lXSA9IHZhbDsKICAgICAgfQogICAgfQogIH07CgogIHZhciB2ZW5kb3JOYW1lcyA9IFsnV2Via2l0JywgJ01veicsICdtcyddOwoKICB2YXIgZW1wdHlTdHlsZTsKICB2YXIgbm9ybWFsaXplID0gY2FjaGVkKGZ1bmN0aW9uIChwcm9wKSB7CiAgICBlbXB0eVN0eWxlID0gZW1wdHlTdHlsZSB8fCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKS5zdHlsZTsKICAgIHByb3AgPSBjYW1lbGl6ZShwcm9wKTsKICAgIGlmIChwcm9wICE9PSAnZmlsdGVyJyAmJiAocHJvcCBpbiBlbXB0eVN0eWxlKSkgewogICAgICByZXR1cm4gcHJvcAogICAgfQogICAgdmFyIGNhcE5hbWUgPSBwcm9wLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgcHJvcC5zbGljZSgxKTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmVuZG9yTmFtZXMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIG5hbWUgPSB2ZW5kb3JOYW1lc1tpXSArIGNhcE5hbWU7CiAgICAgIGlmIChuYW1lIGluIGVtcHR5U3R5bGUpIHsKICAgICAgICByZXR1cm4gbmFtZQogICAgICB9CiAgICB9CiAgfSk7CgogIGZ1bmN0aW9uIHVwZGF0ZVN0eWxlIChvbGRWbm9kZSwgdm5vZGUpIHsKICAgIHZhciBkYXRhID0gdm5vZGUuZGF0YTsKICAgIHZhciBvbGREYXRhID0gb2xkVm5vZGUuZGF0YTsKCiAgICBpZiAoaXNVbmRlZihkYXRhLnN0YXRpY1N0eWxlKSAmJiBpc1VuZGVmKGRhdGEuc3R5bGUpICYmCiAgICAgIGlzVW5kZWYob2xkRGF0YS5zdGF0aWNTdHlsZSkgJiYgaXNVbmRlZihvbGREYXRhLnN0eWxlKQogICAgKSB7CiAgICAgIHJldHVybgogICAgfQoKICAgIHZhciBjdXIsIG5hbWU7CiAgICB2YXIgZWwgPSB2bm9kZS5lbG07CiAgICB2YXIgb2xkU3RhdGljU3R5bGUgPSBvbGREYXRhLnN0YXRpY1N0eWxlOwogICAgdmFyIG9sZFN0eWxlQmluZGluZyA9IG9sZERhdGEubm9ybWFsaXplZFN0eWxlIHx8IG9sZERhdGEuc3R5bGUgfHwge307CgogICAgLy8gaWYgc3RhdGljIHN0eWxlIGV4aXN0cywgc3R5bGViaW5kaW5nIGFscmVhZHkgbWVyZ2VkIGludG8gaXQgd2hlbiBkb2luZyBub3JtYWxpemVTdHlsZURhdGEKICAgIHZhciBvbGRTdHlsZSA9IG9sZFN0YXRpY1N0eWxlIHx8IG9sZFN0eWxlQmluZGluZzsKCiAgICB2YXIgc3R5bGUgPSBub3JtYWxpemVTdHlsZUJpbmRpbmcodm5vZGUuZGF0YS5zdHlsZSkgfHwge307CgogICAgLy8gc3RvcmUgbm9ybWFsaXplZCBzdHlsZSB1bmRlciBhIGRpZmZlcmVudCBrZXkgZm9yIG5leHQgZGlmZgogICAgLy8gbWFrZSBzdXJlIHRvIGNsb25lIGl0IGlmIGl0J3MgcmVhY3RpdmUsIHNpbmNlIHRoZSB1c2VyIGxpa2VseSB3YW50cwogICAgLy8gdG8gbXV0YXRlIGl0LgogICAgdm5vZGUuZGF0YS5ub3JtYWxpemVkU3R5bGUgPSBpc0RlZihzdHlsZS5fX29iX18pCiAgICAgID8gZXh0ZW5kKHt9LCBzdHlsZSkKICAgICAgOiBzdHlsZTsKCiAgICB2YXIgbmV3U3R5bGUgPSBnZXRTdHlsZSh2bm9kZSwgdHJ1ZSk7CgogICAgZm9yIChuYW1lIGluIG9sZFN0eWxlKSB7CiAgICAgIGlmIChpc1VuZGVmKG5ld1N0eWxlW25hbWVdKSkgewogICAgICAgIHNldFByb3AoZWwsIG5hbWUsICcnKTsKICAgICAgfQogICAgfQogICAgZm9yIChuYW1lIGluIG5ld1N0eWxlKSB7CiAgICAgIGN1ciA9IG5ld1N0eWxlW25hbWVdOwogICAgICBpZiAoY3VyICE9PSBvbGRTdHlsZVtuYW1lXSkgewogICAgICAgIC8vIGllOSBzZXR0aW5nIHRvIG51bGwgaGFzIG5vIGVmZmVjdCwgbXVzdCB1c2UgZW1wdHkgc3RyaW5nCiAgICAgICAgc2V0UHJvcChlbCwgbmFtZSwgY3VyID09IG51bGwgPyAnJyA6IGN1cik7CiAgICAgIH0KICAgIH0KICB9CgogIHZhciBzdHlsZSA9IHsKICAgIGNyZWF0ZTogdXBkYXRlU3R5bGUsCiAgICB1cGRhdGU6IHVwZGF0ZVN0eWxlCiAgfTsKCiAgLyogICovCgogIHZhciB3aGl0ZXNwYWNlUkUgPSAvXHMrLzsKCiAgLyoqCiAgICogQWRkIGNsYXNzIHdpdGggY29tcGF0aWJpbGl0eSBmb3IgU1ZHIHNpbmNlIGNsYXNzTGlzdCBpcyBub3Qgc3VwcG9ydGVkIG9uCiAgICogU1ZHIGVsZW1lbnRzIGluIElFCiAgICovCiAgZnVuY3Rpb24gYWRkQ2xhc3MgKGVsLCBjbHMpIHsKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgaWYgKCFjbHMgfHwgIShjbHMgPSBjbHMudHJpbSgpKSkgewogICAgICByZXR1cm4KICAgIH0KCiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgZWxzZSAqLwogICAgaWYgKGVsLmNsYXNzTGlzdCkgewogICAgICBpZiAoY2xzLmluZGV4T2YoJyAnKSA+IC0xKSB7CiAgICAgICAgY2xzLnNwbGl0KHdoaXRlc3BhY2VSRSkuZm9yRWFjaChmdW5jdGlvbiAoYykgeyByZXR1cm4gZWwuY2xhc3NMaXN0LmFkZChjKTsgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZWwuY2xhc3NMaXN0LmFkZChjbHMpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB2YXIgY3VyID0gIiAiICsgKGVsLmdldEF0dHJpYnV0ZSgnY2xhc3MnKSB8fCAnJykgKyAiICI7CiAgICAgIGlmIChjdXIuaW5kZXhPZignICcgKyBjbHMgKyAnICcpIDwgMCkgewogICAgICAgIGVsLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAoY3VyICsgY2xzKS50cmltKCkpOwogICAgICB9CiAgICB9CiAgfQoKICAvKioKICAgKiBSZW1vdmUgY2xhc3Mgd2l0aCBjb21wYXRpYmlsaXR5IGZvciBTVkcgc2luY2UgY2xhc3NMaXN0IGlzIG5vdCBzdXBwb3J0ZWQgb24KICAgKiBTVkcgZWxlbWVudHMgaW4gSUUKICAgKi8KICBmdW5jdGlvbiByZW1vdmVDbGFzcyAoZWwsIGNscykgewogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAoIWNscyB8fCAhKGNscyA9IGNscy50cmltKCkpKSB7CiAgICAgIHJldHVybgogICAgfQoKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovCiAgICBpZiAoZWwuY2xhc3NMaXN0KSB7CiAgICAgIGlmIChjbHMuaW5kZXhPZignICcpID4gLTEpIHsKICAgICAgICBjbHMuc3BsaXQod2hpdGVzcGFjZVJFKS5mb3JFYWNoKGZ1bmN0aW9uIChjKSB7IHJldHVybiBlbC5jbGFzc0xpc3QucmVtb3ZlKGMpOyB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBlbC5jbGFzc0xpc3QucmVtb3ZlKGNscyk7CiAgICAgIH0KICAgICAgaWYgKCFlbC5jbGFzc0xpc3QubGVuZ3RoKSB7CiAgICAgICAgZWwucmVtb3ZlQXR0cmlidXRlKCdjbGFzcycpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB2YXIgY3VyID0gIiAiICsgKGVsLmdldEF0dHJpYnV0ZSgnY2xhc3MnKSB8fCAnJykgKyAiICI7CiAgICAgIHZhciB0YXIgPSAnICcgKyBjbHMgKyAnICc7CiAgICAgIHdoaWxlIChjdXIuaW5kZXhPZih0YXIpID49IDApIHsKICAgICAgICBjdXIgPSBjdXIucmVwbGFjZSh0YXIsICcgJyk7CiAgICAgIH0KICAgICAgY3VyID0gY3VyLnRyaW0oKTsKICAgICAgaWYgKGN1cikgewogICAgICAgIGVsLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCBjdXIpOwogICAgICB9IGVsc2UgewogICAgICAgIGVsLnJlbW92ZUF0dHJpYnV0ZSgnY2xhc3MnKTsKICAgICAgfQogICAgfQogIH0KCiAgLyogICovCgogIGZ1bmN0aW9uIHJlc29sdmVUcmFuc2l0aW9uIChkZWYkJDEpIHsKICAgIGlmICghZGVmJCQxKSB7CiAgICAgIHJldHVybgogICAgfQogICAgLyogaXN0YW5idWwgaWdub3JlIGVsc2UgKi8KICAgIGlmICh0eXBlb2YgZGVmJCQxID09PSAnb2JqZWN0JykgewogICAgICB2YXIgcmVzID0ge307CiAgICAgIGlmIChkZWYkJDEuY3NzICE9PSBmYWxzZSkgewogICAgICAgIGV4dGVuZChyZXMsIGF1dG9Dc3NUcmFuc2l0aW9uKGRlZiQkMS5uYW1lIHx8ICd2JykpOwogICAgICB9CiAgICAgIGV4dGVuZChyZXMsIGRlZiQkMSk7CiAgICAgIHJldHVybiByZXMKICAgIH0gZWxzZSBpZiAodHlwZW9mIGRlZiQkMSA9PT0gJ3N0cmluZycpIHsKICAgICAgcmV0dXJuIGF1dG9Dc3NUcmFuc2l0aW9uKGRlZiQkMSkKICAgIH0KICB9CgogIHZhciBhdXRvQ3NzVHJhbnNpdGlvbiA9IGNhY2hlZChmdW5jdGlvbiAobmFtZSkgewogICAgcmV0dXJuIHsKICAgICAgZW50ZXJDbGFzczogKG5hbWUgKyAiLWVudGVyIiksCiAgICAgIGVudGVyVG9DbGFzczogKG5hbWUgKyAiLWVudGVyLXRvIiksCiAgICAgIGVudGVyQWN0aXZlQ2xhc3M6IChuYW1lICsgIi1lbnRlci1hY3RpdmUiKSwKICAgICAgbGVhdmVDbGFzczogKG5hbWUgKyAiLWxlYXZlIiksCiAgICAgIGxlYXZlVG9DbGFzczogKG5hbWUgKyAiLWxlYXZlLXRvIiksCiAgICAgIGxlYXZlQWN0aXZlQ2xhc3M6IChuYW1lICsgIi1sZWF2ZS1hY3RpdmUiKQogICAgfQogIH0pOwoKICB2YXIgaGFzVHJhbnNpdGlvbiA9IGluQnJvd3NlciAmJiAhaXNJRTk7CiAgdmFyIFRSQU5TSVRJT04gPSAndHJhbnNpdGlvbic7CiAgdmFyIEFOSU1BVElPTiA9ICdhbmltYXRpb24nOwoKICAvLyBUcmFuc2l0aW9uIHByb3BlcnR5L2V2ZW50IHNuaWZmaW5nCiAgdmFyIHRyYW5zaXRpb25Qcm9wID0gJ3RyYW5zaXRpb24nOwogIHZhciB0cmFuc2l0aW9uRW5kRXZlbnQgPSAndHJhbnNpdGlvbmVuZCc7CiAgdmFyIGFuaW1hdGlvblByb3AgPSAnYW5pbWF0aW9uJzsKICB2YXIgYW5pbWF0aW9uRW5kRXZlbnQgPSAnYW5pbWF0aW9uZW5kJzsKICBpZiAoaGFzVHJhbnNpdGlvbikgewogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAod2luZG93Lm9udHJhbnNpdGlvbmVuZCA9PT0gdW5kZWZpbmVkICYmCiAgICAgIHdpbmRvdy5vbndlYmtpdHRyYW5zaXRpb25lbmQgIT09IHVuZGVmaW5lZAogICAgKSB7CiAgICAgIHRyYW5zaXRpb25Qcm9wID0gJ1dlYmtpdFRyYW5zaXRpb24nOwogICAgICB0cmFuc2l0aW9uRW5kRXZlbnQgPSAnd2Via2l0VHJhbnNpdGlvbkVuZCc7CiAgICB9CiAgICBpZiAod2luZG93Lm9uYW5pbWF0aW9uZW5kID09PSB1bmRlZmluZWQgJiYKICAgICAgd2luZG93Lm9ud2Via2l0YW5pbWF0aW9uZW5kICE9PSB1bmRlZmluZWQKICAgICkgewogICAgICBhbmltYXRpb25Qcm9wID0gJ1dlYmtpdEFuaW1hdGlvbic7CiAgICAgIGFuaW1hdGlvbkVuZEV2ZW50ID0gJ3dlYmtpdEFuaW1hdGlvbkVuZCc7CiAgICB9CiAgfQoKICAvLyBiaW5kaW5nIHRvIHdpbmRvdyBpcyBuZWNlc3NhcnkgdG8gbWFrZSBob3QgcmVsb2FkIHdvcmsgaW4gSUUgaW4gc3RyaWN0IG1vZGUKICB2YXIgcmFmID0gaW5Ccm93c2VyCiAgICA/IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUKICAgICAgPyB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lLmJpbmQod2luZG93KQogICAgICA6IHNldFRpbWVvdXQKICAgIDogLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8gZnVuY3Rpb24gKGZuKSB7IHJldHVybiBmbigpOyB9OwoKICBmdW5jdGlvbiBuZXh0RnJhbWUgKGZuKSB7CiAgICByYWYoZnVuY3Rpb24gKCkgewogICAgICByYWYoZm4pOwogICAgfSk7CiAgfQoKICBmdW5jdGlvbiBhZGRUcmFuc2l0aW9uQ2xhc3MgKGVsLCBjbHMpIHsKICAgIHZhciB0cmFuc2l0aW9uQ2xhc3NlcyA9IGVsLl90cmFuc2l0aW9uQ2xhc3NlcyB8fCAoZWwuX3RyYW5zaXRpb25DbGFzc2VzID0gW10pOwogICAgaWYgKHRyYW5zaXRpb25DbGFzc2VzLmluZGV4T2YoY2xzKSA8IDApIHsKICAgICAgdHJhbnNpdGlvbkNsYXNzZXMucHVzaChjbHMpOwogICAgICBhZGRDbGFzcyhlbCwgY2xzKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHJlbW92ZVRyYW5zaXRpb25DbGFzcyAoZWwsIGNscykgewogICAgaWYgKGVsLl90cmFuc2l0aW9uQ2xhc3NlcykgewogICAgICByZW1vdmUoZWwuX3RyYW5zaXRpb25DbGFzc2VzLCBjbHMpOwogICAgfQogICAgcmVtb3ZlQ2xhc3MoZWwsIGNscyk7CiAgfQoKICBmdW5jdGlvbiB3aGVuVHJhbnNpdGlvbkVuZHMgKAogICAgZWwsCiAgICBleHBlY3RlZFR5cGUsCiAgICBjYgogICkgewogICAgdmFyIHJlZiA9IGdldFRyYW5zaXRpb25JbmZvKGVsLCBleHBlY3RlZFR5cGUpOwogICAgdmFyIHR5cGUgPSByZWYudHlwZTsKICAgIHZhciB0aW1lb3V0ID0gcmVmLnRpbWVvdXQ7CiAgICB2YXIgcHJvcENvdW50ID0gcmVmLnByb3BDb3VudDsKICAgIGlmICghdHlwZSkgeyByZXR1cm4gY2IoKSB9CiAgICB2YXIgZXZlbnQgPSB0eXBlID09PSBUUkFOU0lUSU9OID8gdHJhbnNpdGlvbkVuZEV2ZW50IDogYW5pbWF0aW9uRW5kRXZlbnQ7CiAgICB2YXIgZW5kZWQgPSAwOwogICAgdmFyIGVuZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgZWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudCwgb25FbmQpOwogICAgICBjYigpOwogICAgfTsKICAgIHZhciBvbkVuZCA9IGZ1bmN0aW9uIChlKSB7CiAgICAgIGlmIChlLnRhcmdldCA9PT0gZWwpIHsKICAgICAgICBpZiAoKytlbmRlZCA+PSBwcm9wQ291bnQpIHsKICAgICAgICAgIGVuZCgpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICBpZiAoZW5kZWQgPCBwcm9wQ291bnQpIHsKICAgICAgICBlbmQoKTsKICAgICAgfQogICAgfSwgdGltZW91dCArIDEpOwogICAgZWwuYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgb25FbmQpOwogIH0KCiAgdmFyIHRyYW5zZm9ybVJFID0gL1xiKHRyYW5zZm9ybXxhbGwpKCx8JCkvOwoKICBmdW5jdGlvbiBnZXRUcmFuc2l0aW9uSW5mbyAoZWwsIGV4cGVjdGVkVHlwZSkgewogICAgdmFyIHN0eWxlcyA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsKTsKICAgIC8vIEpTRE9NIG1heSByZXR1cm4gdW5kZWZpbmVkIGZvciB0cmFuc2l0aW9uIHByb3BlcnRpZXMKICAgIHZhciB0cmFuc2l0aW9uRGVsYXlzID0gKHN0eWxlc1t0cmFuc2l0aW9uUHJvcCArICdEZWxheSddIHx8ICcnKS5zcGxpdCgnLCAnKTsKICAgIHZhciB0cmFuc2l0aW9uRHVyYXRpb25zID0gKHN0eWxlc1t0cmFuc2l0aW9uUHJvcCArICdEdXJhdGlvbiddIHx8ICcnKS5zcGxpdCgnLCAnKTsKICAgIHZhciB0cmFuc2l0aW9uVGltZW91dCA9IGdldFRpbWVvdXQodHJhbnNpdGlvbkRlbGF5cywgdHJhbnNpdGlvbkR1cmF0aW9ucyk7CiAgICB2YXIgYW5pbWF0aW9uRGVsYXlzID0gKHN0eWxlc1thbmltYXRpb25Qcm9wICsgJ0RlbGF5J10gfHwgJycpLnNwbGl0KCcsICcpOwogICAgdmFyIGFuaW1hdGlvbkR1cmF0aW9ucyA9IChzdHlsZXNbYW5pbWF0aW9uUHJvcCArICdEdXJhdGlvbiddIHx8ICcnKS5zcGxpdCgnLCAnKTsKICAgIHZhciBhbmltYXRpb25UaW1lb3V0ID0gZ2V0VGltZW91dChhbmltYXRpb25EZWxheXMsIGFuaW1hdGlvbkR1cmF0aW9ucyk7CgogICAgdmFyIHR5cGU7CiAgICB2YXIgdGltZW91dCA9IDA7CiAgICB2YXIgcHJvcENvdW50ID0gMDsKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgaWYgKGV4cGVjdGVkVHlwZSA9PT0gVFJBTlNJVElPTikgewogICAgICBpZiAodHJhbnNpdGlvblRpbWVvdXQgPiAwKSB7CiAgICAgICAgdHlwZSA9IFRSQU5TSVRJT047CiAgICAgICAgdGltZW91dCA9IHRyYW5zaXRpb25UaW1lb3V0OwogICAgICAgIHByb3BDb3VudCA9IHRyYW5zaXRpb25EdXJhdGlvbnMubGVuZ3RoOwogICAgICB9CiAgICB9IGVsc2UgaWYgKGV4cGVjdGVkVHlwZSA9PT0gQU5JTUFUSU9OKSB7CiAgICAgIGlmIChhbmltYXRpb25UaW1lb3V0ID4gMCkgewogICAgICAgIHR5cGUgPSBBTklNQVRJT047CiAgICAgICAgdGltZW91dCA9IGFuaW1hdGlvblRpbWVvdXQ7CiAgICAgICAgcHJvcENvdW50ID0gYW5pbWF0aW9uRHVyYXRpb25zLmxlbmd0aDsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGltZW91dCA9IE1hdGgubWF4KHRyYW5zaXRpb25UaW1lb3V0LCBhbmltYXRpb25UaW1lb3V0KTsKICAgICAgdHlwZSA9IHRpbWVvdXQgPiAwCiAgICAgICAgPyB0cmFuc2l0aW9uVGltZW91dCA+IGFuaW1hdGlvblRpbWVvdXQKICAgICAgICAgID8gVFJBTlNJVElPTgogICAgICAgICAgOiBBTklNQVRJT04KICAgICAgICA6IG51bGw7CiAgICAgIHByb3BDb3VudCA9IHR5cGUKICAgICAgICA/IHR5cGUgPT09IFRSQU5TSVRJT04KICAgICAgICAgID8gdHJhbnNpdGlvbkR1cmF0aW9ucy5sZW5ndGgKICAgICAgICAgIDogYW5pbWF0aW9uRHVyYXRpb25zLmxlbmd0aAogICAgICAgIDogMDsKICAgIH0KICAgIHZhciBoYXNUcmFuc2Zvcm0gPQogICAgICB0eXBlID09PSBUUkFOU0lUSU9OICYmCiAgICAgIHRyYW5zZm9ybVJFLnRlc3Qoc3R5bGVzW3RyYW5zaXRpb25Qcm9wICsgJ1Byb3BlcnR5J10pOwogICAgcmV0dXJuIHsKICAgICAgdHlwZTogdHlwZSwKICAgICAgdGltZW91dDogdGltZW91dCwKICAgICAgcHJvcENvdW50OiBwcm9wQ291bnQsCiAgICAgIGhhc1RyYW5zZm9ybTogaGFzVHJhbnNmb3JtCiAgICB9CiAgfQoKICBmdW5jdGlvbiBnZXRUaW1lb3V0IChkZWxheXMsIGR1cmF0aW9ucykgewogICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICAgIHdoaWxlIChkZWxheXMubGVuZ3RoIDwgZHVyYXRpb25zLmxlbmd0aCkgewogICAgICBkZWxheXMgPSBkZWxheXMuY29uY2F0KGRlbGF5cyk7CiAgICB9CgogICAgcmV0dXJuIE1hdGgubWF4LmFwcGx5KG51bGwsIGR1cmF0aW9ucy5tYXAoZnVuY3Rpb24gKGQsIGkpIHsKICAgICAgcmV0dXJuIHRvTXMoZCkgKyB0b01zKGRlbGF5c1tpXSkKICAgIH0pKQogIH0KCiAgLy8gT2xkIHZlcnNpb25zIG9mIENocm9taXVtIChiZWxvdyA2MS4wLjMxNjMuMTAwKSBmb3JtYXRzIGZsb2F0aW5nIHBvaW50ZXIgbnVtYmVycwogIC8vIGluIGEgbG9jYWxlLWRlcGVuZGVudCB3YXksIHVzaW5nIGEgY29tbWEgaW5zdGVhZCBvZiBhIGRvdC4KICAvLyBJZiBjb21tYSBpcyBub3QgcmVwbGFjZWQgd2l0aCBhIGRvdCwgdGhlIGlucHV0IHdpbGwgYmUgcm91bmRlZCBkb3duIChpLmUuIGFjdGluZwogIC8vIGFzIGEgZmxvb3IgZnVuY3Rpb24pIGNhdXNpbmcgdW5leHBlY3RlZCBiZWhhdmlvcnMKICBmdW5jdGlvbiB0b01zIChzKSB7CiAgICByZXR1cm4gTnVtYmVyKHMuc2xpY2UoMCwgLTEpLnJlcGxhY2UoJywnLCAnLicpKSAqIDEwMDAKICB9CgogIC8qICAqLwoKICBmdW5jdGlvbiBlbnRlciAodm5vZGUsIHRvZ2dsZURpc3BsYXkpIHsKICAgIHZhciBlbCA9IHZub2RlLmVsbTsKCiAgICAvLyBjYWxsIGxlYXZlIGNhbGxiYWNrIG5vdwogICAgaWYgKGlzRGVmKGVsLl9sZWF2ZUNiKSkgewogICAgICBlbC5fbGVhdmVDYi5jYW5jZWxsZWQgPSB0cnVlOwogICAgICBlbC5fbGVhdmVDYigpOwogICAgfQoKICAgIHZhciBkYXRhID0gcmVzb2x2ZVRyYW5zaXRpb24odm5vZGUuZGF0YS50cmFuc2l0aW9uKTsKICAgIGlmIChpc1VuZGVmKGRhdGEpKSB7CiAgICAgIHJldHVybgogICAgfQoKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgaWYgKGlzRGVmKGVsLl9lbnRlckNiKSB8fCBlbC5ub2RlVHlwZSAhPT0gMSkgewogICAgICByZXR1cm4KICAgIH0KCiAgICB2YXIgY3NzID0gZGF0YS5jc3M7CiAgICB2YXIgdHlwZSA9IGRhdGEudHlwZTsKICAgIHZhciBlbnRlckNsYXNzID0gZGF0YS5lbnRlckNsYXNzOwogICAgdmFyIGVudGVyVG9DbGFzcyA9IGRhdGEuZW50ZXJUb0NsYXNzOwogICAgdmFyIGVudGVyQWN0aXZlQ2xhc3MgPSBkYXRhLmVudGVyQWN0aXZlQ2xhc3M7CiAgICB2YXIgYXBwZWFyQ2xhc3MgPSBkYXRhLmFwcGVhckNsYXNzOwogICAgdmFyIGFwcGVhclRvQ2xhc3MgPSBkYXRhLmFwcGVhclRvQ2xhc3M7CiAgICB2YXIgYXBwZWFyQWN0aXZlQ2xhc3MgPSBkYXRhLmFwcGVhckFjdGl2ZUNsYXNzOwogICAgdmFyIGJlZm9yZUVudGVyID0gZGF0YS5iZWZvcmVFbnRlcjsKICAgIHZhciBlbnRlciA9IGRhdGEuZW50ZXI7CiAgICB2YXIgYWZ0ZXJFbnRlciA9IGRhdGEuYWZ0ZXJFbnRlcjsKICAgIHZhciBlbnRlckNhbmNlbGxlZCA9IGRhdGEuZW50ZXJDYW5jZWxsZWQ7CiAgICB2YXIgYmVmb3JlQXBwZWFyID0gZGF0YS5iZWZvcmVBcHBlYXI7CiAgICB2YXIgYXBwZWFyID0gZGF0YS5hcHBlYXI7CiAgICB2YXIgYWZ0ZXJBcHBlYXIgPSBkYXRhLmFmdGVyQXBwZWFyOwogICAgdmFyIGFwcGVhckNhbmNlbGxlZCA9IGRhdGEuYXBwZWFyQ2FuY2VsbGVkOwogICAgdmFyIGR1cmF0aW9uID0gZGF0YS5kdXJhdGlvbjsKCiAgICAvLyBhY3RpdmVJbnN0YW5jZSB3aWxsIGFsd2F5cyBiZSB0aGUgPHRyYW5zaXRpb24+IGNvbXBvbmVudCBtYW5hZ2luZyB0aGlzCiAgICAvLyB0cmFuc2l0aW9uLiBPbmUgZWRnZSBjYXNlIHRvIGNoZWNrIGlzIHdoZW4gdGhlIDx0cmFuc2l0aW9uPiBpcyBwbGFjZWQKICAgIC8vIGFzIHRoZSByb290IG5vZGUgb2YgYSBjaGlsZCBjb21wb25lbnQuIEluIHRoYXQgY2FzZSB3ZSBuZWVkIHRvIGNoZWNrCiAgICAvLyA8dHJhbnNpdGlvbj4ncyBwYXJlbnQgZm9yIGFwcGVhciBjaGVjay4KICAgIHZhciBjb250ZXh0ID0gYWN0aXZlSW5zdGFuY2U7CiAgICB2YXIgdHJhbnNpdGlvbk5vZGUgPSBhY3RpdmVJbnN0YW5jZS4kdm5vZGU7CiAgICB3aGlsZSAodHJhbnNpdGlvbk5vZGUgJiYgdHJhbnNpdGlvbk5vZGUucGFyZW50KSB7CiAgICAgIGNvbnRleHQgPSB0cmFuc2l0aW9uTm9kZS5jb250ZXh0OwogICAgICB0cmFuc2l0aW9uTm9kZSA9IHRyYW5zaXRpb25Ob2RlLnBhcmVudDsKICAgIH0KCiAgICB2YXIgaXNBcHBlYXIgPSAhY29udGV4dC5faXNNb3VudGVkIHx8ICF2bm9kZS5pc1Jvb3RJbnNlcnQ7CgogICAgaWYgKGlzQXBwZWFyICYmICFhcHBlYXIgJiYgYXBwZWFyICE9PSAnJykgewogICAgICByZXR1cm4KICAgIH0KCiAgICB2YXIgc3RhcnRDbGFzcyA9IGlzQXBwZWFyICYmIGFwcGVhckNsYXNzCiAgICAgID8gYXBwZWFyQ2xhc3MKICAgICAgOiBlbnRlckNsYXNzOwogICAgdmFyIGFjdGl2ZUNsYXNzID0gaXNBcHBlYXIgJiYgYXBwZWFyQWN0aXZlQ2xhc3MKICAgICAgPyBhcHBlYXJBY3RpdmVDbGFzcwogICAgICA6IGVudGVyQWN0aXZlQ2xhc3M7CiAgICB2YXIgdG9DbGFzcyA9IGlzQXBwZWFyICYmIGFwcGVhclRvQ2xhc3MKICAgICAgPyBhcHBlYXJUb0NsYXNzCiAgICAgIDogZW50ZXJUb0NsYXNzOwoKICAgIHZhciBiZWZvcmVFbnRlckhvb2sgPSBpc0FwcGVhcgogICAgICA/IChiZWZvcmVBcHBlYXIgfHwgYmVmb3JlRW50ZXIpCiAgICAgIDogYmVmb3JlRW50ZXI7CiAgICB2YXIgZW50ZXJIb29rID0gaXNBcHBlYXIKICAgICAgPyAodHlwZW9mIGFwcGVhciA9PT0gJ2Z1bmN0aW9uJyA/IGFwcGVhciA6IGVudGVyKQogICAgICA6IGVudGVyOwogICAgdmFyIGFmdGVyRW50ZXJIb29rID0gaXNBcHBlYXIKICAgICAgPyAoYWZ0ZXJBcHBlYXIgfHwgYWZ0ZXJFbnRlcikKICAgICAgOiBhZnRlckVudGVyOwogICAgdmFyIGVudGVyQ2FuY2VsbGVkSG9vayA9IGlzQXBwZWFyCiAgICAgID8gKGFwcGVhckNhbmNlbGxlZCB8fCBlbnRlckNhbmNlbGxlZCkKICAgICAgOiBlbnRlckNhbmNlbGxlZDsKCiAgICB2YXIgZXhwbGljaXRFbnRlckR1cmF0aW9uID0gdG9OdW1iZXIoCiAgICAgIGlzT2JqZWN0KGR1cmF0aW9uKQogICAgICAgID8gZHVyYXRpb24uZW50ZXIKICAgICAgICA6IGR1cmF0aW9uCiAgICApOwoKICAgIGlmIChleHBsaWNpdEVudGVyRHVyYXRpb24gIT0gbnVsbCkgewogICAgICBjaGVja0R1cmF0aW9uKGV4cGxpY2l0RW50ZXJEdXJhdGlvbiwgJ2VudGVyJywgdm5vZGUpOwogICAgfQoKICAgIHZhciBleHBlY3RzQ1NTID0gY3NzICE9PSBmYWxzZSAmJiAhaXNJRTk7CiAgICB2YXIgdXNlcldhbnRzQ29udHJvbCA9IGdldEhvb2tBcmd1bWVudHNMZW5ndGgoZW50ZXJIb29rKTsKCiAgICB2YXIgY2IgPSBlbC5fZW50ZXJDYiA9IG9uY2UoZnVuY3Rpb24gKCkgewogICAgICBpZiAoZXhwZWN0c0NTUykgewogICAgICAgIHJlbW92ZVRyYW5zaXRpb25DbGFzcyhlbCwgdG9DbGFzcyk7CiAgICAgICAgcmVtb3ZlVHJhbnNpdGlvbkNsYXNzKGVsLCBhY3RpdmVDbGFzcyk7CiAgICAgIH0KICAgICAgaWYgKGNiLmNhbmNlbGxlZCkgewogICAgICAgIGlmIChleHBlY3RzQ1NTKSB7CiAgICAgICAgICByZW1vdmVUcmFuc2l0aW9uQ2xhc3MoZWwsIHN0YXJ0Q2xhc3MpOwogICAgICAgIH0KICAgICAgICBlbnRlckNhbmNlbGxlZEhvb2sgJiYgZW50ZXJDYW5jZWxsZWRIb29rKGVsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBhZnRlckVudGVySG9vayAmJiBhZnRlckVudGVySG9vayhlbCk7CiAgICAgIH0KICAgICAgZWwuX2VudGVyQ2IgPSBudWxsOwogICAgfSk7CgogICAgaWYgKCF2bm9kZS5kYXRhLnNob3cpIHsKICAgICAgLy8gcmVtb3ZlIHBlbmRpbmcgbGVhdmUgZWxlbWVudCBvbiBlbnRlciBieSBpbmplY3RpbmcgYW4gaW5zZXJ0IGhvb2sKICAgICAgbWVyZ2VWTm9kZUhvb2sodm5vZGUsICdpbnNlcnQnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHBhcmVudCA9IGVsLnBhcmVudE5vZGU7CiAgICAgICAgdmFyIHBlbmRpbmdOb2RlID0gcGFyZW50ICYmIHBhcmVudC5fcGVuZGluZyAmJiBwYXJlbnQuX3BlbmRpbmdbdm5vZGUua2V5XTsKICAgICAgICBpZiAocGVuZGluZ05vZGUgJiYKICAgICAgICAgIHBlbmRpbmdOb2RlLnRhZyA9PT0gdm5vZGUudGFnICYmCiAgICAgICAgICBwZW5kaW5nTm9kZS5lbG0uX2xlYXZlQ2IKICAgICAgICApIHsKICAgICAgICAgIHBlbmRpbmdOb2RlLmVsbS5fbGVhdmVDYigpOwogICAgICAgIH0KICAgICAgICBlbnRlckhvb2sgJiYgZW50ZXJIb29rKGVsLCBjYik7CiAgICAgIH0pOwogICAgfQoKICAgIC8vIHN0YXJ0IGVudGVyIHRyYW5zaXRpb24KICAgIGJlZm9yZUVudGVySG9vayAmJiBiZWZvcmVFbnRlckhvb2soZWwpOwogICAgaWYgKGV4cGVjdHNDU1MpIHsKICAgICAgYWRkVHJhbnNpdGlvbkNsYXNzKGVsLCBzdGFydENsYXNzKTsKICAgICAgYWRkVHJhbnNpdGlvbkNsYXNzKGVsLCBhY3RpdmVDbGFzcyk7CiAgICAgIG5leHRGcmFtZShmdW5jdGlvbiAoKSB7CiAgICAgICAgcmVtb3ZlVHJhbnNpdGlvbkNsYXNzKGVsLCBzdGFydENsYXNzKTsKICAgICAgICBpZiAoIWNiLmNhbmNlbGxlZCkgewogICAgICAgICAgYWRkVHJhbnNpdGlvbkNsYXNzKGVsLCB0b0NsYXNzKTsKICAgICAgICAgIGlmICghdXNlcldhbnRzQ29udHJvbCkgewogICAgICAgICAgICBpZiAoaXNWYWxpZER1cmF0aW9uKGV4cGxpY2l0RW50ZXJEdXJhdGlvbikpIHsKICAgICAgICAgICAgICBzZXRUaW1lb3V0KGNiLCBleHBsaWNpdEVudGVyRHVyYXRpb24pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHdoZW5UcmFuc2l0aW9uRW5kcyhlbCwgdHlwZSwgY2IpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KCiAgICBpZiAodm5vZGUuZGF0YS5zaG93KSB7CiAgICAgIHRvZ2dsZURpc3BsYXkgJiYgdG9nZ2xlRGlzcGxheSgpOwogICAgICBlbnRlckhvb2sgJiYgZW50ZXJIb29rKGVsLCBjYik7CiAgICB9CgogICAgaWYgKCFleHBlY3RzQ1NTICYmICF1c2VyV2FudHNDb250cm9sKSB7CiAgICAgIGNiKCk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBsZWF2ZSAodm5vZGUsIHJtKSB7CiAgICB2YXIgZWwgPSB2bm9kZS5lbG07CgogICAgLy8gY2FsbCBlbnRlciBjYWxsYmFjayBub3cKICAgIGlmIChpc0RlZihlbC5fZW50ZXJDYikpIHsKICAgICAgZWwuX2VudGVyQ2IuY2FuY2VsbGVkID0gdHJ1ZTsKICAgICAgZWwuX2VudGVyQ2IoKTsKICAgIH0KCiAgICB2YXIgZGF0YSA9IHJlc29sdmVUcmFuc2l0aW9uKHZub2RlLmRhdGEudHJhbnNpdGlvbik7CiAgICBpZiAoaXNVbmRlZihkYXRhKSB8fCBlbC5ub2RlVHlwZSAhPT0gMSkgewogICAgICByZXR1cm4gcm0oKQogICAgfQoKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgaWYgKGlzRGVmKGVsLl9sZWF2ZUNiKSkgewogICAgICByZXR1cm4KICAgIH0KCiAgICB2YXIgY3NzID0gZGF0YS5jc3M7CiAgICB2YXIgdHlwZSA9IGRhdGEudHlwZTsKICAgIHZhciBsZWF2ZUNsYXNzID0gZGF0YS5sZWF2ZUNsYXNzOwogICAgdmFyIGxlYXZlVG9DbGFzcyA9IGRhdGEubGVhdmVUb0NsYXNzOwogICAgdmFyIGxlYXZlQWN0aXZlQ2xhc3MgPSBkYXRhLmxlYXZlQWN0aXZlQ2xhc3M7CiAgICB2YXIgYmVmb3JlTGVhdmUgPSBkYXRhLmJlZm9yZUxlYXZlOwogICAgdmFyIGxlYXZlID0gZGF0YS5sZWF2ZTsKICAgIHZhciBhZnRlckxlYXZlID0gZGF0YS5hZnRlckxlYXZlOwogICAgdmFyIGxlYXZlQ2FuY2VsbGVkID0gZGF0YS5sZWF2ZUNhbmNlbGxlZDsKICAgIHZhciBkZWxheUxlYXZlID0gZGF0YS5kZWxheUxlYXZlOwogICAgdmFyIGR1cmF0aW9uID0gZGF0YS5kdXJhdGlvbjsKCiAgICB2YXIgZXhwZWN0c0NTUyA9IGNzcyAhPT0gZmFsc2UgJiYgIWlzSUU5OwogICAgdmFyIHVzZXJXYW50c0NvbnRyb2wgPSBnZXRIb29rQXJndW1lbnRzTGVuZ3RoKGxlYXZlKTsKCiAgICB2YXIgZXhwbGljaXRMZWF2ZUR1cmF0aW9uID0gdG9OdW1iZXIoCiAgICAgIGlzT2JqZWN0KGR1cmF0aW9uKQogICAgICAgID8gZHVyYXRpb24ubGVhdmUKICAgICAgICA6IGR1cmF0aW9uCiAgICApOwoKICAgIGlmIChpc0RlZihleHBsaWNpdExlYXZlRHVyYXRpb24pKSB7CiAgICAgIGNoZWNrRHVyYXRpb24oZXhwbGljaXRMZWF2ZUR1cmF0aW9uLCAnbGVhdmUnLCB2bm9kZSk7CiAgICB9CgogICAgdmFyIGNiID0gZWwuX2xlYXZlQ2IgPSBvbmNlKGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKGVsLnBhcmVudE5vZGUgJiYgZWwucGFyZW50Tm9kZS5fcGVuZGluZykgewogICAgICAgIGVsLnBhcmVudE5vZGUuX3BlbmRpbmdbdm5vZGUua2V5XSA9IG51bGw7CiAgICAgIH0KICAgICAgaWYgKGV4cGVjdHNDU1MpIHsKICAgICAgICByZW1vdmVUcmFuc2l0aW9uQ2xhc3MoZWwsIGxlYXZlVG9DbGFzcyk7CiAgICAgICAgcmVtb3ZlVHJhbnNpdGlvbkNsYXNzKGVsLCBsZWF2ZUFjdGl2ZUNsYXNzKTsKICAgICAgfQogICAgICBpZiAoY2IuY2FuY2VsbGVkKSB7CiAgICAgICAgaWYgKGV4cGVjdHNDU1MpIHsKICAgICAgICAgIHJlbW92ZVRyYW5zaXRpb25DbGFzcyhlbCwgbGVhdmVDbGFzcyk7CiAgICAgICAgfQogICAgICAgIGxlYXZlQ2FuY2VsbGVkICYmIGxlYXZlQ2FuY2VsbGVkKGVsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBybSgpOwogICAgICAgIGFmdGVyTGVhdmUgJiYgYWZ0ZXJMZWF2ZShlbCk7CiAgICAgIH0KICAgICAgZWwuX2xlYXZlQ2IgPSBudWxsOwogICAgfSk7CgogICAgaWYgKGRlbGF5TGVhdmUpIHsKICAgICAgZGVsYXlMZWF2ZShwZXJmb3JtTGVhdmUpOwogICAgfSBlbHNlIHsKICAgICAgcGVyZm9ybUxlYXZlKCk7CiAgICB9CgogICAgZnVuY3Rpb24gcGVyZm9ybUxlYXZlICgpIHsKICAgICAgLy8gdGhlIGRlbGF5ZWQgbGVhdmUgbWF5IGhhdmUgYWxyZWFkeSBiZWVuIGNhbmNlbGxlZAogICAgICBpZiAoY2IuY2FuY2VsbGVkKSB7CiAgICAgICAgcmV0dXJuCiAgICAgIH0KICAgICAgLy8gcmVjb3JkIGxlYXZpbmcgZWxlbWVudAogICAgICBpZiAoIXZub2RlLmRhdGEuc2hvdyAmJiBlbC5wYXJlbnROb2RlKSB7CiAgICAgICAgKGVsLnBhcmVudE5vZGUuX3BlbmRpbmcgfHwgKGVsLnBhcmVudE5vZGUuX3BlbmRpbmcgPSB7fSkpWyh2bm9kZS5rZXkpXSA9IHZub2RlOwogICAgICB9CiAgICAgIGJlZm9yZUxlYXZlICYmIGJlZm9yZUxlYXZlKGVsKTsKICAgICAgaWYgKGV4cGVjdHNDU1MpIHsKICAgICAgICBhZGRUcmFuc2l0aW9uQ2xhc3MoZWwsIGxlYXZlQ2xhc3MpOwogICAgICAgIGFkZFRyYW5zaXRpb25DbGFzcyhlbCwgbGVhdmVBY3RpdmVDbGFzcyk7CiAgICAgICAgbmV4dEZyYW1lKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJlbW92ZVRyYW5zaXRpb25DbGFzcyhlbCwgbGVhdmVDbGFzcyk7CiAgICAgICAgICBpZiAoIWNiLmNhbmNlbGxlZCkgewogICAgICAgICAgICBhZGRUcmFuc2l0aW9uQ2xhc3MoZWwsIGxlYXZlVG9DbGFzcyk7CiAgICAgICAgICAgIGlmICghdXNlcldhbnRzQ29udHJvbCkgewogICAgICAgICAgICAgIGlmIChpc1ZhbGlkRHVyYXRpb24oZXhwbGljaXRMZWF2ZUR1cmF0aW9uKSkgewogICAgICAgICAgICAgICAgc2V0VGltZW91dChjYiwgZXhwbGljaXRMZWF2ZUR1cmF0aW9uKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgd2hlblRyYW5zaXRpb25FbmRzKGVsLCB0eXBlLCBjYik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgbGVhdmUgJiYgbGVhdmUoZWwsIGNiKTsKICAgICAgaWYgKCFleHBlY3RzQ1NTICYmICF1c2VyV2FudHNDb250cm9sKSB7CiAgICAgICAgY2IoKTsKICAgICAgfQogICAgfQogIH0KCiAgLy8gb25seSB1c2VkIGluIGRldiBtb2RlCiAgZnVuY3Rpb24gY2hlY2tEdXJhdGlvbiAodmFsLCBuYW1lLCB2bm9kZSkgewogICAgaWYgKHR5cGVvZiB2YWwgIT09ICdudW1iZXInKSB7CiAgICAgIHdhcm4oCiAgICAgICAgIjx0cmFuc2l0aW9uPiBleHBsaWNpdCAiICsgbmFtZSArICIgZHVyYXRpb24gaXMgbm90IGEgdmFsaWQgbnVtYmVyIC0gIiArCiAgICAgICAgImdvdCAiICsgKEpTT04uc3RyaW5naWZ5KHZhbCkpICsgIi4iLAogICAgICAgIHZub2RlLmNvbnRleHQKICAgICAgKTsKICAgIH0gZWxzZSBpZiAoaXNOYU4odmFsKSkgewogICAgICB3YXJuKAogICAgICAgICI8dHJhbnNpdGlvbj4gZXhwbGljaXQgIiArIG5hbWUgKyAiIGR1cmF0aW9uIGlzIE5hTiAtICIgKwogICAgICAgICd0aGUgZHVyYXRpb24gZXhwcmVzc2lvbiBtaWdodCBiZSBpbmNvcnJlY3QuJywKICAgICAgICB2bm9kZS5jb250ZXh0CiAgICAgICk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBpc1ZhbGlkRHVyYXRpb24gKHZhbCkgewogICAgcmV0dXJuIHR5cGVvZiB2YWwgPT09ICdudW1iZXInICYmICFpc05hTih2YWwpCiAgfQoKICAvKioKICAgKiBOb3JtYWxpemUgYSB0cmFuc2l0aW9uIGhvb2sncyBhcmd1bWVudCBsZW5ndGguIFRoZSBob29rIG1heSBiZToKICAgKiAtIGEgbWVyZ2VkIGhvb2sgKGludm9rZXIpIHdpdGggdGhlIG9yaWdpbmFsIGluIC5mbnMKICAgKiAtIGEgd3JhcHBlZCBjb21wb25lbnQgbWV0aG9kIChjaGVjayAuX2xlbmd0aCkKICAgKiAtIGEgcGxhaW4gZnVuY3Rpb24gKC5sZW5ndGgpCiAgICovCiAgZnVuY3Rpb24gZ2V0SG9va0FyZ3VtZW50c0xlbmd0aCAoZm4pIHsKICAgIGlmIChpc1VuZGVmKGZuKSkgewogICAgICByZXR1cm4gZmFsc2UKICAgIH0KICAgIHZhciBpbnZva2VyRm5zID0gZm4uZm5zOwogICAgaWYgKGlzRGVmKGludm9rZXJGbnMpKSB7CiAgICAgIC8vIGludm9rZXIKICAgICAgcmV0dXJuIGdldEhvb2tBcmd1bWVudHNMZW5ndGgoCiAgICAgICAgQXJyYXkuaXNBcnJheShpbnZva2VyRm5zKQogICAgICAgICAgPyBpbnZva2VyRm5zWzBdCiAgICAgICAgICA6IGludm9rZXJGbnMKICAgICAgKQogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIChmbi5fbGVuZ3RoIHx8IGZuLmxlbmd0aCkgPiAxCiAgICB9CiAgfQoKICBmdW5jdGlvbiBfZW50ZXIgKF8sIHZub2RlKSB7CiAgICBpZiAodm5vZGUuZGF0YS5zaG93ICE9PSB0cnVlKSB7CiAgICAgIGVudGVyKHZub2RlKTsKICAgIH0KICB9CgogIHZhciB0cmFuc2l0aW9uID0gaW5Ccm93c2VyID8gewogICAgY3JlYXRlOiBfZW50ZXIsCiAgICBhY3RpdmF0ZTogX2VudGVyLAogICAgcmVtb3ZlOiBmdW5jdGlvbiByZW1vdmUkJDEgKHZub2RlLCBybSkgewogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgZWxzZSAqLwogICAgICBpZiAodm5vZGUuZGF0YS5zaG93ICE9PSB0cnVlKSB7CiAgICAgICAgbGVhdmUodm5vZGUsIHJtKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBybSgpOwogICAgICB9CiAgICB9CiAgfSA6IHt9OwoKICB2YXIgcGxhdGZvcm1Nb2R1bGVzID0gWwogICAgYXR0cnMsCiAgICBrbGFzcywKICAgIGV2ZW50cywKICAgIGRvbVByb3BzLAogICAgc3R5bGUsCiAgICB0cmFuc2l0aW9uCiAgXTsKCiAgLyogICovCgogIC8vIHRoZSBkaXJlY3RpdmUgbW9kdWxlIHNob3VsZCBiZSBhcHBsaWVkIGxhc3QsIGFmdGVyIGFsbAogIC8vIGJ1aWx0LWluIG1vZHVsZXMgaGF2ZSBiZWVuIGFwcGxpZWQuCiAgdmFyIG1vZHVsZXMgPSBwbGF0Zm9ybU1vZHVsZXMuY29uY2F0KGJhc2VNb2R1bGVzKTsKCiAgdmFyIHBhdGNoID0gY3JlYXRlUGF0Y2hGdW5jdGlvbih7IG5vZGVPcHM6IG5vZGVPcHMsIG1vZHVsZXM6IG1vZHVsZXMgfSk7CgogIC8qKgogICAqIE5vdCB0eXBlIGNoZWNraW5nIHRoaXMgZmlsZSBiZWNhdXNlIGZsb3cgZG9lc24ndCBsaWtlIGF0dGFjaGluZwogICAqIHByb3BlcnRpZXMgdG8gRWxlbWVudHMuCiAgICovCgogIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogIGlmIChpc0lFOSkgewogICAgLy8gaHR0cDovL3d3dy5tYXR0czQxMS5jb20vcG9zdC9pbnRlcm5ldC1leHBsb3Jlci05LW9uaW5wdXQvCiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdzZWxlY3Rpb25jaGFuZ2UnLCBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBlbCA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7CiAgICAgIGlmIChlbCAmJiBlbC52bW9kZWwpIHsKICAgICAgICB0cmlnZ2VyKGVsLCAnaW5wdXQnKTsKICAgICAgfQogICAgfSk7CiAgfQoKICB2YXIgZGlyZWN0aXZlID0gewogICAgaW5zZXJ0ZWQ6IGZ1bmN0aW9uIGluc2VydGVkIChlbCwgYmluZGluZywgdm5vZGUsIG9sZFZub2RlKSB7CiAgICAgIGlmICh2bm9kZS50YWcgPT09ICdzZWxlY3QnKSB7CiAgICAgICAgLy8gIzY5MDMKICAgICAgICBpZiAob2xkVm5vZGUuZWxtICYmICFvbGRWbm9kZS5lbG0uX3ZPcHRpb25zKSB7CiAgICAgICAgICBtZXJnZVZOb2RlSG9vayh2bm9kZSwgJ3Bvc3RwYXRjaCcsIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZGlyZWN0aXZlLmNvbXBvbmVudFVwZGF0ZWQoZWwsIGJpbmRpbmcsIHZub2RlKTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzZXRTZWxlY3RlZChlbCwgYmluZGluZywgdm5vZGUuY29udGV4dCk7CiAgICAgICAgfQogICAgICAgIGVsLl92T3B0aW9ucyA9IFtdLm1hcC5jYWxsKGVsLm9wdGlvbnMsIGdldFZhbHVlKTsKICAgICAgfSBlbHNlIGlmICh2bm9kZS50YWcgPT09ICd0ZXh0YXJlYScgfHwgaXNUZXh0SW5wdXRUeXBlKGVsLnR5cGUpKSB7CiAgICAgICAgZWwuX3ZNb2RpZmllcnMgPSBiaW5kaW5nLm1vZGlmaWVyczsKICAgICAgICBpZiAoIWJpbmRpbmcubW9kaWZpZXJzLmxhenkpIHsKICAgICAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2NvbXBvc2l0aW9uc3RhcnQnLCBvbkNvbXBvc2l0aW9uU3RhcnQpOwogICAgICAgICAgZWwuYWRkRXZlbnRMaXN0ZW5lcignY29tcG9zaXRpb25lbmQnLCBvbkNvbXBvc2l0aW9uRW5kKTsKICAgICAgICAgIC8vIFNhZmFyaSA8IDEwLjIgJiBVSVdlYlZpZXcgZG9lc24ndCBmaXJlIGNvbXBvc2l0aW9uZW5kIHdoZW4KICAgICAgICAgIC8vIHN3aXRjaGluZyBmb2N1cyBiZWZvcmUgY29uZmlybWluZyBjb21wb3NpdGlvbiBjaG9pY2UKICAgICAgICAgIC8vIHRoaXMgYWxzbyBmaXhlcyB0aGUgaXNzdWUgd2hlcmUgc29tZSBicm93c2VycyBlLmcuIGlPUyBDaHJvbWUKICAgICAgICAgIC8vIGZpcmVzICJjaGFuZ2UiIGluc3RlYWQgb2YgImlucHV0IiBvbiBhdXRvY29tcGxldGUuCiAgICAgICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBvbkNvbXBvc2l0aW9uRW5kKTsKICAgICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgICAgICAgaWYgKGlzSUU5KSB7CiAgICAgICAgICAgIGVsLnZtb2RlbCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAoKICAgIGNvbXBvbmVudFVwZGF0ZWQ6IGZ1bmN0aW9uIGNvbXBvbmVudFVwZGF0ZWQgKGVsLCBiaW5kaW5nLCB2bm9kZSkgewogICAgICBpZiAodm5vZGUudGFnID09PSAnc2VsZWN0JykgewogICAgICAgIHNldFNlbGVjdGVkKGVsLCBiaW5kaW5nLCB2bm9kZS5jb250ZXh0KTsKICAgICAgICAvLyBpbiBjYXNlIHRoZSBvcHRpb25zIHJlbmRlcmVkIGJ5IHYtZm9yIGhhdmUgY2hhbmdlZCwKICAgICAgICAvLyBpdCdzIHBvc3NpYmxlIHRoYXQgdGhlIHZhbHVlIGlzIG91dC1vZi1zeW5jIHdpdGggdGhlIHJlbmRlcmVkIG9wdGlvbnMuCiAgICAgICAgLy8gZGV0ZWN0IHN1Y2ggY2FzZXMgYW5kIGZpbHRlciBvdXQgdmFsdWVzIHRoYXQgbm8gbG9uZ2VyIGhhcyBhIG1hdGNoaW5nCiAgICAgICAgLy8gb3B0aW9uIGluIHRoZSBET00uCiAgICAgICAgdmFyIHByZXZPcHRpb25zID0gZWwuX3ZPcHRpb25zOwogICAgICAgIHZhciBjdXJPcHRpb25zID0gZWwuX3ZPcHRpb25zID0gW10ubWFwLmNhbGwoZWwub3B0aW9ucywgZ2V0VmFsdWUpOwogICAgICAgIGlmIChjdXJPcHRpb25zLnNvbWUoZnVuY3Rpb24gKG8sIGkpIHsgcmV0dXJuICFsb29zZUVxdWFsKG8sIHByZXZPcHRpb25zW2ldKTsgfSkpIHsKICAgICAgICAgIC8vIHRyaWdnZXIgY2hhbmdlIGV2ZW50IGlmCiAgICAgICAgICAvLyBubyBtYXRjaGluZyBvcHRpb24gZm91bmQgZm9yIGF0IGxlYXN0IG9uZSB2YWx1ZQogICAgICAgICAgdmFyIG5lZWRSZXNldCA9IGVsLm11bHRpcGxlCiAgICAgICAgICAgID8gYmluZGluZy52YWx1ZS5zb21lKGZ1bmN0aW9uICh2KSB7IHJldHVybiBoYXNOb01hdGNoaW5nT3B0aW9uKHYsIGN1ck9wdGlvbnMpOyB9KQogICAgICAgICAgICA6IGJpbmRpbmcudmFsdWUgIT09IGJpbmRpbmcub2xkVmFsdWUgJiYgaGFzTm9NYXRjaGluZ09wdGlvbihiaW5kaW5nLnZhbHVlLCBjdXJPcHRpb25zKTsKICAgICAgICAgIGlmIChuZWVkUmVzZXQpIHsKICAgICAgICAgICAgdHJpZ2dlcihlbCwgJ2NoYW5nZScpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH07CgogIGZ1bmN0aW9uIHNldFNlbGVjdGVkIChlbCwgYmluZGluZywgdm0pIHsKICAgIGFjdHVhbGx5U2V0U2VsZWN0ZWQoZWwsIGJpbmRpbmcsIHZtKTsKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgaWYgKGlzSUUgfHwgaXNFZGdlKSB7CiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgIGFjdHVhbGx5U2V0U2VsZWN0ZWQoZWwsIGJpbmRpbmcsIHZtKTsKICAgICAgfSwgMCk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBhY3R1YWxseVNldFNlbGVjdGVkIChlbCwgYmluZGluZywgdm0pIHsKICAgIHZhciB2YWx1ZSA9IGJpbmRpbmcudmFsdWU7CiAgICB2YXIgaXNNdWx0aXBsZSA9IGVsLm11bHRpcGxlOwogICAgaWYgKGlzTXVsdGlwbGUgJiYgIUFycmF5LmlzQXJyYXkodmFsdWUpKSB7CiAgICAgIHdhcm4oCiAgICAgICAgIjxzZWxlY3QgbXVsdGlwbGUgdi1tb2RlbD1cIiIgKyAoYmluZGluZy5leHByZXNzaW9uKSArICJcIj4gIiArCiAgICAgICAgImV4cGVjdHMgYW4gQXJyYXkgdmFsdWUgZm9yIGl0cyBiaW5kaW5nLCBidXQgZ290ICIgKyAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHZhbHVlKS5zbGljZSg4LCAtMSkpLAogICAgICAgIHZtCiAgICAgICk7CiAgICAgIHJldHVybgogICAgfQogICAgdmFyIHNlbGVjdGVkLCBvcHRpb247CiAgICBmb3IgKHZhciBpID0gMCwgbCA9IGVsLm9wdGlvbnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgIG9wdGlvbiA9IGVsLm9wdGlvbnNbaV07CiAgICAgIGlmIChpc011bHRpcGxlKSB7CiAgICAgICAgc2VsZWN0ZWQgPSBsb29zZUluZGV4T2YodmFsdWUsIGdldFZhbHVlKG9wdGlvbikpID4gLTE7CiAgICAgICAgaWYgKG9wdGlvbi5zZWxlY3RlZCAhPT0gc2VsZWN0ZWQpIHsKICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IHNlbGVjdGVkOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAobG9vc2VFcXVhbChnZXRWYWx1ZShvcHRpb24pLCB2YWx1ZSkpIHsKICAgICAgICAgIGlmIChlbC5zZWxlY3RlZEluZGV4ICE9PSBpKSB7CiAgICAgICAgICAgIGVsLnNlbGVjdGVkSW5kZXggPSBpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuCiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAoIWlzTXVsdGlwbGUpIHsKICAgICAgZWwuc2VsZWN0ZWRJbmRleCA9IC0xOwogICAgfQogIH0KCiAgZnVuY3Rpb24gaGFzTm9NYXRjaGluZ09wdGlvbiAodmFsdWUsIG9wdGlvbnMpIHsKICAgIHJldHVybiBvcHRpb25zLmV2ZXJ5KGZ1bmN0aW9uIChvKSB7IHJldHVybiAhbG9vc2VFcXVhbChvLCB2YWx1ZSk7IH0pCiAgfQoKICBmdW5jdGlvbiBnZXRWYWx1ZSAob3B0aW9uKSB7CiAgICByZXR1cm4gJ192YWx1ZScgaW4gb3B0aW9uCiAgICAgID8gb3B0aW9uLl92YWx1ZQogICAgICA6IG9wdGlvbi52YWx1ZQogIH0KCiAgZnVuY3Rpb24gb25Db21wb3NpdGlvblN0YXJ0IChlKSB7CiAgICBlLnRhcmdldC5jb21wb3NpbmcgPSB0cnVlOwogIH0KCiAgZnVuY3Rpb24gb25Db21wb3NpdGlvbkVuZCAoZSkgewogICAgLy8gcHJldmVudCB0cmlnZ2VyaW5nIGFuIGlucHV0IGV2ZW50IGZvciBubyByZWFzb24KICAgIGlmICghZS50YXJnZXQuY29tcG9zaW5nKSB7IHJldHVybiB9CiAgICBlLnRhcmdldC5jb21wb3NpbmcgPSBmYWxzZTsKICAgIHRyaWdnZXIoZS50YXJnZXQsICdpbnB1dCcpOwogIH0KCiAgZnVuY3Rpb24gdHJpZ2dlciAoZWwsIHR5cGUpIHsKICAgIHZhciBlID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoJ0hUTUxFdmVudHMnKTsKICAgIGUuaW5pdEV2ZW50KHR5cGUsIHRydWUsIHRydWUpOwogICAgZWwuZGlzcGF0Y2hFdmVudChlKTsKICB9CgogIC8qICAqLwoKICAvLyByZWN1cnNpdmVseSBzZWFyY2ggZm9yIHBvc3NpYmxlIHRyYW5zaXRpb24gZGVmaW5lZCBpbnNpZGUgdGhlIGNvbXBvbmVudCByb290CiAgZnVuY3Rpb24gbG9jYXRlTm9kZSAodm5vZGUpIHsKICAgIHJldHVybiB2bm9kZS5jb21wb25lbnRJbnN0YW5jZSAmJiAoIXZub2RlLmRhdGEgfHwgIXZub2RlLmRhdGEudHJhbnNpdGlvbikKICAgICAgPyBsb2NhdGVOb2RlKHZub2RlLmNvbXBvbmVudEluc3RhbmNlLl92bm9kZSkKICAgICAgOiB2bm9kZQogIH0KCiAgdmFyIHNob3cgPSB7CiAgICBiaW5kOiBmdW5jdGlvbiBiaW5kIChlbCwgcmVmLCB2bm9kZSkgewogICAgICB2YXIgdmFsdWUgPSByZWYudmFsdWU7CgogICAgICB2bm9kZSA9IGxvY2F0ZU5vZGUodm5vZGUpOwogICAgICB2YXIgdHJhbnNpdGlvbiQkMSA9IHZub2RlLmRhdGEgJiYgdm5vZGUuZGF0YS50cmFuc2l0aW9uOwogICAgICB2YXIgb3JpZ2luYWxEaXNwbGF5ID0gZWwuX192T3JpZ2luYWxEaXNwbGF5ID0KICAgICAgICBlbC5zdHlsZS5kaXNwbGF5ID09PSAnbm9uZScgPyAnJyA6IGVsLnN0eWxlLmRpc3BsYXk7CiAgICAgIGlmICh2YWx1ZSAmJiB0cmFuc2l0aW9uJCQxKSB7CiAgICAgICAgdm5vZGUuZGF0YS5zaG93ID0gdHJ1ZTsKICAgICAgICBlbnRlcih2bm9kZSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgZWwuc3R5bGUuZGlzcGxheSA9IG9yaWdpbmFsRGlzcGxheTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBlbC5zdHlsZS5kaXNwbGF5ID0gdmFsdWUgPyBvcmlnaW5hbERpc3BsYXkgOiAnbm9uZSc7CiAgICAgIH0KICAgIH0sCgogICAgdXBkYXRlOiBmdW5jdGlvbiB1cGRhdGUgKGVsLCByZWYsIHZub2RlKSB7CiAgICAgIHZhciB2YWx1ZSA9IHJlZi52YWx1ZTsKICAgICAgdmFyIG9sZFZhbHVlID0gcmVmLm9sZFZhbHVlOwoKICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICAgIGlmICghdmFsdWUgPT09ICFvbGRWYWx1ZSkgeyByZXR1cm4gfQogICAgICB2bm9kZSA9IGxvY2F0ZU5vZGUodm5vZGUpOwogICAgICB2YXIgdHJhbnNpdGlvbiQkMSA9IHZub2RlLmRhdGEgJiYgdm5vZGUuZGF0YS50cmFuc2l0aW9uOwogICAgICBpZiAodHJhbnNpdGlvbiQkMSkgewogICAgICAgIHZub2RlLmRhdGEuc2hvdyA9IHRydWU7CiAgICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgICBlbnRlcih2bm9kZSwgZnVuY3Rpb24gKCkgewogICAgICAgICAgICBlbC5zdHlsZS5kaXNwbGF5ID0gZWwuX192T3JpZ2luYWxEaXNwbGF5OwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGxlYXZlKHZub2RlLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGVsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZWwuc3R5bGUuZGlzcGxheSA9IHZhbHVlID8gZWwuX192T3JpZ2luYWxEaXNwbGF5IDogJ25vbmUnOwogICAgICB9CiAgICB9LAoKICAgIHVuYmluZDogZnVuY3Rpb24gdW5iaW5kICgKICAgICAgZWwsCiAgICAgIGJpbmRpbmcsCiAgICAgIHZub2RlLAogICAgICBvbGRWbm9kZSwKICAgICAgaXNEZXN0cm95CiAgICApIHsKICAgICAgaWYgKCFpc0Rlc3Ryb3kpIHsKICAgICAgICBlbC5zdHlsZS5kaXNwbGF5ID0gZWwuX192T3JpZ2luYWxEaXNwbGF5OwogICAgICB9CiAgICB9CiAgfTsKCiAgdmFyIHBsYXRmb3JtRGlyZWN0aXZlcyA9IHsKICAgIG1vZGVsOiBkaXJlY3RpdmUsCiAgICBzaG93OiBzaG93CiAgfTsKCiAgLyogICovCgogIHZhciB0cmFuc2l0aW9uUHJvcHMgPSB7CiAgICBuYW1lOiBTdHJpbmcsCiAgICBhcHBlYXI6IEJvb2xlYW4sCiAgICBjc3M6IEJvb2xlYW4sCiAgICBtb2RlOiBTdHJpbmcsCiAgICB0eXBlOiBTdHJpbmcsCiAgICBlbnRlckNsYXNzOiBTdHJpbmcsCiAgICBsZWF2ZUNsYXNzOiBTdHJpbmcsCiAgICBlbnRlclRvQ2xhc3M6IFN0cmluZywKICAgIGxlYXZlVG9DbGFzczogU3RyaW5nLAogICAgZW50ZXJBY3RpdmVDbGFzczogU3RyaW5nLAogICAgbGVhdmVBY3RpdmVDbGFzczogU3RyaW5nLAogICAgYXBwZWFyQ2xhc3M6IFN0cmluZywKICAgIGFwcGVhckFjdGl2ZUNsYXNzOiBTdHJpbmcsCiAgICBhcHBlYXJUb0NsYXNzOiBTdHJpbmcsCiAgICBkdXJhdGlvbjogW051bWJlciwgU3RyaW5nLCBPYmplY3RdCiAgfTsKCiAgLy8gaW4gY2FzZSB0aGUgY2hpbGQgaXMgYWxzbyBhbiBhYnN0cmFjdCBjb21wb25lbnQsIGUuZy4gPGtlZXAtYWxpdmU+CiAgLy8gd2Ugd2FudCB0byByZWN1cnNpdmVseSByZXRyaWV2ZSB0aGUgcmVhbCBjb21wb25lbnQgdG8gYmUgcmVuZGVyZWQKICBmdW5jdGlvbiBnZXRSZWFsQ2hpbGQgKHZub2RlKSB7CiAgICB2YXIgY29tcE9wdGlvbnMgPSB2bm9kZSAmJiB2bm9kZS5jb21wb25lbnRPcHRpb25zOwogICAgaWYgKGNvbXBPcHRpb25zICYmIGNvbXBPcHRpb25zLkN0b3Iub3B0aW9ucy5hYnN0cmFjdCkgewogICAgICByZXR1cm4gZ2V0UmVhbENoaWxkKGdldEZpcnN0Q29tcG9uZW50Q2hpbGQoY29tcE9wdGlvbnMuY2hpbGRyZW4pKQogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHZub2RlCiAgICB9CiAgfQoKICBmdW5jdGlvbiBleHRyYWN0VHJhbnNpdGlvbkRhdGEgKGNvbXApIHsKICAgIHZhciBkYXRhID0ge307CiAgICB2YXIgb3B0aW9ucyA9IGNvbXAuJG9wdGlvbnM7CiAgICAvLyBwcm9wcwogICAgZm9yICh2YXIga2V5IGluIG9wdGlvbnMucHJvcHNEYXRhKSB7CiAgICAgIGRhdGFba2V5XSA9IGNvbXBba2V5XTsKICAgIH0KICAgIC8vIGV2ZW50cy4KICAgIC8vIGV4dHJhY3QgbGlzdGVuZXJzIGFuZCBwYXNzIHRoZW0gZGlyZWN0bHkgdG8gdGhlIHRyYW5zaXRpb24gbWV0aG9kcwogICAgdmFyIGxpc3RlbmVycyA9IG9wdGlvbnMuX3BhcmVudExpc3RlbmVyczsKICAgIGZvciAodmFyIGtleSQxIGluIGxpc3RlbmVycykgewogICAgICBkYXRhW2NhbWVsaXplKGtleSQxKV0gPSBsaXN0ZW5lcnNba2V5JDFdOwogICAgfQogICAgcmV0dXJuIGRhdGEKICB9CgogIGZ1bmN0aW9uIHBsYWNlaG9sZGVyIChoLCByYXdDaGlsZCkgewogICAgaWYgKC9cZC1rZWVwLWFsaXZlJC8udGVzdChyYXdDaGlsZC50YWcpKSB7CiAgICAgIHJldHVybiBoKCdrZWVwLWFsaXZlJywgewogICAgICAgIHByb3BzOiByYXdDaGlsZC5jb21wb25lbnRPcHRpb25zLnByb3BzRGF0YQogICAgICB9KQogICAgfQogIH0KCiAgZnVuY3Rpb24gaGFzUGFyZW50VHJhbnNpdGlvbiAodm5vZGUpIHsKICAgIHdoaWxlICgodm5vZGUgPSB2bm9kZS5wYXJlbnQpKSB7CiAgICAgIGlmICh2bm9kZS5kYXRhLnRyYW5zaXRpb24pIHsKICAgICAgICByZXR1cm4gdHJ1ZQogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBpc1NhbWVDaGlsZCAoY2hpbGQsIG9sZENoaWxkKSB7CiAgICByZXR1cm4gb2xkQ2hpbGQua2V5ID09PSBjaGlsZC5rZXkgJiYgb2xkQ2hpbGQudGFnID09PSBjaGlsZC50YWcKICB9CgogIHZhciBpc05vdFRleHROb2RlID0gZnVuY3Rpb24gKGMpIHsgcmV0dXJuIGMudGFnIHx8IGlzQXN5bmNQbGFjZWhvbGRlcihjKTsgfTsKCiAgdmFyIGlzVlNob3dEaXJlY3RpdmUgPSBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5uYW1lID09PSAnc2hvdyc7IH07CgogIHZhciBUcmFuc2l0aW9uID0gewogICAgbmFtZTogJ3RyYW5zaXRpb24nLAogICAgcHJvcHM6IHRyYW5zaXRpb25Qcm9wcywKICAgIGFic3RyYWN0OiB0cnVlLAoKICAgIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyIChoKSB7CiAgICAgIHZhciB0aGlzJDEgPSB0aGlzOwoKICAgICAgdmFyIGNoaWxkcmVuID0gdGhpcy4kc2xvdHMuZGVmYXVsdDsKICAgICAgaWYgKCFjaGlsZHJlbikgewogICAgICAgIHJldHVybgogICAgICB9CgogICAgICAvLyBmaWx0ZXIgb3V0IHRleHQgbm9kZXMgKHBvc3NpYmxlIHdoaXRlc3BhY2VzKQogICAgICBjaGlsZHJlbiA9IGNoaWxkcmVuLmZpbHRlcihpc05vdFRleHROb2RlKTsKICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICAgIGlmICghY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuCiAgICAgIH0KCiAgICAgIC8vIHdhcm4gbXVsdGlwbGUgZWxlbWVudHMKICAgICAgaWYgKGNoaWxkcmVuLmxlbmd0aCA+IDEpIHsKICAgICAgICB3YXJuKAogICAgICAgICAgJzx0cmFuc2l0aW9uPiBjYW4gb25seSBiZSB1c2VkIG9uIGEgc2luZ2xlIGVsZW1lbnQuIFVzZSAnICsKICAgICAgICAgICc8dHJhbnNpdGlvbi1ncm91cD4gZm9yIGxpc3RzLicsCiAgICAgICAgICB0aGlzLiRwYXJlbnQKICAgICAgICApOwogICAgICB9CgogICAgICB2YXIgbW9kZSA9IHRoaXMubW9kZTsKCiAgICAgIC8vIHdhcm4gaW52YWxpZCBtb2RlCiAgICAgIGlmIChtb2RlICYmIG1vZGUgIT09ICdpbi1vdXQnICYmIG1vZGUgIT09ICdvdXQtaW4nCiAgICAgICkgewogICAgICAgIHdhcm4oCiAgICAgICAgICAnaW52YWxpZCA8dHJhbnNpdGlvbj4gbW9kZTogJyArIG1vZGUsCiAgICAgICAgICB0aGlzLiRwYXJlbnQKICAgICAgICApOwogICAgICB9CgogICAgICB2YXIgcmF3Q2hpbGQgPSBjaGlsZHJlblswXTsKCiAgICAgIC8vIGlmIHRoaXMgaXMgYSBjb21wb25lbnQgcm9vdCBub2RlIGFuZCB0aGUgY29tcG9uZW50J3MKICAgICAgLy8gcGFyZW50IGNvbnRhaW5lciBub2RlIGFsc28gaGFzIHRyYW5zaXRpb24sIHNraXAuCiAgICAgIGlmIChoYXNQYXJlbnRUcmFuc2l0aW9uKHRoaXMuJHZub2RlKSkgewogICAgICAgIHJldHVybiByYXdDaGlsZAogICAgICB9CgogICAgICAvLyBhcHBseSB0cmFuc2l0aW9uIGRhdGEgdG8gY2hpbGQKICAgICAgLy8gdXNlIGdldFJlYWxDaGlsZCgpIHRvIGlnbm9yZSBhYnN0cmFjdCBjb21wb25lbnRzIGUuZy4ga2VlcC1hbGl2ZQogICAgICB2YXIgY2hpbGQgPSBnZXRSZWFsQ2hpbGQocmF3Q2hpbGQpOwogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgaWYgKCFjaGlsZCkgewogICAgICAgIHJldHVybiByYXdDaGlsZAogICAgICB9CgogICAgICBpZiAodGhpcy5fbGVhdmluZykgewogICAgICAgIHJldHVybiBwbGFjZWhvbGRlcihoLCByYXdDaGlsZCkKICAgICAgfQoKICAgICAgLy8gZW5zdXJlIGEga2V5IHRoYXQgaXMgdW5pcXVlIHRvIHRoZSB2bm9kZSB0eXBlIGFuZCB0byB0aGlzIHRyYW5zaXRpb24KICAgICAgLy8gY29tcG9uZW50IGluc3RhbmNlLiBUaGlzIGtleSB3aWxsIGJlIHVzZWQgdG8gcmVtb3ZlIHBlbmRpbmcgbGVhdmluZyBub2RlcwogICAgICAvLyBkdXJpbmcgZW50ZXJpbmcuCiAgICAgIHZhciBpZCA9ICJfX3RyYW5zaXRpb24tIiArICh0aGlzLl91aWQpICsgIi0iOwogICAgICBjaGlsZC5rZXkgPSBjaGlsZC5rZXkgPT0gbnVsbAogICAgICAgID8gY2hpbGQuaXNDb21tZW50CiAgICAgICAgICA/IGlkICsgJ2NvbW1lbnQnCiAgICAgICAgICA6IGlkICsgY2hpbGQudGFnCiAgICAgICAgOiBpc1ByaW1pdGl2ZShjaGlsZC5rZXkpCiAgICAgICAgICA/IChTdHJpbmcoY2hpbGQua2V5KS5pbmRleE9mKGlkKSA9PT0gMCA/IGNoaWxkLmtleSA6IGlkICsgY2hpbGQua2V5KQogICAgICAgICAgOiBjaGlsZC5rZXk7CgogICAgICB2YXIgZGF0YSA9IChjaGlsZC5kYXRhIHx8IChjaGlsZC5kYXRhID0ge30pKS50cmFuc2l0aW9uID0gZXh0cmFjdFRyYW5zaXRpb25EYXRhKHRoaXMpOwogICAgICB2YXIgb2xkUmF3Q2hpbGQgPSB0aGlzLl92bm9kZTsKICAgICAgdmFyIG9sZENoaWxkID0gZ2V0UmVhbENoaWxkKG9sZFJhd0NoaWxkKTsKCiAgICAgIC8vIG1hcmsgdi1zaG93CiAgICAgIC8vIHNvIHRoYXQgdGhlIHRyYW5zaXRpb24gbW9kdWxlIGNhbiBoYW5kIG92ZXIgdGhlIGNvbnRyb2wgdG8gdGhlIGRpcmVjdGl2ZQogICAgICBpZiAoY2hpbGQuZGF0YS5kaXJlY3RpdmVzICYmIGNoaWxkLmRhdGEuZGlyZWN0aXZlcy5zb21lKGlzVlNob3dEaXJlY3RpdmUpKSB7CiAgICAgICAgY2hpbGQuZGF0YS5zaG93ID0gdHJ1ZTsKICAgICAgfQoKICAgICAgaWYgKAogICAgICAgIG9sZENoaWxkICYmCiAgICAgICAgb2xkQ2hpbGQuZGF0YSAmJgogICAgICAgICFpc1NhbWVDaGlsZChjaGlsZCwgb2xkQ2hpbGQpICYmCiAgICAgICAgIWlzQXN5bmNQbGFjZWhvbGRlcihvbGRDaGlsZCkgJiYKICAgICAgICAvLyAjNjY4NyBjb21wb25lbnQgcm9vdCBpcyBhIGNvbW1lbnQgbm9kZQogICAgICAgICEob2xkQ2hpbGQuY29tcG9uZW50SW5zdGFuY2UgJiYgb2xkQ2hpbGQuY29tcG9uZW50SW5zdGFuY2UuX3Zub2RlLmlzQ29tbWVudCkKICAgICAgKSB7CiAgICAgICAgLy8gcmVwbGFjZSBvbGQgY2hpbGQgdHJhbnNpdGlvbiBkYXRhIHdpdGggZnJlc2ggb25lCiAgICAgICAgLy8gaW1wb3J0YW50IGZvciBkeW5hbWljIHRyYW5zaXRpb25zIQogICAgICAgIHZhciBvbGREYXRhID0gb2xkQ2hpbGQuZGF0YS50cmFuc2l0aW9uID0gZXh0ZW5kKHt9LCBkYXRhKTsKICAgICAgICAvLyBoYW5kbGUgdHJhbnNpdGlvbiBtb2RlCiAgICAgICAgaWYgKG1vZGUgPT09ICdvdXQtaW4nKSB7CiAgICAgICAgICAvLyByZXR1cm4gcGxhY2Vob2xkZXIgbm9kZSBhbmQgcXVldWUgdXBkYXRlIHdoZW4gbGVhdmUgZmluaXNoZXMKICAgICAgICAgIHRoaXMuX2xlYXZpbmcgPSB0cnVlOwogICAgICAgICAgbWVyZ2VWTm9kZUhvb2sob2xkRGF0YSwgJ2FmdGVyTGVhdmUnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHRoaXMkMS5fbGVhdmluZyA9IGZhbHNlOwogICAgICAgICAgICB0aGlzJDEuJGZvcmNlVXBkYXRlKCk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiBwbGFjZWhvbGRlcihoLCByYXdDaGlsZCkKICAgICAgICB9IGVsc2UgaWYgKG1vZGUgPT09ICdpbi1vdXQnKSB7CiAgICAgICAgICBpZiAoaXNBc3luY1BsYWNlaG9sZGVyKGNoaWxkKSkgewogICAgICAgICAgICByZXR1cm4gb2xkUmF3Q2hpbGQKICAgICAgICAgIH0KICAgICAgICAgIHZhciBkZWxheWVkTGVhdmU7CiAgICAgICAgICB2YXIgcGVyZm9ybUxlYXZlID0gZnVuY3Rpb24gKCkgeyBkZWxheWVkTGVhdmUoKTsgfTsKICAgICAgICAgIG1lcmdlVk5vZGVIb29rKGRhdGEsICdhZnRlckVudGVyJywgcGVyZm9ybUxlYXZlKTsKICAgICAgICAgIG1lcmdlVk5vZGVIb29rKGRhdGEsICdlbnRlckNhbmNlbGxlZCcsIHBlcmZvcm1MZWF2ZSk7CiAgICAgICAgICBtZXJnZVZOb2RlSG9vayhvbGREYXRhLCAnZGVsYXlMZWF2ZScsIGZ1bmN0aW9uIChsZWF2ZSkgeyBkZWxheWVkTGVhdmUgPSBsZWF2ZTsgfSk7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gcmF3Q2hpbGQKICAgIH0KICB9OwoKICAvKiAgKi8KCiAgdmFyIHByb3BzID0gZXh0ZW5kKHsKICAgIHRhZzogU3RyaW5nLAogICAgbW92ZUNsYXNzOiBTdHJpbmcKICB9LCB0cmFuc2l0aW9uUHJvcHMpOwoKICBkZWxldGUgcHJvcHMubW9kZTsKCiAgdmFyIFRyYW5zaXRpb25Hcm91cCA9IHsKICAgIHByb3BzOiBwcm9wcywKCiAgICBiZWZvcmVNb3VudDogZnVuY3Rpb24gYmVmb3JlTW91bnQgKCkgewogICAgICB2YXIgdGhpcyQxID0gdGhpczsKCiAgICAgIHZhciB1cGRhdGUgPSB0aGlzLl91cGRhdGU7CiAgICAgIHRoaXMuX3VwZGF0ZSA9IGZ1bmN0aW9uICh2bm9kZSwgaHlkcmF0aW5nKSB7CiAgICAgICAgdmFyIHJlc3RvcmVBY3RpdmVJbnN0YW5jZSA9IHNldEFjdGl2ZUluc3RhbmNlKHRoaXMkMSk7CiAgICAgICAgLy8gZm9yY2UgcmVtb3ZpbmcgcGFzcwogICAgICAgIHRoaXMkMS5fX3BhdGNoX18oCiAgICAgICAgICB0aGlzJDEuX3Zub2RlLAogICAgICAgICAgdGhpcyQxLmtlcHQsCiAgICAgICAgICBmYWxzZSwgLy8gaHlkcmF0aW5nCiAgICAgICAgICB0cnVlIC8vIHJlbW92ZU9ubHkgKCFpbXBvcnRhbnQsIGF2b2lkcyB1bm5lY2Vzc2FyeSBtb3ZlcykKICAgICAgICApOwogICAgICAgIHRoaXMkMS5fdm5vZGUgPSB0aGlzJDEua2VwdDsKICAgICAgICByZXN0b3JlQWN0aXZlSW5zdGFuY2UoKTsKICAgICAgICB1cGRhdGUuY2FsbCh0aGlzJDEsIHZub2RlLCBoeWRyYXRpbmcpOwogICAgICB9OwogICAgfSwKCiAgICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlciAoaCkgewogICAgICB2YXIgdGFnID0gdGhpcy50YWcgfHwgdGhpcy4kdm5vZGUuZGF0YS50YWcgfHwgJ3NwYW4nOwogICAgICB2YXIgbWFwID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgdmFyIHByZXZDaGlsZHJlbiA9IHRoaXMucHJldkNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjsKICAgICAgdmFyIHJhd0NoaWxkcmVuID0gdGhpcy4kc2xvdHMuZGVmYXVsdCB8fCBbXTsKICAgICAgdmFyIGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbiA9IFtdOwogICAgICB2YXIgdHJhbnNpdGlvbkRhdGEgPSBleHRyYWN0VHJhbnNpdGlvbkRhdGEodGhpcyk7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJhd0NoaWxkcmVuLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGMgPSByYXdDaGlsZHJlbltpXTsKICAgICAgICBpZiAoYy50YWcpIHsKICAgICAgICAgIGlmIChjLmtleSAhPSBudWxsICYmIFN0cmluZyhjLmtleSkuaW5kZXhPZignX192bGlzdCcpICE9PSAwKSB7CiAgICAgICAgICAgIGNoaWxkcmVuLnB1c2goYyk7CiAgICAgICAgICAgIG1hcFtjLmtleV0gPSBjCiAgICAgICAgICAgIDsoYy5kYXRhIHx8IChjLmRhdGEgPSB7fSkpLnRyYW5zaXRpb24gPSB0cmFuc2l0aW9uRGF0YTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciBvcHRzID0gYy5jb21wb25lbnRPcHRpb25zOwogICAgICAgICAgICB2YXIgbmFtZSA9IG9wdHMgPyAob3B0cy5DdG9yLm9wdGlvbnMubmFtZSB8fCBvcHRzLnRhZyB8fCAnJykgOiBjLnRhZzsKICAgICAgICAgICAgd2FybigoIjx0cmFuc2l0aW9uLWdyb3VwPiBjaGlsZHJlbiBtdXN0IGJlIGtleWVkOiA8IiArIG5hbWUgKyAiPiIpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChwcmV2Q2hpbGRyZW4pIHsKICAgICAgICB2YXIga2VwdCA9IFtdOwogICAgICAgIHZhciByZW1vdmVkID0gW107CiAgICAgICAgZm9yICh2YXIgaSQxID0gMDsgaSQxIDwgcHJldkNoaWxkcmVuLmxlbmd0aDsgaSQxKyspIHsKICAgICAgICAgIHZhciBjJDEgPSBwcmV2Q2hpbGRyZW5baSQxXTsKICAgICAgICAgIGMkMS5kYXRhLnRyYW5zaXRpb24gPSB0cmFuc2l0aW9uRGF0YTsKICAgICAgICAgIGMkMS5kYXRhLnBvcyA9IGMkMS5lbG0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgICBpZiAobWFwW2MkMS5rZXldKSB7CiAgICAgICAgICAgIGtlcHQucHVzaChjJDEpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVtb3ZlZC5wdXNoKGMkMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRoaXMua2VwdCA9IGgodGFnLCBudWxsLCBrZXB0KTsKICAgICAgICB0aGlzLnJlbW92ZWQgPSByZW1vdmVkOwogICAgICB9CgogICAgICByZXR1cm4gaCh0YWcsIG51bGwsIGNoaWxkcmVuKQogICAgfSwKCiAgICB1cGRhdGVkOiBmdW5jdGlvbiB1cGRhdGVkICgpIHsKICAgICAgdmFyIGNoaWxkcmVuID0gdGhpcy5wcmV2Q2hpbGRyZW47CiAgICAgIHZhciBtb3ZlQ2xhc3MgPSB0aGlzLm1vdmVDbGFzcyB8fCAoKHRoaXMubmFtZSB8fCAndicpICsgJy1tb3ZlJyk7CiAgICAgIGlmICghY2hpbGRyZW4ubGVuZ3RoIHx8ICF0aGlzLmhhc01vdmUoY2hpbGRyZW5bMF0uZWxtLCBtb3ZlQ2xhc3MpKSB7CiAgICAgICAgcmV0dXJuCiAgICAgIH0KCiAgICAgIC8vIHdlIGRpdmlkZSB0aGUgd29yayBpbnRvIHRocmVlIGxvb3BzIHRvIGF2b2lkIG1peGluZyBET00gcmVhZHMgYW5kIHdyaXRlcwogICAgICAvLyBpbiBlYWNoIGl0ZXJhdGlvbiAtIHdoaWNoIGhlbHBzIHByZXZlbnQgbGF5b3V0IHRocmFzaGluZy4KICAgICAgY2hpbGRyZW4uZm9yRWFjaChjYWxsUGVuZGluZ0Nicyk7CiAgICAgIGNoaWxkcmVuLmZvckVhY2gocmVjb3JkUG9zaXRpb24pOwogICAgICBjaGlsZHJlbi5mb3JFYWNoKGFwcGx5VHJhbnNsYXRpb24pOwoKICAgICAgLy8gZm9yY2UgcmVmbG93IHRvIHB1dCBldmVyeXRoaW5nIGluIHBvc2l0aW9uCiAgICAgIC8vIGFzc2lnbiB0byB0aGlzIHRvIGF2b2lkIGJlaW5nIHJlbW92ZWQgaW4gdHJlZS1zaGFraW5nCiAgICAgIC8vICRmbG93LWRpc2FibGUtbGluZQogICAgICB0aGlzLl9yZWZsb3cgPSBkb2N1bWVudC5ib2R5Lm9mZnNldEhlaWdodDsKCiAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGMpIHsKICAgICAgICBpZiAoYy5kYXRhLm1vdmVkKSB7CiAgICAgICAgICB2YXIgZWwgPSBjLmVsbTsKICAgICAgICAgIHZhciBzID0gZWwuc3R5bGU7CiAgICAgICAgICBhZGRUcmFuc2l0aW9uQ2xhc3MoZWwsIG1vdmVDbGFzcyk7CiAgICAgICAgICBzLnRyYW5zZm9ybSA9IHMuV2Via2l0VHJhbnNmb3JtID0gcy50cmFuc2l0aW9uRHVyYXRpb24gPSAnJzsKICAgICAgICAgIGVsLmFkZEV2ZW50TGlzdGVuZXIodHJhbnNpdGlvbkVuZEV2ZW50LCBlbC5fbW92ZUNiID0gZnVuY3Rpb24gY2IgKGUpIHsKICAgICAgICAgICAgaWYgKGUgJiYgZS50YXJnZXQgIT09IGVsKSB7CiAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFlIHx8IC90cmFuc2Zvcm0kLy50ZXN0KGUucHJvcGVydHlOYW1lKSkgewogICAgICAgICAgICAgIGVsLnJlbW92ZUV2ZW50TGlzdGVuZXIodHJhbnNpdGlvbkVuZEV2ZW50LCBjYik7CiAgICAgICAgICAgICAgZWwuX21vdmVDYiA9IG51bGw7CiAgICAgICAgICAgICAgcmVtb3ZlVHJhbnNpdGlvbkNsYXNzKGVsLCBtb3ZlQ2xhc3MpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICBtZXRob2RzOiB7CiAgICAgIGhhc01vdmU6IGZ1bmN0aW9uIGhhc01vdmUgKGVsLCBtb3ZlQ2xhc3MpIHsKICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgICBpZiAoIWhhc1RyYW5zaXRpb24pIHsKICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgIH0KICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgICBpZiAodGhpcy5faGFzTW92ZSkgewogICAgICAgICAgcmV0dXJuIHRoaXMuX2hhc01vdmUKICAgICAgICB9CiAgICAgICAgLy8gRGV0ZWN0IHdoZXRoZXIgYW4gZWxlbWVudCB3aXRoIHRoZSBtb3ZlIGNsYXNzIGFwcGxpZWQgaGFzCiAgICAgICAgLy8gQ1NTIHRyYW5zaXRpb25zLiBTaW5jZSB0aGUgZWxlbWVudCBtYXkgYmUgaW5zaWRlIGFuIGVudGVyaW5nCiAgICAgICAgLy8gdHJhbnNpdGlvbiBhdCB0aGlzIHZlcnkgbW9tZW50LCB3ZSBtYWtlIGEgY2xvbmUgb2YgaXQgYW5kIHJlbW92ZQogICAgICAgIC8vIGFsbCBvdGhlciB0cmFuc2l0aW9uIGNsYXNzZXMgYXBwbGllZCB0byBlbnN1cmUgb25seSB0aGUgbW92ZSBjbGFzcwogICAgICAgIC8vIGlzIGFwcGxpZWQuCiAgICAgICAgdmFyIGNsb25lID0gZWwuY2xvbmVOb2RlKCk7CiAgICAgICAgaWYgKGVsLl90cmFuc2l0aW9uQ2xhc3NlcykgewogICAgICAgICAgZWwuX3RyYW5zaXRpb25DbGFzc2VzLmZvckVhY2goZnVuY3Rpb24gKGNscykgeyByZW1vdmVDbGFzcyhjbG9uZSwgY2xzKTsgfSk7CiAgICAgICAgfQogICAgICAgIGFkZENsYXNzKGNsb25lLCBtb3ZlQ2xhc3MpOwogICAgICAgIGNsb25lLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgdGhpcy4kZWwuYXBwZW5kQ2hpbGQoY2xvbmUpOwogICAgICAgIHZhciBpbmZvID0gZ2V0VHJhbnNpdGlvbkluZm8oY2xvbmUpOwogICAgICAgIHRoaXMuJGVsLnJlbW92ZUNoaWxkKGNsb25lKTsKICAgICAgICByZXR1cm4gKHRoaXMuX2hhc01vdmUgPSBpbmZvLmhhc1RyYW5zZm9ybSkKICAgICAgfQogICAgfQogIH07CgogIGZ1bmN0aW9uIGNhbGxQZW5kaW5nQ2JzIChjKSB7CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgIGlmIChjLmVsbS5fbW92ZUNiKSB7CiAgICAgIGMuZWxtLl9tb3ZlQ2IoKTsKICAgIH0KICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgaWYgKGMuZWxtLl9lbnRlckNiKSB7CiAgICAgIGMuZWxtLl9lbnRlckNiKCk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiByZWNvcmRQb3NpdGlvbiAoYykgewogICAgYy5kYXRhLm5ld1BvcyA9IGMuZWxtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogIH0KCiAgZnVuY3Rpb24gYXBwbHlUcmFuc2xhdGlvbiAoYykgewogICAgdmFyIG9sZFBvcyA9IGMuZGF0YS5wb3M7CiAgICB2YXIgbmV3UG9zID0gYy5kYXRhLm5ld1BvczsKICAgIHZhciBkeCA9IG9sZFBvcy5sZWZ0IC0gbmV3UG9zLmxlZnQ7CiAgICB2YXIgZHkgPSBvbGRQb3MudG9wIC0gbmV3UG9zLnRvcDsKICAgIGlmIChkeCB8fCBkeSkgewogICAgICBjLmRhdGEubW92ZWQgPSB0cnVlOwogICAgICB2YXIgcyA9IGMuZWxtLnN0eWxlOwogICAgICBzLnRyYW5zZm9ybSA9IHMuV2Via2l0VHJhbnNmb3JtID0gInRyYW5zbGF0ZSgiICsgZHggKyAicHgsIiArIGR5ICsgInB4KSI7CiAgICAgIHMudHJhbnNpdGlvbkR1cmF0aW9uID0gJzBzJzsKICAgIH0KICB9CgogIHZhciBwbGF0Zm9ybUNvbXBvbmVudHMgPSB7CiAgICBUcmFuc2l0aW9uOiBUcmFuc2l0aW9uLAogICAgVHJhbnNpdGlvbkdyb3VwOiBUcmFuc2l0aW9uR3JvdXAKICB9OwoKICAvKiAgKi8KCiAgLy8gaW5zdGFsbCBwbGF0Zm9ybSBzcGVjaWZpYyB1dGlscwogIFZ1ZS5jb25maWcubXVzdFVzZVByb3AgPSBtdXN0VXNlUHJvcDsKICBWdWUuY29uZmlnLmlzUmVzZXJ2ZWRUYWcgPSBpc1Jlc2VydmVkVGFnOwogIFZ1ZS5jb25maWcuaXNSZXNlcnZlZEF0dHIgPSBpc1Jlc2VydmVkQXR0cjsKICBWdWUuY29uZmlnLmdldFRhZ05hbWVzcGFjZSA9IGdldFRhZ05hbWVzcGFjZTsKICBWdWUuY29uZmlnLmlzVW5rbm93bkVsZW1lbnQgPSBpc1Vua25vd25FbGVtZW50OwoKICAvLyBpbnN0YWxsIHBsYXRmb3JtIHJ1bnRpbWUgZGlyZWN0aXZlcyAmIGNvbXBvbmVudHMKICBleHRlbmQoVnVlLm9wdGlvbnMuZGlyZWN0aXZlcywgcGxhdGZvcm1EaXJlY3RpdmVzKTsKICBleHRlbmQoVnVlLm9wdGlvbnMuY29tcG9uZW50cywgcGxhdGZvcm1Db21wb25lbnRzKTsKCiAgLy8gaW5zdGFsbCBwbGF0Zm9ybSBwYXRjaCBmdW5jdGlvbgogIFZ1ZS5wcm90b3R5cGUuX19wYXRjaF9fID0gaW5Ccm93c2VyID8gcGF0Y2ggOiBub29wOwoKICAvLyBwdWJsaWMgbW91bnQgbWV0aG9kCiAgVnVlLnByb3RvdHlwZS4kbW91bnQgPSBmdW5jdGlvbiAoCiAgICBlbCwKICAgIGh5ZHJhdGluZwogICkgewogICAgZWwgPSBlbCAmJiBpbkJyb3dzZXIgPyBxdWVyeShlbCkgOiB1bmRlZmluZWQ7CiAgICByZXR1cm4gbW91bnRDb21wb25lbnQodGhpcywgZWwsIGh5ZHJhdGluZykKICB9OwoKICAvLyBkZXZ0b29scyBnbG9iYWwgaG9vawogIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgaWYgKGluQnJvd3NlcikgewogICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgIGlmIChjb25maWcuZGV2dG9vbHMpIHsKICAgICAgICBpZiAoZGV2dG9vbHMpIHsKICAgICAgICAgIGRldnRvb2xzLmVtaXQoJ2luaXQnLCBWdWUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zb2xlW2NvbnNvbGUuaW5mbyA/ICdpbmZvJyA6ICdsb2cnXSgKICAgICAgICAgICAgJ0Rvd25sb2FkIHRoZSBWdWUgRGV2dG9vbHMgZXh0ZW5zaW9uIGZvciBhIGJldHRlciBkZXZlbG9wbWVudCBleHBlcmllbmNlOlxuJyArCiAgICAgICAgICAgICdodHRwczovL2dpdGh1Yi5jb20vdnVlanMvdnVlLWRldnRvb2xzJwogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGNvbmZpZy5wcm9kdWN0aW9uVGlwICE9PSBmYWxzZSAmJgogICAgICAgIHR5cGVvZiBjb25zb2xlICE9PSAndW5kZWZpbmVkJwogICAgICApIHsKICAgICAgICBjb25zb2xlW2NvbnNvbGUuaW5mbyA/ICdpbmZvJyA6ICdsb2cnXSgKICAgICAgICAgICJZb3UgYXJlIHJ1bm5pbmcgVnVlIGluIGRldmVsb3BtZW50IG1vZGUuXG4iICsKICAgICAgICAgICJNYWtlIHN1cmUgdG8gdHVybiBvbiBwcm9kdWN0aW9uIG1vZGUgd2hlbiBkZXBsb3lpbmcgZm9yIHByb2R1Y3Rpb24uXG4iICsKICAgICAgICAgICJTZWUgbW9yZSB0aXBzIGF0IGh0dHBzOi8vdnVlanMub3JnL2d1aWRlL2RlcGxveW1lbnQuaHRtbCIKICAgICAgICApOwogICAgICB9CiAgICB9LCAwKTsKICB9CgogIC8qICAqLwoKICB2YXIgZGVmYXVsdFRhZ1JFID0gL1x7XHsoKD86Lnxccj9cbikrPylcfVx9L2c7CiAgdmFyIHJlZ2V4RXNjYXBlUkUgPSAvWy0uKis/XiR7fSgpfFtcXVwvXFxdL2c7CgogIHZhciBidWlsZFJlZ2V4ID0gY2FjaGVkKGZ1bmN0aW9uIChkZWxpbWl0ZXJzKSB7CiAgICB2YXIgb3BlbiA9IGRlbGltaXRlcnNbMF0ucmVwbGFjZShyZWdleEVzY2FwZVJFLCAnXFwkJicpOwogICAgdmFyIGNsb3NlID0gZGVsaW1pdGVyc1sxXS5yZXBsYWNlKHJlZ2V4RXNjYXBlUkUsICdcXCQmJyk7CiAgICByZXR1cm4gbmV3IFJlZ0V4cChvcGVuICsgJygoPzoufFxcbikrPyknICsgY2xvc2UsICdnJykKICB9KTsKCgoKICBmdW5jdGlvbiBwYXJzZVRleHQgKAogICAgdGV4dCwKICAgIGRlbGltaXRlcnMKICApIHsKICAgIHZhciB0YWdSRSA9IGRlbGltaXRlcnMgPyBidWlsZFJlZ2V4KGRlbGltaXRlcnMpIDogZGVmYXVsdFRhZ1JFOwogICAgaWYgKCF0YWdSRS50ZXN0KHRleHQpKSB7CiAgICAgIHJldHVybgogICAgfQogICAgdmFyIHRva2VucyA9IFtdOwogICAgdmFyIHJhd1Rva2VucyA9IFtdOwogICAgdmFyIGxhc3RJbmRleCA9IHRhZ1JFLmxhc3RJbmRleCA9IDA7CiAgICB2YXIgbWF0Y2gsIGluZGV4LCB0b2tlblZhbHVlOwogICAgd2hpbGUgKChtYXRjaCA9IHRhZ1JFLmV4ZWModGV4dCkpKSB7CiAgICAgIGluZGV4ID0gbWF0Y2guaW5kZXg7CiAgICAgIC8vIHB1c2ggdGV4dCB0b2tlbgogICAgICBpZiAoaW5kZXggPiBsYXN0SW5kZXgpIHsKICAgICAgICByYXdUb2tlbnMucHVzaCh0b2tlblZhbHVlID0gdGV4dC5zbGljZShsYXN0SW5kZXgsIGluZGV4KSk7CiAgICAgICAgdG9rZW5zLnB1c2goSlNPTi5zdHJpbmdpZnkodG9rZW5WYWx1ZSkpOwogICAgICB9CiAgICAgIC8vIHRhZyB0b2tlbgogICAgICB2YXIgZXhwID0gcGFyc2VGaWx0ZXJzKG1hdGNoWzFdLnRyaW0oKSk7CiAgICAgIHRva2Vucy5wdXNoKCgiX3MoIiArIGV4cCArICIpIikpOwogICAgICByYXdUb2tlbnMucHVzaCh7ICdAYmluZGluZyc6IGV4cCB9KTsKICAgICAgbGFzdEluZGV4ID0gaW5kZXggKyBtYXRjaFswXS5sZW5ndGg7CiAgICB9CiAgICBpZiAobGFzdEluZGV4IDwgdGV4dC5sZW5ndGgpIHsKICAgICAgcmF3VG9rZW5zLnB1c2godG9rZW5WYWx1ZSA9IHRleHQuc2xpY2UobGFzdEluZGV4KSk7CiAgICAgIHRva2Vucy5wdXNoKEpTT04uc3RyaW5naWZ5KHRva2VuVmFsdWUpKTsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIGV4cHJlc3Npb246IHRva2Vucy5qb2luKCcrJyksCiAgICAgIHRva2VuczogcmF3VG9rZW5zCiAgICB9CiAgfQoKICAvKiAgKi8KCiAgZnVuY3Rpb24gdHJhbnNmb3JtTm9kZSAoZWwsIG9wdGlvbnMpIHsKICAgIHZhciB3YXJuID0gb3B0aW9ucy53YXJuIHx8IGJhc2VXYXJuOwogICAgdmFyIHN0YXRpY0NsYXNzID0gZ2V0QW5kUmVtb3ZlQXR0cihlbCwgJ2NsYXNzJyk7CiAgICBpZiAoc3RhdGljQ2xhc3MpIHsKICAgICAgdmFyIHJlcyA9IHBhcnNlVGV4dChzdGF0aWNDbGFzcywgb3B0aW9ucy5kZWxpbWl0ZXJzKTsKICAgICAgaWYgKHJlcykgewogICAgICAgIHdhcm4oCiAgICAgICAgICAiY2xhc3M9XCIiICsgc3RhdGljQ2xhc3MgKyAiXCI6ICIgKwogICAgICAgICAgJ0ludGVycG9sYXRpb24gaW5zaWRlIGF0dHJpYnV0ZXMgaGFzIGJlZW4gcmVtb3ZlZC4gJyArCiAgICAgICAgICAnVXNlIHYtYmluZCBvciB0aGUgY29sb24gc2hvcnRoYW5kIGluc3RlYWQuIEZvciBleGFtcGxlLCAnICsKICAgICAgICAgICdpbnN0ZWFkIG9mIDxkaXYgY2xhc3M9Int7IHZhbCB9fSI+LCB1c2UgPGRpdiA6Y2xhc3M9InZhbCI+LicsCiAgICAgICAgICBlbC5yYXdBdHRyc01hcFsnY2xhc3MnXQogICAgICAgICk7CiAgICAgIH0KICAgIH0KICAgIGlmIChzdGF0aWNDbGFzcykgewogICAgICBlbC5zdGF0aWNDbGFzcyA9IEpTT04uc3RyaW5naWZ5KHN0YXRpY0NsYXNzKTsKICAgIH0KICAgIHZhciBjbGFzc0JpbmRpbmcgPSBnZXRCaW5kaW5nQXR0cihlbCwgJ2NsYXNzJywgZmFsc2UgLyogZ2V0U3RhdGljICovKTsKICAgIGlmIChjbGFzc0JpbmRpbmcpIHsKICAgICAgZWwuY2xhc3NCaW5kaW5nID0gY2xhc3NCaW5kaW5nOwogICAgfQogIH0KCiAgZnVuY3Rpb24gZ2VuRGF0YSAoZWwpIHsKICAgIHZhciBkYXRhID0gJyc7CiAgICBpZiAoZWwuc3RhdGljQ2xhc3MpIHsKICAgICAgZGF0YSArPSAic3RhdGljQ2xhc3M6IiArIChlbC5zdGF0aWNDbGFzcykgKyAiLCI7CiAgICB9CiAgICBpZiAoZWwuY2xhc3NCaW5kaW5nKSB7CiAgICAgIGRhdGEgKz0gImNsYXNzOiIgKyAoZWwuY2xhc3NCaW5kaW5nKSArICIsIjsKICAgIH0KICAgIHJldHVybiBkYXRhCiAgfQoKICB2YXIga2xhc3MkMSA9IHsKICAgIHN0YXRpY0tleXM6IFsnc3RhdGljQ2xhc3MnXSwKICAgIHRyYW5zZm9ybU5vZGU6IHRyYW5zZm9ybU5vZGUsCiAgICBnZW5EYXRhOiBnZW5EYXRhCiAgfTsKCiAgLyogICovCgogIGZ1bmN0aW9uIHRyYW5zZm9ybU5vZGUkMSAoZWwsIG9wdGlvbnMpIHsKICAgIHZhciB3YXJuID0gb3B0aW9ucy53YXJuIHx8IGJhc2VXYXJuOwogICAgdmFyIHN0YXRpY1N0eWxlID0gZ2V0QW5kUmVtb3ZlQXR0cihlbCwgJ3N0eWxlJyk7CiAgICBpZiAoc3RhdGljU3R5bGUpIHsKICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICAgIHsKICAgICAgICB2YXIgcmVzID0gcGFyc2VUZXh0KHN0YXRpY1N0eWxlLCBvcHRpb25zLmRlbGltaXRlcnMpOwogICAgICAgIGlmIChyZXMpIHsKICAgICAgICAgIHdhcm4oCiAgICAgICAgICAgICJzdHlsZT1cIiIgKyBzdGF0aWNTdHlsZSArICJcIjogIiArCiAgICAgICAgICAgICdJbnRlcnBvbGF0aW9uIGluc2lkZSBhdHRyaWJ1dGVzIGhhcyBiZWVuIHJlbW92ZWQuICcgKwogICAgICAgICAgICAnVXNlIHYtYmluZCBvciB0aGUgY29sb24gc2hvcnRoYW5kIGluc3RlYWQuIEZvciBleGFtcGxlLCAnICsKICAgICAgICAgICAgJ2luc3RlYWQgb2YgPGRpdiBzdHlsZT0ie3sgdmFsIH19Ij4sIHVzZSA8ZGl2IDpzdHlsZT0idmFsIj4uJywKICAgICAgICAgICAgZWwucmF3QXR0cnNNYXBbJ3N0eWxlJ10KICAgICAgICAgICk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGVsLnN0YXRpY1N0eWxlID0gSlNPTi5zdHJpbmdpZnkocGFyc2VTdHlsZVRleHQoc3RhdGljU3R5bGUpKTsKICAgIH0KCiAgICB2YXIgc3R5bGVCaW5kaW5nID0gZ2V0QmluZGluZ0F0dHIoZWwsICdzdHlsZScsIGZhbHNlIC8qIGdldFN0YXRpYyAqLyk7CiAgICBpZiAoc3R5bGVCaW5kaW5nKSB7CiAgICAgIGVsLnN0eWxlQmluZGluZyA9IHN0eWxlQmluZGluZzsKICAgIH0KICB9CgogIGZ1bmN0aW9uIGdlbkRhdGEkMSAoZWwpIHsKICAgIHZhciBkYXRhID0gJyc7CiAgICBpZiAoZWwuc3RhdGljU3R5bGUpIHsKICAgICAgZGF0YSArPSAic3RhdGljU3R5bGU6IiArIChlbC5zdGF0aWNTdHlsZSkgKyAiLCI7CiAgICB9CiAgICBpZiAoZWwuc3R5bGVCaW5kaW5nKSB7CiAgICAgIGRhdGEgKz0gInN0eWxlOigiICsgKGVsLnN0eWxlQmluZGluZykgKyAiKSwiOwogICAgfQogICAgcmV0dXJuIGRhdGEKICB9CgogIHZhciBzdHlsZSQxID0gewogICAgc3RhdGljS2V5czogWydzdGF0aWNTdHlsZSddLAogICAgdHJhbnNmb3JtTm9kZTogdHJhbnNmb3JtTm9kZSQxLAogICAgZ2VuRGF0YTogZ2VuRGF0YSQxCiAgfTsKCiAgLyogICovCgogIHZhciBkZWNvZGVyOwoKICB2YXIgaGUgPSB7CiAgICBkZWNvZGU6IGZ1bmN0aW9uIGRlY29kZSAoaHRtbCkgewogICAgICBkZWNvZGVyID0gZGVjb2RlciB8fCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgZGVjb2Rlci5pbm5lckhUTUwgPSBodG1sOwogICAgICByZXR1cm4gZGVjb2Rlci50ZXh0Q29udGVudAogICAgfQogIH07CgogIC8qICAqLwoKICB2YXIgaXNVbmFyeVRhZyA9IG1ha2VNYXAoCiAgICAnYXJlYSxiYXNlLGJyLGNvbCxlbWJlZCxmcmFtZSxocixpbWcsaW5wdXQsaXNpbmRleCxrZXlnZW4sJyArCiAgICAnbGluayxtZXRhLHBhcmFtLHNvdXJjZSx0cmFjayx3YnInCiAgKTsKCiAgLy8gRWxlbWVudHMgdGhhdCB5b3UgY2FuLCBpbnRlbnRpb25hbGx5LCBsZWF2ZSBvcGVuCiAgLy8gKGFuZCB3aGljaCBjbG9zZSB0aGVtc2VsdmVzKQogIHZhciBjYW5CZUxlZnRPcGVuVGFnID0gbWFrZU1hcCgKICAgICdjb2xncm91cCxkZCxkdCxsaSxvcHRpb25zLHAsdGQsdGZvb3QsdGgsdGhlYWQsdHIsc291cmNlJwogICk7CgogIC8vIEhUTUw1IHRhZ3MgaHR0cHM6Ly9odG1sLnNwZWMud2hhdHdnLm9yZy9tdWx0aXBhZ2UvaW5kaWNlcy5odG1sI2VsZW1lbnRzLTMKICAvLyBQaHJhc2luZyBDb250ZW50IGh0dHBzOi8vaHRtbC5zcGVjLndoYXR3Zy5vcmcvbXVsdGlwYWdlL2RvbS5odG1sI3BocmFzaW5nLWNvbnRlbnQKICB2YXIgaXNOb25QaHJhc2luZ1RhZyA9IG1ha2VNYXAoCiAgICAnYWRkcmVzcyxhcnRpY2xlLGFzaWRlLGJhc2UsYmxvY2txdW90ZSxib2R5LGNhcHRpb24sY29sLGNvbGdyb3VwLGRkLCcgKwogICAgJ2RldGFpbHMsZGlhbG9nLGRpdixkbCxkdCxmaWVsZHNldCxmaWdjYXB0aW9uLGZpZ3VyZSxmb290ZXIsZm9ybSwnICsKICAgICdoMSxoMixoMyxoNCxoNSxoNixoZWFkLGhlYWRlcixoZ3JvdXAsaHIsaHRtbCxsZWdlbmQsbGksbWVudWl0ZW0sbWV0YSwnICsKICAgICdvcHRncm91cCxvcHRpb24scGFyYW0scnAscnQsc291cmNlLHN0eWxlLHN1bW1hcnksdGJvZHksdGQsdGZvb3QsdGgsdGhlYWQsJyArCiAgICAndGl0bGUsdHIsdHJhY2snCiAgKTsKCiAgLyoqCiAgICogTm90IHR5cGUtY2hlY2tpbmcgdGhpcyBmaWxlIGJlY2F1c2UgaXQncyBtb3N0bHkgdmVuZG9yIGNvZGUuCiAgICovCgogIC8vIFJlZ3VsYXIgRXhwcmVzc2lvbnMgZm9yIHBhcnNpbmcgdGFncyBhbmQgYXR0cmlidXRlcwogIHZhciBhdHRyaWJ1dGUgPSAvXlxzKihbXlxzIic8PlwvPV0rKSg/OlxzKig9KVxzKig/OiIoW14iXSopIit8JyhbXiddKiknK3woW15ccyInPTw+YF0rKSkpPy87CiAgdmFyIGR5bmFtaWNBcmdBdHRyaWJ1dGUgPSAvXlxzKigoPzp2LVtcdy1dKzp8QHw6fCMpXFtbXj1dK1xdW15ccyInPD5cLz1dKikoPzpccyooPSlccyooPzoiKFteIl0qKSIrfCcoW14nXSopJyt8KFteXHMiJz08PmBdKykpKT8vOwogIHZhciBuY25hbWUgPSAiW2EtekEtWl9dW1xcLVxcLjAtOV9hLXpBLVoiICsgKHVuaWNvZGVSZWdFeHAuc291cmNlKSArICJdKiI7CiAgdmFyIHFuYW1lQ2FwdHVyZSA9ICIoKD86IiArIG5jbmFtZSArICJcXDopPyIgKyBuY25hbWUgKyAiKSI7CiAgdmFyIHN0YXJ0VGFnT3BlbiA9IG5ldyBSZWdFeHAoKCJePCIgKyBxbmFtZUNhcHR1cmUpKTsKICB2YXIgc3RhcnRUYWdDbG9zZSA9IC9eXHMqKFwvPyk+LzsKICB2YXIgZW5kVGFnID0gbmV3IFJlZ0V4cCgoIl48XFwvIiArIHFuYW1lQ2FwdHVyZSArICJbXj5dKj4iKSk7CiAgdmFyIGRvY3R5cGUgPSAvXjwhRE9DVFlQRSBbXj5dKz4vaTsKICAvLyAjNzI5ODogZXNjYXBlIC0gdG8gYXZvaWQgYmVpbmcgcGFzZWQgYXMgSFRNTCBjb21tZW50IHdoZW4gaW5saW5lZCBpbiBwYWdlCiAgdmFyIGNvbW1lbnQgPSAvXjwhXC0tLzsKICB2YXIgY29uZGl0aW9uYWxDb21tZW50ID0gL148IVxbLzsKCiAgLy8gU3BlY2lhbCBFbGVtZW50cyAoY2FuIGNvbnRhaW4gYW55dGhpbmcpCiAgdmFyIGlzUGxhaW5UZXh0RWxlbWVudCA9IG1ha2VNYXAoJ3NjcmlwdCxzdHlsZSx0ZXh0YXJlYScsIHRydWUpOwogIHZhciByZUNhY2hlID0ge307CgogIHZhciBkZWNvZGluZ01hcCA9IHsKICAgICcmbHQ7JzogJzwnLAogICAgJyZndDsnOiAnPicsCiAgICAnJnF1b3Q7JzogJyInLAogICAgJyZhbXA7JzogJyYnLAogICAgJyYjMTA7JzogJ1xuJywKICAgICcmIzk7JzogJ1x0JywKICAgICcmIzM5Oyc6ICInIgogIH07CiAgdmFyIGVuY29kZWRBdHRyID0gLyYoPzpsdHxndHxxdW90fGFtcHwjMzkpOy9nOwogIHZhciBlbmNvZGVkQXR0cldpdGhOZXdMaW5lcyA9IC8mKD86bHR8Z3R8cXVvdHxhbXB8IzM5fCMxMHwjOSk7L2c7CgogIC8vICM1OTkyCiAgdmFyIGlzSWdub3JlTmV3bGluZVRhZyA9IG1ha2VNYXAoJ3ByZSx0ZXh0YXJlYScsIHRydWUpOwogIHZhciBzaG91bGRJZ25vcmVGaXJzdE5ld2xpbmUgPSBmdW5jdGlvbiAodGFnLCBodG1sKSB7IHJldHVybiB0YWcgJiYgaXNJZ25vcmVOZXdsaW5lVGFnKHRhZykgJiYgaHRtbFswXSA9PT0gJ1xuJzsgfTsKCiAgZnVuY3Rpb24gZGVjb2RlQXR0ciAodmFsdWUsIHNob3VsZERlY29kZU5ld2xpbmVzKSB7CiAgICB2YXIgcmUgPSBzaG91bGREZWNvZGVOZXdsaW5lcyA/IGVuY29kZWRBdHRyV2l0aE5ld0xpbmVzIDogZW5jb2RlZEF0dHI7CiAgICByZXR1cm4gdmFsdWUucmVwbGFjZShyZSwgZnVuY3Rpb24gKG1hdGNoKSB7IHJldHVybiBkZWNvZGluZ01hcFttYXRjaF07IH0pCiAgfQoKICBmdW5jdGlvbiBwYXJzZUhUTUwgKGh0bWwsIG9wdGlvbnMpIHsKICAgIHZhciBzdGFjayA9IFtdOwogICAgdmFyIGV4cGVjdEhUTUwgPSBvcHRpb25zLmV4cGVjdEhUTUw7CiAgICB2YXIgaXNVbmFyeVRhZyQkMSA9IG9wdGlvbnMuaXNVbmFyeVRhZyB8fCBubzsKICAgIHZhciBjYW5CZUxlZnRPcGVuVGFnJCQxID0gb3B0aW9ucy5jYW5CZUxlZnRPcGVuVGFnIHx8IG5vOwogICAgdmFyIGluZGV4ID0gMDsKICAgIHZhciBsYXN0LCBsYXN0VGFnOwogICAgd2hpbGUgKGh0bWwpIHsKICAgICAgbGFzdCA9IGh0bWw7CiAgICAgIC8vIE1ha2Ugc3VyZSB3ZSdyZSBub3QgaW4gYSBwbGFpbnRleHQgY29udGVudCBlbGVtZW50IGxpa2Ugc2NyaXB0L3N0eWxlCiAgICAgIGlmICghbGFzdFRhZyB8fCAhaXNQbGFpblRleHRFbGVtZW50KGxhc3RUYWcpKSB7CiAgICAgICAgdmFyIHRleHRFbmQgPSBodG1sLmluZGV4T2YoJzwnKTsKICAgICAgICBpZiAodGV4dEVuZCA9PT0gMCkgewogICAgICAgICAgLy8gQ29tbWVudDoKICAgICAgICAgIGlmIChjb21tZW50LnRlc3QoaHRtbCkpIHsKICAgICAgICAgICAgdmFyIGNvbW1lbnRFbmQgPSBodG1sLmluZGV4T2YoJy0tPicpOwoKICAgICAgICAgICAgaWYgKGNvbW1lbnRFbmQgPj0gMCkgewogICAgICAgICAgICAgIGlmIChvcHRpb25zLnNob3VsZEtlZXBDb21tZW50KSB7CiAgICAgICAgICAgICAgICBvcHRpb25zLmNvbW1lbnQoaHRtbC5zdWJzdHJpbmcoNCwgY29tbWVudEVuZCksIGluZGV4LCBpbmRleCArIGNvbW1lbnRFbmQgKyAzKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYWR2YW5jZShjb21tZW50RW5kICsgMyk7CiAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIC8vIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQ29uZGl0aW9uYWxfY29tbWVudCNEb3dubGV2ZWwtcmV2ZWFsZWRfY29uZGl0aW9uYWxfY29tbWVudAogICAgICAgICAgaWYgKGNvbmRpdGlvbmFsQ29tbWVudC50ZXN0KGh0bWwpKSB7CiAgICAgICAgICAgIHZhciBjb25kaXRpb25hbEVuZCA9IGh0bWwuaW5kZXhPZignXT4nKTsKCiAgICAgICAgICAgIGlmIChjb25kaXRpb25hbEVuZCA+PSAwKSB7CiAgICAgICAgICAgICAgYWR2YW5jZShjb25kaXRpb25hbEVuZCArIDIpOwogICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICAvLyBEb2N0eXBlOgogICAgICAgICAgdmFyIGRvY3R5cGVNYXRjaCA9IGh0bWwubWF0Y2goZG9jdHlwZSk7CiAgICAgICAgICBpZiAoZG9jdHlwZU1hdGNoKSB7CiAgICAgICAgICAgIGFkdmFuY2UoZG9jdHlwZU1hdGNoWzBdLmxlbmd0aCk7CiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICB9CgogICAgICAgICAgLy8gRW5kIHRhZzoKICAgICAgICAgIHZhciBlbmRUYWdNYXRjaCA9IGh0bWwubWF0Y2goZW5kVGFnKTsKICAgICAgICAgIGlmIChlbmRUYWdNYXRjaCkgewogICAgICAgICAgICB2YXIgY3VySW5kZXggPSBpbmRleDsKICAgICAgICAgICAgYWR2YW5jZShlbmRUYWdNYXRjaFswXS5sZW5ndGgpOwogICAgICAgICAgICBwYXJzZUVuZFRhZyhlbmRUYWdNYXRjaFsxXSwgY3VySW5kZXgsIGluZGV4KTsKICAgICAgICAgICAgY29udGludWUKICAgICAgICAgIH0KCiAgICAgICAgICAvLyBTdGFydCB0YWc6CiAgICAgICAgICB2YXIgc3RhcnRUYWdNYXRjaCA9IHBhcnNlU3RhcnRUYWcoKTsKICAgICAgICAgIGlmIChzdGFydFRhZ01hdGNoKSB7CiAgICAgICAgICAgIGhhbmRsZVN0YXJ0VGFnKHN0YXJ0VGFnTWF0Y2gpOwogICAgICAgICAgICBpZiAoc2hvdWxkSWdub3JlRmlyc3ROZXdsaW5lKHN0YXJ0VGFnTWF0Y2gudGFnTmFtZSwgaHRtbCkpIHsKICAgICAgICAgICAgICBhZHZhbmNlKDEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgdGV4dCA9ICh2b2lkIDApLCByZXN0ID0gKHZvaWQgMCksIG5leHQgPSAodm9pZCAwKTsKICAgICAgICBpZiAodGV4dEVuZCA+PSAwKSB7CiAgICAgICAgICByZXN0ID0gaHRtbC5zbGljZSh0ZXh0RW5kKTsKICAgICAgICAgIHdoaWxlICgKICAgICAgICAgICAgIWVuZFRhZy50ZXN0KHJlc3QpICYmCiAgICAgICAgICAgICFzdGFydFRhZ09wZW4udGVzdChyZXN0KSAmJgogICAgICAgICAgICAhY29tbWVudC50ZXN0KHJlc3QpICYmCiAgICAgICAgICAgICFjb25kaXRpb25hbENvbW1lbnQudGVzdChyZXN0KQogICAgICAgICAgKSB7CiAgICAgICAgICAgIC8vIDwgaW4gcGxhaW4gdGV4dCwgYmUgZm9yZ2l2aW5nIGFuZCB0cmVhdCBpdCBhcyB0ZXh0CiAgICAgICAgICAgIG5leHQgPSByZXN0LmluZGV4T2YoJzwnLCAxKTsKICAgICAgICAgICAgaWYgKG5leHQgPCAwKSB7IGJyZWFrIH0KICAgICAgICAgICAgdGV4dEVuZCArPSBuZXh0OwogICAgICAgICAgICByZXN0ID0gaHRtbC5zbGljZSh0ZXh0RW5kKTsKICAgICAgICAgIH0KICAgICAgICAgIHRleHQgPSBodG1sLnN1YnN0cmluZygwLCB0ZXh0RW5kKTsKICAgICAgICB9CgogICAgICAgIGlmICh0ZXh0RW5kIDwgMCkgewogICAgICAgICAgdGV4dCA9IGh0bWw7CiAgICAgICAgfQoKICAgICAgICBpZiAodGV4dCkgewogICAgICAgICAgYWR2YW5jZSh0ZXh0Lmxlbmd0aCk7CiAgICAgICAgfQoKICAgICAgICBpZiAob3B0aW9ucy5jaGFycyAmJiB0ZXh0KSB7CiAgICAgICAgICBvcHRpb25zLmNoYXJzKHRleHQsIGluZGV4IC0gdGV4dC5sZW5ndGgsIGluZGV4KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIGVuZFRhZ0xlbmd0aCA9IDA7CiAgICAgICAgdmFyIHN0YWNrZWRUYWcgPSBsYXN0VGFnLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgdmFyIHJlU3RhY2tlZFRhZyA9IHJlQ2FjaGVbc3RhY2tlZFRhZ10gfHwgKHJlQ2FjaGVbc3RhY2tlZFRhZ10gPSBuZXcgUmVnRXhwKCcoW1xcc1xcU10qPykoPC8nICsgc3RhY2tlZFRhZyArICdbXj5dKj4pJywgJ2knKSk7CiAgICAgICAgdmFyIHJlc3QkMSA9IGh0bWwucmVwbGFjZShyZVN0YWNrZWRUYWcsIGZ1bmN0aW9uIChhbGwsIHRleHQsIGVuZFRhZykgewogICAgICAgICAgZW5kVGFnTGVuZ3RoID0gZW5kVGFnLmxlbmd0aDsKICAgICAgICAgIGlmICghaXNQbGFpblRleHRFbGVtZW50KHN0YWNrZWRUYWcpICYmIHN0YWNrZWRUYWcgIT09ICdub3NjcmlwdCcpIHsKICAgICAgICAgICAgdGV4dCA9IHRleHQKICAgICAgICAgICAgICAucmVwbGFjZSgvPCFcLS0oW1xzXFNdKj8pLS0+L2csICckMScpIC8vICM3Mjk4CiAgICAgICAgICAgICAgLnJlcGxhY2UoLzwhXFtDREFUQVxbKFtcc1xTXSo/KV1dPi9nLCAnJDEnKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChzaG91bGRJZ25vcmVGaXJzdE5ld2xpbmUoc3RhY2tlZFRhZywgdGV4dCkpIHsKICAgICAgICAgICAgdGV4dCA9IHRleHQuc2xpY2UoMSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAob3B0aW9ucy5jaGFycykgewogICAgICAgICAgICBvcHRpb25zLmNoYXJzKHRleHQpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuICcnCiAgICAgICAgfSk7CiAgICAgICAgaW5kZXggKz0gaHRtbC5sZW5ndGggLSByZXN0JDEubGVuZ3RoOwogICAgICAgIGh0bWwgPSByZXN0JDE7CiAgICAgICAgcGFyc2VFbmRUYWcoc3RhY2tlZFRhZywgaW5kZXggLSBlbmRUYWdMZW5ndGgsIGluZGV4KTsKICAgICAgfQoKICAgICAgaWYgKGh0bWwgPT09IGxhc3QpIHsKICAgICAgICBvcHRpb25zLmNoYXJzICYmIG9wdGlvbnMuY2hhcnMoaHRtbCk7CiAgICAgICAgaWYgKCFzdGFjay5sZW5ndGggJiYgb3B0aW9ucy53YXJuKSB7CiAgICAgICAgICBvcHRpb25zLndhcm4oKCJNYWwtZm9ybWF0dGVkIHRhZyBhdCBlbmQgb2YgdGVtcGxhdGU6IFwiIiArIGh0bWwgKyAiXCIiKSwgeyBzdGFydDogaW5kZXggKyBodG1sLmxlbmd0aCB9KTsKICAgICAgICB9CiAgICAgICAgYnJlYWsKICAgICAgfQogICAgfQoKICAgIC8vIENsZWFuIHVwIGFueSByZW1haW5pbmcgdGFncwogICAgcGFyc2VFbmRUYWcoKTsKCiAgICBmdW5jdGlvbiBhZHZhbmNlIChuKSB7CiAgICAgIGluZGV4ICs9IG47CiAgICAgIGh0bWwgPSBodG1sLnN1YnN0cmluZyhuKTsKICAgIH0KCiAgICBmdW5jdGlvbiBwYXJzZVN0YXJ0VGFnICgpIHsKICAgICAgdmFyIHN0YXJ0ID0gaHRtbC5tYXRjaChzdGFydFRhZ09wZW4pOwogICAgICBpZiAoc3RhcnQpIHsKICAgICAgICB2YXIgbWF0Y2ggPSB7CiAgICAgICAgICB0YWdOYW1lOiBzdGFydFsxXSwKICAgICAgICAgIGF0dHJzOiBbXSwKICAgICAgICAgIHN0YXJ0OiBpbmRleAogICAgICAgIH07CiAgICAgICAgYWR2YW5jZShzdGFydFswXS5sZW5ndGgpOwogICAgICAgIHZhciBlbmQsIGF0dHI7CiAgICAgICAgd2hpbGUgKCEoZW5kID0gaHRtbC5tYXRjaChzdGFydFRhZ0Nsb3NlKSkgJiYgKGF0dHIgPSBodG1sLm1hdGNoKGR5bmFtaWNBcmdBdHRyaWJ1dGUpIHx8IGh0bWwubWF0Y2goYXR0cmlidXRlKSkpIHsKICAgICAgICAgIGF0dHIuc3RhcnQgPSBpbmRleDsKICAgICAgICAgIGFkdmFuY2UoYXR0clswXS5sZW5ndGgpOwogICAgICAgICAgYXR0ci5lbmQgPSBpbmRleDsKICAgICAgICAgIG1hdGNoLmF0dHJzLnB1c2goYXR0cik7CiAgICAgICAgfQogICAgICAgIGlmIChlbmQpIHsKICAgICAgICAgIG1hdGNoLnVuYXJ5U2xhc2ggPSBlbmRbMV07CiAgICAgICAgICBhZHZhbmNlKGVuZFswXS5sZW5ndGgpOwogICAgICAgICAgbWF0Y2guZW5kID0gaW5kZXg7CiAgICAgICAgICByZXR1cm4gbWF0Y2gKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBoYW5kbGVTdGFydFRhZyAobWF0Y2gpIHsKICAgICAgdmFyIHRhZ05hbWUgPSBtYXRjaC50YWdOYW1lOwogICAgICB2YXIgdW5hcnlTbGFzaCA9IG1hdGNoLnVuYXJ5U2xhc2g7CgogICAgICBpZiAoZXhwZWN0SFRNTCkgewogICAgICAgIGlmIChsYXN0VGFnID09PSAncCcgJiYgaXNOb25QaHJhc2luZ1RhZyh0YWdOYW1lKSkgewogICAgICAgICAgcGFyc2VFbmRUYWcobGFzdFRhZyk7CiAgICAgICAgfQogICAgICAgIGlmIChjYW5CZUxlZnRPcGVuVGFnJCQxKHRhZ05hbWUpICYmIGxhc3RUYWcgPT09IHRhZ05hbWUpIHsKICAgICAgICAgIHBhcnNlRW5kVGFnKHRhZ05hbWUpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdmFyIHVuYXJ5ID0gaXNVbmFyeVRhZyQkMSh0YWdOYW1lKSB8fCAhIXVuYXJ5U2xhc2g7CgogICAgICB2YXIgbCA9IG1hdGNoLmF0dHJzLmxlbmd0aDsKICAgICAgdmFyIGF0dHJzID0gbmV3IEFycmF5KGwpOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGw7IGkrKykgewogICAgICAgIHZhciBhcmdzID0gbWF0Y2guYXR0cnNbaV07CiAgICAgICAgdmFyIHZhbHVlID0gYXJnc1szXSB8fCBhcmdzWzRdIHx8IGFyZ3NbNV0gfHwgJyc7CiAgICAgICAgdmFyIHNob3VsZERlY29kZU5ld2xpbmVzID0gdGFnTmFtZSA9PT0gJ2EnICYmIGFyZ3NbMV0gPT09ICdocmVmJwogICAgICAgICAgPyBvcHRpb25zLnNob3VsZERlY29kZU5ld2xpbmVzRm9ySHJlZgogICAgICAgICAgOiBvcHRpb25zLnNob3VsZERlY29kZU5ld2xpbmVzOwogICAgICAgIGF0dHJzW2ldID0gewogICAgICAgICAgbmFtZTogYXJnc1sxXSwKICAgICAgICAgIHZhbHVlOiBkZWNvZGVBdHRyKHZhbHVlLCBzaG91bGREZWNvZGVOZXdsaW5lcykKICAgICAgICB9OwogICAgICAgIGlmIChvcHRpb25zLm91dHB1dFNvdXJjZVJhbmdlKSB7CiAgICAgICAgICBhdHRyc1tpXS5zdGFydCA9IGFyZ3Muc3RhcnQgKyBhcmdzWzBdLm1hdGNoKC9eXHMqLykubGVuZ3RoOwogICAgICAgICAgYXR0cnNbaV0uZW5kID0gYXJncy5lbmQ7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoIXVuYXJ5KSB7CiAgICAgICAgc3RhY2sucHVzaCh7IHRhZzogdGFnTmFtZSwgbG93ZXJDYXNlZFRhZzogdGFnTmFtZS50b0xvd2VyQ2FzZSgpLCBhdHRyczogYXR0cnMsIHN0YXJ0OiBtYXRjaC5zdGFydCwgZW5kOiBtYXRjaC5lbmQgfSk7CiAgICAgICAgbGFzdFRhZyA9IHRhZ05hbWU7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnN0YXJ0KSB7CiAgICAgICAgb3B0aW9ucy5zdGFydCh0YWdOYW1lLCBhdHRycywgdW5hcnksIG1hdGNoLnN0YXJ0LCBtYXRjaC5lbmQpOwogICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gcGFyc2VFbmRUYWcgKHRhZ05hbWUsIHN0YXJ0LCBlbmQpIHsKICAgICAgdmFyIHBvcywgbG93ZXJDYXNlZFRhZ05hbWU7CiAgICAgIGlmIChzdGFydCA9PSBudWxsKSB7IHN0YXJ0ID0gaW5kZXg7IH0KICAgICAgaWYgKGVuZCA9PSBudWxsKSB7IGVuZCA9IGluZGV4OyB9CgogICAgICAvLyBGaW5kIHRoZSBjbG9zZXN0IG9wZW5lZCB0YWcgb2YgdGhlIHNhbWUgdHlwZQogICAgICBpZiAodGFnTmFtZSkgewogICAgICAgIGxvd2VyQ2FzZWRUYWdOYW1lID0gdGFnTmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgIGZvciAocG9zID0gc3RhY2subGVuZ3RoIC0gMTsgcG9zID49IDA7IHBvcy0tKSB7CiAgICAgICAgICBpZiAoc3RhY2tbcG9zXS5sb3dlckNhc2VkVGFnID09PSBsb3dlckNhc2VkVGFnTmFtZSkgewogICAgICAgICAgICBicmVhawogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBJZiBubyB0YWcgbmFtZSBpcyBwcm92aWRlZCwgY2xlYW4gc2hvcAogICAgICAgIHBvcyA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChwb3MgPj0gMCkgewogICAgICAgIC8vIENsb3NlIGFsbCB0aGUgb3BlbiBlbGVtZW50cywgdXAgdGhlIHN0YWNrCiAgICAgICAgZm9yICh2YXIgaSA9IHN0YWNrLmxlbmd0aCAtIDE7IGkgPj0gcG9zOyBpLS0pIHsKICAgICAgICAgIGlmIChpID4gcG9zIHx8ICF0YWdOYW1lICYmCiAgICAgICAgICAgIG9wdGlvbnMud2FybgogICAgICAgICAgKSB7CiAgICAgICAgICAgIG9wdGlvbnMud2FybigKICAgICAgICAgICAgICAoInRhZyA8IiArIChzdGFja1tpXS50YWcpICsgIj4gaGFzIG5vIG1hdGNoaW5nIGVuZCB0YWcuIiksCiAgICAgICAgICAgICAgeyBzdGFydDogc3RhY2tbaV0uc3RhcnQsIGVuZDogc3RhY2tbaV0uZW5kIH0KICAgICAgICAgICAgKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChvcHRpb25zLmVuZCkgewogICAgICAgICAgICBvcHRpb25zLmVuZChzdGFja1tpXS50YWcsIHN0YXJ0LCBlbmQpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gUmVtb3ZlIHRoZSBvcGVuIGVsZW1lbnRzIGZyb20gdGhlIHN0YWNrCiAgICAgICAgc3RhY2subGVuZ3RoID0gcG9zOwogICAgICAgIGxhc3RUYWcgPSBwb3MgJiYgc3RhY2tbcG9zIC0gMV0udGFnOwogICAgICB9IGVsc2UgaWYgKGxvd2VyQ2FzZWRUYWdOYW1lID09PSAnYnInKSB7CiAgICAgICAgaWYgKG9wdGlvbnMuc3RhcnQpIHsKICAgICAgICAgIG9wdGlvbnMuc3RhcnQodGFnTmFtZSwgW10sIHRydWUsIHN0YXJ0LCBlbmQpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChsb3dlckNhc2VkVGFnTmFtZSA9PT0gJ3AnKSB7CiAgICAgICAgaWYgKG9wdGlvbnMuc3RhcnQpIHsKICAgICAgICAgIG9wdGlvbnMuc3RhcnQodGFnTmFtZSwgW10sIGZhbHNlLCBzdGFydCwgZW5kKTsKICAgICAgICB9CiAgICAgICAgaWYgKG9wdGlvbnMuZW5kKSB7CiAgICAgICAgICBvcHRpb25zLmVuZCh0YWdOYW1lLCBzdGFydCwgZW5kKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIC8qICAqLwoKICB2YXIgb25SRSA9IC9eQHxedi1vbjovOwogIHZhciBkaXJSRSA9IC9edi18XkB8XjovOwogIHZhciBmb3JBbGlhc1JFID0gLyhbXHNcU10qPylccysoPzppbnxvZilccysoW1xzXFNdKikvOwogIHZhciBmb3JJdGVyYXRvclJFID0gLywoW14sXH1cXV0qKSg/OiwoW14sXH1cXV0qKSk/JC87CiAgdmFyIHN0cmlwUGFyZW5zUkUgPSAvXlwofFwpJC9nOwogIHZhciBkeW5hbWljQXJnUkUgPSAvXlxbLipcXSQvOwoKICB2YXIgYXJnUkUgPSAvOiguKikkLzsKICB2YXIgYmluZFJFID0gL146fF5cLnxedi1iaW5kOi87CiAgdmFyIG1vZGlmaWVyUkUgPSAvXC5bXi5cXV0rKD89W15cXV0qJCkvZzsKCiAgdmFyIHNsb3RSRSA9IC9edi1zbG90KDp8JCl8XiMvOwoKICB2YXIgbGluZUJyZWFrUkUgPSAvW1xyXG5dLzsKICB2YXIgd2hpdGVzcGFjZVJFJDEgPSAvXHMrL2c7CgogIHZhciBpbnZhbGlkQXR0cmlidXRlUkUgPSAvW1xzIic8PlwvPV0vOwoKICB2YXIgZGVjb2RlSFRNTENhY2hlZCA9IGNhY2hlZChoZS5kZWNvZGUpOwoKICB2YXIgZW1wdHlTbG90U2NvcGVUb2tlbiA9ICJfZW1wdHlfIjsKCiAgLy8gY29uZmlndXJhYmxlIHN0YXRlCiAgdmFyIHdhcm4kMjsKICB2YXIgZGVsaW1pdGVyczsKICB2YXIgdHJhbnNmb3JtczsKICB2YXIgcHJlVHJhbnNmb3JtczsKICB2YXIgcG9zdFRyYW5zZm9ybXM7CiAgdmFyIHBsYXRmb3JtSXNQcmVUYWc7CiAgdmFyIHBsYXRmb3JtTXVzdFVzZVByb3A7CiAgdmFyIHBsYXRmb3JtR2V0VGFnTmFtZXNwYWNlOwogIHZhciBtYXliZUNvbXBvbmVudDsKCiAgZnVuY3Rpb24gY3JlYXRlQVNURWxlbWVudCAoCiAgICB0YWcsCiAgICBhdHRycywKICAgIHBhcmVudAogICkgewogICAgcmV0dXJuIHsKICAgICAgdHlwZTogMSwKICAgICAgdGFnOiB0YWcsCiAgICAgIGF0dHJzTGlzdDogYXR0cnMsCiAgICAgIGF0dHJzTWFwOiBtYWtlQXR0cnNNYXAoYXR0cnMpLAogICAgICByYXdBdHRyc01hcDoge30sCiAgICAgIHBhcmVudDogcGFyZW50LAogICAgICBjaGlsZHJlbjogW10KICAgIH0KICB9CgogIC8qKgogICAqIENvbnZlcnQgSFRNTCBzdHJpbmcgdG8gQVNULgogICAqLwogIGZ1bmN0aW9uIHBhcnNlICgKICAgIHRlbXBsYXRlLAogICAgb3B0aW9ucwogICkgewogICAgd2FybiQyID0gb3B0aW9ucy53YXJuIHx8IGJhc2VXYXJuOwoKICAgIHBsYXRmb3JtSXNQcmVUYWcgPSBvcHRpb25zLmlzUHJlVGFnIHx8IG5vOwogICAgcGxhdGZvcm1NdXN0VXNlUHJvcCA9IG9wdGlvbnMubXVzdFVzZVByb3AgfHwgbm87CiAgICBwbGF0Zm9ybUdldFRhZ05hbWVzcGFjZSA9IG9wdGlvbnMuZ2V0VGFnTmFtZXNwYWNlIHx8IG5vOwogICAgdmFyIGlzUmVzZXJ2ZWRUYWcgPSBvcHRpb25zLmlzUmVzZXJ2ZWRUYWcgfHwgbm87CiAgICBtYXliZUNvbXBvbmVudCA9IGZ1bmN0aW9uIChlbCkgeyByZXR1cm4gISFlbC5jb21wb25lbnQgfHwgIWlzUmVzZXJ2ZWRUYWcoZWwudGFnKTsgfTsKCiAgICB0cmFuc2Zvcm1zID0gcGx1Y2tNb2R1bGVGdW5jdGlvbihvcHRpb25zLm1vZHVsZXMsICd0cmFuc2Zvcm1Ob2RlJyk7CiAgICBwcmVUcmFuc2Zvcm1zID0gcGx1Y2tNb2R1bGVGdW5jdGlvbihvcHRpb25zLm1vZHVsZXMsICdwcmVUcmFuc2Zvcm1Ob2RlJyk7CiAgICBwb3N0VHJhbnNmb3JtcyA9IHBsdWNrTW9kdWxlRnVuY3Rpb24ob3B0aW9ucy5tb2R1bGVzLCAncG9zdFRyYW5zZm9ybU5vZGUnKTsKCiAgICBkZWxpbWl0ZXJzID0gb3B0aW9ucy5kZWxpbWl0ZXJzOwoKICAgIHZhciBzdGFjayA9IFtdOwogICAgdmFyIHByZXNlcnZlV2hpdGVzcGFjZSA9IG9wdGlvbnMucHJlc2VydmVXaGl0ZXNwYWNlICE9PSBmYWxzZTsKICAgIHZhciB3aGl0ZXNwYWNlT3B0aW9uID0gb3B0aW9ucy53aGl0ZXNwYWNlOwogICAgdmFyIHJvb3Q7CiAgICB2YXIgY3VycmVudFBhcmVudDsKICAgIHZhciBpblZQcmUgPSBmYWxzZTsKICAgIHZhciBpblByZSA9IGZhbHNlOwogICAgdmFyIHdhcm5lZCA9IGZhbHNlOwoKICAgIGZ1bmN0aW9uIHdhcm5PbmNlIChtc2csIHJhbmdlKSB7CiAgICAgIGlmICghd2FybmVkKSB7CiAgICAgICAgd2FybmVkID0gdHJ1ZTsKICAgICAgICB3YXJuJDIobXNnLCByYW5nZSk7CiAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBjbG9zZUVsZW1lbnQgKGVsZW1lbnQpIHsKICAgICAgdHJpbUVuZGluZ1doaXRlc3BhY2UoZWxlbWVudCk7CiAgICAgIGlmICghaW5WUHJlICYmICFlbGVtZW50LnByb2Nlc3NlZCkgewogICAgICAgIGVsZW1lbnQgPSBwcm9jZXNzRWxlbWVudChlbGVtZW50LCBvcHRpb25zKTsKICAgICAgfQogICAgICAvLyB0cmVlIG1hbmFnZW1lbnQKICAgICAgaWYgKCFzdGFjay5sZW5ndGggJiYgZWxlbWVudCAhPT0gcm9vdCkgewogICAgICAgIC8vIGFsbG93IHJvb3QgZWxlbWVudHMgd2l0aCB2LWlmLCB2LWVsc2UtaWYgYW5kIHYtZWxzZQogICAgICAgIGlmIChyb290LmlmICYmIChlbGVtZW50LmVsc2VpZiB8fCBlbGVtZW50LmVsc2UpKSB7CiAgICAgICAgICB7CiAgICAgICAgICAgIGNoZWNrUm9vdENvbnN0cmFpbnRzKGVsZW1lbnQpOwogICAgICAgICAgfQogICAgICAgICAgYWRkSWZDb25kaXRpb24ocm9vdCwgewogICAgICAgICAgICBleHA6IGVsZW1lbnQuZWxzZWlmLAogICAgICAgICAgICBibG9jazogZWxlbWVudAogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHdhcm5PbmNlKAogICAgICAgICAgICAiQ29tcG9uZW50IHRlbXBsYXRlIHNob3VsZCBjb250YWluIGV4YWN0bHkgb25lIHJvb3QgZWxlbWVudC4gIiArCiAgICAgICAgICAgICJJZiB5b3UgYXJlIHVzaW5nIHYtaWYgb24gbXVsdGlwbGUgZWxlbWVudHMsICIgKwogICAgICAgICAgICAidXNlIHYtZWxzZS1pZiB0byBjaGFpbiB0aGVtIGluc3RlYWQuIiwKICAgICAgICAgICAgeyBzdGFydDogZWxlbWVudC5zdGFydCB9CiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoY3VycmVudFBhcmVudCAmJiAhZWxlbWVudC5mb3JiaWRkZW4pIHsKICAgICAgICBpZiAoZWxlbWVudC5lbHNlaWYgfHwgZWxlbWVudC5lbHNlKSB7CiAgICAgICAgICBwcm9jZXNzSWZDb25kaXRpb25zKGVsZW1lbnQsIGN1cnJlbnRQYXJlbnQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoZWxlbWVudC5zbG90U2NvcGUpIHsKICAgICAgICAgICAgLy8gc2NvcGVkIHNsb3QKICAgICAgICAgICAgLy8ga2VlcCBpdCBpbiB0aGUgY2hpbGRyZW4gbGlzdCBzbyB0aGF0IHYtZWxzZSgtaWYpIGNvbmRpdGlvbnMgY2FuCiAgICAgICAgICAgIC8vIGZpbmQgaXQgYXMgdGhlIHByZXYgbm9kZS4KICAgICAgICAgICAgdmFyIG5hbWUgPSBlbGVtZW50LnNsb3RUYXJnZXQgfHwgJyJkZWZhdWx0IicKICAgICAgICAgICAgOyhjdXJyZW50UGFyZW50LnNjb3BlZFNsb3RzIHx8IChjdXJyZW50UGFyZW50LnNjb3BlZFNsb3RzID0ge30pKVtuYW1lXSA9IGVsZW1lbnQ7CiAgICAgICAgICB9CiAgICAgICAgICBjdXJyZW50UGFyZW50LmNoaWxkcmVuLnB1c2goZWxlbWVudCk7CiAgICAgICAgICBlbGVtZW50LnBhcmVudCA9IGN1cnJlbnRQYXJlbnQ7CiAgICAgICAgfQogICAgICB9CgogICAgICAvLyBmaW5hbCBjaGlsZHJlbiBjbGVhbnVwCiAgICAgIC8vIGZpbHRlciBvdXQgc2NvcGVkIHNsb3RzCiAgICAgIGVsZW1lbnQuY2hpbGRyZW4gPSBlbGVtZW50LmNoaWxkcmVuLmZpbHRlcihmdW5jdGlvbiAoYykgeyByZXR1cm4gIShjKS5zbG90U2NvcGU7IH0pOwogICAgICAvLyByZW1vdmUgdHJhaWxpbmcgd2hpdGVzcGFjZSBub2RlIGFnYWluCiAgICAgIHRyaW1FbmRpbmdXaGl0ZXNwYWNlKGVsZW1lbnQpOwoKICAgICAgLy8gY2hlY2sgcHJlIHN0YXRlCiAgICAgIGlmIChlbGVtZW50LnByZSkgewogICAgICAgIGluVlByZSA9IGZhbHNlOwogICAgICB9CiAgICAgIGlmIChwbGF0Zm9ybUlzUHJlVGFnKGVsZW1lbnQudGFnKSkgewogICAgICAgIGluUHJlID0gZmFsc2U7CiAgICAgIH0KICAgICAgLy8gYXBwbHkgcG9zdC10cmFuc2Zvcm1zCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcG9zdFRyYW5zZm9ybXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBwb3N0VHJhbnNmb3Jtc1tpXShlbGVtZW50LCBvcHRpb25zKTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHRyaW1FbmRpbmdXaGl0ZXNwYWNlIChlbCkgewogICAgICAvLyByZW1vdmUgdHJhaWxpbmcgd2hpdGVzcGFjZSBub2RlCiAgICAgIGlmICghaW5QcmUpIHsKICAgICAgICB2YXIgbGFzdE5vZGU7CiAgICAgICAgd2hpbGUgKAogICAgICAgICAgKGxhc3ROb2RlID0gZWwuY2hpbGRyZW5bZWwuY2hpbGRyZW4ubGVuZ3RoIC0gMV0pICYmCiAgICAgICAgICBsYXN0Tm9kZS50eXBlID09PSAzICYmCiAgICAgICAgICBsYXN0Tm9kZS50ZXh0ID09PSAnICcKICAgICAgICApIHsKICAgICAgICAgIGVsLmNoaWxkcmVuLnBvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGNoZWNrUm9vdENvbnN0cmFpbnRzIChlbCkgewogICAgICBpZiAoZWwudGFnID09PSAnc2xvdCcgfHwgZWwudGFnID09PSAndGVtcGxhdGUnKSB7CiAgICAgICAgd2Fybk9uY2UoCiAgICAgICAgICAiQ2Fubm90IHVzZSA8IiArIChlbC50YWcpICsgIj4gYXMgY29tcG9uZW50IHJvb3QgZWxlbWVudCBiZWNhdXNlIGl0IG1heSAiICsKICAgICAgICAgICdjb250YWluIG11bHRpcGxlIG5vZGVzLicsCiAgICAgICAgICB7IHN0YXJ0OiBlbC5zdGFydCB9CiAgICAgICAgKTsKICAgICAgfQogICAgICBpZiAoZWwuYXR0cnNNYXAuaGFzT3duUHJvcGVydHkoJ3YtZm9yJykpIHsKICAgICAgICB3YXJuT25jZSgKICAgICAgICAgICdDYW5ub3QgdXNlIHYtZm9yIG9uIHN0YXRlZnVsIGNvbXBvbmVudCByb290IGVsZW1lbnQgYmVjYXVzZSAnICsKICAgICAgICAgICdpdCByZW5kZXJzIG11bHRpcGxlIGVsZW1lbnRzLicsCiAgICAgICAgICBlbC5yYXdBdHRyc01hcFsndi1mb3InXQogICAgICAgICk7CiAgICAgIH0KICAgIH0KCiAgICBwYXJzZUhUTUwodGVtcGxhdGUsIHsKICAgICAgd2Fybjogd2FybiQyLAogICAgICBleHBlY3RIVE1MOiBvcHRpb25zLmV4cGVjdEhUTUwsCiAgICAgIGlzVW5hcnlUYWc6IG9wdGlvbnMuaXNVbmFyeVRhZywKICAgICAgY2FuQmVMZWZ0T3BlblRhZzogb3B0aW9ucy5jYW5CZUxlZnRPcGVuVGFnLAogICAgICBzaG91bGREZWNvZGVOZXdsaW5lczogb3B0aW9ucy5zaG91bGREZWNvZGVOZXdsaW5lcywKICAgICAgc2hvdWxkRGVjb2RlTmV3bGluZXNGb3JIcmVmOiBvcHRpb25zLnNob3VsZERlY29kZU5ld2xpbmVzRm9ySHJlZiwKICAgICAgc2hvdWxkS2VlcENvbW1lbnQ6IG9wdGlvbnMuY29tbWVudHMsCiAgICAgIG91dHB1dFNvdXJjZVJhbmdlOiBvcHRpb25zLm91dHB1dFNvdXJjZVJhbmdlLAogICAgICBzdGFydDogZnVuY3Rpb24gc3RhcnQgKHRhZywgYXR0cnMsIHVuYXJ5LCBzdGFydCQxLCBlbmQpIHsKICAgICAgICAvLyBjaGVjayBuYW1lc3BhY2UuCiAgICAgICAgLy8gaW5oZXJpdCBwYXJlbnQgbnMgaWYgdGhlcmUgaXMgb25lCiAgICAgICAgdmFyIG5zID0gKGN1cnJlbnRQYXJlbnQgJiYgY3VycmVudFBhcmVudC5ucykgfHwgcGxhdGZvcm1HZXRUYWdOYW1lc3BhY2UodGFnKTsKCiAgICAgICAgLy8gaGFuZGxlIElFIHN2ZyBidWcKICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgICBpZiAoaXNJRSAmJiBucyA9PT0gJ3N2ZycpIHsKICAgICAgICAgIGF0dHJzID0gZ3VhcmRJRVNWR0J1ZyhhdHRycyk7CiAgICAgICAgfQoKICAgICAgICB2YXIgZWxlbWVudCA9IGNyZWF0ZUFTVEVsZW1lbnQodGFnLCBhdHRycywgY3VycmVudFBhcmVudCk7CiAgICAgICAgaWYgKG5zKSB7CiAgICAgICAgICBlbGVtZW50Lm5zID0gbnM7CiAgICAgICAgfQoKICAgICAgICB7CiAgICAgICAgICBpZiAob3B0aW9ucy5vdXRwdXRTb3VyY2VSYW5nZSkgewogICAgICAgICAgICBlbGVtZW50LnN0YXJ0ID0gc3RhcnQkMTsKICAgICAgICAgICAgZWxlbWVudC5lbmQgPSBlbmQ7CiAgICAgICAgICAgIGVsZW1lbnQucmF3QXR0cnNNYXAgPSBlbGVtZW50LmF0dHJzTGlzdC5yZWR1Y2UoZnVuY3Rpb24gKGN1bXVsYXRlZCwgYXR0cikgewogICAgICAgICAgICAgIGN1bXVsYXRlZFthdHRyLm5hbWVdID0gYXR0cjsKICAgICAgICAgICAgICByZXR1cm4gY3VtdWxhdGVkCiAgICAgICAgICAgIH0sIHt9KTsKICAgICAgICAgIH0KICAgICAgICAgIGF0dHJzLmZvckVhY2goZnVuY3Rpb24gKGF0dHIpIHsKICAgICAgICAgICAgaWYgKGludmFsaWRBdHRyaWJ1dGVSRS50ZXN0KGF0dHIubmFtZSkpIHsKICAgICAgICAgICAgICB3YXJuJDIoCiAgICAgICAgICAgICAgICAiSW52YWxpZCBkeW5hbWljIGFyZ3VtZW50IGV4cHJlc3Npb246IGF0dHJpYnV0ZSBuYW1lcyBjYW5ub3QgY29udGFpbiAiICsKICAgICAgICAgICAgICAgICJzcGFjZXMsIHF1b3RlcywgPCwgPiwgLyBvciA9LiIsCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIHN0YXJ0OiBhdHRyLnN0YXJ0ICsgYXR0ci5uYW1lLmluZGV4T2YoIlsiKSwKICAgICAgICAgICAgICAgICAgZW5kOiBhdHRyLnN0YXJ0ICsgYXR0ci5uYW1lLmxlbmd0aAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlzRm9yYmlkZGVuVGFnKGVsZW1lbnQpICYmICFpc1NlcnZlclJlbmRlcmluZygpKSB7CiAgICAgICAgICBlbGVtZW50LmZvcmJpZGRlbiA9IHRydWU7CiAgICAgICAgICB3YXJuJDIoCiAgICAgICAgICAgICdUZW1wbGF0ZXMgc2hvdWxkIG9ubHkgYmUgcmVzcG9uc2libGUgZm9yIG1hcHBpbmcgdGhlIHN0YXRlIHRvIHRoZSAnICsKICAgICAgICAgICAgJ1VJLiBBdm9pZCBwbGFjaW5nIHRhZ3Mgd2l0aCBzaWRlLWVmZmVjdHMgaW4geW91ciB0ZW1wbGF0ZXMsIHN1Y2ggYXMgJyArCiAgICAgICAgICAgICI8IiArIHRhZyArICI+IiArICcsIGFzIHRoZXkgd2lsbCBub3QgYmUgcGFyc2VkLicsCiAgICAgICAgICAgIHsgc3RhcnQ6IGVsZW1lbnQuc3RhcnQgfQogICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIC8vIGFwcGx5IHByZS10cmFuc2Zvcm1zCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcmVUcmFuc2Zvcm1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBlbGVtZW50ID0gcHJlVHJhbnNmb3Jtc1tpXShlbGVtZW50LCBvcHRpb25zKSB8fCBlbGVtZW50OwogICAgICAgIH0KCiAgICAgICAgaWYgKCFpblZQcmUpIHsKICAgICAgICAgIHByb2Nlc3NQcmUoZWxlbWVudCk7CiAgICAgICAgICBpZiAoZWxlbWVudC5wcmUpIHsKICAgICAgICAgICAgaW5WUHJlID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHBsYXRmb3JtSXNQcmVUYWcoZWxlbWVudC50YWcpKSB7CiAgICAgICAgICBpblByZSA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChpblZQcmUpIHsKICAgICAgICAgIHByb2Nlc3NSYXdBdHRycyhlbGVtZW50KTsKICAgICAgICB9IGVsc2UgaWYgKCFlbGVtZW50LnByb2Nlc3NlZCkgewogICAgICAgICAgLy8gc3RydWN0dXJhbCBkaXJlY3RpdmVzCiAgICAgICAgICBwcm9jZXNzRm9yKGVsZW1lbnQpOwogICAgICAgICAgcHJvY2Vzc0lmKGVsZW1lbnQpOwogICAgICAgICAgcHJvY2Vzc09uY2UoZWxlbWVudCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIXJvb3QpIHsKICAgICAgICAgIHJvb3QgPSBlbGVtZW50OwogICAgICAgICAgewogICAgICAgICAgICBjaGVja1Jvb3RDb25zdHJhaW50cyhyb290KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICghdW5hcnkpIHsKICAgICAgICAgIGN1cnJlbnRQYXJlbnQgPSBlbGVtZW50OwogICAgICAgICAgc3RhY2sucHVzaChlbGVtZW50KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY2xvc2VFbGVtZW50KGVsZW1lbnQpOwogICAgICAgIH0KICAgICAgfSwKCiAgICAgIGVuZDogZnVuY3Rpb24gZW5kICh0YWcsIHN0YXJ0LCBlbmQkMSkgewogICAgICAgIHZhciBlbGVtZW50ID0gc3RhY2tbc3RhY2subGVuZ3RoIC0gMV07CiAgICAgICAgLy8gcG9wIHN0YWNrCiAgICAgICAgc3RhY2subGVuZ3RoIC09IDE7CiAgICAgICAgY3VycmVudFBhcmVudCA9IHN0YWNrW3N0YWNrLmxlbmd0aCAtIDFdOwogICAgICAgIGlmIChvcHRpb25zLm91dHB1dFNvdXJjZVJhbmdlKSB7CiAgICAgICAgICBlbGVtZW50LmVuZCA9IGVuZCQxOwogICAgICAgIH0KICAgICAgICBjbG9zZUVsZW1lbnQoZWxlbWVudCk7CiAgICAgIH0sCgogICAgICBjaGFyczogZnVuY3Rpb24gY2hhcnMgKHRleHQsIHN0YXJ0LCBlbmQpIHsKICAgICAgICBpZiAoIWN1cnJlbnRQYXJlbnQpIHsKICAgICAgICAgIHsKICAgICAgICAgICAgaWYgKHRleHQgPT09IHRlbXBsYXRlKSB7CiAgICAgICAgICAgICAgd2Fybk9uY2UoCiAgICAgICAgICAgICAgICAnQ29tcG9uZW50IHRlbXBsYXRlIHJlcXVpcmVzIGEgcm9vdCBlbGVtZW50LCByYXRoZXIgdGhhbiBqdXN0IHRleHQuJywKICAgICAgICAgICAgICAgIHsgc3RhcnQ6IHN0YXJ0IH0KICAgICAgICAgICAgICApOwogICAgICAgICAgICB9IGVsc2UgaWYgKCh0ZXh0ID0gdGV4dC50cmltKCkpKSB7CiAgICAgICAgICAgICAgd2Fybk9uY2UoCiAgICAgICAgICAgICAgICAoInRleHQgXCIiICsgdGV4dCArICJcIiBvdXRzaWRlIHJvb3QgZWxlbWVudCB3aWxsIGJlIGlnbm9yZWQuIiksCiAgICAgICAgICAgICAgICB7IHN0YXJ0OiBzdGFydCB9CiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuCiAgICAgICAgfQogICAgICAgIC8vIElFIHRleHRhcmVhIHBsYWNlaG9sZGVyIGJ1ZwogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgICAgIGlmIChpc0lFICYmCiAgICAgICAgICBjdXJyZW50UGFyZW50LnRhZyA9PT0gJ3RleHRhcmVhJyAmJgogICAgICAgICAgY3VycmVudFBhcmVudC5hdHRyc01hcC5wbGFjZWhvbGRlciA9PT0gdGV4dAogICAgICAgICkgewogICAgICAgICAgcmV0dXJuCiAgICAgICAgfQogICAgICAgIHZhciBjaGlsZHJlbiA9IGN1cnJlbnRQYXJlbnQuY2hpbGRyZW47CiAgICAgICAgaWYgKGluUHJlIHx8IHRleHQudHJpbSgpKSB7CiAgICAgICAgICB0ZXh0ID0gaXNUZXh0VGFnKGN1cnJlbnRQYXJlbnQpID8gdGV4dCA6IGRlY29kZUhUTUxDYWNoZWQodGV4dCk7CiAgICAgICAgfSBlbHNlIGlmICghY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgICAgICAvLyByZW1vdmUgdGhlIHdoaXRlc3BhY2Utb25seSBub2RlIHJpZ2h0IGFmdGVyIGFuIG9wZW5pbmcgdGFnCiAgICAgICAgICB0ZXh0ID0gJyc7CiAgICAgICAgfSBlbHNlIGlmICh3aGl0ZXNwYWNlT3B0aW9uKSB7CiAgICAgICAgICBpZiAod2hpdGVzcGFjZU9wdGlvbiA9PT0gJ2NvbmRlbnNlJykgewogICAgICAgICAgICAvLyBpbiBjb25kZW5zZSBtb2RlLCByZW1vdmUgdGhlIHdoaXRlc3BhY2Ugbm9kZSBpZiBpdCBjb250YWlucwogICAgICAgICAgICAvLyBsaW5lIGJyZWFrLCBvdGhlcndpc2UgY29uZGVuc2UgdG8gYSBzaW5nbGUgc3BhY2UKICAgICAgICAgICAgdGV4dCA9IGxpbmVCcmVha1JFLnRlc3QodGV4dCkgPyAnJyA6ICcgJzsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRleHQgPSAnICc7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRleHQgPSBwcmVzZXJ2ZVdoaXRlc3BhY2UgPyAnICcgOiAnJzsKICAgICAgICB9CiAgICAgICAgaWYgKHRleHQpIHsKICAgICAgICAgIGlmICghaW5QcmUgJiYgd2hpdGVzcGFjZU9wdGlvbiA9PT0gJ2NvbmRlbnNlJykgewogICAgICAgICAgICAvLyBjb25kZW5zZSBjb25zZWN1dGl2ZSB3aGl0ZXNwYWNlcyBpbnRvIHNpbmdsZSBzcGFjZQogICAgICAgICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKHdoaXRlc3BhY2VSRSQxLCAnICcpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHJlczsKICAgICAgICAgIHZhciBjaGlsZDsKICAgICAgICAgIGlmICghaW5WUHJlICYmIHRleHQgIT09ICcgJyAmJiAocmVzID0gcGFyc2VUZXh0KHRleHQsIGRlbGltaXRlcnMpKSkgewogICAgICAgICAgICBjaGlsZCA9IHsKICAgICAgICAgICAgICB0eXBlOiAyLAogICAgICAgICAgICAgIGV4cHJlc3Npb246IHJlcy5leHByZXNzaW9uLAogICAgICAgICAgICAgIHRva2VuczogcmVzLnRva2VucywKICAgICAgICAgICAgICB0ZXh0OiB0ZXh0CiAgICAgICAgICAgIH07CiAgICAgICAgICB9IGVsc2UgaWYgKHRleHQgIT09ICcgJyB8fCAhY2hpbGRyZW4ubGVuZ3RoIHx8IGNoaWxkcmVuW2NoaWxkcmVuLmxlbmd0aCAtIDFdLnRleHQgIT09ICcgJykgewogICAgICAgICAgICBjaGlsZCA9IHsKICAgICAgICAgICAgICB0eXBlOiAzLAogICAgICAgICAgICAgIHRleHQ6IHRleHQKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChjaGlsZCkgewogICAgICAgICAgICBpZiAob3B0aW9ucy5vdXRwdXRTb3VyY2VSYW5nZSkgewogICAgICAgICAgICAgIGNoaWxkLnN0YXJ0ID0gc3RhcnQ7CiAgICAgICAgICAgICAgY2hpbGQuZW5kID0gZW5kOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNoaWxkcmVuLnB1c2goY2hpbGQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgY29tbWVudDogZnVuY3Rpb24gY29tbWVudCAodGV4dCwgc3RhcnQsIGVuZCkgewogICAgICAgIC8vIGFkZGluZyBhbnl0aW5nIGFzIGEgc2libGluZyB0byB0aGUgcm9vdCBub2RlIGlzIGZvcmJpZGRlbgogICAgICAgIC8vIGNvbW1lbnRzIHNob3VsZCBzdGlsbCBiZSBhbGxvd2VkLCBidXQgaWdub3JlZAogICAgICAgIGlmIChjdXJyZW50UGFyZW50KSB7CiAgICAgICAgICB2YXIgY2hpbGQgPSB7CiAgICAgICAgICAgIHR5cGU6IDMsCiAgICAgICAgICAgIHRleHQ6IHRleHQsCiAgICAgICAgICAgIGlzQ29tbWVudDogdHJ1ZQogICAgICAgICAgfTsKICAgICAgICAgIGlmIChvcHRpb25zLm91dHB1dFNvdXJjZVJhbmdlKSB7CiAgICAgICAgICAgIGNoaWxkLnN0YXJ0ID0gc3RhcnQ7CiAgICAgICAgICAgIGNoaWxkLmVuZCA9IGVuZDsKICAgICAgICAgIH0KICAgICAgICAgIGN1cnJlbnRQYXJlbnQuY2hpbGRyZW4ucHVzaChjaGlsZCk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICAgIHJldHVybiByb290CiAgfQoKICBmdW5jdGlvbiBwcm9jZXNzUHJlIChlbCkgewogICAgaWYgKGdldEFuZFJlbW92ZUF0dHIoZWwsICd2LXByZScpICE9IG51bGwpIHsKICAgICAgZWwucHJlID0gdHJ1ZTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHByb2Nlc3NSYXdBdHRycyAoZWwpIHsKICAgIHZhciBsaXN0ID0gZWwuYXR0cnNMaXN0OwogICAgdmFyIGxlbiA9IGxpc3QubGVuZ3RoOwogICAgaWYgKGxlbikgewogICAgICB2YXIgYXR0cnMgPSBlbC5hdHRycyA9IG5ldyBBcnJheShsZW4pOwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CiAgICAgICAgYXR0cnNbaV0gPSB7CiAgICAgICAgICBuYW1lOiBsaXN0W2ldLm5hbWUsCiAgICAgICAgICB2YWx1ZTogSlNPTi5zdHJpbmdpZnkobGlzdFtpXS52YWx1ZSkKICAgICAgICB9OwogICAgICAgIGlmIChsaXN0W2ldLnN0YXJ0ICE9IG51bGwpIHsKICAgICAgICAgIGF0dHJzW2ldLnN0YXJ0ID0gbGlzdFtpXS5zdGFydDsKICAgICAgICAgIGF0dHJzW2ldLmVuZCA9IGxpc3RbaV0uZW5kOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIGlmICghZWwucHJlKSB7CiAgICAgIC8vIG5vbiByb290IG5vZGUgaW4gcHJlIGJsb2NrcyB3aXRoIG5vIGF0dHJpYnV0ZXMKICAgICAgZWwucGxhaW4gPSB0cnVlOwogICAgfQogIH0KCiAgZnVuY3Rpb24gcHJvY2Vzc0VsZW1lbnQgKAogICAgZWxlbWVudCwKICAgIG9wdGlvbnMKICApIHsKICAgIHByb2Nlc3NLZXkoZWxlbWVudCk7CgogICAgLy8gZGV0ZXJtaW5lIHdoZXRoZXIgdGhpcyBpcyBhIHBsYWluIGVsZW1lbnQgYWZ0ZXIKICAgIC8vIHJlbW92aW5nIHN0cnVjdHVyYWwgYXR0cmlidXRlcwogICAgZWxlbWVudC5wbGFpbiA9ICgKICAgICAgIWVsZW1lbnQua2V5ICYmCiAgICAgICFlbGVtZW50LnNjb3BlZFNsb3RzICYmCiAgICAgICFlbGVtZW50LmF0dHJzTGlzdC5sZW5ndGgKICAgICk7CgogICAgcHJvY2Vzc1JlZihlbGVtZW50KTsKICAgIHByb2Nlc3NTbG90Q29udGVudChlbGVtZW50KTsKICAgIHByb2Nlc3NTbG90T3V0bGV0KGVsZW1lbnQpOwogICAgcHJvY2Vzc0NvbXBvbmVudChlbGVtZW50KTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdHJhbnNmb3Jtcy5sZW5ndGg7IGkrKykgewogICAgICBlbGVtZW50ID0gdHJhbnNmb3Jtc1tpXShlbGVtZW50LCBvcHRpb25zKSB8fCBlbGVtZW50OwogICAgfQogICAgcHJvY2Vzc0F0dHJzKGVsZW1lbnQpOwogICAgcmV0dXJuIGVsZW1lbnQKICB9CgogIGZ1bmN0aW9uIHByb2Nlc3NLZXkgKGVsKSB7CiAgICB2YXIgZXhwID0gZ2V0QmluZGluZ0F0dHIoZWwsICdrZXknKTsKICAgIGlmIChleHApIHsKICAgICAgewogICAgICAgIGlmIChlbC50YWcgPT09ICd0ZW1wbGF0ZScpIHsKICAgICAgICAgIHdhcm4kMigKICAgICAgICAgICAgIjx0ZW1wbGF0ZT4gY2Fubm90IGJlIGtleWVkLiBQbGFjZSB0aGUga2V5IG9uIHJlYWwgZWxlbWVudHMgaW5zdGVhZC4iLAogICAgICAgICAgICBnZXRSYXdCaW5kaW5nQXR0cihlbCwgJ2tleScpCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICBpZiAoZWwuZm9yKSB7CiAgICAgICAgICB2YXIgaXRlcmF0b3IgPSBlbC5pdGVyYXRvcjIgfHwgZWwuaXRlcmF0b3IxOwogICAgICAgICAgdmFyIHBhcmVudCA9IGVsLnBhcmVudDsKICAgICAgICAgIGlmIChpdGVyYXRvciAmJiBpdGVyYXRvciA9PT0gZXhwICYmIHBhcmVudCAmJiBwYXJlbnQudGFnID09PSAndHJhbnNpdGlvbi1ncm91cCcpIHsKICAgICAgICAgICAgd2FybiQyKAogICAgICAgICAgICAgICJEbyBub3QgdXNlIHYtZm9yIGluZGV4IGFzIGtleSBvbiA8dHJhbnNpdGlvbi1ncm91cD4gY2hpbGRyZW4sICIgKwogICAgICAgICAgICAgICJ0aGlzIGlzIHRoZSBzYW1lIGFzIG5vdCB1c2luZyBrZXlzLiIsCiAgICAgICAgICAgICAgZ2V0UmF3QmluZGluZ0F0dHIoZWwsICdrZXknKSwKICAgICAgICAgICAgICB0cnVlIC8qIHRpcCAqLwogICAgICAgICAgICApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBlbC5rZXkgPSBleHA7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBwcm9jZXNzUmVmIChlbCkgewogICAgdmFyIHJlZiA9IGdldEJpbmRpbmdBdHRyKGVsLCAncmVmJyk7CiAgICBpZiAocmVmKSB7CiAgICAgIGVsLnJlZiA9IHJlZjsKICAgICAgZWwucmVmSW5Gb3IgPSBjaGVja0luRm9yKGVsKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHByb2Nlc3NGb3IgKGVsKSB7CiAgICB2YXIgZXhwOwogICAgaWYgKChleHAgPSBnZXRBbmRSZW1vdmVBdHRyKGVsLCAndi1mb3InKSkpIHsKICAgICAgdmFyIHJlcyA9IHBhcnNlRm9yKGV4cCk7CiAgICAgIGlmIChyZXMpIHsKICAgICAgICBleHRlbmQoZWwsIHJlcyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgd2FybiQyKAogICAgICAgICAgKCJJbnZhbGlkIHYtZm9yIGV4cHJlc3Npb246ICIgKyBleHApLAogICAgICAgICAgZWwucmF3QXR0cnNNYXBbJ3YtZm9yJ10KICAgICAgICApOwogICAgICB9CiAgICB9CiAgfQoKCgogIGZ1bmN0aW9uIHBhcnNlRm9yIChleHApIHsKICAgIHZhciBpbk1hdGNoID0gZXhwLm1hdGNoKGZvckFsaWFzUkUpOwogICAgaWYgKCFpbk1hdGNoKSB7IHJldHVybiB9CiAgICB2YXIgcmVzID0ge307CiAgICByZXMuZm9yID0gaW5NYXRjaFsyXS50cmltKCk7CiAgICB2YXIgYWxpYXMgPSBpbk1hdGNoWzFdLnRyaW0oKS5yZXBsYWNlKHN0cmlwUGFyZW5zUkUsICcnKTsKICAgIHZhciBpdGVyYXRvck1hdGNoID0gYWxpYXMubWF0Y2goZm9ySXRlcmF0b3JSRSk7CiAgICBpZiAoaXRlcmF0b3JNYXRjaCkgewogICAgICByZXMuYWxpYXMgPSBhbGlhcy5yZXBsYWNlKGZvckl0ZXJhdG9yUkUsICcnKS50cmltKCk7CiAgICAgIHJlcy5pdGVyYXRvcjEgPSBpdGVyYXRvck1hdGNoWzFdLnRyaW0oKTsKICAgICAgaWYgKGl0ZXJhdG9yTWF0Y2hbMl0pIHsKICAgICAgICByZXMuaXRlcmF0b3IyID0gaXRlcmF0b3JNYXRjaFsyXS50cmltKCk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHJlcy5hbGlhcyA9IGFsaWFzOwogICAgfQogICAgcmV0dXJuIHJlcwogIH0KCiAgZnVuY3Rpb24gcHJvY2Vzc0lmIChlbCkgewogICAgdmFyIGV4cCA9IGdldEFuZFJlbW92ZUF0dHIoZWwsICd2LWlmJyk7CiAgICBpZiAoZXhwKSB7CiAgICAgIGVsLmlmID0gZXhwOwogICAgICBhZGRJZkNvbmRpdGlvbihlbCwgewogICAgICAgIGV4cDogZXhwLAogICAgICAgIGJsb2NrOiBlbAogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGlmIChnZXRBbmRSZW1vdmVBdHRyKGVsLCAndi1lbHNlJykgIT0gbnVsbCkgewogICAgICAgIGVsLmVsc2UgPSB0cnVlOwogICAgICB9CiAgICAgIHZhciBlbHNlaWYgPSBnZXRBbmRSZW1vdmVBdHRyKGVsLCAndi1lbHNlLWlmJyk7CiAgICAgIGlmIChlbHNlaWYpIHsKICAgICAgICBlbC5lbHNlaWYgPSBlbHNlaWY7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIHByb2Nlc3NJZkNvbmRpdGlvbnMgKGVsLCBwYXJlbnQpIHsKICAgIHZhciBwcmV2ID0gZmluZFByZXZFbGVtZW50KHBhcmVudC5jaGlsZHJlbik7CiAgICBpZiAocHJldiAmJiBwcmV2LmlmKSB7CiAgICAgIGFkZElmQ29uZGl0aW9uKHByZXYsIHsKICAgICAgICBleHA6IGVsLmVsc2VpZiwKICAgICAgICBibG9jazogZWwKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICB3YXJuJDIoCiAgICAgICAgInYtIiArIChlbC5lbHNlaWYgPyAoJ2Vsc2UtaWY9IicgKyBlbC5lbHNlaWYgKyAnIicpIDogJ2Vsc2UnKSArICIgIiArCiAgICAgICAgInVzZWQgb24gZWxlbWVudCA8IiArIChlbC50YWcpICsgIj4gd2l0aG91dCBjb3JyZXNwb25kaW5nIHYtaWYuIiwKICAgICAgICBlbC5yYXdBdHRyc01hcFtlbC5lbHNlaWYgPyAndi1lbHNlLWlmJyA6ICd2LWVsc2UnXQogICAgICApOwogICAgfQogIH0KCiAgZnVuY3Rpb24gZmluZFByZXZFbGVtZW50IChjaGlsZHJlbikgewogICAgdmFyIGkgPSBjaGlsZHJlbi5sZW5ndGg7CiAgICB3aGlsZSAoaS0tKSB7CiAgICAgIGlmIChjaGlsZHJlbltpXS50eXBlID09PSAxKSB7CiAgICAgICAgcmV0dXJuIGNoaWxkcmVuW2ldCiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGNoaWxkcmVuW2ldLnRleHQgIT09ICcgJykgewogICAgICAgICAgd2FybiQyKAogICAgICAgICAgICAidGV4dCBcIiIgKyAoY2hpbGRyZW5baV0udGV4dC50cmltKCkpICsgIlwiIGJldHdlZW4gdi1pZiBhbmQgdi1lbHNlKC1pZikgIiArCiAgICAgICAgICAgICJ3aWxsIGJlIGlnbm9yZWQuIiwKICAgICAgICAgICAgY2hpbGRyZW5baV0KICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIGNoaWxkcmVuLnBvcCgpOwogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBhZGRJZkNvbmRpdGlvbiAoZWwsIGNvbmRpdGlvbikgewogICAgaWYgKCFlbC5pZkNvbmRpdGlvbnMpIHsKICAgICAgZWwuaWZDb25kaXRpb25zID0gW107CiAgICB9CiAgICBlbC5pZkNvbmRpdGlvbnMucHVzaChjb25kaXRpb24pOwogIH0KCiAgZnVuY3Rpb24gcHJvY2Vzc09uY2UgKGVsKSB7CiAgICB2YXIgb25jZSQkMSA9IGdldEFuZFJlbW92ZUF0dHIoZWwsICd2LW9uY2UnKTsKICAgIGlmIChvbmNlJCQxICE9IG51bGwpIHsKICAgICAgZWwub25jZSA9IHRydWU7CiAgICB9CiAgfQoKICAvLyBoYW5kbGUgY29udGVudCBiZWluZyBwYXNzZWQgdG8gYSBjb21wb25lbnQgYXMgc2xvdCwKICAvLyBlLmcuIDx0ZW1wbGF0ZSBzbG90PSJ4eHgiPiwgPGRpdiBzbG90LXNjb3BlPSJ4eHgiPgogIGZ1bmN0aW9uIHByb2Nlc3NTbG90Q29udGVudCAoZWwpIHsKICAgIHZhciBzbG90U2NvcGU7CiAgICBpZiAoZWwudGFnID09PSAndGVtcGxhdGUnKSB7CiAgICAgIHNsb3RTY29wZSA9IGdldEFuZFJlbW92ZUF0dHIoZWwsICdzY29wZScpOwogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgaWYgKHNsb3RTY29wZSkgewogICAgICAgIHdhcm4kMigKICAgICAgICAgICJ0aGUgXCJzY29wZVwiIGF0dHJpYnV0ZSBmb3Igc2NvcGVkIHNsb3RzIGhhdmUgYmVlbiBkZXByZWNhdGVkIGFuZCAiICsKICAgICAgICAgICJyZXBsYWNlZCBieSBcInNsb3Qtc2NvcGVcIiBzaW5jZSAyLjUuIFRoZSBuZXcgXCJzbG90LXNjb3BlXCIgYXR0cmlidXRlICIgKwogICAgICAgICAgImNhbiBhbHNvIGJlIHVzZWQgb24gcGxhaW4gZWxlbWVudHMgaW4gYWRkaXRpb24gdG8gPHRlbXBsYXRlPiB0byAiICsKICAgICAgICAgICJkZW5vdGUgc2NvcGVkIHNsb3RzLiIsCiAgICAgICAgICBlbC5yYXdBdHRyc01hcFsnc2NvcGUnXSwKICAgICAgICAgIHRydWUKICAgICAgICApOwogICAgICB9CiAgICAgIGVsLnNsb3RTY29wZSA9IHNsb3RTY29wZSB8fCBnZXRBbmRSZW1vdmVBdHRyKGVsLCAnc2xvdC1zY29wZScpOwogICAgfSBlbHNlIGlmICgoc2xvdFNjb3BlID0gZ2V0QW5kUmVtb3ZlQXR0cihlbCwgJ3Nsb3Qtc2NvcGUnKSkpIHsKICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICAgIGlmIChlbC5hdHRyc01hcFsndi1mb3InXSkgewogICAgICAgIHdhcm4kMigKICAgICAgICAgICJBbWJpZ3VvdXMgY29tYmluZWQgdXNhZ2Ugb2Ygc2xvdC1zY29wZSBhbmQgdi1mb3Igb24gPCIgKyAoZWwudGFnKSArICI+ICIgKwogICAgICAgICAgIih2LWZvciB0YWtlcyBoaWdoZXIgcHJpb3JpdHkpLiBVc2UgYSB3cmFwcGVyIDx0ZW1wbGF0ZT4gZm9yIHRoZSAiICsKICAgICAgICAgICJzY29wZWQgc2xvdCB0byBtYWtlIGl0IGNsZWFyZXIuIiwKICAgICAgICAgIGVsLnJhd0F0dHJzTWFwWydzbG90LXNjb3BlJ10sCiAgICAgICAgICB0cnVlCiAgICAgICAgKTsKICAgICAgfQogICAgICBlbC5zbG90U2NvcGUgPSBzbG90U2NvcGU7CiAgICB9CgogICAgLy8gc2xvdD0ieHh4IgogICAgdmFyIHNsb3RUYXJnZXQgPSBnZXRCaW5kaW5nQXR0cihlbCwgJ3Nsb3QnKTsKICAgIGlmIChzbG90VGFyZ2V0KSB7CiAgICAgIGVsLnNsb3RUYXJnZXQgPSBzbG90VGFyZ2V0ID09PSAnIiInID8gJyJkZWZhdWx0IicgOiBzbG90VGFyZ2V0OwogICAgICBlbC5zbG90VGFyZ2V0RHluYW1pYyA9ICEhKGVsLmF0dHJzTWFwWyc6c2xvdCddIHx8IGVsLmF0dHJzTWFwWyd2LWJpbmQ6c2xvdCddKTsKICAgICAgLy8gcHJlc2VydmUgc2xvdCBhcyBhbiBhdHRyaWJ1dGUgZm9yIG5hdGl2ZSBzaGFkb3cgRE9NIGNvbXBhdAogICAgICAvLyBvbmx5IGZvciBub24tc2NvcGVkIHNsb3RzLgogICAgICBpZiAoZWwudGFnICE9PSAndGVtcGxhdGUnICYmICFlbC5zbG90U2NvcGUpIHsKICAgICAgICBhZGRBdHRyKGVsLCAnc2xvdCcsIHNsb3RUYXJnZXQsIGdldFJhd0JpbmRpbmdBdHRyKGVsLCAnc2xvdCcpKTsKICAgICAgfQogICAgfQoKICAgIC8vIDIuNiB2LXNsb3Qgc3ludGF4CiAgICB7CiAgICAgIGlmIChlbC50YWcgPT09ICd0ZW1wbGF0ZScpIHsKICAgICAgICAvLyB2LXNsb3Qgb24gPHRlbXBsYXRlPgogICAgICAgIHZhciBzbG90QmluZGluZyA9IGdldEFuZFJlbW92ZUF0dHJCeVJlZ2V4KGVsLCBzbG90UkUpOwogICAgICAgIGlmIChzbG90QmluZGluZykgewogICAgICAgICAgewogICAgICAgICAgICBpZiAoZWwuc2xvdFRhcmdldCB8fCBlbC5zbG90U2NvcGUpIHsKICAgICAgICAgICAgICB3YXJuJDIoCiAgICAgICAgICAgICAgICAiVW5leHBlY3RlZCBtaXhlZCB1c2FnZSBvZiBkaWZmZXJlbnQgc2xvdCBzeW50YXhlcy4iLAogICAgICAgICAgICAgICAgZWwKICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChlbC5wYXJlbnQgJiYgIW1heWJlQ29tcG9uZW50KGVsLnBhcmVudCkpIHsKICAgICAgICAgICAgICB3YXJuJDIoCiAgICAgICAgICAgICAgICAiPHRlbXBsYXRlIHYtc2xvdD4gY2FuIG9ubHkgYXBwZWFyIGF0IHRoZSByb290IGxldmVsIGluc2lkZSAiICsKICAgICAgICAgICAgICAgICJ0aGUgcmVjZWl2aW5nIHRoZSBjb21wb25lbnQiLAogICAgICAgICAgICAgICAgZWwKICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcmVmID0gZ2V0U2xvdE5hbWUoc2xvdEJpbmRpbmcpOwogICAgICAgICAgdmFyIG5hbWUgPSByZWYubmFtZTsKICAgICAgICAgIHZhciBkeW5hbWljID0gcmVmLmR5bmFtaWM7CiAgICAgICAgICBlbC5zbG90VGFyZ2V0ID0gbmFtZTsKICAgICAgICAgIGVsLnNsb3RUYXJnZXREeW5hbWljID0gZHluYW1pYzsKICAgICAgICAgIGVsLnNsb3RTY29wZSA9IHNsb3RCaW5kaW5nLnZhbHVlIHx8IGVtcHR5U2xvdFNjb3BlVG9rZW47IC8vIGZvcmNlIGl0IGludG8gYSBzY29wZWQgc2xvdCBmb3IgcGVyZgogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyB2LXNsb3Qgb24gY29tcG9uZW50LCBkZW5vdGVzIGRlZmF1bHQgc2xvdAogICAgICAgIHZhciBzbG90QmluZGluZyQxID0gZ2V0QW5kUmVtb3ZlQXR0ckJ5UmVnZXgoZWwsIHNsb3RSRSk7CiAgICAgICAgaWYgKHNsb3RCaW5kaW5nJDEpIHsKICAgICAgICAgIHsKICAgICAgICAgICAgaWYgKCFtYXliZUNvbXBvbmVudChlbCkpIHsKICAgICAgICAgICAgICB3YXJuJDIoCiAgICAgICAgICAgICAgICAidi1zbG90IGNhbiBvbmx5IGJlIHVzZWQgb24gY29tcG9uZW50cyBvciA8dGVtcGxhdGU+LiIsCiAgICAgICAgICAgICAgICBzbG90QmluZGluZyQxCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZWwuc2xvdFNjb3BlIHx8IGVsLnNsb3RUYXJnZXQpIHsKICAgICAgICAgICAgICB3YXJuJDIoCiAgICAgICAgICAgICAgICAiVW5leHBlY3RlZCBtaXhlZCB1c2FnZSBvZiBkaWZmZXJlbnQgc2xvdCBzeW50YXhlcy4iLAogICAgICAgICAgICAgICAgZWwKICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChlbC5zY29wZWRTbG90cykgewogICAgICAgICAgICAgIHdhcm4kMigKICAgICAgICAgICAgICAgICJUbyBhdm9pZCBzY29wZSBhbWJpZ3VpdHksIHRoZSBkZWZhdWx0IHNsb3Qgc2hvdWxkIGFsc28gdXNlICIgKwogICAgICAgICAgICAgICAgIjx0ZW1wbGF0ZT4gc3ludGF4IHdoZW4gdGhlcmUgYXJlIG90aGVyIG5hbWVkIHNsb3RzLiIsCiAgICAgICAgICAgICAgICBzbG90QmluZGluZyQxCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLy8gYWRkIHRoZSBjb21wb25lbnQncyBjaGlsZHJlbiB0byBpdHMgZGVmYXVsdCBzbG90CiAgICAgICAgICB2YXIgc2xvdHMgPSBlbC5zY29wZWRTbG90cyB8fCAoZWwuc2NvcGVkU2xvdHMgPSB7fSk7CiAgICAgICAgICB2YXIgcmVmJDEgPSBnZXRTbG90TmFtZShzbG90QmluZGluZyQxKTsKICAgICAgICAgIHZhciBuYW1lJDEgPSByZWYkMS5uYW1lOwogICAgICAgICAgdmFyIGR5bmFtaWMkMSA9IHJlZiQxLmR5bmFtaWM7CiAgICAgICAgICB2YXIgc2xvdENvbnRhaW5lciA9IHNsb3RzW25hbWUkMV0gPSBjcmVhdGVBU1RFbGVtZW50KCd0ZW1wbGF0ZScsIFtdLCBlbCk7CiAgICAgICAgICBzbG90Q29udGFpbmVyLnNsb3RUYXJnZXQgPSBuYW1lJDE7CiAgICAgICAgICBzbG90Q29udGFpbmVyLnNsb3RUYXJnZXREeW5hbWljID0gZHluYW1pYyQxOwogICAgICAgICAgc2xvdENvbnRhaW5lci5jaGlsZHJlbiA9IGVsLmNoaWxkcmVuLmZpbHRlcihmdW5jdGlvbiAoYykgewogICAgICAgICAgICBpZiAoIWMuc2xvdFNjb3BlKSB7CiAgICAgICAgICAgICAgYy5wYXJlbnQgPSBzbG90Q29udGFpbmVyOwogICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgICAgc2xvdENvbnRhaW5lci5zbG90U2NvcGUgPSBzbG90QmluZGluZyQxLnZhbHVlIHx8IGVtcHR5U2xvdFNjb3BlVG9rZW47CiAgICAgICAgICAvLyByZW1vdmUgY2hpbGRyZW4gYXMgdGhleSBhcmUgcmV0dXJuZWQgZnJvbSBzY29wZWRTbG90cyBub3cKICAgICAgICAgIGVsLmNoaWxkcmVuID0gW107CiAgICAgICAgICAvLyBtYXJrIGVsIG5vbi1wbGFpbiBzbyBkYXRhIGdldHMgZ2VuZXJhdGVkCiAgICAgICAgICBlbC5wbGFpbiA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gZ2V0U2xvdE5hbWUgKGJpbmRpbmcpIHsKICAgIHZhciBuYW1lID0gYmluZGluZy5uYW1lLnJlcGxhY2Uoc2xvdFJFLCAnJyk7CiAgICBpZiAoIW5hbWUpIHsKICAgICAgaWYgKGJpbmRpbmcubmFtZVswXSAhPT0gJyMnKSB7CiAgICAgICAgbmFtZSA9ICdkZWZhdWx0JzsKICAgICAgfSBlbHNlIHsKICAgICAgICB3YXJuJDIoCiAgICAgICAgICAidi1zbG90IHNob3J0aGFuZCBzeW50YXggcmVxdWlyZXMgYSBzbG90IG5hbWUuIiwKICAgICAgICAgIGJpbmRpbmcKICAgICAgICApOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZHluYW1pY0FyZ1JFLnRlc3QobmFtZSkKICAgICAgLy8gZHluYW1pYyBbbmFtZV0KICAgICAgPyB7IG5hbWU6IG5hbWUuc2xpY2UoMSwgLTEpLCBkeW5hbWljOiB0cnVlIH0KICAgICAgLy8gc3RhdGljIG5hbWUKICAgICAgOiB7IG5hbWU6ICgiXCIiICsgbmFtZSArICJcIiIpLCBkeW5hbWljOiBmYWxzZSB9CiAgfQoKICAvLyBoYW5kbGUgPHNsb3QvPiBvdXRsZXRzCiAgZnVuY3Rpb24gcHJvY2Vzc1Nsb3RPdXRsZXQgKGVsKSB7CiAgICBpZiAoZWwudGFnID09PSAnc2xvdCcpIHsKICAgICAgZWwuc2xvdE5hbWUgPSBnZXRCaW5kaW5nQXR0cihlbCwgJ25hbWUnKTsKICAgICAgaWYgKGVsLmtleSkgewogICAgICAgIHdhcm4kMigKICAgICAgICAgICJga2V5YCBkb2VzIG5vdCB3b3JrIG9uIDxzbG90PiBiZWNhdXNlIHNsb3RzIGFyZSBhYnN0cmFjdCBvdXRsZXRzICIgKwogICAgICAgICAgImFuZCBjYW4gcG9zc2libHkgZXhwYW5kIGludG8gbXVsdGlwbGUgZWxlbWVudHMuICIgKwogICAgICAgICAgIlVzZSB0aGUga2V5IG9uIGEgd3JhcHBpbmcgZWxlbWVudCBpbnN0ZWFkLiIsCiAgICAgICAgICBnZXRSYXdCaW5kaW5nQXR0cihlbCwgJ2tleScpCiAgICAgICAgKTsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gcHJvY2Vzc0NvbXBvbmVudCAoZWwpIHsKICAgIHZhciBiaW5kaW5nOwogICAgaWYgKChiaW5kaW5nID0gZ2V0QmluZGluZ0F0dHIoZWwsICdpcycpKSkgewogICAgICBlbC5jb21wb25lbnQgPSBiaW5kaW5nOwogICAgfQogICAgaWYgKGdldEFuZFJlbW92ZUF0dHIoZWwsICdpbmxpbmUtdGVtcGxhdGUnKSAhPSBudWxsKSB7CiAgICAgIGVsLmlubGluZVRlbXBsYXRlID0gdHJ1ZTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHByb2Nlc3NBdHRycyAoZWwpIHsKICAgIHZhciBsaXN0ID0gZWwuYXR0cnNMaXN0OwogICAgdmFyIGksIGwsIG5hbWUsIHJhd05hbWUsIHZhbHVlLCBtb2RpZmllcnMsIHN5bmNHZW4sIGlzRHluYW1pYzsKICAgIGZvciAoaSA9IDAsIGwgPSBsaXN0Lmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICBuYW1lID0gcmF3TmFtZSA9IGxpc3RbaV0ubmFtZTsKICAgICAgdmFsdWUgPSBsaXN0W2ldLnZhbHVlOwogICAgICBpZiAoZGlyUkUudGVzdChuYW1lKSkgewogICAgICAgIC8vIG1hcmsgZWxlbWVudCBhcyBkeW5hbWljCiAgICAgICAgZWwuaGFzQmluZGluZ3MgPSB0cnVlOwogICAgICAgIC8vIG1vZGlmaWVycwogICAgICAgIG1vZGlmaWVycyA9IHBhcnNlTW9kaWZpZXJzKG5hbWUucmVwbGFjZShkaXJSRSwgJycpKTsKICAgICAgICAvLyBzdXBwb3J0IC5mb28gc2hvcnRoYW5kIHN5bnRheCBmb3IgdGhlIC5wcm9wIG1vZGlmaWVyCiAgICAgICAgaWYgKG1vZGlmaWVycykgewogICAgICAgICAgbmFtZSA9IG5hbWUucmVwbGFjZShtb2RpZmllclJFLCAnJyk7CiAgICAgICAgfQogICAgICAgIGlmIChiaW5kUkUudGVzdChuYW1lKSkgeyAvLyB2LWJpbmQKICAgICAgICAgIG5hbWUgPSBuYW1lLnJlcGxhY2UoYmluZFJFLCAnJyk7CiAgICAgICAgICB2YWx1ZSA9IHBhcnNlRmlsdGVycyh2YWx1ZSk7CiAgICAgICAgICBpc0R5bmFtaWMgPSBkeW5hbWljQXJnUkUudGVzdChuYW1lKTsKICAgICAgICAgIGlmIChpc0R5bmFtaWMpIHsKICAgICAgICAgICAgbmFtZSA9IG5hbWUuc2xpY2UoMSwgLTEpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKAogICAgICAgICAgICB2YWx1ZS50cmltKCkubGVuZ3RoID09PSAwCiAgICAgICAgICApIHsKICAgICAgICAgICAgd2FybiQyKAogICAgICAgICAgICAgICgiVGhlIHZhbHVlIGZvciBhIHYtYmluZCBleHByZXNzaW9uIGNhbm5vdCBiZSBlbXB0eS4gRm91bmQgaW4gXCJ2LWJpbmQ6IiArIG5hbWUgKyAiXCIiKQogICAgICAgICAgICApOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG1vZGlmaWVycykgewogICAgICAgICAgICBpZiAobW9kaWZpZXJzLnByb3AgJiYgIWlzRHluYW1pYykgewogICAgICAgICAgICAgIG5hbWUgPSBjYW1lbGl6ZShuYW1lKTsKICAgICAgICAgICAgICBpZiAobmFtZSA9PT0gJ2lubmVySHRtbCcpIHsgbmFtZSA9ICdpbm5lckhUTUwnOyB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG1vZGlmaWVycy5jYW1lbCAmJiAhaXNEeW5hbWljKSB7CiAgICAgICAgICAgICAgbmFtZSA9IGNhbWVsaXplKG5hbWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChtb2RpZmllcnMuc3luYykgewogICAgICAgICAgICAgIHN5bmNHZW4gPSBnZW5Bc3NpZ25tZW50Q29kZSh2YWx1ZSwgIiRldmVudCIpOwogICAgICAgICAgICAgIGlmICghaXNEeW5hbWljKSB7CiAgICAgICAgICAgICAgICBhZGRIYW5kbGVyKAogICAgICAgICAgICAgICAgICBlbCwKICAgICAgICAgICAgICAgICAgKCJ1cGRhdGU6IiArIChjYW1lbGl6ZShuYW1lKSkpLAogICAgICAgICAgICAgICAgICBzeW5jR2VuLAogICAgICAgICAgICAgICAgICBudWxsLAogICAgICAgICAgICAgICAgICBmYWxzZSwKICAgICAgICAgICAgICAgICAgd2FybiQyLAogICAgICAgICAgICAgICAgICBsaXN0W2ldCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgaWYgKGh5cGhlbmF0ZShuYW1lKSAhPT0gY2FtZWxpemUobmFtZSkpIHsKICAgICAgICAgICAgICAgICAgYWRkSGFuZGxlcigKICAgICAgICAgICAgICAgICAgICBlbCwKICAgICAgICAgICAgICAgICAgICAoInVwZGF0ZToiICsgKGh5cGhlbmF0ZShuYW1lKSkpLAogICAgICAgICAgICAgICAgICAgIHN5bmNHZW4sCiAgICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgICBmYWxzZSwKICAgICAgICAgICAgICAgICAgICB3YXJuJDIsCiAgICAgICAgICAgICAgICAgICAgbGlzdFtpXQogICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBoYW5kbGVyIHcvIGR5bmFtaWMgZXZlbnQgbmFtZQogICAgICAgICAgICAgICAgYWRkSGFuZGxlcigKICAgICAgICAgICAgICAgICAgZWwsCiAgICAgICAgICAgICAgICAgICgiXCJ1cGRhdGU6XCIrKCIgKyBuYW1lICsgIikiKSwKICAgICAgICAgICAgICAgICAgc3luY0dlbiwKICAgICAgICAgICAgICAgICAgbnVsbCwKICAgICAgICAgICAgICAgICAgZmFsc2UsCiAgICAgICAgICAgICAgICAgIHdhcm4kMiwKICAgICAgICAgICAgICAgICAgbGlzdFtpXSwKICAgICAgICAgICAgICAgICAgdHJ1ZSAvLyBkeW5hbWljCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKChtb2RpZmllcnMgJiYgbW9kaWZpZXJzLnByb3ApIHx8ICgKICAgICAgICAgICAgIWVsLmNvbXBvbmVudCAmJiBwbGF0Zm9ybU11c3RVc2VQcm9wKGVsLnRhZywgZWwuYXR0cnNNYXAudHlwZSwgbmFtZSkKICAgICAgICAgICkpIHsKICAgICAgICAgICAgYWRkUHJvcChlbCwgbmFtZSwgdmFsdWUsIGxpc3RbaV0sIGlzRHluYW1pYyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhZGRBdHRyKGVsLCBuYW1lLCB2YWx1ZSwgbGlzdFtpXSwgaXNEeW5hbWljKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKG9uUkUudGVzdChuYW1lKSkgeyAvLyB2LW9uCiAgICAgICAgICBuYW1lID0gbmFtZS5yZXBsYWNlKG9uUkUsICcnKTsKICAgICAgICAgIGlzRHluYW1pYyA9IGR5bmFtaWNBcmdSRS50ZXN0KG5hbWUpOwogICAgICAgICAgaWYgKGlzRHluYW1pYykgewogICAgICAgICAgICBuYW1lID0gbmFtZS5zbGljZSgxLCAtMSk7CiAgICAgICAgICB9CiAgICAgICAgICBhZGRIYW5kbGVyKGVsLCBuYW1lLCB2YWx1ZSwgbW9kaWZpZXJzLCBmYWxzZSwgd2FybiQyLCBsaXN0W2ldLCBpc0R5bmFtaWMpOwogICAgICAgIH0gZWxzZSB7IC8vIG5vcm1hbCBkaXJlY3RpdmVzCiAgICAgICAgICBuYW1lID0gbmFtZS5yZXBsYWNlKGRpclJFLCAnJyk7CiAgICAgICAgICAvLyBwYXJzZSBhcmcKICAgICAgICAgIHZhciBhcmdNYXRjaCA9IG5hbWUubWF0Y2goYXJnUkUpOwogICAgICAgICAgdmFyIGFyZyA9IGFyZ01hdGNoICYmIGFyZ01hdGNoWzFdOwogICAgICAgICAgaXNEeW5hbWljID0gZmFsc2U7CiAgICAgICAgICBpZiAoYXJnKSB7CiAgICAgICAgICAgIG5hbWUgPSBuYW1lLnNsaWNlKDAsIC0oYXJnLmxlbmd0aCArIDEpKTsKICAgICAgICAgICAgaWYgKGR5bmFtaWNBcmdSRS50ZXN0KGFyZykpIHsKICAgICAgICAgICAgICBhcmcgPSBhcmcuc2xpY2UoMSwgLTEpOwogICAgICAgICAgICAgIGlzRHluYW1pYyA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGFkZERpcmVjdGl2ZShlbCwgbmFtZSwgcmF3TmFtZSwgdmFsdWUsIGFyZywgaXNEeW5hbWljLCBtb2RpZmllcnMsIGxpc3RbaV0pOwogICAgICAgICAgaWYgKG5hbWUgPT09ICdtb2RlbCcpIHsKICAgICAgICAgICAgY2hlY2tGb3JBbGlhc01vZGVsKGVsLCB2YWx1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIGxpdGVyYWwgYXR0cmlidXRlCiAgICAgICAgewogICAgICAgICAgdmFyIHJlcyA9IHBhcnNlVGV4dCh2YWx1ZSwgZGVsaW1pdGVycyk7CiAgICAgICAgICBpZiAocmVzKSB7CiAgICAgICAgICAgIHdhcm4kMigKICAgICAgICAgICAgICBuYW1lICsgIj1cIiIgKyB2YWx1ZSArICJcIjogIiArCiAgICAgICAgICAgICAgJ0ludGVycG9sYXRpb24gaW5zaWRlIGF0dHJpYnV0ZXMgaGFzIGJlZW4gcmVtb3ZlZC4gJyArCiAgICAgICAgICAgICAgJ1VzZSB2LWJpbmQgb3IgdGhlIGNvbG9uIHNob3J0aGFuZCBpbnN0ZWFkLiBGb3IgZXhhbXBsZSwgJyArCiAgICAgICAgICAgICAgJ2luc3RlYWQgb2YgPGRpdiBpZD0ie3sgdmFsIH19Ij4sIHVzZSA8ZGl2IDppZD0idmFsIj4uJywKICAgICAgICAgICAgICBsaXN0W2ldCiAgICAgICAgICAgICk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGFkZEF0dHIoZWwsIG5hbWUsIEpTT04uc3RyaW5naWZ5KHZhbHVlKSwgbGlzdFtpXSk7CiAgICAgICAgLy8gIzY4ODcgZmlyZWZveCBkb2Vzbid0IHVwZGF0ZSBtdXRlZCBzdGF0ZSBpZiBzZXQgdmlhIGF0dHJpYnV0ZQogICAgICAgIC8vIGV2ZW4gaW1tZWRpYXRlbHkgYWZ0ZXIgZWxlbWVudCBjcmVhdGlvbgogICAgICAgIGlmICghZWwuY29tcG9uZW50ICYmCiAgICAgICAgICAgIG5hbWUgPT09ICdtdXRlZCcgJiYKICAgICAgICAgICAgcGxhdGZvcm1NdXN0VXNlUHJvcChlbC50YWcsIGVsLmF0dHJzTWFwLnR5cGUsIG5hbWUpKSB7CiAgICAgICAgICBhZGRQcm9wKGVsLCBuYW1lLCAndHJ1ZScsIGxpc3RbaV0pOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gY2hlY2tJbkZvciAoZWwpIHsKICAgIHZhciBwYXJlbnQgPSBlbDsKICAgIHdoaWxlIChwYXJlbnQpIHsKICAgICAgaWYgKHBhcmVudC5mb3IgIT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0cnVlCiAgICAgIH0KICAgICAgcGFyZW50ID0gcGFyZW50LnBhcmVudDsKICAgIH0KICAgIHJldHVybiBmYWxzZQogIH0KCiAgZnVuY3Rpb24gcGFyc2VNb2RpZmllcnMgKG5hbWUpIHsKICAgIHZhciBtYXRjaCA9IG5hbWUubWF0Y2gobW9kaWZpZXJSRSk7CiAgICBpZiAobWF0Y2gpIHsKICAgICAgdmFyIHJldCA9IHt9OwogICAgICBtYXRjaC5mb3JFYWNoKGZ1bmN0aW9uIChtKSB7IHJldFttLnNsaWNlKDEpXSA9IHRydWU7IH0pOwogICAgICByZXR1cm4gcmV0CiAgICB9CiAgfQoKICBmdW5jdGlvbiBtYWtlQXR0cnNNYXAgKGF0dHJzKSB7CiAgICB2YXIgbWFwID0ge307CiAgICBmb3IgKHZhciBpID0gMCwgbCA9IGF0dHJzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICBpZiAoCiAgICAgICAgbWFwW2F0dHJzW2ldLm5hbWVdICYmICFpc0lFICYmICFpc0VkZ2UKICAgICAgKSB7CiAgICAgICAgd2FybiQyKCdkdXBsaWNhdGUgYXR0cmlidXRlOiAnICsgYXR0cnNbaV0ubmFtZSwgYXR0cnNbaV0pOwogICAgICB9CiAgICAgIG1hcFthdHRyc1tpXS5uYW1lXSA9IGF0dHJzW2ldLnZhbHVlOwogICAgfQogICAgcmV0dXJuIG1hcAogIH0KCiAgLy8gZm9yIHNjcmlwdCAoZS5nLiB0eXBlPSJ4L3RlbXBsYXRlIikgb3Igc3R5bGUsIGRvIG5vdCBkZWNvZGUgY29udGVudAogIGZ1bmN0aW9uIGlzVGV4dFRhZyAoZWwpIHsKICAgIHJldHVybiBlbC50YWcgPT09ICdzY3JpcHQnIHx8IGVsLnRhZyA9PT0gJ3N0eWxlJwogIH0KCiAgZnVuY3Rpb24gaXNGb3JiaWRkZW5UYWcgKGVsKSB7CiAgICByZXR1cm4gKAogICAgICBlbC50YWcgPT09ICdzdHlsZScgfHwKICAgICAgKGVsLnRhZyA9PT0gJ3NjcmlwdCcgJiYgKAogICAgICAgICFlbC5hdHRyc01hcC50eXBlIHx8CiAgICAgICAgZWwuYXR0cnNNYXAudHlwZSA9PT0gJ3RleHQvamF2YXNjcmlwdCcKICAgICAgKSkKICAgICkKICB9CgogIHZhciBpZU5TQnVnID0gL154bWxuczpOU1xkKy87CiAgdmFyIGllTlNQcmVmaXggPSAvXk5TXGQrOi87CgogIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgZnVuY3Rpb24gZ3VhcmRJRVNWR0J1ZyAoYXR0cnMpIHsKICAgIHZhciByZXMgPSBbXTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXR0cnMubGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIGF0dHIgPSBhdHRyc1tpXTsKICAgICAgaWYgKCFpZU5TQnVnLnRlc3QoYXR0ci5uYW1lKSkgewogICAgICAgIGF0dHIubmFtZSA9IGF0dHIubmFtZS5yZXBsYWNlKGllTlNQcmVmaXgsICcnKTsKICAgICAgICByZXMucHVzaChhdHRyKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlcwogIH0KCiAgZnVuY3Rpb24gY2hlY2tGb3JBbGlhc01vZGVsIChlbCwgdmFsdWUpIHsKICAgIHZhciBfZWwgPSBlbDsKICAgIHdoaWxlIChfZWwpIHsKICAgICAgaWYgKF9lbC5mb3IgJiYgX2VsLmFsaWFzID09PSB2YWx1ZSkgewogICAgICAgIHdhcm4kMigKICAgICAgICAgICI8IiArIChlbC50YWcpICsgIiB2LW1vZGVsPVwiIiArIHZhbHVlICsgIlwiPjogIiArCiAgICAgICAgICAiWW91IGFyZSBiaW5kaW5nIHYtbW9kZWwgZGlyZWN0bHkgdG8gYSB2LWZvciBpdGVyYXRpb24gYWxpYXMuICIgKwogICAgICAgICAgIlRoaXMgd2lsbCBub3QgYmUgYWJsZSB0byBtb2RpZnkgdGhlIHYtZm9yIHNvdXJjZSBhcnJheSBiZWNhdXNlICIgKwogICAgICAgICAgIndyaXRpbmcgdG8gdGhlIGFsaWFzIGlzIGxpa2UgbW9kaWZ5aW5nIGEgZnVuY3Rpb24gbG9jYWwgdmFyaWFibGUuICIgKwogICAgICAgICAgIkNvbnNpZGVyIHVzaW5nIGFuIGFycmF5IG9mIG9iamVjdHMgYW5kIHVzZSB2LW1vZGVsIG9uIGFuIG9iamVjdCBwcm9wZXJ0eSBpbnN0ZWFkLiIsCiAgICAgICAgICBlbC5yYXdBdHRyc01hcFsndi1tb2RlbCddCiAgICAgICAgKTsKICAgICAgfQogICAgICBfZWwgPSBfZWwucGFyZW50OwogICAgfQogIH0KCiAgLyogICovCgogIGZ1bmN0aW9uIHByZVRyYW5zZm9ybU5vZGUgKGVsLCBvcHRpb25zKSB7CiAgICBpZiAoZWwudGFnID09PSAnaW5wdXQnKSB7CiAgICAgIHZhciBtYXAgPSBlbC5hdHRyc01hcDsKICAgICAgaWYgKCFtYXBbJ3YtbW9kZWwnXSkgewogICAgICAgIHJldHVybgogICAgICB9CgogICAgICB2YXIgdHlwZUJpbmRpbmc7CiAgICAgIGlmIChtYXBbJzp0eXBlJ10gfHwgbWFwWyd2LWJpbmQ6dHlwZSddKSB7CiAgICAgICAgdHlwZUJpbmRpbmcgPSBnZXRCaW5kaW5nQXR0cihlbCwgJ3R5cGUnKTsKICAgICAgfQogICAgICBpZiAoIW1hcC50eXBlICYmICF0eXBlQmluZGluZyAmJiBtYXBbJ3YtYmluZCddKSB7CiAgICAgICAgdHlwZUJpbmRpbmcgPSAiKCIgKyAobWFwWyd2LWJpbmQnXSkgKyAiKS50eXBlIjsKICAgICAgfQoKICAgICAgaWYgKHR5cGVCaW5kaW5nKSB7CiAgICAgICAgdmFyIGlmQ29uZGl0aW9uID0gZ2V0QW5kUmVtb3ZlQXR0cihlbCwgJ3YtaWYnLCB0cnVlKTsKICAgICAgICB2YXIgaWZDb25kaXRpb25FeHRyYSA9IGlmQ29uZGl0aW9uID8gKCImJigiICsgaWZDb25kaXRpb24gKyAiKSIpIDogIiI7CiAgICAgICAgdmFyIGhhc0Vsc2UgPSBnZXRBbmRSZW1vdmVBdHRyKGVsLCAndi1lbHNlJywgdHJ1ZSkgIT0gbnVsbDsKICAgICAgICB2YXIgZWxzZUlmQ29uZGl0aW9uID0gZ2V0QW5kUmVtb3ZlQXR0cihlbCwgJ3YtZWxzZS1pZicsIHRydWUpOwogICAgICAgIC8vIDEuIGNoZWNrYm94CiAgICAgICAgdmFyIGJyYW5jaDAgPSBjbG9uZUFTVEVsZW1lbnQoZWwpOwogICAgICAgIC8vIHByb2Nlc3MgZm9yIG9uIHRoZSBtYWluIG5vZGUKICAgICAgICBwcm9jZXNzRm9yKGJyYW5jaDApOwogICAgICAgIGFkZFJhd0F0dHIoYnJhbmNoMCwgJ3R5cGUnLCAnY2hlY2tib3gnKTsKICAgICAgICBwcm9jZXNzRWxlbWVudChicmFuY2gwLCBvcHRpb25zKTsKICAgICAgICBicmFuY2gwLnByb2Nlc3NlZCA9IHRydWU7IC8vIHByZXZlbnQgaXQgZnJvbSBkb3VibGUtcHJvY2Vzc2VkCiAgICAgICAgYnJhbmNoMC5pZiA9ICIoIiArIHR5cGVCaW5kaW5nICsgIik9PT0nY2hlY2tib3gnIiArIGlmQ29uZGl0aW9uRXh0cmE7CiAgICAgICAgYWRkSWZDb25kaXRpb24oYnJhbmNoMCwgewogICAgICAgICAgZXhwOiBicmFuY2gwLmlmLAogICAgICAgICAgYmxvY2s6IGJyYW5jaDAKICAgICAgICB9KTsKICAgICAgICAvLyAyLiBhZGQgcmFkaW8gZWxzZS1pZiBjb25kaXRpb24KICAgICAgICB2YXIgYnJhbmNoMSA9IGNsb25lQVNURWxlbWVudChlbCk7CiAgICAgICAgZ2V0QW5kUmVtb3ZlQXR0cihicmFuY2gxLCAndi1mb3InLCB0cnVlKTsKICAgICAgICBhZGRSYXdBdHRyKGJyYW5jaDEsICd0eXBlJywgJ3JhZGlvJyk7CiAgICAgICAgcHJvY2Vzc0VsZW1lbnQoYnJhbmNoMSwgb3B0aW9ucyk7CiAgICAgICAgYWRkSWZDb25kaXRpb24oYnJhbmNoMCwgewogICAgICAgICAgZXhwOiAiKCIgKyB0eXBlQmluZGluZyArICIpPT09J3JhZGlvJyIgKyBpZkNvbmRpdGlvbkV4dHJhLAogICAgICAgICAgYmxvY2s6IGJyYW5jaDEKICAgICAgICB9KTsKICAgICAgICAvLyAzLiBvdGhlcgogICAgICAgIHZhciBicmFuY2gyID0gY2xvbmVBU1RFbGVtZW50KGVsKTsKICAgICAgICBnZXRBbmRSZW1vdmVBdHRyKGJyYW5jaDIsICd2LWZvcicsIHRydWUpOwogICAgICAgIGFkZFJhd0F0dHIoYnJhbmNoMiwgJzp0eXBlJywgdHlwZUJpbmRpbmcpOwogICAgICAgIHByb2Nlc3NFbGVtZW50KGJyYW5jaDIsIG9wdGlvbnMpOwogICAgICAgIGFkZElmQ29uZGl0aW9uKGJyYW5jaDAsIHsKICAgICAgICAgIGV4cDogaWZDb25kaXRpb24sCiAgICAgICAgICBibG9jazogYnJhbmNoMgogICAgICAgIH0pOwoKICAgICAgICBpZiAoaGFzRWxzZSkgewogICAgICAgICAgYnJhbmNoMC5lbHNlID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKGVsc2VJZkNvbmRpdGlvbikgewogICAgICAgICAgYnJhbmNoMC5lbHNlaWYgPSBlbHNlSWZDb25kaXRpb247CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYnJhbmNoMAogICAgICB9CiAgICB9CiAgfQoKICBmdW5jdGlvbiBjbG9uZUFTVEVsZW1lbnQgKGVsKSB7CiAgICByZXR1cm4gY3JlYXRlQVNURWxlbWVudChlbC50YWcsIGVsLmF0dHJzTGlzdC5zbGljZSgpLCBlbC5wYXJlbnQpCiAgfQoKICB2YXIgbW9kZWwkMSA9IHsKICAgIHByZVRyYW5zZm9ybU5vZGU6IHByZVRyYW5zZm9ybU5vZGUKICB9OwoKICB2YXIgbW9kdWxlcyQxID0gWwogICAga2xhc3MkMSwKICAgIHN0eWxlJDEsCiAgICBtb2RlbCQxCiAgXTsKCiAgLyogICovCgogIGZ1bmN0aW9uIHRleHQgKGVsLCBkaXIpIHsKICAgIGlmIChkaXIudmFsdWUpIHsKICAgICAgYWRkUHJvcChlbCwgJ3RleHRDb250ZW50JywgKCJfcygiICsgKGRpci52YWx1ZSkgKyAiKSIpLCBkaXIpOwogICAgfQogIH0KCiAgLyogICovCgogIGZ1bmN0aW9uIGh0bWwgKGVsLCBkaXIpIHsKICAgIGlmIChkaXIudmFsdWUpIHsKICAgICAgYWRkUHJvcChlbCwgJ2lubmVySFRNTCcsICgiX3MoIiArIChkaXIudmFsdWUpICsgIikiKSwgZGlyKTsKICAgIH0KICB9CgogIHZhciBkaXJlY3RpdmVzJDEgPSB7CiAgICBtb2RlbDogbW9kZWwsCiAgICB0ZXh0OiB0ZXh0LAogICAgaHRtbDogaHRtbAogIH07CgogIC8qICAqLwoKICB2YXIgYmFzZU9wdGlvbnMgPSB7CiAgICBleHBlY3RIVE1MOiB0cnVlLAogICAgbW9kdWxlczogbW9kdWxlcyQxLAogICAgZGlyZWN0aXZlczogZGlyZWN0aXZlcyQxLAogICAgaXNQcmVUYWc6IGlzUHJlVGFnLAogICAgaXNVbmFyeVRhZzogaXNVbmFyeVRhZywKICAgIG11c3RVc2VQcm9wOiBtdXN0VXNlUHJvcCwKICAgIGNhbkJlTGVmdE9wZW5UYWc6IGNhbkJlTGVmdE9wZW5UYWcsCiAgICBpc1Jlc2VydmVkVGFnOiBpc1Jlc2VydmVkVGFnLAogICAgZ2V0VGFnTmFtZXNwYWNlOiBnZXRUYWdOYW1lc3BhY2UsCiAgICBzdGF0aWNLZXlzOiBnZW5TdGF0aWNLZXlzKG1vZHVsZXMkMSkKICB9OwoKICAvKiAgKi8KCiAgdmFyIGlzU3RhdGljS2V5OwogIHZhciBpc1BsYXRmb3JtUmVzZXJ2ZWRUYWc7CgogIHZhciBnZW5TdGF0aWNLZXlzQ2FjaGVkID0gY2FjaGVkKGdlblN0YXRpY0tleXMkMSk7CgogIC8qKgogICAqIEdvYWwgb2YgdGhlIG9wdGltaXplcjogd2FsayB0aGUgZ2VuZXJhdGVkIHRlbXBsYXRlIEFTVCB0cmVlCiAgICogYW5kIGRldGVjdCBzdWItdHJlZXMgdGhhdCBhcmUgcHVyZWx5IHN0YXRpYywgaS5lLiBwYXJ0cyBvZgogICAqIHRoZSBET00gdGhhdCBuZXZlciBuZWVkcyB0byBjaGFuZ2UuCiAgICoKICAgKiBPbmNlIHdlIGRldGVjdCB0aGVzZSBzdWItdHJlZXMsIHdlIGNhbjoKICAgKgogICAqIDEuIEhvaXN0IHRoZW0gaW50byBjb25zdGFudHMsIHNvIHRoYXQgd2Ugbm8gbG9uZ2VyIG5lZWQgdG8KICAgKiAgICBjcmVhdGUgZnJlc2ggbm9kZXMgZm9yIHRoZW0gb24gZWFjaCByZS1yZW5kZXI7CiAgICogMi4gQ29tcGxldGVseSBza2lwIHRoZW0gaW4gdGhlIHBhdGNoaW5nIHByb2Nlc3MuCiAgICovCiAgZnVuY3Rpb24gb3B0aW1pemUgKHJvb3QsIG9wdGlvbnMpIHsKICAgIGlmICghcm9vdCkgeyByZXR1cm4gfQogICAgaXNTdGF0aWNLZXkgPSBnZW5TdGF0aWNLZXlzQ2FjaGVkKG9wdGlvbnMuc3RhdGljS2V5cyB8fCAnJyk7CiAgICBpc1BsYXRmb3JtUmVzZXJ2ZWRUYWcgPSBvcHRpb25zLmlzUmVzZXJ2ZWRUYWcgfHwgbm87CiAgICAvLyBmaXJzdCBwYXNzOiBtYXJrIGFsbCBub24tc3RhdGljIG5vZGVzLgogICAgbWFya1N0YXRpYyQxKHJvb3QpOwogICAgLy8gc2Vjb25kIHBhc3M6IG1hcmsgc3RhdGljIHJvb3RzLgogICAgbWFya1N0YXRpY1Jvb3RzKHJvb3QsIGZhbHNlKTsKICB9CgogIGZ1bmN0aW9uIGdlblN0YXRpY0tleXMkMSAoa2V5cykgewogICAgcmV0dXJuIG1ha2VNYXAoCiAgICAgICd0eXBlLHRhZyxhdHRyc0xpc3QsYXR0cnNNYXAscGxhaW4scGFyZW50LGNoaWxkcmVuLGF0dHJzLHN0YXJ0LGVuZCxyYXdBdHRyc01hcCcgKwogICAgICAoa2V5cyA/ICcsJyArIGtleXMgOiAnJykKICAgICkKICB9CgogIGZ1bmN0aW9uIG1hcmtTdGF0aWMkMSAobm9kZSkgewogICAgbm9kZS5zdGF0aWMgPSBpc1N0YXRpYyhub2RlKTsKICAgIGlmIChub2RlLnR5cGUgPT09IDEpIHsKICAgICAgLy8gZG8gbm90IG1ha2UgY29tcG9uZW50IHNsb3QgY29udGVudCBzdGF0aWMuIHRoaXMgYXZvaWRzCiAgICAgIC8vIDEuIGNvbXBvbmVudHMgbm90IGFibGUgdG8gbXV0YXRlIHNsb3Qgbm9kZXMKICAgICAgLy8gMi4gc3RhdGljIHNsb3QgY29udGVudCBmYWlscyBmb3IgaG90LXJlbG9hZGluZwogICAgICBpZiAoCiAgICAgICAgIWlzUGxhdGZvcm1SZXNlcnZlZFRhZyhub2RlLnRhZykgJiYKICAgICAgICBub2RlLnRhZyAhPT0gJ3Nsb3QnICYmCiAgICAgICAgbm9kZS5hdHRyc01hcFsnaW5saW5lLXRlbXBsYXRlJ10gPT0gbnVsbAogICAgICApIHsKICAgICAgICByZXR1cm4KICAgICAgfQogICAgICBmb3IgKHZhciBpID0gMCwgbCA9IG5vZGUuY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgdmFyIGNoaWxkID0gbm9kZS5jaGlsZHJlbltpXTsKICAgICAgICBtYXJrU3RhdGljJDEoY2hpbGQpOwogICAgICAgIGlmICghY2hpbGQuc3RhdGljKSB7CiAgICAgICAgICBub2RlLnN0YXRpYyA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAobm9kZS5pZkNvbmRpdGlvbnMpIHsKICAgICAgICBmb3IgKHZhciBpJDEgPSAxLCBsJDEgPSBub2RlLmlmQ29uZGl0aW9ucy5sZW5ndGg7IGkkMSA8IGwkMTsgaSQxKyspIHsKICAgICAgICAgIHZhciBibG9jayA9IG5vZGUuaWZDb25kaXRpb25zW2kkMV0uYmxvY2s7CiAgICAgICAgICBtYXJrU3RhdGljJDEoYmxvY2spOwogICAgICAgICAgaWYgKCFibG9jay5zdGF0aWMpIHsKICAgICAgICAgICAgbm9kZS5zdGF0aWMgPSBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIG1hcmtTdGF0aWNSb290cyAobm9kZSwgaXNJbkZvcikgewogICAgaWYgKG5vZGUudHlwZSA9PT0gMSkgewogICAgICBpZiAobm9kZS5zdGF0aWMgfHwgbm9kZS5vbmNlKSB7CiAgICAgICAgbm9kZS5zdGF0aWNJbkZvciA9IGlzSW5Gb3I7CiAgICAgIH0KICAgICAgLy8gRm9yIGEgbm9kZSB0byBxdWFsaWZ5IGFzIGEgc3RhdGljIHJvb3QsIGl0IHNob3VsZCBoYXZlIGNoaWxkcmVuIHRoYXQKICAgICAgLy8gYXJlIG5vdCBqdXN0IHN0YXRpYyB0ZXh0LiBPdGhlcndpc2UgdGhlIGNvc3Qgb2YgaG9pc3Rpbmcgb3V0IHdpbGwKICAgICAgLy8gb3V0d2VpZ2ggdGhlIGJlbmVmaXRzIGFuZCBpdCdzIGJldHRlciBvZmYgdG8ganVzdCBhbHdheXMgcmVuZGVyIGl0IGZyZXNoLgogICAgICBpZiAobm9kZS5zdGF0aWMgJiYgbm9kZS5jaGlsZHJlbi5sZW5ndGggJiYgISgKICAgICAgICBub2RlLmNoaWxkcmVuLmxlbmd0aCA9PT0gMSAmJgogICAgICAgIG5vZGUuY2hpbGRyZW5bMF0udHlwZSA9PT0gMwogICAgICApKSB7CiAgICAgICAgbm9kZS5zdGF0aWNSb290ID0gdHJ1ZTsKICAgICAgICByZXR1cm4KICAgICAgfSBlbHNlIHsKICAgICAgICBub2RlLnN0YXRpY1Jvb3QgPSBmYWxzZTsKICAgICAgfQogICAgICBpZiAobm9kZS5jaGlsZHJlbikgewogICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gbm9kZS5jaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgIG1hcmtTdGF0aWNSb290cyhub2RlLmNoaWxkcmVuW2ldLCBpc0luRm9yIHx8ICEhbm9kZS5mb3IpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAobm9kZS5pZkNvbmRpdGlvbnMpIHsKICAgICAgICBmb3IgKHZhciBpJDEgPSAxLCBsJDEgPSBub2RlLmlmQ29uZGl0aW9ucy5sZW5ndGg7IGkkMSA8IGwkMTsgaSQxKyspIHsKICAgICAgICAgIG1hcmtTdGF0aWNSb290cyhub2RlLmlmQ29uZGl0aW9uc1tpJDFdLmJsb2NrLCBpc0luRm9yKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGlzU3RhdGljIChub2RlKSB7CiAgICBpZiAobm9kZS50eXBlID09PSAyKSB7IC8vIGV4cHJlc3Npb24KICAgICAgcmV0dXJuIGZhbHNlCiAgICB9CiAgICBpZiAobm9kZS50eXBlID09PSAzKSB7IC8vIHRleHQKICAgICAgcmV0dXJuIHRydWUKICAgIH0KICAgIHJldHVybiAhIShub2RlLnByZSB8fCAoCiAgICAgICFub2RlLmhhc0JpbmRpbmdzICYmIC8vIG5vIGR5bmFtaWMgYmluZGluZ3MKICAgICAgIW5vZGUuaWYgJiYgIW5vZGUuZm9yICYmIC8vIG5vdCB2LWlmIG9yIHYtZm9yIG9yIHYtZWxzZQogICAgICAhaXNCdWlsdEluVGFnKG5vZGUudGFnKSAmJiAvLyBub3QgYSBidWlsdC1pbgogICAgICBpc1BsYXRmb3JtUmVzZXJ2ZWRUYWcobm9kZS50YWcpICYmIC8vIG5vdCBhIGNvbXBvbmVudAogICAgICAhaXNEaXJlY3RDaGlsZE9mVGVtcGxhdGVGb3Iobm9kZSkgJiYKICAgICAgT2JqZWN0LmtleXMobm9kZSkuZXZlcnkoaXNTdGF0aWNLZXkpCiAgICApKQogIH0KCiAgZnVuY3Rpb24gaXNEaXJlY3RDaGlsZE9mVGVtcGxhdGVGb3IgKG5vZGUpIHsKICAgIHdoaWxlIChub2RlLnBhcmVudCkgewogICAgICBub2RlID0gbm9kZS5wYXJlbnQ7CiAgICAgIGlmIChub2RlLnRhZyAhPT0gJ3RlbXBsYXRlJykgewogICAgICAgIHJldHVybiBmYWxzZQogICAgICB9CiAgICAgIGlmIChub2RlLmZvcikgewogICAgICAgIHJldHVybiB0cnVlCiAgICAgIH0KICAgIH0KICAgIHJldHVybiBmYWxzZQogIH0KCiAgLyogICovCgogIHZhciBmbkV4cFJFID0gL14oW1x3JF9dK3xcKFteKV0qP1wpKVxzKj0+fF5mdW5jdGlvblxzKig/OltcdyRdKyk/XHMqXCgvOwogIHZhciBmbkludm9rZVJFID0gL1woW14pXSo/XCk7KiQvOwogIHZhciBzaW1wbGVQYXRoUkUgPSAvXltBLVphLXpfJF1bXHckXSooPzpcLltBLVphLXpfJF1bXHckXSp8XFsnW14nXSo/J118XFsiW14iXSo/Il18XFtcZCtdfFxbW0EtWmEtel8kXVtcdyRdKl0pKiQvOwoKICAvLyBLZXlib2FyZEV2ZW50LmtleUNvZGUgYWxpYXNlcwogIHZhciBrZXlDb2RlcyA9IHsKICAgIGVzYzogMjcsCiAgICB0YWI6IDksCiAgICBlbnRlcjogMTMsCiAgICBzcGFjZTogMzIsCiAgICB1cDogMzgsCiAgICBsZWZ0OiAzNywKICAgIHJpZ2h0OiAzOSwKICAgIGRvd246IDQwLAogICAgJ2RlbGV0ZSc6IFs4LCA0Nl0KICB9OwoKICAvLyBLZXlib2FyZEV2ZW50LmtleSBhbGlhc2VzCiAgdmFyIGtleU5hbWVzID0gewogICAgLy8gIzc4ODA6IElFMTEgYW5kIEVkZ2UgdXNlIGBFc2NgIGZvciBFc2NhcGUga2V5IG5hbWUuCiAgICBlc2M6IFsnRXNjJywgJ0VzY2FwZSddLAogICAgdGFiOiAnVGFiJywKICAgIGVudGVyOiAnRW50ZXInLAogICAgLy8gIzkxMTI6IElFMTEgdXNlcyBgU3BhY2ViYXJgIGZvciBTcGFjZSBrZXkgbmFtZS4KICAgIHNwYWNlOiBbJyAnLCAnU3BhY2ViYXInXSwKICAgIC8vICM3ODA2OiBJRTExIHVzZXMga2V5IG5hbWVzIHdpdGhvdXQgYEFycm93YCBwcmVmaXggZm9yIGFycm93IGtleXMuCiAgICB1cDogWydVcCcsICdBcnJvd1VwJ10sCiAgICBsZWZ0OiBbJ0xlZnQnLCAnQXJyb3dMZWZ0J10sCiAgICByaWdodDogWydSaWdodCcsICdBcnJvd1JpZ2h0J10sCiAgICBkb3duOiBbJ0Rvd24nLCAnQXJyb3dEb3duJ10sCiAgICAvLyAjOTExMjogSUUxMSB1c2VzIGBEZWxgIGZvciBEZWxldGUga2V5IG5hbWUuCiAgICAnZGVsZXRlJzogWydCYWNrc3BhY2UnLCAnRGVsZXRlJywgJ0RlbCddCiAgfTsKCiAgLy8gIzQ4Njg6IG1vZGlmaWVycyB0aGF0IHByZXZlbnQgdGhlIGV4ZWN1dGlvbiBvZiB0aGUgbGlzdGVuZXIKICAvLyBuZWVkIHRvIGV4cGxpY2l0bHkgcmV0dXJuIG51bGwgc28gdGhhdCB3ZSBjYW4gZGV0ZXJtaW5lIHdoZXRoZXIgdG8gcmVtb3ZlCiAgLy8gdGhlIGxpc3RlbmVyIGZvciAub25jZQogIHZhciBnZW5HdWFyZCA9IGZ1bmN0aW9uIChjb25kaXRpb24pIHsgcmV0dXJuICgiaWYoIiArIGNvbmRpdGlvbiArICIpcmV0dXJuIG51bGw7Iik7IH07CgogIHZhciBtb2RpZmllckNvZGUgPSB7CiAgICBzdG9wOiAnJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOycsCiAgICBwcmV2ZW50OiAnJGV2ZW50LnByZXZlbnREZWZhdWx0KCk7JywKICAgIHNlbGY6IGdlbkd1YXJkKCIkZXZlbnQudGFyZ2V0ICE9PSAkZXZlbnQuY3VycmVudFRhcmdldCIpLAogICAgY3RybDogZ2VuR3VhcmQoIiEkZXZlbnQuY3RybEtleSIpLAogICAgc2hpZnQ6IGdlbkd1YXJkKCIhJGV2ZW50LnNoaWZ0S2V5IiksCiAgICBhbHQ6IGdlbkd1YXJkKCIhJGV2ZW50LmFsdEtleSIpLAogICAgbWV0YTogZ2VuR3VhcmQoIiEkZXZlbnQubWV0YUtleSIpLAogICAgbGVmdDogZ2VuR3VhcmQoIididXR0b24nIGluICRldmVudCAmJiAkZXZlbnQuYnV0dG9uICE9PSAwIiksCiAgICBtaWRkbGU6IGdlbkd1YXJkKCInYnV0dG9uJyBpbiAkZXZlbnQgJiYgJGV2ZW50LmJ1dHRvbiAhPT0gMSIpLAogICAgcmlnaHQ6IGdlbkd1YXJkKCInYnV0dG9uJyBpbiAkZXZlbnQgJiYgJGV2ZW50LmJ1dHRvbiAhPT0gMiIpCiAgfTsKCiAgZnVuY3Rpb24gZ2VuSGFuZGxlcnMgKAogICAgZXZlbnRzLAogICAgaXNOYXRpdmUKICApIHsKICAgIHZhciBwcmVmaXggPSBpc05hdGl2ZSA/ICduYXRpdmVPbjonIDogJ29uOic7CiAgICB2YXIgc3RhdGljSGFuZGxlcnMgPSAiIjsKICAgIHZhciBkeW5hbWljSGFuZGxlcnMgPSAiIjsKICAgIGZvciAodmFyIG5hbWUgaW4gZXZlbnRzKSB7CiAgICAgIHZhciBoYW5kbGVyQ29kZSA9IGdlbkhhbmRsZXIoZXZlbnRzW25hbWVdKTsKICAgICAgaWYgKGV2ZW50c1tuYW1lXSAmJiBldmVudHNbbmFtZV0uZHluYW1pYykgewogICAgICAgIGR5bmFtaWNIYW5kbGVycyArPSBuYW1lICsgIiwiICsgaGFuZGxlckNvZGUgKyAiLCI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3RhdGljSGFuZGxlcnMgKz0gIlwiIiArIG5hbWUgKyAiXCI6IiArIGhhbmRsZXJDb2RlICsgIiwiOwogICAgICB9CiAgICB9CiAgICBzdGF0aWNIYW5kbGVycyA9ICJ7IiArIChzdGF0aWNIYW5kbGVycy5zbGljZSgwLCAtMSkpICsgIn0iOwogICAgaWYgKGR5bmFtaWNIYW5kbGVycykgewogICAgICByZXR1cm4gcHJlZml4ICsgIl9kKCIgKyBzdGF0aWNIYW5kbGVycyArICIsWyIgKyAoZHluYW1pY0hhbmRsZXJzLnNsaWNlKDAsIC0xKSkgKyAiXSkiCiAgICB9IGVsc2UgewogICAgICByZXR1cm4gcHJlZml4ICsgc3RhdGljSGFuZGxlcnMKICAgIH0KICB9CgogIGZ1bmN0aW9uIGdlbkhhbmRsZXIgKGhhbmRsZXIpIHsKICAgIGlmICghaGFuZGxlcikgewogICAgICByZXR1cm4gJ2Z1bmN0aW9uKCl7fScKICAgIH0KCiAgICBpZiAoQXJyYXkuaXNBcnJheShoYW5kbGVyKSkgewogICAgICByZXR1cm4gKCJbIiArIChoYW5kbGVyLm1hcChmdW5jdGlvbiAoaGFuZGxlcikgeyByZXR1cm4gZ2VuSGFuZGxlcihoYW5kbGVyKTsgfSkuam9pbignLCcpKSArICJdIikKICAgIH0KCiAgICB2YXIgaXNNZXRob2RQYXRoID0gc2ltcGxlUGF0aFJFLnRlc3QoaGFuZGxlci52YWx1ZSk7CiAgICB2YXIgaXNGdW5jdGlvbkV4cHJlc3Npb24gPSBmbkV4cFJFLnRlc3QoaGFuZGxlci52YWx1ZSk7CiAgICB2YXIgaXNGdW5jdGlvbkludm9jYXRpb24gPSBzaW1wbGVQYXRoUkUudGVzdChoYW5kbGVyLnZhbHVlLnJlcGxhY2UoZm5JbnZva2VSRSwgJycpKTsKCiAgICBpZiAoIWhhbmRsZXIubW9kaWZpZXJzKSB7CiAgICAgIGlmIChpc01ldGhvZFBhdGggfHwgaXNGdW5jdGlvbkV4cHJlc3Npb24pIHsKICAgICAgICByZXR1cm4gaGFuZGxlci52YWx1ZQogICAgICB9CiAgICAgIHJldHVybiAoImZ1bmN0aW9uKCRldmVudCl7IiArIChpc0Z1bmN0aW9uSW52b2NhdGlvbiA/ICgicmV0dXJuICIgKyAoaGFuZGxlci52YWx1ZSkpIDogaGFuZGxlci52YWx1ZSkgKyAifSIpIC8vIGlubGluZSBzdGF0ZW1lbnQKICAgIH0gZWxzZSB7CiAgICAgIHZhciBjb2RlID0gJyc7CiAgICAgIHZhciBnZW5Nb2RpZmllckNvZGUgPSAnJzsKICAgICAgdmFyIGtleXMgPSBbXTsKICAgICAgZm9yICh2YXIga2V5IGluIGhhbmRsZXIubW9kaWZpZXJzKSB7CiAgICAgICAgaWYgKG1vZGlmaWVyQ29kZVtrZXldKSB7CiAgICAgICAgICBnZW5Nb2RpZmllckNvZGUgKz0gbW9kaWZpZXJDb2RlW2tleV07CiAgICAgICAgICAvLyBsZWZ0L3JpZ2h0CiAgICAgICAgICBpZiAoa2V5Q29kZXNba2V5XSkgewogICAgICAgICAgICBrZXlzLnB1c2goa2V5KTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGtleSA9PT0gJ2V4YWN0JykgewogICAgICAgICAgdmFyIG1vZGlmaWVycyA9IChoYW5kbGVyLm1vZGlmaWVycyk7CiAgICAgICAgICBnZW5Nb2RpZmllckNvZGUgKz0gZ2VuR3VhcmQoCiAgICAgICAgICAgIFsnY3RybCcsICdzaGlmdCcsICdhbHQnLCAnbWV0YSddCiAgICAgICAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAoa2V5TW9kaWZpZXIpIHsgcmV0dXJuICFtb2RpZmllcnNba2V5TW9kaWZpZXJdOyB9KQogICAgICAgICAgICAgIC5tYXAoZnVuY3Rpb24gKGtleU1vZGlmaWVyKSB7IHJldHVybiAoIiRldmVudC4iICsga2V5TW9kaWZpZXIgKyAiS2V5Iik7IH0pCiAgICAgICAgICAgICAgLmpvaW4oJ3x8JykKICAgICAgICAgICk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGtleXMucHVzaChrZXkpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoa2V5cy5sZW5ndGgpIHsKICAgICAgICBjb2RlICs9IGdlbktleUZpbHRlcihrZXlzKTsKICAgICAgfQogICAgICAvLyBNYWtlIHN1cmUgbW9kaWZpZXJzIGxpa2UgcHJldmVudCBhbmQgc3RvcCBnZXQgZXhlY3V0ZWQgYWZ0ZXIga2V5IGZpbHRlcmluZwogICAgICBpZiAoZ2VuTW9kaWZpZXJDb2RlKSB7CiAgICAgICAgY29kZSArPSBnZW5Nb2RpZmllckNvZGU7CiAgICAgIH0KICAgICAgdmFyIGhhbmRsZXJDb2RlID0gaXNNZXRob2RQYXRoCiAgICAgICAgPyAoInJldHVybiAiICsgKGhhbmRsZXIudmFsdWUpICsgIigkZXZlbnQpIikKICAgICAgICA6IGlzRnVuY3Rpb25FeHByZXNzaW9uCiAgICAgICAgICA/ICgicmV0dXJuICgiICsgKGhhbmRsZXIudmFsdWUpICsgIikoJGV2ZW50KSIpCiAgICAgICAgICA6IGlzRnVuY3Rpb25JbnZvY2F0aW9uCiAgICAgICAgICAgID8gKCJyZXR1cm4gIiArIChoYW5kbGVyLnZhbHVlKSkKICAgICAgICAgICAgOiBoYW5kbGVyLnZhbHVlOwogICAgICByZXR1cm4gKCJmdW5jdGlvbigkZXZlbnQpeyIgKyBjb2RlICsgaGFuZGxlckNvZGUgKyAifSIpCiAgICB9CiAgfQoKICBmdW5jdGlvbiBnZW5LZXlGaWx0ZXIgKGtleXMpIHsKICAgIHJldHVybiAoCiAgICAgIC8vIG1ha2Ugc3VyZSB0aGUga2V5IGZpbHRlcnMgb25seSBhcHBseSB0byBLZXlib2FyZEV2ZW50cwogICAgICAvLyAjOTQ0MTogY2FuJ3QgdXNlICdrZXlDb2RlJyBpbiAkZXZlbnQgYmVjYXVzZSBDaHJvbWUgYXV0b2ZpbGwgZmlyZXMgZmFrZQogICAgICAvLyBrZXkgZXZlbnRzIHRoYXQgZG8gbm90IGhhdmUga2V5Q29kZSBwcm9wZXJ0eS4uLgogICAgICAiaWYoISRldmVudC50eXBlLmluZGV4T2YoJ2tleScpJiYiICsKICAgICAgKGtleXMubWFwKGdlbkZpbHRlckNvZGUpLmpvaW4oJyYmJykpICsgIilyZXR1cm4gbnVsbDsiCiAgICApCiAgfQoKICBmdW5jdGlvbiBnZW5GaWx0ZXJDb2RlIChrZXkpIHsKICAgIHZhciBrZXlWYWwgPSBwYXJzZUludChrZXksIDEwKTsKICAgIGlmIChrZXlWYWwpIHsKICAgICAgcmV0dXJuICgiJGV2ZW50LmtleUNvZGUhPT0iICsga2V5VmFsKQogICAgfQogICAgdmFyIGtleUNvZGUgPSBrZXlDb2Rlc1trZXldOwogICAgdmFyIGtleU5hbWUgPSBrZXlOYW1lc1trZXldOwogICAgcmV0dXJuICgKICAgICAgIl9rKCRldmVudC5rZXlDb2RlLCIgKwogICAgICAoSlNPTi5zdHJpbmdpZnkoa2V5KSkgKyAiLCIgKwogICAgICAoSlNPTi5zdHJpbmdpZnkoa2V5Q29kZSkpICsgIiwiICsKICAgICAgIiRldmVudC5rZXksIiArCiAgICAgICIiICsgKEpTT04uc3RyaW5naWZ5KGtleU5hbWUpKSArCiAgICAgICIpIgogICAgKQogIH0KCiAgLyogICovCgogIGZ1bmN0aW9uIG9uIChlbCwgZGlyKSB7CiAgICBpZiAoZGlyLm1vZGlmaWVycykgewogICAgICB3YXJuKCJ2LW9uIHdpdGhvdXQgYXJndW1lbnQgZG9lcyBub3Qgc3VwcG9ydCBtb2RpZmllcnMuIik7CiAgICB9CiAgICBlbC53cmFwTGlzdGVuZXJzID0gZnVuY3Rpb24gKGNvZGUpIHsgcmV0dXJuICgiX2coIiArIGNvZGUgKyAiLCIgKyAoZGlyLnZhbHVlKSArICIpIik7IH07CiAgfQoKICAvKiAgKi8KCiAgZnVuY3Rpb24gYmluZCQxIChlbCwgZGlyKSB7CiAgICBlbC53cmFwRGF0YSA9IGZ1bmN0aW9uIChjb2RlKSB7CiAgICAgIHJldHVybiAoIl9iKCIgKyBjb2RlICsgIiwnIiArIChlbC50YWcpICsgIicsIiArIChkaXIudmFsdWUpICsgIiwiICsgKGRpci5tb2RpZmllcnMgJiYgZGlyLm1vZGlmaWVycy5wcm9wID8gJ3RydWUnIDogJ2ZhbHNlJykgKyAoZGlyLm1vZGlmaWVycyAmJiBkaXIubW9kaWZpZXJzLnN5bmMgPyAnLHRydWUnIDogJycpICsgIikiKQogICAgfTsKICB9CgogIC8qICAqLwoKICB2YXIgYmFzZURpcmVjdGl2ZXMgPSB7CiAgICBvbjogb24sCiAgICBiaW5kOiBiaW5kJDEsCiAgICBjbG9hazogbm9vcAogIH07CgogIC8qICAqLwoKCgoKCiAgdmFyIENvZGVnZW5TdGF0ZSA9IGZ1bmN0aW9uIENvZGVnZW5TdGF0ZSAob3B0aW9ucykgewogICAgdGhpcy5vcHRpb25zID0gb3B0aW9uczsKICAgIHRoaXMud2FybiA9IG9wdGlvbnMud2FybiB8fCBiYXNlV2FybjsKICAgIHRoaXMudHJhbnNmb3JtcyA9IHBsdWNrTW9kdWxlRnVuY3Rpb24ob3B0aW9ucy5tb2R1bGVzLCAndHJhbnNmb3JtQ29kZScpOwogICAgdGhpcy5kYXRhR2VuRm5zID0gcGx1Y2tNb2R1bGVGdW5jdGlvbihvcHRpb25zLm1vZHVsZXMsICdnZW5EYXRhJyk7CiAgICB0aGlzLmRpcmVjdGl2ZXMgPSBleHRlbmQoZXh0ZW5kKHt9LCBiYXNlRGlyZWN0aXZlcyksIG9wdGlvbnMuZGlyZWN0aXZlcyk7CiAgICB2YXIgaXNSZXNlcnZlZFRhZyA9IG9wdGlvbnMuaXNSZXNlcnZlZFRhZyB8fCBubzsKICAgIHRoaXMubWF5YmVDb21wb25lbnQgPSBmdW5jdGlvbiAoZWwpIHsgcmV0dXJuICEhZWwuY29tcG9uZW50IHx8ICFpc1Jlc2VydmVkVGFnKGVsLnRhZyk7IH07CiAgICB0aGlzLm9uY2VJZCA9IDA7CiAgICB0aGlzLnN0YXRpY1JlbmRlckZucyA9IFtdOwogICAgdGhpcy5wcmUgPSBmYWxzZTsKICB9OwoKCgogIGZ1bmN0aW9uIGdlbmVyYXRlICgKICAgIGFzdCwKICAgIG9wdGlvbnMKICApIHsKICAgIHZhciBzdGF0ZSA9IG5ldyBDb2RlZ2VuU3RhdGUob3B0aW9ucyk7CiAgICB2YXIgY29kZSA9IGFzdCA/IGdlbkVsZW1lbnQoYXN0LCBzdGF0ZSkgOiAnX2MoImRpdiIpJzsKICAgIHJldHVybiB7CiAgICAgIHJlbmRlcjogKCJ3aXRoKHRoaXMpe3JldHVybiAiICsgY29kZSArICJ9IiksCiAgICAgIHN0YXRpY1JlbmRlckZuczogc3RhdGUuc3RhdGljUmVuZGVyRm5zCiAgICB9CiAgfQoKICBmdW5jdGlvbiBnZW5FbGVtZW50IChlbCwgc3RhdGUpIHsKICAgIGlmIChlbC5wYXJlbnQpIHsKICAgICAgZWwucHJlID0gZWwucHJlIHx8IGVsLnBhcmVudC5wcmU7CiAgICB9CgogICAgaWYgKGVsLnN0YXRpY1Jvb3QgJiYgIWVsLnN0YXRpY1Byb2Nlc3NlZCkgewogICAgICByZXR1cm4gZ2VuU3RhdGljKGVsLCBzdGF0ZSkKICAgIH0gZWxzZSBpZiAoZWwub25jZSAmJiAhZWwub25jZVByb2Nlc3NlZCkgewogICAgICByZXR1cm4gZ2VuT25jZShlbCwgc3RhdGUpCiAgICB9IGVsc2UgaWYgKGVsLmZvciAmJiAhZWwuZm9yUHJvY2Vzc2VkKSB7CiAgICAgIHJldHVybiBnZW5Gb3IoZWwsIHN0YXRlKQogICAgfSBlbHNlIGlmIChlbC5pZiAmJiAhZWwuaWZQcm9jZXNzZWQpIHsKICAgICAgcmV0dXJuIGdlbklmKGVsLCBzdGF0ZSkKICAgIH0gZWxzZSBpZiAoZWwudGFnID09PSAndGVtcGxhdGUnICYmICFlbC5zbG90VGFyZ2V0ICYmICFzdGF0ZS5wcmUpIHsKICAgICAgcmV0dXJuIGdlbkNoaWxkcmVuKGVsLCBzdGF0ZSkgfHwgJ3ZvaWQgMCcKICAgIH0gZWxzZSBpZiAoZWwudGFnID09PSAnc2xvdCcpIHsKICAgICAgcmV0dXJuIGdlblNsb3QoZWwsIHN0YXRlKQogICAgfSBlbHNlIHsKICAgICAgLy8gY29tcG9uZW50IG9yIGVsZW1lbnQKICAgICAgdmFyIGNvZGU7CiAgICAgIGlmIChlbC5jb21wb25lbnQpIHsKICAgICAgICBjb2RlID0gZ2VuQ29tcG9uZW50KGVsLmNvbXBvbmVudCwgZWwsIHN0YXRlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgZGF0YTsKICAgICAgICBpZiAoIWVsLnBsYWluIHx8IChlbC5wcmUgJiYgc3RhdGUubWF5YmVDb21wb25lbnQoZWwpKSkgewogICAgICAgICAgZGF0YSA9IGdlbkRhdGEkMihlbCwgc3RhdGUpOwogICAgICAgIH0KCiAgICAgICAgdmFyIGNoaWxkcmVuID0gZWwuaW5saW5lVGVtcGxhdGUgPyBudWxsIDogZ2VuQ2hpbGRyZW4oZWwsIHN0YXRlLCB0cnVlKTsKICAgICAgICBjb2RlID0gIl9jKCciICsgKGVsLnRhZykgKyAiJyIgKyAoZGF0YSA/ICgiLCIgKyBkYXRhKSA6ICcnKSArIChjaGlsZHJlbiA/ICgiLCIgKyBjaGlsZHJlbikgOiAnJykgKyAiKSI7CiAgICAgIH0KICAgICAgLy8gbW9kdWxlIHRyYW5zZm9ybXMKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdGF0ZS50cmFuc2Zvcm1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29kZSA9IHN0YXRlLnRyYW5zZm9ybXNbaV0oZWwsIGNvZGUpOwogICAgICB9CiAgICAgIHJldHVybiBjb2RlCiAgICB9CiAgfQoKICAvLyBob2lzdCBzdGF0aWMgc3ViLXRyZWVzIG91dAogIGZ1bmN0aW9uIGdlblN0YXRpYyAoZWwsIHN0YXRlKSB7CiAgICBlbC5zdGF0aWNQcm9jZXNzZWQgPSB0cnVlOwogICAgLy8gU29tZSBlbGVtZW50cyAodGVtcGxhdGVzKSBuZWVkIHRvIGJlaGF2ZSBkaWZmZXJlbnRseSBpbnNpZGUgb2YgYSB2LXByZQogICAgLy8gbm9kZS4gIEFsbCBwcmUgbm9kZXMgYXJlIHN0YXRpYyByb290cywgc28gd2UgY2FuIHVzZSB0aGlzIGFzIGEgbG9jYXRpb24gdG8KICAgIC8vIHdyYXAgYSBzdGF0ZSBjaGFuZ2UgYW5kIHJlc2V0IGl0IHVwb24gZXhpdGluZyB0aGUgcHJlIG5vZGUuCiAgICB2YXIgb3JpZ2luYWxQcmVTdGF0ZSA9IHN0YXRlLnByZTsKICAgIGlmIChlbC5wcmUpIHsKICAgICAgc3RhdGUucHJlID0gZWwucHJlOwogICAgfQogICAgc3RhdGUuc3RhdGljUmVuZGVyRm5zLnB1c2goKCJ3aXRoKHRoaXMpe3JldHVybiAiICsgKGdlbkVsZW1lbnQoZWwsIHN0YXRlKSkgKyAifSIpKTsKICAgIHN0YXRlLnByZSA9IG9yaWdpbmFsUHJlU3RhdGU7CiAgICByZXR1cm4gKCJfbSgiICsgKHN0YXRlLnN0YXRpY1JlbmRlckZucy5sZW5ndGggLSAxKSArIChlbC5zdGF0aWNJbkZvciA/ICcsdHJ1ZScgOiAnJykgKyAiKSIpCiAgfQoKICAvLyB2LW9uY2UKICBmdW5jdGlvbiBnZW5PbmNlIChlbCwgc3RhdGUpIHsKICAgIGVsLm9uY2VQcm9jZXNzZWQgPSB0cnVlOwogICAgaWYgKGVsLmlmICYmICFlbC5pZlByb2Nlc3NlZCkgewogICAgICByZXR1cm4gZ2VuSWYoZWwsIHN0YXRlKQogICAgfSBlbHNlIGlmIChlbC5zdGF0aWNJbkZvcikgewogICAgICB2YXIga2V5ID0gJyc7CiAgICAgIHZhciBwYXJlbnQgPSBlbC5wYXJlbnQ7CiAgICAgIHdoaWxlIChwYXJlbnQpIHsKICAgICAgICBpZiAocGFyZW50LmZvcikgewogICAgICAgICAga2V5ID0gcGFyZW50LmtleTsKICAgICAgICAgIGJyZWFrCiAgICAgICAgfQogICAgICAgIHBhcmVudCA9IHBhcmVudC5wYXJlbnQ7CiAgICAgIH0KICAgICAgaWYgKCFrZXkpIHsKICAgICAgICBzdGF0ZS53YXJuKAogICAgICAgICAgInYtb25jZSBjYW4gb25seSBiZSB1c2VkIGluc2lkZSB2LWZvciB0aGF0IGlzIGtleWVkLiAiLAogICAgICAgICAgZWwucmF3QXR0cnNNYXBbJ3Ytb25jZSddCiAgICAgICAgKTsKICAgICAgICByZXR1cm4gZ2VuRWxlbWVudChlbCwgc3RhdGUpCiAgICAgIH0KICAgICAgcmV0dXJuICgiX28oIiArIChnZW5FbGVtZW50KGVsLCBzdGF0ZSkpICsgIiwiICsgKHN0YXRlLm9uY2VJZCsrKSArICIsIiArIGtleSArICIpIikKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBnZW5TdGF0aWMoZWwsIHN0YXRlKQogICAgfQogIH0KCiAgZnVuY3Rpb24gZ2VuSWYgKAogICAgZWwsCiAgICBzdGF0ZSwKICAgIGFsdEdlbiwKICAgIGFsdEVtcHR5CiAgKSB7CiAgICBlbC5pZlByb2Nlc3NlZCA9IHRydWU7IC8vIGF2b2lkIHJlY3Vyc2lvbgogICAgcmV0dXJuIGdlbklmQ29uZGl0aW9ucyhlbC5pZkNvbmRpdGlvbnMuc2xpY2UoKSwgc3RhdGUsIGFsdEdlbiwgYWx0RW1wdHkpCiAgfQoKICBmdW5jdGlvbiBnZW5JZkNvbmRpdGlvbnMgKAogICAgY29uZGl0aW9ucywKICAgIHN0YXRlLAogICAgYWx0R2VuLAogICAgYWx0RW1wdHkKICApIHsKICAgIGlmICghY29uZGl0aW9ucy5sZW5ndGgpIHsKICAgICAgcmV0dXJuIGFsdEVtcHR5IHx8ICdfZSgpJwogICAgfQoKICAgIHZhciBjb25kaXRpb24gPSBjb25kaXRpb25zLnNoaWZ0KCk7CiAgICBpZiAoY29uZGl0aW9uLmV4cCkgewogICAgICByZXR1cm4gKCIoIiArIChjb25kaXRpb24uZXhwKSArICIpPyIgKyAoZ2VuVGVybmFyeUV4cChjb25kaXRpb24uYmxvY2spKSArICI6IiArIChnZW5JZkNvbmRpdGlvbnMoY29uZGl0aW9ucywgc3RhdGUsIGFsdEdlbiwgYWx0RW1wdHkpKSkKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiAoIiIgKyAoZ2VuVGVybmFyeUV4cChjb25kaXRpb24uYmxvY2spKSkKICAgIH0KCiAgICAvLyB2LWlmIHdpdGggdi1vbmNlIHNob3VsZCBnZW5lcmF0ZSBjb2RlIGxpa2UgKGEpP19tKDApOl9tKDEpCiAgICBmdW5jdGlvbiBnZW5UZXJuYXJ5RXhwIChlbCkgewogICAgICByZXR1cm4gYWx0R2VuCiAgICAgICAgPyBhbHRHZW4oZWwsIHN0YXRlKQogICAgICAgIDogZWwub25jZQogICAgICAgICAgPyBnZW5PbmNlKGVsLCBzdGF0ZSkKICAgICAgICAgIDogZ2VuRWxlbWVudChlbCwgc3RhdGUpCiAgICB9CiAgfQoKICBmdW5jdGlvbiBnZW5Gb3IgKAogICAgZWwsCiAgICBzdGF0ZSwKICAgIGFsdEdlbiwKICAgIGFsdEhlbHBlcgogICkgewogICAgdmFyIGV4cCA9IGVsLmZvcjsKICAgIHZhciBhbGlhcyA9IGVsLmFsaWFzOwogICAgdmFyIGl0ZXJhdG9yMSA9IGVsLml0ZXJhdG9yMSA/ICgiLCIgKyAoZWwuaXRlcmF0b3IxKSkgOiAnJzsKICAgIHZhciBpdGVyYXRvcjIgPSBlbC5pdGVyYXRvcjIgPyAoIiwiICsgKGVsLml0ZXJhdG9yMikpIDogJyc7CgogICAgaWYgKHN0YXRlLm1heWJlQ29tcG9uZW50KGVsKSAmJgogICAgICBlbC50YWcgIT09ICdzbG90JyAmJgogICAgICBlbC50YWcgIT09ICd0ZW1wbGF0ZScgJiYKICAgICAgIWVsLmtleQogICAgKSB7CiAgICAgIHN0YXRlLndhcm4oCiAgICAgICAgIjwiICsgKGVsLnRhZykgKyAiIHYtZm9yPVwiIiArIGFsaWFzICsgIiBpbiAiICsgZXhwICsgIlwiPjogY29tcG9uZW50IGxpc3RzIHJlbmRlcmVkIHdpdGggIiArCiAgICAgICAgInYtZm9yIHNob3VsZCBoYXZlIGV4cGxpY2l0IGtleXMuICIgKwogICAgICAgICJTZWUgaHR0cHM6Ly92dWVqcy5vcmcvZ3VpZGUvbGlzdC5odG1sI2tleSBmb3IgbW9yZSBpbmZvLiIsCiAgICAgICAgZWwucmF3QXR0cnNNYXBbJ3YtZm9yJ10sCiAgICAgICAgdHJ1ZSAvKiB0aXAgKi8KICAgICAgKTsKICAgIH0KCiAgICBlbC5mb3JQcm9jZXNzZWQgPSB0cnVlOyAvLyBhdm9pZCByZWN1cnNpb24KICAgIHJldHVybiAoYWx0SGVscGVyIHx8ICdfbCcpICsgIigoIiArIGV4cCArICIpLCIgKwogICAgICAiZnVuY3Rpb24oIiArIGFsaWFzICsgaXRlcmF0b3IxICsgaXRlcmF0b3IyICsgIil7IiArCiAgICAgICAgInJldHVybiAiICsgKChhbHRHZW4gfHwgZ2VuRWxlbWVudCkoZWwsIHN0YXRlKSkgKwogICAgICAnfSknCiAgfQoKICBmdW5jdGlvbiBnZW5EYXRhJDIgKGVsLCBzdGF0ZSkgewogICAgdmFyIGRhdGEgPSAneyc7CgogICAgLy8gZGlyZWN0aXZlcyBmaXJzdC4KICAgIC8vIGRpcmVjdGl2ZXMgbWF5IG11dGF0ZSB0aGUgZWwncyBvdGhlciBwcm9wZXJ0aWVzIGJlZm9yZSB0aGV5IGFyZSBnZW5lcmF0ZWQuCiAgICB2YXIgZGlycyA9IGdlbkRpcmVjdGl2ZXMoZWwsIHN0YXRlKTsKICAgIGlmIChkaXJzKSB7IGRhdGEgKz0gZGlycyArICcsJzsgfQoKICAgIC8vIGtleQogICAgaWYgKGVsLmtleSkgewogICAgICBkYXRhICs9ICJrZXk6IiArIChlbC5rZXkpICsgIiwiOwogICAgfQogICAgLy8gcmVmCiAgICBpZiAoZWwucmVmKSB7CiAgICAgIGRhdGEgKz0gInJlZjoiICsgKGVsLnJlZikgKyAiLCI7CiAgICB9CiAgICBpZiAoZWwucmVmSW5Gb3IpIHsKICAgICAgZGF0YSArPSAicmVmSW5Gb3I6dHJ1ZSwiOwogICAgfQogICAgLy8gcHJlCiAgICBpZiAoZWwucHJlKSB7CiAgICAgIGRhdGEgKz0gInByZTp0cnVlLCI7CiAgICB9CiAgICAvLyByZWNvcmQgb3JpZ2luYWwgdGFnIG5hbWUgZm9yIGNvbXBvbmVudHMgdXNpbmcgImlzIiBhdHRyaWJ1dGUKICAgIGlmIChlbC5jb21wb25lbnQpIHsKICAgICAgZGF0YSArPSAidGFnOlwiIiArIChlbC50YWcpICsgIlwiLCI7CiAgICB9CiAgICAvLyBtb2R1bGUgZGF0YSBnZW5lcmF0aW9uIGZ1bmN0aW9ucwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdGF0ZS5kYXRhR2VuRm5zLmxlbmd0aDsgaSsrKSB7CiAgICAgIGRhdGEgKz0gc3RhdGUuZGF0YUdlbkZuc1tpXShlbCk7CiAgICB9CiAgICAvLyBhdHRyaWJ1dGVzCiAgICBpZiAoZWwuYXR0cnMpIHsKICAgICAgZGF0YSArPSAiYXR0cnM6IiArIChnZW5Qcm9wcyhlbC5hdHRycykpICsgIiwiOwogICAgfQogICAgLy8gRE9NIHByb3BzCiAgICBpZiAoZWwucHJvcHMpIHsKICAgICAgZGF0YSArPSAiZG9tUHJvcHM6IiArIChnZW5Qcm9wcyhlbC5wcm9wcykpICsgIiwiOwogICAgfQogICAgLy8gZXZlbnQgaGFuZGxlcnMKICAgIGlmIChlbC5ldmVudHMpIHsKICAgICAgZGF0YSArPSAoZ2VuSGFuZGxlcnMoZWwuZXZlbnRzLCBmYWxzZSkpICsgIiwiOwogICAgfQogICAgaWYgKGVsLm5hdGl2ZUV2ZW50cykgewogICAgICBkYXRhICs9IChnZW5IYW5kbGVycyhlbC5uYXRpdmVFdmVudHMsIHRydWUpKSArICIsIjsKICAgIH0KICAgIC8vIHNsb3QgdGFyZ2V0CiAgICAvLyBvbmx5IGZvciBub24tc2NvcGVkIHNsb3RzCiAgICBpZiAoZWwuc2xvdFRhcmdldCAmJiAhZWwuc2xvdFNjb3BlKSB7CiAgICAgIGRhdGEgKz0gInNsb3Q6IiArIChlbC5zbG90VGFyZ2V0KSArICIsIjsKICAgIH0KICAgIC8vIHNjb3BlZCBzbG90cwogICAgaWYgKGVsLnNjb3BlZFNsb3RzKSB7CiAgICAgIGRhdGEgKz0gKGdlblNjb3BlZFNsb3RzKGVsLCBlbC5zY29wZWRTbG90cywgc3RhdGUpKSArICIsIjsKICAgIH0KICAgIC8vIGNvbXBvbmVudCB2LW1vZGVsCiAgICBpZiAoZWwubW9kZWwpIHsKICAgICAgZGF0YSArPSAibW9kZWw6e3ZhbHVlOiIgKyAoZWwubW9kZWwudmFsdWUpICsgIixjYWxsYmFjazoiICsgKGVsLm1vZGVsLmNhbGxiYWNrKSArICIsZXhwcmVzc2lvbjoiICsgKGVsLm1vZGVsLmV4cHJlc3Npb24pICsgIn0sIjsKICAgIH0KICAgIC8vIGlubGluZS10ZW1wbGF0ZQogICAgaWYgKGVsLmlubGluZVRlbXBsYXRlKSB7CiAgICAgIHZhciBpbmxpbmVUZW1wbGF0ZSA9IGdlbklubGluZVRlbXBsYXRlKGVsLCBzdGF0ZSk7CiAgICAgIGlmIChpbmxpbmVUZW1wbGF0ZSkgewogICAgICAgIGRhdGEgKz0gaW5saW5lVGVtcGxhdGUgKyAiLCI7CiAgICAgIH0KICAgIH0KICAgIGRhdGEgPSBkYXRhLnJlcGxhY2UoLywkLywgJycpICsgJ30nOwogICAgLy8gdi1iaW5kIGR5bmFtaWMgYXJndW1lbnQgd3JhcAogICAgLy8gdi1iaW5kIHdpdGggZHluYW1pYyBhcmd1bWVudHMgbXVzdCBiZSBhcHBsaWVkIHVzaW5nIHRoZSBzYW1lIHYtYmluZCBvYmplY3QKICAgIC8vIG1lcmdlIGhlbHBlciBzbyB0aGF0IGNsYXNzL3N0eWxlL211c3RVc2VQcm9wIGF0dHJzIGFyZSBoYW5kbGVkIGNvcnJlY3RseS4KICAgIGlmIChlbC5keW5hbWljQXR0cnMpIHsKICAgICAgZGF0YSA9ICJfYigiICsgZGF0YSArICIsXCIiICsgKGVsLnRhZykgKyAiXCIsIiArIChnZW5Qcm9wcyhlbC5keW5hbWljQXR0cnMpKSArICIpIjsKICAgIH0KICAgIC8vIHYtYmluZCBkYXRhIHdyYXAKICAgIGlmIChlbC53cmFwRGF0YSkgewogICAgICBkYXRhID0gZWwud3JhcERhdGEoZGF0YSk7CiAgICB9CiAgICAvLyB2LW9uIGRhdGEgd3JhcAogICAgaWYgKGVsLndyYXBMaXN0ZW5lcnMpIHsKICAgICAgZGF0YSA9IGVsLndyYXBMaXN0ZW5lcnMoZGF0YSk7CiAgICB9CiAgICByZXR1cm4gZGF0YQogIH0KCiAgZnVuY3Rpb24gZ2VuRGlyZWN0aXZlcyAoZWwsIHN0YXRlKSB7CiAgICB2YXIgZGlycyA9IGVsLmRpcmVjdGl2ZXM7CiAgICBpZiAoIWRpcnMpIHsgcmV0dXJuIH0KICAgIHZhciByZXMgPSAnZGlyZWN0aXZlczpbJzsKICAgIHZhciBoYXNSdW50aW1lID0gZmFsc2U7CiAgICB2YXIgaSwgbCwgZGlyLCBuZWVkUnVudGltZTsKICAgIGZvciAoaSA9IDAsIGwgPSBkaXJzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICBkaXIgPSBkaXJzW2ldOwogICAgICBuZWVkUnVudGltZSA9IHRydWU7CiAgICAgIHZhciBnZW4gPSBzdGF0ZS5kaXJlY3RpdmVzW2Rpci5uYW1lXTsKICAgICAgaWYgKGdlbikgewogICAgICAgIC8vIGNvbXBpbGUtdGltZSBkaXJlY3RpdmUgdGhhdCBtYW5pcHVsYXRlcyBBU1QuCiAgICAgICAgLy8gcmV0dXJucyB0cnVlIGlmIGl0IGFsc28gbmVlZHMgYSBydW50aW1lIGNvdW50ZXJwYXJ0LgogICAgICAgIG5lZWRSdW50aW1lID0gISFnZW4oZWwsIGRpciwgc3RhdGUud2Fybik7CiAgICAgIH0KICAgICAgaWYgKG5lZWRSdW50aW1lKSB7CiAgICAgICAgaGFzUnVudGltZSA9IHRydWU7CiAgICAgICAgcmVzICs9ICJ7bmFtZTpcIiIgKyAoZGlyLm5hbWUpICsgIlwiLHJhd05hbWU6XCIiICsgKGRpci5yYXdOYW1lKSArICJcIiIgKyAoZGlyLnZhbHVlID8gKCIsdmFsdWU6KCIgKyAoZGlyLnZhbHVlKSArICIpLGV4cHJlc3Npb246IiArIChKU09OLnN0cmluZ2lmeShkaXIudmFsdWUpKSkgOiAnJykgKyAoZGlyLmFyZyA/ICgiLGFyZzoiICsgKGRpci5pc0R5bmFtaWNBcmcgPyBkaXIuYXJnIDogKCJcIiIgKyAoZGlyLmFyZykgKyAiXCIiKSkpIDogJycpICsgKGRpci5tb2RpZmllcnMgPyAoIixtb2RpZmllcnM6IiArIChKU09OLnN0cmluZ2lmeShkaXIubW9kaWZpZXJzKSkpIDogJycpICsgIn0sIjsKICAgICAgfQogICAgfQogICAgaWYgKGhhc1J1bnRpbWUpIHsKICAgICAgcmV0dXJuIHJlcy5zbGljZSgwLCAtMSkgKyAnXScKICAgIH0KICB9CgogIGZ1bmN0aW9uIGdlbklubGluZVRlbXBsYXRlIChlbCwgc3RhdGUpIHsKICAgIHZhciBhc3QgPSBlbC5jaGlsZHJlblswXTsKICAgIGlmIChlbC5jaGlsZHJlbi5sZW5ndGggIT09IDEgfHwgYXN0LnR5cGUgIT09IDEpIHsKICAgICAgc3RhdGUud2FybigKICAgICAgICAnSW5saW5lLXRlbXBsYXRlIGNvbXBvbmVudHMgbXVzdCBoYXZlIGV4YWN0bHkgb25lIGNoaWxkIGVsZW1lbnQuJywKICAgICAgICB7IHN0YXJ0OiBlbC5zdGFydCB9CiAgICAgICk7CiAgICB9CiAgICBpZiAoYXN0ICYmIGFzdC50eXBlID09PSAxKSB7CiAgICAgIHZhciBpbmxpbmVSZW5kZXJGbnMgPSBnZW5lcmF0ZShhc3QsIHN0YXRlLm9wdGlvbnMpOwogICAgICByZXR1cm4gKCJpbmxpbmVUZW1wbGF0ZTp7cmVuZGVyOmZ1bmN0aW9uKCl7IiArIChpbmxpbmVSZW5kZXJGbnMucmVuZGVyKSArICJ9LHN0YXRpY1JlbmRlckZuczpbIiArIChpbmxpbmVSZW5kZXJGbnMuc3RhdGljUmVuZGVyRm5zLm1hcChmdW5jdGlvbiAoY29kZSkgeyByZXR1cm4gKCJmdW5jdGlvbigpeyIgKyBjb2RlICsgIn0iKTsgfSkuam9pbignLCcpKSArICJdfSIpCiAgICB9CiAgfQoKICBmdW5jdGlvbiBnZW5TY29wZWRTbG90cyAoCiAgICBlbCwKICAgIHNsb3RzLAogICAgc3RhdGUKICApIHsKICAgIC8vIGJ5IGRlZmF1bHQgc2NvcGVkIHNsb3RzIGFyZSBjb25zaWRlcmVkICJzdGFibGUiLCB0aGlzIGFsbG93cyBjaGlsZAogICAgLy8gY29tcG9uZW50cyB3aXRoIG9ubHkgc2NvcGVkIHNsb3RzIHRvIHNraXAgZm9yY2VkIHVwZGF0ZXMgZnJvbSBwYXJlbnQuCiAgICAvLyBidXQgaW4gc29tZSBjYXNlcyB3ZSBoYXZlIHRvIGJhaWwtb3V0IG9mIHRoaXMgb3B0aW1pemF0aW9uCiAgICAvLyBmb3IgZXhhbXBsZSBpZiB0aGUgc2xvdCBjb250YWlucyBkeW5hbWljIG5hbWVzLCBoYXMgdi1pZiBvciB2LWZvciBvbiB0aGVtLi4uCiAgICB2YXIgbmVlZHNGb3JjZVVwZGF0ZSA9IGVsLmZvciB8fCBPYmplY3Qua2V5cyhzbG90cykuc29tZShmdW5jdGlvbiAoa2V5KSB7CiAgICAgIHZhciBzbG90ID0gc2xvdHNba2V5XTsKICAgICAgcmV0dXJuICgKICAgICAgICBzbG90LnNsb3RUYXJnZXREeW5hbWljIHx8CiAgICAgICAgc2xvdC5pZiB8fAogICAgICAgIHNsb3QuZm9yIHx8CiAgICAgICAgY29udGFpbnNTbG90Q2hpbGQoc2xvdCkgLy8gaXMgcGFzc2luZyBkb3duIHNsb3QgZnJvbSBwYXJlbnQgd2hpY2ggbWF5IGJlIGR5bmFtaWMKICAgICAgKQogICAgfSk7CgogICAgLy8gIzk1MzQ6IGlmIGEgY29tcG9uZW50IHdpdGggc2NvcGVkIHNsb3RzIGlzIGluc2lkZSBhIGNvbmRpdGlvbmFsIGJyYW5jaCwKICAgIC8vIGl0J3MgcG9zc2libGUgZm9yIHRoZSBzYW1lIGNvbXBvbmVudCB0byBiZSByZXVzZWQgYnV0IHdpdGggZGlmZmVyZW50CiAgICAvLyBjb21waWxlZCBzbG90IGNvbnRlbnQuIFRvIGF2b2lkIHRoYXQsIHdlIGdlbmVyYXRlIGEgdW5pcXVlIGtleSBiYXNlZCBvbgogICAgLy8gdGhlIGdlbmVyYXRlZCBjb2RlIG9mIGFsbCB0aGUgc2xvdCBjb250ZW50cy4KICAgIHZhciBuZWVkc0tleSA9ICEhZWwuaWY7CgogICAgLy8gT1Igd2hlbiBpdCBpcyBpbnNpZGUgYW5vdGhlciBzY29wZWQgc2xvdCBvciB2LWZvciAodGhlIHJlYWN0aXZpdHkgbWF5IGJlCiAgICAvLyBkaXNjb25uZWN0ZWQgZHVlIHRvIHRoZSBpbnRlcm1lZGlhdGUgc2NvcGUgdmFyaWFibGUpCiAgICAvLyAjOTQzOCwgIzk1MDYKICAgIC8vIFRPRE86IHRoaXMgY2FuIGJlIGZ1cnRoZXIgb3B0aW1pemVkIGJ5IHByb3Blcmx5IGFuYWx5emluZyBpbi1zY29wZSBiaW5kaW5ncwogICAgLy8gYW5kIHNraXAgZm9yY2UgdXBkYXRpbmcgb25lcyB0aGF0IGRvIG5vdCBhY3R1YWxseSB1c2Ugc2NvcGUgdmFyaWFibGVzLgogICAgaWYgKCFuZWVkc0ZvcmNlVXBkYXRlKSB7CiAgICAgIHZhciBwYXJlbnQgPSBlbC5wYXJlbnQ7CiAgICAgIHdoaWxlIChwYXJlbnQpIHsKICAgICAgICBpZiAoCiAgICAgICAgICAocGFyZW50LnNsb3RTY29wZSAmJiBwYXJlbnQuc2xvdFNjb3BlICE9PSBlbXB0eVNsb3RTY29wZVRva2VuKSB8fAogICAgICAgICAgcGFyZW50LmZvcgogICAgICAgICkgewogICAgICAgICAgbmVlZHNGb3JjZVVwZGF0ZSA9IHRydWU7CiAgICAgICAgICBicmVhawogICAgICAgIH0KICAgICAgICBpZiAocGFyZW50LmlmKSB7CiAgICAgICAgICBuZWVkc0tleSA9IHRydWU7CiAgICAgICAgfQogICAgICAgIHBhcmVudCA9IHBhcmVudC5wYXJlbnQ7CiAgICAgIH0KICAgIH0KCiAgICB2YXIgZ2VuZXJhdGVkU2xvdHMgPSBPYmplY3Qua2V5cyhzbG90cykKICAgICAgLm1hcChmdW5jdGlvbiAoa2V5KSB7IHJldHVybiBnZW5TY29wZWRTbG90KHNsb3RzW2tleV0sIHN0YXRlKTsgfSkKICAgICAgLmpvaW4oJywnKTsKCiAgICByZXR1cm4gKCJzY29wZWRTbG90czpfdShbIiArIGdlbmVyYXRlZFNsb3RzICsgIl0iICsgKG5lZWRzRm9yY2VVcGRhdGUgPyAiLG51bGwsdHJ1ZSIgOiAiIikgKyAoIW5lZWRzRm9yY2VVcGRhdGUgJiYgbmVlZHNLZXkgPyAoIixudWxsLGZhbHNlLCIgKyAoaGFzaChnZW5lcmF0ZWRTbG90cykpKSA6ICIiKSArICIpIikKICB9CgogIGZ1bmN0aW9uIGhhc2goc3RyKSB7CiAgICB2YXIgaGFzaCA9IDUzODE7CiAgICB2YXIgaSA9IHN0ci5sZW5ndGg7CiAgICB3aGlsZShpKSB7CiAgICAgIGhhc2ggPSAoaGFzaCAqIDMzKSBeIHN0ci5jaGFyQ29kZUF0KC0taSk7CiAgICB9CiAgICByZXR1cm4gaGFzaCA+Pj4gMAogIH0KCiAgZnVuY3Rpb24gY29udGFpbnNTbG90Q2hpbGQgKGVsKSB7CiAgICBpZiAoZWwudHlwZSA9PT0gMSkgewogICAgICBpZiAoZWwudGFnID09PSAnc2xvdCcpIHsKICAgICAgICByZXR1cm4gdHJ1ZQogICAgICB9CiAgICAgIHJldHVybiBlbC5jaGlsZHJlbi5zb21lKGNvbnRhaW5zU2xvdENoaWxkKQogICAgfQogICAgcmV0dXJuIGZhbHNlCiAgfQoKICBmdW5jdGlvbiBnZW5TY29wZWRTbG90ICgKICAgIGVsLAogICAgc3RhdGUKICApIHsKICAgIHZhciBpc0xlZ2FjeVN5bnRheCA9IGVsLmF0dHJzTWFwWydzbG90LXNjb3BlJ107CiAgICBpZiAoZWwuaWYgJiYgIWVsLmlmUHJvY2Vzc2VkICYmICFpc0xlZ2FjeVN5bnRheCkgewogICAgICByZXR1cm4gZ2VuSWYoZWwsIHN0YXRlLCBnZW5TY29wZWRTbG90LCAibnVsbCIpCiAgICB9CiAgICBpZiAoZWwuZm9yICYmICFlbC5mb3JQcm9jZXNzZWQpIHsKICAgICAgcmV0dXJuIGdlbkZvcihlbCwgc3RhdGUsIGdlblNjb3BlZFNsb3QpCiAgICB9CiAgICB2YXIgc2xvdFNjb3BlID0gZWwuc2xvdFNjb3BlID09PSBlbXB0eVNsb3RTY29wZVRva2VuCiAgICAgID8gIiIKICAgICAgOiBTdHJpbmcoZWwuc2xvdFNjb3BlKTsKICAgIHZhciBmbiA9ICJmdW5jdGlvbigiICsgc2xvdFNjb3BlICsgIil7IiArCiAgICAgICJyZXR1cm4gIiArIChlbC50YWcgPT09ICd0ZW1wbGF0ZScKICAgICAgICA/IGVsLmlmICYmIGlzTGVnYWN5U3ludGF4CiAgICAgICAgICA/ICgiKCIgKyAoZWwuaWYpICsgIik/IiArIChnZW5DaGlsZHJlbihlbCwgc3RhdGUpIHx8ICd1bmRlZmluZWQnKSArICI6dW5kZWZpbmVkIikKICAgICAgICAgIDogZ2VuQ2hpbGRyZW4oZWwsIHN0YXRlKSB8fCAndW5kZWZpbmVkJwogICAgICAgIDogZ2VuRWxlbWVudChlbCwgc3RhdGUpKSArICJ9IjsKICAgIC8vIHJldmVyc2UgcHJveHkgdi1zbG90IHdpdGhvdXQgc2NvcGUgb24gdGhpcy4kc2xvdHMKICAgIHZhciByZXZlcnNlUHJveHkgPSBzbG90U2NvcGUgPyAiIiA6ICIscHJveHk6dHJ1ZSI7CiAgICByZXR1cm4gKCJ7a2V5OiIgKyAoZWwuc2xvdFRhcmdldCB8fCAiXCJkZWZhdWx0XCIiKSArICIsZm46IiArIGZuICsgcmV2ZXJzZVByb3h5ICsgIn0iKQogIH0KCiAgZnVuY3Rpb24gZ2VuQ2hpbGRyZW4gKAogICAgZWwsCiAgICBzdGF0ZSwKICAgIGNoZWNrU2tpcCwKICAgIGFsdEdlbkVsZW1lbnQsCiAgICBhbHRHZW5Ob2RlCiAgKSB7CiAgICB2YXIgY2hpbGRyZW4gPSBlbC5jaGlsZHJlbjsKICAgIGlmIChjaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgdmFyIGVsJDEgPSBjaGlsZHJlblswXTsKICAgICAgLy8gb3B0aW1pemUgc2luZ2xlIHYtZm9yCiAgICAgIGlmIChjaGlsZHJlbi5sZW5ndGggPT09IDEgJiYKICAgICAgICBlbCQxLmZvciAmJgogICAgICAgIGVsJDEudGFnICE9PSAndGVtcGxhdGUnICYmCiAgICAgICAgZWwkMS50YWcgIT09ICdzbG90JwogICAgICApIHsKICAgICAgICB2YXIgbm9ybWFsaXphdGlvblR5cGUgPSBjaGVja1NraXAKICAgICAgICAgID8gc3RhdGUubWF5YmVDb21wb25lbnQoZWwkMSkgPyAiLDEiIDogIiwwIgogICAgICAgICAgOiAiIjsKICAgICAgICByZXR1cm4gKCIiICsgKChhbHRHZW5FbGVtZW50IHx8IGdlbkVsZW1lbnQpKGVsJDEsIHN0YXRlKSkgKyBub3JtYWxpemF0aW9uVHlwZSkKICAgICAgfQogICAgICB2YXIgbm9ybWFsaXphdGlvblR5cGUkMSA9IGNoZWNrU2tpcAogICAgICAgID8gZ2V0Tm9ybWFsaXphdGlvblR5cGUoY2hpbGRyZW4sIHN0YXRlLm1heWJlQ29tcG9uZW50KQogICAgICAgIDogMDsKICAgICAgdmFyIGdlbiA9IGFsdEdlbk5vZGUgfHwgZ2VuTm9kZTsKICAgICAgcmV0dXJuICgiWyIgKyAoY2hpbGRyZW4ubWFwKGZ1bmN0aW9uIChjKSB7IHJldHVybiBnZW4oYywgc3RhdGUpOyB9KS5qb2luKCcsJykpICsgIl0iICsgKG5vcm1hbGl6YXRpb25UeXBlJDEgPyAoIiwiICsgbm9ybWFsaXphdGlvblR5cGUkMSkgOiAnJykpCiAgICB9CiAgfQoKICAvLyBkZXRlcm1pbmUgdGhlIG5vcm1hbGl6YXRpb24gbmVlZGVkIGZvciB0aGUgY2hpbGRyZW4gYXJyYXkuCiAgLy8gMDogbm8gbm9ybWFsaXphdGlvbiBuZWVkZWQKICAvLyAxOiBzaW1wbGUgbm9ybWFsaXphdGlvbiBuZWVkZWQgKHBvc3NpYmxlIDEtbGV2ZWwgZGVlcCBuZXN0ZWQgYXJyYXkpCiAgLy8gMjogZnVsbCBub3JtYWxpemF0aW9uIG5lZWRlZAogIGZ1bmN0aW9uIGdldE5vcm1hbGl6YXRpb25UeXBlICgKICAgIGNoaWxkcmVuLAogICAgbWF5YmVDb21wb25lbnQKICApIHsKICAgIHZhciByZXMgPSAwOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICB2YXIgZWwgPSBjaGlsZHJlbltpXTsKICAgICAgaWYgKGVsLnR5cGUgIT09IDEpIHsKICAgICAgICBjb250aW51ZQogICAgICB9CiAgICAgIGlmIChuZWVkc05vcm1hbGl6YXRpb24oZWwpIHx8CiAgICAgICAgICAoZWwuaWZDb25kaXRpb25zICYmIGVsLmlmQ29uZGl0aW9ucy5zb21lKGZ1bmN0aW9uIChjKSB7IHJldHVybiBuZWVkc05vcm1hbGl6YXRpb24oYy5ibG9jayk7IH0pKSkgewogICAgICAgIHJlcyA9IDI7CiAgICAgICAgYnJlYWsKICAgICAgfQogICAgICBpZiAobWF5YmVDb21wb25lbnQoZWwpIHx8CiAgICAgICAgICAoZWwuaWZDb25kaXRpb25zICYmIGVsLmlmQ29uZGl0aW9ucy5zb21lKGZ1bmN0aW9uIChjKSB7IHJldHVybiBtYXliZUNvbXBvbmVudChjLmJsb2NrKTsgfSkpKSB7CiAgICAgICAgcmVzID0gMTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlcwogIH0KCiAgZnVuY3Rpb24gbmVlZHNOb3JtYWxpemF0aW9uIChlbCkgewogICAgcmV0dXJuIGVsLmZvciAhPT0gdW5kZWZpbmVkIHx8IGVsLnRhZyA9PT0gJ3RlbXBsYXRlJyB8fCBlbC50YWcgPT09ICdzbG90JwogIH0KCiAgZnVuY3Rpb24gZ2VuTm9kZSAobm9kZSwgc3RhdGUpIHsKICAgIGlmIChub2RlLnR5cGUgPT09IDEpIHsKICAgICAgcmV0dXJuIGdlbkVsZW1lbnQobm9kZSwgc3RhdGUpCiAgICB9IGVsc2UgaWYgKG5vZGUudHlwZSA9PT0gMyAmJiBub2RlLmlzQ29tbWVudCkgewogICAgICByZXR1cm4gZ2VuQ29tbWVudChub2RlKQogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGdlblRleHQobm9kZSkKICAgIH0KICB9CgogIGZ1bmN0aW9uIGdlblRleHQgKHRleHQpIHsKICAgIHJldHVybiAoIl92KCIgKyAodGV4dC50eXBlID09PSAyCiAgICAgID8gdGV4dC5leHByZXNzaW9uIC8vIG5vIG5lZWQgZm9yICgpIGJlY2F1c2UgYWxyZWFkeSB3cmFwcGVkIGluIF9zKCkKICAgICAgOiB0cmFuc2Zvcm1TcGVjaWFsTmV3bGluZXMoSlNPTi5zdHJpbmdpZnkodGV4dC50ZXh0KSkpICsgIikiKQogIH0KCiAgZnVuY3Rpb24gZ2VuQ29tbWVudCAoY29tbWVudCkgewogICAgcmV0dXJuICgiX2UoIiArIChKU09OLnN0cmluZ2lmeShjb21tZW50LnRleHQpKSArICIpIikKICB9CgogIGZ1bmN0aW9uIGdlblNsb3QgKGVsLCBzdGF0ZSkgewogICAgdmFyIHNsb3ROYW1lID0gZWwuc2xvdE5hbWUgfHwgJyJkZWZhdWx0Iic7CiAgICB2YXIgY2hpbGRyZW4gPSBnZW5DaGlsZHJlbihlbCwgc3RhdGUpOwogICAgdmFyIHJlcyA9ICJfdCgiICsgc2xvdE5hbWUgKyAoY2hpbGRyZW4gPyAoIiwiICsgY2hpbGRyZW4pIDogJycpOwogICAgdmFyIGF0dHJzID0gZWwuYXR0cnMgfHwgZWwuZHluYW1pY0F0dHJzCiAgICAgID8gZ2VuUHJvcHMoKGVsLmF0dHJzIHx8IFtdKS5jb25jYXQoZWwuZHluYW1pY0F0dHJzIHx8IFtdKS5tYXAoZnVuY3Rpb24gKGF0dHIpIHsgcmV0dXJuICh7CiAgICAgICAgICAvLyBzbG90IHByb3BzIGFyZSBjYW1lbGl6ZWQKICAgICAgICAgIG5hbWU6IGNhbWVsaXplKGF0dHIubmFtZSksCiAgICAgICAgICB2YWx1ZTogYXR0ci52YWx1ZSwKICAgICAgICAgIGR5bmFtaWM6IGF0dHIuZHluYW1pYwogICAgICAgIH0pOyB9KSkKICAgICAgOiBudWxsOwogICAgdmFyIGJpbmQkJDEgPSBlbC5hdHRyc01hcFsndi1iaW5kJ107CiAgICBpZiAoKGF0dHJzIHx8IGJpbmQkJDEpICYmICFjaGlsZHJlbikgewogICAgICByZXMgKz0gIixudWxsIjsKICAgIH0KICAgIGlmIChhdHRycykgewogICAgICByZXMgKz0gIiwiICsgYXR0cnM7CiAgICB9CiAgICBpZiAoYmluZCQkMSkgewogICAgICByZXMgKz0gKGF0dHJzID8gJycgOiAnLG51bGwnKSArICIsIiArIGJpbmQkJDE7CiAgICB9CiAgICByZXR1cm4gcmVzICsgJyknCiAgfQoKICAvLyBjb21wb25lbnROYW1lIGlzIGVsLmNvbXBvbmVudCwgdGFrZSBpdCBhcyBhcmd1bWVudCB0byBzaHVuIGZsb3cncyBwZXNzaW1pc3RpYyByZWZpbmVtZW50CiAgZnVuY3Rpb24gZ2VuQ29tcG9uZW50ICgKICAgIGNvbXBvbmVudE5hbWUsCiAgICBlbCwKICAgIHN0YXRlCiAgKSB7CiAgICB2YXIgY2hpbGRyZW4gPSBlbC5pbmxpbmVUZW1wbGF0ZSA/IG51bGwgOiBnZW5DaGlsZHJlbihlbCwgc3RhdGUsIHRydWUpOwogICAgcmV0dXJuICgiX2MoIiArIGNvbXBvbmVudE5hbWUgKyAiLCIgKyAoZ2VuRGF0YSQyKGVsLCBzdGF0ZSkpICsgKGNoaWxkcmVuID8gKCIsIiArIGNoaWxkcmVuKSA6ICcnKSArICIpIikKICB9CgogIGZ1bmN0aW9uIGdlblByb3BzIChwcm9wcykgewogICAgdmFyIHN0YXRpY1Byb3BzID0gIiI7CiAgICB2YXIgZHluYW1pY1Byb3BzID0gIiI7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBwcm9wID0gcHJvcHNbaV07CiAgICAgIHZhciB2YWx1ZSA9IHRyYW5zZm9ybVNwZWNpYWxOZXdsaW5lcyhwcm9wLnZhbHVlKTsKICAgICAgaWYgKHByb3AuZHluYW1pYykgewogICAgICAgIGR5bmFtaWNQcm9wcyArPSAocHJvcC5uYW1lKSArICIsIiArIHZhbHVlICsgIiwiOwogICAgICB9IGVsc2UgewogICAgICAgIHN0YXRpY1Byb3BzICs9ICJcIiIgKyAocHJvcC5uYW1lKSArICJcIjoiICsgdmFsdWUgKyAiLCI7CiAgICAgIH0KICAgIH0KICAgIHN0YXRpY1Byb3BzID0gInsiICsgKHN0YXRpY1Byb3BzLnNsaWNlKDAsIC0xKSkgKyAifSI7CiAgICBpZiAoZHluYW1pY1Byb3BzKSB7CiAgICAgIHJldHVybiAoIl9kKCIgKyBzdGF0aWNQcm9wcyArICIsWyIgKyAoZHluYW1pY1Byb3BzLnNsaWNlKDAsIC0xKSkgKyAiXSkiKQogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHN0YXRpY1Byb3BzCiAgICB9CiAgfQoKICAvLyAjMzg5NSwgIzQyNjgKICBmdW5jdGlvbiB0cmFuc2Zvcm1TcGVjaWFsTmV3bGluZXMgKHRleHQpIHsKICAgIHJldHVybiB0ZXh0CiAgICAgIC5yZXBsYWNlKC9cdTIwMjgvZywgJ1xcdTIwMjgnKQogICAgICAucmVwbGFjZSgvXHUyMDI5L2csICdcXHUyMDI5JykKICB9CgogIC8qICAqLwoKCgogIC8vIHRoZXNlIGtleXdvcmRzIHNob3VsZCBub3QgYXBwZWFyIGluc2lkZSBleHByZXNzaW9ucywgYnV0IG9wZXJhdG9ycyBsaWtlCiAgLy8gdHlwZW9mLCBpbnN0YW5jZW9mIGFuZCBpbiBhcmUgYWxsb3dlZAogIHZhciBwcm9oaWJpdGVkS2V5d29yZFJFID0gbmV3IFJlZ0V4cCgnXFxiJyArICgKICAgICdkbyxpZixmb3IsbGV0LG5ldyx0cnksdmFyLGNhc2UsZWxzZSx3aXRoLGF3YWl0LGJyZWFrLGNhdGNoLGNsYXNzLGNvbnN0LCcgKwogICAgJ3N1cGVyLHRocm93LHdoaWxlLHlpZWxkLGRlbGV0ZSxleHBvcnQsaW1wb3J0LHJldHVybixzd2l0Y2gsZGVmYXVsdCwnICsKICAgICdleHRlbmRzLGZpbmFsbHksY29udGludWUsZGVidWdnZXIsZnVuY3Rpb24sYXJndW1lbnRzJwogICkuc3BsaXQoJywnKS5qb2luKCdcXGJ8XFxiJykgKyAnXFxiJyk7CgogIC8vIHRoZXNlIHVuYXJ5IG9wZXJhdG9ycyBzaG91bGQgbm90IGJlIHVzZWQgYXMgcHJvcGVydHkvbWV0aG9kIG5hbWVzCiAgdmFyIHVuYXJ5T3BlcmF0b3JzUkUgPSBuZXcgUmVnRXhwKCdcXGInICsgKAogICAgJ2RlbGV0ZSx0eXBlb2Ysdm9pZCcKICApLnNwbGl0KCcsJykuam9pbignXFxzKlxcKFteXFwpXSpcXCl8XFxiJykgKyAnXFxzKlxcKFteXFwpXSpcXCknKTsKCiAgLy8gc3RyaXAgc3RyaW5ncyBpbiBleHByZXNzaW9ucwogIHZhciBzdHJpcFN0cmluZ1JFID0gLycoPzpbXidcXF18XFwuKSonfCIoPzpbXiJcXF18XFwuKSoifGAoPzpbXmBcXF18XFwuKSpcJFx7fFx9KD86W15gXFxdfFxcLikqYHxgKD86W15gXFxdfFxcLikqYC9nOwoKICAvLyBkZXRlY3QgcHJvYmxlbWF0aWMgZXhwcmVzc2lvbnMgaW4gYSB0ZW1wbGF0ZQogIGZ1bmN0aW9uIGRldGVjdEVycm9ycyAoYXN0LCB3YXJuKSB7CiAgICBpZiAoYXN0KSB7CiAgICAgIGNoZWNrTm9kZShhc3QsIHdhcm4pOwogICAgfQogIH0KCiAgZnVuY3Rpb24gY2hlY2tOb2RlIChub2RlLCB3YXJuKSB7CiAgICBpZiAobm9kZS50eXBlID09PSAxKSB7CiAgICAgIGZvciAodmFyIG5hbWUgaW4gbm9kZS5hdHRyc01hcCkgewogICAgICAgIGlmIChkaXJSRS50ZXN0KG5hbWUpKSB7CiAgICAgICAgICB2YXIgdmFsdWUgPSBub2RlLmF0dHJzTWFwW25hbWVdOwogICAgICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgICAgIHZhciByYW5nZSA9IG5vZGUucmF3QXR0cnNNYXBbbmFtZV07CiAgICAgICAgICAgIGlmIChuYW1lID09PSAndi1mb3InKSB7CiAgICAgICAgICAgICAgY2hlY2tGb3Iobm9kZSwgKCJ2LWZvcj1cIiIgKyB2YWx1ZSArICJcIiIpLCB3YXJuLCByYW5nZSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAob25SRS50ZXN0KG5hbWUpKSB7CiAgICAgICAgICAgICAgY2hlY2tFdmVudCh2YWx1ZSwgKG5hbWUgKyAiPVwiIiArIHZhbHVlICsgIlwiIiksIHdhcm4sIHJhbmdlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjaGVja0V4cHJlc3Npb24odmFsdWUsIChuYW1lICsgIj1cIiIgKyB2YWx1ZSArICJcIiIpLCB3YXJuLCByYW5nZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKG5vZGUuY2hpbGRyZW4pIHsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5vZGUuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNoZWNrTm9kZShub2RlLmNoaWxkcmVuW2ldLCB3YXJuKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSBpZiAobm9kZS50eXBlID09PSAyKSB7CiAgICAgIGNoZWNrRXhwcmVzc2lvbihub2RlLmV4cHJlc3Npb24sIG5vZGUudGV4dCwgd2Fybiwgbm9kZSk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBjaGVja0V2ZW50IChleHAsIHRleHQsIHdhcm4sIHJhbmdlKSB7CiAgICB2YXIgc3RpcHBlZCA9IGV4cC5yZXBsYWNlKHN0cmlwU3RyaW5nUkUsICcnKTsKICAgIHZhciBrZXl3b3JkTWF0Y2ggPSBzdGlwcGVkLm1hdGNoKHVuYXJ5T3BlcmF0b3JzUkUpOwogICAgaWYgKGtleXdvcmRNYXRjaCAmJiBzdGlwcGVkLmNoYXJBdChrZXl3b3JkTWF0Y2guaW5kZXggLSAxKSAhPT0gJyQnKSB7CiAgICAgIHdhcm4oCiAgICAgICAgImF2b2lkIHVzaW5nIEphdmFTY3JpcHQgdW5hcnkgb3BlcmF0b3IgYXMgcHJvcGVydHkgbmFtZTogIiArCiAgICAgICAgIlwiIiArIChrZXl3b3JkTWF0Y2hbMF0pICsgIlwiIGluIGV4cHJlc3Npb24gIiArICh0ZXh0LnRyaW0oKSksCiAgICAgICAgcmFuZ2UKICAgICAgKTsKICAgIH0KICAgIGNoZWNrRXhwcmVzc2lvbihleHAsIHRleHQsIHdhcm4sIHJhbmdlKTsKICB9CgogIGZ1bmN0aW9uIGNoZWNrRm9yIChub2RlLCB0ZXh0LCB3YXJuLCByYW5nZSkgewogICAgY2hlY2tFeHByZXNzaW9uKG5vZGUuZm9yIHx8ICcnLCB0ZXh0LCB3YXJuLCByYW5nZSk7CiAgICBjaGVja0lkZW50aWZpZXIobm9kZS5hbGlhcywgJ3YtZm9yIGFsaWFzJywgdGV4dCwgd2FybiwgcmFuZ2UpOwogICAgY2hlY2tJZGVudGlmaWVyKG5vZGUuaXRlcmF0b3IxLCAndi1mb3IgaXRlcmF0b3InLCB0ZXh0LCB3YXJuLCByYW5nZSk7CiAgICBjaGVja0lkZW50aWZpZXIobm9kZS5pdGVyYXRvcjIsICd2LWZvciBpdGVyYXRvcicsIHRleHQsIHdhcm4sIHJhbmdlKTsKICB9CgogIGZ1bmN0aW9uIGNoZWNrSWRlbnRpZmllciAoCiAgICBpZGVudCwKICAgIHR5cGUsCiAgICB0ZXh0LAogICAgd2FybiwKICAgIHJhbmdlCiAgKSB7CiAgICBpZiAodHlwZW9mIGlkZW50ID09PSAnc3RyaW5nJykgewogICAgICB0cnkgewogICAgICAgIG5ldyBGdW5jdGlvbigoInZhciAiICsgaWRlbnQgKyAiPV8iKSk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICB3YXJuKCgiaW52YWxpZCAiICsgdHlwZSArICIgXCIiICsgaWRlbnQgKyAiXCIgaW4gZXhwcmVzc2lvbjogIiArICh0ZXh0LnRyaW0oKSkpLCByYW5nZSk7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIGNoZWNrRXhwcmVzc2lvbiAoZXhwLCB0ZXh0LCB3YXJuLCByYW5nZSkgewogICAgdHJ5IHsKICAgICAgbmV3IEZ1bmN0aW9uKCgicmV0dXJuICIgKyBleHApKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgdmFyIGtleXdvcmRNYXRjaCA9IGV4cC5yZXBsYWNlKHN0cmlwU3RyaW5nUkUsICcnKS5tYXRjaChwcm9oaWJpdGVkS2V5d29yZFJFKTsKICAgICAgaWYgKGtleXdvcmRNYXRjaCkgewogICAgICAgIHdhcm4oCiAgICAgICAgICAiYXZvaWQgdXNpbmcgSmF2YVNjcmlwdCBrZXl3b3JkIGFzIHByb3BlcnR5IG5hbWU6ICIgKwogICAgICAgICAgIlwiIiArIChrZXl3b3JkTWF0Y2hbMF0pICsgIlwiXG4gIFJhdyBleHByZXNzaW9uOiAiICsgKHRleHQudHJpbSgpKSwKICAgICAgICAgIHJhbmdlCiAgICAgICAgKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB3YXJuKAogICAgICAgICAgImludmFsaWQgZXhwcmVzc2lvbjogIiArIChlLm1lc3NhZ2UpICsgIiBpblxuXG4iICsKICAgICAgICAgICIgICAgIiArIGV4cCArICJcblxuIiArCiAgICAgICAgICAiICBSYXcgZXhwcmVzc2lvbjogIiArICh0ZXh0LnRyaW0oKSkgKyAiXG4iLAogICAgICAgICAgcmFuZ2UKICAgICAgICApOwogICAgICB9CiAgICB9CiAgfQoKICAvKiAgKi8KCiAgdmFyIHJhbmdlID0gMjsKCiAgZnVuY3Rpb24gZ2VuZXJhdGVDb2RlRnJhbWUgKAogICAgc291cmNlLAogICAgc3RhcnQsCiAgICBlbmQKICApIHsKICAgIGlmICggc3RhcnQgPT09IHZvaWQgMCApIHN0YXJ0ID0gMDsKICAgIGlmICggZW5kID09PSB2b2lkIDAgKSBlbmQgPSBzb3VyY2UubGVuZ3RoOwoKICAgIHZhciBsaW5lcyA9IHNvdXJjZS5zcGxpdCgvXHI/XG4vKTsKICAgIHZhciBjb3VudCA9IDA7CiAgICB2YXIgcmVzID0gW107CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpbmVzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGNvdW50ICs9IGxpbmVzW2ldLmxlbmd0aCArIDE7CiAgICAgIGlmIChjb3VudCA+PSBzdGFydCkgewogICAgICAgIGZvciAodmFyIGogPSBpIC0gcmFuZ2U7IGogPD0gaSArIHJhbmdlIHx8IGVuZCA+IGNvdW50OyBqKyspIHsKICAgICAgICAgIGlmIChqIDwgMCB8fCBqID49IGxpbmVzLmxlbmd0aCkgeyBjb250aW51ZSB9CiAgICAgICAgICByZXMucHVzaCgoIiIgKyAoaiArIDEpICsgKHJlcGVhdCQxKCIgIiwgMyAtIFN0cmluZyhqICsgMSkubGVuZ3RoKSkgKyAifCAgIiArIChsaW5lc1tqXSkpKTsKICAgICAgICAgIHZhciBsaW5lTGVuZ3RoID0gbGluZXNbal0ubGVuZ3RoOwogICAgICAgICAgaWYgKGogPT09IGkpIHsKICAgICAgICAgICAgLy8gcHVzaCB1bmRlcmxpbmUKICAgICAgICAgICAgdmFyIHBhZCA9IHN0YXJ0IC0gKGNvdW50IC0gbGluZUxlbmd0aCkgKyAxOwogICAgICAgICAgICB2YXIgbGVuZ3RoID0gZW5kID4gY291bnQgPyBsaW5lTGVuZ3RoIC0gcGFkIDogZW5kIC0gc3RhcnQ7CiAgICAgICAgICAgIHJlcy5wdXNoKCIgICB8ICAiICsgcmVwZWF0JDEoIiAiLCBwYWQpICsgcmVwZWF0JDEoIl4iLCBsZW5ndGgpKTsKICAgICAgICAgIH0gZWxzZSBpZiAoaiA+IGkpIHsKICAgICAgICAgICAgaWYgKGVuZCA+IGNvdW50KSB7CiAgICAgICAgICAgICAgdmFyIGxlbmd0aCQxID0gTWF0aC5taW4oZW5kIC0gY291bnQsIGxpbmVMZW5ndGgpOwogICAgICAgICAgICAgIHJlcy5wdXNoKCIgICB8ICAiICsgcmVwZWF0JDEoIl4iLCBsZW5ndGgkMSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvdW50ICs9IGxpbmVMZW5ndGggKyAxOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBicmVhawogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzLmpvaW4oJ1xuJykKICB9CgogIGZ1bmN0aW9uIHJlcGVhdCQxIChzdHIsIG4pIHsKICAgIHZhciByZXN1bHQgPSAnJzsKICAgIGlmIChuID4gMCkgewogICAgICB3aGlsZSAodHJ1ZSkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lCiAgICAgICAgaWYgKG4gJiAxKSB7IHJlc3VsdCArPSBzdHI7IH0KICAgICAgICBuID4+Pj0gMTsKICAgICAgICBpZiAobiA8PSAwKSB7IGJyZWFrIH0KICAgICAgICBzdHIgKz0gc3RyOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzdWx0CiAgfQoKICAvKiAgKi8KCgoKICBmdW5jdGlvbiBjcmVhdGVGdW5jdGlvbiAoY29kZSwgZXJyb3JzKSB7CiAgICB0cnkgewogICAgICByZXR1cm4gbmV3IEZ1bmN0aW9uKGNvZGUpCiAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgZXJyb3JzLnB1c2goeyBlcnI6IGVyciwgY29kZTogY29kZSB9KTsKICAgICAgcmV0dXJuIG5vb3AKICAgIH0KICB9CgogIGZ1bmN0aW9uIGNyZWF0ZUNvbXBpbGVUb0Z1bmN0aW9uRm4gKGNvbXBpbGUpIHsKICAgIHZhciBjYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CgogICAgcmV0dXJuIGZ1bmN0aW9uIGNvbXBpbGVUb0Z1bmN0aW9ucyAoCiAgICAgIHRlbXBsYXRlLAogICAgICBvcHRpb25zLAogICAgICB2bQogICAgKSB7CiAgICAgIG9wdGlvbnMgPSBleHRlbmQoe30sIG9wdGlvbnMpOwogICAgICB2YXIgd2FybiQkMSA9IG9wdGlvbnMud2FybiB8fCB3YXJuOwogICAgICBkZWxldGUgb3B0aW9ucy53YXJuOwoKICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICAgIHsKICAgICAgICAvLyBkZXRlY3QgcG9zc2libGUgQ1NQIHJlc3RyaWN0aW9uCiAgICAgICAgdHJ5IHsKICAgICAgICAgIG5ldyBGdW5jdGlvbigncmV0dXJuIDEnKTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICBpZiAoZS50b1N0cmluZygpLm1hdGNoKC91bnNhZmUtZXZhbHxDU1AvKSkgewogICAgICAgICAgICB3YXJuJCQxKAogICAgICAgICAgICAgICdJdCBzZWVtcyB5b3UgYXJlIHVzaW5nIHRoZSBzdGFuZGFsb25lIGJ1aWxkIG9mIFZ1ZS5qcyBpbiBhbiAnICsKICAgICAgICAgICAgICAnZW52aXJvbm1lbnQgd2l0aCBDb250ZW50IFNlY3VyaXR5IFBvbGljeSB0aGF0IHByb2hpYml0cyB1bnNhZmUtZXZhbC4gJyArCiAgICAgICAgICAgICAgJ1RoZSB0ZW1wbGF0ZSBjb21waWxlciBjYW5ub3Qgd29yayBpbiB0aGlzIGVudmlyb25tZW50LiBDb25zaWRlciAnICsKICAgICAgICAgICAgICAncmVsYXhpbmcgdGhlIHBvbGljeSB0byBhbGxvdyB1bnNhZmUtZXZhbCBvciBwcmUtY29tcGlsaW5nIHlvdXIgJyArCiAgICAgICAgICAgICAgJ3RlbXBsYXRlcyBpbnRvIHJlbmRlciBmdW5jdGlvbnMuJwogICAgICAgICAgICApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gY2hlY2sgY2FjaGUKICAgICAgdmFyIGtleSA9IG9wdGlvbnMuZGVsaW1pdGVycwogICAgICAgID8gU3RyaW5nKG9wdGlvbnMuZGVsaW1pdGVycykgKyB0ZW1wbGF0ZQogICAgICAgIDogdGVtcGxhdGU7CiAgICAgIGlmIChjYWNoZVtrZXldKSB7CiAgICAgICAgcmV0dXJuIGNhY2hlW2tleV0KICAgICAgfQoKICAgICAgLy8gY29tcGlsZQogICAgICB2YXIgY29tcGlsZWQgPSBjb21waWxlKHRlbXBsYXRlLCBvcHRpb25zKTsKCiAgICAgIC8vIGNoZWNrIGNvbXBpbGF0aW9uIGVycm9ycy90aXBzCiAgICAgIHsKICAgICAgICBpZiAoY29tcGlsZWQuZXJyb3JzICYmIGNvbXBpbGVkLmVycm9ycy5sZW5ndGgpIHsKICAgICAgICAgIGlmIChvcHRpb25zLm91dHB1dFNvdXJjZVJhbmdlKSB7CiAgICAgICAgICAgIGNvbXBpbGVkLmVycm9ycy5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgd2FybiQkMSgKICAgICAgICAgICAgICAgICJFcnJvciBjb21waWxpbmcgdGVtcGxhdGU6XG5cbiIgKyAoZS5tc2cpICsgIlxuXG4iICsKICAgICAgICAgICAgICAgIGdlbmVyYXRlQ29kZUZyYW1lKHRlbXBsYXRlLCBlLnN0YXJ0LCBlLmVuZCksCiAgICAgICAgICAgICAgICB2bQogICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgd2FybiQkMSgKICAgICAgICAgICAgICAiRXJyb3IgY29tcGlsaW5nIHRlbXBsYXRlOlxuXG4iICsgdGVtcGxhdGUgKyAiXG5cbiIgKwogICAgICAgICAgICAgIGNvbXBpbGVkLmVycm9ycy5tYXAoZnVuY3Rpb24gKGUpIHsgcmV0dXJuICgiLSAiICsgZSk7IH0pLmpvaW4oJ1xuJykgKyAnXG4nLAogICAgICAgICAgICAgIHZtCiAgICAgICAgICAgICk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChjb21waWxlZC50aXBzICYmIGNvbXBpbGVkLnRpcHMubGVuZ3RoKSB7CiAgICAgICAgICBpZiAob3B0aW9ucy5vdXRwdXRTb3VyY2VSYW5nZSkgewogICAgICAgICAgICBjb21waWxlZC50aXBzLmZvckVhY2goZnVuY3Rpb24gKGUpIHsgcmV0dXJuIHRpcChlLm1zZywgdm0pOyB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbXBpbGVkLnRpcHMuZm9yRWFjaChmdW5jdGlvbiAobXNnKSB7IHJldHVybiB0aXAobXNnLCB2bSk7IH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgLy8gdHVybiBjb2RlIGludG8gZnVuY3Rpb25zCiAgICAgIHZhciByZXMgPSB7fTsKICAgICAgdmFyIGZuR2VuRXJyb3JzID0gW107CiAgICAgIHJlcy5yZW5kZXIgPSBjcmVhdGVGdW5jdGlvbihjb21waWxlZC5yZW5kZXIsIGZuR2VuRXJyb3JzKTsKICAgICAgcmVzLnN0YXRpY1JlbmRlckZucyA9IGNvbXBpbGVkLnN0YXRpY1JlbmRlckZucy5tYXAoZnVuY3Rpb24gKGNvZGUpIHsKICAgICAgICByZXR1cm4gY3JlYXRlRnVuY3Rpb24oY29kZSwgZm5HZW5FcnJvcnMpCiAgICAgIH0pOwoKICAgICAgLy8gY2hlY2sgZnVuY3Rpb24gZ2VuZXJhdGlvbiBlcnJvcnMuCiAgICAgIC8vIHRoaXMgc2hvdWxkIG9ubHkgaGFwcGVuIGlmIHRoZXJlIGlzIGEgYnVnIGluIHRoZSBjb21waWxlciBpdHNlbGYuCiAgICAgIC8vIG1vc3RseSBmb3IgY29kZWdlbiBkZXZlbG9wbWVudCB1c2UKICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICAgIHsKICAgICAgICBpZiAoKCFjb21waWxlZC5lcnJvcnMgfHwgIWNvbXBpbGVkLmVycm9ycy5sZW5ndGgpICYmIGZuR2VuRXJyb3JzLmxlbmd0aCkgewogICAgICAgICAgd2FybiQkMSgKICAgICAgICAgICAgIkZhaWxlZCB0byBnZW5lcmF0ZSByZW5kZXIgZnVuY3Rpb246XG5cbiIgKwogICAgICAgICAgICBmbkdlbkVycm9ycy5tYXAoZnVuY3Rpb24gKHJlZikgewogICAgICAgICAgICAgIHZhciBlcnIgPSByZWYuZXJyOwogICAgICAgICAgICAgIHZhciBjb2RlID0gcmVmLmNvZGU7CgogICAgICAgICAgICAgIHJldHVybiAoKGVyci50b1N0cmluZygpKSArICIgaW5cblxuIiArIGNvZGUgKyAiXG4iKTsKICAgICAgICAgIH0pLmpvaW4oJ1xuJyksCiAgICAgICAgICAgIHZtCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIChjYWNoZVtrZXldID0gcmVzKQogICAgfQogIH0KCiAgLyogICovCgogIGZ1bmN0aW9uIGNyZWF0ZUNvbXBpbGVyQ3JlYXRvciAoYmFzZUNvbXBpbGUpIHsKICAgIHJldHVybiBmdW5jdGlvbiBjcmVhdGVDb21waWxlciAoYmFzZU9wdGlvbnMpIHsKICAgICAgZnVuY3Rpb24gY29tcGlsZSAoCiAgICAgICAgdGVtcGxhdGUsCiAgICAgICAgb3B0aW9ucwogICAgICApIHsKICAgICAgICB2YXIgZmluYWxPcHRpb25zID0gT2JqZWN0LmNyZWF0ZShiYXNlT3B0aW9ucyk7CiAgICAgICAgdmFyIGVycm9ycyA9IFtdOwogICAgICAgIHZhciB0aXBzID0gW107CgogICAgICAgIHZhciB3YXJuID0gZnVuY3Rpb24gKG1zZywgcmFuZ2UsIHRpcCkgewogICAgICAgICAgKHRpcCA/IHRpcHMgOiBlcnJvcnMpLnB1c2gobXNnKTsKICAgICAgICB9OwoKICAgICAgICBpZiAob3B0aW9ucykgewogICAgICAgICAgaWYgKG9wdGlvbnMub3V0cHV0U291cmNlUmFuZ2UpIHsKICAgICAgICAgICAgLy8gJGZsb3ctZGlzYWJsZS1saW5lCiAgICAgICAgICAgIHZhciBsZWFkaW5nU3BhY2VMZW5ndGggPSB0ZW1wbGF0ZS5tYXRjaCgvXlxzKi8pWzBdLmxlbmd0aDsKCiAgICAgICAgICAgIHdhcm4gPSBmdW5jdGlvbiAobXNnLCByYW5nZSwgdGlwKSB7CiAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7IG1zZzogbXNnIH07CiAgICAgICAgICAgICAgaWYgKHJhbmdlKSB7CiAgICAgICAgICAgICAgICBpZiAocmFuZ2Uuc3RhcnQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICBkYXRhLnN0YXJ0ID0gcmFuZ2Uuc3RhcnQgKyBsZWFkaW5nU3BhY2VMZW5ndGg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAocmFuZ2UuZW5kICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgZGF0YS5lbmQgPSByYW5nZS5lbmQgKyBsZWFkaW5nU3BhY2VMZW5ndGg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICh0aXAgPyB0aXBzIDogZXJyb3JzKS5wdXNoKGRhdGEpOwogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgLy8gbWVyZ2UgY3VzdG9tIG1vZHVsZXMKICAgICAgICAgIGlmIChvcHRpb25zLm1vZHVsZXMpIHsKICAgICAgICAgICAgZmluYWxPcHRpb25zLm1vZHVsZXMgPQogICAgICAgICAgICAgIChiYXNlT3B0aW9ucy5tb2R1bGVzIHx8IFtdKS5jb25jYXQob3B0aW9ucy5tb2R1bGVzKTsKICAgICAgICAgIH0KICAgICAgICAgIC8vIG1lcmdlIGN1c3RvbSBkaXJlY3RpdmVzCiAgICAgICAgICBpZiAob3B0aW9ucy5kaXJlY3RpdmVzKSB7CiAgICAgICAgICAgIGZpbmFsT3B0aW9ucy5kaXJlY3RpdmVzID0gZXh0ZW5kKAogICAgICAgICAgICAgIE9iamVjdC5jcmVhdGUoYmFzZU9wdGlvbnMuZGlyZWN0aXZlcyB8fCBudWxsKSwKICAgICAgICAgICAgICBvcHRpb25zLmRpcmVjdGl2ZXMKICAgICAgICAgICAgKTsKICAgICAgICAgIH0KICAgICAgICAgIC8vIGNvcHkgb3RoZXIgb3B0aW9ucwogICAgICAgICAgZm9yICh2YXIga2V5IGluIG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKGtleSAhPT0gJ21vZHVsZXMnICYmIGtleSAhPT0gJ2RpcmVjdGl2ZXMnKSB7CiAgICAgICAgICAgICAgZmluYWxPcHRpb25zW2tleV0gPSBvcHRpb25zW2tleV07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZpbmFsT3B0aW9ucy53YXJuID0gd2FybjsKCiAgICAgICAgdmFyIGNvbXBpbGVkID0gYmFzZUNvbXBpbGUodGVtcGxhdGUudHJpbSgpLCBmaW5hbE9wdGlvbnMpOwogICAgICAgIHsKICAgICAgICAgIGRldGVjdEVycm9ycyhjb21waWxlZC5hc3QsIHdhcm4pOwogICAgICAgIH0KICAgICAgICBjb21waWxlZC5lcnJvcnMgPSBlcnJvcnM7CiAgICAgICAgY29tcGlsZWQudGlwcyA9IHRpcHM7CiAgICAgICAgcmV0dXJuIGNvbXBpbGVkCiAgICAgIH0KCiAgICAgIHJldHVybiB7CiAgICAgICAgY29tcGlsZTogY29tcGlsZSwKICAgICAgICBjb21waWxlVG9GdW5jdGlvbnM6IGNyZWF0ZUNvbXBpbGVUb0Z1bmN0aW9uRm4oY29tcGlsZSkKICAgICAgfQogICAgfQogIH0KCiAgLyogICovCgogIC8vIGBjcmVhdGVDb21waWxlckNyZWF0b3JgIGFsbG93cyBjcmVhdGluZyBjb21waWxlcnMgdGhhdCB1c2UgYWx0ZXJuYXRpdmUKICAvLyBwYXJzZXIvb3B0aW1pemVyL2NvZGVnZW4sIGUuZyB0aGUgU1NSIG9wdGltaXppbmcgY29tcGlsZXIuCiAgLy8gSGVyZSB3ZSBqdXN0IGV4cG9ydCBhIGRlZmF1bHQgY29tcGlsZXIgdXNpbmcgdGhlIGRlZmF1bHQgcGFydHMuCiAgdmFyIGNyZWF0ZUNvbXBpbGVyID0gY3JlYXRlQ29tcGlsZXJDcmVhdG9yKGZ1bmN0aW9uIGJhc2VDb21waWxlICgKICAgIHRlbXBsYXRlLAogICAgb3B0aW9ucwogICkgewogICAgdmFyIGFzdCA9IHBhcnNlKHRlbXBsYXRlLnRyaW0oKSwgb3B0aW9ucyk7CiAgICBpZiAob3B0aW9ucy5vcHRpbWl6ZSAhPT0gZmFsc2UpIHsKICAgICAgb3B0aW1pemUoYXN0LCBvcHRpb25zKTsKICAgIH0KICAgIHZhciBjb2RlID0gZ2VuZXJhdGUoYXN0LCBvcHRpb25zKTsKICAgIHJldHVybiB7CiAgICAgIGFzdDogYXN0LAogICAgICByZW5kZXI6IGNvZGUucmVuZGVyLAogICAgICBzdGF0aWNSZW5kZXJGbnM6IGNvZGUuc3RhdGljUmVuZGVyRm5zCiAgICB9CiAgfSk7CgogIC8qICAqLwoKICB2YXIgcmVmJDEgPSBjcmVhdGVDb21waWxlcihiYXNlT3B0aW9ucyk7CiAgdmFyIGNvbXBpbGUgPSByZWYkMS5jb21waWxlOwogIHZhciBjb21waWxlVG9GdW5jdGlvbnMgPSByZWYkMS5jb21waWxlVG9GdW5jdGlvbnM7CgogIC8qICAqLwoKICAvLyBjaGVjayB3aGV0aGVyIGN1cnJlbnQgYnJvd3NlciBlbmNvZGVzIGEgY2hhciBpbnNpZGUgYXR0cmlidXRlIHZhbHVlcwogIHZhciBkaXY7CiAgZnVuY3Rpb24gZ2V0U2hvdWxkRGVjb2RlIChocmVmKSB7CiAgICBkaXYgPSBkaXYgfHwgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBkaXYuaW5uZXJIVE1MID0gaHJlZiA/ICI8YSBocmVmPVwiXG5cIi8+IiA6ICI8ZGl2IGE9XCJcblwiLz4iOwogICAgcmV0dXJuIGRpdi5pbm5lckhUTUwuaW5kZXhPZignJiMxMDsnKSA+IDAKICB9CgogIC8vICMzNjYzOiBJRSBlbmNvZGVzIG5ld2xpbmVzIGluc2lkZSBhdHRyaWJ1dGUgdmFsdWVzIHdoaWxlIG90aGVyIGJyb3dzZXJzIGRvbid0CiAgdmFyIHNob3VsZERlY29kZU5ld2xpbmVzID0gaW5Ccm93c2VyID8gZ2V0U2hvdWxkRGVjb2RlKGZhbHNlKSA6IGZhbHNlOwogIC8vICM2ODI4OiBjaHJvbWUgZW5jb2RlcyBjb250ZW50IGluIGFbaHJlZl0KICB2YXIgc2hvdWxkRGVjb2RlTmV3bGluZXNGb3JIcmVmID0gaW5Ccm93c2VyID8gZ2V0U2hvdWxkRGVjb2RlKHRydWUpIDogZmFsc2U7CgogIC8qICAqLwoKICB2YXIgaWRUb1RlbXBsYXRlID0gY2FjaGVkKGZ1bmN0aW9uIChpZCkgewogICAgdmFyIGVsID0gcXVlcnkoaWQpOwogICAgcmV0dXJuIGVsICYmIGVsLmlubmVySFRNTAogIH0pOwoKICB2YXIgbW91bnQgPSBWdWUucHJvdG90eXBlLiRtb3VudDsKICBWdWUucHJvdG90eXBlLiRtb3VudCA9IGZ1bmN0aW9uICgKICAgIGVsLAogICAgaHlkcmF0aW5nCiAgKSB7CiAgICBlbCA9IGVsICYmIHF1ZXJ5KGVsKTsKCiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgIGlmIChlbCA9PT0gZG9jdW1lbnQuYm9keSB8fCBlbCA9PT0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KSB7CiAgICAgIHdhcm4oCiAgICAgICAgIkRvIG5vdCBtb3VudCBWdWUgdG8gPGh0bWw+IG9yIDxib2R5PiAtIG1vdW50IHRvIG5vcm1hbCBlbGVtZW50cyBpbnN0ZWFkLiIKICAgICAgKTsKICAgICAgcmV0dXJuIHRoaXMKICAgIH0KCiAgICB2YXIgb3B0aW9ucyA9IHRoaXMuJG9wdGlvbnM7CiAgICAvLyByZXNvbHZlIHRlbXBsYXRlL2VsIGFuZCBjb252ZXJ0IHRvIHJlbmRlciBmdW5jdGlvbgogICAgaWYgKCFvcHRpb25zLnJlbmRlcikgewogICAgICB2YXIgdGVtcGxhdGUgPSBvcHRpb25zLnRlbXBsYXRlOwogICAgICBpZiAodGVtcGxhdGUpIHsKICAgICAgICBpZiAodHlwZW9mIHRlbXBsYXRlID09PSAnc3RyaW5nJykgewogICAgICAgICAgaWYgKHRlbXBsYXRlLmNoYXJBdCgwKSA9PT0gJyMnKSB7CiAgICAgICAgICAgIHRlbXBsYXRlID0gaWRUb1RlbXBsYXRlKHRlbXBsYXRlKTsKICAgICAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICAgICAgICAgIGlmICghdGVtcGxhdGUpIHsKICAgICAgICAgICAgICB3YXJuKAogICAgICAgICAgICAgICAgKCJUZW1wbGF0ZSBlbGVtZW50IG5vdCBmb3VuZCBvciBpcyBlbXB0eTogIiArIChvcHRpb25zLnRlbXBsYXRlKSksCiAgICAgICAgICAgICAgICB0aGlzCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAodGVtcGxhdGUubm9kZVR5cGUpIHsKICAgICAgICAgIHRlbXBsYXRlID0gdGVtcGxhdGUuaW5uZXJIVE1MOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB7CiAgICAgICAgICAgIHdhcm4oJ2ludmFsaWQgdGVtcGxhdGUgb3B0aW9uOicgKyB0ZW1wbGF0ZSwgdGhpcyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdGhpcwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChlbCkgewogICAgICAgIHRlbXBsYXRlID0gZ2V0T3V0ZXJIVE1MKGVsKTsKICAgICAgfQogICAgICBpZiAodGVtcGxhdGUpIHsKICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgICAgICBpZiAoY29uZmlnLnBlcmZvcm1hbmNlICYmIG1hcmspIHsKICAgICAgICAgIG1hcmsoJ2NvbXBpbGUnKTsKICAgICAgICB9CgogICAgICAgIHZhciByZWYgPSBjb21waWxlVG9GdW5jdGlvbnModGVtcGxhdGUsIHsKICAgICAgICAgIG91dHB1dFNvdXJjZVJhbmdlOiAiZGV2ZWxvcG1lbnQiICE9PSAncHJvZHVjdGlvbicsCiAgICAgICAgICBzaG91bGREZWNvZGVOZXdsaW5lczogc2hvdWxkRGVjb2RlTmV3bGluZXMsCiAgICAgICAgICBzaG91bGREZWNvZGVOZXdsaW5lc0ZvckhyZWY6IHNob3VsZERlY29kZU5ld2xpbmVzRm9ySHJlZiwKICAgICAgICAgIGRlbGltaXRlcnM6IG9wdGlvbnMuZGVsaW1pdGVycywKICAgICAgICAgIGNvbW1lbnRzOiBvcHRpb25zLmNvbW1lbnRzCiAgICAgICAgfSwgdGhpcyk7CiAgICAgICAgdmFyIHJlbmRlciA9IHJlZi5yZW5kZXI7CiAgICAgICAgdmFyIHN0YXRpY1JlbmRlckZucyA9IHJlZi5zdGF0aWNSZW5kZXJGbnM7CiAgICAgICAgb3B0aW9ucy5yZW5kZXIgPSByZW5kZXI7CiAgICAgICAgb3B0aW9ucy5zdGF0aWNSZW5kZXJGbnMgPSBzdGF0aWNSZW5kZXJGbnM7CgogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgICAgIGlmIChjb25maWcucGVyZm9ybWFuY2UgJiYgbWFyaykgewogICAgICAgICAgbWFyaygnY29tcGlsZSBlbmQnKTsKICAgICAgICAgIG1lYXN1cmUoKCJ2dWUgIiArICh0aGlzLl9uYW1lKSArICIgY29tcGlsZSIpLCAnY29tcGlsZScsICdjb21waWxlIGVuZCcpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIG1vdW50LmNhbGwodGhpcywgZWwsIGh5ZHJhdGluZykKICB9OwoKICAvKioKICAgKiBHZXQgb3V0ZXJIVE1MIG9mIGVsZW1lbnRzLCB0YWtpbmcgY2FyZQogICAqIG9mIFNWRyBlbGVtZW50cyBpbiBJRSBhcyB3ZWxsLgogICAqLwogIGZ1bmN0aW9uIGdldE91dGVySFRNTCAoZWwpIHsKICAgIGlmIChlbC5vdXRlckhUTUwpIHsKICAgICAgcmV0dXJuIGVsLm91dGVySFRNTAogICAgfSBlbHNlIHsKICAgICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZWwuY2xvbmVOb2RlKHRydWUpKTsKICAgICAgcmV0dXJuIGNvbnRhaW5lci5pbm5lckhUTUwKICAgIH0KICB9CgogIFZ1ZS5jb21waWxlID0gY29tcGlsZVRvRnVuY3Rpb25zOwoKICByZXR1cm4gVnVlOwoKfSkpOwo="},{"meta":{"name":"xfetch.min.js","url":"https://unpkg.com/xfetch-js@0.3.4/xfetch.min.js","ts":1698548178659,"mimetype":"text/javascript"},"source":"KChhLGIpPT57ImZ1bmN0aW9uIj09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZD9kZWZpbmUoW10sYik6Im9iamVjdCI9PXR5cGVvZiBleHBvcnRzP21vZHVsZS5leHBvcnRzPWIoKTphLnhmPWIoKX0pKHRoaXMsKCk9Pntjb25zdCBhPVsiZ2V0IiwicG9zdCIsInB1dCIsInBhdGNoIiwiZGVsZXRlIiwiaGVhZCJdO2NsYXNzIGIgZXh0ZW5kcyBFcnJvcntjb25zdHJ1Y3RvcihhKXtzdXBlcihhLnN0YXR1c1RleHQpLHRoaXMubmFtZT0iSFRUUEVycm9yIix0aGlzLnJlc3BvbnNlPWF9fWNsYXNzIGMgZXh0ZW5kcyBQcm9taXNle31mb3IoY29uc3QgYSBvZlsiYXJyYXlCdWZmZXIiLCJibG9iIiwiZm9ybURhdGEiLCJqc29uIiwidGV4dCJdKWMucHJvdG90eXBlW2FdPWZ1bmN0aW9uKGIpe3JldHVybiB0aGlzLnRoZW4oYj0+YlthXSgpKS50aGVuKGJ8fChhPT5hKSl9O2NvbnN0e2Fzc2lnbjpkfT1PYmplY3QsZT1hPT5hLnJlZHVjZSgoYSxbYixjXSk9PihhW2JdPWMsYSkse30pLGY9KC4uLmEpPT5iPT5hLnNvbWUoYT0+InN0cmluZyI9PXR5cGVvZiBhP3R5cGVvZiBiPT1hOmIgaW5zdGFuY2VvZiBhKSxnPWYoInN0cmluZyIpLGg9Zigib2JqZWN0IiksaT1hPT5nKGEpfHxoKGEpLGo9YT0+e2lmKCFhLm9rKXRocm93IG5ldyBiKGEpO3JldHVybiBhfSxrPShoPXt9KT0+e2NvbnN0IGw9KGEsYj17fSk9PntkKGIsaCk7Y29uc3Qgaz1hPT5uZXcgYi5VUkxTZWFyY2hQYXJhbXMoYSkudG9TdHJpbmcoKSxsPW5ldyBiLlVSTChhLGIuYmFzZVVSSXx8dm9pZCAwKTtpZihiLmhlYWRlcnM/ZihiLkhlYWRlcnMpKGIuaGVhZGVycykmJihiLmhlYWRlcnM9ZShbLi4uYi5oZWFkZXJzLmVudHJpZXMoKV0pKTpiLmhlYWRlcnM9e30sYi5qc29uKWIuYm9keT1KU09OLnN0cmluZ2lmeShiLmpzb24pLGIuaGVhZGVyc1siQ29udGVudC1UeXBlIl09ImFwcGxpY2F0aW9uL2pzb24iO2Vsc2UgaWYoaShiLnVybGVuY29kZWQpKWIuYm9keT1nKGIudXJsZW5jb2RlZCk/Yi51cmxlbmNvZGVkOmsoYi51cmxlbmNvZGVkKSxiLmhlYWRlcnNbIkNvbnRlbnQtVHlwZSJdPSJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiO2Vsc2UgaWYoZihiLkZvcm1EYXRhLCJvYmplY3QiKShiLmZvcm1EYXRhKSl7aWYoIWYoYi5Gb3JtRGF0YSkoYi5mb3JtRGF0YSkpe2NvbnN0IGE9bmV3IGIuRm9ybURhdGE7Zm9yKGNvbnN0W2MsZF1vZiBPYmplY3QuZW50cmllcyhiLmZvcm1EYXRhKSlhLmFwcGVuZChjLGQpO2IuZm9ybURhdGE9YX1iLmJvZHk9Yi5mb3JtRGF0YX1yZXR1cm4gYi5xcyYmKGcoYi5xcykmJihiLnFzPShhPT5lKFsuLi5uZXcgYi5VUkxTZWFyY2hQYXJhbXMoYSkuZW50cmllcygpXSkpKGIucXMpKSxsLnNlYXJjaD1rKGQoZShbLi4ubC5zZWFyY2hQYXJhbXMuZW50cmllcygpXSksYi5xcykpKSxiLmNyZWRlbnRpYWxzfHwoYi5jcmVkZW50aWFscz0ic2FtZS1vcmlnaW4iKSxjLnJlc29sdmUoYi5mZXRjaChsLGIpLnRoZW4oaikpfTtmb3IoY29uc3QgYiBvZiBhKWxbYl09KGEsYz17fSk9PihjLm1ldGhvZD1iLnRvVXBwZXJDYXNlKCksbChhLGMpKTtyZXR1cm4gbC5leHRlbmQ9YT0+ayhkKHt9LGgsYSkpLGwuSFRUUEVycm9yPWIsbH0sbD0idW5kZWZpbmVkIiE9dHlwZW9mIGRvY3VtZW50LG09InVuZGVmaW5lZCIhPXR5cGVvZiBzZWxmO3JldHVybiBtP2soe2ZldGNoOmZldGNoLmJpbmQoc2VsZiksVVJMLFJlc3BvbnNlLFVSTFNlYXJjaFBhcmFtcyxIZWFkZXJzLEZvcm1EYXRhLGJhc2VVUkk6bD9kb2N1bWVudC5iYXNlVVJJOiIifSk6aygpfSk7"},{"meta":{"name":"ffmpeg.min.js","url":"https://unpkg.com/@ffmpeg/ffmpeg@0.6.1/dist/ffmpeg.min.js","ts":1698548178661,"mimetype":"text/javascript"},"source":"IWZ1bmN0aW9uKHQsZSl7Im9iamVjdCI9PXR5cGVvZiBleHBvcnRzJiYib2JqZWN0Ij09dHlwZW9mIG1vZHVsZT9tb2R1bGUuZXhwb3J0cz1lKCk6ImZ1bmN0aW9uIj09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZD9kZWZpbmUoW10sZSk6Im9iamVjdCI9PXR5cGVvZiBleHBvcnRzP2V4cG9ydHMuRkZtcGVnPWUoKTp0LkZGbXBlZz1lKCl9KHdpbmRvdywoZnVuY3Rpb24oKXtyZXR1cm4gZnVuY3Rpb24odCl7dmFyIGU9e307ZnVuY3Rpb24gcihuKXtpZihlW25dKXJldHVybiBlW25dLmV4cG9ydHM7dmFyIG89ZVtuXT17aTpuLGw6ITEsZXhwb3J0czp7fX07cmV0dXJuIHRbbl0uY2FsbChvLmV4cG9ydHMsbyxvLmV4cG9ydHMsciksby5sPSEwLG8uZXhwb3J0c31yZXR1cm4gci5tPXQsci5jPWUsci5kPWZ1bmN0aW9uKHQsZSxuKXtyLm8odCxlKXx8T2JqZWN0LmRlZmluZVByb3BlcnR5KHQsZSx7ZW51bWVyYWJsZTohMCxnZXQ6bn0pfSxyLnI9ZnVuY3Rpb24odCl7InVuZGVmaW5lZCIhPXR5cGVvZiBTeW1ib2wmJlN5bWJvbC50b1N0cmluZ1RhZyYmT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsU3ltYm9sLnRvU3RyaW5nVGFnLHt2YWx1ZToiTW9kdWxlIn0pLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KX0sci50PWZ1bmN0aW9uKHQsZSl7aWYoMSZlJiYodD1yKHQpKSw4JmUpcmV0dXJuIHQ7aWYoNCZlJiYib2JqZWN0Ij09dHlwZW9mIHQmJnQmJnQuX19lc01vZHVsZSlyZXR1cm4gdDt2YXIgbj1PYmplY3QuY3JlYXRlKG51bGwpO2lmKHIucihuKSxPYmplY3QuZGVmaW5lUHJvcGVydHkobiwiZGVmYXVsdCIse2VudW1lcmFibGU6ITAsdmFsdWU6dH0pLDImZSYmInN0cmluZyIhPXR5cGVvZiB0KWZvcih2YXIgbyBpbiB0KXIuZChuLG8sZnVuY3Rpb24oZSl7cmV0dXJuIHRbZV19LmJpbmQobnVsbCxvKSk7cmV0dXJuIG59LHIubj1mdW5jdGlvbih0KXt2YXIgZT10JiZ0Ll9fZXNNb2R1bGU/ZnVuY3Rpb24oKXtyZXR1cm4gdC5kZWZhdWx0fTpmdW5jdGlvbigpe3JldHVybiB0fTtyZXR1cm4gci5kKGUsImEiLGUpLGV9LHIubz1mdW5jdGlvbih0LGUpe3JldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodCxlKX0sci5wPSIiLHIoci5zPTQpfShbZnVuY3Rpb24odCxlKXt2YXIgcixuLG89dC5leHBvcnRzPXt9O2Z1bmN0aW9uIGkoKXt0aHJvdyBuZXcgRXJyb3IoInNldFRpbWVvdXQgaGFzIG5vdCBiZWVuIGRlZmluZWQiKX1mdW5jdGlvbiBhKCl7dGhyb3cgbmV3IEVycm9yKCJjbGVhclRpbWVvdXQgaGFzIG5vdCBiZWVuIGRlZmluZWQiKX1mdW5jdGlvbiBjKHQpe2lmKHI9PT1zZXRUaW1lb3V0KXJldHVybiBzZXRUaW1lb3V0KHQsMCk7aWYoKHI9PT1pfHwhcikmJnNldFRpbWVvdXQpcmV0dXJuIHI9c2V0VGltZW91dCxzZXRUaW1lb3V0KHQsMCk7dHJ5e3JldHVybiByKHQsMCl9Y2F0Y2goZSl7dHJ5e3JldHVybiByLmNhbGwobnVsbCx0LDApfWNhdGNoKGUpe3JldHVybiByLmNhbGwodGhpcyx0LDApfX19IWZ1bmN0aW9uKCl7dHJ5e3I9ImZ1bmN0aW9uIj09dHlwZW9mIHNldFRpbWVvdXQ/c2V0VGltZW91dDppfWNhdGNoKHQpe3I9aX10cnl7bj0iZnVuY3Rpb24iPT10eXBlb2YgY2xlYXJUaW1lb3V0P2NsZWFyVGltZW91dDphfWNhdGNoKHQpe249YX19KCk7dmFyIHUscz1bXSxmPSExLGw9LTE7ZnVuY3Rpb24gcCgpe2YmJnUmJihmPSExLHUubGVuZ3RoP3M9dS5jb25jYXQocyk6bD0tMSxzLmxlbmd0aCYmZCgpKX1mdW5jdGlvbiBkKCl7aWYoIWYpe3ZhciB0PWMocCk7Zj0hMDtmb3IodmFyIGU9cy5sZW5ndGg7ZTspe2Zvcih1PXMscz1bXTsrK2w8ZTspdSYmdVtsXS5ydW4oKTtsPS0xLGU9cy5sZW5ndGh9dT1udWxsLGY9ITEsZnVuY3Rpb24odCl7aWYobj09PWNsZWFyVGltZW91dClyZXR1cm4gY2xlYXJUaW1lb3V0KHQpO2lmKChuPT09YXx8IW4pJiZjbGVhclRpbWVvdXQpcmV0dXJuIG49Y2xlYXJUaW1lb3V0LGNsZWFyVGltZW91dCh0KTt0cnl7bih0KX1jYXRjaChlKXt0cnl7cmV0dXJuIG4uY2FsbChudWxsLHQpfWNhdGNoKGUpe3JldHVybiBuLmNhbGwodGhpcyx0KX19fSh0KX19ZnVuY3Rpb24gaCh0LGUpe3RoaXMuZnVuPXQsdGhpcy5hcnJheT1lfWZ1bmN0aW9uIHkoKXt9by5uZXh0VGljaz1mdW5jdGlvbih0KXt2YXIgZT1uZXcgQXJyYXkoYXJndW1lbnRzLmxlbmd0aC0xKTtpZihhcmd1bWVudHMubGVuZ3RoPjEpZm9yKHZhciByPTE7cjxhcmd1bWVudHMubGVuZ3RoO3IrKyllW3ItMV09YXJndW1lbnRzW3JdO3MucHVzaChuZXcgaCh0LGUpKSwxIT09cy5sZW5ndGh8fGZ8fGMoZCl9LGgucHJvdG90eXBlLnJ1bj1mdW5jdGlvbigpe3RoaXMuZnVuLmFwcGx5KG51bGwsdGhpcy5hcnJheSl9LG8udGl0bGU9ImJyb3dzZXIiLG8uYnJvd3Nlcj0hMCxvLmVudj17fSxvLmFyZ3Y9W10sby52ZXJzaW9uPSIiLG8udmVyc2lvbnM9e30sby5vbj15LG8uYWRkTGlzdGVuZXI9eSxvLm9uY2U9eSxvLm9mZj15LG8ucmVtb3ZlTGlzdGVuZXI9eSxvLnJlbW92ZUFsbExpc3RlbmVycz15LG8uZW1pdD15LG8ucHJlcGVuZExpc3RlbmVyPXksby5wcmVwZW5kT25jZUxpc3RlbmVyPXksby5saXN0ZW5lcnM9ZnVuY3Rpb24odCl7cmV0dXJuW119LG8uYmluZGluZz1mdW5jdGlvbih0KXt0aHJvdyBuZXcgRXJyb3IoInByb2Nlc3MuYmluZGluZyBpcyBub3Qgc3VwcG9ydGVkIil9LG8uY3dkPWZ1bmN0aW9uKCl7cmV0dXJuIi8ifSxvLmNoZGlyPWZ1bmN0aW9uKHQpe3Rocm93IG5ldyBFcnJvcigicHJvY2Vzcy5jaGRpciBpcyBub3Qgc3VwcG9ydGVkIil9LG8udW1hc2s9ZnVuY3Rpb24oKXtyZXR1cm4gMH19LGZ1bmN0aW9uKHQsZSxyKXt2YXIgbixvO3ZvaWQgMD09PShvPSJmdW5jdGlvbiI9PXR5cGVvZihuPWZ1bmN0aW9uKCl7cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIHQ9YXJndW1lbnRzLmxlbmd0aDtpZigwPT09dCl0aHJvdyBuZXcgRXJyb3IoInJlc29sdmVVcmwgcmVxdWlyZXMgYXQgbGVhc3Qgb25lIGFyZ3VtZW50OyBnb3Qgbm9uZS4iKTt2YXIgZT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJiYXNlIik7aWYoZS5ocmVmPWFyZ3VtZW50c1swXSwxPT09dClyZXR1cm4gZS5ocmVmO3ZhciByPWRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJoZWFkIilbMF07ci5pbnNlcnRCZWZvcmUoZSxyLmZpcnN0Q2hpbGQpO2Zvcih2YXIgbixvPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKSxpPTE7aTx0O2krKylvLmhyZWY9YXJndW1lbnRzW2ldLG49by5ocmVmLGUuaHJlZj1uO3JldHVybiByLnJlbW92ZUNoaWxkKGUpLG59fSk/bi5jYWxsKGUscixlLHQpOm4pfHwodC5leHBvcnRzPW8pfSxmdW5jdGlvbih0LGUpe3ZhciByPXRoaXMsbj0hMTtlLmxvZ2dpbmc9bixlLnNldExvZ2dpbmc9ZnVuY3Rpb24odCl7bj10fSxlLmxvZz1mdW5jdGlvbigpe2Zvcih2YXIgdD1hcmd1bWVudHMubGVuZ3RoLGU9bmV3IEFycmF5KHQpLG89MDtvPHQ7bysrKWVbb109YXJndW1lbnRzW29dO3JldHVybiBuP2NvbnNvbGUubG9nLmFwcGx5KHIsZSk6bnVsbH19LGZ1bmN0aW9uKHQsZSl7dC5leHBvcnRzPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIiIuY29uY2F0KHQsIi0iKS5jb25jYXQoZSwiLSIpLmNvbmNhdChNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDE2KS5zbGljZSgzLDgpKX19LGZ1bmN0aW9uKHQsZSxyKXtyKDUpO3ZhciBuPXIoMiksbz1uLmxvZ2dpbmcsaT1uLnNldExvZ2dpbmcsYT1yKDYpO3QuZXhwb3J0cz17bG9nZ2luZzpvLHNldExvZ2dpbmc6aSxjcmVhdGVXb3JrZXI6YX19LGZ1bmN0aW9uKHQsZSxyKXt2YXIgbj1mdW5jdGlvbih0KXsidXNlIHN0cmljdCI7dmFyIGU9T2JqZWN0LnByb3RvdHlwZSxyPWUuaGFzT3duUHJvcGVydHksbj0iZnVuY3Rpb24iPT10eXBlb2YgU3ltYm9sP1N5bWJvbDp7fSxvPW4uaXRlcmF0b3J8fCJAQGl0ZXJhdG9yIixpPW4uYXN5bmNJdGVyYXRvcnx8IkBAYXN5bmNJdGVyYXRvciIsYT1uLnRvU3RyaW5nVGFnfHwiQEB0b1N0cmluZ1RhZyI7ZnVuY3Rpb24gYyh0LGUscixuKXt2YXIgbz1lJiZlLnByb3RvdHlwZSBpbnN0YW5jZW9mIGY/ZTpmLGk9T2JqZWN0LmNyZWF0ZShvLnByb3RvdHlwZSksYT1uZXcgaihufHxbXSk7cmV0dXJuIGkuX2ludm9rZT1mdW5jdGlvbih0LGUscil7dmFyIG49InN1c3BlbmRlZFN0YXJ0IjtyZXR1cm4gZnVuY3Rpb24obyxpKXtpZigiZXhlY3V0aW5nIj09PW4pdGhyb3cgbmV3IEVycm9yKCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBydW5uaW5nIik7aWYoImNvbXBsZXRlZCI9PT1uKXtpZigidGhyb3ciPT09byl0aHJvdyBpO3JldHVybiBrKCl9Zm9yKHIubWV0aG9kPW8sci5hcmc9aTs7KXt2YXIgYT1yLmRlbGVnYXRlO2lmKGEpe3ZhciBjPWIoYSxyKTtpZihjKXtpZihjPT09cyljb250aW51ZTtyZXR1cm4gY319aWYoIm5leHQiPT09ci5tZXRob2Qpci5zZW50PXIuX3NlbnQ9ci5hcmc7ZWxzZSBpZigidGhyb3ciPT09ci5tZXRob2Qpe2lmKCJzdXNwZW5kZWRTdGFydCI9PT1uKXRocm93IG49ImNvbXBsZXRlZCIsci5hcmc7ci5kaXNwYXRjaEV4Y2VwdGlvbihyLmFyZyl9ZWxzZSJyZXR1cm4iPT09ci5tZXRob2QmJnIuYWJydXB0KCJyZXR1cm4iLHIuYXJnKTtuPSJleGVjdXRpbmciO3ZhciBmPXUodCxlLHIpO2lmKCJub3JtYWwiPT09Zi50eXBlKXtpZihuPXIuZG9uZT8iY29tcGxldGVkIjoic3VzcGVuZGVkWWllbGQiLGYuYXJnPT09cyljb250aW51ZTtyZXR1cm57dmFsdWU6Zi5hcmcsZG9uZTpyLmRvbmV9fSJ0aHJvdyI9PT1mLnR5cGUmJihuPSJjb21wbGV0ZWQiLHIubWV0aG9kPSJ0aHJvdyIsci5hcmc9Zi5hcmcpfX19KHQscixhKSxpfWZ1bmN0aW9uIHUodCxlLHIpe3RyeXtyZXR1cm57dHlwZToibm9ybWFsIixhcmc6dC5jYWxsKGUscil9fWNhdGNoKHQpe3JldHVybnt0eXBlOiJ0aHJvdyIsYXJnOnR9fX10LndyYXA9Yzt2YXIgcz17fTtmdW5jdGlvbiBmKCl7fWZ1bmN0aW9uIGwoKXt9ZnVuY3Rpb24gcCgpe312YXIgZD17fTtkW29dPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9O3ZhciBoPU9iamVjdC5nZXRQcm90b3R5cGVPZix5PWgmJmgoaChPKFtdKSkpO3kmJnkhPT1lJiZyLmNhbGwoeSxvKSYmKGQ9eSk7dmFyIGc9cC5wcm90b3R5cGU9Zi5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZShkKTtmdW5jdGlvbiB2KHQpe1sibmV4dCIsInRocm93IiwicmV0dXJuIl0uZm9yRWFjaCgoZnVuY3Rpb24oZSl7dFtlXT1mdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5faW52b2tlKGUsdCl9fSkpfWZ1bmN0aW9uIG0odCl7dmFyIGU7dGhpcy5faW52b2tlPWZ1bmN0aW9uKG4sbyl7ZnVuY3Rpb24gaSgpe3JldHVybiBuZXcgUHJvbWlzZSgoZnVuY3Rpb24oZSxpKXshZnVuY3Rpb24gZShuLG8saSxhKXt2YXIgYz11KHRbbl0sdCxvKTtpZigidGhyb3ciIT09Yy50eXBlKXt2YXIgcz1jLmFyZyxmPXMudmFsdWU7cmV0dXJuIGYmJiJvYmplY3QiPT10eXBlb2YgZiYmci5jYWxsKGYsIl9fYXdhaXQiKT9Qcm9taXNlLnJlc29sdmUoZi5fX2F3YWl0KS50aGVuKChmdW5jdGlvbih0KXtlKCJuZXh0Iix0LGksYSl9KSwoZnVuY3Rpb24odCl7ZSgidGhyb3ciLHQsaSxhKX0pKTpQcm9taXNlLnJlc29sdmUoZikudGhlbigoZnVuY3Rpb24odCl7cy52YWx1ZT10LGkocyl9KSwoZnVuY3Rpb24odCl7cmV0dXJuIGUoInRocm93Iix0LGksYSl9KSl9YShjLmFyZyl9KG4sbyxlLGkpfSkpfXJldHVybiBlPWU/ZS50aGVuKGksaSk6aSgpfX1mdW5jdGlvbiBiKHQsZSl7dmFyIHI9dC5pdGVyYXRvcltlLm1ldGhvZF07aWYodm9pZCAwPT09cil7aWYoZS5kZWxlZ2F0ZT1udWxsLCJ0aHJvdyI9PT1lLm1ldGhvZCl7aWYodC5pdGVyYXRvci5yZXR1cm4mJihlLm1ldGhvZD0icmV0dXJuIixlLmFyZz12b2lkIDAsYih0LGUpLCJ0aHJvdyI9PT1lLm1ldGhvZCkpcmV0dXJuIHM7ZS5tZXRob2Q9InRocm93IixlLmFyZz1uZXcgVHlwZUVycm9yKCJUaGUgaXRlcmF0b3IgZG9lcyBub3QgcHJvdmlkZSBhICd0aHJvdycgbWV0aG9kIil9cmV0dXJuIHN9dmFyIG49dShyLHQuaXRlcmF0b3IsZS5hcmcpO2lmKCJ0aHJvdyI9PT1uLnR5cGUpcmV0dXJuIGUubWV0aG9kPSJ0aHJvdyIsZS5hcmc9bi5hcmcsZS5kZWxlZ2F0ZT1udWxsLHM7dmFyIG89bi5hcmc7cmV0dXJuIG8/by5kb25lPyhlW3QucmVzdWx0TmFtZV09by52YWx1ZSxlLm5leHQ9dC5uZXh0TG9jLCJyZXR1cm4iIT09ZS5tZXRob2QmJihlLm1ldGhvZD0ibmV4dCIsZS5hcmc9dm9pZCAwKSxlLmRlbGVnYXRlPW51bGwscyk6bzooZS5tZXRob2Q9InRocm93IixlLmFyZz1uZXcgVHlwZUVycm9yKCJpdGVyYXRvciByZXN1bHQgaXMgbm90IGFuIG9iamVjdCIpLGUuZGVsZWdhdGU9bnVsbCxzKX1mdW5jdGlvbiB3KHQpe3ZhciBlPXt0cnlMb2M6dFswXX07MSBpbiB0JiYoZS5jYXRjaExvYz10WzFdKSwyIGluIHQmJihlLmZpbmFsbHlMb2M9dFsyXSxlLmFmdGVyTG9jPXRbM10pLHRoaXMudHJ5RW50cmllcy5wdXNoKGUpfWZ1bmN0aW9uIHgodCl7dmFyIGU9dC5jb21wbGV0aW9ufHx7fTtlLnR5cGU9Im5vcm1hbCIsZGVsZXRlIGUuYXJnLHQuY29tcGxldGlvbj1lfWZ1bmN0aW9uIGoodCl7dGhpcy50cnlFbnRyaWVzPVt7dHJ5TG9jOiJyb290In1dLHQuZm9yRWFjaCh3LHRoaXMpLHRoaXMucmVzZXQoITApfWZ1bmN0aW9uIE8odCl7aWYodCl7dmFyIGU9dFtvXTtpZihlKXJldHVybiBlLmNhbGwodCk7aWYoImZ1bmN0aW9uIj09dHlwZW9mIHQubmV4dClyZXR1cm4gdDtpZighaXNOYU4odC5sZW5ndGgpKXt2YXIgbj0tMSxpPWZ1bmN0aW9uIGUoKXtmb3IoOysrbjx0Lmxlbmd0aDspaWYoci5jYWxsKHQsbikpcmV0dXJuIGUudmFsdWU9dFtuXSxlLmRvbmU9ITEsZTtyZXR1cm4gZS52YWx1ZT12b2lkIDAsZS5kb25lPSEwLGV9O3JldHVybiBpLm5leHQ9aX19cmV0dXJue25leHQ6a319ZnVuY3Rpb24gaygpe3JldHVybnt2YWx1ZTp2b2lkIDAsZG9uZTohMH19cmV0dXJuIGwucHJvdG90eXBlPWcuY29uc3RydWN0b3I9cCxwLmNvbnN0cnVjdG9yPWwscFthXT1sLmRpc3BsYXlOYW1lPSJHZW5lcmF0b3JGdW5jdGlvbiIsdC5pc0dlbmVyYXRvckZ1bmN0aW9uPWZ1bmN0aW9uKHQpe3ZhciBlPSJmdW5jdGlvbiI9PXR5cGVvZiB0JiZ0LmNvbnN0cnVjdG9yO3JldHVybiEhZSYmKGU9PT1sfHwiR2VuZXJhdG9yRnVuY3Rpb24iPT09KGUuZGlzcGxheU5hbWV8fGUubmFtZSkpfSx0Lm1hcms9ZnVuY3Rpb24odCl7cmV0dXJuIE9iamVjdC5zZXRQcm90b3R5cGVPZj9PYmplY3Quc2V0UHJvdG90eXBlT2YodCxwKToodC5fX3Byb3RvX189cCxhIGluIHR8fCh0W2FdPSJHZW5lcmF0b3JGdW5jdGlvbiIpKSx0LnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKGcpLHR9LHQuYXdyYXA9ZnVuY3Rpb24odCl7cmV0dXJue19fYXdhaXQ6dH19LHYobS5wcm90b3R5cGUpLG0ucHJvdG90eXBlW2ldPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9LHQuQXN5bmNJdGVyYXRvcj1tLHQuYXN5bmM9ZnVuY3Rpb24oZSxyLG4sbyl7dmFyIGk9bmV3IG0oYyhlLHIsbixvKSk7cmV0dXJuIHQuaXNHZW5lcmF0b3JGdW5jdGlvbihyKT9pOmkubmV4dCgpLnRoZW4oKGZ1bmN0aW9uKHQpe3JldHVybiB0LmRvbmU/dC52YWx1ZTppLm5leHQoKX0pKX0sdihnKSxnW2FdPSJHZW5lcmF0b3IiLGdbb109ZnVuY3Rpb24oKXtyZXR1cm4gdGhpc30sZy50b1N0cmluZz1mdW5jdGlvbigpe3JldHVybiJbb2JqZWN0IEdlbmVyYXRvcl0ifSx0LmtleXM9ZnVuY3Rpb24odCl7dmFyIGU9W107Zm9yKHZhciByIGluIHQpZS5wdXNoKHIpO3JldHVybiBlLnJldmVyc2UoKSxmdW5jdGlvbiByKCl7Zm9yKDtlLmxlbmd0aDspe3ZhciBuPWUucG9wKCk7aWYobiBpbiB0KXJldHVybiByLnZhbHVlPW4sci5kb25lPSExLHJ9cmV0dXJuIHIuZG9uZT0hMCxyfX0sdC52YWx1ZXM9TyxqLnByb3RvdHlwZT17Y29uc3RydWN0b3I6aixyZXNldDpmdW5jdGlvbih0KXtpZih0aGlzLnByZXY9MCx0aGlzLm5leHQ9MCx0aGlzLnNlbnQ9dGhpcy5fc2VudD12b2lkIDAsdGhpcy5kb25lPSExLHRoaXMuZGVsZWdhdGU9bnVsbCx0aGlzLm1ldGhvZD0ibmV4dCIsdGhpcy5hcmc9dm9pZCAwLHRoaXMudHJ5RW50cmllcy5mb3JFYWNoKHgpLCF0KWZvcih2YXIgZSBpbiB0aGlzKSJ0Ij09PWUuY2hhckF0KDApJiZyLmNhbGwodGhpcyxlKSYmIWlzTmFOKCtlLnNsaWNlKDEpKSYmKHRoaXNbZV09dm9pZCAwKX0sc3RvcDpmdW5jdGlvbigpe3RoaXMuZG9uZT0hMDt2YXIgdD10aGlzLnRyeUVudHJpZXNbMF0uY29tcGxldGlvbjtpZigidGhyb3ciPT09dC50eXBlKXRocm93IHQuYXJnO3JldHVybiB0aGlzLnJ2YWx9LGRpc3BhdGNoRXhjZXB0aW9uOmZ1bmN0aW9uKHQpe2lmKHRoaXMuZG9uZSl0aHJvdyB0O3ZhciBlPXRoaXM7ZnVuY3Rpb24gbihyLG4pe3JldHVybiBhLnR5cGU9InRocm93IixhLmFyZz10LGUubmV4dD1yLG4mJihlLm1ldGhvZD0ibmV4dCIsZS5hcmc9dm9pZCAwKSwhIW59Zm9yKHZhciBvPXRoaXMudHJ5RW50cmllcy5sZW5ndGgtMTtvPj0wOy0tbyl7dmFyIGk9dGhpcy50cnlFbnRyaWVzW29dLGE9aS5jb21wbGV0aW9uO2lmKCJyb290Ij09PWkudHJ5TG9jKXJldHVybiBuKCJlbmQiKTtpZihpLnRyeUxvYzw9dGhpcy5wcmV2KXt2YXIgYz1yLmNhbGwoaSwiY2F0Y2hMb2MiKSx1PXIuY2FsbChpLCJmaW5hbGx5TG9jIik7aWYoYyYmdSl7aWYodGhpcy5wcmV2PGkuY2F0Y2hMb2MpcmV0dXJuIG4oaS5jYXRjaExvYywhMCk7aWYodGhpcy5wcmV2PGkuZmluYWxseUxvYylyZXR1cm4gbihpLmZpbmFsbHlMb2MpfWVsc2UgaWYoYyl7aWYodGhpcy5wcmV2PGkuY2F0Y2hMb2MpcmV0dXJuIG4oaS5jYXRjaExvYywhMCl9ZWxzZXtpZighdSl0aHJvdyBuZXcgRXJyb3IoInRyeSBzdGF0ZW1lbnQgd2l0aG91dCBjYXRjaCBvciBmaW5hbGx5Iik7aWYodGhpcy5wcmV2PGkuZmluYWxseUxvYylyZXR1cm4gbihpLmZpbmFsbHlMb2MpfX19fSxhYnJ1cHQ6ZnVuY3Rpb24odCxlKXtmb3IodmFyIG49dGhpcy50cnlFbnRyaWVzLmxlbmd0aC0xO24+PTA7LS1uKXt2YXIgbz10aGlzLnRyeUVudHJpZXNbbl07aWYoby50cnlMb2M8PXRoaXMucHJldiYmci5jYWxsKG8sImZpbmFsbHlMb2MiKSYmdGhpcy5wcmV2PG8uZmluYWxseUxvYyl7dmFyIGk9bzticmVha319aSYmKCJicmVhayI9PT10fHwiY29udGludWUiPT09dCkmJmkudHJ5TG9jPD1lJiZlPD1pLmZpbmFsbHlMb2MmJihpPW51bGwpO3ZhciBhPWk/aS5jb21wbGV0aW9uOnt9O3JldHVybiBhLnR5cGU9dCxhLmFyZz1lLGk/KHRoaXMubWV0aG9kPSJuZXh0Iix0aGlzLm5leHQ9aS5maW5hbGx5TG9jLHMpOnRoaXMuY29tcGxldGUoYSl9LGNvbXBsZXRlOmZ1bmN0aW9uKHQsZSl7aWYoInRocm93Ij09PXQudHlwZSl0aHJvdyB0LmFyZztyZXR1cm4iYnJlYWsiPT09dC50eXBlfHwiY29udGludWUiPT09dC50eXBlP3RoaXMubmV4dD10LmFyZzoicmV0dXJuIj09PXQudHlwZT8odGhpcy5ydmFsPXRoaXMuYXJnPXQuYXJnLHRoaXMubWV0aG9kPSJyZXR1cm4iLHRoaXMubmV4dD0iZW5kIik6Im5vcm1hbCI9PT10LnR5cGUmJmUmJih0aGlzLm5leHQ9ZSksc30sZmluaXNoOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZT10aGlzLnRyeUVudHJpZXMubGVuZ3RoLTE7ZT49MDstLWUpe3ZhciByPXRoaXMudHJ5RW50cmllc1tlXTtpZihyLmZpbmFsbHlMb2M9PT10KXJldHVybiB0aGlzLmNvbXBsZXRlKHIuY29tcGxldGlvbixyLmFmdGVyTG9jKSx4KHIpLHN9fSxjYXRjaDpmdW5jdGlvbih0KXtmb3IodmFyIGU9dGhpcy50cnlFbnRyaWVzLmxlbmd0aC0xO2U+PTA7LS1lKXt2YXIgcj10aGlzLnRyeUVudHJpZXNbZV07aWYoci50cnlMb2M9PT10KXt2YXIgbj1yLmNvbXBsZXRpb247aWYoInRocm93Ij09PW4udHlwZSl7dmFyIG89bi5hcmc7eChyKX1yZXR1cm4gb319dGhyb3cgbmV3IEVycm9yKCJpbGxlZ2FsIGNhdGNoIGF0dGVtcHQiKX0sZGVsZWdhdGVZaWVsZDpmdW5jdGlvbih0LGUscil7cmV0dXJuIHRoaXMuZGVsZWdhdGU9e2l0ZXJhdG9yOk8odCkscmVzdWx0TmFtZTplLG5leHRMb2M6cn0sIm5leHQiPT09dGhpcy5tZXRob2QmJih0aGlzLmFyZz12b2lkIDApLHN9fSx0fSh0LmV4cG9ydHMpO3RyeXtyZWdlbmVyYXRvclJ1bnRpbWU9bn1jYXRjaCh0KXtGdW5jdGlvbigiciIsInJlZ2VuZXJhdG9yUnVudGltZSA9IHIiKShuKX19LGZ1bmN0aW9uKHQsZSxyKXtmdW5jdGlvbiBuKHQsZSxyLG4sbyxpLGEpe3RyeXt2YXIgYz10W2ldKGEpLHU9Yy52YWx1ZX1jYXRjaCh0KXtyZXR1cm4gdm9pZCByKHQpfWMuZG9uZT9lKHUpOlByb21pc2UucmVzb2x2ZSh1KS50aGVuKG4sbyl9ZnVuY3Rpb24gbyh0KXtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgZT10aGlzLHI9YXJndW1lbnRzO3JldHVybiBuZXcgUHJvbWlzZSgoZnVuY3Rpb24obyxpKXt2YXIgYT10LmFwcGx5KGUscik7ZnVuY3Rpb24gYyh0KXtuKGEsbyxpLGMsdSwibmV4dCIsdCl9ZnVuY3Rpb24gdSh0KXtuKGEsbyxpLGMsdSwidGhyb3ciLHQpfWModm9pZCAwKX0pKX19ZnVuY3Rpb24gaSh0LGUpe3ZhciByPU9iamVjdC5rZXlzKHQpO2lmKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpe3ZhciBuPU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHModCk7ZSYmKG49bi5maWx0ZXIoKGZ1bmN0aW9uKGUpe3JldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHQsZSkuZW51bWVyYWJsZX0pKSksci5wdXNoLmFwcGx5KHIsbil9cmV0dXJuIHJ9ZnVuY3Rpb24gYSh0KXtmb3IodmFyIGU9MTtlPGFyZ3VtZW50cy5sZW5ndGg7ZSsrKXt2YXIgcj1udWxsIT1hcmd1bWVudHNbZV0/YXJndW1lbnRzW2VdOnt9O2UlMj9pKHIsITApLmZvckVhY2goKGZ1bmN0aW9uKGUpe2ModCxlLHJbZV0pfSkpOk9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzP09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHQsT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMocikpOmkocikuZm9yRWFjaCgoZnVuY3Rpb24oZSl7T2JqZWN0LmRlZmluZVByb3BlcnR5KHQsZSxPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHIsZSkpfSkpfXJldHVybiB0fWZ1bmN0aW9uIGModCxlLHIpe3JldHVybiBlIGluIHQ/T2JqZWN0LmRlZmluZVByb3BlcnR5KHQsZSx7dmFsdWU6cixlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMCx3cml0YWJsZTohMH0pOnRbZV09cix0fWZ1bmN0aW9uIHUodCxlKXtpZihudWxsPT10KXJldHVybnt9O3ZhciByLG4sbz1mdW5jdGlvbih0LGUpe2lmKG51bGw9PXQpcmV0dXJue307dmFyIHIsbixvPXt9LGk9T2JqZWN0LmtleXModCk7Zm9yKG49MDtuPGkubGVuZ3RoO24rKylyPWlbbl0sZS5pbmRleE9mKHIpPj0wfHwob1tyXT10W3JdKTtyZXR1cm4gb30odCxlKTtpZihPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKXt2YXIgaT1PYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKHQpO2ZvcihuPTA7bjxpLmxlbmd0aDtuKyspcj1pW25dLGUuaW5kZXhPZihyKT49MHx8T2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKHQscikmJihvW3JdPXRbcl0pfXJldHVybiBvfXZhciBzPXIoNyksZj1yKDIpLmxvZyxsPXIoMykscD1yKDgpLGQ9cig5KSxoPXIoMTIpLHk9cigxMyksZz15LmRlZmF1bHRPcHRpb25zLHY9eS5zcGF3bldvcmtlcixtPXkub25NZXNzYWdlLGI9eS5mZXRjaEZpbGUsdz0wO3QuZXhwb3J0cz1mdW5jdGlvbigpe3ZhciB0PWFyZ3VtZW50cy5sZW5ndGg+MCYmdm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXTp7fSxlPWwoIldvcmtlciIsdykscj1kKGEoe30sZyx7fSx0KSksbj1yLmxvZ2dlcixpPXIucHJvZ3Jlc3MsYz11KHIsWyJsb2dnZXIiLCJwcm9ncmVzcyJdKSx5PXt9LHg9e30saj12KGMpO3crPTE7dmFyIE89ZnVuY3Rpb24odCxlKXt5W3RdPWV9LGs9ZnVuY3Rpb24odCxlKXt4W3RdPWV9LFA9ZnVuY3Rpb24odCl7dmFyIHI9dC5pZCxuPXQuYWN0aW9uLG89dC5wYXlsb2FkO3JldHVybiBuZXcgUHJvbWlzZSgoZnVuY3Rpb24odCxpKXt2YXIgYT17d29ya2VySWQ6ZSxqb2JJZDpyLGFjdGlvbjpuLHBheWxvYWQ6b307ZigiWyIuY29uY2F0KGUsIl06IFN0YXJ0ICIpLmNvbmNhdChyLCIsIGFjdGlvbj0iKS5jb25jYXQobikpLE8obix0KSxrKG4saSksai5wb3N0TWVzc2FnZShhLGgoYSkpfSkpfSxFPWZ1bmN0aW9uKHQpe3JldHVybiBQKHMoe2lkOnQsYWN0aW9uOiJsb2FkIixwYXlsb2FkOntvcHRpb25zOmN9fSkpfSxMPWZ1bmN0aW9uKCl7dmFyIHQ9byhyZWdlbmVyYXRvclJ1bnRpbWUubWFyaygoZnVuY3Rpb24gdChlLHIsbil7cmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKChmdW5jdGlvbih0KXtmb3IoOzspc3dpdGNoKHQucHJldj10Lm5leHQpe2Nhc2UgMDpyZXR1cm4gdC50MD1QLHQudDE9cyx0LnQyPW4sdC50Mz1lLHQubmV4dD02LGIocik7Y2FzZSA2OnJldHVybiB0LnQ0PXQuc2VudCx0LnQ1PVt0LnQzLHQudDRdLHQudDY9e21ldGhvZDoid3JpdGVGaWxlIixhcmdzOnQudDV9LHQudDc9e2lkOnQudDIsYWN0aW9uOiJGUyIscGF5bG9hZDp0LnQ2fSx0LnQ4PSgwLHQudDEpKHQudDcpLHQuYWJydXB0KCJyZXR1cm4iLCgwLHQudDApKHQudDgpKTtjYXNlIDEyOmNhc2UiZW5kIjpyZXR1cm4gdC5zdG9wKCl9fSksdCl9KSkpO3JldHVybiBmdW5jdGlvbihlLHIsbil7cmV0dXJuIHQuYXBwbHkodGhpcyxhcmd1bWVudHMpfX0oKSxTPWZ1bmN0aW9uKHQsZSxyKXtyZXR1cm4gUChzKHtpZDpyLGFjdGlvbjoiRlMiLHBheWxvYWQ6e21ldGhvZDoid3JpdGVGaWxlIixhcmdzOlt0LGVdfX0pKX0sRj1mdW5jdGlvbih0LGUpe3JldHVybiBQKHMoe2lkOmUsYWN0aW9uOiJGUyIscGF5bG9hZDp7bWV0aG9kOiJyZWFkRmlsZSIsYXJnczpbdF19fSkpfSxUPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIFAocyh7aWQ6ZSxhY3Rpb246IkZTIixwYXlsb2FkOnttZXRob2Q6InVubGluayIsYXJnczpbdF19fSkpfSxfPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIFAocyh7aWQ6ZSxhY3Rpb246InJ1biIscGF5bG9hZDp7YXJnczp0fX0pKX0sQT1mdW5jdGlvbih0LGUpe3JldHVybiBQKHMoe2lkOmUsYWN0aW9uOiJGUyIscGF5bG9hZDp7bWV0aG9kOiJyZWFkZGlyIixhcmdzOlt0XX19KSl9LFI9ZnVuY3Rpb24odCxlKXt2YXIgcj1hcmd1bWVudHMubGVuZ3RoPjImJnZvaWQgMCE9PWFyZ3VtZW50c1syXT9hcmd1bWVudHNbMl06IiIsbj1hcmd1bWVudHMubGVuZ3RoPjM/YXJndW1lbnRzWzNdOnZvaWQgMDtyZXR1cm4gXygiLWkgIi5jb25jYXQodCwiICIpLmNvbmNhdChyLCIgIikuY29uY2F0KGUpLG4pfSxEPWZ1bmN0aW9uKHQsZSxyLG4pe3ZhciBvPWFyZ3VtZW50cy5sZW5ndGg+NCYmdm9pZCAwIT09YXJndW1lbnRzWzRdP2FyZ3VtZW50c1s0XToiIixpPWFyZ3VtZW50cy5sZW5ndGg+NT9hcmd1bWVudHNbNV06dm9pZCAwO3JldHVybiBfKCItaSAiLmNvbmNhdCh0LCIgLXNzICIpLmNvbmNhdChyLCIgLXRvICIpLmNvbmNhdChuLCIgIikuY29uY2F0KG8sIiAiKS5jb25jYXQoZSksaSl9LEk9ZnVuY3Rpb24oKXt2YXIgdD1vKHJlZ2VuZXJhdG9yUnVudGltZS5tYXJrKChmdW5jdGlvbiB0KGUscil7dmFyIG4sbyxpLGE9YXJndW1lbnRzO3JldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcCgoZnVuY3Rpb24odCl7Zm9yKDs7KXN3aXRjaCh0LnByZXY9dC5uZXh0KXtjYXNlIDA6cmV0dXJuIG49YS5sZW5ndGg+MiYmdm9pZCAwIT09YVsyXT9hWzJdOiIiLG89YS5sZW5ndGg+Mz9hWzNdOnZvaWQgMCxpPWUucmVkdWNlKChmdW5jdGlvbih0LGUpe3JldHVybiIiLmNvbmNhdCh0LCJcbmZpbGUgIikuY29uY2F0KGUpfSksIiIpLHQubmV4dD01LFMoImNvbmNhdF9saXN0LnR4dCIsaSk7Y2FzZSA1OnJldHVybiB0LmFicnVwdCgicmV0dXJuIixfKCItZiBjb25jYXQgLXNhZmUgMCAtaSBjb25jYXRfbGlzdC50eHQgIi5jb25jYXQobiwiICIpLmNvbmNhdChyKSxvKSk7Y2FzZSA2OmNhc2UiZW5kIjpyZXR1cm4gdC5zdG9wKCl9fSksdCl9KSkpO3JldHVybiBmdW5jdGlvbihlLHIpe3JldHVybiB0LmFwcGx5KHRoaXMsYXJndW1lbnRzKX19KCksVz1mdW5jdGlvbigpe3ZhciB0PW8ocmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoKGZ1bmN0aW9uIHQoZSl7cmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKChmdW5jdGlvbih0KXtmb3IoOzspc3dpdGNoKHQucHJldj10Lm5leHQpe2Nhc2UgMDppZihudWxsPT09ail7dC5uZXh0PTU7YnJlYWt9cmV0dXJuIHQubmV4dD0zLFAocyh7aWQ6ZSxhY3Rpb246InRlcm1pbmF0ZSJ9KSk7Y2FzZSAzOmoudGVybWluYXRlKCksaj1udWxsO2Nhc2UgNTpyZXR1cm4gdC5hYnJ1cHQoInJldHVybiIsUHJvbWlzZS5yZXNvbHZlKCkpO2Nhc2UgNjpjYXNlImVuZCI6cmV0dXJuIHQuc3RvcCgpfX0pLHQpfSkpKTtyZXR1cm4gZnVuY3Rpb24oZSl7cmV0dXJuIHQuYXBwbHkodGhpcyxhcmd1bWVudHMpfX0oKTtyZXR1cm4gbShqLChmdW5jdGlvbih0KXt2YXIgZT10LndvcmtlcklkLHI9dC5qb2JJZCxvPXQuYWN0aW9uLGE9dC5zdGF0dXMsYz10LnBheWxvYWQ7aWYoInJlc29sdmUiPT09YSl7dmFyIHU9Yy5tZXNzYWdlLHM9Yy5kYXRhO2YoIlsiLmNvbmNhdChlLCJdOiBDb21wbGV0ZSAiKS5jb25jYXQocikpLHlbb10oe3dvcmtlcklkOmUsam9iSWQ6cixtZXNzYWdlOnUsZGF0YTpzfSl9ZWxzZXtpZigicmVqZWN0Ij09PWEpdGhyb3cgeFtvXShjKSxFcnJvcihjKTsicHJvZ3Jlc3MiPT09YSYmKHAoYyxpKSxuKGMpKX19KSkse2lkOmUsd29ya2VyOmosc2V0UmVzb2x2ZTpPLHNldFJlamVjdDprLGxvYWQ6RSx3cml0ZTpMLHdyaXRlVGV4dDpTLHJlYWQ6RixyZW1vdmU6VCxsczpBLHJ1bjpfLHRyYW5zY29kZTpSLHRyaW06RCxjb25jYXREZW11eGVyOkksdGVybWluYXRlOld9fX0sZnVuY3Rpb24odCxlLHIpe3ZhciBuPXIoMyksbz0wO3QuZXhwb3J0cz1mdW5jdGlvbih0KXt2YXIgZT10LmlkLHI9dC5hY3Rpb24saT10LnBheWxvYWQsYT12b2lkIDA9PT1pP3t9OmksYz1lO3JldHVybiB2b2lkIDA9PT1jJiYoYz1uKCJKb2IiLG8pLG8rPTEpLHtpZDpjLGFjdGlvbjpyLHBheWxvYWQ6YX19fSxmdW5jdGlvbih0LGUpe2Z1bmN0aW9uIHIodCxlKXtyZXR1cm4gZnVuY3Rpb24odCl7aWYoQXJyYXkuaXNBcnJheSh0KSlyZXR1cm4gdH0odCl8fGZ1bmN0aW9uKHQsZSl7aWYoIShTeW1ib2wuaXRlcmF0b3IgaW4gT2JqZWN0KHQpfHwiW29iamVjdCBBcmd1bWVudHNdIj09PU9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh0KSkpcmV0dXJuO3ZhciByPVtdLG49ITAsbz0hMSxpPXZvaWQgMDt0cnl7Zm9yKHZhciBhLGM9dFtTeW1ib2wuaXRlcmF0b3JdKCk7IShuPShhPWMubmV4dCgpKS5kb25lKSYmKHIucHVzaChhLnZhbHVlKSwhZXx8ci5sZW5ndGghPT1lKTtuPSEwKTt9Y2F0Y2godCl7bz0hMCxpPXR9ZmluYWxseXt0cnl7bnx8bnVsbD09Yy5yZXR1cm58fGMucmV0dXJuKCl9ZmluYWxseXtpZihvKXRocm93IGl9fXJldHVybiByfSh0LGUpfHxmdW5jdGlvbigpe3Rocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UiKX0oKX12YXIgbj0wLG89ZnVuY3Rpb24odCl7dmFyIGU9cih0LnNwbGl0KCI6IiksMyksbj1lWzBdLG89ZVsxXSxpPWVbMl07cmV0dXJuIDYwKnBhcnNlRmxvYXQobikqNjArNjAqcGFyc2VGbG9hdChvKStwYXJzZUZsb2F0KGkpfTt0LmV4cG9ydHM9ZnVuY3Rpb24odCxlKXt2YXIgcj10Lm1lc3NhZ2U7aWYoInN0cmluZyI9PXR5cGVvZiByKWlmKHIuc3RhcnRzV2l0aCgiICBEdXJhdGlvbiIpKXt2YXIgaT1yLnNwbGl0KCIsICIpWzBdLnNwbGl0KCI6ICIpWzFdLGE9byhpKTsoMD09PW58fG4+YSkmJihuPWEpfWVsc2UgaWYoci5zdGFydHNXaXRoKCJmcmFtZSIpKXt2YXIgYz1yLnNwbGl0KCJ0aW1lPSIpWzFdLnNwbGl0KCIgIilbMF07ZSh7cmF0aW86byhjKS9ufSl9ZWxzZSByLnN0YXJ0c1dpdGgoInZpZGVvOiIpJiZlKHtyYXRpbzoxfSl9fSxmdW5jdGlvbih0LGUscil7ZnVuY3Rpb24gbih0LGUpe3ZhciByPU9iamVjdC5rZXlzKHQpO2lmKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpe3ZhciBuPU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHModCk7ZSYmKG49bi5maWx0ZXIoKGZ1bmN0aW9uKGUpe3JldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHQsZSkuZW51bWVyYWJsZX0pKSksci5wdXNoLmFwcGx5KHIsbil9cmV0dXJuIHJ9ZnVuY3Rpb24gbyh0LGUscil7cmV0dXJuIGUgaW4gdD9PYmplY3QuZGVmaW5lUHJvcGVydHkodCxlLHt2YWx1ZTpyLGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwLHdyaXRhYmxlOiEwfSk6dFtlXT1yLHR9dmFyIGk9ImJyb3dzZXIiPT09cigxMCkoInR5cGUiKT9yKDEpOmZ1bmN0aW9uKHQpe3JldHVybiB0fTt0LmV4cG9ydHM9ZnVuY3Rpb24odCl7dmFyIGU9ZnVuY3Rpb24odCl7Zm9yKHZhciBlPTE7ZTxhcmd1bWVudHMubGVuZ3RoO2UrKyl7dmFyIHI9bnVsbCE9YXJndW1lbnRzW2VdP2FyZ3VtZW50c1tlXTp7fTtlJTI/bihyLCEwKS5mb3JFYWNoKChmdW5jdGlvbihlKXtvKHQsZSxyW2VdKX0pKTpPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycz9PYmplY3QuZGVmaW5lUHJvcGVydGllcyh0LE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHIpKTpuKHIpLmZvckVhY2goKGZ1bmN0aW9uKGUpe09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LGUsT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihyLGUpKX0pKX1yZXR1cm4gdH0oe30sdCk7cmV0dXJuWyJjb3JlUGF0aCIsIndvcmtlclBhdGgiXS5mb3JFYWNoKChmdW5jdGlvbihyKXt2b2lkIDAhPT10W3JdJiYoZVtyXT1pKGVbcl0pKX0pKSxlfX0sZnVuY3Rpb24odCxlLHIpeyhmdW5jdGlvbihlKXtmdW5jdGlvbiBuKHQpe3JldHVybihuPSJmdW5jdGlvbiI9PXR5cGVvZiBTeW1ib2wmJiJzeW1ib2wiPT10eXBlb2YgU3ltYm9sLml0ZXJhdG9yP2Z1bmN0aW9uKHQpe3JldHVybiB0eXBlb2YgdH06ZnVuY3Rpb24odCl7cmV0dXJuIHQmJiJmdW5jdGlvbiI9PXR5cGVvZiBTeW1ib2wmJnQuY29uc3RydWN0b3I9PT1TeW1ib2wmJnQhPT1TeW1ib2wucHJvdG90eXBlPyJzeW1ib2wiOnR5cGVvZiB0fSkodCl9dmFyIG89cigxMSk7dC5leHBvcnRzPWZ1bmN0aW9uKHQpe3ZhciByPXt9O3JldHVybiBvKCk/ci50eXBlPSJlbGVjdHJvbiI6Im9iamVjdCI9PT0oInVuZGVmaW5lZCI9PXR5cGVvZiB3aW5kb3c/InVuZGVmaW5lZCI6bih3aW5kb3cpKT9yLnR5cGU9ImJyb3dzZXIiOiJmdW5jdGlvbiI9PXR5cGVvZiBpbXBvcnRTY3JpcHRzP3IudHlwZT0id2Vid29ya2VyIjoib2JqZWN0Ij09PSh2b2lkIDA9PT1lPyJ1bmRlZmluZWQiOm4oZSkpJiYoci50eXBlPSJub2RlIiksdm9pZCAwPT09dD9yOnJbdF19fSkuY2FsbCh0aGlzLHIoMCkpfSxmdW5jdGlvbih0LGUscil7KGZ1bmN0aW9uKGUpe3QuZXhwb3J0cz1mdW5jdGlvbigpe3JldHVybiJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93JiYib2JqZWN0Ij09dHlwZW9mIHdpbmRvdy5wcm9jZXNzJiYicmVuZGVyZXIiPT09d2luZG93LnByb2Nlc3MudHlwZXx8KCEodm9pZCAwPT09ZXx8Im9iamVjdCIhPXR5cGVvZiBlLnZlcnNpb25zfHwhZS52ZXJzaW9ucy5lbGVjdHJvbil8fCJvYmplY3QiPT10eXBlb2YgbmF2aWdhdG9yJiYic3RyaW5nIj09dHlwZW9mIG5hdmlnYXRvci51c2VyQWdlbnQmJm5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiRWxlY3Ryb24iKT49MCl9fSkuY2FsbCh0aGlzLHIoMCkpfSxmdW5jdGlvbih0LGUpe3QuZXhwb3J0cz1mdW5jdGlvbih0KXt2YXIgZT1bXSxyPWZ1bmN0aW9uKHQpe3QgaW5zdGFuY2VvZiBVaW50OEFycmF5P2UucHVzaCh0LmJ1ZmZlcik6dCBpbnN0YW5jZW9mIEFycmF5QnVmZmVyJiZlLnB1c2godCl9LG49dC5wYXlsb2FkLG89bi5hcmdzLGk9bi5kYXRhO3JldHVybiByKGkpLEFycmF5LmlzQXJyYXkobykmJm8uZm9yRWFjaCgoZnVuY3Rpb24odCl7cmV0dXJuIHIodCl9KSksZX19LGZ1bmN0aW9uKHQsZSxyKXt2YXIgbj1yKDE0KSxvPXIoMTcpLGk9cigxOCksYT1yKDE5KTt0LmV4cG9ydHM9e2RlZmF1bHRPcHRpb25zOm4sc3Bhd25Xb3JrZXI6byxvbk1lc3NhZ2U6aSxmZXRjaEZpbGU6YX19LGZ1bmN0aW9uKHQsZSxyKXsoZnVuY3Rpb24oZSl7ZnVuY3Rpb24gbih0LGUpe3ZhciByPU9iamVjdC5rZXlzKHQpO2lmKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpe3ZhciBuPU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHModCk7ZSYmKG49bi5maWx0ZXIoKGZ1bmN0aW9uKGUpe3JldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHQsZSkuZW51bWVyYWJsZX0pKSksci5wdXNoLmFwcGx5KHIsbil9cmV0dXJuIHJ9ZnVuY3Rpb24gbyh0LGUscil7cmV0dXJuIGUgaW4gdD9PYmplY3QuZGVmaW5lUHJvcGVydHkodCxlLHt2YWx1ZTpyLGVudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwLHdyaXRhYmxlOiEwfSk6dFtlXT1yLHR9dmFyIGk9cigxKSxhPXIoMTUpLGM9YS52ZXJzaW9uLHU9YS5kZXBlbmRlbmNpZXMscz1yKDE2KTt0LmV4cG9ydHM9ZnVuY3Rpb24odCl7Zm9yKHZhciBlPTE7ZTxhcmd1bWVudHMubGVuZ3RoO2UrKyl7dmFyIHI9bnVsbCE9YXJndW1lbnRzW2VdP2FyZ3VtZW50c1tlXTp7fTtlJTI/bihyLCEwKS5mb3JFYWNoKChmdW5jdGlvbihlKXtvKHQsZSxyW2VdKX0pKTpPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycz9PYmplY3QuZGVmaW5lUHJvcGVydGllcyh0LE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHIpKTpuKHIpLmZvckVhY2goKGZ1bmN0aW9uKGUpe09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LGUsT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihyLGUpKX0pKX1yZXR1cm4gdH0oe30scyx7d29ya2VyUGF0aDp2b2lkIDAhPT1lJiYiZGV2ZWxvcG1lbnQiPT09ZS5lbnYuRkZNUEVHX0VOVj9pKCIvZGlzdC93b3JrZXIuZGV2LmpzP25vY2FjaGU9Ii5jb25jYXQoTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMykpKToiaHR0cHM6Ly91bnBrZy5jb20vQGZmbXBlZy9mZm1wZWdAdiIuY29uY2F0KGMsIi9kaXN0L3dvcmtlci5taW4uanMiKSxjb3JlUGF0aDoiaHR0cHM6Ly91bnBrZy5jb20vQGZmbXBlZy9jb3JlQHYiLmNvbmNhdCh1WyJAZmZtcGVnL2NvcmUiXS5zdWJzdHJpbmcoMSksIi9mZm1wZWctY29yZS5qcyIpLHdvcmtlckJsb2JVUkw6ITB9KX0pLmNhbGwodGhpcyxyKDApKX0sZnVuY3Rpb24odCl7dC5leHBvcnRzPUpTT04ucGFyc2UoJ3sibmFtZSI6IkBmZm1wZWcvZmZtcGVnIiwidmVyc2lvbiI6IjAuNi4xIiwiZGVzY3JpcHRpb24iOiJGRm1wZWcgV2ViQXNzZW1ibHkgdmVyc2lvbiIsIm1haW4iOiJzcmMvaW5kZXguanMiLCJkaXJlY3RvcmllcyI6eyJleGFtcGxlIjoiZXhhbXBsZXMifSwic2NyaXB0cyI6eyJzdGFydCI6Im5vZGUgc2NyaXB0cy9zZXJ2ZXIuanMiLCJidWlsZCI6InJpbXJhZiBkaXN0ICYmIHdlYnBhY2sgLS1jb25maWcgc2NyaXB0cy93ZWJwYWNrLmNvbmZpZy5wcm9kLmpzIiwicHJlcHVibGlzaE9ubHkiOiJucG0gcnVuIGJ1aWxkIiwibGludCI6ImVzbGludCBzcmMiLCJ3YWl0IjoicmltcmFmIGRpc3QgJiYgd2FpdC1vbiBodHRwOi8vbG9jYWxob3N0OjMwMDAvZGlzdC9mZm1wZWcuZGV2LmpzIiwidGVzdCI6Im5wbS1ydW4tYWxsIC1wIC1yIHN0YXJ0IHRlc3Q6YWxsIiwidGVzdDphbGwiOiJucG0tcnVuLWFsbCB3YWl0IHRlc3Q6YnJvd3NlcjpmZm1wZWcgdGVzdDpub2RlOmFsbCIsInRlc3Q6bm9kZSI6Im55YyBtb2NoYSAtLWV4aXQgLS1iYWlsIC0tcmVxdWlyZSAuL3NjcmlwdHMvdGVzdC1oZWxwZXIuanMiLCJ0ZXN0Om5vZGU6YWxsIjoibnBtIHJ1biB0ZXN0Om5vZGUgLS0gLi90ZXN0cy8qLnRlc3QuanMiLCJ0ZXN0OmJyb3dzZXIiOiJtb2NoYS1oZWFkbGVzcy1jaHJvbWUgLWEgaW5jb2duaXRvIC1hIG5vLXNhbmRib3ggLWEgZGlzYWJsZS1zZXR1aWQtc2FuZGJveCAtYSBkaXNhYmxlLWxvZ2dpbmcgLXQgMzAwMDAwIiwidGVzdDpicm93c2VyOmZmbXBlZyI6Im5wbSBydW4gdGVzdDpicm93c2VyIC0tIC1mIC4vdGVzdHMvZmZtcGVnLnRlc3QuaHRtbCJ9LCJicm93c2VyIjp7Ii4vc3JjL3dvcmtlci9ub2RlL2luZGV4LmpzIjoiLi9zcmMvd29ya2VyL2Jyb3dzZXIvaW5kZXguanMifSwicmVwb3NpdG9yeSI6eyJ0eXBlIjoiZ2l0IiwidXJsIjoiZ2l0K2h0dHBzOi8vZ2l0aHViLmNvbS9mZm1wZWdqcy9mZm1wZWcuanMuZ2l0In0sImtleXdvcmRzIjpbImZmbXBlZyIsIldlYkFzc2VtYmx5IiwidmlkZW8iXSwiYXV0aG9yIjoiSmVyb21lIFd1IDxqZXJvbWV3dXNAZ21haWwuY29tPiIsImxpY2Vuc2UiOiJNSVQiLCJidWdzIjp7InVybCI6Imh0dHBzOi8vZ2l0aHViLmNvbS9mZm1wZWdqcy9mZm1wZWcuanMvaXNzdWVzIn0sImVuZ2luZXMiOnsibm9kZSI6Ij49MTAuNS4wIn0sImhvbWVwYWdlIjoiaHR0cHM6Ly9naXRodWIuY29tL2ZmbXBlZ2pzL2ZmbXBlZy5qcyNyZWFkbWUiLCJkZXBlbmRlbmNpZXMiOnsiQGZmbXBlZy9jb3JlIjoiXjAuNi4wIiwiaWRiIjoiXjQuMC41IiwiaXMtZWxlY3Ryb24iOiJeMi4yLjAiLCJpcy11cmwiOiJeMS4yLjQiLCJub2RlLWZldGNoIjoiXjIuNi4wIiwicmVnZW5lcmF0b3ItcnVudGltZSI6Il4wLjEzLjMiLCJyZXNvbHZlLXVybCI6Il4wLjIuMSJ9LCJkZXZEZXBlbmRlbmNpZXMiOnsiQGJhYmVsL2NvcmUiOiJeNy42LjQiLCJAYmFiZWwvcHJlc2V0LWVudiI6Il43LjYuMyIsImJhYmVsLWxvYWRlciI6Il44LjAuNiIsImNvcnMiOiJeMi44LjUiLCJlc2xpbnQiOiJeNi4xLjAiLCJlc2xpbnQtY29uZmlnLWFpcmJuYi1iYXNlIjoiXjE0LjAuMCIsImVzbGludC1wbHVnaW4taW1wb3J0IjoiXjIuMTguMiIsImV4cGVjdC5qcyI6Il4wLjMuMSIsImV4cHJlc3MiOiJeNC4xNy4xIiwibW9jaGEiOiJeNi4yLjIiLCJtb2NoYS1oZWFkbGVzcy1jaHJvbWUiOiJeMi4wLjMiLCJucG0tcnVuLWFsbCI6Il40LjEuNSIsIm55YyI6Il4xNC4xLjEiLCJ3YWl0LW9uIjoiXjMuMy4wIiwid2VicGFjayI6Il40LjQxLjIiLCJ3ZWJwYWNrLWNsaSI6Il4zLjMuOSIsIndlYnBhY2stZGV2LW1pZGRsZXdhcmUiOiJeMy43LjIifX0nKX0sZnVuY3Rpb24odCxlKXt0LmV4cG9ydHM9e2xvZ2dlcjpmdW5jdGlvbigpe30scHJvZ3Jlc3M6ZnVuY3Rpb24oKXt9fX0sZnVuY3Rpb24odCxlKXt0LmV4cG9ydHM9ZnVuY3Rpb24odCl7dmFyIGUscj10LndvcmtlclBhdGgsbj10LndvcmtlckJsb2JVUkw7aWYoQmxvYiYmVVJMJiZuKXt2YXIgbz1uZXcgQmxvYihbJ2ltcG9ydFNjcmlwdHMoIicuY29uY2F0KHIsJyIpOycpXSx7dHlwZToiYXBwbGljYXRpb24vamF2YXNjcmlwdCJ9KTtlPW5ldyBXb3JrZXIoVVJMLmNyZWF0ZU9iamVjdFVSTChvKSl9ZWxzZSBlPW5ldyBXb3JrZXIocik7cmV0dXJuIGV9fSxmdW5jdGlvbih0LGUpe3QuZXhwb3J0cz1mdW5jdGlvbih0LGUpe3Qub25tZXNzYWdlPWZ1bmN0aW9uKHQpe3ZhciByPXQuZGF0YTtlKHIpfX19LGZ1bmN0aW9uKHQsZSxyKXtmdW5jdGlvbiBuKHQsZSxyLG4sbyxpLGEpe3RyeXt2YXIgYz10W2ldKGEpLHU9Yy52YWx1ZX1jYXRjaCh0KXtyZXR1cm4gdm9pZCByKHQpfWMuZG9uZT9lKHUpOlByb21pc2UucmVzb2x2ZSh1KS50aGVuKG4sbyl9dmFyIG89cigxKSxpPWZ1bmN0aW9uKHQpe3JldHVybiBuZXcgUHJvbWlzZSgoZnVuY3Rpb24oZSxyKXt2YXIgbj1uZXcgRmlsZVJlYWRlcjtuLm9ubG9hZD1mdW5jdGlvbigpe2Uobi5yZXN1bHQpfSxuLm9uZXJyb3I9ZnVuY3Rpb24odCl7dmFyIGU9dC50YXJnZXQuZXJyb3IuY29kZTtyKEVycm9yKCJGaWxlIGNvdWxkIG5vdCBiZSByZWFkISBDb2RlPSIuY29uY2F0KGUpKSl9LG4ucmVhZEFzQXJyYXlCdWZmZXIodCl9KSl9O3QuZXhwb3J0cz1mdW5jdGlvbigpe3ZhciB0LGU9KHQ9cmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoKGZ1bmN0aW9uIHQoZSl7dmFyIHIsbjtyZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoKGZ1bmN0aW9uKHQpe2Zvcig7Oylzd2l0Y2godC5wcmV2PXQubmV4dCl7Y2FzZSAwOmlmKHI9ZSx2b2lkIDAhPT1lKXt0Lm5leHQ9MzticmVha31yZXR1cm4gdC5hYnJ1cHQoInJldHVybiIsInVuZGVmaW5lZCIpO2Nhc2UgMzppZigic3RyaW5nIiE9dHlwZW9mIGUpe3QubmV4dD0xNjticmVha31pZighL2RhdGE6X2RhdGFcLyhbYS16QS1aXSopO2Jhc2U2NCwoW14iXSopLy50ZXN0KGUpKXt0Lm5leHQ9ODticmVha31yPWF0b2IoZS5zcGxpdCgiLCIpWzFdKS5zcGxpdCgiIikubWFwKChmdW5jdGlvbih0KXtyZXR1cm4gdC5jaGFyQ29kZUF0KDApfSkpLHQubmV4dD0xNDticmVhaztjYXNlIDg6cmV0dXJuIHQubmV4dD0xMCxmZXRjaChvKGUpKTtjYXNlIDEwOnJldHVybiBuPXQuc2VudCx0Lm5leHQ9MTMsbi5hcnJheUJ1ZmZlcigpO2Nhc2UgMTM6cj10LnNlbnQ7Y2FzZSAxNDp0Lm5leHQ9MjA7YnJlYWs7Y2FzZSAxNjppZighKGUgaW5zdGFuY2VvZiBGaWxlfHxlIGluc3RhbmNlb2YgQmxvYikpe3QubmV4dD0yMDticmVha31yZXR1cm4gdC5uZXh0PTE5LGkoZSk7Y2FzZSAxOTpyPXQuc2VudDtjYXNlIDIwOnJldHVybiB0LmFicnVwdCgicmV0dXJuIixuZXcgVWludDhBcnJheShyKSk7Y2FzZSAyMTpjYXNlImVuZCI6cmV0dXJuIHQuc3RvcCgpfX0pLHQpfSkpLGZ1bmN0aW9uKCl7dmFyIGU9dGhpcyxyPWFyZ3VtZW50cztyZXR1cm4gbmV3IFByb21pc2UoKGZ1bmN0aW9uKG8saSl7dmFyIGE9dC5hcHBseShlLHIpO2Z1bmN0aW9uIGModCl7bihhLG8saSxjLHUsIm5leHQiLHQpfWZ1bmN0aW9uIHUodCl7bihhLG8saSxjLHUsInRocm93Iix0KX1jKHZvaWQgMCl9KSl9KTtyZXR1cm4gZnVuY3Rpb24odCl7cmV0dXJuIGUuYXBwbHkodGhpcyxhcmd1bWVudHMpfX0oKX1dKX0pKTsKLy8jIHNvdXJjZU1hcHBpbmdVUkw9ZmZtcGVnLm1pbi5qcy5tYXA="},{"meta":{"name":"p-queue@6.3.0","url":"https://bundle.run/p-queue@6.3.0","ts":1698548178662,"mimetype":"text/plain"},"source":"bnVsbA=="}]},{"name":"Neopets - Daily Quest Helper","options":{"check_for_updates":true,"user_modified":1728145458280,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_powerful_this":null,"sandbox":null,"noframes":null,"unwrap":null,"run_at":null,"tab_types":null,"override":{"use_includes":[],"orig_includes":[],"merge_includes":true,"use_matches":[],"orig_matches":["*://*.neopets.com/questlog/"],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"orig_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null,"orig_run_in":[]},"run_in":null,"tags":[]},"storage":{"ts":1699407170955,"data":{}},"enabled":true,"position":12,"file_url":"https://update.greasyfork.org/scripts/479268/Neopets%20-%20Daily%20Quest%20Helper.user.js","uuid":"decb3107-a094-4452-a303-f58c1e54815b","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBOZW9wZXRzIC0gRGFpbHkgUXVlc3QgSGVscGVyCi8vIEBuYW1lc3BhY2UgICAgbmVvcGV0cwovLyBAYXV0aG9yICAgICAgIGJsYXN0IG1lIHNub3dkYWRkeQovLyBAZGVzY3JpcHRpb24gIEFkZHMgYSBsaW5rIHRvIGRhaWx5IHF1ZXN0cyBpZiBhdmFpbGFibGUKLy8gQG1hdGNoICAgICAgICAgKjovLyoubmVvcGV0cy5jb20vcXVlc3Rsb2cvCi8vIEBncmFudCAgICAgICAgbm9uZQovLyBAdmVyc2lvbiAxLjAKLy8gQGRvd25sb2FkVVJMIGh0dHBzOi8vdXBkYXRlLmdyZWFzeWZvcmsub3JnL3NjcmlwdHMvNDc5MjY4L05lb3BldHMlMjAtJTIwRGFpbHklMjBRdWVzdCUyMEhlbHBlci51c2VyLmpzCi8vIEB1cGRhdGVVUkwgaHR0cHM6Ly91cGRhdGUuZ3JlYXN5Zm9yay5vcmcvc2NyaXB0cy80NzkyNjgvTmVvcGV0cyUyMC0lMjBEYWlseSUyMFF1ZXN0JTIwSGVscGVyLm1ldGEuanMKLy8gPT0vVXNlclNjcmlwdD09CgooZnVuY3Rpb24oKSB7CiAgICAndXNlIHN0cmljdCc7CgogICAgLy8gRnVuY3Rpb24gdG8gY3JlYXRlIGEgbGluawogICAgZnVuY3Rpb24gY3JlYXRlTGluayh1cmwsIG5hbWUgPSAnTGluaycpIHsKICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICAgIGxpbmsuaHJlZiA9IHVybDsKICAgICAgICBsaW5rLnRhcmdldCA9ICdfYmxhbmsnOwogICAgICAgIGxpbmsuc3R5bGUubWFyZ2luTGVmdCA9ICc1cHgnOwogICAgICAgIGxpbmsuc3R5bGUudGV4dERlY29yYXRpb24gPSAndW5kZXJsaW5lJzsKICAgICAgICBsaW5rLnRleHRDb250ZW50ID0gYFske25hbWV9XWA7CiAgICAgICAgcmV0dXJuIGxpbms7CiAgICB9CgogICAgLy8gTG9vcCB0aHJvdWdoIGFsbCBlbGVtZW50cyB3aXRoIHRoZSBjbGFzcyAncWwtcXVlc3QtZGVzY3JpcHRpb24nCiAgICBjb25zdCBxdWVzdERlc2NyaXB0aW9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5xbC1xdWVzdC1kZXNjcmlwdGlvbicpOwogICAgcXVlc3REZXNjcmlwdGlvbnMuZm9yRWFjaChkZXNjID0+IHsKICAgICAgICBpZiAoZGVzYy50ZXh0Q29udGVudC5pbmNsdWRlcygiQ3VzdG9taXNlIG9uZSBvZiB5b3VyIE5lb3BldHMiKSkgewogICAgICAgICAgICBjb25zdCBsaW5rID0gY3JlYXRlTGluaygnaHR0cHM6Ly93d3cubmVvcGV0cy5jb20vY3VzdG9taXNlLycpOwogICAgICAgICAgICBkZXNjLmFwcGVuZENoaWxkKGxpbmspOwogICAgICAgIH0gZWxzZSBpZiAoZGVzYy50ZXh0Q29udGVudC5pbmNsdWRlcygiUGxheSBhbnkgR2FtZSBvciBDbGFzc2ljIEdhbWUgaW4gdGhlIEdhbWVzIFJvb20iKSkgewogICAgICAgICAgICBjb25zdCBsaW5rID0gY3JlYXRlTGluaygnaHR0cHM6Ly93d3cubmVvcGV0cy5jb20vZ2FtZXMvZ2FtZS5waHRtbD9nYW1lX2lkPTgyMCcpOwogICAgICAgICAgICBkZXNjLmFwcGVuZENoaWxkKGxpbmspOwogICAgICAgIH0KICAgICAgICAvKioKICAgICAgICBJZiB5b3Ugd2FudCB0byBhZGQgbW9yZSBsaW5rcyB0byBhIHF1ZXN0LCBkbyB3aGF0IEkgZGlkIGJlbG93IGhlcmU6CiAgICAgICAgKi8KICAgICAgICBlbHNlIGlmIChkZXNjLnRleHRDb250ZW50LmluY2x1ZGVzKCJQdXJjaGFzZSBpdGVtKHMpIGZyb20gYW55IE5lb3BpYW4gU2hvcCIpKSB7CiAgICAgICAgICAgIGNvbnN0IGxpbmsgPSBjcmVhdGVMaW5rKCdodHRwczovL3d3dy5uZW9wZXRzLmNvbS9nZW5lcmFsc3RvcmUucGh0bWwnKTsKICAgICAgICAgICAgY29uc3QgbGluazIgPSBjcmVhdGVMaW5rKCdodHRwczovL3d3dy5uZW9wZXRzLmNvbS9mYWVyaWVsYW5kL3NwcmluZ3MucGh0bWwnKTsKICAgICAgICAgICAgZGVzYy5hcHBlbmRDaGlsZChsaW5rKTsKICAgICAgICAgICAgZGVzYy5hcHBlbmRDaGlsZChsaW5rMik7CiAgICAgICAgfQogICAgICAgIGVsc2UgaWYgKGRlc2MudGV4dENvbnRlbnQuaW5jbHVkZXMoIldoZWVsIG9mIE1lZGlvY3JpdHkiKSkgewogICAgICAgICAgICBjb25zdCBsaW5rID0gY3JlYXRlTGluaygnaHR0cHM6Ly93d3cubmVvcGV0cy5jb20vcHJlaGlzdG9yaWMvbWVkaW9jcml0eS5waHRtbCcpOwogICAgICAgICAgICBkZXNjLmFwcGVuZENoaWxkKGxpbmspOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChkZXNjLnRleHRDb250ZW50LmluY2x1ZGVzKCJXaGVlbCBvZiBFeGNpdGVtZW50IikpIHsKICAgICAgICAgICAgY29uc3QgbGluayA9IGNyZWF0ZUxpbmsoJ2h0dHBzOi8vd3d3Lm5lb3BldHMuY29tL2ZhZXJpZWxhbmQvd2hlZWwucGh0bWwnKTsKICAgICAgICAgICAgZGVzYy5hcHBlbmRDaGlsZChsaW5rKTsKICAgICAgICB9IGVsc2UgaWYgKGRlc2MudGV4dENvbnRlbnQuaW5jbHVkZXMoIldoZWVsIG9mIEtub3dsZWRnZSIpKSB7CiAgICAgICAgICAgIGNvbnN0IGxpbmsgPSBjcmVhdGVMaW5rKCdodHRwczovL3d3dy5uZW9wZXRzLmNvbS9tZWRpZXZhbC9rbm93bGVkZ2UucGh0bWwnKTsKICAgICAgICAgICAgZGVzYy5hcHBlbmRDaGlsZChsaW5rKTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoZGVzYy50ZXh0Q29udGVudC5pbmNsdWRlcygiV2hlZWwgb2YgTWlzZm9ydHVuZSIpKSB7CiAgICAgICAgICAgIGNvbnN0IGxpbmsgPSBjcmVhdGVMaW5rKCdodHRwczovL3d3dy5uZW9wZXRzLmNvbS9oYWxsb3dlZW4vd2hlZWwvaW5kZXgucGh0bWwnKTsKICAgICAgICAgICAgZGVzYy5hcHBlbmRDaGlsZChsaW5rKTsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAoZGVzYy50ZXh0Q29udGVudC5pbmNsdWRlcygiR3Jvb20gb25lIG9mIHlvdXIgTmVvcGV0cyB3aXRoIGFueSBncm9vbWluZyBpdGVtIikpIHsKICAgICAgICAgICAgY29uc3QgbGluayA9IGNyZWF0ZUxpbmsoJ2h0dHBzOi8vd3d3Lm5lb3BldHMuY29tL2ludmVudG9yeS5waHRtbCcsICdJbnZlbnRvcnknKTsKICAgICAgICAgICAgY29uc3QgbGluazIgPSBjcmVhdGVMaW5rKCdodHRwczovL3d3dy5uZW9wZXRzLmNvbS9zYWZldHlkZXBvc2l0LnBodG1sP29ial9uYW1lPSZjYXRlZ29yeT0xMCcsICdTREInKTsKICAgICAgICAgICAgZGVzYy5hcHBlbmRDaGlsZChsaW5rKTsKICAgICAgICAgICAgZGVzYy5hcHBlbmRDaGlsZChsaW5rMik7CiAgICAgICAgfQoKICAgIH0pOwp9KSgpOw=="},{"name":"Cookie Monster","options":{"check_for_updates":true,"user_modified":null,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_powerful_this":null,"sandbox":null,"noframes":null,"unwrap":null,"run_at":null,"tab_types":null,"override":{"use_includes":[],"orig_includes":["/https?://orteil.dashnet.org/cookieclicker/","/https?://cookieclicker.ee/"],"merge_includes":true,"use_matches":[],"orig_matches":[],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"orig_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":null,"orig_run_in":[]},"run_in":null,"tags":[]},"storage":{"ts":1708019486468,"data":{}},"enabled":true,"position":13,"file_url":"https://github.com/CookieMonsterTeam/CookieMonster/raw/dev/CookieMonster.user.js","uuid":"a744a852-f205-4c21-b516-a825256abbd2","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgQ29va2llIE1vbnN0ZXIKLy8gQGluY2x1ZGUgL2h0dHBzPzovL29ydGVpbC5kYXNobmV0Lm9yZy9jb29raWVjbGlja2VyLwovLyBAaW5jbHVkZSAvaHR0cHM/Oi8vY29va2llY2xpY2tlci5lZS8KLy8gPT0vVXNlclNjcmlwdD09Cgpjb25zdCByZWFkeUNoZWNrID0gc2V0SW50ZXJ2YWwoKCkgPT4gewogIGNvbnN0IEdhbWUgPSB1bnNhZmVXaW5kb3cuR2FtZTsKCiAgaWYgKHR5cGVvZiBHYW1lICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgR2FtZS5yZWFkeSAhPT0gJ3VuZGVmaW5lZCcgJiYgR2FtZS5yZWFkeSkgewogICAgR2FtZS5Mb2FkTW9kKCdodHRwczovL2Nvb2tpZW1vbnN0ZXJ0ZWFtLmdpdGh1Yi5pby9Db29raWVNb25zdGVyL2Rpc3QvQ29va2llTW9uc3Rlci5qcycpOwogICAgY2xlYXJJbnRlcnZhbChyZWFkeUNoZWNrKTsKICB9Cn0sIDEwMDApOwo="},{"name":"Word and Text Replace","options":{"check_for_updates":true,"user_modified":1722953742315,"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_powerful_this":null,"sandbox":null,"noframes":null,"unwrap":null,"run_at":null,"tab_types":null,"override":{"use_includes":[],"orig_includes":[],"merge_includes":true,"use_matches":[],"orig_matches":["*://*/*"],"merge_matches":true,"use_excludes":[],"orig_excludes":["*://docs.google.com/*","*://drive.google.com/*","*://mail.google.com/*"],"merge_excludes":true,"use_connects":[],"orig_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-idle","orig_noframes":true,"orig_run_in":[]},"run_in":null,"tags":[]},"storage":{"ts":1722952720978,"data":{}},"enabled":false,"position":14,"file_url":"https://update.greasyfork.org/scripts/382467/Word%20and%20Text%20Replace.user.js","uuid":"1879ed77-ffe1-4e0b-a41a-14b0c474bc16","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBXb3JkIGFuZCBUZXh0IFJlcGxhY2UKLy8gQG5hbWVzcGFjZSAgICBodHRwczovL2dpdGh1Yi5jb20vZXJpY2tSZWNhaQovLyBAdmVyc2lvbiAgICAgIDEuMDUuMDMKLy8gQGRlc2NyaXB0aW9uICBSZXBsYWNlcyB0ZXh0IHdpdGggb3RoZXIgdGV4dC4KLy8gQGF1dGhvciAgICAgICBndXlSaWNreQoKLy8gQG1hdGNoICAgICAgICAqOi8vKi8qCi8vIEBub2ZyYW1lcwoKLy8gQGV4Y2x1ZGUgICAgICAqOi8vZG9jcy5nb29nbGUuY29tLyoKLy8gQGV4Y2x1ZGUgICAgICAqOi8vZHJpdmUuZ29vZ2xlLmNvbS8qCi8vIEBleGNsdWRlICAgICAgKjovL21haWwuZ29vZ2xlLmNvbS8qCgovLyBAcmVxdWlyZSAgICAgIGh0dHBzOi8vY29kZS5qcXVlcnkuY29tL2pxdWVyeS0zLjQuMS5taW4uanMKLy8gQHJlcXVpcmUgICAgICBodHRwczovL2dyZWFzeWZvcmsub3JnL3NjcmlwdHMvMzgxODU5LXdhaXRmb3JrZXllbGVtZW50cy1ieS1icm9ja2EvY29kZS9XYWl0Rm9yS2V5RWxlbWVudHMlMjBieSUyMEJyb2NrQS5qcz92ZXJzaW9uPTY4OTM2NAoKLy8gQGxpY2VuY2UgICAgICBDQy1CWS1OQy1TQS00LjA7IGh0dHBzOi8vY3JlYXRpdmVjb21tb25zLm9yZy9saWNlbnNlcy9ieS1uYy1zYS80LjAvCi8vIEBsaWNlbmNlICAgICAgR1BMLTMuMC1vci1sYXRlcjsgaHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAudHh0Ci8vIEBkb3dubG9hZFVSTCBodHRwczovL3VwZGF0ZS5ncmVhc3lmb3JrLm9yZy9zY3JpcHRzLzM4MjQ2Ny9Xb3JkJTIwYW5kJTIwVGV4dCUyMFJlcGxhY2UudXNlci5qcwovLyBAdXBkYXRlVVJMIGh0dHBzOi8vdXBkYXRlLmdyZWFzeWZvcmsub3JnL3NjcmlwdHMvMzgyNDY3L1dvcmQlMjBhbmQlMjBUZXh0JTIwUmVwbGFjZS5tZXRhLmpzCi8vID09L1VzZXJTY3JpcHQ9PQovKiBqc2hpbnQgZXN2ZXJzaW9uOiA2ICovCgooZnVuY3Rpb24gKCkgewogICAgJ3VzZSBzdHJpY3QnOwoKICAgIGlmKDApey8qCmxhc3QgdXBkYXRlOiA3LzA0LzIwMjAKCj09IHRvZG8gPT0KMS4gY29tbWVudCBvbiBpZnJhbWVzLgoxLiBzY3JpcHQgZXhlY3V0aW9uIGZsb3cgd2l0aCBGSEQuCjEuIHNlcGFyYXRlIGNvdW50ZXIgZm9yIGVhY2ggZXhlY3V0aW9uIGluc3RhbmNlLgoKMTAuIGNhc2U6IDIgdGV4dCBub2RlcyBoYXZlIHRoZSBzYW1lIHBhcmVudCBibG9jay4KCj09IGlzc3VlcyA9PQotIGNlcnRhaW4gdGV4dCBub2RlcyBhcmVuJ3QgYWNjZXNzZWQgd2l0aCBtYXJrQ2hlY2tlZEVsZW1lbnQgZW5hYmxlZC4gKG11bHRpcGxlIHRleHQgbm9kZXMpCgo9PSBob3cgaXQgd29ya3MgPT0KMWEuIGNhbGxzIHByb2Nlc3NQYWdlKCkgb25jZSBmb3IgZWFjaCBtYWpvciBydW4uCjFiLiBjcmVhdGVzIGxpc3Qgb2Ygc3BlY2lmaWMgdGV4dCBub2RlcyB0aGVuIGNoZWNrcyBlYWNoIGFnYWluc3QgYWxsIHJ1bGVzLgoxYmEuIHdpdGggc3BlY2lhbCByZXBsYWNlIGVuYWJsZWQsIGlmIGRlbGV0ZSBvciBmdWxsIHJlcGxhY2UgbWF0Y2gsIGNoZWNrIHN0b3BzIGFmdGVyIHRoZSBmaXJzdCBzcGVjaWFsIG1hdGNoLgotIHRoaXMgZXhjbHVkZXMgZWxlbWVudHMgcHJldmlvdXNseSBjaGVja2VkLgotIGNoYW5nZXMgdGV4dCBiYXNlZCBvbiBtYXRjaGVzLgoxYy4gYWZ0ZXIgY2hlY2tpbmcgYSB0ZXh0IG5vZGUgYWdhaW5zdCBhbGwgcnVsZXMsIGFwcGxpZXMgYSAnY2hlY2tlZCcgY2xhc3MgdG8gdGhlIGVsZW1lbnQgY29udGFpbmluZyB0aGUgdGV4dCBub2RlLgoKMmEuIGRsdDEgYW5kIGRsdDIgY29tcGxldGVseSByZXBsYWNlcyB0ZXh0IGJ5IGRlZmF1bHQsIG9wdGlvbiB0byBjaGFuZ2UuCgo9PSBub3RpZmljYXRpb24gbm90ZXMgPT0KMWUuIGVsZW1lbnRzIGNoZWNrZWQgYnkgdGl0bGUgYXR0cmlidXRlcyBhcmUgcHJvY2Vzc2VkIGluIGEgc2VwYXJhdGUgYmxvY2suCjVhLiBub3RpZmljYXRpb25zIG9ubHkgd29yayBmb3IgdGhvc2Ugc2l0ZXMgZW5hYmxlZCB3aXRoIGZpbHRlcnMuCgo9PSB2ZXJzaW9uIGhpc3RvcnkgPT0KPT0gMS4wNS4wMyA9PQotIGN1c3RvbSBleGVjdXRpb24gdGltZQotIHNvbWUgY2xlYW4gdXAuCgo9PSBjb2RlIG1hcmtlcnMgPT0KQUEuIGluaXRpYWwgc2V0dXAKQUIuIHJlcGxhY2UgcnVsZXMKQUMuIHNwZWNpYWwgcnVsZXMKQkEuIHNjcmlwdCBvcHRpb25zCkJCLiBub3RpZiBjb2RlIGJsb2NrCkNBLiBwcm9jZXNzUGFnZSgpCkNCLiBleGVjdXRpb24gY29udHJvbApEQS4gc2NyaXB0IGJ1dHRvbgpEQi4gc3VwcG9ydCBmdW5jdGlvbnMKICAgICovfQogICAgCiAgICAvLyA9PT09IEFBLiBpbml0aWFsIHNldHVwID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PXwKCiAgICBjb25zdCBzY3JpcHRQcmVmaXggPSAicnBsdC0iOwogICAgY29uc3Qgc2NyaXB0VGFnID0gIlJQTFQiOwoKICAgIGxldCBydW5TY3JpcHQgPSAxOwogICAgcnVuU2NyaXB0ID0gZ2V0T3B0aW9uU3RhdGUoImVuYWJsZS0iKyBzY3JpcHRQcmVmaXggKyJzY3JpcHQiLCBydW5TY3JpcHQpOwoKICAgIGlmIChydW5TY3JpcHQpIHsKCiAgICAgICAgbGV0IGVuYWJsZUNvbnNvbGVNZXNzYWdlcyA9IDE7IC8vIGRlZmF1bHQgMDsgc2V0IHRvIDEgdG8gc2hvdyBjb25zb2xlIG1lc3NhZ2VzLgogICAgICAgIGVuYWJsZUNvbnNvbGVNZXNzYWdlcyA9IGdldE9wdGlvblN0YXRlKCJsb2ctIisgc2NyaXB0UHJlZml4ICsibXNnIiwgZW5hYmxlQ29uc29sZU1lc3NhZ2VzKTsKCiAgICAgICAgbGV0IGVuYWJsZWRNZXNzYWdlcyA9CiAgICAgICAgICAgIC8vIk1BfCIrIC8vIGFueSBydWxlIG1hdGNoZXMKICAgICAgICAgICAgIlRULU1BfCIrIC8vIHBhZ2UgdGl0bGUgbWF0Y2guCiAgICAgICAgICAgICJUWFQtTUF8IisgLy8gYWxsIHRleHQgbWF0Y2hlcy4KICAgICAgICAgICAgIkRMVDF8IisgLy8gZGVsZXRlMSBtYXRjaGVzLgogICAgICAgICAgICAiRExUMnwiKyAvLyBkZWxldGUyIG1hdGNoZXMKICAgICAgICAgICAgIkZSMXwiKyAvLyBmdWxsIHJlcGxhY2UgbWF0Y2hlcy4KICAgICAgICAgICAgLy8iQ0gtVFR8IisgLy8gY2hhbmdlZCB0ZXh0LgoKICAgICAgICAgICAgIlJVTlR8IisgLy8gcnVudGltZSBtZXNzYWdlcyAoYW1vdW50IG9mIHRpbWUgdG8gZXhlY3V0ZSkKICAgICAgICAgICAgIkVYRUN8IisgLy8gZXhlY3V0aW9uIG1lc3NhZ2VzICh3aGVuIGNvZGUgaXMgZXhlY3V0ZWQpCiAgICAgICAgICAgICJcXGJTVFxcYnwiKyAvL3NjcmlwdCBvcHRpb24gY2hhbmdlIHVwZGF0ZQogICAgICAgICAgICAiR0VOJHwiKyAvLyBnZW5lcmFsIG1lc3NhZ2VzCiAgICAgICAgICAgICJeMSI7IC8vIGhpZ2ggcHJpb3JpdHkgbWVzc2FnZXMKICAgICAgICBsZXQgbG9nQWxsID0gMDsgLy8gaWYgMSwgbG9ncyBhbGwgdGl0bGVzIGZyb20gYmxvY2tzLgogICAgICAgIGxvZ0FsbCA9IGdldE9wdGlvblN0YXRlKCJsb2ctIisgc2NyaXB0UHJlZml4ICsiYWxsIiwgbG9nQWxsKTsKICAgICAgICBpZiAobG9nQWxsKSB7CiAgICAgICAgICAgIGVuYWJsZWRNZXNzYWdlcyA9IGVuYWJsZWRNZXNzYWdlcy5jb25jYXQoInx0aXRsZSIpOwogICAgICAgIH0KICAgICAgICBjb25zdCBlbmFibGVkTWVzc2FnZXNSZWdleCA9IG5ldyBSZWdFeHAoZW5hYmxlZE1lc3NhZ2VzKTsgLy8gdXNlZCBpbiBjb25zb2xlbG9nKCkuCgogICAgICAgIGNvbnNvbGVsb2coIiMjIyMgKCIrIHNjcmlwdFRhZyArIikgdGV4dCByZXBsYWNlIHNjcmlwdCBiZWdhbi4gIyMjIyIsICJFWEVDIik7CgogICAgICAgIC8vID09PT0gQUIuIHJlcGxhY2UgcnVsZXMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT18CgogICAgICAgIGxldCByZXBsYWNlUnVsZXMgPSBbCiAgICAgICAgICAgIC8vWy8vaSwgIiJdLCAvLyBydWxlIHRlbXBsYXRlCiAgICAKICAgICAgICAgICAgLy8gYmFzaWMgZXhhbXBsZXM6CiAgICAgICAgICAgIC8vWy9jb21taXQvaSwgImRvZyJdLAogICAgICAgICAgICAvL1svYnJhbmNoL2ksICJ0dXJ0bGUiXSwKICAgICAgICAgICAgLy9bL2ZpbGUvaSwgImJpcmRpZSJdLAogICAgICAgICAgICAvL1svXHcvZywgImEiXSwgLy9yZXBsYWNlcyBhbGwgY2hhcmFjdGVycyB3aXRoICJhIi4KICAgICAgICAgICAgLy9bLygufFxXKSsvaSwgInRleHQiXSwgLy9yZXBsYWNlcyBhbGwgdGV4dCBpbnN0YW5jZXMgd2l0aCAidGV4dCIuCgoKICAgICAgICAgICAgLy9bL1VLIHRlcm0vLCAiVVMgdGVybSIKLy8gICAgICAgICAgICAgWy9VSy8sICJVUyBSZXBsYWNlZCBCeSBVc2VyU2NyaXB0Il0sCi8vICAgICAgICAgICAgIFsvZGMvLCAic2MiXSwKLy8gICAgICAgICAgICAgWy9kb3VibGUvLCAic2luZ2xlIl0sCi8vICAgICAgICAgICAgIFsvdHIvLCAiZGMiXSwKLy8gICAgICAgICAgICAgWy90cmVibGUvLCAiZG91YmxlIl0sCi8vICAgICAgICAgICAgIFsvaHRyLywgImhkYyJdLAovLyAgICAgICAgICAgICBbL2hhbGYgdHJlYmxlLywgImhhbGYgZG91YmxlIl0sCi8vICAgICAgICAgICAgIFsvZHRyLywgInRyIl0sCi8vICAgICAgICAgICAgIFsvZG91YmxlIHRyZWJsZS8sICJ0cmVibGUiXSwKLy8gICAgICAgICAgICAgWy90dHIvLCAiZHRyIl0sCi8vICAgICAgICAgICAgIFsvdHJpcGxlIHRyZWJsZS8sICJkb3VibGUgdHJlYmxlIl0sCi8vICAgICAgICAgICAgIFsveW9oLywgInlvIl0sCi8vICAgICAgICAgICAgIFsveWFybiBvdmVyIGhvb2svLCAieWFybiBvdmVyIl0sCi8vICAgICAgICAgICAgIFsvdGVuc2lvbi8sICJnYXVnZSJdLAovLyAgICAgICAgICAgICBbL3J0cmIvLCAiYnBkYyJdLAovLyAgICAgICAgICAgICBbL3JhaXNlZCB0cmVibGUgY3JvY2hldCBiYWNrLywgImJhY2sgcG9zdCBkb3VibGUgY3JvY2hldCJdLAovLyAgICAgICAgICAgICBbL3J0cmYvLCAiZnBkYyJdLAovLyAgICAgICAgICAgICBbL3JhaXNlZCB0cmVibGUgY3JvY2hldCBmcm9udC8sICJmcm9udCBwb3N0IGRvdWJsZSBjcm9jaGV0Il0sCi8vICAgICAgICAgICAgIFsvbWlzcy8sICJza2lwIl0KICAgICAgICAgICAgWy9kb3VibGUgdHJlYmxlL2csICJ0cmlwbGUgdHJlYmxlIl0sIC8vIE1vcmUgc3BlY2lmaWMKICAgICAgICAgICAgWy90cmlwbGUgdHJlYmxlL2csICJkb3VibGUgdHJlYmxlIl0sIC8vIE1vcmUgZ2VuZXJhbAogICAgICAgICAgICBbL2R0ci9nLCAidHIiXSwKICAgICAgICAgICAgWy90ci9nLCAiZGMiXSwKICAgICAgICAgICAgWy90cmVibGUvZywgImRvdWJsZSJdLAogICAgICAgICAgICBbL2h0ci9nLCAiaGRjIl0sCiAgICAgICAgICAgIFsvaGFsZiB0cmVibGUvZywgImhhbGYgZG91YmxlIl0sCiAgICAgICAgICAgIFsveW9oL2csICJ5byJdLAogICAgICAgICAgICBbL3lhcm4gb3ZlciBob29rL2csICJ5YXJuIG92ZXIiXSwKICAgICAgICAgICAgWy90ZW5zaW9uL2csICJnYXVnZSJdLAogICAgICAgICAgICBbL3J0cmIvZywgImJwZGMiXSwKICAgICAgICAgICAgWy9yYWlzZWQgdHJlYmxlIGNyb2NoZXQgYmFjay9nLCAiYmFjayBwb3N0IGRvdWJsZSBjcm9jaGV0Il0sCiAgICAgICAgICAgIFsvcnRyZi9nLCAiZnBkYyJdLAogICAgICAgICAgICBbL3JhaXNlZCB0cmVibGUgY3JvY2hldCBmcm9udC9nLCAiZnJvbnQgcG9zdCBkb3VibGUgY3JvY2hldCJdLAogICAgICAgICAgICBbL21pc3MvZywgInNraXAiXSwKICAgICAgICAgICAgWy9kYy9nLCAic2MiXSwgLy8gVG8gYmUgcmVwbGFjZWQgbGFzdCB0byBhdm9pZCBvdmVybGFwIGlzc3VlcwogICAgICAgICAgICBbL2RvdWJsZS9nLCAic2luZ2xlIl0gLy8gUmVwbGFjZSBhZnRlciAnZGMnIHRvIGF2b2lkIGRvdWJsZSByZXBsYWNlbWVudHMKCiAgICAgICAgXTsKCiAgICAgICAgLy8gPT09PSBBQy4gc3BlY2lhbCBydWxlcyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PXwKCiAgICAgICAgY29uc3QgZW5hYmxlU3BlY2lhbFJ1bGVzID0gMTsKICAgICAgICBpZiAoZW5hYmxlU3BlY2lhbFJ1bGVzKSB7CiAgICAgICAgICAgIC8vIGV4YW1wbGUgb2YgaW5jbHVkaW5nIGEgcnVsZSBsaXN0IGRlZmluZWQgaW4gYSBzcGVhcmF0ZSBzY3JpcHQuCiAgICAgICAgICAgIGlmICh1bnNhZmVXaW5kb3cuZ2xvYmFsTGlzdE5hbWUpIHsKICAgICAgICAgICAgICAgIHJlcGxhY2VSdWxlcyA9IHJlcGxhY2VSdWxlcy5jb25jYXQodW5zYWZlV2luZG93Lmdsb2JhbExpc3ROYW1lKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvL2NvbnNvbGVsb2cocmVwbGFjZVJ1bGVzLCJhbGwgcnVsZXMiKTsgLy90ZXN0OiBkb3VibGUgY2hlY2sgcnVsZSBjb250ZW50cwoKICAgICAgICAvLyA9PT09IEJBLiBzY3JpcHQgb3B0aW9ucyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09fAoKICAgICAgICBjb25zdCBjbGFzc1doaXRlbGlzdCA9IC9ub3RpZi1oaWRkZW58bm90aWYtdGV4dHx0YWctaW5zdHwtY291bnRlci9pOwogICAgICAgIC8vIHRleHQgbm9kZXMgd2l0aCBwYXJlbnQgZWxlbWVudHMgd2l0aCB0aGVzZSBjbGFzc2VzIGFyZSBleGNsdWRlZC4KCiAgICAgICAgY29uc3QgZ2VuZXJhdGVSZWNoZWNrQnV0dG9uID0gMTsKCiAgICAgICAgbGV0IGR5bmFtaWNDaGVja2luZyA9IDE7IC8vIGRlZmF1bHQgMTsgc2V0IHRvIDEgdG8gcnVuIHRoZSBzY3JpcHQgYXV0b21hdGljYWxseSB3aGVuIG5ldyBpbWFnZSBlbGVtZW50cyBhcmUgZGV0ZWN0ZWQuCiAgICAgICAgZHluYW1pY0NoZWNraW5nID0gZ2V0T3B0aW9uU3RhdGUoImVuYWJsZS0iKyBzY3JpcHRQcmVmaXggKyJkeW5hbWljLWNoZWNraW5nIiwgZHluYW1pY0NoZWNraW5nKTsKICAgICAgICAvLyBzZXR0aW5nIHRvIDAgd291bGQgbWFrZSB0aGlzIHJ1biBhIGZldyBtb3JlIHRpbWVzIHdoZW4gZHluYW1pY2FsbHkgY2hlY2tpbmcuCiAgICAgICAgCiAgICAgICAgLy8gPT09PSBjaGVja2VkIGluIHByb2Nlc3NQYWdlKCkgPT09PQogICAgICAgIC8vIG1hbmFnYWJsZSB3aXRoIG9wdGlvbmFsIFNjcmlwdCBPcHRpb25zIHVzZXJzY3JpcHQuCiAgICAgICAgbGV0IGxvZ1J1bnRpbWVzID0gMTsgLy8gZGVmYXVsdCAwOyBzZXQgdG8gMSB0byBsb2cgZnVuY3Rpb24gcnVudGltZXMgdG8gdGhlIGNvbnNvbGUuCiAgICAgICAgbGV0IG1hcmtDaGVja2VkRWxlbWVudHMgPSAxOyAvLyBkZWZhdWx0IDE7IHNldCB0byAwIGlmIGNlcnRhaW4gc2l0ZXMgc3RhcnQgYXBwZWFyaW5nIHdlaXJkbHkuCgogICAgICAgIGxldCBlbmFibGVTcGVjaWFsUmVwbGFjZSA9IDE7CiAgICAgICAgbGV0IGZ1bGxEZWxldGUgPSAwOyAvLyBkZWZhdWx0IDE7IGlmIDEsIHRleHQgaXMgY29tcGxldGVseSByZXBsYWNlZC4KICAgICAgICBsZXQgYWRkVGFnID0gMTsgLy8gaWYgZnVsbERlbGV0ZSBpcyBhY3RpdmUsIGFkZHMgYSB0YWcgd2l0aG91dCByZXBsYWNpbmcuCgogICAgICAgIC8vID09PT0gQkIuIG5vdGlmIGNvZGUgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT18CgogICAgICAgIC8vICdzY3JpcHQgb3B0aW9ucycgb3B0aW9ucwogICAgICAgIGxldCBlbmFibGVFeGVjQ291bnRlciA9IDA7CiAgICAgICAgZW5hYmxlRXhlY0NvdW50ZXIgPSBnZXRPcHRpb25TdGF0ZSgiZW5hYmxlLSIrIHNjcmlwdFByZWZpeCArImNvdW50ZXIiLCBlbmFibGVFeGVjQ291bnRlcik7CiAgICAgICAgbGV0IGVuYWJsZU5vdGlmaWNhdGlvbnMgPSAwOwogICAgICAgIGVuYWJsZU5vdGlmaWNhdGlvbnMgPSBnZXRPcHRpb25TdGF0ZSgiZW5hYmxlLSIrIHNjcmlwdFByZWZpeCArIm5vdGlmcyIsIGVuYWJsZU5vdGlmaWNhdGlvbnMpOwogICAgICAgIGxldCBhdXRvaGlkZU5vdGlmcyA9IDA7IC8vIGRlZmF1bHQgMDsgbm90aWZzIGRpc2FwcGVhciBhZnRlciBhIHNldCBwZXJpb2Qgb2YgdGltZS4gdXNlZCBpbiBjcmVhdGVOb3RpZigpCiAgICAgICAgbGV0IHN0YXJ0Q29sbGFwc2VkID0gMTsgLy9kZWZhdWx0IDE7CgogICAgICAgIC8vIG5vdGlmIGNzcyB2YXJpYWJsZXMuCiAgICAgICAgY29uc3Qgbm90aWZzSGV4ID0gIiNkZGQiOwogICAgICAgIGNvbnN0IG5vdGlmc09wYWNpdHkgPSAuNDsgLy8gZGVmYXVsdCAuNDsgc2V0IHRvIGEgdmFsdWUgYmV0d2VlbiAwIGFuZCAxLCAxIGlzIG5vIHRyYW5zcGFyZW5jeSwgLjUgaXMgNTAlIHRyYW5zcGFyZW5jeS4KICAgICAgICBjb25zdCBub3RpZnNXaWR0aCA9IDEyMDsgLy8gZGVmYXVsdCAxMjA7IHdpZHRoIGluIHBpeGVscyBvZiBlYWNoIG5vdGlmaWNhdGlvbi4KCiAgICAgICAgbGV0IG5vdGlmQ29udGFpbmVySWQgPSAibm90aWYtbWFpbi1jb250YWluZXIiOwoKICAgICAgICAvLyBnZW5lcmF0ZSBub3RpZiBjb250YWluZXIgaWYgbmVlZGVkLgogICAgICAgIGlmICgoZW5hYmxlRXhlY0NvdW50ZXIgfHwgZW5hYmxlTm90aWZpY2F0aW9ucykgJiYgIWpRdWVyeSgiIyIrIG5vdGlmQ29udGFpbmVySWQpLmxlbmd0aCkgewoKICAgICAgICAgICAgLy8gPT09PSBzZXR0aW5nL2NoZWNraW5nIGluaXRpYWwgdmlzdWFsIHN0YXRlIG9mIG5vdGlmcyA9PT09CgogICAgICAgICAgICAvLyBjb25zdHJvbGxlZCBleGNsdXNpdmVseSBieSBsb2NhbCBzdG9yYWdlIG9yIHRoZSBkZWZhdWx0IHZhbHVlLgogICAgICAgICAgICBjb25zdCBsb2NhbFN0b3JhZ2VOYW1lID0gIm5vdGlmIHN0YXJ0IGNvbGxhcHNlZCI7CiAgICAgICAgICAgIGlmICh3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0obG9jYWxTdG9yYWdlTmFtZSkpIHsKICAgICAgICAgICAgICAgIHN0YXJ0Q29sbGFwc2VkID0gd2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKGxvY2FsU3RvcmFnZU5hbWUpOwogICAgICAgICAgICAgICAgc3RhcnRDb2xsYXBzZWQgPSAoc3RhcnRDb2xsYXBzZWQgPT0gInRydWUiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgdmlzaWJsZUNsYXNzID0gIm5vdGlmLXZpc2libGUiOwogICAgICAgICAgICBjb25zdCBoaWRkZW5DbGFzcyA9ICJub3RpZi1oaWRkZW4xIjsKICAgICAgICAgICAgbGV0IHN0YXJ0aW5nU3RhdGVDbGFzcyA9IHZpc2libGVDbGFzczsKICAgICAgICAgICAgbGV0IG90aGVyU3RhcnRpbmdTdGF0ZUNsYXNzID0gaGlkZGVuQ2xhc3M7CiAgICAgICAgICAgIGlmIChzdGFydENvbGxhcHNlZCkgewogICAgICAgICAgICAgICAgc3RhcnRpbmdTdGF0ZUNsYXNzID0gaGlkZGVuQ2xhc3M7CiAgICAgICAgICAgICAgICBvdGhlclN0YXJ0aW5nU3RhdGVDbGFzcyA9IHZpc2libGVDbGFzczsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gPT09PSBjcmVhdGUgY29udGFpbmVyID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09fAogICAgICAgICAgICAvKgogICAgICAgICAgICBbIG5vdGlmIG1haW4gY29udGFpbmVyCiAgICAgICAgICAgICAgICBbbm90aWYxXSAtIGNvdW50ZXJzCiAgICAgICAgICAgICAgICBbaGlkZV0gLSBidXR0b24KICAgICAgICAgICAgICAgIFtvcGVuXSAtIGJ1dHRvbgogICAgICAgICAgICAgICAgW2Nsb3NlXSAtIGJ1dHRvbgogICAgICAgICAgICAgICAgW2NsZWFyXSAtIGJ1dHRvbgogICAgICAgICAgICAgICAgW25vdGlmMgogICAgICAgICAgICAgICAgICAgIFtkbHQtY29udGFpbmVyXQogICAgICAgICAgICAgICAgICAgIFtsbC1jb250YWluZXJdCiAgICAgICAgICAgICAgICAgICAgW290LWNvbnRhaW5lcl0KICAgICAgICAgICAgICAgIF0KCiAgICAgICAgICAgIF0KICAgICAgICAgICAgLSBoaWRlOiBtYWtlcyB2aXNpYmxlIG9wZW4gfCBoaWRlcyBjbG9zZSwgY2xlYXIsIG5vdGlmMgogICAgICAgICAgICAtIG9wZW46IG1ha2VzIHZpc2libGUgaGlkZSwgY2xvc2UsIGNsZWFyLCBub3RpZjIgfCBoaWRlcyBvcGVuCiAgICAgICAgICAgIC0gY2xvc2U6IGRlbGV0ZXMgbm90aWYgbWFpbiBjb250YWluZXIuCiAgICAgICAgICAgIC0gY2xlYXI6IGVtcHRpZXMgbm90aWYtY29udGFpbmVyMgogICAgICAgICAgICAqLwoKICAgICAgICAgICAgY29uc3Qgb3BlbkJ1dHRvbklkID0gIm5vdGlmLW9wZW4iOwogICAgICAgICAgICBjb25zdCBoaWRlQnV0dG9uSWQgPSAibm90aWYtaGlkZSI7CgogICAgICAgICAgICBsZXQgbm90aWZpY2F0aW9uc0VsZW1lbnQgPQogICAgICAgICAgICAgICAgIjxkaXYgaWQ9JyIrIG5vdGlmQ29udGFpbmVySWQgKyInPiIrCiAgICAgICAgICAgICAgICAiPGRpdiBpZD0nbm90aWYtY29udGFpbmVyMSc+PC9kaXY+IisKICAgICAgICAgICAgICAgICI8ZGl2IGlkPSciKyBoaWRlQnV0dG9uSWQgKyInIGNsYXNzPSdub3RpZi1yZWQgbm90aWYtcm91bmRlZC1ibG9jayAiKyBzdGFydGluZ1N0YXRlQ2xhc3MgKyInPm5vdGlmIGhpZGU8L2Rpdj4iKwogICAgICAgICAgICAgICAgIjxkaXYgaWQ9JyIrIG9wZW5CdXR0b25JZCArIicgY2xhc3M9J25vdGlmLWdyZWVuIG5vdGlmLXJvdW5kZWQtYmxvY2sgIisgb3RoZXJTdGFydGluZ1N0YXRlQ2xhc3MgKyInPm5vdGlmIG9wZW48L2Rpdj4iKwogICAgICAgICAgICAgICAgIjxkaXYgaWQ9J25vdGlmLWNsb3NlJyBjbGFzcz0nbm90aWYtZ3JheSBub3RpZi1yb3VuZGVkLWJsb2NrICIrIHN0YXJ0aW5nU3RhdGVDbGFzcyArIic+Y2xvc2Ugbm90aWZbXTwvZGl2PiIrCiAgICAgICAgICAgICAgICAiPGRpdiBpZD0nbm90aWYtY2xlYXInIGNsYXNzPSdub3RpZi1vcmFuZ2Ugbm90aWYtcm91bmRlZC1ibG9jayAiKyBzdGFydGluZ1N0YXRlQ2xhc3MgKyInPmNsZWFyIG5vdGlmPC9kaXY+IisKICAgICAgICAgICAgICAgICI8ZGl2IGlkPSdub3RpZi1jb250YWluZXIyJyBjbGFzcz0nICIrIHN0YXJ0aW5nU3RhdGVDbGFzcyArIic+IisKICAgICAgICAgICAgICAgICAgICAiPGRpdiBpZD0nZGx0LWNvbnRhaW5lcic+PC9kaXY+IisKICAgICAgICAgICAgICAgICAgICAiPGRpdiBpZD0nbGwtY29udGFpbmVyJyBjbGFzcz0nbm90aWYtaGlkZGVuMSc+PC9kaXY+IisKICAgICAgICAgICAgICAgICAgICAiPGRpdiBpZD0nb3QtY29udGFpbmVyJyBjbGFzcz0nbm90aWYtaGlkZGVuMSc8L2Rpdj4iKwogICAgICAgICAgICAgICAgIjwvZGl2PiIrCiAgICAgICAgICAgICAgICAiPC9kaXY+IjsKICAgICAgICAgICAgalF1ZXJ5KCJib2R5IikucHJlcGVuZChub3RpZmljYXRpb25zRWxlbWVudCk7CgogICAgICAgICAgICBsZXQgdGV4dFJlYWRlckVsZW1lbnQgPQogICAgICAgICAgICAgICAgIjxkaXYgaWQ9J25vdGlmLXRleHQtb3ZlcmxheScgY2xhc3M9J25vdGlmLXRleHQtaGlkZGVuJz48L2Rpdj4iOwogICAgICAgICAgICBqUXVlcnkoImJvZHkiKS5wcmVwZW5kKHRleHRSZWFkZXJFbGVtZW50KTsKCiAgICAgICAgICAgIGpRdWVyeSgnI25vdGlmLWNvbnRhaW5lcjInKS5vbiggewogICAgICAgICAgICAgICAgbW91c2VlbnRlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIGxldCBub3RpZlRleHQgPSBqUXVlcnkodGhpcykuZmluZCgiLm5vdGlmLXRleHQiKS50ZXh0KCk7CiAgICAgICAgICAgICAgICAgICAgbGV0IG5vdGlmQ2xhc3NMaXN0ID0gdGhpcy5jbGFzc05hbWU7CiAgICAgICAgICAgICAgICAgICAgaWYgKC9yZWQvLnRlc3Qobm90aWZDbGFzc0xpc3QpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeSgiI25vdGlmLXRleHQtb3ZlcmxheSIpLmFkZENsYXNzKCJub3RpZi1yZWQiKTsKICAgICAgICAgICAgICAgICAgICB9ZWxzZSBpZiAoL29yYW5nZS8udGVzdChub3RpZkNsYXNzTGlzdCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5KCIjbm90aWYtdGV4dC1vdmVybGF5IikuYWRkQ2xhc3MoIm5vdGlmLW9yYW5nZSIpOwogICAgICAgICAgICAgICAgICAgIH1lbHNlIGlmICgveWVsbG93Ly50ZXN0KG5vdGlmQ2xhc3NMaXN0KSkgewogICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkoIiNub3RpZi10ZXh0LW92ZXJsYXkiKS5hZGRDbGFzcygibm90aWYteWVsbG93Iik7CiAgICAgICAgICAgICAgICAgICAgfWVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkoIiNub3RpZi10ZXh0LW92ZXJsYXkiKS5hZGRDbGFzcygibm90aWYtZ3JheSIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBqUXVlcnkoIiNub3RpZi10ZXh0LW92ZXJsYXkiKS50ZXh0KG5vdGlmVGV4dCk7CiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5KCIjbm90aWYtdGV4dC1vdmVybGF5IikuYWRkQ2xhc3MoIm5vdGlmLXRleHQtdmlzaWJsZSIpOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIG1vdXNlbGVhdmU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICBqUXVlcnkoIiNub3RpZi10ZXh0LW92ZXJsYXkiKS5yZW1vdmVDbGFzcygibm90aWYtdGV4dC12aXNpYmxlIik7CiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5KCIjbm90aWYtdGV4dC1vdmVybGF5IikucmVtb3ZlQ2xhc3MoIm5vdGlmLXJlZCIpOwogICAgICAgICAgICAgICAgICAgIGpRdWVyeSgiI25vdGlmLXRleHQtb3ZlcmxheSIpLnJlbW92ZUNsYXNzKCJub3RpZi1vcmFuZ2UiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgJy5ub3RpZi1pbnN0YW5jZScpOwoKICAgICAgICAgICAgLy8gPT09PSBjbG9zZSA9PT09CiAgICAgICAgICAgIGpRdWVyeSgiI25vdGlmLWNsb3NlIikuY2xpY2soZnVuY3Rpb24oKXsKICAgICAgICAgICAgICAgIGpRdWVyeSgiIyIrbm90aWZDb250YWluZXJJZCkucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCJSUEwgbm90aWYgY2xvc2UgY2xpY2tlZC4gKCIrbm90aWZDb250YWluZXJJZCsiKSIpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vID09PT0gY2xlYXJzIGNvbnRhaW5lcjIgd2hpY2ggY29udGFpbnMgbm90aWYgaW5zdGFuY2VzLiA9PT09CiAgICAgICAgICAgIGZ1bmN0aW9uIGNsZWFyTm90aWYoKXsKICAgICAgICAgICAgICAgIGpRdWVyeSgiI25vdGlmLWNvbnRhaW5lcjIiKS5lbXB0eSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGpRdWVyeSgiI25vdGlmLWNsZWFyIikuY2xpY2soY2xlYXJOb3RpZik7CgogICAgICAgICAgICAvLyA9PT09IG9wZW4vaGlkZSBldmVudHMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT18CgogICAgICAgICAgICBjb25zdCBtYWluU2VsZWN0b3IgPSAiI25vdGlmLWNvbnRhaW5lcjIsICMiKyBoaWRlQnV0dG9uSWQgKyIsICNub3RpZi1jbG9zZSwgI25vdGlmLWNsZWFyIjsKCiAgICAgICAgICAgIGpRdWVyeSgiIyIrIGhpZGVCdXR0b25JZCkuY2xpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhoaWRlQnV0dG9uSWQpOwogICAgICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKGxvY2FsU3RvcmFnZU5hbWUsIHRydWUpOwoKICAgICAgICAgICAgICAgIHN3aXRjaENsYXNzZXMoCiAgICAgICAgICAgICAgICAgICAgbWFpblNlbGVjdG9yLAogICAgICAgICAgICAgICAgICAgICIjIisgb3BlbkJ1dHRvbklkLAogICAgICAgICAgICAgICAgICAgIHZpc2libGVDbGFzcywKICAgICAgICAgICAgICAgICAgICBoaWRkZW5DbGFzcwogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBqUXVlcnkoIiMiKyBvcGVuQnV0dG9uSWQpLmNsaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2cob3BlbkJ1dHRvbklkKTsKICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShsb2NhbFN0b3JhZ2VOYW1lLCBmYWxzZSk7CgogICAgICAgICAgICAgICAgc3dpdGNoQ2xhc3NlcygKICAgICAgICAgICAgICAgICAgICBtYWluU2VsZWN0b3IsCiAgICAgICAgICAgICAgICAgICAgIiMiKyBvcGVuQnV0dG9uSWQsCiAgICAgICAgICAgICAgICAgICAgaGlkZGVuQ2xhc3MsCiAgICAgICAgICAgICAgICAgICAgdmlzaWJsZUNsYXNzCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGZ1bmN0aW9uIHN3aXRjaENsYXNzZXMobWFpblNlbGVjdG9yLCBzdWJTZWxlY3RvciwgcmVtb3ZlZENsYXNzLCBuZXdDbGFzcykgewogICAgICAgICAgICAgICAgalF1ZXJ5KG1haW5TZWxlY3RvcikucmVtb3ZlQ2xhc3MocmVtb3ZlZENsYXNzKTsKICAgICAgICAgICAgICAgIGpRdWVyeShtYWluU2VsZWN0b3IpLmFkZENsYXNzKG5ld0NsYXNzKTsKICAgICAgICAgICAgICAgIGpRdWVyeShzdWJTZWxlY3RvcikucmVtb3ZlQ2xhc3MobmV3Q2xhc3MpOwogICAgICAgICAgICAgICAgalF1ZXJ5KHN1YlNlbGVjdG9yKS5hZGRDbGFzcyhyZW1vdmVkQ2xhc3MpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyA9PT09IENTUyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT18CiAgICAgICAgICAgIGlmKDEpe3ZhciBub3RpZnNDc3MgPQogICAgYDxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+CiAgICAgICAgI2ArIG5vdGlmQ29udGFpbmVySWQgK2AgewogICAgICAgICAgICB3aWR0aDogYCsgbm90aWZzV2lkdGggK2BweDsKICAgICAgICAgICAgbWF4LWhlaWdodDogNTAlOwogICAgICAgICAgICBtYXJnaW46IDAgMnB4IDJweDsKICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7CgogICAgICAgICAgICBsaW5lLWhlaWdodDogaW5pdGlhbDsKICAgICAgICAgICAgY29sb3I6ICMwMDA7CiAgICAgICAgICAgIG9wYWNpdHk6IGArIG5vdGlmc09wYWNpdHkgK2A7CiAgICAgICAgICAgIHBvc2l0aW9uOiBmaXhlZDsKICAgICAgICAgICAgdG9wOiAwcHg7CiAgICAgICAgICAgIHJpZ2h0OiAwcHg7CiAgICAgICAgICAgIHotaW5kZXg6IDk5OTk7CiAgICAgICAgICAgIG92ZXJmbG93LXk6IGF1dG87CiAgICAgICAgfQogICAgICAgICNgKyBub3RpZkNvbnRhaW5lcklkICtgOmhvdmVyIHsKICAgICAgICAgICAgb3BhY2l0eTogMTsKICAgICAgICB9CgogICAgICAgIC5ub3RpZi1yb3VuZGVkLWJsb2NrIHsKICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7CiAgICAgICAgICAgIHBhZGRpbmc6IDJweDsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogM3B4OwogICAgICAgICAgICBtYXJnaW4tdG9wOiAycHg7CgogICAgICAgICAgICBmb250LXNpemU6IDExcHggIWltcG9ydGFudDsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7CiAgICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICAgIH0KCiAgICAgICAgLnMtY291bnRlciB7CiAgICAgICAgICAgIGRpc3BsYXk6IGJsb2NrOwogICAgICAgICAgICBwYWRkaW5nOiAycHg7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgICAgICAgICAgbWFyZ2luLXRvcDogMnB4OwoKICAgICAgICAgICAgYmFja2dyb3VuZDogI2RkZDsKICAgICAgICAgICAgZm9udC1zaXplOiAxMXB4ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAgICAgfQoKICAgICAgICAubm90aWYtdGV4dC1oaWRkZW4gewogICAgICAgICAgICBkaXNwbGF5Om5vbmU7CiAgICAgICAgfQogICAgICAgIC5ub3RpZi10ZXh0LXZpc2libGUgewogICAgICAgICAgICBkaXNwbGF5OiBibG9jazsKICAgICAgICAgICAgbWF4LXdpZHRoOiA1MCU7CiAgICAgICAgICAgIHBhZGRpbmc6IDVweDsKICAgICAgICAgICAgYm9yZGVyOiAjOTk5IHNvbGlkIDJweDsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogMTBweDsKCiAgICAgICAgICAgIHBvc2l0aW9uOiBmaXhlZDsKICAgICAgICAgICAgdG9wOiA1cHg7CiAgICAgICAgICAgIGxlZnQ6IDVweDsKICAgICAgICAgICAgei1pbmRleDogOTk5OTk5OwoKCiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTVweCAhaW1wb3J0YW50OwogICAgICAgICAgICBmb250LXdlaWdodDogYm9sZCAhaW1wb3J0YW50OwogICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXIgIWltcG9ydGFudDsKICAgICAgICAgICAgY29sb3I6IGJsYWNrICFpbXBvcnRhbnQ7CiAgICAgICAgfQoKICAgICAgICAubm90aWYtaW5zdGFuY2UgewogICAgICAgICAgICBkaXNwbGF5OiBibG9jazsKICAgICAgICAgICAgcGFkZGluZzogMnB4OwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA0cHg7CiAgICAgICAgICAgIG1hcmdpbi10b3A6IDJweDsKCiAgICAgICAgICAgIGJhY2tncm91bmQ6IGArIG5vdGlmc0hleCArYDsKICAgICAgICAgICAgZm9udC1zaXplOiAxMXB4ICFpbXBvcnRhbnQ7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgICB9CgogICAgICAgIC5ub3RpZi1pbnN0YW5jZSBkaXZ7LyogZGl2IGhvbGRpbmcgdGhlIHJ1bGUuKi8KICAgICAgICAgICAgbWF4LWhlaWdodDogMTJweDsKICAgICAgICAgICAgcGFkZGluZzogMHB4OwogICAgICAgICAgICBtYXJnaW46IDBweDsKICAgICAgICAgICAgYm9yZGVyOiAwcHg7CgogICAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuOwogICAgICAgICAgICB3b3JkLWJyZWFrOiBicmVhay1hbGw7CiAgICAgICAgfQogICAgICAgIC5ub3RpZi1oaWRkZW57IC8qIG1lYW50IHRvIGhpZGUgdGhlIHJ1bGUgKi8KICAgICAgICAgICAgb3BhY2l0eTogLjE7CiAgICAgICAgfQogICAgICAgIC5ub3RpZi1oaWRkZW46aG92ZXIgewogICAgICAgICAgICBvcGFjaXR5OiAxOwogICAgICAgIH0KCiAgICAgICAgLm5vdGlmLXJlZCB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmNjcwNjY7CiAgICAgICAgfQogICAgICAgIC5ub3RpZi1vcmFuZ2UgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZmZjMTA3OyAvL3llbGxvd2lzaAogICAgICAgIH0KICAgICAgICAubm90aWYteWVsbG93IHsKICAgICAgICAgICAgYmFja2dyb3VuZDogI2ZmYzEwNzsgLy95ZWxsb3dpc2gKICAgICAgICB9CiAgICAgICAgLm5vdGlmLWdyZWVuIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogIzYyYmI2NjsKICAgICAgICB9CiAgICAgICAgLm5vdGlmLWdyYXkgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjNzc3OwogICAgICAgIH0KCiAgICAgICAgLyogY29sbGFwc2libGUgY2xhc3NlcyAqLwogICAgICAgIC5ub3RpZi1oaWRkZW4xIHsKICAgICAgICAgICAgZGlzcGxheTogbm9uZSAhaW1wb3J0YW50OwogICAgICAgIH0KICAgICAgICAubm90aWYtdmlzaWJsZSB7CiAgICAgICAgICAgIGRpc3BsYXk6IGJsb2NrICFpbXBvcnRhbnQ7CiAgICAgICAgfQoKICAgICAgICBkaXYjbGwtY29udGFpbmVyLCBkaXYjb3QtY29udGFpbmVyIHsKICAgICAgICAgICAgYm9yZGVyLXRvcDogc29saWQgYmxhY2sgM3B4OwogICAgICAgIH0KICAgIDwvc3R5bGU+YDsKICAgICAgICAgICAgfQogICAgICAgICAgICBqUXVlcnkoZG9jdW1lbnQuYm9keSkuYXBwZW5kKG5vdGlmc0Nzcyk7CiAgICAgICAgfQoKICAgICAgICBpZihlbmFibGVFeGVjQ291bnRlcikgewogICAgICAgICAgICBqUXVlcnkoIiNub3RpZi1jb250YWluZXIxIikucHJlcGVuZCgiPGRpdiBpZD0nIisgc2NyaXB0VGFnICsiLWNvdW50ZXInIGNsYXNzPSdzLWNvdW50ZXIgLm5vdGlmLXJvdW5kZWQtYmxvY2snPlQgTm8gdGV4dCBub2RlcyBmb3VuZC48L2Rpdj4iKTsKICAgICAgICB9CgogICAgICAgIC8vIHJlc2V0cyBsYXN0SW5kZXggb24gdGVzdHMgd2l0aCBnbG9iYWwgbW9kaWZpZXJzLgogICAgICAgIFJlZ0V4cC5wcm90b3R5cGUucmVnZXhUZXN0ID0gZnVuY3Rpb24odGVzdFN0cmluZyl7CiAgICAgICAgICAgIC8vY29uc29sZWxvZygiIyMgcmVnZXhUZXN0KCkgIyMiLCAxKTsKICAgICAgICAgICAgaWYgKHRoaXMudGVzdCh0ZXN0U3RyaW5nKSkgewogICAgICAgICAgICAgICAgaWYgKC8uXC9pP2cvLnRlc3QodGhpcykgJiYgdGhpcy5sYXN0SW5kZXgpIHsvL3JlZ2V4IGdsb2JhbCBtb2RpZmllciBuZWVkcyB0byBiZSByZXNldC4KICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGVsb2coIiMjIGxhc3QgaW5kZXg6ICIrIHRoaXMubGFzdEluZGV4ICsiICMjIiwgMSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYXN0SW5kZXggPSAwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH07CgogICAgICAgIE5vZGVMaXN0LnByb3RvdHlwZS5mb3JFYWNoID0gQXJyYXkucHJvdG90eXBlLmZvckVhY2g7CiAgICAgICAgCiAgICAgICAgLy8gPT09PSBDQS4gcHJvY2Vzc1BhZ2UoKSA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PXwKCiAgICAgICAgLy8gPT09PSBwcm9jZXNzUGFnZSgpIGdsb2JhbHMgPT09PQogICAgICAgIGxldCB0aXRsZUNoZWNrZWQgPSAwOyAvLyBpZiB0aGUgcGFnZSB0aXRsZSB3YXMgY2hlY2tlZCBvciBub3QuCiAgICAgICAgbGV0IGZ1bGxDaGVjayA9IDA7CgogICAgICAgIC8vID09PT0gY291bnRlcnMgPT09PQogICAgICAgIGxldCBub2RlQ291bnRlciA9IDA7IC8vIGNvdW50cyB0ZXh0IG5vZGVzLgogICAgICAgIGxldCBkZWxldGVNYXRjaGVzID0gMDsKICAgICAgICBsZXQgZnVsbFJlcGxhY2VNYXRjaGVzID0gMDsKICAgICAgICBsZXQgZXhlY3V0aW9uQ291bnRlciA9IDA7IC8vIHRoZSBudW1iZXIgb2YgdGltZXMgcHJvY2Vzc1BhZ2UoKSB3YXMgZXhlY3V0ZWQuCgogICAgICAgIGZ1bmN0aW9uIHByb2Nlc3NQYWdlKCkgewogICAgICAgICAgICBleGVjdXRpb25Db3VudGVyKys7CgogICAgICAgICAgICBsb2dSdW50aW1lcyA9IGdldE9wdGlvblN0YXRlKCJsb2ctIisgc2NyaXB0UHJlZml4ICsicnVudGltZXMiLCBsb2dSdW50aW1lcyk7CiAgICAgICAgICAgIGlmIChsb2dSdW50aW1lcykgewogICAgICAgICAgICAgICAgdmFyIHN0YXJ0VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsZXQgcnVsZXNOdW0gPSByZXBsYWNlUnVsZXMubGVuZ3RoOwoKICAgICAgICAgICAgLy8gcGVyIGVsZW1lbnQgdmFyaWFibGVzCiAgICAgICAgICAgIGxldCBydWxlTWF0Y2hlZCA9IDA7CgogICAgICAgICAgICAvLyA9PT09IGNoZWNrcyB0aGUgdGl0bGUgb2YgdGhlIHBhZ2UgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT18CiAgICAgICAgICAgIGlmKDEpewogICAgICAgICAgICAgICAgbGV0IHRpdGxlVGV4dCA9IGpRdWVyeSgidGl0bGUiKS50ZXh0KCk7CiAgICAgICAgICAgICAgICBpZiAodGl0bGVUZXh0ICYmICF0aXRsZUNoZWNrZWQpIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgcnVsZXNOdW07IGluZGV4KyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcGxhY2VSdWxlc1tpbmRleF1bMF0ucmVnZXhUZXN0KHRpdGxlVGV4dCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGVsb2coc2NyaXB0VGFnICsiICh0aXRsZSBtYXRjaCk6ICIrIHRpdGxlVGV4dCArIiB8ICIrIHJlcGxhY2VSdWxlc1tpbmRleF1bMF0sICJUVC1NQSIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGVUZXh0ID0gdGl0bGVUZXh0LnJlcGxhY2UocmVwbGFjZVJ1bGVzW2luZGV4XVswXSwgcmVwbGFjZVJ1bGVzW2luZGV4XVsxXSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkoInRpdGxlIikudGV4dCh0aXRsZVRleHQpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRpdGxlQ2hlY2tlZCA9IDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vID09PT0gc2VsZWN0cyBzcGVjaWZpZWQgdGV4dCBlbGVtZW50cyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PXwKICAgICAgICAgICAgaWYoMSl7CiAgICAgICAgICAgICAgICBjb25zdCBleGNsdWRlZEVsZW1lbnRzID0gL0NPREV8U0NSSVBUfFNUWUxFfFRFWFRBUkVBL2k7CiAgICAgICAgICAgICAgICBjb25zdCBjaGVja0NsYXNzUmVnZXggPSBuZXcgUmVnRXhwKHNjcmlwdFByZWZpeCArIm5vZGUiLCJpIik7CiAgICAgICAgICAgICAgICB2YXIgdGV4dFdhbGtlciA9IGRvY3VtZW50LmNyZWF0ZVRyZWVXYWxrZXIoCiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keSwKICAgICAgICAgICAgICAgICAgICBOb2RlRmlsdGVyLlNIT1dfVEVYVCwKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFjY2VwdE5vZGU6IGZ1bmN0aW9uIChub2RlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5ub2RlVmFsdWUudHJpbSgpICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIWV4Y2x1ZGVkRWxlbWVudHMudGVzdChub2RlLnBhcmVudE5vZGUubm9kZU5hbWUpICYmIC8vIGV4Y2x1ZGUgc2NyaXB0cyBhbmQgc3R5bGUgZWxlbWVudHMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZnVsbENoZWNrIHx8ICFjaGVja0NsYXNzUmVnZXgudGVzdChub2RlLnBhcmVudE5vZGUuY2xhc3NMaXN0KSkgJiYgLy8gZXhjbHVkZSBjaGVja2VkIGVsZW1lbnRzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIWNsYXNzV2hpdGVsaXN0LnRlc3Qobm9kZS5wYXJlbnROb2RlLmNsYXNzTGlzdCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gTm9kZUZpbHRlci5GSUxURVJfQUNDRVBUOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5vZGVGaWx0ZXIuRklMVEVSX1NLSVA7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIGZhbHNlCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxldCB0ZXh0Tm9kZSA9IHRleHRXYWxrZXIubmV4dE5vZGUoKTsKCiAgICAgICAgICAgIC8vID09PT0gZm9yIGVhY2ggdGV4dE5vZGUgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PXwKICAgICAgICAgICAgd2hpbGUgKHRleHROb2RlKSB7CgogICAgICAgICAgICAgICAgbGV0IG5vZGVUZXh0ID0gdGV4dE5vZGUubm9kZVZhbHVlOyAvLyBpcyBjaGFuZ2VkIGJhc2VkIG9uIG1hdGNoZXMuCiAgICAgICAgICAgICAgICBpZiAoIWZ1bGxDaGVjaykgewogICAgICAgICAgICAgICAgICAgIGxldCBpbW1lZGlhdGVQYXJlbnROb2RlID0gdGV4dE5vZGUucGFyZW50Tm9kZTsgLy8gZWxlbWVudCBjb250YWluaW5nIHRoZSB0ZXh0IG5vZGUuCiAgICAgICAgICAgICAgICAgICAgbm9kZUNvdW50ZXIrKzsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBtYXJrQ2hlY2tlZEVsZW1lbnRzID0gZ2V0T3B0aW9uU3RhdGUoc2NyaXB0UHJlZml4ICsibWFyay1jaGVja2VkIiwgbWFya0NoZWNrZWRFbGVtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG1hcmtDaGVja2VkRWxlbWVudHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaW1tZWRpYXRlUGFyZW50Tm9kZS5jbGFzc0xpc3QuYWRkKHNjcmlwdFByZWZpeCArIm5vZGUtIisgbm9kZUNvdW50ZXIpOyAvL3ByZWZpeAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyA9PT09IGZvciBlYWNoIHJ1bGUgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PXwKICAgICAgICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBydWxlc051bTsgaW5kZXgrKykgewoKICAgICAgICAgICAgICAgICAgICBsZXQgY3VycmVudFJ1bGVSZWdleCA9IHJlcGxhY2VSdWxlc1tpbmRleF1bMF07CiAgICAgICAgICAgICAgICAgICAgbGV0IHJlcGxhY2VtZW50VmFsdWUgPSByZXBsYWNlUnVsZXNbaW5kZXhdWzFdOwoKICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFJ1bGVSZWdleC5yZWdleFRlc3Qobm9kZVRleHQudHJpbSgpKSkgewogICAgICAgICAgICAgICAgICAgICAgICBydWxlTWF0Y2hlZCA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBtYXRjaFByZWZpeCA9ICJHRU4wIjsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZWxvZygiKCIrIHNjcmlwdFRhZyArIikgKG4pIisgbm9kZUNvdW50ZXIgKyIgKG1hdGNoKTogIisgbm9kZVRleHQudHJpbSgpICsiIHwgIisgY3VycmVudFJ1bGVSZWdleCwgIlRYVC1NQSIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlzYWJsZVJlcGxhY2UgPSAwOyAvLyB0ZXN0OiBjaGVjayB3aGF0IGlzIGNoZWNrZWQgdGhyb3VnaCBlYWNoIHJ1bi4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFkaXNhYmxlUmVwbGFjZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmFibGVTcGVjaWFsUmVwbGFjZSA9IGdldE9wdGlvblN0YXRlKCJlbmFibGUtc3BlY2lhbC1yZXBsYWNlIiwgZW5hYmxlU3BlY2lhbFJlcGxhY2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gPT09PSBkZWxldGUxIG1hdGNoID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT18CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW5hYmxlU3BlY2lhbFJlcGxhY2UgJiYgKC9ERUxFVEUxLy50ZXN0KHJlcGxhY2VtZW50VmFsdWUpIHx8IC9ERUxFVEUyLy50ZXN0KHJlcGxhY2VtZW50VmFsdWUpKSApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGVNYXRjaGVzKys7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoUHJlZml4ID0gIkRMVDk5IjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoL0RFTEVURTEvLnRlc3QocmVwbGFjZW1lbnRWYWx1ZSkgJiYgIS9ERUxFVEUxLy50ZXN0KG5vZGVUZXh0KSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaFByZWZpeCA9ICJETFQxIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9ZWxzZSBpZiAoL0RFTEVURTIvLnRlc3QocmVwbGFjZW1lbnRWYWx1ZSkgJiYgIS9ERUxFVEUyLy50ZXN0KG5vZGVUZXh0KSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaFByZWZpeCA9ICJETFQyIjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZWxvZygiKCIrIHNjcmlwdFRhZyArIikgKCIrIG1hdGNoUHJlZml4ICsiKSBuIisgbm9kZUNvdW50ZXIgKyIgKG1hdGNoKTogIisgbm9kZVRleHQudHJpbSgpICsiIHwgIisgY3VycmVudFJ1bGVSZWdleCwgbWF0Y2hQcmVmaXgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZU5vdGlmKG5vZGVDb3VudGVyICsiICIrIG1hdGNoUHJlZml4LCBjdXJyZW50UnVsZVJlZ2V4LCBub2RlVGV4dCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxEZWxldGUgPSBnZXRPcHRpb25TdGF0ZSgiZW5hYmxlLWZ1bGwtZGVsZXRlIiwgZnVsbERlbGV0ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkVGFnID0gZ2V0T3B0aW9uU3RhdGUoImFkZC10YWciLCBhZGRUYWcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRhZ1JlZ2V4ID0gbmV3IFJlZ0V4cCgiXlxcWyIrbWF0Y2hQcmVmaXgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZnVsbERlbGV0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlVGV4dCA9ICIjIyAiKyBtYXRjaFByZWZpeCArIiAjIyI7IC8vIHJlcGxhY2VzIHRoZSB0ZXh0IGNvbXBsZXRlbHkuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlIGlmIChhZGRUYWcgJiYgIXRhZ1JlZ2V4LnRleHQobm9kZVRleHQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGVUZXh0ID0gIlsiKyBtYXRjaFByZWZpeCArIl06ICIgKyBub2RlVGV4dDsgLy8gcHJlcGVuZHMgRExUMSBvciBETFQyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gPT09PSBmdWxsIHJlcGxhY2UgbWF0Y2ggPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT18CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW5hYmxlU3BlY2lhbFJlcGxhY2UgJiYgL15GUjEvLnRlc3QocmVwbGFjZW1lbnRWYWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdWxsUmVwbGFjZU1hdGNoZXMrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaFByZWZpeCA9ICJGUjEiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGVsb2coIigiKyBzY3JpcHRUYWcgKyIpICgiKyBtYXRjaFByZWZpeCArIikgbiIrIG5vZGVDb3VudGVyICsiIChtYXRjaCk6ICIrIG5vZGVUZXh0LnRyaW0oKSArIiB8ICIrIGN1cnJlbnRSdWxlUmVnZXgsIG1hdGNoUHJlZml4KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVOb3RpZihub2RlQ291bnRlciArIiAiKyBtYXRjaFByZWZpeCwgY3VycmVudFJ1bGVSZWdleCwgbm9kZVRleHQpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBub2RlVGV4dCA9IHJlcGxhY2VtZW50VmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyA9PT09IGJhc2UgY2FzZSA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PXwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGVUZXh0ID0gbm9kZVRleHQucmVwbGFjZShjdXJyZW50UnVsZVJlZ2V4LCByZXBsYWNlbWVudFZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSAvLyBlbmQgaWYgKCFkaXNhYmxlUmVwbGFjZSkKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IC8vIGVuZCBmb3IgKGVhY2ggcnVsZSkgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PXwKCiAgICAgICAgICAgICAgICBpZiAocnVsZU1hdGNoZWQpIHsgLy8gbW9kaWZ5IHRleHQgYmxvY2suCiAgICAgICAgICAgICAgICAgICAgcnVsZU1hdGNoZWQgPSAwOwogICAgICAgICAgICAgICAgICAgIHRleHROb2RlLm5vZGVWYWx1ZSA9IG5vZGVUZXh0OwogICAgICAgICAgICAgICAgICAgIGNvbnNvbGVsb2coIigiKyBzY3JpcHRUYWcgKyIpIChuKSIrIG5vZGVDb3VudGVyICsiICh0ZXh0KTogIisgbm9kZVRleHQudHJpbSgpLCAiQ0gtVFQiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRleHROb2RlID0gdGV4dFdhbGtlci5uZXh0Tm9kZSgpOwogICAgICAgICAgICB9IC8vIGVuZCB3aGlsZSAodGV4dE5vZGUpID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT18CgogICAgICAgICAgICBpZiAoIWZ1bGxDaGVjaykgewogICAgICAgICAgICAgICAgLy8gPT09PSB1cGRhdGUgY291bnRlciA9PT09CiAgICAgICAgICAgICAgICBsZXQgY291bnRlclRleHQgPSAiVCBETFQ6IisgZGVsZXRlTWF0Y2hlcyArIiB8IEZSOiIrIGZ1bGxSZXBsYWNlTWF0Y2hlcyArIiB8IE46Iisgbm9kZUNvdW50ZXIgKyAiIHwgRVg6IisgZXhlY3V0aW9uQ291bnRlcjsKICAgICAgICAgICAgICAgIGpRdWVyeSgiIyIrIHNjcmlwdFRhZyArIi1jb3VudGVyIikudGV4dChjb3VudGVyVGV4dCk7CiAgICAgICAgICAgICAgICBpZiAobm9kZUNvdW50ZXIpIHsKICAgICAgICAgICAgICAgICAgICBqUXVlcnkoIiMiKyBzY3JpcHRUYWcgKyItY291bnRlciIpLmFkZENsYXNzKCJub3RpZi1ncmVlbiIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9ZWxzZSB7IC8vZW5kIGZ1bGxDaGVjay4KICAgICAgICAgICAgICAgIGZ1bGxDaGVjayA9IDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vY29uc29sZWxvZygiIyMgKCIrIHNjcmlwdFRhZyArIikgZXhlY3V0aW9uICMiKyBleGVjdXRpb25Db3VudGVyICsiICMjIiwgIkVYRUMiKTsKICAgICAgICAgICAgLy8gc2NyaXB0IG9wdGlvbiBoYW5kbGVzIGlmIHRoaXMgaXMgZGlzcGxheWVkIG9yIG5vdC4KICAgICAgICAgICAgaWYgKGxvZ1J1bnRpbWVzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBlbmRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgICAgICAgICAgICBjb25zdCBydW5UaW1lID0gKChlbmRUaW1lIC0gc3RhcnRUaW1lKSAvIDEwMDApLnRvRml4ZWQoMik7CiAgICAgICAgICAgICAgICBpZiAocnVuVGltZSA+IDEpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlbG9nKCcoJysgc2NyaXB0VGFnICsnKSBmaW5pc2hlZCBhZnRlciAnICsgcnVuVGltZSArICcgc2Vjb25kcy4nLCAiUlVOVCIpOwogICAgICAgICAgICAgICAgfWVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGVsb2coJygnKyBzY3JpcHRUYWcgKycpIGZpbmlzaGVkIGluIGxlc3MgdGhhbiAxIHNlY29uZC4nLCAiUlVOVCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSAvL2VuZCBmdW5jdGlvbiBmdW5jdGlvbiByZXBsYWNlVGV4dCgpCgogICAgICAgIC8vID09PT0gQ0IuIGV4ZWN1dGlvbiBjb250cm9sID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT18CiAgICAgICAgCiAgICAgICAgLy9jb25zb2xlLmxvZygiKCIrIHNjcmlwdFRhZyArIikgRVhFQzogSW5pdGlhbCBydW4uIik7CiAgICAgICAgLy9wcm9jZXNzUGFnZSgpOwogICAgICAgIGxldCBydW5XaGVuUmVhZHkgPSAwOwogICAgICAgIHJ1bldoZW5SZWFkeSA9IGdldE9wdGlvblN0YXRlKCJydW4td2hlbi1yZWFkeSIsIHJ1bldoZW5SZWFkeSk7CiAgICAgICAgaWYgKHJ1bldoZW5SZWFkeSkgewogICAgICAgICAgICBqUXVlcnkoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkgeyAvL2FmdGVyIERPTSBoYXMgbG9hZGVkLgogICAgICAgICAgICAgICAgY29uc29sZWxvZygiKCIrIHNjcmlwdFRhZyArIikgRVhFQzogZG9jdW1lbnQucmVhZHkoKSIsICJFWEVDIik7CiAgICAgICAgICAgICAgICAvL2Z1bGxDaGVjayA9IDE7CiAgICAgICAgICAgICAgICBwcm9jZXNzUGFnZSgpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGxldCBydW5XaGVuTG9hZGVkID0gMTsKICAgICAgICBydW5XaGVuTG9hZGVkID0gZ2V0T3B0aW9uU3RhdGUoInJ1bi13aGVuLWxvYWRlZCIsIHJ1bldoZW5Mb2FkZWQpOwogICAgICAgIGlmIChydW5XaGVuTG9hZGVkKSB7CiAgICAgICAgICAgIGpRdWVyeSh3aW5kb3cpLm9uKCJsb2FkIiwgZnVuY3Rpb24oKSB7IC8vYWZ0ZXIgYWxsIGluaXRpYWwgaW1hZ2VzIGFyZSBsb2FkZWQuCiAgICAgICAgICAgICAgICBjb25zb2xlbG9nKCIoIisgc2NyaXB0VGFnICsiKSBFWEVDOiB3aW5kb3cubG9hZCgpIiwgIkVYRUMiKTsKICAgICAgICAgICAgICAgIC8vZnVsbENoZWNrID0gMTsKICAgICAgICAgICAgICAgIHByb2Nlc3NQYWdlKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBpZiAoZHluYW1pY0NoZWNraW5nKSB7CiAgICAgICAgICAgIGpRdWVyeShkb2N1bWVudCkucmVhZHkod2FpdEZvcktleUVsZW1lbnRzKCJpbWciLCBwcm9jZXNzUGFnZSkpOwogICAgICAgIH0KCiAgICAgICAgLy8gPT09PSBEQS4gc2NyaXB0IGJ1dHRvbiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PXwKCiAgICAgICAgbGV0IGJ1dHRvbnNDb250YWluZXJJZCA9ICJjdGItY29udGFpbmVyMSI7CiAgICAgICAgaWYgKGdlbmVyYXRlUmVjaGVja0J1dHRvbiAmJiBqUXVlcnkoIiMiKyBidXR0b25zQ29udGFpbmVySWQpLmxlbmd0aCkgewogICAgICAgICAgICBqUXVlcnkoIiMiKyBidXR0b25zQ29udGFpbmVySWQpLnByZXBlbmQoIjxkaXYgaWQ9JyIrIHNjcmlwdFRhZyArIi1yZXNldCcgY2xhc3M9J2N0Yi1ibHVlIGN0Yi1yb3VuZGVkLWJsb2NrJz5ydW4gIisgc2NyaXB0VGFnICsiPC9kaXY+Iik7IC8vYWRkZWQgdG8gYmVnaW5uaW5nCiAgICAgICAgICAgIC8valF1ZXJ5KCIjIisgc2NyaXB0VGFnICsiLXJlc2V0IikuY2xpY2socHJvY2Vzc1BhZ2UpOwogICAgICAgICAgICBqUXVlcnkoIiMiKyBzY3JpcHRUYWcgKyItcmVzZXQiKS5jbGljayhmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGZ1bGxDaGVjayA9IDE7CiAgICAgICAgICAgICAgICBwcm9jZXNzUGFnZSgpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIC8vID09PT0gREIuIHN1cHBvcnQgZnVuY3Rpb25zID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT18CgogICAgICAgIGZ1bmN0aW9uIGNyZWF0ZU5vdGlmKG5vdGlmTGFiZWwsIG5vdGlmUnVsZSwgbm90aWZUZXh0KSB7IC8vbXNnMSBuZWVkcyB0byBtYXRjaCBub3RpZlR5cGVzCiAgICAgICAgICAgIGVuYWJsZU5vdGlmaWNhdGlvbnMgPSBnZXRPcHRpb25TdGF0ZSgiZW5hYmxlLSIrIHNjcmlwdFByZWZpeCArIm5vdGlmcyIsIGVuYWJsZU5vdGlmaWNhdGlvbnMpOwogICAgICAgICAgICBpZiAoZW5hYmxlTm90aWZpY2F0aW9ucykgewogICAgICAgICAgICAgICAgbGV0IGFkZGl0aW9uYWxDbGFzcyA9ICJub3RpZi1ncmF5IjsKICAgICAgICAgICAgICAgIGxldCBub3RpZkNvbnRhaW5lciA9ICJvdC1jb250YWluZXIiOwogICAgICAgICAgICAgICAgaWYgKC9kbHQvaS50ZXN0KG5vdGlmTGFiZWwpKSB7CiAgICAgICAgICAgICAgICAgICAgYWRkaXRpb25hbENsYXNzID0gIm5vdGlmLXJlZCI7CiAgICAgICAgICAgICAgICAgICAgbm90aWZDb250YWluZXIgPSAiZGx0LWNvbnRhaW5lciI7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbGV0IG5ld05vdGlmID0KICAgICAgICAgICAgICAgICAgICAiPGRpdiBjbGFzcz0nbm90aWYtaW5zdGFuY2UgIisgYWRkaXRpb25hbENsYXNzICsiJz48ZGl2PnQgbiIrIG5vdGlmTGFiZWwgKyI8L2Rpdj4iKwogICAgICAgICAgICAgICAgICAgICAgICAiPGRpdiBjbGFzcz0nbm90aWYtaGlkZGVuJz4iKyBub3RpZlJ1bGUgKyI8L2Rpdj4iKwogICAgICAgICAgICAgICAgICAgICAgICAiPGRpdiBjbGFzcz0nbm90aWYtdGV4dCcgaGlkZGVuPiIrIG5vdGlmVGV4dCsiPC9kaXY+IisgLy8gdG8gYmUgZGlzcGxheWVkIGF0IHRoZSBib3R0b20gbGVmdC4KICAgICAgICAgICAgICAgICAgICAiPC9kaXY+IjsKCiAgICAgICAgICAgICAgICBsZXQgZW5hYmxlZE5vdGlmVHlwZXNSZWdleCA9IC8uLzsKICAgICAgICAgICAgICAgIGlmIChlbmFibGVkTm90aWZUeXBlc1JlZ2V4LnRlc3Qobm90aWZMYWJlbCkpIHsKICAgICAgICAgICAgICAgICAgICBqUXVlcnkoIiMiKyBub3RpZkNvbnRhaW5lcikuYXBwZW5kKG5ld05vdGlmKTsKICAgICAgICAgICAgICAgICAgICBqUXVlcnkoIi5ub3RpZi1pbnN0YW5jZSIpLmNsaWNrKGZ1bmN0aW9uKCl7CiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeSgiI25vdGlmLWNvbnRhaW5lcjIiKS5lbXB0eSgpOwogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgICBpZiAoIS9kbHQvaS50ZXN0KG5vdGlmTGFiZWwpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGpRdWVyeSgiI290LWNvbnRhaW5lciIpLnJlbW92ZUNsYXNzKCJub3RpZi1oaWRkZW4xIik7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBhdXRvaGlkZU5vdGlmcyA9IGdldE9wdGlvblN0YXRlKCJhdXRvaGlkZS1ub3RpZmljYXRpb25zIiwgYXV0b2hpZGVOb3RpZnMpOwogICAgICAgICAgICAgICAgICAgIGlmIChhdXRvaGlkZU5vdGlmcykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBub3RpZkR1cmF0aW9uID0gMTA7IC8vIGRlZmF1bHQgMTA7IGFtb3VudCBvZiBzZWNvbmRzIG5vdGlmaWNhdGlvbnMgYXJlIGRpc3BsYXllZCBiZWZvcmUgZGlzYXBwZWFyaW5nLgogICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5KCIubm90aWYtaW5zdGFuY2UiKS5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSwgbm90aWZEdXJhdGlvbioxMDAwKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IC8vIGVuZCBmdW5jdGlvbiBjcmVhdE5vdGlmKCkKCiAgICAgICAgZnVuY3Rpb24gY29uc29sZWxvZyh0ZXh0LCBtZXNzYWdlVHlwZSkgewogICAgICAgICAgICBpZiAoZW5hYmxlQ29uc29sZU1lc3NhZ2VzICYmIGVuYWJsZWRNZXNzYWdlc1JlZ2V4LnRlc3QobWVzc2FnZVR5cGUpKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0ZXh0KTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gPT09PSBzY3JpcHQgZW5kID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PXwKICAgICAgICBjb25zb2xlbG9nKCIjIyMjICgiKyBzY3JpcHRUYWcgKyIpIHRleHQgcmVwbGFjZSBzY3JpcHQgaXMgYWN0aXZlLiAjIyMjIiwgIkVYRUMiKTsKCiAgICB9IC8vIGVuZCBpZiAocnVuU2NyaXB0KQoKICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09fAoKICAgIC8vID0gZ2V0T3B0aW9uU3RhdGUoLCApOwogICAgLy8gdXNlZCB0byB1cGRhdGUgb3B0aW9uIGlmICdzY3JpcHQgb3B0aW9uJyBpcyBzZXQuCiAgICBmdW5jdGlvbiBnZXRPcHRpb25TdGF0ZShpZE5hbWUsIGN1cnJlbnRTdGF0ZSkgewogICAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZE5hbWUpKSB7CiAgICAgICAgICAgIHJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZE5hbWUpLmNoZWNrZWQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjdXJyZW50U3RhdGU7CiAgICB9Cn0pKCk7","requires":[{"meta":{"name":"jquery-3.4.1.min.js","url":"https://code.jquery.com/jquery-3.4.1.min.js","ts":1722952721150,"mimetype":"text/javascript"},"source":"LyohIGpRdWVyeSB2My40LjEgfCAoYykgSlMgRm91bmRhdGlvbiBhbmQgb3RoZXIgY29udHJpYnV0b3JzIHwganF1ZXJ5Lm9yZy9saWNlbnNlICovCiFmdW5jdGlvbihlLHQpeyJ1c2Ugc3RyaWN0Ijsib2JqZWN0Ij09dHlwZW9mIG1vZHVsZSYmIm9iamVjdCI9PXR5cGVvZiBtb2R1bGUuZXhwb3J0cz9tb2R1bGUuZXhwb3J0cz1lLmRvY3VtZW50P3QoZSwhMCk6ZnVuY3Rpb24oZSl7aWYoIWUuZG9jdW1lbnQpdGhyb3cgbmV3IEVycm9yKCJqUXVlcnkgcmVxdWlyZXMgYSB3aW5kb3cgd2l0aCBhIGRvY3VtZW50Iik7cmV0dXJuIHQoZSl9OnQoZSl9KCJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93P3dpbmRvdzp0aGlzLGZ1bmN0aW9uKEMsZSl7InVzZSBzdHJpY3QiO3ZhciB0PVtdLEU9Qy5kb2N1bWVudCxyPU9iamVjdC5nZXRQcm90b3R5cGVPZixzPXQuc2xpY2UsZz10LmNvbmNhdCx1PXQucHVzaCxpPXQuaW5kZXhPZixuPXt9LG89bi50b1N0cmluZyx2PW4uaGFzT3duUHJvcGVydHksYT12LnRvU3RyaW5nLGw9YS5jYWxsKE9iamVjdCkseT17fSxtPWZ1bmN0aW9uKGUpe3JldHVybiJmdW5jdGlvbiI9PXR5cGVvZiBlJiYibnVtYmVyIiE9dHlwZW9mIGUubm9kZVR5cGV9LHg9ZnVuY3Rpb24oZSl7cmV0dXJuIG51bGwhPWUmJmU9PT1lLndpbmRvd30sYz17dHlwZTohMCxzcmM6ITAsbm9uY2U6ITAsbm9Nb2R1bGU6ITB9O2Z1bmN0aW9uIGIoZSx0LG4pe3ZhciByLGksbz0obj1ufHxFKS5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTtpZihvLnRleHQ9ZSx0KWZvcihyIGluIGMpKGk9dFtyXXx8dC5nZXRBdHRyaWJ1dGUmJnQuZ2V0QXR0cmlidXRlKHIpKSYmby5zZXRBdHRyaWJ1dGUocixpKTtuLmhlYWQuYXBwZW5kQ2hpbGQobykucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChvKX1mdW5jdGlvbiB3KGUpe3JldHVybiBudWxsPT1lP2UrIiI6Im9iamVjdCI9PXR5cGVvZiBlfHwiZnVuY3Rpb24iPT10eXBlb2YgZT9uW28uY2FsbChlKV18fCJvYmplY3QiOnR5cGVvZiBlfXZhciBmPSIzLjQuMSIsaz1mdW5jdGlvbihlLHQpe3JldHVybiBuZXcgay5mbi5pbml0KGUsdCl9LHA9L15bXHNcdUZFRkZceEEwXSt8W1xzXHVGRUZGXHhBMF0rJC9nO2Z1bmN0aW9uIGQoZSl7dmFyIHQ9ISFlJiYibGVuZ3RoImluIGUmJmUubGVuZ3RoLG49dyhlKTtyZXR1cm4hbShlKSYmIXgoZSkmJigiYXJyYXkiPT09bnx8MD09PXR8fCJudW1iZXIiPT10eXBlb2YgdCYmMDx0JiZ0LTEgaW4gZSl9ay5mbj1rLnByb3RvdHlwZT17anF1ZXJ5OmYsY29uc3RydWN0b3I6ayxsZW5ndGg6MCx0b0FycmF5OmZ1bmN0aW9uKCl7cmV0dXJuIHMuY2FsbCh0aGlzKX0sZ2V0OmZ1bmN0aW9uKGUpe3JldHVybiBudWxsPT1lP3MuY2FsbCh0aGlzKTplPDA/dGhpc1tlK3RoaXMubGVuZ3RoXTp0aGlzW2VdfSxwdXNoU3RhY2s6ZnVuY3Rpb24oZSl7dmFyIHQ9ay5tZXJnZSh0aGlzLmNvbnN0cnVjdG9yKCksZSk7cmV0dXJuIHQucHJldk9iamVjdD10aGlzLHR9LGVhY2g6ZnVuY3Rpb24oZSl7cmV0dXJuIGsuZWFjaCh0aGlzLGUpfSxtYXA6ZnVuY3Rpb24obil7cmV0dXJuIHRoaXMucHVzaFN0YWNrKGsubWFwKHRoaXMsZnVuY3Rpb24oZSx0KXtyZXR1cm4gbi5jYWxsKGUsdCxlKX0pKX0sc2xpY2U6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5wdXNoU3RhY2socy5hcHBseSh0aGlzLGFyZ3VtZW50cykpfSxmaXJzdDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmVxKDApfSxsYXN0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZXEoLTEpfSxlcTpmdW5jdGlvbihlKXt2YXIgdD10aGlzLmxlbmd0aCxuPStlKyhlPDA/dDowKTtyZXR1cm4gdGhpcy5wdXNoU3RhY2soMDw9biYmbjx0P1t0aGlzW25dXTpbXSl9LGVuZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnByZXZPYmplY3R8fHRoaXMuY29uc3RydWN0b3IoKX0scHVzaDp1LHNvcnQ6dC5zb3J0LHNwbGljZTp0LnNwbGljZX0say5leHRlbmQ9ay5mbi5leHRlbmQ9ZnVuY3Rpb24oKXt2YXIgZSx0LG4scixpLG8sYT1hcmd1bWVudHNbMF18fHt9LHM9MSx1PWFyZ3VtZW50cy5sZW5ndGgsbD0hMTtmb3IoImJvb2xlYW4iPT10eXBlb2YgYSYmKGw9YSxhPWFyZ3VtZW50c1tzXXx8e30scysrKSwib2JqZWN0Ij09dHlwZW9mIGF8fG0oYSl8fChhPXt9KSxzPT09dSYmKGE9dGhpcyxzLS0pO3M8dTtzKyspaWYobnVsbCE9KGU9YXJndW1lbnRzW3NdKSlmb3IodCBpbiBlKXI9ZVt0XSwiX19wcm90b19fIiE9PXQmJmEhPT1yJiYobCYmciYmKGsuaXNQbGFpbk9iamVjdChyKXx8KGk9QXJyYXkuaXNBcnJheShyKSkpPyhuPWFbdF0sbz1pJiYhQXJyYXkuaXNBcnJheShuKT9bXTppfHxrLmlzUGxhaW5PYmplY3Qobik/bjp7fSxpPSExLGFbdF09ay5leHRlbmQobCxvLHIpKTp2b2lkIDAhPT1yJiYoYVt0XT1yKSk7cmV0dXJuIGF9LGsuZXh0ZW5kKHtleHBhbmRvOiJqUXVlcnkiKyhmK01hdGgucmFuZG9tKCkpLnJlcGxhY2UoL1xEL2csIiIpLGlzUmVhZHk6ITAsZXJyb3I6ZnVuY3Rpb24oZSl7dGhyb3cgbmV3IEVycm9yKGUpfSxub29wOmZ1bmN0aW9uKCl7fSxpc1BsYWluT2JqZWN0OmZ1bmN0aW9uKGUpe3ZhciB0LG47cmV0dXJuISghZXx8IltvYmplY3QgT2JqZWN0XSIhPT1vLmNhbGwoZSkpJiYoISh0PXIoZSkpfHwiZnVuY3Rpb24iPT10eXBlb2Yobj12LmNhbGwodCwiY29uc3RydWN0b3IiKSYmdC5jb25zdHJ1Y3RvcikmJmEuY2FsbChuKT09PWwpfSxpc0VtcHR5T2JqZWN0OmZ1bmN0aW9uKGUpe3ZhciB0O2Zvcih0IGluIGUpcmV0dXJuITE7cmV0dXJuITB9LGdsb2JhbEV2YWw6ZnVuY3Rpb24oZSx0KXtiKGUse25vbmNlOnQmJnQubm9uY2V9KX0sZWFjaDpmdW5jdGlvbihlLHQpe3ZhciBuLHI9MDtpZihkKGUpKXtmb3Iobj1lLmxlbmd0aDtyPG47cisrKWlmKCExPT09dC5jYWxsKGVbcl0scixlW3JdKSlicmVha31lbHNlIGZvcihyIGluIGUpaWYoITE9PT10LmNhbGwoZVtyXSxyLGVbcl0pKWJyZWFrO3JldHVybiBlfSx0cmltOmZ1bmN0aW9uKGUpe3JldHVybiBudWxsPT1lPyIiOihlKyIiKS5yZXBsYWNlKHAsIiIpfSxtYWtlQXJyYXk6ZnVuY3Rpb24oZSx0KXt2YXIgbj10fHxbXTtyZXR1cm4gbnVsbCE9ZSYmKGQoT2JqZWN0KGUpKT9rLm1lcmdlKG4sInN0cmluZyI9PXR5cGVvZiBlP1tlXTplKTp1LmNhbGwobixlKSksbn0saW5BcnJheTpmdW5jdGlvbihlLHQsbil7cmV0dXJuIG51bGw9PXQ/LTE6aS5jYWxsKHQsZSxuKX0sbWVyZ2U6ZnVuY3Rpb24oZSx0KXtmb3IodmFyIG49K3QubGVuZ3RoLHI9MCxpPWUubGVuZ3RoO3I8bjtyKyspZVtpKytdPXRbcl07cmV0dXJuIGUubGVuZ3RoPWksZX0sZ3JlcDpmdW5jdGlvbihlLHQsbil7Zm9yKHZhciByPVtdLGk9MCxvPWUubGVuZ3RoLGE9IW47aTxvO2krKykhdChlW2ldLGkpIT09YSYmci5wdXNoKGVbaV0pO3JldHVybiByfSxtYXA6ZnVuY3Rpb24oZSx0LG4pe3ZhciByLGksbz0wLGE9W107aWYoZChlKSlmb3Iocj1lLmxlbmd0aDtvPHI7bysrKW51bGwhPShpPXQoZVtvXSxvLG4pKSYmYS5wdXNoKGkpO2Vsc2UgZm9yKG8gaW4gZSludWxsIT0oaT10KGVbb10sbyxuKSkmJmEucHVzaChpKTtyZXR1cm4gZy5hcHBseShbXSxhKX0sZ3VpZDoxLHN1cHBvcnQ6eX0pLCJmdW5jdGlvbiI9PXR5cGVvZiBTeW1ib2wmJihrLmZuW1N5bWJvbC5pdGVyYXRvcl09dFtTeW1ib2wuaXRlcmF0b3JdKSxrLmVhY2goIkJvb2xlYW4gTnVtYmVyIFN0cmluZyBGdW5jdGlvbiBBcnJheSBEYXRlIFJlZ0V4cCBPYmplY3QgRXJyb3IgU3ltYm9sIi5zcGxpdCgiICIpLGZ1bmN0aW9uKGUsdCl7blsiW29iamVjdCAiK3QrIl0iXT10LnRvTG93ZXJDYXNlKCl9KTt2YXIgaD1mdW5jdGlvbihuKXt2YXIgZSxkLGIsbyxpLGgsZixnLHcsdSxsLFQsQyxhLEUsdixzLGMseSxrPSJzaXp6bGUiKzEqbmV3IERhdGUsbT1uLmRvY3VtZW50LFM9MCxyPTAscD11ZSgpLHg9dWUoKSxOPXVlKCksQT11ZSgpLEQ9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZT09PXQmJihsPSEwKSwwfSxqPXt9Lmhhc093blByb3BlcnR5LHQ9W10scT10LnBvcCxMPXQucHVzaCxIPXQucHVzaCxPPXQuc2xpY2UsUD1mdW5jdGlvbihlLHQpe2Zvcih2YXIgbj0wLHI9ZS5sZW5ndGg7bjxyO24rKylpZihlW25dPT09dClyZXR1cm4gbjtyZXR1cm4tMX0sUj0iY2hlY2tlZHxzZWxlY3RlZHxhc3luY3xhdXRvZm9jdXN8YXV0b3BsYXl8Y29udHJvbHN8ZGVmZXJ8ZGlzYWJsZWR8aGlkZGVufGlzbWFwfGxvb3B8bXVsdGlwbGV8b3BlbnxyZWFkb25seXxyZXF1aXJlZHxzY29wZWQiLE09IltcXHgyMFxcdFxcclxcblxcZl0iLEk9Iig/OlxcXFwufFtcXHctXXxbXlwwLVxceGEwXSkrIixXPSJcXFsiK00rIiooIitJKyIpKD86IitNKyIqKFsqXiR8IX5dPz0pIitNKyIqKD86JygoPzpcXFxcLnxbXlxcXFwnXSkqKSd8XCIoKD86XFxcXC58W15cXFxcXCJdKSopXCJ8KCIrSSsiKSl8KSIrTSsiKlxcXSIsJD0iOigiK0krIikoPzpcXCgoKCcoKD86XFxcXC58W15cXFxcJ10pKiknfFwiKCg/OlxcXFwufFteXFxcXFwiXSkqKVwiKXwoKD86XFxcXC58W15cXFxcKClbXFxdXXwiK1crIikqKXwuKilcXCl8KSIsRj1uZXcgUmVnRXhwKE0rIisiLCJnIiksQj1uZXcgUmVnRXhwKCJeIitNKyIrfCgoPzpefFteXFxcXF0pKD86XFxcXC4pKikiK00rIiskIiwiZyIpLF89bmV3IFJlZ0V4cCgiXiIrTSsiKiwiK00rIioiKSx6PW5ldyBSZWdFeHAoIl4iK00rIiooWz4rfl18IitNKyIpIitNKyIqIiksVT1uZXcgUmVnRXhwKE0rInw+IiksWD1uZXcgUmVnRXhwKCQpLFY9bmV3IFJlZ0V4cCgiXiIrSSsiJCIpLEc9e0lEOm5ldyBSZWdFeHAoIl4jKCIrSSsiKSIpLENMQVNTOm5ldyBSZWdFeHAoIl5cXC4oIitJKyIpIiksVEFHOm5ldyBSZWdFeHAoIl4oIitJKyJ8WypdKSIpLEFUVFI6bmV3IFJlZ0V4cCgiXiIrVyksUFNFVURPOm5ldyBSZWdFeHAoIl4iKyQpLENISUxEOm5ldyBSZWdFeHAoIl46KG9ubHl8Zmlyc3R8bGFzdHxudGh8bnRoLWxhc3QpLShjaGlsZHxvZi10eXBlKSg/OlxcKCIrTSsiKihldmVufG9kZHwoKFsrLV18KShcXGQqKW58KSIrTSsiKig/OihbKy1dfCkiK00rIiooXFxkKyl8KSkiK00rIipcXCl8KSIsImkiKSxib29sOm5ldyBSZWdFeHAoIl4oPzoiK1IrIikkIiwiaSIpLG5lZWRzQ29udGV4dDpuZXcgUmVnRXhwKCJeIitNKyIqWz4rfl18OihldmVufG9kZHxlcXxndHxsdHxudGh8Zmlyc3R8bGFzdCkoPzpcXCgiK00rIiooKD86LVxcZCk/XFxkKikiK00rIipcXCl8KSg/PVteLV18JCkiLCJpIil9LFk9L0hUTUwkL2ksUT0vXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYXxidXR0b24pJC9pLEo9L15oXGQkL2ksSz0vXltee10rXHtccypcW25hdGl2ZSBcdy8sWj0vXig/OiMoW1x3LV0rKXwoXHcrKXxcLihbXHctXSspKSQvLGVlPS9bK35dLyx0ZT1uZXcgUmVnRXhwKCJcXFxcKFtcXGRhLWZdezEsNn0iK00rIj98KCIrTSsiKXwuKSIsImlnIiksbmU9ZnVuY3Rpb24oZSx0LG4pe3ZhciByPSIweCIrdC02NTUzNjtyZXR1cm4gciE9cnx8bj90OnI8MD9TdHJpbmcuZnJvbUNoYXJDb2RlKHIrNjU1MzYpOlN0cmluZy5mcm9tQ2hhckNvZGUocj4+MTB8NTUyOTYsMTAyMyZyfDU2MzIwKX0scmU9LyhbXDAtXHgxZlx4N2ZdfF4tP1xkKXxeLSR8W15cMC1ceDFmXHg3Zi1cdUZGRkZcdy1dL2csaWU9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdD8iXDAiPT09ZT8iXHVmZmZkIjplLnNsaWNlKDAsLTEpKyJcXCIrZS5jaGFyQ29kZUF0KGUubGVuZ3RoLTEpLnRvU3RyaW5nKDE2KSsiICI6IlxcIitlfSxvZT1mdW5jdGlvbigpe1QoKX0sYWU9YmUoZnVuY3Rpb24oZSl7cmV0dXJuITA9PT1lLmRpc2FibGVkJiYiZmllbGRzZXQiPT09ZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpfSx7ZGlyOiJwYXJlbnROb2RlIixuZXh0OiJsZWdlbmQifSk7dHJ5e0guYXBwbHkodD1PLmNhbGwobS5jaGlsZE5vZGVzKSxtLmNoaWxkTm9kZXMpLHRbbS5jaGlsZE5vZGVzLmxlbmd0aF0ubm9kZVR5cGV9Y2F0Y2goZSl7SD17YXBwbHk6dC5sZW5ndGg/ZnVuY3Rpb24oZSx0KXtMLmFwcGx5KGUsTy5jYWxsKHQpKX06ZnVuY3Rpb24oZSx0KXt2YXIgbj1lLmxlbmd0aCxyPTA7d2hpbGUoZVtuKytdPXRbcisrXSk7ZS5sZW5ndGg9bi0xfX19ZnVuY3Rpb24gc2UodCxlLG4scil7dmFyIGksbyxhLHMsdSxsLGMsZj1lJiZlLm93bmVyRG9jdW1lbnQscD1lP2Uubm9kZVR5cGU6OTtpZihuPW58fFtdLCJzdHJpbmciIT10eXBlb2YgdHx8IXR8fDEhPT1wJiY5IT09cCYmMTEhPT1wKXJldHVybiBuO2lmKCFyJiYoKGU/ZS5vd25lckRvY3VtZW50fHxlOm0pIT09QyYmVChlKSxlPWV8fEMsRSkpe2lmKDExIT09cCYmKHU9Wi5leGVjKHQpKSlpZihpPXVbMV0pe2lmKDk9PT1wKXtpZighKGE9ZS5nZXRFbGVtZW50QnlJZChpKSkpcmV0dXJuIG47aWYoYS5pZD09PWkpcmV0dXJuIG4ucHVzaChhKSxufWVsc2UgaWYoZiYmKGE9Zi5nZXRFbGVtZW50QnlJZChpKSkmJnkoZSxhKSYmYS5pZD09PWkpcmV0dXJuIG4ucHVzaChhKSxufWVsc2V7aWYodVsyXSlyZXR1cm4gSC5hcHBseShuLGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUodCkpLG47aWYoKGk9dVszXSkmJmQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSYmZS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKXJldHVybiBILmFwcGx5KG4sZS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGkpKSxufWlmKGQucXNhJiYhQVt0KyIgIl0mJighdnx8IXYudGVzdCh0KSkmJigxIT09cHx8Im9iamVjdCIhPT1lLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkpKXtpZihjPXQsZj1lLDE9PT1wJiZVLnRlc3QodCkpeyhzPWUuZ2V0QXR0cmlidXRlKCJpZCIpKT9zPXMucmVwbGFjZShyZSxpZSk6ZS5zZXRBdHRyaWJ1dGUoImlkIixzPWspLG89KGw9aCh0KSkubGVuZ3RoO3doaWxlKG8tLSlsW29dPSIjIitzKyIgIit4ZShsW29dKTtjPWwuam9pbigiLCIpLGY9ZWUudGVzdCh0KSYmeWUoZS5wYXJlbnROb2RlKXx8ZX10cnl7cmV0dXJuIEguYXBwbHkobixmLnF1ZXJ5U2VsZWN0b3JBbGwoYykpLG59Y2F0Y2goZSl7QSh0LCEwKX1maW5hbGx5e3M9PT1rJiZlLnJlbW92ZUF0dHJpYnV0ZSgiaWQiKX19fXJldHVybiBnKHQucmVwbGFjZShCLCIkMSIpLGUsbixyKX1mdW5jdGlvbiB1ZSgpe3ZhciByPVtdO3JldHVybiBmdW5jdGlvbiBlKHQsbil7cmV0dXJuIHIucHVzaCh0KyIgIik+Yi5jYWNoZUxlbmd0aCYmZGVsZXRlIGVbci5zaGlmdCgpXSxlW3QrIiAiXT1ufX1mdW5jdGlvbiBsZShlKXtyZXR1cm4gZVtrXT0hMCxlfWZ1bmN0aW9uIGNlKGUpe3ZhciB0PUMuY3JlYXRlRWxlbWVudCgiZmllbGRzZXQiKTt0cnl7cmV0dXJuISFlKHQpfWNhdGNoKGUpe3JldHVybiExfWZpbmFsbHl7dC5wYXJlbnROb2RlJiZ0LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodCksdD1udWxsfX1mdW5jdGlvbiBmZShlLHQpe3ZhciBuPWUuc3BsaXQoInwiKSxyPW4ubGVuZ3RoO3doaWxlKHItLSliLmF0dHJIYW5kbGVbbltyXV09dH1mdW5jdGlvbiBwZShlLHQpe3ZhciBuPXQmJmUscj1uJiYxPT09ZS5ub2RlVHlwZSYmMT09PXQubm9kZVR5cGUmJmUuc291cmNlSW5kZXgtdC5zb3VyY2VJbmRleDtpZihyKXJldHVybiByO2lmKG4pd2hpbGUobj1uLm5leHRTaWJsaW5nKWlmKG49PT10KXJldHVybi0xO3JldHVybiBlPzE6LTF9ZnVuY3Rpb24gZGUodCl7cmV0dXJuIGZ1bmN0aW9uKGUpe3JldHVybiJpbnB1dCI9PT1lLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkmJmUudHlwZT09PXR9fWZ1bmN0aW9uIGhlKG4pe3JldHVybiBmdW5jdGlvbihlKXt2YXIgdD1lLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7cmV0dXJuKCJpbnB1dCI9PT10fHwiYnV0dG9uIj09PXQpJiZlLnR5cGU9PT1ufX1mdW5jdGlvbiBnZSh0KXtyZXR1cm4gZnVuY3Rpb24oZSl7cmV0dXJuImZvcm0iaW4gZT9lLnBhcmVudE5vZGUmJiExPT09ZS5kaXNhYmxlZD8ibGFiZWwiaW4gZT8ibGFiZWwiaW4gZS5wYXJlbnROb2RlP2UucGFyZW50Tm9kZS5kaXNhYmxlZD09PXQ6ZS5kaXNhYmxlZD09PXQ6ZS5pc0Rpc2FibGVkPT09dHx8ZS5pc0Rpc2FibGVkIT09IXQmJmFlKGUpPT09dDplLmRpc2FibGVkPT09dDoibGFiZWwiaW4gZSYmZS5kaXNhYmxlZD09PXR9fWZ1bmN0aW9uIHZlKGEpe3JldHVybiBsZShmdW5jdGlvbihvKXtyZXR1cm4gbz0rbyxsZShmdW5jdGlvbihlLHQpe3ZhciBuLHI9YShbXSxlLmxlbmd0aCxvKSxpPXIubGVuZ3RoO3doaWxlKGktLSllW249cltpXV0mJihlW25dPSEodFtuXT1lW25dKSl9KX0pfWZ1bmN0aW9uIHllKGUpe3JldHVybiBlJiYidW5kZWZpbmVkIiE9dHlwZW9mIGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUmJmV9Zm9yKGUgaW4gZD1zZS5zdXBwb3J0PXt9LGk9c2UuaXNYTUw9ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5uYW1lc3BhY2VVUkksbj0oZS5vd25lckRvY3VtZW50fHxlKS5kb2N1bWVudEVsZW1lbnQ7cmV0dXJuIVkudGVzdCh0fHxuJiZuLm5vZGVOYW1lfHwiSFRNTCIpfSxUPXNlLnNldERvY3VtZW50PWZ1bmN0aW9uKGUpe3ZhciB0LG4scj1lP2Uub3duZXJEb2N1bWVudHx8ZTptO3JldHVybiByIT09QyYmOT09PXIubm9kZVR5cGUmJnIuZG9jdW1lbnRFbGVtZW50JiYoYT0oQz1yKS5kb2N1bWVudEVsZW1lbnQsRT0haShDKSxtIT09QyYmKG49Qy5kZWZhdWx0VmlldykmJm4udG9wIT09biYmKG4uYWRkRXZlbnRMaXN0ZW5lcj9uLmFkZEV2ZW50TGlzdGVuZXIoInVubG9hZCIsb2UsITEpOm4uYXR0YWNoRXZlbnQmJm4uYXR0YWNoRXZlbnQoIm9udW5sb2FkIixvZSkpLGQuYXR0cmlidXRlcz1jZShmdW5jdGlvbihlKXtyZXR1cm4gZS5jbGFzc05hbWU9ImkiLCFlLmdldEF0dHJpYnV0ZSgiY2xhc3NOYW1lIil9KSxkLmdldEVsZW1lbnRzQnlUYWdOYW1lPWNlKGZ1bmN0aW9uKGUpe3JldHVybiBlLmFwcGVuZENoaWxkKEMuY3JlYXRlQ29tbWVudCgiIikpLCFlLmdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIikubGVuZ3RofSksZC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lPUsudGVzdChDLmdldEVsZW1lbnRzQnlDbGFzc05hbWUpLGQuZ2V0QnlJZD1jZShmdW5jdGlvbihlKXtyZXR1cm4gYS5hcHBlbmRDaGlsZChlKS5pZD1rLCFDLmdldEVsZW1lbnRzQnlOYW1lfHwhQy5nZXRFbGVtZW50c0J5TmFtZShrKS5sZW5ndGh9KSxkLmdldEJ5SWQ/KGIuZmlsdGVyLklEPWZ1bmN0aW9uKGUpe3ZhciB0PWUucmVwbGFjZSh0ZSxuZSk7cmV0dXJuIGZ1bmN0aW9uKGUpe3JldHVybiBlLmdldEF0dHJpYnV0ZSgiaWQiKT09PXR9fSxiLmZpbmQuSUQ9ZnVuY3Rpb24oZSx0KXtpZigidW5kZWZpbmVkIiE9dHlwZW9mIHQuZ2V0RWxlbWVudEJ5SWQmJkUpe3ZhciBuPXQuZ2V0RWxlbWVudEJ5SWQoZSk7cmV0dXJuIG4/W25dOltdfX0pOihiLmZpbHRlci5JRD1mdW5jdGlvbihlKXt2YXIgbj1lLnJlcGxhY2UodGUsbmUpO3JldHVybiBmdW5jdGlvbihlKXt2YXIgdD0idW5kZWZpbmVkIiE9dHlwZW9mIGUuZ2V0QXR0cmlidXRlTm9kZSYmZS5nZXRBdHRyaWJ1dGVOb2RlKCJpZCIpO3JldHVybiB0JiZ0LnZhbHVlPT09bn19LGIuZmluZC5JRD1mdW5jdGlvbihlLHQpe2lmKCJ1bmRlZmluZWQiIT10eXBlb2YgdC5nZXRFbGVtZW50QnlJZCYmRSl7dmFyIG4scixpLG89dC5nZXRFbGVtZW50QnlJZChlKTtpZihvKXtpZigobj1vLmdldEF0dHJpYnV0ZU5vZGUoImlkIikpJiZuLnZhbHVlPT09ZSlyZXR1cm5bb107aT10LmdldEVsZW1lbnRzQnlOYW1lKGUpLHI9MDt3aGlsZShvPWlbcisrXSlpZigobj1vLmdldEF0dHJpYnV0ZU5vZGUoImlkIikpJiZuLnZhbHVlPT09ZSlyZXR1cm5bb119cmV0dXJuW119fSksYi5maW5kLlRBRz1kLmdldEVsZW1lbnRzQnlUYWdOYW1lP2Z1bmN0aW9uKGUsdCl7cmV0dXJuInVuZGVmaW5lZCIhPXR5cGVvZiB0LmdldEVsZW1lbnRzQnlUYWdOYW1lP3QuZ2V0RWxlbWVudHNCeVRhZ05hbWUoZSk6ZC5xc2E/dC5xdWVyeVNlbGVjdG9yQWxsKGUpOnZvaWQgMH06ZnVuY3Rpb24oZSx0KXt2YXIgbixyPVtdLGk9MCxvPXQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoZSk7aWYoIioiPT09ZSl7d2hpbGUobj1vW2krK10pMT09PW4ubm9kZVR5cGUmJnIucHVzaChuKTtyZXR1cm4gcn1yZXR1cm4gb30sYi5maW5kLkNMQVNTPWQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSYmZnVuY3Rpb24oZSx0KXtpZigidW5kZWZpbmVkIiE9dHlwZW9mIHQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSYmRSlyZXR1cm4gdC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKGUpfSxzPVtdLHY9W10sKGQucXNhPUsudGVzdChDLnF1ZXJ5U2VsZWN0b3JBbGwpKSYmKGNlKGZ1bmN0aW9uKGUpe2EuYXBwZW5kQ2hpbGQoZSkuaW5uZXJIVE1MPSI8YSBpZD0nIitrKyInPjwvYT48c2VsZWN0IGlkPSciK2srIi1cclxcJyBtc2FsbG93Y2FwdHVyZT0nJz48b3B0aW9uIHNlbGVjdGVkPScnPjwvb3B0aW9uPjwvc2VsZWN0PiIsZS5xdWVyeVNlbGVjdG9yQWxsKCJbbXNhbGxvd2NhcHR1cmVePScnXSIpLmxlbmd0aCYmdi5wdXNoKCJbKl4kXT0iK00rIiooPzonJ3xcIlwiKSIpLGUucXVlcnlTZWxlY3RvckFsbCgiW3NlbGVjdGVkXSIpLmxlbmd0aHx8di5wdXNoKCJcXFsiK00rIiooPzp2YWx1ZXwiK1IrIikiKSxlLnF1ZXJ5U2VsZWN0b3JBbGwoIltpZH49IitrKyItXSIpLmxlbmd0aHx8di5wdXNoKCJ+PSIpLGUucXVlcnlTZWxlY3RvckFsbCgiOmNoZWNrZWQiKS5sZW5ndGh8fHYucHVzaCgiOmNoZWNrZWQiKSxlLnF1ZXJ5U2VsZWN0b3JBbGwoImEjIitrKyIrKiIpLmxlbmd0aHx8di5wdXNoKCIuIy4rWyt+XSIpfSksY2UoZnVuY3Rpb24oZSl7ZS5pbm5lckhUTUw9IjxhIGhyZWY9JycgZGlzYWJsZWQ9J2Rpc2FibGVkJz48L2E+PHNlbGVjdCBkaXNhYmxlZD0nZGlzYWJsZWQnPjxvcHRpb24vPjwvc2VsZWN0PiI7dmFyIHQ9Qy5jcmVhdGVFbGVtZW50KCJpbnB1dCIpO3Quc2V0QXR0cmlidXRlKCJ0eXBlIiwiaGlkZGVuIiksZS5hcHBlbmRDaGlsZCh0KS5zZXRBdHRyaWJ1dGUoIm5hbWUiLCJEIiksZS5xdWVyeVNlbGVjdG9yQWxsKCJbbmFtZT1kXSIpLmxlbmd0aCYmdi5wdXNoKCJuYW1lIitNKyIqWypeJHwhfl0/PSIpLDIhPT1lLnF1ZXJ5U2VsZWN0b3JBbGwoIjplbmFibGVkIikubGVuZ3RoJiZ2LnB1c2goIjplbmFibGVkIiwiOmRpc2FibGVkIiksYS5hcHBlbmRDaGlsZChlKS5kaXNhYmxlZD0hMCwyIT09ZS5xdWVyeVNlbGVjdG9yQWxsKCI6ZGlzYWJsZWQiKS5sZW5ndGgmJnYucHVzaCgiOmVuYWJsZWQiLCI6ZGlzYWJsZWQiKSxlLnF1ZXJ5U2VsZWN0b3JBbGwoIiosOngiKSx2LnB1c2goIiwuKjoiKX0pKSwoZC5tYXRjaGVzU2VsZWN0b3I9Sy50ZXN0KGM9YS5tYXRjaGVzfHxhLndlYmtpdE1hdGNoZXNTZWxlY3Rvcnx8YS5tb3pNYXRjaGVzU2VsZWN0b3J8fGEub01hdGNoZXNTZWxlY3Rvcnx8YS5tc01hdGNoZXNTZWxlY3RvcikpJiZjZShmdW5jdGlvbihlKXtkLmRpc2Nvbm5lY3RlZE1hdGNoPWMuY2FsbChlLCIqIiksYy5jYWxsKGUsIltzIT0nJ106eCIpLHMucHVzaCgiIT0iLCQpfSksdj12Lmxlbmd0aCYmbmV3IFJlZ0V4cCh2LmpvaW4oInwiKSkscz1zLmxlbmd0aCYmbmV3IFJlZ0V4cChzLmpvaW4oInwiKSksdD1LLnRlc3QoYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbikseT10fHxLLnRlc3QoYS5jb250YWlucyk/ZnVuY3Rpb24oZSx0KXt2YXIgbj05PT09ZS5ub2RlVHlwZT9lLmRvY3VtZW50RWxlbWVudDplLHI9dCYmdC5wYXJlbnROb2RlO3JldHVybiBlPT09cnx8ISghcnx8MSE9PXIubm9kZVR5cGV8fCEobi5jb250YWlucz9uLmNvbnRhaW5zKHIpOmUuY29tcGFyZURvY3VtZW50UG9zaXRpb24mJjE2JmUuY29tcGFyZURvY3VtZW50UG9zaXRpb24ocikpKX06ZnVuY3Rpb24oZSx0KXtpZih0KXdoaWxlKHQ9dC5wYXJlbnROb2RlKWlmKHQ9PT1lKXJldHVybiEwO3JldHVybiExfSxEPXQ/ZnVuY3Rpb24oZSx0KXtpZihlPT09dClyZXR1cm4gbD0hMCwwO3ZhciBuPSFlLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uLSF0LmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uO3JldHVybiBufHwoMSYobj0oZS5vd25lckRvY3VtZW50fHxlKT09PSh0Lm93bmVyRG9jdW1lbnR8fHQpP2UuY29tcGFyZURvY3VtZW50UG9zaXRpb24odCk6MSl8fCFkLnNvcnREZXRhY2hlZCYmdC5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihlKT09PW4/ZT09PUN8fGUub3duZXJEb2N1bWVudD09PW0mJnkobSxlKT8tMTp0PT09Q3x8dC5vd25lckRvY3VtZW50PT09bSYmeShtLHQpPzE6dT9QKHUsZSktUCh1LHQpOjA6NCZuPy0xOjEpfTpmdW5jdGlvbihlLHQpe2lmKGU9PT10KXJldHVybiBsPSEwLDA7dmFyIG4scj0wLGk9ZS5wYXJlbnROb2RlLG89dC5wYXJlbnROb2RlLGE9W2VdLHM9W3RdO2lmKCFpfHwhbylyZXR1cm4gZT09PUM/LTE6dD09PUM/MTppPy0xOm8/MTp1P1AodSxlKS1QKHUsdCk6MDtpZihpPT09bylyZXR1cm4gcGUoZSx0KTtuPWU7d2hpbGUobj1uLnBhcmVudE5vZGUpYS51bnNoaWZ0KG4pO249dDt3aGlsZShuPW4ucGFyZW50Tm9kZSlzLnVuc2hpZnQobik7d2hpbGUoYVtyXT09PXNbcl0pcisrO3JldHVybiByP3BlKGFbcl0sc1tyXSk6YVtyXT09PW0/LTE6c1tyXT09PW0/MTowfSksQ30sc2UubWF0Y2hlcz1mdW5jdGlvbihlLHQpe3JldHVybiBzZShlLG51bGwsbnVsbCx0KX0sc2UubWF0Y2hlc1NlbGVjdG9yPWZ1bmN0aW9uKGUsdCl7aWYoKGUub3duZXJEb2N1bWVudHx8ZSkhPT1DJiZUKGUpLGQubWF0Y2hlc1NlbGVjdG9yJiZFJiYhQVt0KyIgIl0mJighc3x8IXMudGVzdCh0KSkmJighdnx8IXYudGVzdCh0KSkpdHJ5e3ZhciBuPWMuY2FsbChlLHQpO2lmKG58fGQuZGlzY29ubmVjdGVkTWF0Y2h8fGUuZG9jdW1lbnQmJjExIT09ZS5kb2N1bWVudC5ub2RlVHlwZSlyZXR1cm4gbn1jYXRjaChlKXtBKHQsITApfXJldHVybiAwPHNlKHQsQyxudWxsLFtlXSkubGVuZ3RofSxzZS5jb250YWlucz1mdW5jdGlvbihlLHQpe3JldHVybihlLm93bmVyRG9jdW1lbnR8fGUpIT09QyYmVChlKSx5KGUsdCl9LHNlLmF0dHI9ZnVuY3Rpb24oZSx0KXsoZS5vd25lckRvY3VtZW50fHxlKSE9PUMmJlQoZSk7dmFyIG49Yi5hdHRySGFuZGxlW3QudG9Mb3dlckNhc2UoKV0scj1uJiZqLmNhbGwoYi5hdHRySGFuZGxlLHQudG9Mb3dlckNhc2UoKSk/bihlLHQsIUUpOnZvaWQgMDtyZXR1cm4gdm9pZCAwIT09cj9yOmQuYXR0cmlidXRlc3x8IUU/ZS5nZXRBdHRyaWJ1dGUodCk6KHI9ZS5nZXRBdHRyaWJ1dGVOb2RlKHQpKSYmci5zcGVjaWZpZWQ/ci52YWx1ZTpudWxsfSxzZS5lc2NhcGU9ZnVuY3Rpb24oZSl7cmV0dXJuKGUrIiIpLnJlcGxhY2UocmUsaWUpfSxzZS5lcnJvcj1mdW5jdGlvbihlKXt0aHJvdyBuZXcgRXJyb3IoIlN5bnRheCBlcnJvciwgdW5yZWNvZ25pemVkIGV4cHJlc3Npb246ICIrZSl9LHNlLnVuaXF1ZVNvcnQ9ZnVuY3Rpb24oZSl7dmFyIHQsbj1bXSxyPTAsaT0wO2lmKGw9IWQuZGV0ZWN0RHVwbGljYXRlcyx1PSFkLnNvcnRTdGFibGUmJmUuc2xpY2UoMCksZS5zb3J0KEQpLGwpe3doaWxlKHQ9ZVtpKytdKXQ9PT1lW2ldJiYocj1uLnB1c2goaSkpO3doaWxlKHItLSllLnNwbGljZShuW3JdLDEpfXJldHVybiB1PW51bGwsZX0sbz1zZS5nZXRUZXh0PWZ1bmN0aW9uKGUpe3ZhciB0LG49IiIscj0wLGk9ZS5ub2RlVHlwZTtpZihpKXtpZigxPT09aXx8OT09PWl8fDExPT09aSl7aWYoInN0cmluZyI9PXR5cGVvZiBlLnRleHRDb250ZW50KXJldHVybiBlLnRleHRDb250ZW50O2ZvcihlPWUuZmlyc3RDaGlsZDtlO2U9ZS5uZXh0U2libGluZyluKz1vKGUpfWVsc2UgaWYoMz09PWl8fDQ9PT1pKXJldHVybiBlLm5vZGVWYWx1ZX1lbHNlIHdoaWxlKHQ9ZVtyKytdKW4rPW8odCk7cmV0dXJuIG59LChiPXNlLnNlbGVjdG9ycz17Y2FjaGVMZW5ndGg6NTAsY3JlYXRlUHNldWRvOmxlLG1hdGNoOkcsYXR0ckhhbmRsZTp7fSxmaW5kOnt9LHJlbGF0aXZlOnsiPiI6e2RpcjoicGFyZW50Tm9kZSIsZmlyc3Q6ITB9LCIgIjp7ZGlyOiJwYXJlbnROb2RlIn0sIisiOntkaXI6InByZXZpb3VzU2libGluZyIsZmlyc3Q6ITB9LCJ+Ijp7ZGlyOiJwcmV2aW91c1NpYmxpbmcifX0scHJlRmlsdGVyOntBVFRSOmZ1bmN0aW9uKGUpe3JldHVybiBlWzFdPWVbMV0ucmVwbGFjZSh0ZSxuZSksZVszXT0oZVszXXx8ZVs0XXx8ZVs1XXx8IiIpLnJlcGxhY2UodGUsbmUpLCJ+PSI9PT1lWzJdJiYoZVszXT0iICIrZVszXSsiICIpLGUuc2xpY2UoMCw0KX0sQ0hJTEQ6ZnVuY3Rpb24oZSl7cmV0dXJuIGVbMV09ZVsxXS50b0xvd2VyQ2FzZSgpLCJudGgiPT09ZVsxXS5zbGljZSgwLDMpPyhlWzNdfHxzZS5lcnJvcihlWzBdKSxlWzRdPSsoZVs0XT9lWzVdKyhlWzZdfHwxKToyKigiZXZlbiI9PT1lWzNdfHwib2RkIj09PWVbM10pKSxlWzVdPSsoZVs3XStlWzhdfHwib2RkIj09PWVbM10pKTplWzNdJiZzZS5lcnJvcihlWzBdKSxlfSxQU0VVRE86ZnVuY3Rpb24oZSl7dmFyIHQsbj0hZVs2XSYmZVsyXTtyZXR1cm4gRy5DSElMRC50ZXN0KGVbMF0pP251bGw6KGVbM10/ZVsyXT1lWzRdfHxlWzVdfHwiIjpuJiZYLnRlc3QobikmJih0PWgobiwhMCkpJiYodD1uLmluZGV4T2YoIikiLG4ubGVuZ3RoLXQpLW4ubGVuZ3RoKSYmKGVbMF09ZVswXS5zbGljZSgwLHQpLGVbMl09bi5zbGljZSgwLHQpKSxlLnNsaWNlKDAsMykpfX0sZmlsdGVyOntUQUc6ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5yZXBsYWNlKHRlLG5lKS50b0xvd2VyQ2FzZSgpO3JldHVybiIqIj09PWU/ZnVuY3Rpb24oKXtyZXR1cm4hMH06ZnVuY3Rpb24oZSl7cmV0dXJuIGUubm9kZU5hbWUmJmUubm9kZU5hbWUudG9Mb3dlckNhc2UoKT09PXR9fSxDTEFTUzpmdW5jdGlvbihlKXt2YXIgdD1wW2UrIiAiXTtyZXR1cm4gdHx8KHQ9bmV3IFJlZ0V4cCgiKF58IitNKyIpIitlKyIoIitNKyJ8JCkiKSkmJnAoZSxmdW5jdGlvbihlKXtyZXR1cm4gdC50ZXN0KCJzdHJpbmciPT10eXBlb2YgZS5jbGFzc05hbWUmJmUuY2xhc3NOYW1lfHwidW5kZWZpbmVkIiE9dHlwZW9mIGUuZ2V0QXR0cmlidXRlJiZlLmdldEF0dHJpYnV0ZSgiY2xhc3MiKXx8IiIpfSl9LEFUVFI6ZnVuY3Rpb24obixyLGkpe3JldHVybiBmdW5jdGlvbihlKXt2YXIgdD1zZS5hdHRyKGUsbik7cmV0dXJuIG51bGw9PXQ/IiE9Ij09PXI6IXJ8fCh0Kz0iIiwiPSI9PT1yP3Q9PT1pOiIhPSI9PT1yP3QhPT1pOiJePSI9PT1yP2kmJjA9PT10LmluZGV4T2YoaSk6Iio9Ij09PXI/aSYmLTE8dC5pbmRleE9mKGkpOiIkPSI9PT1yP2kmJnQuc2xpY2UoLWkubGVuZ3RoKT09PWk6In49Ij09PXI/LTE8KCIgIit0LnJlcGxhY2UoRiwiICIpKyIgIikuaW5kZXhPZihpKToifD0iPT09ciYmKHQ9PT1pfHx0LnNsaWNlKDAsaS5sZW5ndGgrMSk9PT1pKyItIikpfX0sQ0hJTEQ6ZnVuY3Rpb24oaCxlLHQsZyx2KXt2YXIgeT0ibnRoIiE9PWguc2xpY2UoMCwzKSxtPSJsYXN0IiE9PWguc2xpY2UoLTQpLHg9Im9mLXR5cGUiPT09ZTtyZXR1cm4gMT09PWcmJjA9PT12P2Z1bmN0aW9uKGUpe3JldHVybiEhZS5wYXJlbnROb2RlfTpmdW5jdGlvbihlLHQsbil7dmFyIHIsaSxvLGEscyx1LGw9eSE9PW0/Im5leHRTaWJsaW5nIjoicHJldmlvdXNTaWJsaW5nIixjPWUucGFyZW50Tm9kZSxmPXgmJmUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSxwPSFuJiYheCxkPSExO2lmKGMpe2lmKHkpe3doaWxlKGwpe2E9ZTt3aGlsZShhPWFbbF0paWYoeD9hLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk9PT1mOjE9PT1hLm5vZGVUeXBlKXJldHVybiExO3U9bD0ib25seSI9PT1oJiYhdSYmIm5leHRTaWJsaW5nIn1yZXR1cm4hMH1pZih1PVttP2MuZmlyc3RDaGlsZDpjLmxhc3RDaGlsZF0sbSYmcCl7ZD0ocz0ocj0oaT0obz0oYT1jKVtrXXx8KGFba109e30pKVthLnVuaXF1ZUlEXXx8KG9bYS51bmlxdWVJRF09e30pKVtoXXx8W10pWzBdPT09UyYmclsxXSkmJnJbMl0sYT1zJiZjLmNoaWxkTm9kZXNbc107d2hpbGUoYT0rK3MmJmEmJmFbbF18fChkPXM9MCl8fHUucG9wKCkpaWYoMT09PWEubm9kZVR5cGUmJisrZCYmYT09PWUpe2lbaF09W1MscyxkXTticmVha319ZWxzZSBpZihwJiYoZD1zPShyPShpPShvPShhPWUpW2tdfHwoYVtrXT17fSkpW2EudW5pcXVlSURdfHwob1thLnVuaXF1ZUlEXT17fSkpW2hdfHxbXSlbMF09PT1TJiZyWzFdKSwhMT09PWQpd2hpbGUoYT0rK3MmJmEmJmFbbF18fChkPXM9MCl8fHUucG9wKCkpaWYoKHg/YS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpPT09ZjoxPT09YS5ub2RlVHlwZSkmJisrZCYmKHAmJigoaT0obz1hW2tdfHwoYVtrXT17fSkpW2EudW5pcXVlSURdfHwob1thLnVuaXF1ZUlEXT17fSkpW2hdPVtTLGRdKSxhPT09ZSkpYnJlYWs7cmV0dXJuKGQtPXYpPT09Z3x8ZCVnPT0wJiYwPD1kL2d9fX0sUFNFVURPOmZ1bmN0aW9uKGUsbyl7dmFyIHQsYT1iLnBzZXVkb3NbZV18fGIuc2V0RmlsdGVyc1tlLnRvTG93ZXJDYXNlKCldfHxzZS5lcnJvcigidW5zdXBwb3J0ZWQgcHNldWRvOiAiK2UpO3JldHVybiBhW2tdP2Eobyk6MTxhLmxlbmd0aD8odD1bZSxlLCIiLG9dLGIuc2V0RmlsdGVycy5oYXNPd25Qcm9wZXJ0eShlLnRvTG93ZXJDYXNlKCkpP2xlKGZ1bmN0aW9uKGUsdCl7dmFyIG4scj1hKGUsbyksaT1yLmxlbmd0aDt3aGlsZShpLS0pZVtuPVAoZSxyW2ldKV09ISh0W25dPXJbaV0pfSk6ZnVuY3Rpb24oZSl7cmV0dXJuIGEoZSwwLHQpfSk6YX19LHBzZXVkb3M6e25vdDpsZShmdW5jdGlvbihlKXt2YXIgcj1bXSxpPVtdLHM9ZihlLnJlcGxhY2UoQiwiJDEiKSk7cmV0dXJuIHNba10/bGUoZnVuY3Rpb24oZSx0LG4scil7dmFyIGksbz1zKGUsbnVsbCxyLFtdKSxhPWUubGVuZ3RoO3doaWxlKGEtLSkoaT1vW2FdKSYmKGVbYV09ISh0W2FdPWkpKX0pOmZ1bmN0aW9uKGUsdCxuKXtyZXR1cm4gclswXT1lLHMocixudWxsLG4saSksclswXT1udWxsLCFpLnBvcCgpfX0pLGhhczpsZShmdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oZSl7cmV0dXJuIDA8c2UodCxlKS5sZW5ndGh9fSksY29udGFpbnM6bGUoZnVuY3Rpb24odCl7cmV0dXJuIHQ9dC5yZXBsYWNlKHRlLG5lKSxmdW5jdGlvbihlKXtyZXR1cm4tMTwoZS50ZXh0Q29udGVudHx8byhlKSkuaW5kZXhPZih0KX19KSxsYW5nOmxlKGZ1bmN0aW9uKG4pe3JldHVybiBWLnRlc3Qobnx8IiIpfHxzZS5lcnJvcigidW5zdXBwb3J0ZWQgbGFuZzogIituKSxuPW4ucmVwbGFjZSh0ZSxuZSkudG9Mb3dlckNhc2UoKSxmdW5jdGlvbihlKXt2YXIgdDtkb3tpZih0PUU/ZS5sYW5nOmUuZ2V0QXR0cmlidXRlKCJ4bWw6bGFuZyIpfHxlLmdldEF0dHJpYnV0ZSgibGFuZyIpKXJldHVybih0PXQudG9Mb3dlckNhc2UoKSk9PT1ufHwwPT09dC5pbmRleE9mKG4rIi0iKX13aGlsZSgoZT1lLnBhcmVudE5vZGUpJiYxPT09ZS5ub2RlVHlwZSk7cmV0dXJuITF9fSksdGFyZ2V0OmZ1bmN0aW9uKGUpe3ZhciB0PW4ubG9jYXRpb24mJm4ubG9jYXRpb24uaGFzaDtyZXR1cm4gdCYmdC5zbGljZSgxKT09PWUuaWR9LHJvb3Q6ZnVuY3Rpb24oZSl7cmV0dXJuIGU9PT1hfSxmb2N1czpmdW5jdGlvbihlKXtyZXR1cm4gZT09PUMuYWN0aXZlRWxlbWVudCYmKCFDLmhhc0ZvY3VzfHxDLmhhc0ZvY3VzKCkpJiYhIShlLnR5cGV8fGUuaHJlZnx8fmUudGFiSW5kZXgpfSxlbmFibGVkOmdlKCExKSxkaXNhYmxlZDpnZSghMCksY2hlY2tlZDpmdW5jdGlvbihlKXt2YXIgdD1lLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7cmV0dXJuImlucHV0Ij09PXQmJiEhZS5jaGVja2VkfHwib3B0aW9uIj09PXQmJiEhZS5zZWxlY3RlZH0sc2VsZWN0ZWQ6ZnVuY3Rpb24oZSl7cmV0dXJuIGUucGFyZW50Tm9kZSYmZS5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXgsITA9PT1lLnNlbGVjdGVkfSxlbXB0eTpmdW5jdGlvbihlKXtmb3IoZT1lLmZpcnN0Q2hpbGQ7ZTtlPWUubmV4dFNpYmxpbmcpaWYoZS5ub2RlVHlwZTw2KXJldHVybiExO3JldHVybiEwfSxwYXJlbnQ6ZnVuY3Rpb24oZSl7cmV0dXJuIWIucHNldWRvcy5lbXB0eShlKX0saGVhZGVyOmZ1bmN0aW9uKGUpe3JldHVybiBKLnRlc3QoZS5ub2RlTmFtZSl9LGlucHV0OmZ1bmN0aW9uKGUpe3JldHVybiBRLnRlc3QoZS5ub2RlTmFtZSl9LGJ1dHRvbjpmdW5jdGlvbihlKXt2YXIgdD1lLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7cmV0dXJuImlucHV0Ij09PXQmJiJidXR0b24iPT09ZS50eXBlfHwiYnV0dG9uIj09PXR9LHRleHQ6ZnVuY3Rpb24oZSl7dmFyIHQ7cmV0dXJuImlucHV0Ij09PWUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSYmInRleHQiPT09ZS50eXBlJiYobnVsbD09KHQ9ZS5nZXRBdHRyaWJ1dGUoInR5cGUiKSl8fCJ0ZXh0Ij09PXQudG9Mb3dlckNhc2UoKSl9LGZpcnN0OnZlKGZ1bmN0aW9uKCl7cmV0dXJuWzBdfSksbGFzdDp2ZShmdW5jdGlvbihlLHQpe3JldHVyblt0LTFdfSksZXE6dmUoZnVuY3Rpb24oZSx0LG4pe3JldHVybltuPDA/bit0Om5dfSksZXZlbjp2ZShmdW5jdGlvbihlLHQpe2Zvcih2YXIgbj0wO248dDtuKz0yKWUucHVzaChuKTtyZXR1cm4gZX0pLG9kZDp2ZShmdW5jdGlvbihlLHQpe2Zvcih2YXIgbj0xO248dDtuKz0yKWUucHVzaChuKTtyZXR1cm4gZX0pLGx0OnZlKGZ1bmN0aW9uKGUsdCxuKXtmb3IodmFyIHI9bjwwP24rdDp0PG4/dDpuOzA8PS0tcjspZS5wdXNoKHIpO3JldHVybiBlfSksZ3Q6dmUoZnVuY3Rpb24oZSx0LG4pe2Zvcih2YXIgcj1uPDA/bit0Om47KytyPHQ7KWUucHVzaChyKTtyZXR1cm4gZX0pfX0pLnBzZXVkb3MubnRoPWIucHNldWRvcy5lcSx7cmFkaW86ITAsY2hlY2tib3g6ITAsZmlsZTohMCxwYXNzd29yZDohMCxpbWFnZTohMH0pYi5wc2V1ZG9zW2VdPWRlKGUpO2ZvcihlIGlue3N1Ym1pdDohMCxyZXNldDohMH0pYi5wc2V1ZG9zW2VdPWhlKGUpO2Z1bmN0aW9uIG1lKCl7fWZ1bmN0aW9uIHhlKGUpe2Zvcih2YXIgdD0wLG49ZS5sZW5ndGgscj0iIjt0PG47dCsrKXIrPWVbdF0udmFsdWU7cmV0dXJuIHJ9ZnVuY3Rpb24gYmUocyxlLHQpe3ZhciB1PWUuZGlyLGw9ZS5uZXh0LGM9bHx8dSxmPXQmJiJwYXJlbnROb2RlIj09PWMscD1yKys7cmV0dXJuIGUuZmlyc3Q/ZnVuY3Rpb24oZSx0LG4pe3doaWxlKGU9ZVt1XSlpZigxPT09ZS5ub2RlVHlwZXx8ZilyZXR1cm4gcyhlLHQsbik7cmV0dXJuITF9OmZ1bmN0aW9uKGUsdCxuKXt2YXIgcixpLG8sYT1bUyxwXTtpZihuKXt3aGlsZShlPWVbdV0paWYoKDE9PT1lLm5vZGVUeXBlfHxmKSYmcyhlLHQsbikpcmV0dXJuITB9ZWxzZSB3aGlsZShlPWVbdV0paWYoMT09PWUubm9kZVR5cGV8fGYpaWYoaT0obz1lW2tdfHwoZVtrXT17fSkpW2UudW5pcXVlSURdfHwob1tlLnVuaXF1ZUlEXT17fSksbCYmbD09PWUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSllPWVbdV18fGU7ZWxzZXtpZigocj1pW2NdKSYmclswXT09PVMmJnJbMV09PT1wKXJldHVybiBhWzJdPXJbMl07aWYoKGlbY109YSlbMl09cyhlLHQsbikpcmV0dXJuITB9cmV0dXJuITF9fWZ1bmN0aW9uIHdlKGkpe3JldHVybiAxPGkubGVuZ3RoP2Z1bmN0aW9uKGUsdCxuKXt2YXIgcj1pLmxlbmd0aDt3aGlsZShyLS0paWYoIWlbcl0oZSx0LG4pKXJldHVybiExO3JldHVybiEwfTppWzBdfWZ1bmN0aW9uIFRlKGUsdCxuLHIsaSl7Zm9yKHZhciBvLGE9W10scz0wLHU9ZS5sZW5ndGgsbD1udWxsIT10O3M8dTtzKyspKG89ZVtzXSkmJihuJiYhbihvLHIsaSl8fChhLnB1c2gobyksbCYmdC5wdXNoKHMpKSk7cmV0dXJuIGF9ZnVuY3Rpb24gQ2UoZCxoLGcsdix5LGUpe3JldHVybiB2JiYhdltrXSYmKHY9Q2UodikpLHkmJiF5W2tdJiYoeT1DZSh5LGUpKSxsZShmdW5jdGlvbihlLHQsbixyKXt2YXIgaSxvLGEscz1bXSx1PVtdLGw9dC5sZW5ndGgsYz1lfHxmdW5jdGlvbihlLHQsbil7Zm9yKHZhciByPTAsaT10Lmxlbmd0aDtyPGk7cisrKXNlKGUsdFtyXSxuKTtyZXR1cm4gbn0oaHx8IioiLG4ubm9kZVR5cGU/W25dOm4sW10pLGY9IWR8fCFlJiZoP2M6VGUoYyxzLGQsbixyKSxwPWc/eXx8KGU/ZDpsfHx2KT9bXTp0OmY7aWYoZyYmZyhmLHAsbixyKSx2KXtpPVRlKHAsdSksdihpLFtdLG4sciksbz1pLmxlbmd0aDt3aGlsZShvLS0pKGE9aVtvXSkmJihwW3Vbb11dPSEoZlt1W29dXT1hKSl9aWYoZSl7aWYoeXx8ZCl7aWYoeSl7aT1bXSxvPXAubGVuZ3RoO3doaWxlKG8tLSkoYT1wW29dKSYmaS5wdXNoKGZbb109YSk7eShudWxsLHA9W10saSxyKX1vPXAubGVuZ3RoO3doaWxlKG8tLSkoYT1wW29dKSYmLTE8KGk9eT9QKGUsYSk6c1tvXSkmJihlW2ldPSEodFtpXT1hKSl9fWVsc2UgcD1UZShwPT09dD9wLnNwbGljZShsLHAubGVuZ3RoKTpwKSx5P3kobnVsbCx0LHAscik6SC5hcHBseSh0LHApfSl9ZnVuY3Rpb24gRWUoZSl7Zm9yKHZhciBpLHQsbixyPWUubGVuZ3RoLG89Yi5yZWxhdGl2ZVtlWzBdLnR5cGVdLGE9b3x8Yi5yZWxhdGl2ZVsiICJdLHM9bz8xOjAsdT1iZShmdW5jdGlvbihlKXtyZXR1cm4gZT09PWl9LGEsITApLGw9YmUoZnVuY3Rpb24oZSl7cmV0dXJuLTE8UChpLGUpfSxhLCEwKSxjPVtmdW5jdGlvbihlLHQsbil7dmFyIHI9IW8mJihufHx0IT09dyl8fCgoaT10KS5ub2RlVHlwZT91KGUsdCxuKTpsKGUsdCxuKSk7cmV0dXJuIGk9bnVsbCxyfV07czxyO3MrKylpZih0PWIucmVsYXRpdmVbZVtzXS50eXBlXSljPVtiZSh3ZShjKSx0KV07ZWxzZXtpZigodD1iLmZpbHRlcltlW3NdLnR5cGVdLmFwcGx5KG51bGwsZVtzXS5tYXRjaGVzKSlba10pe2ZvcihuPSsrcztuPHI7bisrKWlmKGIucmVsYXRpdmVbZVtuXS50eXBlXSlicmVhaztyZXR1cm4gQ2UoMTxzJiZ3ZShjKSwxPHMmJnhlKGUuc2xpY2UoMCxzLTEpLmNvbmNhdCh7dmFsdWU6IiAiPT09ZVtzLTJdLnR5cGU/IioiOiIifSkpLnJlcGxhY2UoQiwiJDEiKSx0LHM8biYmRWUoZS5zbGljZShzLG4pKSxuPHImJkVlKGU9ZS5zbGljZShuKSksbjxyJiZ4ZShlKSl9Yy5wdXNoKHQpfXJldHVybiB3ZShjKX1yZXR1cm4gbWUucHJvdG90eXBlPWIuZmlsdGVycz1iLnBzZXVkb3MsYi5zZXRGaWx0ZXJzPW5ldyBtZSxoPXNlLnRva2VuaXplPWZ1bmN0aW9uKGUsdCl7dmFyIG4scixpLG8sYSxzLHUsbD14W2UrIiAiXTtpZihsKXJldHVybiB0PzA6bC5zbGljZSgwKTthPWUscz1bXSx1PWIucHJlRmlsdGVyO3doaWxlKGEpe2ZvcihvIGluIG4mJiEocj1fLmV4ZWMoYSkpfHwociYmKGE9YS5zbGljZShyWzBdLmxlbmd0aCl8fGEpLHMucHVzaChpPVtdKSksbj0hMSwocj16LmV4ZWMoYSkpJiYobj1yLnNoaWZ0KCksaS5wdXNoKHt2YWx1ZTpuLHR5cGU6clswXS5yZXBsYWNlKEIsIiAiKX0pLGE9YS5zbGljZShuLmxlbmd0aCkpLGIuZmlsdGVyKSEocj1HW29dLmV4ZWMoYSkpfHx1W29dJiYhKHI9dVtvXShyKSl8fChuPXIuc2hpZnQoKSxpLnB1c2goe3ZhbHVlOm4sdHlwZTpvLG1hdGNoZXM6cn0pLGE9YS5zbGljZShuLmxlbmd0aCkpO2lmKCFuKWJyZWFrfXJldHVybiB0P2EubGVuZ3RoOmE/c2UuZXJyb3IoZSk6eChlLHMpLnNsaWNlKDApfSxmPXNlLmNvbXBpbGU9ZnVuY3Rpb24oZSx0KXt2YXIgbix2LHksbSx4LHIsaT1bXSxvPVtdLGE9TltlKyIgIl07aWYoIWEpe3R8fCh0PWgoZSkpLG49dC5sZW5ndGg7d2hpbGUobi0tKShhPUVlKHRbbl0pKVtrXT9pLnB1c2goYSk6by5wdXNoKGEpOyhhPU4oZSwodj1vLG09MDwoeT1pKS5sZW5ndGgseD0wPHYubGVuZ3RoLHI9ZnVuY3Rpb24oZSx0LG4scixpKXt2YXIgbyxhLHMsdT0wLGw9IjAiLGM9ZSYmW10sZj1bXSxwPXcsZD1lfHx4JiZiLmZpbmQuVEFHKCIqIixpKSxoPVMrPW51bGw9PXA/MTpNYXRoLnJhbmRvbSgpfHwuMSxnPWQubGVuZ3RoO2ZvcihpJiYodz10PT09Q3x8dHx8aSk7bCE9PWcmJm51bGwhPShvPWRbbF0pO2wrKyl7aWYoeCYmbyl7YT0wLHR8fG8ub3duZXJEb2N1bWVudD09PUN8fChUKG8pLG49IUUpO3doaWxlKHM9dlthKytdKWlmKHMobyx0fHxDLG4pKXtyLnB1c2gobyk7YnJlYWt9aSYmKFM9aCl9bSYmKChvPSFzJiZvKSYmdS0tLGUmJmMucHVzaChvKSl9aWYodSs9bCxtJiZsIT09dSl7YT0wO3doaWxlKHM9eVthKytdKXMoYyxmLHQsbik7aWYoZSl7aWYoMDx1KXdoaWxlKGwtLSljW2xdfHxmW2xdfHwoZltsXT1xLmNhbGwocikpO2Y9VGUoZil9SC5hcHBseShyLGYpLGkmJiFlJiYwPGYubGVuZ3RoJiYxPHUreS5sZW5ndGgmJnNlLnVuaXF1ZVNvcnQocil9cmV0dXJuIGkmJihTPWgsdz1wKSxjfSxtP2xlKHIpOnIpKSkuc2VsZWN0b3I9ZX1yZXR1cm4gYX0sZz1zZS5zZWxlY3Q9ZnVuY3Rpb24oZSx0LG4scil7dmFyIGksbyxhLHMsdSxsPSJmdW5jdGlvbiI9PXR5cGVvZiBlJiZlLGM9IXImJmgoZT1sLnNlbGVjdG9yfHxlKTtpZihuPW58fFtdLDE9PT1jLmxlbmd0aCl7aWYoMjwobz1jWzBdPWNbMF0uc2xpY2UoMCkpLmxlbmd0aCYmIklEIj09PShhPW9bMF0pLnR5cGUmJjk9PT10Lm5vZGVUeXBlJiZFJiZiLnJlbGF0aXZlW29bMV0udHlwZV0pe2lmKCEodD0oYi5maW5kLklEKGEubWF0Y2hlc1swXS5yZXBsYWNlKHRlLG5lKSx0KXx8W10pWzBdKSlyZXR1cm4gbjtsJiYodD10LnBhcmVudE5vZGUpLGU9ZS5zbGljZShvLnNoaWZ0KCkudmFsdWUubGVuZ3RoKX1pPUcubmVlZHNDb250ZXh0LnRlc3QoZSk/MDpvLmxlbmd0aDt3aGlsZShpLS0pe2lmKGE9b1tpXSxiLnJlbGF0aXZlW3M9YS50eXBlXSlicmVhaztpZigodT1iLmZpbmRbc10pJiYocj11KGEubWF0Y2hlc1swXS5yZXBsYWNlKHRlLG5lKSxlZS50ZXN0KG9bMF0udHlwZSkmJnllKHQucGFyZW50Tm9kZSl8fHQpKSl7aWYoby5zcGxpY2UoaSwxKSwhKGU9ci5sZW5ndGgmJnhlKG8pKSlyZXR1cm4gSC5hcHBseShuLHIpLG47YnJlYWt9fX1yZXR1cm4obHx8ZihlLGMpKShyLHQsIUUsbiwhdHx8ZWUudGVzdChlKSYmeWUodC5wYXJlbnROb2RlKXx8dCksbn0sZC5zb3J0U3RhYmxlPWsuc3BsaXQoIiIpLnNvcnQoRCkuam9pbigiIik9PT1rLGQuZGV0ZWN0RHVwbGljYXRlcz0hIWwsVCgpLGQuc29ydERldGFjaGVkPWNlKGZ1bmN0aW9uKGUpe3JldHVybiAxJmUuY29tcGFyZURvY3VtZW50UG9zaXRpb24oQy5jcmVhdGVFbGVtZW50KCJmaWVsZHNldCIpKX0pLGNlKGZ1bmN0aW9uKGUpe3JldHVybiBlLmlubmVySFRNTD0iPGEgaHJlZj0nIyc+PC9hPiIsIiMiPT09ZS5maXJzdENoaWxkLmdldEF0dHJpYnV0ZSgiaHJlZiIpfSl8fGZlKCJ0eXBlfGhyZWZ8aGVpZ2h0fHdpZHRoIixmdW5jdGlvbihlLHQsbil7aWYoIW4pcmV0dXJuIGUuZ2V0QXR0cmlidXRlKHQsInR5cGUiPT09dC50b0xvd2VyQ2FzZSgpPzE6Mil9KSxkLmF0dHJpYnV0ZXMmJmNlKGZ1bmN0aW9uKGUpe3JldHVybiBlLmlubmVySFRNTD0iPGlucHV0Lz4iLGUuZmlyc3RDaGlsZC5zZXRBdHRyaWJ1dGUoInZhbHVlIiwiIiksIiI9PT1lLmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlKCJ2YWx1ZSIpfSl8fGZlKCJ2YWx1ZSIsZnVuY3Rpb24oZSx0LG4pe2lmKCFuJiYiaW5wdXQiPT09ZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpKXJldHVybiBlLmRlZmF1bHRWYWx1ZX0pLGNlKGZ1bmN0aW9uKGUpe3JldHVybiBudWxsPT1lLmdldEF0dHJpYnV0ZSgiZGlzYWJsZWQiKX0pfHxmZShSLGZ1bmN0aW9uKGUsdCxuKXt2YXIgcjtpZighbilyZXR1cm4hMD09PWVbdF0/dC50b0xvd2VyQ2FzZSgpOihyPWUuZ2V0QXR0cmlidXRlTm9kZSh0KSkmJnIuc3BlY2lmaWVkP3IudmFsdWU6bnVsbH0pLHNlfShDKTtrLmZpbmQ9aCxrLmV4cHI9aC5zZWxlY3RvcnMsay5leHByWyI6Il09ay5leHByLnBzZXVkb3Msay51bmlxdWVTb3J0PWsudW5pcXVlPWgudW5pcXVlU29ydCxrLnRleHQ9aC5nZXRUZXh0LGsuaXNYTUxEb2M9aC5pc1hNTCxrLmNvbnRhaW5zPWguY29udGFpbnMsay5lc2NhcGVTZWxlY3Rvcj1oLmVzY2FwZTt2YXIgVD1mdW5jdGlvbihlLHQsbil7dmFyIHI9W10saT12b2lkIDAhPT1uO3doaWxlKChlPWVbdF0pJiY5IT09ZS5ub2RlVHlwZSlpZigxPT09ZS5ub2RlVHlwZSl7aWYoaSYmayhlKS5pcyhuKSlicmVhaztyLnB1c2goZSl9cmV0dXJuIHJ9LFM9ZnVuY3Rpb24oZSx0KXtmb3IodmFyIG49W107ZTtlPWUubmV4dFNpYmxpbmcpMT09PWUubm9kZVR5cGUmJmUhPT10JiZuLnB1c2goZSk7cmV0dXJuIG59LE49ay5leHByLm1hdGNoLm5lZWRzQ29udGV4dDtmdW5jdGlvbiBBKGUsdCl7cmV0dXJuIGUubm9kZU5hbWUmJmUubm9kZU5hbWUudG9Mb3dlckNhc2UoKT09PXQudG9Mb3dlckNhc2UoKX12YXIgRD0vXjwoW2Etel1bXlwvXDA+Olx4MjBcdFxyXG5cZl0qKVtceDIwXHRcclxuXGZdKlwvPz4oPzo8XC9cMT58KSQvaTtmdW5jdGlvbiBqKGUsbixyKXtyZXR1cm4gbShuKT9rLmdyZXAoZSxmdW5jdGlvbihlLHQpe3JldHVybiEhbi5jYWxsKGUsdCxlKSE9PXJ9KTpuLm5vZGVUeXBlP2suZ3JlcChlLGZ1bmN0aW9uKGUpe3JldHVybiBlPT09biE9PXJ9KToic3RyaW5nIiE9dHlwZW9mIG4/ay5ncmVwKGUsZnVuY3Rpb24oZSl7cmV0dXJuLTE8aS5jYWxsKG4sZSkhPT1yfSk6ay5maWx0ZXIobixlLHIpfWsuZmlsdGVyPWZ1bmN0aW9uKGUsdCxuKXt2YXIgcj10WzBdO3JldHVybiBuJiYoZT0iOm5vdCgiK2UrIikiKSwxPT09dC5sZW5ndGgmJjE9PT1yLm5vZGVUeXBlP2suZmluZC5tYXRjaGVzU2VsZWN0b3IocixlKT9bcl06W106ay5maW5kLm1hdGNoZXMoZSxrLmdyZXAodCxmdW5jdGlvbihlKXtyZXR1cm4gMT09PWUubm9kZVR5cGV9KSl9LGsuZm4uZXh0ZW5kKHtmaW5kOmZ1bmN0aW9uKGUpe3ZhciB0LG4scj10aGlzLmxlbmd0aCxpPXRoaXM7aWYoInN0cmluZyIhPXR5cGVvZiBlKXJldHVybiB0aGlzLnB1c2hTdGFjayhrKGUpLmZpbHRlcihmdW5jdGlvbigpe2Zvcih0PTA7dDxyO3QrKylpZihrLmNvbnRhaW5zKGlbdF0sdGhpcykpcmV0dXJuITB9KSk7Zm9yKG49dGhpcy5wdXNoU3RhY2soW10pLHQ9MDt0PHI7dCsrKWsuZmluZChlLGlbdF0sbik7cmV0dXJuIDE8cj9rLnVuaXF1ZVNvcnQobik6bn0sZmlsdGVyOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnB1c2hTdGFjayhqKHRoaXMsZXx8W10sITEpKX0sbm90OmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnB1c2hTdGFjayhqKHRoaXMsZXx8W10sITApKX0saXM6ZnVuY3Rpb24oZSl7cmV0dXJuISFqKHRoaXMsInN0cmluZyI9PXR5cGVvZiBlJiZOLnRlc3QoZSk/ayhlKTplfHxbXSwhMSkubGVuZ3RofX0pO3ZhciBxLEw9L14oPzpccyooPFtcd1xXXSs+KVtePl0qfCMoW1x3LV0rKSkkLzsoay5mbi5pbml0PWZ1bmN0aW9uKGUsdCxuKXt2YXIgcixpO2lmKCFlKXJldHVybiB0aGlzO2lmKG49bnx8cSwic3RyaW5nIj09dHlwZW9mIGUpe2lmKCEocj0iPCI9PT1lWzBdJiYiPiI9PT1lW2UubGVuZ3RoLTFdJiYzPD1lLmxlbmd0aD9bbnVsbCxlLG51bGxdOkwuZXhlYyhlKSl8fCFyWzFdJiZ0KXJldHVybiF0fHx0LmpxdWVyeT8odHx8bikuZmluZChlKTp0aGlzLmNvbnN0cnVjdG9yKHQpLmZpbmQoZSk7aWYoclsxXSl7aWYodD10IGluc3RhbmNlb2Ygaz90WzBdOnQsay5tZXJnZSh0aGlzLGsucGFyc2VIVE1MKHJbMV0sdCYmdC5ub2RlVHlwZT90Lm93bmVyRG9jdW1lbnR8fHQ6RSwhMCkpLEQudGVzdChyWzFdKSYmay5pc1BsYWluT2JqZWN0KHQpKWZvcihyIGluIHQpbSh0aGlzW3JdKT90aGlzW3JdKHRbcl0pOnRoaXMuYXR0cihyLHRbcl0pO3JldHVybiB0aGlzfXJldHVybihpPUUuZ2V0RWxlbWVudEJ5SWQoclsyXSkpJiYodGhpc1swXT1pLHRoaXMubGVuZ3RoPTEpLHRoaXN9cmV0dXJuIGUubm9kZVR5cGU/KHRoaXNbMF09ZSx0aGlzLmxlbmd0aD0xLHRoaXMpOm0oZSk/dm9pZCAwIT09bi5yZWFkeT9uLnJlYWR5KGUpOmUoayk6ay5tYWtlQXJyYXkoZSx0aGlzKX0pLnByb3RvdHlwZT1rLmZuLHE9ayhFKTt2YXIgSD0vXig/OnBhcmVudHN8cHJldig/OlVudGlsfEFsbCkpLyxPPXtjaGlsZHJlbjohMCxjb250ZW50czohMCxuZXh0OiEwLHByZXY6ITB9O2Z1bmN0aW9uIFAoZSx0KXt3aGlsZSgoZT1lW3RdKSYmMSE9PWUubm9kZVR5cGUpO3JldHVybiBlfWsuZm4uZXh0ZW5kKHtoYXM6ZnVuY3Rpb24oZSl7dmFyIHQ9ayhlLHRoaXMpLG49dC5sZW5ndGg7cmV0dXJuIHRoaXMuZmlsdGVyKGZ1bmN0aW9uKCl7Zm9yKHZhciBlPTA7ZTxuO2UrKylpZihrLmNvbnRhaW5zKHRoaXMsdFtlXSkpcmV0dXJuITB9KX0sY2xvc2VzdDpmdW5jdGlvbihlLHQpe3ZhciBuLHI9MCxpPXRoaXMubGVuZ3RoLG89W10sYT0ic3RyaW5nIiE9dHlwZW9mIGUmJmsoZSk7aWYoIU4udGVzdChlKSlmb3IoO3I8aTtyKyspZm9yKG49dGhpc1tyXTtuJiZuIT09dDtuPW4ucGFyZW50Tm9kZSlpZihuLm5vZGVUeXBlPDExJiYoYT8tMTxhLmluZGV4KG4pOjE9PT1uLm5vZGVUeXBlJiZrLmZpbmQubWF0Y2hlc1NlbGVjdG9yKG4sZSkpKXtvLnB1c2gobik7YnJlYWt9cmV0dXJuIHRoaXMucHVzaFN0YWNrKDE8by5sZW5ndGg/ay51bmlxdWVTb3J0KG8pOm8pfSxpbmRleDpmdW5jdGlvbihlKXtyZXR1cm4gZT8ic3RyaW5nIj09dHlwZW9mIGU/aS5jYWxsKGsoZSksdGhpc1swXSk6aS5jYWxsKHRoaXMsZS5qcXVlcnk/ZVswXTplKTp0aGlzWzBdJiZ0aGlzWzBdLnBhcmVudE5vZGU/dGhpcy5maXJzdCgpLnByZXZBbGwoKS5sZW5ndGg6LTF9LGFkZDpmdW5jdGlvbihlLHQpe3JldHVybiB0aGlzLnB1c2hTdGFjayhrLnVuaXF1ZVNvcnQoay5tZXJnZSh0aGlzLmdldCgpLGsoZSx0KSkpKX0sYWRkQmFjazpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5hZGQobnVsbD09ZT90aGlzLnByZXZPYmplY3Q6dGhpcy5wcmV2T2JqZWN0LmZpbHRlcihlKSl9fSksay5lYWNoKHtwYXJlbnQ6ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5wYXJlbnROb2RlO3JldHVybiB0JiYxMSE9PXQubm9kZVR5cGU/dDpudWxsfSxwYXJlbnRzOmZ1bmN0aW9uKGUpe3JldHVybiBUKGUsInBhcmVudE5vZGUiKX0scGFyZW50c1VudGlsOmZ1bmN0aW9uKGUsdCxuKXtyZXR1cm4gVChlLCJwYXJlbnROb2RlIixuKX0sbmV4dDpmdW5jdGlvbihlKXtyZXR1cm4gUChlLCJuZXh0U2libGluZyIpfSxwcmV2OmZ1bmN0aW9uKGUpe3JldHVybiBQKGUsInByZXZpb3VzU2libGluZyIpfSxuZXh0QWxsOmZ1bmN0aW9uKGUpe3JldHVybiBUKGUsIm5leHRTaWJsaW5nIil9LHByZXZBbGw6ZnVuY3Rpb24oZSl7cmV0dXJuIFQoZSwicHJldmlvdXNTaWJsaW5nIil9LG5leHRVbnRpbDpmdW5jdGlvbihlLHQsbil7cmV0dXJuIFQoZSwibmV4dFNpYmxpbmciLG4pfSxwcmV2VW50aWw6ZnVuY3Rpb24oZSx0LG4pe3JldHVybiBUKGUsInByZXZpb3VzU2libGluZyIsbil9LHNpYmxpbmdzOmZ1bmN0aW9uKGUpe3JldHVybiBTKChlLnBhcmVudE5vZGV8fHt9KS5maXJzdENoaWxkLGUpfSxjaGlsZHJlbjpmdW5jdGlvbihlKXtyZXR1cm4gUyhlLmZpcnN0Q2hpbGQpfSxjb250ZW50czpmdW5jdGlvbihlKXtyZXR1cm4idW5kZWZpbmVkIiE9dHlwZW9mIGUuY29udGVudERvY3VtZW50P2UuY29udGVudERvY3VtZW50OihBKGUsInRlbXBsYXRlIikmJihlPWUuY29udGVudHx8ZSksay5tZXJnZShbXSxlLmNoaWxkTm9kZXMpKX19LGZ1bmN0aW9uKHIsaSl7ay5mbltyXT1mdW5jdGlvbihlLHQpe3ZhciBuPWsubWFwKHRoaXMsaSxlKTtyZXR1cm4iVW50aWwiIT09ci5zbGljZSgtNSkmJih0PWUpLHQmJiJzdHJpbmciPT10eXBlb2YgdCYmKG49ay5maWx0ZXIodCxuKSksMTx0aGlzLmxlbmd0aCYmKE9bcl18fGsudW5pcXVlU29ydChuKSxILnRlc3QocikmJm4ucmV2ZXJzZSgpKSx0aGlzLnB1c2hTdGFjayhuKX19KTt2YXIgUj0vW15ceDIwXHRcclxuXGZdKy9nO2Z1bmN0aW9uIE0oZSl7cmV0dXJuIGV9ZnVuY3Rpb24gSShlKXt0aHJvdyBlfWZ1bmN0aW9uIFcoZSx0LG4scil7dmFyIGk7dHJ5e2UmJm0oaT1lLnByb21pc2UpP2kuY2FsbChlKS5kb25lKHQpLmZhaWwobik6ZSYmbShpPWUudGhlbik/aS5jYWxsKGUsdCxuKTp0LmFwcGx5KHZvaWQgMCxbZV0uc2xpY2UocikpfWNhdGNoKGUpe24uYXBwbHkodm9pZCAwLFtlXSl9fWsuQ2FsbGJhY2tzPWZ1bmN0aW9uKHIpe3ZhciBlLG47cj0ic3RyaW5nIj09dHlwZW9mIHI/KGU9cixuPXt9LGsuZWFjaChlLm1hdGNoKFIpfHxbXSxmdW5jdGlvbihlLHQpe25bdF09ITB9KSxuKTprLmV4dGVuZCh7fSxyKTt2YXIgaSx0LG8sYSxzPVtdLHU9W10sbD0tMSxjPWZ1bmN0aW9uKCl7Zm9yKGE9YXx8ci5vbmNlLG89aT0hMDt1Lmxlbmd0aDtsPS0xKXt0PXUuc2hpZnQoKTt3aGlsZSgrK2w8cy5sZW5ndGgpITE9PT1zW2xdLmFwcGx5KHRbMF0sdFsxXSkmJnIuc3RvcE9uRmFsc2UmJihsPXMubGVuZ3RoLHQ9ITEpfXIubWVtb3J5fHwodD0hMSksaT0hMSxhJiYocz10P1tdOiIiKX0sZj17YWRkOmZ1bmN0aW9uKCl7cmV0dXJuIHMmJih0JiYhaSYmKGw9cy5sZW5ndGgtMSx1LnB1c2godCkpLGZ1bmN0aW9uIG4oZSl7ay5lYWNoKGUsZnVuY3Rpb24oZSx0KXttKHQpP3IudW5pcXVlJiZmLmhhcyh0KXx8cy5wdXNoKHQpOnQmJnQubGVuZ3RoJiYic3RyaW5nIiE9PXcodCkmJm4odCl9KX0oYXJndW1lbnRzKSx0JiYhaSYmYygpKSx0aGlzfSxyZW1vdmU6ZnVuY3Rpb24oKXtyZXR1cm4gay5lYWNoKGFyZ3VtZW50cyxmdW5jdGlvbihlLHQpe3ZhciBuO3doaWxlKC0xPChuPWsuaW5BcnJheSh0LHMsbikpKXMuc3BsaWNlKG4sMSksbjw9bCYmbC0tfSksdGhpc30saGFzOmZ1bmN0aW9uKGUpe3JldHVybiBlPy0xPGsuaW5BcnJheShlLHMpOjA8cy5sZW5ndGh9LGVtcHR5OmZ1bmN0aW9uKCl7cmV0dXJuIHMmJihzPVtdKSx0aGlzfSxkaXNhYmxlOmZ1bmN0aW9uKCl7cmV0dXJuIGE9dT1bXSxzPXQ9IiIsdGhpc30sZGlzYWJsZWQ6ZnVuY3Rpb24oKXtyZXR1cm4hc30sbG9jazpmdW5jdGlvbigpe3JldHVybiBhPXU9W10sdHx8aXx8KHM9dD0iIiksdGhpc30sbG9ja2VkOmZ1bmN0aW9uKCl7cmV0dXJuISFhfSxmaXJlV2l0aDpmdW5jdGlvbihlLHQpe3JldHVybiBhfHwodD1bZSwodD10fHxbXSkuc2xpY2U/dC5zbGljZSgpOnRdLHUucHVzaCh0KSxpfHxjKCkpLHRoaXN9LGZpcmU6ZnVuY3Rpb24oKXtyZXR1cm4gZi5maXJlV2l0aCh0aGlzLGFyZ3VtZW50cyksdGhpc30sZmlyZWQ6ZnVuY3Rpb24oKXtyZXR1cm4hIW99fTtyZXR1cm4gZn0say5leHRlbmQoe0RlZmVycmVkOmZ1bmN0aW9uKGUpe3ZhciBvPVtbIm5vdGlmeSIsInByb2dyZXNzIixrLkNhbGxiYWNrcygibWVtb3J5Iiksay5DYWxsYmFja3MoIm1lbW9yeSIpLDJdLFsicmVzb2x2ZSIsImRvbmUiLGsuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLGsuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLDAsInJlc29sdmVkIl0sWyJyZWplY3QiLCJmYWlsIixrLkNhbGxiYWNrcygib25jZSBtZW1vcnkiKSxrLkNhbGxiYWNrcygib25jZSBtZW1vcnkiKSwxLCJyZWplY3RlZCJdXSxpPSJwZW5kaW5nIixhPXtzdGF0ZTpmdW5jdGlvbigpe3JldHVybiBpfSxhbHdheXM6ZnVuY3Rpb24oKXtyZXR1cm4gcy5kb25lKGFyZ3VtZW50cykuZmFpbChhcmd1bWVudHMpLHRoaXN9LCJjYXRjaCI6ZnVuY3Rpb24oZSl7cmV0dXJuIGEudGhlbihudWxsLGUpfSxwaXBlOmZ1bmN0aW9uKCl7dmFyIGk9YXJndW1lbnRzO3JldHVybiBrLkRlZmVycmVkKGZ1bmN0aW9uKHIpe2suZWFjaChvLGZ1bmN0aW9uKGUsdCl7dmFyIG49bShpW3RbNF1dKSYmaVt0WzRdXTtzW3RbMV1dKGZ1bmN0aW9uKCl7dmFyIGU9biYmbi5hcHBseSh0aGlzLGFyZ3VtZW50cyk7ZSYmbShlLnByb21pc2UpP2UucHJvbWlzZSgpLnByb2dyZXNzKHIubm90aWZ5KS5kb25lKHIucmVzb2x2ZSkuZmFpbChyLnJlamVjdCk6clt0WzBdKyJXaXRoIl0odGhpcyxuP1tlXTphcmd1bWVudHMpfSl9KSxpPW51bGx9KS5wcm9taXNlKCl9LHRoZW46ZnVuY3Rpb24odCxuLHIpe3ZhciB1PTA7ZnVuY3Rpb24gbChpLG8sYSxzKXtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgbj10aGlzLHI9YXJndW1lbnRzLGU9ZnVuY3Rpb24oKXt2YXIgZSx0O2lmKCEoaTx1KSl7aWYoKGU9YS5hcHBseShuLHIpKT09PW8ucHJvbWlzZSgpKXRocm93IG5ldyBUeXBlRXJyb3IoIlRoZW5hYmxlIHNlbGYtcmVzb2x1dGlvbiIpO3Q9ZSYmKCJvYmplY3QiPT10eXBlb2YgZXx8ImZ1bmN0aW9uIj09dHlwZW9mIGUpJiZlLnRoZW4sbSh0KT9zP3QuY2FsbChlLGwodSxvLE0scyksbCh1LG8sSSxzKSk6KHUrKyx0LmNhbGwoZSxsKHUsbyxNLHMpLGwodSxvLEkscyksbCh1LG8sTSxvLm5vdGlmeVdpdGgpKSk6KGEhPT1NJiYobj12b2lkIDAscj1bZV0pLChzfHxvLnJlc29sdmVXaXRoKShuLHIpKX19LHQ9cz9lOmZ1bmN0aW9uKCl7dHJ5e2UoKX1jYXRjaChlKXtrLkRlZmVycmVkLmV4Y2VwdGlvbkhvb2smJmsuRGVmZXJyZWQuZXhjZXB0aW9uSG9vayhlLHQuc3RhY2tUcmFjZSksdTw9aSsxJiYoYSE9PUkmJihuPXZvaWQgMCxyPVtlXSksby5yZWplY3RXaXRoKG4scikpfX07aT90KCk6KGsuRGVmZXJyZWQuZ2V0U3RhY2tIb29rJiYodC5zdGFja1RyYWNlPWsuRGVmZXJyZWQuZ2V0U3RhY2tIb29rKCkpLEMuc2V0VGltZW91dCh0KSl9fXJldHVybiBrLkRlZmVycmVkKGZ1bmN0aW9uKGUpe29bMF1bM10uYWRkKGwoMCxlLG0ocik/cjpNLGUubm90aWZ5V2l0aCkpLG9bMV1bM10uYWRkKGwoMCxlLG0odCk/dDpNKSksb1syXVszXS5hZGQobCgwLGUsbShuKT9uOkkpKX0pLnByb21pc2UoKX0scHJvbWlzZTpmdW5jdGlvbihlKXtyZXR1cm4gbnVsbCE9ZT9rLmV4dGVuZChlLGEpOmF9fSxzPXt9O3JldHVybiBrLmVhY2gobyxmdW5jdGlvbihlLHQpe3ZhciBuPXRbMl0scj10WzVdO2FbdFsxXV09bi5hZGQsciYmbi5hZGQoZnVuY3Rpb24oKXtpPXJ9LG9bMy1lXVsyXS5kaXNhYmxlLG9bMy1lXVszXS5kaXNhYmxlLG9bMF1bMl0ubG9jayxvWzBdWzNdLmxvY2spLG4uYWRkKHRbM10uZmlyZSksc1t0WzBdXT1mdW5jdGlvbigpe3JldHVybiBzW3RbMF0rIldpdGgiXSh0aGlzPT09cz92b2lkIDA6dGhpcyxhcmd1bWVudHMpLHRoaXN9LHNbdFswXSsiV2l0aCJdPW4uZmlyZVdpdGh9KSxhLnByb21pc2UocyksZSYmZS5jYWxsKHMscyksc30sd2hlbjpmdW5jdGlvbihlKXt2YXIgbj1hcmd1bWVudHMubGVuZ3RoLHQ9bixyPUFycmF5KHQpLGk9cy5jYWxsKGFyZ3VtZW50cyksbz1rLkRlZmVycmVkKCksYT1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oZSl7clt0XT10aGlzLGlbdF09MTxhcmd1bWVudHMubGVuZ3RoP3MuY2FsbChhcmd1bWVudHMpOmUsLS1ufHxvLnJlc29sdmVXaXRoKHIsaSl9fTtpZihuPD0xJiYoVyhlLG8uZG9uZShhKHQpKS5yZXNvbHZlLG8ucmVqZWN0LCFuKSwicGVuZGluZyI9PT1vLnN0YXRlKCl8fG0oaVt0XSYmaVt0XS50aGVuKSkpcmV0dXJuIG8udGhlbigpO3doaWxlKHQtLSlXKGlbdF0sYSh0KSxvLnJlamVjdCk7cmV0dXJuIG8ucHJvbWlzZSgpfX0pO3ZhciAkPS9eKEV2YWx8SW50ZXJuYWx8UmFuZ2V8UmVmZXJlbmNlfFN5bnRheHxUeXBlfFVSSSlFcnJvciQvO2suRGVmZXJyZWQuZXhjZXB0aW9uSG9vaz1mdW5jdGlvbihlLHQpe0MuY29uc29sZSYmQy5jb25zb2xlLndhcm4mJmUmJiQudGVzdChlLm5hbWUpJiZDLmNvbnNvbGUud2FybigialF1ZXJ5LkRlZmVycmVkIGV4Y2VwdGlvbjogIitlLm1lc3NhZ2UsZS5zdGFjayx0KX0say5yZWFkeUV4Y2VwdGlvbj1mdW5jdGlvbihlKXtDLnNldFRpbWVvdXQoZnVuY3Rpb24oKXt0aHJvdyBlfSl9O3ZhciBGPWsuRGVmZXJyZWQoKTtmdW5jdGlvbiBCKCl7RS5yZW1vdmVFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIixCKSxDLnJlbW92ZUV2ZW50TGlzdGVuZXIoImxvYWQiLEIpLGsucmVhZHkoKX1rLmZuLnJlYWR5PWZ1bmN0aW9uKGUpe3JldHVybiBGLnRoZW4oZSlbImNhdGNoIl0oZnVuY3Rpb24oZSl7ay5yZWFkeUV4Y2VwdGlvbihlKX0pLHRoaXN9LGsuZXh0ZW5kKHtpc1JlYWR5OiExLHJlYWR5V2FpdDoxLHJlYWR5OmZ1bmN0aW9uKGUpeyghMD09PWU/LS1rLnJlYWR5V2FpdDprLmlzUmVhZHkpfHwoay5pc1JlYWR5PSEwKSE9PWUmJjA8LS1rLnJlYWR5V2FpdHx8Ri5yZXNvbHZlV2l0aChFLFtrXSl9fSksay5yZWFkeS50aGVuPUYudGhlbiwiY29tcGxldGUiPT09RS5yZWFkeVN0YXRlfHwibG9hZGluZyIhPT1FLnJlYWR5U3RhdGUmJiFFLmRvY3VtZW50RWxlbWVudC5kb1Njcm9sbD9DLnNldFRpbWVvdXQoay5yZWFkeSk6KEUuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsQiksQy5hZGRFdmVudExpc3RlbmVyKCJsb2FkIixCKSk7dmFyIF89ZnVuY3Rpb24oZSx0LG4scixpLG8sYSl7dmFyIHM9MCx1PWUubGVuZ3RoLGw9bnVsbD09bjtpZigib2JqZWN0Ij09PXcobikpZm9yKHMgaW4gaT0hMCxuKV8oZSx0LHMsbltzXSwhMCxvLGEpO2Vsc2UgaWYodm9pZCAwIT09ciYmKGk9ITAsbShyKXx8KGE9ITApLGwmJihhPyh0LmNhbGwoZSxyKSx0PW51bGwpOihsPXQsdD1mdW5jdGlvbihlLHQsbil7cmV0dXJuIGwuY2FsbChrKGUpLG4pfSkpLHQpKWZvcig7czx1O3MrKyl0KGVbc10sbixhP3I6ci5jYWxsKGVbc10scyx0KGVbc10sbikpKTtyZXR1cm4gaT9lOmw/dC5jYWxsKGUpOnU/dChlWzBdLG4pOm99LHo9L14tbXMtLyxVPS8tKFthLXpdKS9nO2Z1bmN0aW9uIFgoZSx0KXtyZXR1cm4gdC50b1VwcGVyQ2FzZSgpfWZ1bmN0aW9uIFYoZSl7cmV0dXJuIGUucmVwbGFjZSh6LCJtcy0iKS5yZXBsYWNlKFUsWCl9dmFyIEc9ZnVuY3Rpb24oZSl7cmV0dXJuIDE9PT1lLm5vZGVUeXBlfHw5PT09ZS5ub2RlVHlwZXx8IStlLm5vZGVUeXBlfTtmdW5jdGlvbiBZKCl7dGhpcy5leHBhbmRvPWsuZXhwYW5kbytZLnVpZCsrfVkudWlkPTEsWS5wcm90b3R5cGU9e2NhY2hlOmZ1bmN0aW9uKGUpe3ZhciB0PWVbdGhpcy5leHBhbmRvXTtyZXR1cm4gdHx8KHQ9e30sRyhlKSYmKGUubm9kZVR5cGU/ZVt0aGlzLmV4cGFuZG9dPXQ6T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsdGhpcy5leHBhbmRvLHt2YWx1ZTp0LGNvbmZpZ3VyYWJsZTohMH0pKSksdH0sc2V0OmZ1bmN0aW9uKGUsdCxuKXt2YXIgcixpPXRoaXMuY2FjaGUoZSk7aWYoInN0cmluZyI9PXR5cGVvZiB0KWlbVih0KV09bjtlbHNlIGZvcihyIGluIHQpaVtWKHIpXT10W3JdO3JldHVybiBpfSxnZXQ6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdm9pZCAwPT09dD90aGlzLmNhY2hlKGUpOmVbdGhpcy5leHBhbmRvXSYmZVt0aGlzLmV4cGFuZG9dW1YodCldfSxhY2Nlc3M6ZnVuY3Rpb24oZSx0LG4pe3JldHVybiB2b2lkIDA9PT10fHx0JiYic3RyaW5nIj09dHlwZW9mIHQmJnZvaWQgMD09PW4/dGhpcy5nZXQoZSx0KToodGhpcy5zZXQoZSx0LG4pLHZvaWQgMCE9PW4/bjp0KX0scmVtb3ZlOmZ1bmN0aW9uKGUsdCl7dmFyIG4scj1lW3RoaXMuZXhwYW5kb107aWYodm9pZCAwIT09cil7aWYodm9pZCAwIT09dCl7bj0odD1BcnJheS5pc0FycmF5KHQpP3QubWFwKFYpOih0PVYodCkpaW4gcj9bdF06dC5tYXRjaChSKXx8W10pLmxlbmd0aDt3aGlsZShuLS0pZGVsZXRlIHJbdFtuXV19KHZvaWQgMD09PXR8fGsuaXNFbXB0eU9iamVjdChyKSkmJihlLm5vZGVUeXBlP2VbdGhpcy5leHBhbmRvXT12b2lkIDA6ZGVsZXRlIGVbdGhpcy5leHBhbmRvXSl9fSxoYXNEYXRhOmZ1bmN0aW9uKGUpe3ZhciB0PWVbdGhpcy5leHBhbmRvXTtyZXR1cm4gdm9pZCAwIT09dCYmIWsuaXNFbXB0eU9iamVjdCh0KX19O3ZhciBRPW5ldyBZLEo9bmV3IFksSz0vXig/Olx7W1x3XFddKlx9fFxbW1x3XFddKlxdKSQvLFo9L1tBLVpdL2c7ZnVuY3Rpb24gZWUoZSx0LG4pe3ZhciByLGk7aWYodm9pZCAwPT09biYmMT09PWUubm9kZVR5cGUpaWYocj0iZGF0YS0iK3QucmVwbGFjZShaLCItJCYiKS50b0xvd2VyQ2FzZSgpLCJzdHJpbmciPT10eXBlb2Yobj1lLmdldEF0dHJpYnV0ZShyKSkpe3RyeXtuPSJ0cnVlIj09PShpPW4pfHwiZmFsc2UiIT09aSYmKCJudWxsIj09PWk/bnVsbDppPT09K2krIiI/K2k6Sy50ZXN0KGkpP0pTT04ucGFyc2UoaSk6aSl9Y2F0Y2goZSl7fUouc2V0KGUsdCxuKX1lbHNlIG49dm9pZCAwO3JldHVybiBufWsuZXh0ZW5kKHtoYXNEYXRhOmZ1bmN0aW9uKGUpe3JldHVybiBKLmhhc0RhdGEoZSl8fFEuaGFzRGF0YShlKX0sZGF0YTpmdW5jdGlvbihlLHQsbil7cmV0dXJuIEouYWNjZXNzKGUsdCxuKX0scmVtb3ZlRGF0YTpmdW5jdGlvbihlLHQpe0oucmVtb3ZlKGUsdCl9LF9kYXRhOmZ1bmN0aW9uKGUsdCxuKXtyZXR1cm4gUS5hY2Nlc3MoZSx0LG4pfSxfcmVtb3ZlRGF0YTpmdW5jdGlvbihlLHQpe1EucmVtb3ZlKGUsdCl9fSksay5mbi5leHRlbmQoe2RhdGE6ZnVuY3Rpb24obixlKXt2YXIgdCxyLGksbz10aGlzWzBdLGE9byYmby5hdHRyaWJ1dGVzO2lmKHZvaWQgMD09PW4pe2lmKHRoaXMubGVuZ3RoJiYoaT1KLmdldChvKSwxPT09by5ub2RlVHlwZSYmIVEuZ2V0KG8sImhhc0RhdGFBdHRycyIpKSl7dD1hLmxlbmd0aDt3aGlsZSh0LS0pYVt0XSYmMD09PShyPWFbdF0ubmFtZSkuaW5kZXhPZigiZGF0YS0iKSYmKHI9VihyLnNsaWNlKDUpKSxlZShvLHIsaVtyXSkpO1Euc2V0KG8sImhhc0RhdGFBdHRycyIsITApfXJldHVybiBpfXJldHVybiJvYmplY3QiPT10eXBlb2Ygbj90aGlzLmVhY2goZnVuY3Rpb24oKXtKLnNldCh0aGlzLG4pfSk6Xyh0aGlzLGZ1bmN0aW9uKGUpe3ZhciB0O2lmKG8mJnZvaWQgMD09PWUpcmV0dXJuIHZvaWQgMCE9PSh0PUouZ2V0KG8sbikpP3Q6dm9pZCAwIT09KHQ9ZWUobyxuKSk/dDp2b2lkIDA7dGhpcy5lYWNoKGZ1bmN0aW9uKCl7Si5zZXQodGhpcyxuLGUpfSl9LG51bGwsZSwxPGFyZ3VtZW50cy5sZW5ndGgsbnVsbCwhMCl9LHJlbW92ZURhdGE6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe0oucmVtb3ZlKHRoaXMsZSl9KX19KSxrLmV4dGVuZCh7cXVldWU6ZnVuY3Rpb24oZSx0LG4pe3ZhciByO2lmKGUpcmV0dXJuIHQ9KHR8fCJmeCIpKyJxdWV1ZSIscj1RLmdldChlLHQpLG4mJighcnx8QXJyYXkuaXNBcnJheShuKT9yPVEuYWNjZXNzKGUsdCxrLm1ha2VBcnJheShuKSk6ci5wdXNoKG4pKSxyfHxbXX0sZGVxdWV1ZTpmdW5jdGlvbihlLHQpe3Q9dHx8ImZ4Ijt2YXIgbj1rLnF1ZXVlKGUsdCkscj1uLmxlbmd0aCxpPW4uc2hpZnQoKSxvPWsuX3F1ZXVlSG9va3MoZSx0KTsiaW5wcm9ncmVzcyI9PT1pJiYoaT1uLnNoaWZ0KCksci0tKSxpJiYoImZ4Ij09PXQmJm4udW5zaGlmdCgiaW5wcm9ncmVzcyIpLGRlbGV0ZSBvLnN0b3AsaS5jYWxsKGUsZnVuY3Rpb24oKXtrLmRlcXVldWUoZSx0KX0sbykpLCFyJiZvJiZvLmVtcHR5LmZpcmUoKX0sX3F1ZXVlSG9va3M6ZnVuY3Rpb24oZSx0KXt2YXIgbj10KyJxdWV1ZUhvb2tzIjtyZXR1cm4gUS5nZXQoZSxuKXx8US5hY2Nlc3MoZSxuLHtlbXB0eTprLkNhbGxiYWNrcygib25jZSBtZW1vcnkiKS5hZGQoZnVuY3Rpb24oKXtRLnJlbW92ZShlLFt0KyJxdWV1ZSIsbl0pfSl9KX19KSxrLmZuLmV4dGVuZCh7cXVldWU6ZnVuY3Rpb24odCxuKXt2YXIgZT0yO3JldHVybiJzdHJpbmciIT10eXBlb2YgdCYmKG49dCx0PSJmeCIsZS0tKSxhcmd1bWVudHMubGVuZ3RoPGU/ay5xdWV1ZSh0aGlzWzBdLHQpOnZvaWQgMD09PW4/dGhpczp0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgZT1rLnF1ZXVlKHRoaXMsdCxuKTtrLl9xdWV1ZUhvb2tzKHRoaXMsdCksImZ4Ij09PXQmJiJpbnByb2dyZXNzIiE9PWVbMF0mJmsuZGVxdWV1ZSh0aGlzLHQpfSl9LGRlcXVldWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2suZGVxdWV1ZSh0aGlzLGUpfSl9LGNsZWFyUXVldWU6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMucXVldWUoZXx8ImZ4IixbXSl9LHByb21pc2U6ZnVuY3Rpb24oZSx0KXt2YXIgbixyPTEsaT1rLkRlZmVycmVkKCksbz10aGlzLGE9dGhpcy5sZW5ndGgscz1mdW5jdGlvbigpey0tcnx8aS5yZXNvbHZlV2l0aChvLFtvXSl9OyJzdHJpbmciIT10eXBlb2YgZSYmKHQ9ZSxlPXZvaWQgMCksZT1lfHwiZngiO3doaWxlKGEtLSkobj1RLmdldChvW2FdLGUrInF1ZXVlSG9va3MiKSkmJm4uZW1wdHkmJihyKyssbi5lbXB0eS5hZGQocykpO3JldHVybiBzKCksaS5wcm9taXNlKHQpfX0pO3ZhciB0ZT0vWystXT8oPzpcZCpcLnwpXGQrKD86W2VFXVsrLV0/XGQrfCkvLnNvdXJjZSxuZT1uZXcgUmVnRXhwKCJeKD86KFsrLV0pPXwpKCIrdGUrIikoW2EteiVdKikkIiwiaSIpLHJlPVsiVG9wIiwiUmlnaHQiLCJCb3R0b20iLCJMZWZ0Il0saWU9RS5kb2N1bWVudEVsZW1lbnQsb2U9ZnVuY3Rpb24oZSl7cmV0dXJuIGsuY29udGFpbnMoZS5vd25lckRvY3VtZW50LGUpfSxhZT17Y29tcG9zZWQ6ITB9O2llLmdldFJvb3ROb2RlJiYob2U9ZnVuY3Rpb24oZSl7cmV0dXJuIGsuY29udGFpbnMoZS5vd25lckRvY3VtZW50LGUpfHxlLmdldFJvb3ROb2RlKGFlKT09PWUub3duZXJEb2N1bWVudH0pO3ZhciBzZT1mdW5jdGlvbihlLHQpe3JldHVybiJub25lIj09PShlPXR8fGUpLnN0eWxlLmRpc3BsYXl8fCIiPT09ZS5zdHlsZS5kaXNwbGF5JiZvZShlKSYmIm5vbmUiPT09ay5jc3MoZSwiZGlzcGxheSIpfSx1ZT1mdW5jdGlvbihlLHQsbixyKXt2YXIgaSxvLGE9e307Zm9yKG8gaW4gdClhW29dPWUuc3R5bGVbb10sZS5zdHlsZVtvXT10W29dO2ZvcihvIGluIGk9bi5hcHBseShlLHJ8fFtdKSx0KWUuc3R5bGVbb109YVtvXTtyZXR1cm4gaX07ZnVuY3Rpb24gbGUoZSx0LG4scil7dmFyIGksbyxhPTIwLHM9cj9mdW5jdGlvbigpe3JldHVybiByLmN1cigpfTpmdW5jdGlvbigpe3JldHVybiBrLmNzcyhlLHQsIiIpfSx1PXMoKSxsPW4mJm5bM118fChrLmNzc051bWJlclt0XT8iIjoicHgiKSxjPWUubm9kZVR5cGUmJihrLmNzc051bWJlclt0XXx8InB4IiE9PWwmJit1KSYmbmUuZXhlYyhrLmNzcyhlLHQpKTtpZihjJiZjWzNdIT09bCl7dS89MixsPWx8fGNbM10sYz0rdXx8MTt3aGlsZShhLS0pay5zdHlsZShlLHQsYytsKSwoMS1vKSooMS0obz1zKCkvdXx8LjUpKTw9MCYmKGE9MCksYy89bztjKj0yLGsuc3R5bGUoZSx0LGMrbCksbj1ufHxbXX1yZXR1cm4gbiYmKGM9K2N8fCt1fHwwLGk9blsxXT9jKyhuWzFdKzEpKm5bMl06K25bMl0sciYmKHIudW5pdD1sLHIuc3RhcnQ9YyxyLmVuZD1pKSksaX12YXIgY2U9e307ZnVuY3Rpb24gZmUoZSx0KXtmb3IodmFyIG4scixpLG8sYSxzLHUsbD1bXSxjPTAsZj1lLmxlbmd0aDtjPGY7YysrKShyPWVbY10pLnN0eWxlJiYobj1yLnN0eWxlLmRpc3BsYXksdD8oIm5vbmUiPT09biYmKGxbY109US5nZXQociwiZGlzcGxheSIpfHxudWxsLGxbY118fChyLnN0eWxlLmRpc3BsYXk9IiIpKSwiIj09PXIuc3R5bGUuZGlzcGxheSYmc2UocikmJihsW2NdPSh1PWE9bz12b2lkIDAsYT0oaT1yKS5vd25lckRvY3VtZW50LHM9aS5ub2RlTmFtZSwodT1jZVtzXSl8fChvPWEuYm9keS5hcHBlbmRDaGlsZChhLmNyZWF0ZUVsZW1lbnQocykpLHU9ay5jc3MobywiZGlzcGxheSIpLG8ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChvKSwibm9uZSI9PT11JiYodT0iYmxvY2siKSxjZVtzXT11KSkpKToibm9uZSIhPT1uJiYobFtjXT0ibm9uZSIsUS5zZXQociwiZGlzcGxheSIsbikpKTtmb3IoYz0wO2M8ZjtjKyspbnVsbCE9bFtjXSYmKGVbY10uc3R5bGUuZGlzcGxheT1sW2NdKTtyZXR1cm4gZX1rLmZuLmV4dGVuZCh7c2hvdzpmdW5jdGlvbigpe3JldHVybiBmZSh0aGlzLCEwKX0saGlkZTpmdW5jdGlvbigpe3JldHVybiBmZSh0aGlzKX0sdG9nZ2xlOmZ1bmN0aW9uKGUpe3JldHVybiJib29sZWFuIj09dHlwZW9mIGU/ZT90aGlzLnNob3coKTp0aGlzLmhpZGUoKTp0aGlzLmVhY2goZnVuY3Rpb24oKXtzZSh0aGlzKT9rKHRoaXMpLnNob3coKTprKHRoaXMpLmhpZGUoKX0pfX0pO3ZhciBwZT0vXig/OmNoZWNrYm94fHJhZGlvKSQvaSxkZT0vPChbYS16XVteXC9cMD5ceDIwXHRcclxuXGZdKikvaSxoZT0vXiR8Xm1vZHVsZSR8XC8oPzpqYXZhfGVjbWEpc2NyaXB0L2ksZ2U9e29wdGlvbjpbMSwiPHNlbGVjdCBtdWx0aXBsZT0nbXVsdGlwbGUnPiIsIjwvc2VsZWN0PiJdLHRoZWFkOlsxLCI8dGFibGU+IiwiPC90YWJsZT4iXSxjb2w6WzIsIjx0YWJsZT48Y29sZ3JvdXA+IiwiPC9jb2xncm91cD48L3RhYmxlPiJdLHRyOlsyLCI8dGFibGU+PHRib2R5PiIsIjwvdGJvZHk+PC90YWJsZT4iXSx0ZDpbMywiPHRhYmxlPjx0Ym9keT48dHI+IiwiPC90cj48L3Rib2R5PjwvdGFibGU+Il0sX2RlZmF1bHQ6WzAsIiIsIiJdfTtmdW5jdGlvbiB2ZShlLHQpe3ZhciBuO3JldHVybiBuPSJ1bmRlZmluZWQiIT10eXBlb2YgZS5nZXRFbGVtZW50c0J5VGFnTmFtZT9lLmdldEVsZW1lbnRzQnlUYWdOYW1lKHR8fCIqIik6InVuZGVmaW5lZCIhPXR5cGVvZiBlLnF1ZXJ5U2VsZWN0b3JBbGw/ZS5xdWVyeVNlbGVjdG9yQWxsKHR8fCIqIik6W10sdm9pZCAwPT09dHx8dCYmQShlLHQpP2subWVyZ2UoW2VdLG4pOm59ZnVuY3Rpb24geWUoZSx0KXtmb3IodmFyIG49MCxyPWUubGVuZ3RoO248cjtuKyspUS5zZXQoZVtuXSwiZ2xvYmFsRXZhbCIsIXR8fFEuZ2V0KHRbbl0sImdsb2JhbEV2YWwiKSl9Z2Uub3B0Z3JvdXA9Z2Uub3B0aW9uLGdlLnRib2R5PWdlLnRmb290PWdlLmNvbGdyb3VwPWdlLmNhcHRpb249Z2UudGhlYWQsZ2UudGg9Z2UudGQ7dmFyIG1lLHhlLGJlPS88fCYjP1x3KzsvO2Z1bmN0aW9uIHdlKGUsdCxuLHIsaSl7Zm9yKHZhciBvLGEscyx1LGwsYyxmPXQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLHA9W10sZD0wLGg9ZS5sZW5ndGg7ZDxoO2QrKylpZigobz1lW2RdKXx8MD09PW8paWYoIm9iamVjdCI9PT13KG8pKWsubWVyZ2UocCxvLm5vZGVUeXBlP1tvXTpvKTtlbHNlIGlmKGJlLnRlc3Qobykpe2E9YXx8Zi5hcHBlbmRDaGlsZCh0LmNyZWF0ZUVsZW1lbnQoImRpdiIpKSxzPShkZS5leGVjKG8pfHxbIiIsIiJdKVsxXS50b0xvd2VyQ2FzZSgpLHU9Z2Vbc118fGdlLl9kZWZhdWx0LGEuaW5uZXJIVE1MPXVbMV0ray5odG1sUHJlZmlsdGVyKG8pK3VbMl0sYz11WzBdO3doaWxlKGMtLSlhPWEubGFzdENoaWxkO2subWVyZ2UocCxhLmNoaWxkTm9kZXMpLChhPWYuZmlyc3RDaGlsZCkudGV4dENvbnRlbnQ9IiJ9ZWxzZSBwLnB1c2godC5jcmVhdGVUZXh0Tm9kZShvKSk7Zi50ZXh0Q29udGVudD0iIixkPTA7d2hpbGUobz1wW2QrK10paWYociYmLTE8ay5pbkFycmF5KG8scikpaSYmaS5wdXNoKG8pO2Vsc2UgaWYobD1vZShvKSxhPXZlKGYuYXBwZW5kQ2hpbGQobyksInNjcmlwdCIpLGwmJnllKGEpLG4pe2M9MDt3aGlsZShvPWFbYysrXSloZS50ZXN0KG8udHlwZXx8IiIpJiZuLnB1c2gobyl9cmV0dXJuIGZ9bWU9RS5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCkuYXBwZW5kQ2hpbGQoRS5jcmVhdGVFbGVtZW50KCJkaXYiKSksKHhlPUUuY3JlYXRlRWxlbWVudCgiaW5wdXQiKSkuc2V0QXR0cmlidXRlKCJ0eXBlIiwicmFkaW8iKSx4ZS5zZXRBdHRyaWJ1dGUoImNoZWNrZWQiLCJjaGVja2VkIikseGUuc2V0QXR0cmlidXRlKCJuYW1lIiwidCIpLG1lLmFwcGVuZENoaWxkKHhlKSx5LmNoZWNrQ2xvbmU9bWUuY2xvbmVOb2RlKCEwKS5jbG9uZU5vZGUoITApLmxhc3RDaGlsZC5jaGVja2VkLG1lLmlubmVySFRNTD0iPHRleHRhcmVhPng8L3RleHRhcmVhPiIseS5ub0Nsb25lQ2hlY2tlZD0hIW1lLmNsb25lTm9kZSghMCkubGFzdENoaWxkLmRlZmF1bHRWYWx1ZTt2YXIgVGU9L15rZXkvLENlPS9eKD86bW91c2V8cG9pbnRlcnxjb250ZXh0bWVudXxkcmFnfGRyb3ApfGNsaWNrLyxFZT0vXihbXi5dKikoPzpcLiguKyl8KS87ZnVuY3Rpb24ga2UoKXtyZXR1cm4hMH1mdW5jdGlvbiBTZSgpe3JldHVybiExfWZ1bmN0aW9uIE5lKGUsdCl7cmV0dXJuIGU9PT1mdW5jdGlvbigpe3RyeXtyZXR1cm4gRS5hY3RpdmVFbGVtZW50fWNhdGNoKGUpe319KCk9PSgiZm9jdXMiPT09dCl9ZnVuY3Rpb24gQWUoZSx0LG4scixpLG8pe3ZhciBhLHM7aWYoIm9iamVjdCI9PXR5cGVvZiB0KXtmb3IocyBpbiJzdHJpbmciIT10eXBlb2YgbiYmKHI9cnx8bixuPXZvaWQgMCksdClBZShlLHMsbixyLHRbc10sbyk7cmV0dXJuIGV9aWYobnVsbD09ciYmbnVsbD09aT8oaT1uLHI9bj12b2lkIDApOm51bGw9PWkmJigic3RyaW5nIj09dHlwZW9mIG4/KGk9cixyPXZvaWQgMCk6KGk9cixyPW4sbj12b2lkIDApKSwhMT09PWkpaT1TZTtlbHNlIGlmKCFpKXJldHVybiBlO3JldHVybiAxPT09byYmKGE9aSwoaT1mdW5jdGlvbihlKXtyZXR1cm4gaygpLm9mZihlKSxhLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0pLmd1aWQ9YS5ndWlkfHwoYS5ndWlkPWsuZ3VpZCsrKSksZS5lYWNoKGZ1bmN0aW9uKCl7ay5ldmVudC5hZGQodGhpcyx0LGkscixuKX0pfWZ1bmN0aW9uIERlKGUsaSxvKXtvPyhRLnNldChlLGksITEpLGsuZXZlbnQuYWRkKGUsaSx7bmFtZXNwYWNlOiExLGhhbmRsZXI6ZnVuY3Rpb24oZSl7dmFyIHQsbixyPVEuZ2V0KHRoaXMsaSk7aWYoMSZlLmlzVHJpZ2dlciYmdGhpc1tpXSl7aWYoci5sZW5ndGgpKGsuZXZlbnQuc3BlY2lhbFtpXXx8e30pLmRlbGVnYXRlVHlwZSYmZS5zdG9wUHJvcGFnYXRpb24oKTtlbHNlIGlmKHI9cy5jYWxsKGFyZ3VtZW50cyksUS5zZXQodGhpcyxpLHIpLHQ9byh0aGlzLGkpLHRoaXNbaV0oKSxyIT09KG49US5nZXQodGhpcyxpKSl8fHQ/US5zZXQodGhpcyxpLCExKTpuPXt9LHIhPT1uKXJldHVybiBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpLGUucHJldmVudERlZmF1bHQoKSxuLnZhbHVlfWVsc2Ugci5sZW5ndGgmJihRLnNldCh0aGlzLGkse3ZhbHVlOmsuZXZlbnQudHJpZ2dlcihrLmV4dGVuZChyWzBdLGsuRXZlbnQucHJvdG90eXBlKSxyLnNsaWNlKDEpLHRoaXMpfSksZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKSl9fSkpOnZvaWQgMD09PVEuZ2V0KGUsaSkmJmsuZXZlbnQuYWRkKGUsaSxrZSl9ay5ldmVudD17Z2xvYmFsOnt9LGFkZDpmdW5jdGlvbih0LGUsbixyLGkpe3ZhciBvLGEscyx1LGwsYyxmLHAsZCxoLGcsdj1RLmdldCh0KTtpZih2KXtuLmhhbmRsZXImJihuPShvPW4pLmhhbmRsZXIsaT1vLnNlbGVjdG9yKSxpJiZrLmZpbmQubWF0Y2hlc1NlbGVjdG9yKGllLGkpLG4uZ3VpZHx8KG4uZ3VpZD1rLmd1aWQrKyksKHU9di5ldmVudHMpfHwodT12LmV2ZW50cz17fSksKGE9di5oYW5kbGUpfHwoYT12LmhhbmRsZT1mdW5jdGlvbihlKXtyZXR1cm4idW5kZWZpbmVkIiE9dHlwZW9mIGsmJmsuZXZlbnQudHJpZ2dlcmVkIT09ZS50eXBlP2suZXZlbnQuZGlzcGF0Y2guYXBwbHkodCxhcmd1bWVudHMpOnZvaWQgMH0pLGw9KGU9KGV8fCIiKS5tYXRjaChSKXx8WyIiXSkubGVuZ3RoO3doaWxlKGwtLSlkPWc9KHM9RWUuZXhlYyhlW2xdKXx8W10pWzFdLGg9KHNbMl18fCIiKS5zcGxpdCgiLiIpLnNvcnQoKSxkJiYoZj1rLmV2ZW50LnNwZWNpYWxbZF18fHt9LGQ9KGk/Zi5kZWxlZ2F0ZVR5cGU6Zi5iaW5kVHlwZSl8fGQsZj1rLmV2ZW50LnNwZWNpYWxbZF18fHt9LGM9ay5leHRlbmQoe3R5cGU6ZCxvcmlnVHlwZTpnLGRhdGE6cixoYW5kbGVyOm4sZ3VpZDpuLmd1aWQsc2VsZWN0b3I6aSxuZWVkc0NvbnRleHQ6aSYmay5leHByLm1hdGNoLm5lZWRzQ29udGV4dC50ZXN0KGkpLG5hbWVzcGFjZTpoLmpvaW4oIi4iKX0sbyksKHA9dVtkXSl8fCgocD11W2RdPVtdKS5kZWxlZ2F0ZUNvdW50PTAsZi5zZXR1cCYmITEhPT1mLnNldHVwLmNhbGwodCxyLGgsYSl8fHQuYWRkRXZlbnRMaXN0ZW5lciYmdC5hZGRFdmVudExpc3RlbmVyKGQsYSkpLGYuYWRkJiYoZi5hZGQuY2FsbCh0LGMpLGMuaGFuZGxlci5ndWlkfHwoYy5oYW5kbGVyLmd1aWQ9bi5ndWlkKSksaT9wLnNwbGljZShwLmRlbGVnYXRlQ291bnQrKywwLGMpOnAucHVzaChjKSxrLmV2ZW50Lmdsb2JhbFtkXT0hMCl9fSxyZW1vdmU6ZnVuY3Rpb24oZSx0LG4scixpKXt2YXIgbyxhLHMsdSxsLGMsZixwLGQsaCxnLHY9US5oYXNEYXRhKGUpJiZRLmdldChlKTtpZih2JiYodT12LmV2ZW50cykpe2w9KHQ9KHR8fCIiKS5tYXRjaChSKXx8WyIiXSkubGVuZ3RoO3doaWxlKGwtLSlpZihkPWc9KHM9RWUuZXhlYyh0W2xdKXx8W10pWzFdLGg9KHNbMl18fCIiKS5zcGxpdCgiLiIpLnNvcnQoKSxkKXtmPWsuZXZlbnQuc3BlY2lhbFtkXXx8e30scD11W2Q9KHI/Zi5kZWxlZ2F0ZVR5cGU6Zi5iaW5kVHlwZSl8fGRdfHxbXSxzPXNbMl0mJm5ldyBSZWdFeHAoIihefFxcLikiK2guam9pbigiXFwuKD86LipcXC58KSIpKyIoXFwufCQpIiksYT1vPXAubGVuZ3RoO3doaWxlKG8tLSljPXBbb10sIWkmJmchPT1jLm9yaWdUeXBlfHxuJiZuLmd1aWQhPT1jLmd1aWR8fHMmJiFzLnRlc3QoYy5uYW1lc3BhY2UpfHxyJiZyIT09Yy5zZWxlY3RvciYmKCIqKiIhPT1yfHwhYy5zZWxlY3Rvcil8fChwLnNwbGljZShvLDEpLGMuc2VsZWN0b3ImJnAuZGVsZWdhdGVDb3VudC0tLGYucmVtb3ZlJiZmLnJlbW92ZS5jYWxsKGUsYykpO2EmJiFwLmxlbmd0aCYmKGYudGVhcmRvd24mJiExIT09Zi50ZWFyZG93bi5jYWxsKGUsaCx2LmhhbmRsZSl8fGsucmVtb3ZlRXZlbnQoZSxkLHYuaGFuZGxlKSxkZWxldGUgdVtkXSl9ZWxzZSBmb3IoZCBpbiB1KWsuZXZlbnQucmVtb3ZlKGUsZCt0W2xdLG4sciwhMCk7ay5pc0VtcHR5T2JqZWN0KHUpJiZRLnJlbW92ZShlLCJoYW5kbGUgZXZlbnRzIil9fSxkaXNwYXRjaDpmdW5jdGlvbihlKXt2YXIgdCxuLHIsaSxvLGEscz1rLmV2ZW50LmZpeChlKSx1PW5ldyBBcnJheShhcmd1bWVudHMubGVuZ3RoKSxsPShRLmdldCh0aGlzLCJldmVudHMiKXx8e30pW3MudHlwZV18fFtdLGM9ay5ldmVudC5zcGVjaWFsW3MudHlwZV18fHt9O2Zvcih1WzBdPXMsdD0xO3Q8YXJndW1lbnRzLmxlbmd0aDt0KyspdVt0XT1hcmd1bWVudHNbdF07aWYocy5kZWxlZ2F0ZVRhcmdldD10aGlzLCFjLnByZURpc3BhdGNofHwhMSE9PWMucHJlRGlzcGF0Y2guY2FsbCh0aGlzLHMpKXthPWsuZXZlbnQuaGFuZGxlcnMuY2FsbCh0aGlzLHMsbCksdD0wO3doaWxlKChpPWFbdCsrXSkmJiFzLmlzUHJvcGFnYXRpb25TdG9wcGVkKCkpe3MuY3VycmVudFRhcmdldD1pLmVsZW0sbj0wO3doaWxlKChvPWkuaGFuZGxlcnNbbisrXSkmJiFzLmlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkKCkpcy5ybmFtZXNwYWNlJiYhMSE9PW8ubmFtZXNwYWNlJiYhcy5ybmFtZXNwYWNlLnRlc3Qoby5uYW1lc3BhY2UpfHwocy5oYW5kbGVPYmo9byxzLmRhdGE9by5kYXRhLHZvaWQgMCE9PShyPSgoay5ldmVudC5zcGVjaWFsW28ub3JpZ1R5cGVdfHx7fSkuaGFuZGxlfHxvLmhhbmRsZXIpLmFwcGx5KGkuZWxlbSx1KSkmJiExPT09KHMucmVzdWx0PXIpJiYocy5wcmV2ZW50RGVmYXVsdCgpLHMuc3RvcFByb3BhZ2F0aW9uKCkpKX1yZXR1cm4gYy5wb3N0RGlzcGF0Y2gmJmMucG9zdERpc3BhdGNoLmNhbGwodGhpcyxzKSxzLnJlc3VsdH19LGhhbmRsZXJzOmZ1bmN0aW9uKGUsdCl7dmFyIG4scixpLG8sYSxzPVtdLHU9dC5kZWxlZ2F0ZUNvdW50LGw9ZS50YXJnZXQ7aWYodSYmbC5ub2RlVHlwZSYmISgiY2xpY2siPT09ZS50eXBlJiYxPD1lLmJ1dHRvbikpZm9yKDtsIT09dGhpcztsPWwucGFyZW50Tm9kZXx8dGhpcylpZigxPT09bC5ub2RlVHlwZSYmKCJjbGljayIhPT1lLnR5cGV8fCEwIT09bC5kaXNhYmxlZCkpe2ZvcihvPVtdLGE9e30sbj0wO248dTtuKyspdm9pZCAwPT09YVtpPShyPXRbbl0pLnNlbGVjdG9yKyIgIl0mJihhW2ldPXIubmVlZHNDb250ZXh0Py0xPGsoaSx0aGlzKS5pbmRleChsKTprLmZpbmQoaSx0aGlzLG51bGwsW2xdKS5sZW5ndGgpLGFbaV0mJm8ucHVzaChyKTtvLmxlbmd0aCYmcy5wdXNoKHtlbGVtOmwsaGFuZGxlcnM6b30pfXJldHVybiBsPXRoaXMsdTx0Lmxlbmd0aCYmcy5wdXNoKHtlbGVtOmwsaGFuZGxlcnM6dC5zbGljZSh1KX0pLHN9LGFkZFByb3A6ZnVuY3Rpb24odCxlKXtPYmplY3QuZGVmaW5lUHJvcGVydHkoay5FdmVudC5wcm90b3R5cGUsdCx7ZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITAsZ2V0Om0oZSk/ZnVuY3Rpb24oKXtpZih0aGlzLm9yaWdpbmFsRXZlbnQpcmV0dXJuIGUodGhpcy5vcmlnaW5hbEV2ZW50KX06ZnVuY3Rpb24oKXtpZih0aGlzLm9yaWdpbmFsRXZlbnQpcmV0dXJuIHRoaXMub3JpZ2luYWxFdmVudFt0XX0sc2V0OmZ1bmN0aW9uKGUpe09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLHQse2VudW1lcmFibGU6ITAsY29uZmlndXJhYmxlOiEwLHdyaXRhYmxlOiEwLHZhbHVlOmV9KX19KX0sZml4OmZ1bmN0aW9uKGUpe3JldHVybiBlW2suZXhwYW5kb10/ZTpuZXcgay5FdmVudChlKX0sc3BlY2lhbDp7bG9hZDp7bm9CdWJibGU6ITB9LGNsaWNrOntzZXR1cDpmdW5jdGlvbihlKXt2YXIgdD10aGlzfHxlO3JldHVybiBwZS50ZXN0KHQudHlwZSkmJnQuY2xpY2smJkEodCwiaW5wdXQiKSYmRGUodCwiY2xpY2siLGtlKSwhMX0sdHJpZ2dlcjpmdW5jdGlvbihlKXt2YXIgdD10aGlzfHxlO3JldHVybiBwZS50ZXN0KHQudHlwZSkmJnQuY2xpY2smJkEodCwiaW5wdXQiKSYmRGUodCwiY2xpY2siKSwhMH0sX2RlZmF1bHQ6ZnVuY3Rpb24oZSl7dmFyIHQ9ZS50YXJnZXQ7cmV0dXJuIHBlLnRlc3QodC50eXBlKSYmdC5jbGljayYmQSh0LCJpbnB1dCIpJiZRLmdldCh0LCJjbGljayIpfHxBKHQsImEiKX19LGJlZm9yZXVubG9hZDp7cG9zdERpc3BhdGNoOmZ1bmN0aW9uKGUpe3ZvaWQgMCE9PWUucmVzdWx0JiZlLm9yaWdpbmFsRXZlbnQmJihlLm9yaWdpbmFsRXZlbnQucmV0dXJuVmFsdWU9ZS5yZXN1bHQpfX19fSxrLnJlbW92ZUV2ZW50PWZ1bmN0aW9uKGUsdCxuKXtlLnJlbW92ZUV2ZW50TGlzdGVuZXImJmUucmVtb3ZlRXZlbnRMaXN0ZW5lcih0LG4pfSxrLkV2ZW50PWZ1bmN0aW9uKGUsdCl7aWYoISh0aGlzIGluc3RhbmNlb2Ygay5FdmVudCkpcmV0dXJuIG5ldyBrLkV2ZW50KGUsdCk7ZSYmZS50eXBlPyh0aGlzLm9yaWdpbmFsRXZlbnQ9ZSx0aGlzLnR5cGU9ZS50eXBlLHRoaXMuaXNEZWZhdWx0UHJldmVudGVkPWUuZGVmYXVsdFByZXZlbnRlZHx8dm9pZCAwPT09ZS5kZWZhdWx0UHJldmVudGVkJiYhMT09PWUucmV0dXJuVmFsdWU/a2U6U2UsdGhpcy50YXJnZXQ9ZS50YXJnZXQmJjM9PT1lLnRhcmdldC5ub2RlVHlwZT9lLnRhcmdldC5wYXJlbnROb2RlOmUudGFyZ2V0LHRoaXMuY3VycmVudFRhcmdldD1lLmN1cnJlbnRUYXJnZXQsdGhpcy5yZWxhdGVkVGFyZ2V0PWUucmVsYXRlZFRhcmdldCk6dGhpcy50eXBlPWUsdCYmay5leHRlbmQodGhpcyx0KSx0aGlzLnRpbWVTdGFtcD1lJiZlLnRpbWVTdGFtcHx8RGF0ZS5ub3coKSx0aGlzW2suZXhwYW5kb109ITB9LGsuRXZlbnQucHJvdG90eXBlPXtjb25zdHJ1Y3RvcjprLkV2ZW50LGlzRGVmYXVsdFByZXZlbnRlZDpTZSxpc1Byb3BhZ2F0aW9uU3RvcHBlZDpTZSxpc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZDpTZSxpc1NpbXVsYXRlZDohMSxwcmV2ZW50RGVmYXVsdDpmdW5jdGlvbigpe3ZhciBlPXRoaXMub3JpZ2luYWxFdmVudDt0aGlzLmlzRGVmYXVsdFByZXZlbnRlZD1rZSxlJiYhdGhpcy5pc1NpbXVsYXRlZCYmZS5wcmV2ZW50RGVmYXVsdCgpfSxzdG9wUHJvcGFnYXRpb246ZnVuY3Rpb24oKXt2YXIgZT10aGlzLm9yaWdpbmFsRXZlbnQ7dGhpcy5pc1Byb3BhZ2F0aW9uU3RvcHBlZD1rZSxlJiYhdGhpcy5pc1NpbXVsYXRlZCYmZS5zdG9wUHJvcGFnYXRpb24oKX0sc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5vcmlnaW5hbEV2ZW50O3RoaXMuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQ9a2UsZSYmIXRoaXMuaXNTaW11bGF0ZWQmJmUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCksdGhpcy5zdG9wUHJvcGFnYXRpb24oKX19LGsuZWFjaCh7YWx0S2V5OiEwLGJ1YmJsZXM6ITAsY2FuY2VsYWJsZTohMCxjaGFuZ2VkVG91Y2hlczohMCxjdHJsS2V5OiEwLGRldGFpbDohMCxldmVudFBoYXNlOiEwLG1ldGFLZXk6ITAscGFnZVg6ITAscGFnZVk6ITAsc2hpZnRLZXk6ITAsdmlldzohMCwiY2hhciI6ITAsY29kZTohMCxjaGFyQ29kZTohMCxrZXk6ITAsa2V5Q29kZTohMCxidXR0b246ITAsYnV0dG9uczohMCxjbGllbnRYOiEwLGNsaWVudFk6ITAsb2Zmc2V0WDohMCxvZmZzZXRZOiEwLHBvaW50ZXJJZDohMCxwb2ludGVyVHlwZTohMCxzY3JlZW5YOiEwLHNjcmVlblk6ITAsdGFyZ2V0VG91Y2hlczohMCx0b0VsZW1lbnQ6ITAsdG91Y2hlczohMCx3aGljaDpmdW5jdGlvbihlKXt2YXIgdD1lLmJ1dHRvbjtyZXR1cm4gbnVsbD09ZS53aGljaCYmVGUudGVzdChlLnR5cGUpP251bGwhPWUuY2hhckNvZGU/ZS5jaGFyQ29kZTplLmtleUNvZGU6IWUud2hpY2gmJnZvaWQgMCE9PXQmJkNlLnRlc3QoZS50eXBlKT8xJnQ/MToyJnQ/Mzo0JnQ/MjowOmUud2hpY2h9fSxrLmV2ZW50LmFkZFByb3ApLGsuZWFjaCh7Zm9jdXM6ImZvY3VzaW4iLGJsdXI6ImZvY3Vzb3V0In0sZnVuY3Rpb24oZSx0KXtrLmV2ZW50LnNwZWNpYWxbZV09e3NldHVwOmZ1bmN0aW9uKCl7cmV0dXJuIERlKHRoaXMsZSxOZSksITF9LHRyaWdnZXI6ZnVuY3Rpb24oKXtyZXR1cm4gRGUodGhpcyxlKSwhMH0sZGVsZWdhdGVUeXBlOnR9fSksay5lYWNoKHttb3VzZWVudGVyOiJtb3VzZW92ZXIiLG1vdXNlbGVhdmU6Im1vdXNlb3V0Iixwb2ludGVyZW50ZXI6InBvaW50ZXJvdmVyIixwb2ludGVybGVhdmU6InBvaW50ZXJvdXQifSxmdW5jdGlvbihlLGkpe2suZXZlbnQuc3BlY2lhbFtlXT17ZGVsZWdhdGVUeXBlOmksYmluZFR5cGU6aSxoYW5kbGU6ZnVuY3Rpb24oZSl7dmFyIHQsbj1lLnJlbGF0ZWRUYXJnZXQscj1lLmhhbmRsZU9iajtyZXR1cm4gbiYmKG49PT10aGlzfHxrLmNvbnRhaW5zKHRoaXMsbikpfHwoZS50eXBlPXIub3JpZ1R5cGUsdD1yLmhhbmRsZXIuYXBwbHkodGhpcyxhcmd1bWVudHMpLGUudHlwZT1pKSx0fX19KSxrLmZuLmV4dGVuZCh7b246ZnVuY3Rpb24oZSx0LG4scil7cmV0dXJuIEFlKHRoaXMsZSx0LG4scil9LG9uZTpmdW5jdGlvbihlLHQsbixyKXtyZXR1cm4gQWUodGhpcyxlLHQsbixyLDEpfSxvZmY6ZnVuY3Rpb24oZSx0LG4pe3ZhciByLGk7aWYoZSYmZS5wcmV2ZW50RGVmYXVsdCYmZS5oYW5kbGVPYmopcmV0dXJuIHI9ZS5oYW5kbGVPYmosayhlLmRlbGVnYXRlVGFyZ2V0KS5vZmYoci5uYW1lc3BhY2U/ci5vcmlnVHlwZSsiLiIrci5uYW1lc3BhY2U6ci5vcmlnVHlwZSxyLnNlbGVjdG9yLHIuaGFuZGxlciksdGhpcztpZigib2JqZWN0Ij09dHlwZW9mIGUpe2ZvcihpIGluIGUpdGhpcy5vZmYoaSx0LGVbaV0pO3JldHVybiB0aGlzfXJldHVybiExIT09dCYmImZ1bmN0aW9uIiE9dHlwZW9mIHR8fChuPXQsdD12b2lkIDApLCExPT09biYmKG49U2UpLHRoaXMuZWFjaChmdW5jdGlvbigpe2suZXZlbnQucmVtb3ZlKHRoaXMsZSxuLHQpfSl9fSk7dmFyIGplPS88KD8hYXJlYXxicnxjb2x8ZW1iZWR8aHJ8aW1nfGlucHV0fGxpbmt8bWV0YXxwYXJhbSkoKFthLXpdW15cL1wwPlx4MjBcdFxyXG5cZl0qKVtePl0qKVwvPi9naSxxZT0vPHNjcmlwdHw8c3R5bGV8PGxpbmsvaSxMZT0vY2hlY2tlZFxzKig/OltePV18PVxzKi5jaGVja2VkLikvaSxIZT0vXlxzKjwhKD86XFtDREFUQVxbfC0tKXwoPzpcXVxdfC0tKT5ccyokL2c7ZnVuY3Rpb24gT2UoZSx0KXtyZXR1cm4gQShlLCJ0YWJsZSIpJiZBKDExIT09dC5ub2RlVHlwZT90OnQuZmlyc3RDaGlsZCwidHIiKSYmayhlKS5jaGlsZHJlbigidGJvZHkiKVswXXx8ZX1mdW5jdGlvbiBQZShlKXtyZXR1cm4gZS50eXBlPShudWxsIT09ZS5nZXRBdHRyaWJ1dGUoInR5cGUiKSkrIi8iK2UudHlwZSxlfWZ1bmN0aW9uIFJlKGUpe3JldHVybiJ0cnVlLyI9PT0oZS50eXBlfHwiIikuc2xpY2UoMCw1KT9lLnR5cGU9ZS50eXBlLnNsaWNlKDUpOmUucmVtb3ZlQXR0cmlidXRlKCJ0eXBlIiksZX1mdW5jdGlvbiBNZShlLHQpe3ZhciBuLHIsaSxvLGEscyx1LGw7aWYoMT09PXQubm9kZVR5cGUpe2lmKFEuaGFzRGF0YShlKSYmKG89US5hY2Nlc3MoZSksYT1RLnNldCh0LG8pLGw9by5ldmVudHMpKWZvcihpIGluIGRlbGV0ZSBhLmhhbmRsZSxhLmV2ZW50cz17fSxsKWZvcihuPTAscj1sW2ldLmxlbmd0aDtuPHI7bisrKWsuZXZlbnQuYWRkKHQsaSxsW2ldW25dKTtKLmhhc0RhdGEoZSkmJihzPUouYWNjZXNzKGUpLHU9ay5leHRlbmQoe30scyksSi5zZXQodCx1KSl9fWZ1bmN0aW9uIEllKG4scixpLG8pe3I9Zy5hcHBseShbXSxyKTt2YXIgZSx0LGEscyx1LGwsYz0wLGY9bi5sZW5ndGgscD1mLTEsZD1yWzBdLGg9bShkKTtpZihofHwxPGYmJiJzdHJpbmciPT10eXBlb2YgZCYmIXkuY2hlY2tDbG9uZSYmTGUudGVzdChkKSlyZXR1cm4gbi5lYWNoKGZ1bmN0aW9uKGUpe3ZhciB0PW4uZXEoZSk7aCYmKHJbMF09ZC5jYWxsKHRoaXMsZSx0Lmh0bWwoKSkpLEllKHQscixpLG8pfSk7aWYoZiYmKHQ9KGU9d2UocixuWzBdLm93bmVyRG9jdW1lbnQsITEsbixvKSkuZmlyc3RDaGlsZCwxPT09ZS5jaGlsZE5vZGVzLmxlbmd0aCYmKGU9dCksdHx8bykpe2ZvcihzPShhPWsubWFwKHZlKGUsInNjcmlwdCIpLFBlKSkubGVuZ3RoO2M8ZjtjKyspdT1lLGMhPT1wJiYodT1rLmNsb25lKHUsITAsITApLHMmJmsubWVyZ2UoYSx2ZSh1LCJzY3JpcHQiKSkpLGkuY2FsbChuW2NdLHUsYyk7aWYocylmb3IobD1hW2EubGVuZ3RoLTFdLm93bmVyRG9jdW1lbnQsay5tYXAoYSxSZSksYz0wO2M8cztjKyspdT1hW2NdLGhlLnRlc3QodS50eXBlfHwiIikmJiFRLmFjY2Vzcyh1LCJnbG9iYWxFdmFsIikmJmsuY29udGFpbnMobCx1KSYmKHUuc3JjJiYibW9kdWxlIiE9PSh1LnR5cGV8fCIiKS50b0xvd2VyQ2FzZSgpP2suX2V2YWxVcmwmJiF1Lm5vTW9kdWxlJiZrLl9ldmFsVXJsKHUuc3JjLHtub25jZTp1Lm5vbmNlfHx1LmdldEF0dHJpYnV0ZSgibm9uY2UiKX0pOmIodS50ZXh0Q29udGVudC5yZXBsYWNlKEhlLCIiKSx1LGwpKX1yZXR1cm4gbn1mdW5jdGlvbiBXZShlLHQsbil7Zm9yKHZhciByLGk9dD9rLmZpbHRlcih0LGUpOmUsbz0wO251bGwhPShyPWlbb10pO28rKylufHwxIT09ci5ub2RlVHlwZXx8ay5jbGVhbkRhdGEodmUocikpLHIucGFyZW50Tm9kZSYmKG4mJm9lKHIpJiZ5ZSh2ZShyLCJzY3JpcHQiKSksci5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHIpKTtyZXR1cm4gZX1rLmV4dGVuZCh7aHRtbFByZWZpbHRlcjpmdW5jdGlvbihlKXtyZXR1cm4gZS5yZXBsYWNlKGplLCI8JDE+PC8kMj4iKX0sY2xvbmU6ZnVuY3Rpb24oZSx0LG4pe3ZhciByLGksbyxhLHMsdSxsLGM9ZS5jbG9uZU5vZGUoITApLGY9b2UoZSk7aWYoISh5Lm5vQ2xvbmVDaGVja2VkfHwxIT09ZS5ub2RlVHlwZSYmMTEhPT1lLm5vZGVUeXBlfHxrLmlzWE1MRG9jKGUpKSlmb3IoYT12ZShjKSxyPTAsaT0obz12ZShlKSkubGVuZ3RoO3I8aTtyKyspcz1vW3JdLHU9YVtyXSx2b2lkIDAsImlucHV0Ij09PShsPXUubm9kZU5hbWUudG9Mb3dlckNhc2UoKSkmJnBlLnRlc3Qocy50eXBlKT91LmNoZWNrZWQ9cy5jaGVja2VkOiJpbnB1dCIhPT1sJiYidGV4dGFyZWEiIT09bHx8KHUuZGVmYXVsdFZhbHVlPXMuZGVmYXVsdFZhbHVlKTtpZih0KWlmKG4pZm9yKG89b3x8dmUoZSksYT1hfHx2ZShjKSxyPTAsaT1vLmxlbmd0aDtyPGk7cisrKU1lKG9bcl0sYVtyXSk7ZWxzZSBNZShlLGMpO3JldHVybiAwPChhPXZlKGMsInNjcmlwdCIpKS5sZW5ndGgmJnllKGEsIWYmJnZlKGUsInNjcmlwdCIpKSxjfSxjbGVhbkRhdGE6ZnVuY3Rpb24oZSl7Zm9yKHZhciB0LG4scixpPWsuZXZlbnQuc3BlY2lhbCxvPTA7dm9pZCAwIT09KG49ZVtvXSk7bysrKWlmKEcobikpe2lmKHQ9bltRLmV4cGFuZG9dKXtpZih0LmV2ZW50cylmb3IociBpbiB0LmV2ZW50cylpW3JdP2suZXZlbnQucmVtb3ZlKG4scik6ay5yZW1vdmVFdmVudChuLHIsdC5oYW5kbGUpO25bUS5leHBhbmRvXT12b2lkIDB9bltKLmV4cGFuZG9dJiYobltKLmV4cGFuZG9dPXZvaWQgMCl9fX0pLGsuZm4uZXh0ZW5kKHtkZXRhY2g6ZnVuY3Rpb24oZSl7cmV0dXJuIFdlKHRoaXMsZSwhMCl9LHJlbW92ZTpmdW5jdGlvbihlKXtyZXR1cm4gV2UodGhpcyxlKX0sdGV4dDpmdW5jdGlvbihlKXtyZXR1cm4gXyh0aGlzLGZ1bmN0aW9uKGUpe3JldHVybiB2b2lkIDA9PT1lP2sudGV4dCh0aGlzKTp0aGlzLmVtcHR5KCkuZWFjaChmdW5jdGlvbigpezEhPT10aGlzLm5vZGVUeXBlJiYxMSE9PXRoaXMubm9kZVR5cGUmJjkhPT10aGlzLm5vZGVUeXBlfHwodGhpcy50ZXh0Q29udGVudD1lKX0pfSxudWxsLGUsYXJndW1lbnRzLmxlbmd0aCl9LGFwcGVuZDpmdW5jdGlvbigpe3JldHVybiBJZSh0aGlzLGFyZ3VtZW50cyxmdW5jdGlvbihlKXsxIT09dGhpcy5ub2RlVHlwZSYmMTEhPT10aGlzLm5vZGVUeXBlJiY5IT09dGhpcy5ub2RlVHlwZXx8T2UodGhpcyxlKS5hcHBlbmRDaGlsZChlKX0pfSxwcmVwZW5kOmZ1bmN0aW9uKCl7cmV0dXJuIEllKHRoaXMsYXJndW1lbnRzLGZ1bmN0aW9uKGUpe2lmKDE9PT10aGlzLm5vZGVUeXBlfHwxMT09PXRoaXMubm9kZVR5cGV8fDk9PT10aGlzLm5vZGVUeXBlKXt2YXIgdD1PZSh0aGlzLGUpO3QuaW5zZXJ0QmVmb3JlKGUsdC5maXJzdENoaWxkKX19KX0sYmVmb3JlOmZ1bmN0aW9uKCl7cmV0dXJuIEllKHRoaXMsYXJndW1lbnRzLGZ1bmN0aW9uKGUpe3RoaXMucGFyZW50Tm9kZSYmdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShlLHRoaXMpfSl9LGFmdGVyOmZ1bmN0aW9uKCl7cmV0dXJuIEllKHRoaXMsYXJndW1lbnRzLGZ1bmN0aW9uKGUpe3RoaXMucGFyZW50Tm9kZSYmdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShlLHRoaXMubmV4dFNpYmxpbmcpfSl9LGVtcHR5OmZ1bmN0aW9uKCl7Zm9yKHZhciBlLHQ9MDtudWxsIT0oZT10aGlzW3RdKTt0KyspMT09PWUubm9kZVR5cGUmJihrLmNsZWFuRGF0YSh2ZShlLCExKSksZS50ZXh0Q29udGVudD0iIik7cmV0dXJuIHRoaXN9LGNsb25lOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIGU9bnVsbCE9ZSYmZSx0PW51bGw9PXQ/ZTp0LHRoaXMubWFwKGZ1bmN0aW9uKCl7cmV0dXJuIGsuY2xvbmUodGhpcyxlLHQpfSl9LGh0bWw6ZnVuY3Rpb24oZSl7cmV0dXJuIF8odGhpcyxmdW5jdGlvbihlKXt2YXIgdD10aGlzWzBdfHx7fSxuPTAscj10aGlzLmxlbmd0aDtpZih2b2lkIDA9PT1lJiYxPT09dC5ub2RlVHlwZSlyZXR1cm4gdC5pbm5lckhUTUw7aWYoInN0cmluZyI9PXR5cGVvZiBlJiYhcWUudGVzdChlKSYmIWdlWyhkZS5leGVjKGUpfHxbIiIsIiJdKVsxXS50b0xvd2VyQ2FzZSgpXSl7ZT1rLmh0bWxQcmVmaWx0ZXIoZSk7dHJ5e2Zvcig7bjxyO24rKykxPT09KHQ9dGhpc1tuXXx8e30pLm5vZGVUeXBlJiYoay5jbGVhbkRhdGEodmUodCwhMSkpLHQuaW5uZXJIVE1MPWUpO3Q9MH1jYXRjaChlKXt9fXQmJnRoaXMuZW1wdHkoKS5hcHBlbmQoZSl9LG51bGwsZSxhcmd1bWVudHMubGVuZ3RoKX0scmVwbGFjZVdpdGg6ZnVuY3Rpb24oKXt2YXIgbj1bXTtyZXR1cm4gSWUodGhpcyxhcmd1bWVudHMsZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5wYXJlbnROb2RlO2suaW5BcnJheSh0aGlzLG4pPDAmJihrLmNsZWFuRGF0YSh2ZSh0aGlzKSksdCYmdC5yZXBsYWNlQ2hpbGQoZSx0aGlzKSl9LG4pfX0pLGsuZWFjaCh7YXBwZW5kVG86ImFwcGVuZCIscHJlcGVuZFRvOiJwcmVwZW5kIixpbnNlcnRCZWZvcmU6ImJlZm9yZSIsaW5zZXJ0QWZ0ZXI6ImFmdGVyIixyZXBsYWNlQWxsOiJyZXBsYWNlV2l0aCJ9LGZ1bmN0aW9uKGUsYSl7ay5mbltlXT1mdW5jdGlvbihlKXtmb3IodmFyIHQsbj1bXSxyPWsoZSksaT1yLmxlbmd0aC0xLG89MDtvPD1pO28rKyl0PW89PT1pP3RoaXM6dGhpcy5jbG9uZSghMCksayhyW29dKVthXSh0KSx1LmFwcGx5KG4sdC5nZXQoKSk7cmV0dXJuIHRoaXMucHVzaFN0YWNrKG4pfX0pO3ZhciAkZT1uZXcgUmVnRXhwKCJeKCIrdGUrIikoPyFweClbYS16JV0rJCIsImkiKSxGZT1mdW5jdGlvbihlKXt2YXIgdD1lLm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXc7cmV0dXJuIHQmJnQub3BlbmVyfHwodD1DKSx0LmdldENvbXB1dGVkU3R5bGUoZSl9LEJlPW5ldyBSZWdFeHAocmUuam9pbigifCIpLCJpIik7ZnVuY3Rpb24gX2UoZSx0LG4pe3ZhciByLGksbyxhLHM9ZS5zdHlsZTtyZXR1cm4obj1ufHxGZShlKSkmJigiIiE9PShhPW4uZ2V0UHJvcGVydHlWYWx1ZSh0KXx8blt0XSl8fG9lKGUpfHwoYT1rLnN0eWxlKGUsdCkpLCF5LnBpeGVsQm94U3R5bGVzKCkmJiRlLnRlc3QoYSkmJkJlLnRlc3QodCkmJihyPXMud2lkdGgsaT1zLm1pbldpZHRoLG89cy5tYXhXaWR0aCxzLm1pbldpZHRoPXMubWF4V2lkdGg9cy53aWR0aD1hLGE9bi53aWR0aCxzLndpZHRoPXIscy5taW5XaWR0aD1pLHMubWF4V2lkdGg9bykpLHZvaWQgMCE9PWE/YSsiIjphfWZ1bmN0aW9uIHplKGUsdCl7cmV0dXJue2dldDpmdW5jdGlvbigpe2lmKCFlKCkpcmV0dXJuKHRoaXMuZ2V0PXQpLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtkZWxldGUgdGhpcy5nZXR9fX0hZnVuY3Rpb24oKXtmdW5jdGlvbiBlKCl7aWYodSl7cy5zdHlsZS5jc3NUZXh0PSJwb3NpdGlvbjphYnNvbHV0ZTtsZWZ0Oi0xMTExMXB4O3dpZHRoOjYwcHg7bWFyZ2luLXRvcDoxcHg7cGFkZGluZzowO2JvcmRlcjowIix1LnN0eWxlLmNzc1RleHQ9InBvc2l0aW9uOnJlbGF0aXZlO2Rpc3BsYXk6YmxvY2s7Ym94LXNpemluZzpib3JkZXItYm94O292ZXJmbG93OnNjcm9sbDttYXJnaW46YXV0bztib3JkZXI6MXB4O3BhZGRpbmc6MXB4O3dpZHRoOjYwJTt0b3A6MSUiLGllLmFwcGVuZENoaWxkKHMpLmFwcGVuZENoaWxkKHUpO3ZhciBlPUMuZ2V0Q29tcHV0ZWRTdHlsZSh1KTtuPSIxJSIhPT1lLnRvcCxhPTEyPT09dChlLm1hcmdpbkxlZnQpLHUuc3R5bGUucmlnaHQ9IjYwJSIsbz0zNj09PXQoZS5yaWdodCkscj0zNj09PXQoZS53aWR0aCksdS5zdHlsZS5wb3NpdGlvbj0iYWJzb2x1dGUiLGk9MTI9PT10KHUub2Zmc2V0V2lkdGgvMyksaWUucmVtb3ZlQ2hpbGQocyksdT1udWxsfX1mdW5jdGlvbiB0KGUpe3JldHVybiBNYXRoLnJvdW5kKHBhcnNlRmxvYXQoZSkpfXZhciBuLHIsaSxvLGEscz1FLmNyZWF0ZUVsZW1lbnQoImRpdiIpLHU9RS5jcmVhdGVFbGVtZW50KCJkaXYiKTt1LnN0eWxlJiYodS5zdHlsZS5iYWNrZ3JvdW5kQ2xpcD0iY29udGVudC1ib3giLHUuY2xvbmVOb2RlKCEwKS5zdHlsZS5iYWNrZ3JvdW5kQ2xpcD0iIix5LmNsZWFyQ2xvbmVTdHlsZT0iY29udGVudC1ib3giPT09dS5zdHlsZS5iYWNrZ3JvdW5kQ2xpcCxrLmV4dGVuZCh5LHtib3hTaXppbmdSZWxpYWJsZTpmdW5jdGlvbigpe3JldHVybiBlKCkscn0scGl4ZWxCb3hTdHlsZXM6ZnVuY3Rpb24oKXtyZXR1cm4gZSgpLG99LHBpeGVsUG9zaXRpb246ZnVuY3Rpb24oKXtyZXR1cm4gZSgpLG59LHJlbGlhYmxlTWFyZ2luTGVmdDpmdW5jdGlvbigpe3JldHVybiBlKCksYX0sc2Nyb2xsYm94U2l6ZTpmdW5jdGlvbigpe3JldHVybiBlKCksaX19KSl9KCk7dmFyIFVlPVsiV2Via2l0IiwiTW96IiwibXMiXSxYZT1FLmNyZWF0ZUVsZW1lbnQoImRpdiIpLnN0eWxlLFZlPXt9O2Z1bmN0aW9uIEdlKGUpe3ZhciB0PWsuY3NzUHJvcHNbZV18fFZlW2VdO3JldHVybiB0fHwoZSBpbiBYZT9lOlZlW2VdPWZ1bmN0aW9uKGUpe3ZhciB0PWVbMF0udG9VcHBlckNhc2UoKStlLnNsaWNlKDEpLG49VWUubGVuZ3RoO3doaWxlKG4tLSlpZigoZT1VZVtuXSt0KWluIFhlKXJldHVybiBlfShlKXx8ZSl9dmFyIFllPS9eKG5vbmV8dGFibGUoPyEtY1tlYV0pLispLyxRZT0vXi0tLyxKZT17cG9zaXRpb246ImFic29sdXRlIix2aXNpYmlsaXR5OiJoaWRkZW4iLGRpc3BsYXk6ImJsb2NrIn0sS2U9e2xldHRlclNwYWNpbmc6IjAiLGZvbnRXZWlnaHQ6IjQwMCJ9O2Z1bmN0aW9uIFplKGUsdCxuKXt2YXIgcj1uZS5leGVjKHQpO3JldHVybiByP01hdGgubWF4KDAsclsyXS0obnx8MCkpKyhyWzNdfHwicHgiKTp0fWZ1bmN0aW9uIGV0KGUsdCxuLHIsaSxvKXt2YXIgYT0id2lkdGgiPT09dD8xOjAscz0wLHU9MDtpZihuPT09KHI/ImJvcmRlciI6ImNvbnRlbnQiKSlyZXR1cm4gMDtmb3IoO2E8NDthKz0yKSJtYXJnaW4iPT09biYmKHUrPWsuY3NzKGUsbityZVthXSwhMCxpKSkscj8oImNvbnRlbnQiPT09biYmKHUtPWsuY3NzKGUsInBhZGRpbmciK3JlW2FdLCEwLGkpKSwibWFyZ2luIiE9PW4mJih1LT1rLmNzcyhlLCJib3JkZXIiK3JlW2FdKyJXaWR0aCIsITAsaSkpKToodSs9ay5jc3MoZSwicGFkZGluZyIrcmVbYV0sITAsaSksInBhZGRpbmciIT09bj91Kz1rLmNzcyhlLCJib3JkZXIiK3JlW2FdKyJXaWR0aCIsITAsaSk6cys9ay5jc3MoZSwiYm9yZGVyIityZVthXSsiV2lkdGgiLCEwLGkpKTtyZXR1cm4hciYmMDw9byYmKHUrPU1hdGgubWF4KDAsTWF0aC5jZWlsKGVbIm9mZnNldCIrdFswXS50b1VwcGVyQ2FzZSgpK3Quc2xpY2UoMSldLW8tdS1zLS41KSl8fDApLHV9ZnVuY3Rpb24gdHQoZSx0LG4pe3ZhciByPUZlKGUpLGk9KCF5LmJveFNpemluZ1JlbGlhYmxlKCl8fG4pJiYiYm9yZGVyLWJveCI9PT1rLmNzcyhlLCJib3hTaXppbmciLCExLHIpLG89aSxhPV9lKGUsdCxyKSxzPSJvZmZzZXQiK3RbMF0udG9VcHBlckNhc2UoKSt0LnNsaWNlKDEpO2lmKCRlLnRlc3QoYSkpe2lmKCFuKXJldHVybiBhO2E9ImF1dG8ifXJldHVybigheS5ib3hTaXppbmdSZWxpYWJsZSgpJiZpfHwiYXV0byI9PT1hfHwhcGFyc2VGbG9hdChhKSYmImlubGluZSI9PT1rLmNzcyhlLCJkaXNwbGF5IiwhMSxyKSkmJmUuZ2V0Q2xpZW50UmVjdHMoKS5sZW5ndGgmJihpPSJib3JkZXItYm94Ij09PWsuY3NzKGUsImJveFNpemluZyIsITEsciksKG89cyBpbiBlKSYmKGE9ZVtzXSkpLChhPXBhcnNlRmxvYXQoYSl8fDApK2V0KGUsdCxufHwoaT8iYm9yZGVyIjoiY29udGVudCIpLG8scixhKSsicHgifWZ1bmN0aW9uIG50KGUsdCxuLHIsaSl7cmV0dXJuIG5ldyBudC5wcm90b3R5cGUuaW5pdChlLHQsbixyLGkpfWsuZXh0ZW5kKHtjc3NIb29rczp7b3BhY2l0eTp7Z2V0OmZ1bmN0aW9uKGUsdCl7aWYodCl7dmFyIG49X2UoZSwib3BhY2l0eSIpO3JldHVybiIiPT09bj8iMSI6bn19fX0sY3NzTnVtYmVyOnthbmltYXRpb25JdGVyYXRpb25Db3VudDohMCxjb2x1bW5Db3VudDohMCxmaWxsT3BhY2l0eTohMCxmbGV4R3JvdzohMCxmbGV4U2hyaW5rOiEwLGZvbnRXZWlnaHQ6ITAsZ3JpZEFyZWE6ITAsZ3JpZENvbHVtbjohMCxncmlkQ29sdW1uRW5kOiEwLGdyaWRDb2x1bW5TdGFydDohMCxncmlkUm93OiEwLGdyaWRSb3dFbmQ6ITAsZ3JpZFJvd1N0YXJ0OiEwLGxpbmVIZWlnaHQ6ITAsb3BhY2l0eTohMCxvcmRlcjohMCxvcnBoYW5zOiEwLHdpZG93czohMCx6SW5kZXg6ITAsem9vbTohMH0sY3NzUHJvcHM6e30sc3R5bGU6ZnVuY3Rpb24oZSx0LG4scil7aWYoZSYmMyE9PWUubm9kZVR5cGUmJjghPT1lLm5vZGVUeXBlJiZlLnN0eWxlKXt2YXIgaSxvLGEscz1WKHQpLHU9UWUudGVzdCh0KSxsPWUuc3R5bGU7aWYodXx8KHQ9R2UocykpLGE9ay5jc3NIb29rc1t0XXx8ay5jc3NIb29rc1tzXSx2b2lkIDA9PT1uKXJldHVybiBhJiYiZ2V0ImluIGEmJnZvaWQgMCE9PShpPWEuZ2V0KGUsITEscikpP2k6bFt0XTsic3RyaW5nIj09PShvPXR5cGVvZiBuKSYmKGk9bmUuZXhlYyhuKSkmJmlbMV0mJihuPWxlKGUsdCxpKSxvPSJudW1iZXIiKSxudWxsIT1uJiZuPT1uJiYoIm51bWJlciIhPT1vfHx1fHwobis9aSYmaVszXXx8KGsuY3NzTnVtYmVyW3NdPyIiOiJweCIpKSx5LmNsZWFyQ2xvbmVTdHlsZXx8IiIhPT1ufHwwIT09dC5pbmRleE9mKCJiYWNrZ3JvdW5kIil8fChsW3RdPSJpbmhlcml0IiksYSYmInNldCJpbiBhJiZ2b2lkIDA9PT0obj1hLnNldChlLG4scikpfHwodT9sLnNldFByb3BlcnR5KHQsbik6bFt0XT1uKSl9fSxjc3M6ZnVuY3Rpb24oZSx0LG4scil7dmFyIGksbyxhLHM9Vih0KTtyZXR1cm4gUWUudGVzdCh0KXx8KHQ9R2UocykpLChhPWsuY3NzSG9va3NbdF18fGsuY3NzSG9va3Nbc10pJiYiZ2V0ImluIGEmJihpPWEuZ2V0KGUsITAsbikpLHZvaWQgMD09PWkmJihpPV9lKGUsdCxyKSksIm5vcm1hbCI9PT1pJiZ0IGluIEtlJiYoaT1LZVt0XSksIiI9PT1ufHxuPyhvPXBhcnNlRmxvYXQoaSksITA9PT1ufHxpc0Zpbml0ZShvKT9vfHwwOmkpOml9fSksay5lYWNoKFsiaGVpZ2h0Iiwid2lkdGgiXSxmdW5jdGlvbihlLHUpe2suY3NzSG9va3NbdV09e2dldDpmdW5jdGlvbihlLHQsbil7aWYodClyZXR1cm4hWWUudGVzdChrLmNzcyhlLCJkaXNwbGF5IikpfHxlLmdldENsaWVudFJlY3RzKCkubGVuZ3RoJiZlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoP3R0KGUsdSxuKTp1ZShlLEplLGZ1bmN0aW9uKCl7cmV0dXJuIHR0KGUsdSxuKX0pfSxzZXQ6ZnVuY3Rpb24oZSx0LG4pe3ZhciByLGk9RmUoZSksbz0heS5zY3JvbGxib3hTaXplKCkmJiJhYnNvbHV0ZSI9PT1pLnBvc2l0aW9uLGE9KG98fG4pJiYiYm9yZGVyLWJveCI9PT1rLmNzcyhlLCJib3hTaXppbmciLCExLGkpLHM9bj9ldChlLHUsbixhLGkpOjA7cmV0dXJuIGEmJm8mJihzLT1NYXRoLmNlaWwoZVsib2Zmc2V0Iit1WzBdLnRvVXBwZXJDYXNlKCkrdS5zbGljZSgxKV0tcGFyc2VGbG9hdChpW3VdKS1ldChlLHUsImJvcmRlciIsITEsaSktLjUpKSxzJiYocj1uZS5leGVjKHQpKSYmInB4IiE9PShyWzNdfHwicHgiKSYmKGUuc3R5bGVbdV09dCx0PWsuY3NzKGUsdSkpLFplKDAsdCxzKX19fSksay5jc3NIb29rcy5tYXJnaW5MZWZ0PXplKHkucmVsaWFibGVNYXJnaW5MZWZ0LGZ1bmN0aW9uKGUsdCl7aWYodClyZXR1cm4ocGFyc2VGbG9hdChfZShlLCJtYXJnaW5MZWZ0IikpfHxlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQtdWUoZSx7bWFyZ2luTGVmdDowfSxmdW5jdGlvbigpe3JldHVybiBlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnR9KSkrInB4In0pLGsuZWFjaCh7bWFyZ2luOiIiLHBhZGRpbmc6IiIsYm9yZGVyOiJXaWR0aCJ9LGZ1bmN0aW9uKGksbyl7ay5jc3NIb29rc1tpK29dPXtleHBhbmQ6ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PTAsbj17fSxyPSJzdHJpbmciPT10eXBlb2YgZT9lLnNwbGl0KCIgIik6W2VdO3Q8NDt0KyspbltpK3JlW3RdK29dPXJbdF18fHJbdC0yXXx8clswXTtyZXR1cm4gbn19LCJtYXJnaW4iIT09aSYmKGsuY3NzSG9va3NbaStvXS5zZXQ9WmUpfSksay5mbi5leHRlbmQoe2NzczpmdW5jdGlvbihlLHQpe3JldHVybiBfKHRoaXMsZnVuY3Rpb24oZSx0LG4pe3ZhciByLGksbz17fSxhPTA7aWYoQXJyYXkuaXNBcnJheSh0KSl7Zm9yKHI9RmUoZSksaT10Lmxlbmd0aDthPGk7YSsrKW9bdFthXV09ay5jc3MoZSx0W2FdLCExLHIpO3JldHVybiBvfXJldHVybiB2b2lkIDAhPT1uP2suc3R5bGUoZSx0LG4pOmsuY3NzKGUsdCl9LGUsdCwxPGFyZ3VtZW50cy5sZW5ndGgpfX0pLCgoay5Ud2Vlbj1udCkucHJvdG90eXBlPXtjb25zdHJ1Y3RvcjpudCxpbml0OmZ1bmN0aW9uKGUsdCxuLHIsaSxvKXt0aGlzLmVsZW09ZSx0aGlzLnByb3A9bix0aGlzLmVhc2luZz1pfHxrLmVhc2luZy5fZGVmYXVsdCx0aGlzLm9wdGlvbnM9dCx0aGlzLnN0YXJ0PXRoaXMubm93PXRoaXMuY3VyKCksdGhpcy5lbmQ9cix0aGlzLnVuaXQ9b3x8KGsuY3NzTnVtYmVyW25dPyIiOiJweCIpfSxjdXI6ZnVuY3Rpb24oKXt2YXIgZT1udC5wcm9wSG9va3NbdGhpcy5wcm9wXTtyZXR1cm4gZSYmZS5nZXQ/ZS5nZXQodGhpcyk6bnQucHJvcEhvb2tzLl9kZWZhdWx0LmdldCh0aGlzKX0scnVuOmZ1bmN0aW9uKGUpe3ZhciB0LG49bnQucHJvcEhvb2tzW3RoaXMucHJvcF07cmV0dXJuIHRoaXMub3B0aW9ucy5kdXJhdGlvbj90aGlzLnBvcz10PWsuZWFzaW5nW3RoaXMuZWFzaW5nXShlLHRoaXMub3B0aW9ucy5kdXJhdGlvbiplLDAsMSx0aGlzLm9wdGlvbnMuZHVyYXRpb24pOnRoaXMucG9zPXQ9ZSx0aGlzLm5vdz0odGhpcy5lbmQtdGhpcy5zdGFydCkqdCt0aGlzLnN0YXJ0LHRoaXMub3B0aW9ucy5zdGVwJiZ0aGlzLm9wdGlvbnMuc3RlcC5jYWxsKHRoaXMuZWxlbSx0aGlzLm5vdyx0aGlzKSxuJiZuLnNldD9uLnNldCh0aGlzKTpudC5wcm9wSG9va3MuX2RlZmF1bHQuc2V0KHRoaXMpLHRoaXN9fSkuaW5pdC5wcm90b3R5cGU9bnQucHJvdG90eXBlLChudC5wcm9wSG9va3M9e19kZWZhdWx0OntnZXQ6ZnVuY3Rpb24oZSl7dmFyIHQ7cmV0dXJuIDEhPT1lLmVsZW0ubm9kZVR5cGV8fG51bGwhPWUuZWxlbVtlLnByb3BdJiZudWxsPT1lLmVsZW0uc3R5bGVbZS5wcm9wXT9lLmVsZW1bZS5wcm9wXToodD1rLmNzcyhlLmVsZW0sZS5wcm9wLCIiKSkmJiJhdXRvIiE9PXQ/dDowfSxzZXQ6ZnVuY3Rpb24oZSl7ay5meC5zdGVwW2UucHJvcF0/ay5meC5zdGVwW2UucHJvcF0oZSk6MSE9PWUuZWxlbS5ub2RlVHlwZXx8IWsuY3NzSG9va3NbZS5wcm9wXSYmbnVsbD09ZS5lbGVtLnN0eWxlW0dlKGUucHJvcCldP2UuZWxlbVtlLnByb3BdPWUubm93Omsuc3R5bGUoZS5lbGVtLGUucHJvcCxlLm5vdytlLnVuaXQpfX19KS5zY3JvbGxUb3A9bnQucHJvcEhvb2tzLnNjcm9sbExlZnQ9e3NldDpmdW5jdGlvbihlKXtlLmVsZW0ubm9kZVR5cGUmJmUuZWxlbS5wYXJlbnROb2RlJiYoZS5lbGVtW2UucHJvcF09ZS5ub3cpfX0say5lYXNpbmc9e2xpbmVhcjpmdW5jdGlvbihlKXtyZXR1cm4gZX0sc3dpbmc6ZnVuY3Rpb24oZSl7cmV0dXJuLjUtTWF0aC5jb3MoZSpNYXRoLlBJKS8yfSxfZGVmYXVsdDoic3dpbmcifSxrLmZ4PW50LnByb3RvdHlwZS5pbml0LGsuZnguc3RlcD17fTt2YXIgcnQsaXQsb3QsYXQsc3Q9L14oPzp0b2dnbGV8c2hvd3xoaWRlKSQvLHV0PS9xdWV1ZUhvb2tzJC87ZnVuY3Rpb24gbHQoKXtpdCYmKCExPT09RS5oaWRkZW4mJkMucmVxdWVzdEFuaW1hdGlvbkZyYW1lP0MucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGx0KTpDLnNldFRpbWVvdXQobHQsay5meC5pbnRlcnZhbCksay5meC50aWNrKCkpfWZ1bmN0aW9uIGN0KCl7cmV0dXJuIEMuc2V0VGltZW91dChmdW5jdGlvbigpe3J0PXZvaWQgMH0pLHJ0PURhdGUubm93KCl9ZnVuY3Rpb24gZnQoZSx0KXt2YXIgbixyPTAsaT17aGVpZ2h0OmV9O2Zvcih0PXQ/MTowO3I8NDtyKz0yLXQpaVsibWFyZ2luIisobj1yZVtyXSldPWlbInBhZGRpbmciK25dPWU7cmV0dXJuIHQmJihpLm9wYWNpdHk9aS53aWR0aD1lKSxpfWZ1bmN0aW9uIHB0KGUsdCxuKXtmb3IodmFyIHIsaT0oZHQudHdlZW5lcnNbdF18fFtdKS5jb25jYXQoZHQudHdlZW5lcnNbIioiXSksbz0wLGE9aS5sZW5ndGg7bzxhO28rKylpZihyPWlbb10uY2FsbChuLHQsZSkpcmV0dXJuIHJ9ZnVuY3Rpb24gZHQobyxlLHQpe3ZhciBuLGEscj0wLGk9ZHQucHJlZmlsdGVycy5sZW5ndGgscz1rLkRlZmVycmVkKCkuYWx3YXlzKGZ1bmN0aW9uKCl7ZGVsZXRlIHUuZWxlbX0pLHU9ZnVuY3Rpb24oKXtpZihhKXJldHVybiExO2Zvcih2YXIgZT1ydHx8Y3QoKSx0PU1hdGgubWF4KDAsbC5zdGFydFRpbWUrbC5kdXJhdGlvbi1lKSxuPTEtKHQvbC5kdXJhdGlvbnx8MCkscj0wLGk9bC50d2VlbnMubGVuZ3RoO3I8aTtyKyspbC50d2VlbnNbcl0ucnVuKG4pO3JldHVybiBzLm5vdGlmeVdpdGgobyxbbCxuLHRdKSxuPDEmJmk/dDooaXx8cy5ub3RpZnlXaXRoKG8sW2wsMSwwXSkscy5yZXNvbHZlV2l0aChvLFtsXSksITEpfSxsPXMucHJvbWlzZSh7ZWxlbTpvLHByb3BzOmsuZXh0ZW5kKHt9LGUpLG9wdHM6ay5leHRlbmQoITAse3NwZWNpYWxFYXNpbmc6e30sZWFzaW5nOmsuZWFzaW5nLl9kZWZhdWx0fSx0KSxvcmlnaW5hbFByb3BlcnRpZXM6ZSxvcmlnaW5hbE9wdGlvbnM6dCxzdGFydFRpbWU6cnR8fGN0KCksZHVyYXRpb246dC5kdXJhdGlvbix0d2VlbnM6W10sY3JlYXRlVHdlZW46ZnVuY3Rpb24oZSx0KXt2YXIgbj1rLlR3ZWVuKG8sbC5vcHRzLGUsdCxsLm9wdHMuc3BlY2lhbEVhc2luZ1tlXXx8bC5vcHRzLmVhc2luZyk7cmV0dXJuIGwudHdlZW5zLnB1c2gobiksbn0sc3RvcDpmdW5jdGlvbihlKXt2YXIgdD0wLG49ZT9sLnR3ZWVucy5sZW5ndGg6MDtpZihhKXJldHVybiB0aGlzO2ZvcihhPSEwO3Q8bjt0KyspbC50d2VlbnNbdF0ucnVuKDEpO3JldHVybiBlPyhzLm5vdGlmeVdpdGgobyxbbCwxLDBdKSxzLnJlc29sdmVXaXRoKG8sW2wsZV0pKTpzLnJlamVjdFdpdGgobyxbbCxlXSksdGhpc319KSxjPWwucHJvcHM7Zm9yKCFmdW5jdGlvbihlLHQpe3ZhciBuLHIsaSxvLGE7Zm9yKG4gaW4gZSlpZihpPXRbcj1WKG4pXSxvPWVbbl0sQXJyYXkuaXNBcnJheShvKSYmKGk9b1sxXSxvPWVbbl09b1swXSksbiE9PXImJihlW3JdPW8sZGVsZXRlIGVbbl0pLChhPWsuY3NzSG9va3Nbcl0pJiYiZXhwYW5kImluIGEpZm9yKG4gaW4gbz1hLmV4cGFuZChvKSxkZWxldGUgZVtyXSxvKW4gaW4gZXx8KGVbbl09b1tuXSx0W25dPWkpO2Vsc2UgdFtyXT1pfShjLGwub3B0cy5zcGVjaWFsRWFzaW5nKTtyPGk7cisrKWlmKG49ZHQucHJlZmlsdGVyc1tyXS5jYWxsKGwsbyxjLGwub3B0cykpcmV0dXJuIG0obi5zdG9wKSYmKGsuX3F1ZXVlSG9va3MobC5lbGVtLGwub3B0cy5xdWV1ZSkuc3RvcD1uLnN0b3AuYmluZChuKSksbjtyZXR1cm4gay5tYXAoYyxwdCxsKSxtKGwub3B0cy5zdGFydCkmJmwub3B0cy5zdGFydC5jYWxsKG8sbCksbC5wcm9ncmVzcyhsLm9wdHMucHJvZ3Jlc3MpLmRvbmUobC5vcHRzLmRvbmUsbC5vcHRzLmNvbXBsZXRlKS5mYWlsKGwub3B0cy5mYWlsKS5hbHdheXMobC5vcHRzLmFsd2F5cyksay5meC50aW1lcihrLmV4dGVuZCh1LHtlbGVtOm8sYW5pbTpsLHF1ZXVlOmwub3B0cy5xdWV1ZX0pKSxsfWsuQW5pbWF0aW9uPWsuZXh0ZW5kKGR0LHt0d2VlbmVyczp7IioiOltmdW5jdGlvbihlLHQpe3ZhciBuPXRoaXMuY3JlYXRlVHdlZW4oZSx0KTtyZXR1cm4gbGUobi5lbGVtLGUsbmUuZXhlYyh0KSxuKSxufV19LHR3ZWVuZXI6ZnVuY3Rpb24oZSx0KXttKGUpPyh0PWUsZT1bIioiXSk6ZT1lLm1hdGNoKFIpO2Zvcih2YXIgbixyPTAsaT1lLmxlbmd0aDtyPGk7cisrKW49ZVtyXSxkdC50d2VlbmVyc1tuXT1kdC50d2VlbmVyc1tuXXx8W10sZHQudHdlZW5lcnNbbl0udW5zaGlmdCh0KX0scHJlZmlsdGVyczpbZnVuY3Rpb24oZSx0LG4pe3ZhciByLGksbyxhLHMsdSxsLGMsZj0id2lkdGgiaW4gdHx8ImhlaWdodCJpbiB0LHA9dGhpcyxkPXt9LGg9ZS5zdHlsZSxnPWUubm9kZVR5cGUmJnNlKGUpLHY9US5nZXQoZSwiZnhzaG93Iik7Zm9yKHIgaW4gbi5xdWV1ZXx8KG51bGw9PShhPWsuX3F1ZXVlSG9va3MoZSwiZngiKSkudW5xdWV1ZWQmJihhLnVucXVldWVkPTAscz1hLmVtcHR5LmZpcmUsYS5lbXB0eS5maXJlPWZ1bmN0aW9uKCl7YS51bnF1ZXVlZHx8cygpfSksYS51bnF1ZXVlZCsrLHAuYWx3YXlzKGZ1bmN0aW9uKCl7cC5hbHdheXMoZnVuY3Rpb24oKXthLnVucXVldWVkLS0say5xdWV1ZShlLCJmeCIpLmxlbmd0aHx8YS5lbXB0eS5maXJlKCl9KX0pKSx0KWlmKGk9dFtyXSxzdC50ZXN0KGkpKXtpZihkZWxldGUgdFtyXSxvPW98fCJ0b2dnbGUiPT09aSxpPT09KGc/ImhpZGUiOiJzaG93Iikpe2lmKCJzaG93IiE9PWl8fCF2fHx2b2lkIDA9PT12W3JdKWNvbnRpbnVlO2c9ITB9ZFtyXT12JiZ2W3JdfHxrLnN0eWxlKGUscil9aWYoKHU9IWsuaXNFbXB0eU9iamVjdCh0KSl8fCFrLmlzRW1wdHlPYmplY3QoZCkpZm9yKHIgaW4gZiYmMT09PWUubm9kZVR5cGUmJihuLm92ZXJmbG93PVtoLm92ZXJmbG93LGgub3ZlcmZsb3dYLGgub3ZlcmZsb3dZXSxudWxsPT0obD12JiZ2LmRpc3BsYXkpJiYobD1RLmdldChlLCJkaXNwbGF5IikpLCJub25lIj09PShjPWsuY3NzKGUsImRpc3BsYXkiKSkmJihsP2M9bDooZmUoW2VdLCEwKSxsPWUuc3R5bGUuZGlzcGxheXx8bCxjPWsuY3NzKGUsImRpc3BsYXkiKSxmZShbZV0pKSksKCJpbmxpbmUiPT09Y3x8ImlubGluZS1ibG9jayI9PT1jJiZudWxsIT1sKSYmIm5vbmUiPT09ay5jc3MoZSwiZmxvYXQiKSYmKHV8fChwLmRvbmUoZnVuY3Rpb24oKXtoLmRpc3BsYXk9bH0pLG51bGw9PWwmJihjPWguZGlzcGxheSxsPSJub25lIj09PWM/IiI6YykpLGguZGlzcGxheT0iaW5saW5lLWJsb2NrIikpLG4ub3ZlcmZsb3cmJihoLm92ZXJmbG93PSJoaWRkZW4iLHAuYWx3YXlzKGZ1bmN0aW9uKCl7aC5vdmVyZmxvdz1uLm92ZXJmbG93WzBdLGgub3ZlcmZsb3dYPW4ub3ZlcmZsb3dbMV0saC5vdmVyZmxvd1k9bi5vdmVyZmxvd1syXX0pKSx1PSExLGQpdXx8KHY/ImhpZGRlbiJpbiB2JiYoZz12LmhpZGRlbik6dj1RLmFjY2VzcyhlLCJmeHNob3ciLHtkaXNwbGF5Omx9KSxvJiYodi5oaWRkZW49IWcpLGcmJmZlKFtlXSwhMCkscC5kb25lKGZ1bmN0aW9uKCl7Zm9yKHIgaW4gZ3x8ZmUoW2VdKSxRLnJlbW92ZShlLCJmeHNob3ciKSxkKWsuc3R5bGUoZSxyLGRbcl0pfSkpLHU9cHQoZz92W3JdOjAscixwKSxyIGluIHZ8fCh2W3JdPXUuc3RhcnQsZyYmKHUuZW5kPXUuc3RhcnQsdS5zdGFydD0wKSl9XSxwcmVmaWx0ZXI6ZnVuY3Rpb24oZSx0KXt0P2R0LnByZWZpbHRlcnMudW5zaGlmdChlKTpkdC5wcmVmaWx0ZXJzLnB1c2goZSl9fSksay5zcGVlZD1mdW5jdGlvbihlLHQsbil7dmFyIHI9ZSYmIm9iamVjdCI9PXR5cGVvZiBlP2suZXh0ZW5kKHt9LGUpOntjb21wbGV0ZTpufHwhbiYmdHx8bShlKSYmZSxkdXJhdGlvbjplLGVhc2luZzpuJiZ0fHx0JiYhbSh0KSYmdH07cmV0dXJuIGsuZngub2ZmP3IuZHVyYXRpb249MDoibnVtYmVyIiE9dHlwZW9mIHIuZHVyYXRpb24mJihyLmR1cmF0aW9uIGluIGsuZnguc3BlZWRzP3IuZHVyYXRpb249ay5meC5zcGVlZHNbci5kdXJhdGlvbl06ci5kdXJhdGlvbj1rLmZ4LnNwZWVkcy5fZGVmYXVsdCksbnVsbCE9ci5xdWV1ZSYmITAhPT1yLnF1ZXVlfHwoci5xdWV1ZT0iZngiKSxyLm9sZD1yLmNvbXBsZXRlLHIuY29tcGxldGU9ZnVuY3Rpb24oKXttKHIub2xkKSYmci5vbGQuY2FsbCh0aGlzKSxyLnF1ZXVlJiZrLmRlcXVldWUodGhpcyxyLnF1ZXVlKX0scn0say5mbi5leHRlbmQoe2ZhZGVUbzpmdW5jdGlvbihlLHQsbixyKXtyZXR1cm4gdGhpcy5maWx0ZXIoc2UpLmNzcygib3BhY2l0eSIsMCkuc2hvdygpLmVuZCgpLmFuaW1hdGUoe29wYWNpdHk6dH0sZSxuLHIpfSxhbmltYXRlOmZ1bmN0aW9uKHQsZSxuLHIpe3ZhciBpPWsuaXNFbXB0eU9iamVjdCh0KSxvPWsuc3BlZWQoZSxuLHIpLGE9ZnVuY3Rpb24oKXt2YXIgZT1kdCh0aGlzLGsuZXh0ZW5kKHt9LHQpLG8pOyhpfHxRLmdldCh0aGlzLCJmaW5pc2giKSkmJmUuc3RvcCghMCl9O3JldHVybiBhLmZpbmlzaD1hLGl8fCExPT09by5xdWV1ZT90aGlzLmVhY2goYSk6dGhpcy5xdWV1ZShvLnF1ZXVlLGEpfSxzdG9wOmZ1bmN0aW9uKGksZSxvKXt2YXIgYT1mdW5jdGlvbihlKXt2YXIgdD1lLnN0b3A7ZGVsZXRlIGUuc3RvcCx0KG8pfTtyZXR1cm4ic3RyaW5nIiE9dHlwZW9mIGkmJihvPWUsZT1pLGk9dm9pZCAwKSxlJiYhMSE9PWkmJnRoaXMucXVldWUoaXx8ImZ4IixbXSksdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGU9ITAsdD1udWxsIT1pJiZpKyJxdWV1ZUhvb2tzIixuPWsudGltZXJzLHI9US5nZXQodGhpcyk7aWYodClyW3RdJiZyW3RdLnN0b3AmJmEoclt0XSk7ZWxzZSBmb3IodCBpbiByKXJbdF0mJnJbdF0uc3RvcCYmdXQudGVzdCh0KSYmYShyW3RdKTtmb3IodD1uLmxlbmd0aDt0LS07KW5bdF0uZWxlbSE9PXRoaXN8fG51bGwhPWkmJm5bdF0ucXVldWUhPT1pfHwoblt0XS5hbmltLnN0b3AobyksZT0hMSxuLnNwbGljZSh0LDEpKTshZSYmb3x8ay5kZXF1ZXVlKHRoaXMsaSl9KX0sZmluaXNoOmZ1bmN0aW9uKGEpe3JldHVybiExIT09YSYmKGE9YXx8ImZ4IiksdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGUsdD1RLmdldCh0aGlzKSxuPXRbYSsicXVldWUiXSxyPXRbYSsicXVldWVIb29rcyJdLGk9ay50aW1lcnMsbz1uP24ubGVuZ3RoOjA7Zm9yKHQuZmluaXNoPSEwLGsucXVldWUodGhpcyxhLFtdKSxyJiZyLnN0b3AmJnIuc3RvcC5jYWxsKHRoaXMsITApLGU9aS5sZW5ndGg7ZS0tOylpW2VdLmVsZW09PT10aGlzJiZpW2VdLnF1ZXVlPT09YSYmKGlbZV0uYW5pbS5zdG9wKCEwKSxpLnNwbGljZShlLDEpKTtmb3IoZT0wO2U8bztlKyspbltlXSYmbltlXS5maW5pc2gmJm5bZV0uZmluaXNoLmNhbGwodGhpcyk7ZGVsZXRlIHQuZmluaXNofSl9fSksay5lYWNoKFsidG9nZ2xlIiwic2hvdyIsImhpZGUiXSxmdW5jdGlvbihlLHIpe3ZhciBpPWsuZm5bcl07ay5mbltyXT1mdW5jdGlvbihlLHQsbil7cmV0dXJuIG51bGw9PWV8fCJib29sZWFuIj09dHlwZW9mIGU/aS5hcHBseSh0aGlzLGFyZ3VtZW50cyk6dGhpcy5hbmltYXRlKGZ0KHIsITApLGUsdCxuKX19KSxrLmVhY2goe3NsaWRlRG93bjpmdCgic2hvdyIpLHNsaWRlVXA6ZnQoImhpZGUiKSxzbGlkZVRvZ2dsZTpmdCgidG9nZ2xlIiksZmFkZUluOntvcGFjaXR5OiJzaG93In0sZmFkZU91dDp7b3BhY2l0eToiaGlkZSJ9LGZhZGVUb2dnbGU6e29wYWNpdHk6InRvZ2dsZSJ9fSxmdW5jdGlvbihlLHIpe2suZm5bZV09ZnVuY3Rpb24oZSx0LG4pe3JldHVybiB0aGlzLmFuaW1hdGUocixlLHQsbil9fSksay50aW1lcnM9W10say5meC50aWNrPWZ1bmN0aW9uKCl7dmFyIGUsdD0wLG49ay50aW1lcnM7Zm9yKHJ0PURhdGUubm93KCk7dDxuLmxlbmd0aDt0KyspKGU9blt0XSkoKXx8blt0XSE9PWV8fG4uc3BsaWNlKHQtLSwxKTtuLmxlbmd0aHx8ay5meC5zdG9wKCkscnQ9dm9pZCAwfSxrLmZ4LnRpbWVyPWZ1bmN0aW9uKGUpe2sudGltZXJzLnB1c2goZSksay5meC5zdGFydCgpfSxrLmZ4LmludGVydmFsPTEzLGsuZnguc3RhcnQ9ZnVuY3Rpb24oKXtpdHx8KGl0PSEwLGx0KCkpfSxrLmZ4LnN0b3A9ZnVuY3Rpb24oKXtpdD1udWxsfSxrLmZ4LnNwZWVkcz17c2xvdzo2MDAsZmFzdDoyMDAsX2RlZmF1bHQ6NDAwfSxrLmZuLmRlbGF5PWZ1bmN0aW9uKHIsZSl7cmV0dXJuIHI9ay5meCYmay5meC5zcGVlZHNbcl18fHIsZT1lfHwiZngiLHRoaXMucXVldWUoZSxmdW5jdGlvbihlLHQpe3ZhciBuPUMuc2V0VGltZW91dChlLHIpO3Quc3RvcD1mdW5jdGlvbigpe0MuY2xlYXJUaW1lb3V0KG4pfX0pfSxvdD1FLmNyZWF0ZUVsZW1lbnQoImlucHV0IiksYXQ9RS5jcmVhdGVFbGVtZW50KCJzZWxlY3QiKS5hcHBlbmRDaGlsZChFLmNyZWF0ZUVsZW1lbnQoIm9wdGlvbiIpKSxvdC50eXBlPSJjaGVja2JveCIseS5jaGVja09uPSIiIT09b3QudmFsdWUseS5vcHRTZWxlY3RlZD1hdC5zZWxlY3RlZCwob3Q9RS5jcmVhdGVFbGVtZW50KCJpbnB1dCIpKS52YWx1ZT0idCIsb3QudHlwZT0icmFkaW8iLHkucmFkaW9WYWx1ZT0idCI9PT1vdC52YWx1ZTt2YXIgaHQsZ3Q9ay5leHByLmF0dHJIYW5kbGU7ay5mbi5leHRlbmQoe2F0dHI6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gXyh0aGlzLGsuYXR0cixlLHQsMTxhcmd1bWVudHMubGVuZ3RoKX0scmVtb3ZlQXR0cjpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7ay5yZW1vdmVBdHRyKHRoaXMsZSl9KX19KSxrLmV4dGVuZCh7YXR0cjpmdW5jdGlvbihlLHQsbil7dmFyIHIsaSxvPWUubm9kZVR5cGU7aWYoMyE9PW8mJjghPT1vJiYyIT09bylyZXR1cm4idW5kZWZpbmVkIj09dHlwZW9mIGUuZ2V0QXR0cmlidXRlP2sucHJvcChlLHQsbik6KDE9PT1vJiZrLmlzWE1MRG9jKGUpfHwoaT1rLmF0dHJIb29rc1t0LnRvTG93ZXJDYXNlKCldfHwoay5leHByLm1hdGNoLmJvb2wudGVzdCh0KT9odDp2b2lkIDApKSx2b2lkIDAhPT1uP251bGw9PT1uP3ZvaWQgay5yZW1vdmVBdHRyKGUsdCk6aSYmInNldCJpbiBpJiZ2b2lkIDAhPT0ocj1pLnNldChlLG4sdCkpP3I6KGUuc2V0QXR0cmlidXRlKHQsbisiIiksbik6aSYmImdldCJpbiBpJiZudWxsIT09KHI9aS5nZXQoZSx0KSk/cjpudWxsPT0ocj1rLmZpbmQuYXR0cihlLHQpKT92b2lkIDA6cil9LGF0dHJIb29rczp7dHlwZTp7c2V0OmZ1bmN0aW9uKGUsdCl7aWYoIXkucmFkaW9WYWx1ZSYmInJhZGlvIj09PXQmJkEoZSwiaW5wdXQiKSl7dmFyIG49ZS52YWx1ZTtyZXR1cm4gZS5zZXRBdHRyaWJ1dGUoInR5cGUiLHQpLG4mJihlLnZhbHVlPW4pLHR9fX19LHJlbW92ZUF0dHI6ZnVuY3Rpb24oZSx0KXt2YXIgbixyPTAsaT10JiZ0Lm1hdGNoKFIpO2lmKGkmJjE9PT1lLm5vZGVUeXBlKXdoaWxlKG49aVtyKytdKWUucmVtb3ZlQXR0cmlidXRlKG4pfX0pLGh0PXtzZXQ6ZnVuY3Rpb24oZSx0LG4pe3JldHVybiExPT09dD9rLnJlbW92ZUF0dHIoZSxuKTplLnNldEF0dHJpYnV0ZShuLG4pLG59fSxrLmVhY2goay5leHByLm1hdGNoLmJvb2wuc291cmNlLm1hdGNoKC9cdysvZyksZnVuY3Rpb24oZSx0KXt2YXIgYT1ndFt0XXx8ay5maW5kLmF0dHI7Z3RbdF09ZnVuY3Rpb24oZSx0LG4pe3ZhciByLGksbz10LnRvTG93ZXJDYXNlKCk7cmV0dXJuIG58fChpPWd0W29dLGd0W29dPXIscj1udWxsIT1hKGUsdCxuKT9vOm51bGwsZ3Rbb109aSkscn19KTt2YXIgdnQ9L14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9uKSQvaSx5dD0vXig/OmF8YXJlYSkkL2k7ZnVuY3Rpb24gbXQoZSl7cmV0dXJuKGUubWF0Y2goUil8fFtdKS5qb2luKCIgIil9ZnVuY3Rpb24geHQoZSl7cmV0dXJuIGUuZ2V0QXR0cmlidXRlJiZlLmdldEF0dHJpYnV0ZSgiY2xhc3MiKXx8IiJ9ZnVuY3Rpb24gYnQoZSl7cmV0dXJuIEFycmF5LmlzQXJyYXkoZSk/ZToic3RyaW5nIj09dHlwZW9mIGUmJmUubWF0Y2goUil8fFtdfWsuZm4uZXh0ZW5kKHtwcm9wOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIF8odGhpcyxrLnByb3AsZSx0LDE8YXJndW1lbnRzLmxlbmd0aCl9LHJlbW92ZVByb3A6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe2RlbGV0ZSB0aGlzW2sucHJvcEZpeFtlXXx8ZV19KX19KSxrLmV4dGVuZCh7cHJvcDpmdW5jdGlvbihlLHQsbil7dmFyIHIsaSxvPWUubm9kZVR5cGU7aWYoMyE9PW8mJjghPT1vJiYyIT09bylyZXR1cm4gMT09PW8mJmsuaXNYTUxEb2MoZSl8fCh0PWsucHJvcEZpeFt0XXx8dCxpPWsucHJvcEhvb2tzW3RdKSx2b2lkIDAhPT1uP2kmJiJzZXQiaW4gaSYmdm9pZCAwIT09KHI9aS5zZXQoZSxuLHQpKT9yOmVbdF09bjppJiYiZ2V0ImluIGkmJm51bGwhPT0ocj1pLmdldChlLHQpKT9yOmVbdF19LHByb3BIb29rczp7dGFiSW5kZXg6e2dldDpmdW5jdGlvbihlKXt2YXIgdD1rLmZpbmQuYXR0cihlLCJ0YWJpbmRleCIpO3JldHVybiB0P3BhcnNlSW50KHQsMTApOnZ0LnRlc3QoZS5ub2RlTmFtZSl8fHl0LnRlc3QoZS5ub2RlTmFtZSkmJmUuaHJlZj8wOi0xfX19LHByb3BGaXg6eyJmb3IiOiJodG1sRm9yIiwiY2xhc3MiOiJjbGFzc05hbWUifX0pLHkub3B0U2VsZWN0ZWR8fChrLnByb3BIb29rcy5zZWxlY3RlZD17Z2V0OmZ1bmN0aW9uKGUpe3ZhciB0PWUucGFyZW50Tm9kZTtyZXR1cm4gdCYmdC5wYXJlbnROb2RlJiZ0LnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleCxudWxsfSxzZXQ6ZnVuY3Rpb24oZSl7dmFyIHQ9ZS5wYXJlbnROb2RlO3QmJih0LnNlbGVjdGVkSW5kZXgsdC5wYXJlbnROb2RlJiZ0LnBhcmVudE5vZGUuc2VsZWN0ZWRJbmRleCl9fSksay5lYWNoKFsidGFiSW5kZXgiLCJyZWFkT25seSIsIm1heExlbmd0aCIsImNlbGxTcGFjaW5nIiwiY2VsbFBhZGRpbmciLCJyb3dTcGFuIiwiY29sU3BhbiIsInVzZU1hcCIsImZyYW1lQm9yZGVyIiwiY29udGVudEVkaXRhYmxlIl0sZnVuY3Rpb24oKXtrLnByb3BGaXhbdGhpcy50b0xvd2VyQ2FzZSgpXT10aGlzfSksay5mbi5leHRlbmQoe2FkZENsYXNzOmZ1bmN0aW9uKHQpe3ZhciBlLG4scixpLG8sYSxzLHU9MDtpZihtKHQpKXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oZSl7ayh0aGlzKS5hZGRDbGFzcyh0LmNhbGwodGhpcyxlLHh0KHRoaXMpKSl9KTtpZigoZT1idCh0KSkubGVuZ3RoKXdoaWxlKG49dGhpc1t1KytdKWlmKGk9eHQobikscj0xPT09bi5ub2RlVHlwZSYmIiAiK210KGkpKyIgIil7YT0wO3doaWxlKG89ZVthKytdKXIuaW5kZXhPZigiICIrbysiICIpPDAmJihyKz1vKyIgIik7aSE9PShzPW10KHIpKSYmbi5zZXRBdHRyaWJ1dGUoImNsYXNzIixzKX1yZXR1cm4gdGhpc30scmVtb3ZlQ2xhc3M6ZnVuY3Rpb24odCl7dmFyIGUsbixyLGksbyxhLHMsdT0wO2lmKG0odCkpcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihlKXtrKHRoaXMpLnJlbW92ZUNsYXNzKHQuY2FsbCh0aGlzLGUseHQodGhpcykpKX0pO2lmKCFhcmd1bWVudHMubGVuZ3RoKXJldHVybiB0aGlzLmF0dHIoImNsYXNzIiwiIik7aWYoKGU9YnQodCkpLmxlbmd0aCl3aGlsZShuPXRoaXNbdSsrXSlpZihpPXh0KG4pLHI9MT09PW4ubm9kZVR5cGUmJiIgIittdChpKSsiICIpe2E9MDt3aGlsZShvPWVbYSsrXSl3aGlsZSgtMTxyLmluZGV4T2YoIiAiK28rIiAiKSlyPXIucmVwbGFjZSgiICIrbysiICIsIiAiKTtpIT09KHM9bXQocikpJiZuLnNldEF0dHJpYnV0ZSgiY2xhc3MiLHMpfXJldHVybiB0aGlzfSx0b2dnbGVDbGFzczpmdW5jdGlvbihpLHQpe3ZhciBvPXR5cGVvZiBpLGE9InN0cmluZyI9PT1vfHxBcnJheS5pc0FycmF5KGkpO3JldHVybiJib29sZWFuIj09dHlwZW9mIHQmJmE/dD90aGlzLmFkZENsYXNzKGkpOnRoaXMucmVtb3ZlQ2xhc3MoaSk6bShpKT90aGlzLmVhY2goZnVuY3Rpb24oZSl7ayh0aGlzKS50b2dnbGVDbGFzcyhpLmNhbGwodGhpcyxlLHh0KHRoaXMpLHQpLHQpfSk6dGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIGUsdCxuLHI7aWYoYSl7dD0wLG49ayh0aGlzKSxyPWJ0KGkpO3doaWxlKGU9clt0KytdKW4uaGFzQ2xhc3MoZSk/bi5yZW1vdmVDbGFzcyhlKTpuLmFkZENsYXNzKGUpfWVsc2Ugdm9pZCAwIT09aSYmImJvb2xlYW4iIT09b3x8KChlPXh0KHRoaXMpKSYmUS5zZXQodGhpcywiX19jbGFzc05hbWVfXyIsZSksdGhpcy5zZXRBdHRyaWJ1dGUmJnRoaXMuc2V0QXR0cmlidXRlKCJjbGFzcyIsZXx8ITE9PT1pPyIiOlEuZ2V0KHRoaXMsIl9fY2xhc3NOYW1lX18iKXx8IiIpKX0pfSxoYXNDbGFzczpmdW5jdGlvbihlKXt2YXIgdCxuLHI9MDt0PSIgIitlKyIgIjt3aGlsZShuPXRoaXNbcisrXSlpZigxPT09bi5ub2RlVHlwZSYmLTE8KCIgIittdCh4dChuKSkrIiAiKS5pbmRleE9mKHQpKXJldHVybiEwO3JldHVybiExfX0pO3ZhciB3dD0vXHIvZztrLmZuLmV4dGVuZCh7dmFsOmZ1bmN0aW9uKG4pe3ZhciByLGUsaSx0PXRoaXNbMF07cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGk9bShuKSx0aGlzLmVhY2goZnVuY3Rpb24oZSl7dmFyIHQ7MT09PXRoaXMubm9kZVR5cGUmJihudWxsPT0odD1pP24uY2FsbCh0aGlzLGUsayh0aGlzKS52YWwoKSk6bik/dD0iIjoibnVtYmVyIj09dHlwZW9mIHQ/dCs9IiI6QXJyYXkuaXNBcnJheSh0KSYmKHQ9ay5tYXAodCxmdW5jdGlvbihlKXtyZXR1cm4gbnVsbD09ZT8iIjplKyIifSkpLChyPWsudmFsSG9va3NbdGhpcy50eXBlXXx8ay52YWxIb29rc1t0aGlzLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldKSYmInNldCJpbiByJiZ2b2lkIDAhPT1yLnNldCh0aGlzLHQsInZhbHVlIil8fCh0aGlzLnZhbHVlPXQpKX0pKTp0PyhyPWsudmFsSG9va3NbdC50eXBlXXx8ay52YWxIb29rc1t0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCldKSYmImdldCJpbiByJiZ2b2lkIDAhPT0oZT1yLmdldCh0LCJ2YWx1ZSIpKT9lOiJzdHJpbmciPT10eXBlb2YoZT10LnZhbHVlKT9lLnJlcGxhY2Uod3QsIiIpOm51bGw9PWU/IiI6ZTp2b2lkIDB9fSksay5leHRlbmQoe3ZhbEhvb2tzOntvcHRpb246e2dldDpmdW5jdGlvbihlKXt2YXIgdD1rLmZpbmQuYXR0cihlLCJ2YWx1ZSIpO3JldHVybiBudWxsIT10P3Q6bXQoay50ZXh0KGUpKX19LHNlbGVjdDp7Z2V0OmZ1bmN0aW9uKGUpe3ZhciB0LG4scixpPWUub3B0aW9ucyxvPWUuc2VsZWN0ZWRJbmRleCxhPSJzZWxlY3Qtb25lIj09PWUudHlwZSxzPWE/bnVsbDpbXSx1PWE/bysxOmkubGVuZ3RoO2ZvcihyPW88MD91OmE/bzowO3I8dTtyKyspaWYoKChuPWlbcl0pLnNlbGVjdGVkfHxyPT09bykmJiFuLmRpc2FibGVkJiYoIW4ucGFyZW50Tm9kZS5kaXNhYmxlZHx8IUEobi5wYXJlbnROb2RlLCJvcHRncm91cCIpKSl7aWYodD1rKG4pLnZhbCgpLGEpcmV0dXJuIHQ7cy5wdXNoKHQpfXJldHVybiBzfSxzZXQ6ZnVuY3Rpb24oZSx0KXt2YXIgbixyLGk9ZS5vcHRpb25zLG89ay5tYWtlQXJyYXkodCksYT1pLmxlbmd0aDt3aGlsZShhLS0pKChyPWlbYV0pLnNlbGVjdGVkPS0xPGsuaW5BcnJheShrLnZhbEhvb2tzLm9wdGlvbi5nZXQociksbykpJiYobj0hMCk7cmV0dXJuIG58fChlLnNlbGVjdGVkSW5kZXg9LTEpLG99fX19KSxrLmVhY2goWyJyYWRpbyIsImNoZWNrYm94Il0sZnVuY3Rpb24oKXtrLnZhbEhvb2tzW3RoaXNdPXtzZXQ6ZnVuY3Rpb24oZSx0KXtpZihBcnJheS5pc0FycmF5KHQpKXJldHVybiBlLmNoZWNrZWQ9LTE8ay5pbkFycmF5KGsoZSkudmFsKCksdCl9fSx5LmNoZWNrT258fChrLnZhbEhvb2tzW3RoaXNdLmdldD1mdW5jdGlvbihlKXtyZXR1cm4gbnVsbD09PWUuZ2V0QXR0cmlidXRlKCJ2YWx1ZSIpPyJvbiI6ZS52YWx1ZX0pfSkseS5mb2N1c2luPSJvbmZvY3VzaW4iaW4gQzt2YXIgVHQ9L14oPzpmb2N1c2luZm9jdXN8Zm9jdXNvdXRibHVyKSQvLEN0PWZ1bmN0aW9uKGUpe2Uuc3RvcFByb3BhZ2F0aW9uKCl9O2suZXh0ZW5kKGsuZXZlbnQse3RyaWdnZXI6ZnVuY3Rpb24oZSx0LG4scil7dmFyIGksbyxhLHMsdSxsLGMsZixwPVtufHxFXSxkPXYuY2FsbChlLCJ0eXBlIik/ZS50eXBlOmUsaD12LmNhbGwoZSwibmFtZXNwYWNlIik/ZS5uYW1lc3BhY2Uuc3BsaXQoIi4iKTpbXTtpZihvPWY9YT1uPW58fEUsMyE9PW4ubm9kZVR5cGUmJjghPT1uLm5vZGVUeXBlJiYhVHQudGVzdChkK2suZXZlbnQudHJpZ2dlcmVkKSYmKC0xPGQuaW5kZXhPZigiLiIpJiYoZD0oaD1kLnNwbGl0KCIuIikpLnNoaWZ0KCksaC5zb3J0KCkpLHU9ZC5pbmRleE9mKCI6Iik8MCYmIm9uIitkLChlPWVbay5leHBhbmRvXT9lOm5ldyBrLkV2ZW50KGQsIm9iamVjdCI9PXR5cGVvZiBlJiZlKSkuaXNUcmlnZ2VyPXI/MjozLGUubmFtZXNwYWNlPWguam9pbigiLiIpLGUucm5hbWVzcGFjZT1lLm5hbWVzcGFjZT9uZXcgUmVnRXhwKCIoXnxcXC4pIitoLmpvaW4oIlxcLig/Oi4qXFwufCkiKSsiKFxcLnwkKSIpOm51bGwsZS5yZXN1bHQ9dm9pZCAwLGUudGFyZ2V0fHwoZS50YXJnZXQ9biksdD1udWxsPT10P1tlXTprLm1ha2VBcnJheSh0LFtlXSksYz1rLmV2ZW50LnNwZWNpYWxbZF18fHt9LHJ8fCFjLnRyaWdnZXJ8fCExIT09Yy50cmlnZ2VyLmFwcGx5KG4sdCkpKXtpZighciYmIWMubm9CdWJibGUmJiF4KG4pKXtmb3Iocz1jLmRlbGVnYXRlVHlwZXx8ZCxUdC50ZXN0KHMrZCl8fChvPW8ucGFyZW50Tm9kZSk7bztvPW8ucGFyZW50Tm9kZSlwLnB1c2gobyksYT1vO2E9PT0obi5vd25lckRvY3VtZW50fHxFKSYmcC5wdXNoKGEuZGVmYXVsdFZpZXd8fGEucGFyZW50V2luZG93fHxDKX1pPTA7d2hpbGUoKG89cFtpKytdKSYmIWUuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSlmPW8sZS50eXBlPTE8aT9zOmMuYmluZFR5cGV8fGQsKGw9KFEuZ2V0KG8sImV2ZW50cyIpfHx7fSlbZS50eXBlXSYmUS5nZXQobywiaGFuZGxlIikpJiZsLmFwcGx5KG8sdCksKGw9dSYmb1t1XSkmJmwuYXBwbHkmJkcobykmJihlLnJlc3VsdD1sLmFwcGx5KG8sdCksITE9PT1lLnJlc3VsdCYmZS5wcmV2ZW50RGVmYXVsdCgpKTtyZXR1cm4gZS50eXBlPWQscnx8ZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKXx8Yy5fZGVmYXVsdCYmITEhPT1jLl9kZWZhdWx0LmFwcGx5KHAucG9wKCksdCl8fCFHKG4pfHx1JiZtKG5bZF0pJiYheChuKSYmKChhPW5bdV0pJiYoblt1XT1udWxsKSxrLmV2ZW50LnRyaWdnZXJlZD1kLGUuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSYmZi5hZGRFdmVudExpc3RlbmVyKGQsQ3QpLG5bZF0oKSxlLmlzUHJvcGFnYXRpb25TdG9wcGVkKCkmJmYucmVtb3ZlRXZlbnRMaXN0ZW5lcihkLEN0KSxrLmV2ZW50LnRyaWdnZXJlZD12b2lkIDAsYSYmKG5bdV09YSkpLGUucmVzdWx0fX0sc2ltdWxhdGU6ZnVuY3Rpb24oZSx0LG4pe3ZhciByPWsuZXh0ZW5kKG5ldyBrLkV2ZW50LG4se3R5cGU6ZSxpc1NpbXVsYXRlZDohMH0pO2suZXZlbnQudHJpZ2dlcihyLG51bGwsdCl9fSksay5mbi5leHRlbmQoe3RyaWdnZXI6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7ay5ldmVudC50cmlnZ2VyKGUsdCx0aGlzKX0pfSx0cmlnZ2VySGFuZGxlcjpmdW5jdGlvbihlLHQpe3ZhciBuPXRoaXNbMF07aWYobilyZXR1cm4gay5ldmVudC50cmlnZ2VyKGUsdCxuLCEwKX19KSx5LmZvY3VzaW58fGsuZWFjaCh7Zm9jdXM6ImZvY3VzaW4iLGJsdXI6ImZvY3Vzb3V0In0sZnVuY3Rpb24obixyKXt2YXIgaT1mdW5jdGlvbihlKXtrLmV2ZW50LnNpbXVsYXRlKHIsZS50YXJnZXQsay5ldmVudC5maXgoZSkpfTtrLmV2ZW50LnNwZWNpYWxbcl09e3NldHVwOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5vd25lckRvY3VtZW50fHx0aGlzLHQ9US5hY2Nlc3MoZSxyKTt0fHxlLmFkZEV2ZW50TGlzdGVuZXIobixpLCEwKSxRLmFjY2VzcyhlLHIsKHR8fDApKzEpfSx0ZWFyZG93bjpmdW5jdGlvbigpe3ZhciBlPXRoaXMub3duZXJEb2N1bWVudHx8dGhpcyx0PVEuYWNjZXNzKGUsciktMTt0P1EuYWNjZXNzKGUscix0KTooZS5yZW1vdmVFdmVudExpc3RlbmVyKG4saSwhMCksUS5yZW1vdmUoZSxyKSl9fX0pO3ZhciBFdD1DLmxvY2F0aW9uLGt0PURhdGUubm93KCksU3Q9L1w/LztrLnBhcnNlWE1MPWZ1bmN0aW9uKGUpe3ZhciB0O2lmKCFlfHwic3RyaW5nIiE9dHlwZW9mIGUpcmV0dXJuIG51bGw7dHJ5e3Q9KG5ldyBDLkRPTVBhcnNlcikucGFyc2VGcm9tU3RyaW5nKGUsInRleHQveG1sIil9Y2F0Y2goZSl7dD12b2lkIDB9cmV0dXJuIHQmJiF0LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJwYXJzZXJlcnJvciIpLmxlbmd0aHx8ay5lcnJvcigiSW52YWxpZCBYTUw6ICIrZSksdH07dmFyIE50PS9cW1xdJC8sQXQ9L1xyP1xuL2csRHQ9L14oPzpzdWJtaXR8YnV0dG9ufGltYWdlfHJlc2V0fGZpbGUpJC9pLGp0PS9eKD86aW5wdXR8c2VsZWN0fHRleHRhcmVhfGtleWdlbikvaTtmdW5jdGlvbiBxdChuLGUscixpKXt2YXIgdDtpZihBcnJheS5pc0FycmF5KGUpKWsuZWFjaChlLGZ1bmN0aW9uKGUsdCl7cnx8TnQudGVzdChuKT9pKG4sdCk6cXQobisiWyIrKCJvYmplY3QiPT10eXBlb2YgdCYmbnVsbCE9dD9lOiIiKSsiXSIsdCxyLGkpfSk7ZWxzZSBpZihyfHwib2JqZWN0IiE9PXcoZSkpaShuLGUpO2Vsc2UgZm9yKHQgaW4gZSlxdChuKyJbIit0KyJdIixlW3RdLHIsaSl9ay5wYXJhbT1mdW5jdGlvbihlLHQpe3ZhciBuLHI9W10saT1mdW5jdGlvbihlLHQpe3ZhciBuPW0odCk/dCgpOnQ7cltyLmxlbmd0aF09ZW5jb2RlVVJJQ29tcG9uZW50KGUpKyI9IitlbmNvZGVVUklDb21wb25lbnQobnVsbD09bj8iIjpuKX07aWYobnVsbD09ZSlyZXR1cm4iIjtpZihBcnJheS5pc0FycmF5KGUpfHxlLmpxdWVyeSYmIWsuaXNQbGFpbk9iamVjdChlKSlrLmVhY2goZSxmdW5jdGlvbigpe2kodGhpcy5uYW1lLHRoaXMudmFsdWUpfSk7ZWxzZSBmb3IobiBpbiBlKXF0KG4sZVtuXSx0LGkpO3JldHVybiByLmpvaW4oIiYiKX0say5mbi5leHRlbmQoe3NlcmlhbGl6ZTpmdW5jdGlvbigpe3JldHVybiBrLnBhcmFtKHRoaXMuc2VyaWFsaXplQXJyYXkoKSl9LHNlcmlhbGl6ZUFycmF5OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKCl7dmFyIGU9ay5wcm9wKHRoaXMsImVsZW1lbnRzIik7cmV0dXJuIGU/ay5tYWtlQXJyYXkoZSk6dGhpc30pLmZpbHRlcihmdW5jdGlvbigpe3ZhciBlPXRoaXMudHlwZTtyZXR1cm4gdGhpcy5uYW1lJiYhayh0aGlzKS5pcygiOmRpc2FibGVkIikmJmp0LnRlc3QodGhpcy5ub2RlTmFtZSkmJiFEdC50ZXN0KGUpJiYodGhpcy5jaGVja2VkfHwhcGUudGVzdChlKSl9KS5tYXAoZnVuY3Rpb24oZSx0KXt2YXIgbj1rKHRoaXMpLnZhbCgpO3JldHVybiBudWxsPT1uP251bGw6QXJyYXkuaXNBcnJheShuKT9rLm1hcChuLGZ1bmN0aW9uKGUpe3JldHVybntuYW1lOnQubmFtZSx2YWx1ZTplLnJlcGxhY2UoQXQsIlxyXG4iKX19KTp7bmFtZTp0Lm5hbWUsdmFsdWU6bi5yZXBsYWNlKEF0LCJcclxuIil9fSkuZ2V0KCl9fSk7dmFyIEx0PS8lMjAvZyxIdD0vIy4qJC8sT3Q9LyhbPyZdKV89W14mXSovLFB0PS9eKC4qPyk6WyBcdF0qKFteXHJcbl0qKSQvZ20sUnQ9L14oPzpHRVR8SEVBRCkkLyxNdD0vXlwvXC8vLEl0PXt9LFd0PXt9LCR0PSIqLyIuY29uY2F0KCIqIiksRnQ9RS5jcmVhdGVFbGVtZW50KCJhIik7ZnVuY3Rpb24gQnQobyl7cmV0dXJuIGZ1bmN0aW9uKGUsdCl7InN0cmluZyIhPXR5cGVvZiBlJiYodD1lLGU9IioiKTt2YXIgbixyPTAsaT1lLnRvTG93ZXJDYXNlKCkubWF0Y2goUil8fFtdO2lmKG0odCkpd2hpbGUobj1pW3IrK10pIisiPT09blswXT8obj1uLnNsaWNlKDEpfHwiKiIsKG9bbl09b1tuXXx8W10pLnVuc2hpZnQodCkpOihvW25dPW9bbl18fFtdKS5wdXNoKHQpfX1mdW5jdGlvbiBfdCh0LGksbyxhKXt2YXIgcz17fSx1PXQ9PT1XdDtmdW5jdGlvbiBsKGUpe3ZhciByO3JldHVybiBzW2VdPSEwLGsuZWFjaCh0W2VdfHxbXSxmdW5jdGlvbihlLHQpe3ZhciBuPXQoaSxvLGEpO3JldHVybiJzdHJpbmciIT10eXBlb2Ygbnx8dXx8c1tuXT91PyEocj1uKTp2b2lkIDA6KGkuZGF0YVR5cGVzLnVuc2hpZnQobiksbChuKSwhMSl9KSxyfXJldHVybiBsKGkuZGF0YVR5cGVzWzBdKXx8IXNbIioiXSYmbCgiKiIpfWZ1bmN0aW9uIHp0KGUsdCl7dmFyIG4scixpPWsuYWpheFNldHRpbmdzLmZsYXRPcHRpb25zfHx7fTtmb3IobiBpbiB0KXZvaWQgMCE9PXRbbl0mJigoaVtuXT9lOnJ8fChyPXt9KSlbbl09dFtuXSk7cmV0dXJuIHImJmsuZXh0ZW5kKCEwLGUsciksZX1GdC5ocmVmPUV0LmhyZWYsay5leHRlbmQoe2FjdGl2ZTowLGxhc3RNb2RpZmllZDp7fSxldGFnOnt9LGFqYXhTZXR0aW5nczp7dXJsOkV0LmhyZWYsdHlwZToiR0VUIixpc0xvY2FsOi9eKD86YWJvdXR8YXBwfGFwcC1zdG9yYWdlfC4rLWV4dGVuc2lvbnxmaWxlfHJlc3x3aWRnZXQpOiQvLnRlc3QoRXQucHJvdG9jb2wpLGdsb2JhbDohMCxwcm9jZXNzRGF0YTohMCxhc3luYzohMCxjb250ZW50VHlwZToiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkOyBjaGFyc2V0PVVURi04IixhY2NlcHRzOnsiKiI6JHQsdGV4dDoidGV4dC9wbGFpbiIsaHRtbDoidGV4dC9odG1sIix4bWw6ImFwcGxpY2F0aW9uL3htbCwgdGV4dC94bWwiLGpzb246ImFwcGxpY2F0aW9uL2pzb24sIHRleHQvamF2YXNjcmlwdCJ9LGNvbnRlbnRzOnt4bWw6L1xieG1sXGIvLGh0bWw6L1xiaHRtbC8sanNvbjovXGJqc29uXGIvfSxyZXNwb25zZUZpZWxkczp7eG1sOiJyZXNwb25zZVhNTCIsdGV4dDoicmVzcG9uc2VUZXh0Iixqc29uOiJyZXNwb25zZUpTT04ifSxjb252ZXJ0ZXJzOnsiKiB0ZXh0IjpTdHJpbmcsInRleHQgaHRtbCI6ITAsInRleHQganNvbiI6SlNPTi5wYXJzZSwidGV4dCB4bWwiOmsucGFyc2VYTUx9LGZsYXRPcHRpb25zOnt1cmw6ITAsY29udGV4dDohMH19LGFqYXhTZXR1cDpmdW5jdGlvbihlLHQpe3JldHVybiB0P3p0KHp0KGUsay5hamF4U2V0dGluZ3MpLHQpOnp0KGsuYWpheFNldHRpbmdzLGUpfSxhamF4UHJlZmlsdGVyOkJ0KEl0KSxhamF4VHJhbnNwb3J0OkJ0KFd0KSxhamF4OmZ1bmN0aW9uKGUsdCl7Im9iamVjdCI9PXR5cGVvZiBlJiYodD1lLGU9dm9pZCAwKSx0PXR8fHt9O3ZhciBjLGYscCxuLGQscixoLGcsaSxvLHY9ay5hamF4U2V0dXAoe30sdCkseT12LmNvbnRleHR8fHYsbT12LmNvbnRleHQmJih5Lm5vZGVUeXBlfHx5LmpxdWVyeSk/ayh5KTprLmV2ZW50LHg9ay5EZWZlcnJlZCgpLGI9ay5DYWxsYmFja3MoIm9uY2UgbWVtb3J5Iiksdz12LnN0YXR1c0NvZGV8fHt9LGE9e30scz17fSx1PSJjYW5jZWxlZCIsVD17cmVhZHlTdGF0ZTowLGdldFJlc3BvbnNlSGVhZGVyOmZ1bmN0aW9uKGUpe3ZhciB0O2lmKGgpe2lmKCFuKXtuPXt9O3doaWxlKHQ9UHQuZXhlYyhwKSluW3RbMV0udG9Mb3dlckNhc2UoKSsiICJdPShuW3RbMV0udG9Mb3dlckNhc2UoKSsiICJdfHxbXSkuY29uY2F0KHRbMl0pfXQ9bltlLnRvTG93ZXJDYXNlKCkrIiAiXX1yZXR1cm4gbnVsbD09dD9udWxsOnQuam9pbigiLCAiKX0sZ2V0QWxsUmVzcG9uc2VIZWFkZXJzOmZ1bmN0aW9uKCl7cmV0dXJuIGg/cDpudWxsfSxzZXRSZXF1ZXN0SGVhZGVyOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIG51bGw9PWgmJihlPXNbZS50b0xvd2VyQ2FzZSgpXT1zW2UudG9Mb3dlckNhc2UoKV18fGUsYVtlXT10KSx0aGlzfSxvdmVycmlkZU1pbWVUeXBlOmZ1bmN0aW9uKGUpe3JldHVybiBudWxsPT1oJiYodi5taW1lVHlwZT1lKSx0aGlzfSxzdGF0dXNDb2RlOmZ1bmN0aW9uKGUpe3ZhciB0O2lmKGUpaWYoaClULmFsd2F5cyhlW1Quc3RhdHVzXSk7ZWxzZSBmb3IodCBpbiBlKXdbdF09W3dbdF0sZVt0XV07cmV0dXJuIHRoaXN9LGFib3J0OmZ1bmN0aW9uKGUpe3ZhciB0PWV8fHU7cmV0dXJuIGMmJmMuYWJvcnQodCksbCgwLHQpLHRoaXN9fTtpZih4LnByb21pc2UoVCksdi51cmw9KChlfHx2LnVybHx8RXQuaHJlZikrIiIpLnJlcGxhY2UoTXQsRXQucHJvdG9jb2wrIi8vIiksdi50eXBlPXQubWV0aG9kfHx0LnR5cGV8fHYubWV0aG9kfHx2LnR5cGUsdi5kYXRhVHlwZXM9KHYuZGF0YVR5cGV8fCIqIikudG9Mb3dlckNhc2UoKS5tYXRjaChSKXx8WyIiXSxudWxsPT12LmNyb3NzRG9tYWluKXtyPUUuY3JlYXRlRWxlbWVudCgiYSIpO3RyeXtyLmhyZWY9di51cmwsci5ocmVmPXIuaHJlZix2LmNyb3NzRG9tYWluPUZ0LnByb3RvY29sKyIvLyIrRnQuaG9zdCE9ci5wcm90b2NvbCsiLy8iK3IuaG9zdH1jYXRjaChlKXt2LmNyb3NzRG9tYWluPSEwfX1pZih2LmRhdGEmJnYucHJvY2Vzc0RhdGEmJiJzdHJpbmciIT10eXBlb2Ygdi5kYXRhJiYodi5kYXRhPWsucGFyYW0odi5kYXRhLHYudHJhZGl0aW9uYWwpKSxfdChJdCx2LHQsVCksaClyZXR1cm4gVDtmb3IoaSBpbihnPWsuZXZlbnQmJnYuZ2xvYmFsKSYmMD09ay5hY3RpdmUrKyYmay5ldmVudC50cmlnZ2VyKCJhamF4U3RhcnQiKSx2LnR5cGU9di50eXBlLnRvVXBwZXJDYXNlKCksdi5oYXNDb250ZW50PSFSdC50ZXN0KHYudHlwZSksZj12LnVybC5yZXBsYWNlKEh0LCIiKSx2Lmhhc0NvbnRlbnQ/di5kYXRhJiZ2LnByb2Nlc3NEYXRhJiYwPT09KHYuY29udGVudFR5cGV8fCIiKS5pbmRleE9mKCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiKSYmKHYuZGF0YT12LmRhdGEucmVwbGFjZShMdCwiKyIpKToobz12LnVybC5zbGljZShmLmxlbmd0aCksdi5kYXRhJiYodi5wcm9jZXNzRGF0YXx8InN0cmluZyI9PXR5cGVvZiB2LmRhdGEpJiYoZis9KFN0LnRlc3QoZik/IiYiOiI/Iikrdi5kYXRhLGRlbGV0ZSB2LmRhdGEpLCExPT09di5jYWNoZSYmKGY9Zi5yZXBsYWNlKE90LCIkMSIpLG89KFN0LnRlc3QoZik/IiYiOiI/IikrIl89IitrdCsrK28pLHYudXJsPWYrbyksdi5pZk1vZGlmaWVkJiYoay5sYXN0TW9kaWZpZWRbZl0mJlQuc2V0UmVxdWVzdEhlYWRlcigiSWYtTW9kaWZpZWQtU2luY2UiLGsubGFzdE1vZGlmaWVkW2ZdKSxrLmV0YWdbZl0mJlQuc2V0UmVxdWVzdEhlYWRlcigiSWYtTm9uZS1NYXRjaCIsay5ldGFnW2ZdKSksKHYuZGF0YSYmdi5oYXNDb250ZW50JiYhMSE9PXYuY29udGVudFR5cGV8fHQuY29udGVudFR5cGUpJiZULnNldFJlcXVlc3RIZWFkZXIoIkNvbnRlbnQtVHlwZSIsdi5jb250ZW50VHlwZSksVC5zZXRSZXF1ZXN0SGVhZGVyKCJBY2NlcHQiLHYuZGF0YVR5cGVzWzBdJiZ2LmFjY2VwdHNbdi5kYXRhVHlwZXNbMF1dP3YuYWNjZXB0c1t2LmRhdGFUeXBlc1swXV0rKCIqIiE9PXYuZGF0YVR5cGVzWzBdPyIsICIrJHQrIjsgcT0wLjAxIjoiIik6di5hY2NlcHRzWyIqIl0pLHYuaGVhZGVycylULnNldFJlcXVlc3RIZWFkZXIoaSx2LmhlYWRlcnNbaV0pO2lmKHYuYmVmb3JlU2VuZCYmKCExPT09di5iZWZvcmVTZW5kLmNhbGwoeSxULHYpfHxoKSlyZXR1cm4gVC5hYm9ydCgpO2lmKHU9ImFib3J0IixiLmFkZCh2LmNvbXBsZXRlKSxULmRvbmUodi5zdWNjZXNzKSxULmZhaWwodi5lcnJvciksYz1fdChXdCx2LHQsVCkpe2lmKFQucmVhZHlTdGF0ZT0xLGcmJm0udHJpZ2dlcigiYWpheFNlbmQiLFtULHZdKSxoKXJldHVybiBUO3YuYXN5bmMmJjA8di50aW1lb3V0JiYoZD1DLnNldFRpbWVvdXQoZnVuY3Rpb24oKXtULmFib3J0KCJ0aW1lb3V0Iil9LHYudGltZW91dCkpO3RyeXtoPSExLGMuc2VuZChhLGwpfWNhdGNoKGUpe2lmKGgpdGhyb3cgZTtsKC0xLGUpfX1lbHNlIGwoLTEsIk5vIFRyYW5zcG9ydCIpO2Z1bmN0aW9uIGwoZSx0LG4scil7dmFyIGksbyxhLHMsdSxsPXQ7aHx8KGg9ITAsZCYmQy5jbGVhclRpbWVvdXQoZCksYz12b2lkIDAscD1yfHwiIixULnJlYWR5U3RhdGU9MDxlPzQ6MCxpPTIwMDw9ZSYmZTwzMDB8fDMwND09PWUsbiYmKHM9ZnVuY3Rpb24oZSx0LG4pe3ZhciByLGksbyxhLHM9ZS5jb250ZW50cyx1PWUuZGF0YVR5cGVzO3doaWxlKCIqIj09PXVbMF0pdS5zaGlmdCgpLHZvaWQgMD09PXImJihyPWUubWltZVR5cGV8fHQuZ2V0UmVzcG9uc2VIZWFkZXIoIkNvbnRlbnQtVHlwZSIpKTtpZihyKWZvcihpIGluIHMpaWYoc1tpXSYmc1tpXS50ZXN0KHIpKXt1LnVuc2hpZnQoaSk7YnJlYWt9aWYodVswXWluIG4pbz11WzBdO2Vsc2V7Zm9yKGkgaW4gbil7aWYoIXVbMF18fGUuY29udmVydGVyc1tpKyIgIit1WzBdXSl7bz1pO2JyZWFrfWF8fChhPWkpfW89b3x8YX1pZihvKXJldHVybiBvIT09dVswXSYmdS51bnNoaWZ0KG8pLG5bb119KHYsVCxuKSkscz1mdW5jdGlvbihlLHQsbixyKXt2YXIgaSxvLGEscyx1LGw9e30sYz1lLmRhdGFUeXBlcy5zbGljZSgpO2lmKGNbMV0pZm9yKGEgaW4gZS5jb252ZXJ0ZXJzKWxbYS50b0xvd2VyQ2FzZSgpXT1lLmNvbnZlcnRlcnNbYV07bz1jLnNoaWZ0KCk7d2hpbGUobylpZihlLnJlc3BvbnNlRmllbGRzW29dJiYobltlLnJlc3BvbnNlRmllbGRzW29dXT10KSwhdSYmciYmZS5kYXRhRmlsdGVyJiYodD1lLmRhdGFGaWx0ZXIodCxlLmRhdGFUeXBlKSksdT1vLG89Yy5zaGlmdCgpKWlmKCIqIj09PW8pbz11O2Vsc2UgaWYoIioiIT09dSYmdSE9PW8pe2lmKCEoYT1sW3UrIiAiK29dfHxsWyIqICIrb10pKWZvcihpIGluIGwpaWYoKHM9aS5zcGxpdCgiICIpKVsxXT09PW8mJihhPWxbdSsiICIrc1swXV18fGxbIiogIitzWzBdXSkpeyEwPT09YT9hPWxbaV06ITAhPT1sW2ldJiYobz1zWzBdLGMudW5zaGlmdChzWzFdKSk7YnJlYWt9aWYoITAhPT1hKWlmKGEmJmVbInRocm93cyJdKXQ9YSh0KTtlbHNlIHRyeXt0PWEodCl9Y2F0Y2goZSl7cmV0dXJue3N0YXRlOiJwYXJzZXJlcnJvciIsZXJyb3I6YT9lOiJObyBjb252ZXJzaW9uIGZyb20gIit1KyIgdG8gIitvfX19cmV0dXJue3N0YXRlOiJzdWNjZXNzIixkYXRhOnR9fSh2LHMsVCxpKSxpPyh2LmlmTW9kaWZpZWQmJigodT1ULmdldFJlc3BvbnNlSGVhZGVyKCJMYXN0LU1vZGlmaWVkIikpJiYoay5sYXN0TW9kaWZpZWRbZl09dSksKHU9VC5nZXRSZXNwb25zZUhlYWRlcigiZXRhZyIpKSYmKGsuZXRhZ1tmXT11KSksMjA0PT09ZXx8IkhFQUQiPT09di50eXBlP2w9Im5vY29udGVudCI6MzA0PT09ZT9sPSJub3Rtb2RpZmllZCI6KGw9cy5zdGF0ZSxvPXMuZGF0YSxpPSEoYT1zLmVycm9yKSkpOihhPWwsIWUmJmx8fChsPSJlcnJvciIsZTwwJiYoZT0wKSkpLFQuc3RhdHVzPWUsVC5zdGF0dXNUZXh0PSh0fHxsKSsiIixpP3gucmVzb2x2ZVdpdGgoeSxbbyxsLFRdKTp4LnJlamVjdFdpdGgoeSxbVCxsLGFdKSxULnN0YXR1c0NvZGUodyksdz12b2lkIDAsZyYmbS50cmlnZ2VyKGk/ImFqYXhTdWNjZXNzIjoiYWpheEVycm9yIixbVCx2LGk/bzphXSksYi5maXJlV2l0aCh5LFtULGxdKSxnJiYobS50cmlnZ2VyKCJhamF4Q29tcGxldGUiLFtULHZdKSwtLWsuYWN0aXZlfHxrLmV2ZW50LnRyaWdnZXIoImFqYXhTdG9wIikpKX1yZXR1cm4gVH0sZ2V0SlNPTjpmdW5jdGlvbihlLHQsbil7cmV0dXJuIGsuZ2V0KGUsdCxuLCJqc29uIil9LGdldFNjcmlwdDpmdW5jdGlvbihlLHQpe3JldHVybiBrLmdldChlLHZvaWQgMCx0LCJzY3JpcHQiKX19KSxrLmVhY2goWyJnZXQiLCJwb3N0Il0sZnVuY3Rpb24oZSxpKXtrW2ldPWZ1bmN0aW9uKGUsdCxuLHIpe3JldHVybiBtKHQpJiYocj1yfHxuLG49dCx0PXZvaWQgMCksay5hamF4KGsuZXh0ZW5kKHt1cmw6ZSx0eXBlOmksZGF0YVR5cGU6cixkYXRhOnQsc3VjY2VzczpufSxrLmlzUGxhaW5PYmplY3QoZSkmJmUpKX19KSxrLl9ldmFsVXJsPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIGsuYWpheCh7dXJsOmUsdHlwZToiR0VUIixkYXRhVHlwZToic2NyaXB0IixjYWNoZTohMCxhc3luYzohMSxnbG9iYWw6ITEsY29udmVydGVyczp7InRleHQgc2NyaXB0IjpmdW5jdGlvbigpe319LGRhdGFGaWx0ZXI6ZnVuY3Rpb24oZSl7ay5nbG9iYWxFdmFsKGUsdCl9fSl9LGsuZm4uZXh0ZW5kKHt3cmFwQWxsOmZ1bmN0aW9uKGUpe3ZhciB0O3JldHVybiB0aGlzWzBdJiYobShlKSYmKGU9ZS5jYWxsKHRoaXNbMF0pKSx0PWsoZSx0aGlzWzBdLm93bmVyRG9jdW1lbnQpLmVxKDApLmNsb25lKCEwKSx0aGlzWzBdLnBhcmVudE5vZGUmJnQuaW5zZXJ0QmVmb3JlKHRoaXNbMF0pLHQubWFwKGZ1bmN0aW9uKCl7dmFyIGU9dGhpczt3aGlsZShlLmZpcnN0RWxlbWVudENoaWxkKWU9ZS5maXJzdEVsZW1lbnRDaGlsZDtyZXR1cm4gZX0pLmFwcGVuZCh0aGlzKSksdGhpc30sd3JhcElubmVyOmZ1bmN0aW9uKG4pe3JldHVybiBtKG4pP3RoaXMuZWFjaChmdW5jdGlvbihlKXtrKHRoaXMpLndyYXBJbm5lcihuLmNhbGwodGhpcyxlKSl9KTp0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgZT1rKHRoaXMpLHQ9ZS5jb250ZW50cygpO3QubGVuZ3RoP3Qud3JhcEFsbChuKTplLmFwcGVuZChuKX0pfSx3cmFwOmZ1bmN0aW9uKHQpe3ZhciBuPW0odCk7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbihlKXtrKHRoaXMpLndyYXBBbGwobj90LmNhbGwodGhpcyxlKTp0KX0pfSx1bndyYXA6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMucGFyZW50KGUpLm5vdCgiYm9keSIpLmVhY2goZnVuY3Rpb24oKXtrKHRoaXMpLnJlcGxhY2VXaXRoKHRoaXMuY2hpbGROb2Rlcyl9KSx0aGlzfX0pLGsuZXhwci5wc2V1ZG9zLmhpZGRlbj1mdW5jdGlvbihlKXtyZXR1cm4hay5leHByLnBzZXVkb3MudmlzaWJsZShlKX0say5leHByLnBzZXVkb3MudmlzaWJsZT1mdW5jdGlvbihlKXtyZXR1cm4hIShlLm9mZnNldFdpZHRofHxlLm9mZnNldEhlaWdodHx8ZS5nZXRDbGllbnRSZWN0cygpLmxlbmd0aCl9LGsuYWpheFNldHRpbmdzLnhocj1mdW5jdGlvbigpe3RyeXtyZXR1cm4gbmV3IEMuWE1MSHR0cFJlcXVlc3R9Y2F0Y2goZSl7fX07dmFyIFV0PXswOjIwMCwxMjIzOjIwNH0sWHQ9ay5hamF4U2V0dGluZ3MueGhyKCk7eS5jb3JzPSEhWHQmJiJ3aXRoQ3JlZGVudGlhbHMiaW4gWHQseS5hamF4PVh0PSEhWHQsay5hamF4VHJhbnNwb3J0KGZ1bmN0aW9uKGkpe3ZhciBvLGE7aWYoeS5jb3JzfHxYdCYmIWkuY3Jvc3NEb21haW4pcmV0dXJue3NlbmQ6ZnVuY3Rpb24oZSx0KXt2YXIgbixyPWkueGhyKCk7aWYoci5vcGVuKGkudHlwZSxpLnVybCxpLmFzeW5jLGkudXNlcm5hbWUsaS5wYXNzd29yZCksaS54aHJGaWVsZHMpZm9yKG4gaW4gaS54aHJGaWVsZHMpcltuXT1pLnhockZpZWxkc1tuXTtmb3IobiBpbiBpLm1pbWVUeXBlJiZyLm92ZXJyaWRlTWltZVR5cGUmJnIub3ZlcnJpZGVNaW1lVHlwZShpLm1pbWVUeXBlKSxpLmNyb3NzRG9tYWlufHxlWyJYLVJlcXVlc3RlZC1XaXRoIl18fChlWyJYLVJlcXVlc3RlZC1XaXRoIl09IlhNTEh0dHBSZXF1ZXN0IiksZSlyLnNldFJlcXVlc3RIZWFkZXIobixlW25dKTtvPWZ1bmN0aW9uKGUpe3JldHVybiBmdW5jdGlvbigpe28mJihvPWE9ci5vbmxvYWQ9ci5vbmVycm9yPXIub25hYm9ydD1yLm9udGltZW91dD1yLm9ucmVhZHlzdGF0ZWNoYW5nZT1udWxsLCJhYm9ydCI9PT1lP3IuYWJvcnQoKToiZXJyb3IiPT09ZT8ibnVtYmVyIiE9dHlwZW9mIHIuc3RhdHVzP3QoMCwiZXJyb3IiKTp0KHIuc3RhdHVzLHIuc3RhdHVzVGV4dCk6dChVdFtyLnN0YXR1c118fHIuc3RhdHVzLHIuc3RhdHVzVGV4dCwidGV4dCIhPT0oci5yZXNwb25zZVR5cGV8fCJ0ZXh0Iil8fCJzdHJpbmciIT10eXBlb2Ygci5yZXNwb25zZVRleHQ/e2JpbmFyeTpyLnJlc3BvbnNlfTp7dGV4dDpyLnJlc3BvbnNlVGV4dH0sci5nZXRBbGxSZXNwb25zZUhlYWRlcnMoKSkpfX0sci5vbmxvYWQ9bygpLGE9ci5vbmVycm9yPXIub250aW1lb3V0PW8oImVycm9yIiksdm9pZCAwIT09ci5vbmFib3J0P3Iub25hYm9ydD1hOnIub25yZWFkeXN0YXRlY2hhbmdlPWZ1bmN0aW9uKCl7ND09PXIucmVhZHlTdGF0ZSYmQy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7byYmYSgpfSl9LG89bygiYWJvcnQiKTt0cnl7ci5zZW5kKGkuaGFzQ29udGVudCYmaS5kYXRhfHxudWxsKX1jYXRjaChlKXtpZihvKXRocm93IGV9fSxhYm9ydDpmdW5jdGlvbigpe28mJm8oKX19fSksay5hamF4UHJlZmlsdGVyKGZ1bmN0aW9uKGUpe2UuY3Jvc3NEb21haW4mJihlLmNvbnRlbnRzLnNjcmlwdD0hMSl9KSxrLmFqYXhTZXR1cCh7YWNjZXB0czp7c2NyaXB0OiJ0ZXh0L2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2phdmFzY3JpcHQsIGFwcGxpY2F0aW9uL2VjbWFzY3JpcHQsIGFwcGxpY2F0aW9uL3gtZWNtYXNjcmlwdCJ9LGNvbnRlbnRzOntzY3JpcHQ6L1xiKD86amF2YXxlY21hKXNjcmlwdFxiL30sY29udmVydGVyczp7InRleHQgc2NyaXB0IjpmdW5jdGlvbihlKXtyZXR1cm4gay5nbG9iYWxFdmFsKGUpLGV9fX0pLGsuYWpheFByZWZpbHRlcigic2NyaXB0IixmdW5jdGlvbihlKXt2b2lkIDA9PT1lLmNhY2hlJiYoZS5jYWNoZT0hMSksZS5jcm9zc0RvbWFpbiYmKGUudHlwZT0iR0VUIil9KSxrLmFqYXhUcmFuc3BvcnQoInNjcmlwdCIsZnVuY3Rpb24obil7dmFyIHIsaTtpZihuLmNyb3NzRG9tYWlufHxuLnNjcmlwdEF0dHJzKXJldHVybntzZW5kOmZ1bmN0aW9uKGUsdCl7cj1rKCI8c2NyaXB0PiIpLmF0dHIobi5zY3JpcHRBdHRyc3x8e30pLnByb3Aoe2NoYXJzZXQ6bi5zY3JpcHRDaGFyc2V0LHNyYzpuLnVybH0pLm9uKCJsb2FkIGVycm9yIixpPWZ1bmN0aW9uKGUpe3IucmVtb3ZlKCksaT1udWxsLGUmJnQoImVycm9yIj09PWUudHlwZT80MDQ6MjAwLGUudHlwZSl9KSxFLmhlYWQuYXBwZW5kQ2hpbGQoclswXSl9LGFib3J0OmZ1bmN0aW9uKCl7aSYmaSgpfX19KTt2YXIgVnQsR3Q9W10sWXQ9Lyg9KVw/KD89JnwkKXxcP1w/LztrLmFqYXhTZXR1cCh7anNvbnA6ImNhbGxiYWNrIixqc29ucENhbGxiYWNrOmZ1bmN0aW9uKCl7dmFyIGU9R3QucG9wKCl8fGsuZXhwYW5kbysiXyIra3QrKztyZXR1cm4gdGhpc1tlXT0hMCxlfX0pLGsuYWpheFByZWZpbHRlcigianNvbiBqc29ucCIsZnVuY3Rpb24oZSx0LG4pe3ZhciByLGksbyxhPSExIT09ZS5qc29ucCYmKFl0LnRlc3QoZS51cmwpPyJ1cmwiOiJzdHJpbmciPT10eXBlb2YgZS5kYXRhJiYwPT09KGUuY29udGVudFR5cGV8fCIiKS5pbmRleE9mKCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiKSYmWXQudGVzdChlLmRhdGEpJiYiZGF0YSIpO2lmKGF8fCJqc29ucCI9PT1lLmRhdGFUeXBlc1swXSlyZXR1cm4gcj1lLmpzb25wQ2FsbGJhY2s9bShlLmpzb25wQ2FsbGJhY2spP2UuanNvbnBDYWxsYmFjaygpOmUuanNvbnBDYWxsYmFjayxhP2VbYV09ZVthXS5yZXBsYWNlKFl0LCIkMSIrcik6ITEhPT1lLmpzb25wJiYoZS51cmwrPShTdC50ZXN0KGUudXJsKT8iJiI6Ij8iKStlLmpzb25wKyI9IityKSxlLmNvbnZlcnRlcnNbInNjcmlwdCBqc29uIl09ZnVuY3Rpb24oKXtyZXR1cm4gb3x8ay5lcnJvcihyKyIgd2FzIG5vdCBjYWxsZWQiKSxvWzBdfSxlLmRhdGFUeXBlc1swXT0ianNvbiIsaT1DW3JdLENbcl09ZnVuY3Rpb24oKXtvPWFyZ3VtZW50c30sbi5hbHdheXMoZnVuY3Rpb24oKXt2b2lkIDA9PT1pP2soQykucmVtb3ZlUHJvcChyKTpDW3JdPWksZVtyXSYmKGUuanNvbnBDYWxsYmFjaz10Lmpzb25wQ2FsbGJhY2ssR3QucHVzaChyKSksbyYmbShpKSYmaShvWzBdKSxvPWk9dm9pZCAwfSksInNjcmlwdCJ9KSx5LmNyZWF0ZUhUTUxEb2N1bWVudD0oKFZ0PUUuaW1wbGVtZW50YXRpb24uY3JlYXRlSFRNTERvY3VtZW50KCIiKS5ib2R5KS5pbm5lckhUTUw9Ijxmb3JtPjwvZm9ybT48Zm9ybT48L2Zvcm0+IiwyPT09VnQuY2hpbGROb2Rlcy5sZW5ndGgpLGsucGFyc2VIVE1MPWZ1bmN0aW9uKGUsdCxuKXtyZXR1cm4ic3RyaW5nIiE9dHlwZW9mIGU/W106KCJib29sZWFuIj09dHlwZW9mIHQmJihuPXQsdD0hMSksdHx8KHkuY3JlYXRlSFRNTERvY3VtZW50Pygocj0odD1FLmltcGxlbWVudGF0aW9uLmNyZWF0ZUhUTUxEb2N1bWVudCgiIikpLmNyZWF0ZUVsZW1lbnQoImJhc2UiKSkuaHJlZj1FLmxvY2F0aW9uLmhyZWYsdC5oZWFkLmFwcGVuZENoaWxkKHIpKTp0PUUpLG89IW4mJltdLChpPUQuZXhlYyhlKSk/W3QuY3JlYXRlRWxlbWVudChpWzFdKV06KGk9d2UoW2VdLHQsbyksbyYmby5sZW5ndGgmJmsobykucmVtb3ZlKCksay5tZXJnZShbXSxpLmNoaWxkTm9kZXMpKSk7dmFyIHIsaSxvfSxrLmZuLmxvYWQ9ZnVuY3Rpb24oZSx0LG4pe3ZhciByLGksbyxhPXRoaXMscz1lLmluZGV4T2YoIiAiKTtyZXR1cm4tMTxzJiYocj1tdChlLnNsaWNlKHMpKSxlPWUuc2xpY2UoMCxzKSksbSh0KT8obj10LHQ9dm9pZCAwKTp0JiYib2JqZWN0Ij09dHlwZW9mIHQmJihpPSJQT1NUIiksMDxhLmxlbmd0aCYmay5hamF4KHt1cmw6ZSx0eXBlOml8fCJHRVQiLGRhdGFUeXBlOiJodG1sIixkYXRhOnR9KS5kb25lKGZ1bmN0aW9uKGUpe289YXJndW1lbnRzLGEuaHRtbChyP2soIjxkaXY+IikuYXBwZW5kKGsucGFyc2VIVE1MKGUpKS5maW5kKHIpOmUpfSkuYWx3YXlzKG4mJmZ1bmN0aW9uKGUsdCl7YS5lYWNoKGZ1bmN0aW9uKCl7bi5hcHBseSh0aGlzLG98fFtlLnJlc3BvbnNlVGV4dCx0LGVdKX0pfSksdGhpc30say5lYWNoKFsiYWpheFN0YXJ0IiwiYWpheFN0b3AiLCJhamF4Q29tcGxldGUiLCJhamF4RXJyb3IiLCJhamF4U3VjY2VzcyIsImFqYXhTZW5kIl0sZnVuY3Rpb24oZSx0KXtrLmZuW3RdPWZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLm9uKHQsZSl9fSksay5leHByLnBzZXVkb3MuYW5pbWF0ZWQ9ZnVuY3Rpb24odCl7cmV0dXJuIGsuZ3JlcChrLnRpbWVycyxmdW5jdGlvbihlKXtyZXR1cm4gdD09PWUuZWxlbX0pLmxlbmd0aH0say5vZmZzZXQ9e3NldE9mZnNldDpmdW5jdGlvbihlLHQsbil7dmFyIHIsaSxvLGEscyx1LGw9ay5jc3MoZSwicG9zaXRpb24iKSxjPWsoZSksZj17fTsic3RhdGljIj09PWwmJihlLnN0eWxlLnBvc2l0aW9uPSJyZWxhdGl2ZSIpLHM9Yy5vZmZzZXQoKSxvPWsuY3NzKGUsInRvcCIpLHU9ay5jc3MoZSwibGVmdCIpLCgiYWJzb2x1dGUiPT09bHx8ImZpeGVkIj09PWwpJiYtMTwobyt1KS5pbmRleE9mKCJhdXRvIik/KGE9KHI9Yy5wb3NpdGlvbigpKS50b3AsaT1yLmxlZnQpOihhPXBhcnNlRmxvYXQobyl8fDAsaT1wYXJzZUZsb2F0KHUpfHwwKSxtKHQpJiYodD10LmNhbGwoZSxuLGsuZXh0ZW5kKHt9LHMpKSksbnVsbCE9dC50b3AmJihmLnRvcD10LnRvcC1zLnRvcCthKSxudWxsIT10LmxlZnQmJihmLmxlZnQ9dC5sZWZ0LXMubGVmdCtpKSwidXNpbmciaW4gdD90LnVzaW5nLmNhbGwoZSxmKTpjLmNzcyhmKX19LGsuZm4uZXh0ZW5kKHtvZmZzZXQ6ZnVuY3Rpb24odCl7aWYoYXJndW1lbnRzLmxlbmd0aClyZXR1cm4gdm9pZCAwPT09dD90aGlzOnRoaXMuZWFjaChmdW5jdGlvbihlKXtrLm9mZnNldC5zZXRPZmZzZXQodGhpcyx0LGUpfSk7dmFyIGUsbixyPXRoaXNbMF07cmV0dXJuIHI/ci5nZXRDbGllbnRSZWN0cygpLmxlbmd0aD8oZT1yLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLG49ci5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3LHt0b3A6ZS50b3Arbi5wYWdlWU9mZnNldCxsZWZ0OmUubGVmdCtuLnBhZ2VYT2Zmc2V0fSk6e3RvcDowLGxlZnQ6MH06dm9pZCAwfSxwb3NpdGlvbjpmdW5jdGlvbigpe2lmKHRoaXNbMF0pe3ZhciBlLHQsbixyPXRoaXNbMF0saT17dG9wOjAsbGVmdDowfTtpZigiZml4ZWQiPT09ay5jc3MociwicG9zaXRpb24iKSl0PXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7ZWxzZXt0PXRoaXMub2Zmc2V0KCksbj1yLm93bmVyRG9jdW1lbnQsZT1yLm9mZnNldFBhcmVudHx8bi5kb2N1bWVudEVsZW1lbnQ7d2hpbGUoZSYmKGU9PT1uLmJvZHl8fGU9PT1uLmRvY3VtZW50RWxlbWVudCkmJiJzdGF0aWMiPT09ay5jc3MoZSwicG9zaXRpb24iKSllPWUucGFyZW50Tm9kZTtlJiZlIT09ciYmMT09PWUubm9kZVR5cGUmJigoaT1rKGUpLm9mZnNldCgpKS50b3ArPWsuY3NzKGUsImJvcmRlclRvcFdpZHRoIiwhMCksaS5sZWZ0Kz1rLmNzcyhlLCJib3JkZXJMZWZ0V2lkdGgiLCEwKSl9cmV0dXJue3RvcDp0LnRvcC1pLnRvcC1rLmNzcyhyLCJtYXJnaW5Ub3AiLCEwKSxsZWZ0OnQubGVmdC1pLmxlZnQtay5jc3MociwibWFyZ2luTGVmdCIsITApfX19LG9mZnNldFBhcmVudDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm1hcChmdW5jdGlvbigpe3ZhciBlPXRoaXMub2Zmc2V0UGFyZW50O3doaWxlKGUmJiJzdGF0aWMiPT09ay5jc3MoZSwicG9zaXRpb24iKSllPWUub2Zmc2V0UGFyZW50O3JldHVybiBlfHxpZX0pfX0pLGsuZWFjaCh7c2Nyb2xsTGVmdDoicGFnZVhPZmZzZXQiLHNjcm9sbFRvcDoicGFnZVlPZmZzZXQifSxmdW5jdGlvbih0LGkpe3ZhciBvPSJwYWdlWU9mZnNldCI9PT1pO2suZm5bdF09ZnVuY3Rpb24oZSl7cmV0dXJuIF8odGhpcyxmdW5jdGlvbihlLHQsbil7dmFyIHI7aWYoeChlKT9yPWU6OT09PWUubm9kZVR5cGUmJihyPWUuZGVmYXVsdFZpZXcpLHZvaWQgMD09PW4pcmV0dXJuIHI/cltpXTplW3RdO3I/ci5zY3JvbGxUbyhvP3IucGFnZVhPZmZzZXQ6bixvP246ci5wYWdlWU9mZnNldCk6ZVt0XT1ufSx0LGUsYXJndW1lbnRzLmxlbmd0aCl9fSksay5lYWNoKFsidG9wIiwibGVmdCJdLGZ1bmN0aW9uKGUsbil7ay5jc3NIb29rc1tuXT16ZSh5LnBpeGVsUG9zaXRpb24sZnVuY3Rpb24oZSx0KXtpZih0KXJldHVybiB0PV9lKGUsbiksJGUudGVzdCh0KT9rKGUpLnBvc2l0aW9uKClbbl0rInB4Ijp0fSl9KSxrLmVhY2goe0hlaWdodDoiaGVpZ2h0IixXaWR0aDoid2lkdGgifSxmdW5jdGlvbihhLHMpe2suZWFjaCh7cGFkZGluZzoiaW5uZXIiK2EsY29udGVudDpzLCIiOiJvdXRlciIrYX0sZnVuY3Rpb24ocixvKXtrLmZuW29dPWZ1bmN0aW9uKGUsdCl7dmFyIG49YXJndW1lbnRzLmxlbmd0aCYmKHJ8fCJib29sZWFuIiE9dHlwZW9mIGUpLGk9cnx8KCEwPT09ZXx8ITA9PT10PyJtYXJnaW4iOiJib3JkZXIiKTtyZXR1cm4gXyh0aGlzLGZ1bmN0aW9uKGUsdCxuKXt2YXIgcjtyZXR1cm4geChlKT8wPT09by5pbmRleE9mKCJvdXRlciIpP2VbImlubmVyIithXTplLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudFsiY2xpZW50IithXTo5PT09ZS5ub2RlVHlwZT8ocj1lLmRvY3VtZW50RWxlbWVudCxNYXRoLm1heChlLmJvZHlbInNjcm9sbCIrYV0sclsic2Nyb2xsIithXSxlLmJvZHlbIm9mZnNldCIrYV0sclsib2Zmc2V0IithXSxyWyJjbGllbnQiK2FdKSk6dm9pZCAwPT09bj9rLmNzcyhlLHQsaSk6ay5zdHlsZShlLHQsbixpKX0scyxuP2U6dm9pZCAwLG4pfX0pfSksay5lYWNoKCJibHVyIGZvY3VzIGZvY3VzaW4gZm9jdXNvdXQgcmVzaXplIHNjcm9sbCBjbGljayBkYmxjbGljayBtb3VzZWRvd24gbW91c2V1cCBtb3VzZW1vdmUgbW91c2VvdmVyIG1vdXNlb3V0IG1vdXNlZW50ZXIgbW91c2VsZWF2ZSBjaGFuZ2Ugc2VsZWN0IHN1Ym1pdCBrZXlkb3duIGtleXByZXNzIGtleXVwIGNvbnRleHRtZW51Ii5zcGxpdCgiICIpLGZ1bmN0aW9uKGUsbil7ay5mbltuXT1mdW5jdGlvbihlLHQpe3JldHVybiAwPGFyZ3VtZW50cy5sZW5ndGg/dGhpcy5vbihuLG51bGwsZSx0KTp0aGlzLnRyaWdnZXIobil9fSksay5mbi5leHRlbmQoe2hvdmVyOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIHRoaXMubW91c2VlbnRlcihlKS5tb3VzZWxlYXZlKHR8fGUpfX0pLGsuZm4uZXh0ZW5kKHtiaW5kOmZ1bmN0aW9uKGUsdCxuKXtyZXR1cm4gdGhpcy5vbihlLG51bGwsdCxuKX0sdW5iaW5kOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIHRoaXMub2ZmKGUsbnVsbCx0KX0sZGVsZWdhdGU6ZnVuY3Rpb24oZSx0LG4scil7cmV0dXJuIHRoaXMub24odCxlLG4scil9LHVuZGVsZWdhdGU6ZnVuY3Rpb24oZSx0LG4pe3JldHVybiAxPT09YXJndW1lbnRzLmxlbmd0aD90aGlzLm9mZihlLCIqKiIpOnRoaXMub2ZmKHQsZXx8IioqIixuKX19KSxrLnByb3h5PWZ1bmN0aW9uKGUsdCl7dmFyIG4scixpO2lmKCJzdHJpbmciPT10eXBlb2YgdCYmKG49ZVt0XSx0PWUsZT1uKSxtKGUpKXJldHVybiByPXMuY2FsbChhcmd1bWVudHMsMiksKGk9ZnVuY3Rpb24oKXtyZXR1cm4gZS5hcHBseSh0fHx0aGlzLHIuY29uY2F0KHMuY2FsbChhcmd1bWVudHMpKSl9KS5ndWlkPWUuZ3VpZD1lLmd1aWR8fGsuZ3VpZCsrLGl9LGsuaG9sZFJlYWR5PWZ1bmN0aW9uKGUpe2U/ay5yZWFkeVdhaXQrKzprLnJlYWR5KCEwKX0say5pc0FycmF5PUFycmF5LmlzQXJyYXksay5wYXJzZUpTT049SlNPTi5wYXJzZSxrLm5vZGVOYW1lPUEsay5pc0Z1bmN0aW9uPW0say5pc1dpbmRvdz14LGsuY2FtZWxDYXNlPVYsay50eXBlPXcsay5ub3c9RGF0ZS5ub3csay5pc051bWVyaWM9ZnVuY3Rpb24oZSl7dmFyIHQ9ay50eXBlKGUpO3JldHVybigibnVtYmVyIj09PXR8fCJzdHJpbmciPT09dCkmJiFpc05hTihlLXBhcnNlRmxvYXQoZSkpfSwiZnVuY3Rpb24iPT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kJiZkZWZpbmUoImpxdWVyeSIsW10sZnVuY3Rpb24oKXtyZXR1cm4ga30pO3ZhciBRdD1DLmpRdWVyeSxKdD1DLiQ7cmV0dXJuIGsubm9Db25mbGljdD1mdW5jdGlvbihlKXtyZXR1cm4gQy4kPT09ayYmKEMuJD1KdCksZSYmQy5qUXVlcnk9PT1rJiYoQy5qUXVlcnk9UXQpLGt9LGV8fChDLmpRdWVyeT1DLiQ9ayksa30pOwo="}]}]}